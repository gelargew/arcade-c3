// Generated by Construct, the game and app creator :: https://www.construct.net
<<<<<<< HEAD
"use strict";
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?b(exports):"function"===typeof define&&define.amd?define(["exports"],b):(a="undefined"!==typeof globalThis?globalThis:a||self,b(a.glMatrix={}))})(this,function(a){function b(f,h,m){var q=h[0],t=h[1],u=h[2];h=h[3];var v=m[0],x=m[1],y=m[2];m=m[3];f[0]=q*v+u*x;f[1]=t*v+h*x;f[2]=q*y+u*m;f[3]=t*y+h*m;return f}function d(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];f[2]=h[2]-m[2];f[3]=h[3]-m[3];return f}function c(f,h,m){var q=h[0],t=h[1],u=
h[2],v=h[3],x=h[4];h=h[5];var y=m[0],A=m[1],D=m[2],G=m[3],J=m[4];m=m[5];f[0]=q*y+u*A;f[1]=t*y+v*A;f[2]=q*D+u*G;f[3]=t*D+v*G;f[4]=q*J+u*m+x;f[5]=t*J+v*m+h;return f}function e(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];f[2]=h[2]-m[2];f[3]=h[3]-m[3];f[4]=h[4]-m[4];f[5]=h[5]-m[5];return f}function g(){var f=new U(9);U!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0);f[0]=1;f[4]=1;f[8]=1;return f}function k(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7];h=h[8];var G=m[0],J=m[1],
H=m[2],M=m[3],N=m[4],L=m[5],Q=m[6],P=m[7];m=m[8];f[0]=G*q+J*v+H*A;f[1]=G*t+J*x+H*D;f[2]=G*u+J*y+H*h;f[3]=M*q+N*v+L*A;f[4]=M*t+N*x+L*D;f[5]=M*u+N*y+L*h;f[6]=Q*q+P*v+m*A;f[7]=Q*t+P*x+m*D;f[8]=Q*u+P*y+m*h;return f}function l(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];f[2]=h[2]-m[2];f[3]=h[3]-m[3];f[4]=h[4]-m[4];f[5]=h[5]-m[5];f[6]=h[6]-m[6];f[7]=h[7]-m[7];f[8]=h[8]-m[8];return f}function n(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=
1;return f}function p(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7],G=h[8],J=h[9],H=h[10],M=h[11],N=h[12],L=h[13],Q=h[14];h=h[15];var P=m[0],S=m[1],T=m[2],R=m[3];f[0]=P*q+S*x+T*G+R*N;f[1]=P*t+S*y+T*J+R*L;f[2]=P*u+S*A+T*H+R*Q;f[3]=P*v+S*D+T*M+R*h;P=m[4];S=m[5];T=m[6];R=m[7];f[4]=P*q+S*x+T*G+R*N;f[5]=P*t+S*y+T*J+R*L;f[6]=P*u+S*A+T*H+R*Q;f[7]=P*v+S*D+T*M+R*h;P=m[8];S=m[9];T=m[10];R=m[11];f[8]=P*q+S*x+T*G+R*N;f[9]=P*t+S*y+T*J+R*L;f[10]=P*u+S*A+T*H+R*Q;f[11]=P*v+S*D+T*M+R*h;P=m[12];
S=m[13];T=m[14];R=m[15];f[12]=P*q+S*x+T*G+R*N;f[13]=P*t+S*y+T*J+R*L;f[14]=P*u+S*A+T*H+R*Q;f[15]=P*v+S*D+T*M+R*h;return f}function r(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=q+q,y=t+t,A=u+u;h=q*x;var D=q*y;q*=A;var G=t*y;t*=A;u*=A;x*=v;y*=v;v*=A;f[0]=1-(G+u);f[1]=D+v;f[2]=q-y;f[3]=0;f[4]=D-v;f[5]=1-(h+u);f[6]=t+x;f[7]=0;f[8]=q+y;f[9]=t-x;f[10]=1-(h+G);f[11]=0;f[12]=m[0];f[13]=m[1];f[14]=m[2];f[15]=1;return f}function w(f,h){f[0]=h[12];f[1]=h[13];f[2]=h[14];return f}function z(f,h){var m=h[4],q=h[5],
t=h[6],u=h[8],v=h[9],x=h[10];f[0]=Math.hypot(h[0],h[1],h[2]);f[1]=Math.hypot(m,q,t);f[2]=Math.hypot(u,v,x);return f}function B(f,h){var m=new U(3);z(m,h);var q=1/m[0],t=1/m[1],u=1/m[2],v=h[0]*q;m=h[1]*t;var x=h[2]*u,y=h[4]*q,A=h[5]*t,D=h[6]*u;q*=h[8];t*=h[9];h=h[10]*u;u=v+A+h;0<u?(v=2*Math.sqrt(u+1),f[3]=.25*v,f[0]=(D-t)/v,f[1]=(q-x)/v,f[2]=(m-y)/v):v>A&&v>h?(v=2*Math.sqrt(1+v-A-h),f[3]=(D-t)/v,f[0]=.25*v,f[1]=(m+y)/v,f[2]=(q+x)/v):A>h?(v=2*Math.sqrt(1+A-v-h),f[3]=(q-x)/v,f[0]=(m+y)/v,f[1]=.25*v,
f[2]=(D+t)/v):(v=2*Math.sqrt(1+h-v-A),f[3]=(m-y)/v,f[0]=(q+x)/v,f[1]=(D+t)/v,f[2]=.25*v);return f}function C(f,h,m,q,t){h=1/Math.tan(h/2);f[0]=h/m;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=h;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[11]=-1;f[12]=0;f[13]=0;f[15]=0;null!=t&&Infinity!==t?(m=1/(q-t),f[10]=(t+q)*m,f[14]=2*t*q*m):(f[10]=-1,f[14]=-2*q);return f}function E(f,h,m,q,t,u,v){var x=1/(h-m),y=1/(q-t),A=1/(u-v);f[0]=-2*x;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*y;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*A;f[11]=0;f[12]=(h+m)*
x;f[13]=(t+q)*y;f[14]=(v+u)*A;f[15]=1;return f}function F(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];f[2]=h[2]-m[2];f[3]=h[3]-m[3];f[4]=h[4]-m[4];f[5]=h[5]-m[5];f[6]=h[6]-m[6];f[7]=h[7]-m[7];f[8]=h[8]-m[8];f[9]=h[9]-m[9];f[10]=h[10]-m[10];f[11]=h[11]-m[11];f[12]=h[12]-m[12];f[13]=h[13]-m[13];f[14]=h[14]-m[14];f[15]=h[15]-m[15];return f}function I(){var f=new U(3);U!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0);return f}function K(f){return Math.hypot(f[0],f[1],f[2])}function O(f,h,m){var q=new U(3);q[0]=f;q[1]=
h;q[2]=m;return q}function V(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];f[2]=h[2]-m[2];return f}function W(f,h,m){f[0]=h[0]*m[0];f[1]=h[1]*m[1];f[2]=h[2]*m[2];return f}function ca(f,h,m){f[0]=h[0]/m[0];f[1]=h[1]/m[1];f[2]=h[2]/m[2];return f}function la(f,h){return Math.hypot(h[0]-f[0],h[1]-f[1],h[2]-f[2])}function ma(f,h){var m=h[0]-f[0],q=h[1]-f[1];f=h[2]-f[2];return m*m+q*q+f*f}function za(f){var h=f[0],m=f[1];f=f[2];return h*h+m*m+f*f}function Aa(f,h){var m=h[0],q=h[1],t=h[2];m=m*m+q*q+t*t;0<m&&(m=1/
Math.sqrt(m));f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;return f}function oa(f,h){return f[0]*h[0]+f[1]*h[1]+f[2]*h[2]}function pa(f,h,m){var q=h[0],t=h[1];h=h[2];var u=m[0],v=m[1];m=m[2];f[0]=t*m-h*v;f[1]=h*u-q*m;f[2]=q*v-t*u;return f}function Ba(){var f=new U(4);U!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0,f[3]=0);return f}function Ca(f){var h=new U(4);h[0]=f[0];h[1]=f[1];h[2]=f[2];h[3]=f[3];return h}function Da(f,h,m,q){var t=new U(4);t[0]=f;t[1]=h;t[2]=m;t[3]=q;return t}function qa(f,h){f[0]=h[0];f[1]=h[1];
f[2]=h[2];f[3]=h[3];return f}function Ea(f,h,m,q,t){f[0]=h;f[1]=m;f[2]=q;f[3]=t;return f}function Fa(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];f[3]=h[3]+m[3];return f}function Ga(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];f[2]=h[2]-m[2];f[3]=h[3]-m[3];return f}function Ha(f,h,m){f[0]=h[0]*m[0];f[1]=h[1]*m[1];f[2]=h[2]*m[2];f[3]=h[3]*m[3];return f}function Ia(f,h,m){f[0]=h[0]/m[0];f[1]=h[1]/m[1];f[2]=h[2]/m[2];f[3]=h[3]/m[3];return f}function ua(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;f[3]=
h[3]*m;return f}function Ja(f,h){return Math.hypot(h[0]-f[0],h[1]-f[1],h[2]-f[2],h[3]-f[3])}function Ka(f,h){var m=h[0]-f[0],q=h[1]-f[1],t=h[2]-f[2];f=h[3]-f[3];return m*m+q*q+t*t+f*f}function ja(f){return Math.hypot(f[0],f[1],f[2],f[3])}function ia(f){var h=f[0],m=f[1],q=f[2];f=f[3];return h*h+m*m+q*q+f*f}function ra(f,h){var m=h[0],q=h[1],t=h[2];h=h[3];var u=m*m+q*q+t*t+h*h;0<u&&(u=1/Math.sqrt(u));f[0]=m*u;f[1]=q*u;f[2]=t*u;f[3]=h*u;return f}function ka(f,h){return f[0]*h[0]+f[1]*h[1]+f[2]*h[2]+
f[3]*h[3]}function La(f,h,m,q){var t=h[0],u=h[1],v=h[2];h=h[3];f[0]=t+q*(m[0]-t);f[1]=u+q*(m[1]-u);f[2]=v+q*(m[2]-v);f[3]=h+q*(m[3]-h);return f}function Ma(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]&&f[3]===h[3]}function sa(){var f=new U(4);U!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0);f[3]=1;return f}function Na(f,h,m){m*=.5;var q=Math.sin(m);f[0]=q*h[0];f[1]=q*h[1];f[2]=q*h[2];f[3]=Math.cos(m);return f}function Oa(f,h,m){var q=h[0],t=h[1],u=h[2];h=h[3];var v=m[0],x=m[1],y=m[2];m=m[3];f[0]=q*m+
h*v+t*y-u*x;f[1]=t*m+h*x+u*v-q*y;f[2]=u*m+h*y+q*x-t*v;f[3]=h*m-q*v-t*x-u*y;return f}function Pa(f,h,m){m*=.5;var q=h[0],t=h[1],u=h[2];h=h[3];var v=Math.sin(m);m=Math.cos(m);f[0]=q*m+h*v;f[1]=t*m+u*v;f[2]=u*m-t*v;f[3]=h*m-q*v;return f}function Qa(f,h,m){m*=.5;var q=h[0],t=h[1],u=h[2];h=h[3];var v=Math.sin(m);m=Math.cos(m);f[0]=q*m-u*v;f[1]=t*m+h*v;f[2]=u*m+q*v;f[3]=h*m-t*v;return f}function Ra(f,h,m){m*=.5;var q=h[0],t=h[1],u=h[2];h=h[3];var v=Math.sin(m);m=Math.cos(m);f[0]=q*m+t*v;f[1]=t*m-q*v;f[2]=
u*m+h*v;f[3]=h*m-u*v;return f}function Sa(f,h){var m=h[0],q=h[1],t=h[2],u=Math.sqrt(m*m+q*q+t*t);h=Math.exp(h[3]);var v=0<u?h*Math.sin(u)/u:0;f[0]=m*v;f[1]=q*v;f[2]=t*v;f[3]=h*Math.cos(u);return f}function Ta(f,h){var m=h[0],q=h[1],t=h[2];h=h[3];var u=Math.sqrt(m*m+q*q+t*t);u=0<u?Math.atan2(u,h)/u:0;f[0]=m*u;f[1]=q*u;f[2]=t*u;f[3]=.5*Math.log(m*m+q*q+t*t+h*h);return f}function ta(f,h,m,q){var t=h[0],u=h[1],v=h[2];h=h[3];var x=m[0],y=m[1],A=m[2];m=m[3];var D=t*x+u*y+v*A+h*m;0>D&&(D=-D,x=-x,y=-y,A=
-A,m=-m);if(1E-6<1-D){var G=Math.acos(D);var J=Math.sin(G);D=Math.sin((1-q)*G)/J;q=Math.sin(q*G)/J}else D=1-q;f[0]=D*t+q*x;f[1]=D*u+q*y;f[2]=D*v+q*A;f[3]=D*h+q*m;return f}function Ua(f,h){var m=h[0]+h[4]+h[8];if(0<m)m=Math.sqrt(m+1),f[3]=.5*m,m=.5/m,f[0]=(h[5]-h[7])*m,f[1]=(h[6]-h[2])*m,f[2]=(h[1]-h[3])*m;else{var q=0;h[4]>h[0]&&(q=1);h[8]>h[3*q+q]&&(q=2);var t=(q+1)%3,u=(q+2)%3;m=Math.sqrt(h[3*q+q]-h[3*t+t]-h[3*u+u]+1);f[q]=.5*m;m=.5/m;f[3]=(h[3*t+u]-h[3*u+t])*m;f[t]=(h[3*t+q]+h[3*q+t])*m;f[u]=(h[3*
u+q]+h[3*q+u])*m}return f}function Va(f,h,m){var q=.5*m[0],t=.5*m[1];m=.5*m[2];var u=h[0],v=h[1],x=h[2];h=h[3];f[0]=u;f[1]=v;f[2]=x;f[3]=h;f[4]=q*h+t*x-m*v;f[5]=t*h+m*u-q*x;f[6]=m*h+q*v-t*u;f[7]=-q*u-t*v-m*x;return f}function Wa(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[3];f[4]=h[4];f[5]=h[5];f[6]=h[6];f[7]=h[7];return f}function Xa(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=m[4],y=m[5],A=m[6],D=m[7],G=h[4],J=h[5],H=h[6];h=h[7];var M=m[0],N=m[1],L=m[2];m=m[3];f[0]=q*m+v*M+t*L-u*N;f[1]=t*m+v*N+u*M-q*
L;f[2]=u*m+v*L+q*N-t*M;f[3]=v*m-q*M-t*N-u*L;f[4]=q*D+v*x+t*A-u*y+G*m+h*M+J*L-H*N;f[5]=t*D+v*y+u*x-q*A+J*m+h*N+H*M-G*L;f[6]=u*D+v*A+q*y-t*x+H*m+h*L+G*N-J*M;f[7]=v*D-q*x-t*y-u*A+h*m-G*M-J*N-H*L;return f}function Ya(){var f=new U(2);U!=Float32Array&&(f[0]=0,f[1]=0);return f}function Za(f,h,m){f[0]=h[0]-m[0];f[1]=h[1]-m[1];return f}function $a(f,h,m){f[0]=h[0]*m[0];f[1]=h[1]*m[1];return f}function ab(f,h,m){f[0]=h[0]/m[0];f[1]=h[1]/m[1];return f}function bb(f,h){return Math.hypot(h[0]-f[0],h[1]-f[1])}
function cb(f,h){var m=h[0]-f[0];f=h[1]-f[1];return m*m+f*f}function db(f){return Math.hypot(f[0],f[1])}function eb(f){var h=f[0];f=f[1];return h*h+f*f}var U="undefined"!==typeof Float32Array?Float32Array:Array,ha=Math.random,hb=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var f=0,h=arguments.length;h--;)f+=arguments[h]*arguments[h];return Math.sqrt(f)});var ib=Object.freeze({__proto__:null,EPSILON:1E-6,get ARRAY_TYPE(){return U},RANDOM:ha,ANGLE_ORDER:"zyx",setMatrixArrayType:function(f){U=
f},toRadian:function(f){return f*hb},equals:function(f,h){return Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))}}),jb=Object.freeze({__proto__:null,create:function(){var f=new U(4);U!=Float32Array&&(f[1]=0,f[2]=0);f[0]=1;f[3]=1;return f},clone:function(f){var h=new U(4);h[0]=f[0];h[1]=f[1];h[2]=f[2];h[3]=f[3];return h},copy:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[3];return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=1;return f},fromValues:function(f,h,m,q){var t=new U(4);
t[0]=f;t[1]=h;t[2]=m;t[3]=q;return t},set:function(f,h,m,q,t){f[0]=h;f[1]=m;f[2]=q;f[3]=t;return f},transpose:function(f,h){if(f===h){var m=h[1];f[1]=h[2];f[2]=m}else f[0]=h[0],f[1]=h[2],f[2]=h[1],f[3]=h[3];return f},invert:function(f,h){var m=h[0],q=h[1],t=h[2];h=h[3];var u=m*h-t*q;if(!u)return null;u=1/u;f[0]=h*u;f[1]=-q*u;f[2]=-t*u;f[3]=m*u;return f},adjoint:function(f,h){var m=h[0];f[0]=h[3];f[1]=-h[1];f[2]=-h[2];f[3]=m;return f},determinant:function(f){return f[0]*f[3]-f[2]*f[1]},multiply:b,
rotate:function(f,h,m){var q=h[0],t=h[1],u=h[2];h=h[3];var v=Math.sin(m);m=Math.cos(m);f[0]=q*m+u*v;f[1]=t*m+h*v;f[2]=q*-v+u*m;f[3]=t*-v+h*m;return f},scale:function(f,h,m){var q=h[1],t=h[2],u=h[3],v=m[0];m=m[1];f[0]=h[0]*v;f[1]=q*v;f[2]=t*m;f[3]=u*m;return f},fromRotation:function(f,h){var m=Math.sin(h);h=Math.cos(h);f[0]=h;f[1]=m;f[2]=-m;f[3]=h;return f},fromScaling:function(f,h){f[0]=h[0];f[1]=0;f[2]=0;f[3]=h[1];return f},str:function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},frob:function(f){return Math.hypot(f[0],
f[1],f[2],f[3])},LDU:function(f,h,m,q){f[2]=q[2]/q[0];m[0]=q[0];m[1]=q[1];m[3]=q[3]-f[2]*m[1];return[f,h,m]},add:function(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];f[3]=h[3]+m[3];return f},subtract:d,exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]&&f[3]===h[3]},equals:function(f,h){var m=f[0],q=f[1],t=f[2];f=f[3];var u=h[0],v=h[1],x=h[2];h=h[3];return Math.abs(m-u)<=1E-6*Math.max(1,Math.abs(m),Math.abs(u))&&Math.abs(q-v)<=1E-6*Math.max(1,Math.abs(q),Math.abs(v))&&
Math.abs(t-x)<=1E-6*Math.max(1,Math.abs(t),Math.abs(x))&&Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},multiplyScalar:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;f[3]=h[3]*m;return f},multiplyScalarAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;f[2]=h[2]+m[2]*q;f[3]=h[3]+m[3]*q;return f},mul:b,sub:d}),kb=Object.freeze({__proto__:null,create:function(){var f=new U(6);U!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0);f[0]=1;f[3]=1;return f},clone:function(f){var h=new U(6);
h[0]=f[0];h[1]=f[1];h[2]=f[2];h[3]=f[3];h[4]=f[4];h[5]=f[5];return h},copy:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[3];f[4]=h[4];f[5]=h[5];return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=1;f[4]=0;f[5]=0;return f},fromValues:function(f,h,m,q,t,u){var v=new U(6);v[0]=f;v[1]=h;v[2]=m;v[3]=q;v[4]=t;v[5]=u;return v},set:function(f,h,m,q,t,u,v){f[0]=h;f[1]=m;f[2]=q;f[3]=t;f[4]=u;f[5]=v;return f},invert:function(f,h){var m=h[0],q=h[1],t=h[2],u=h[3],v=h[4];h=h[5];var x=m*u-q*t;if(!x)return null;
x=1/x;f[0]=u*x;f[1]=-q*x;f[2]=-t*x;f[3]=m*x;f[4]=(t*h-u*v)*x;f[5]=(q*v-m*h)*x;return f},determinant:function(f){return f[0]*f[3]-f[1]*f[2]},multiply:c,rotate:function(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=h[4];h=h[5];var y=Math.sin(m);m=Math.cos(m);f[0]=q*m+u*y;f[1]=t*m+v*y;f[2]=q*-y+u*m;f[3]=t*-y+v*m;f[4]=x;f[5]=h;return f},scale:function(f,h,m){var q=h[1],t=h[2],u=h[3],v=h[4],x=h[5],y=m[0];m=m[1];f[0]=h[0]*y;f[1]=q*y;f[2]=t*m;f[3]=u*m;f[4]=v;f[5]=x;return f},translate:function(f,h,m){var q=h[0],
t=h[1],u=h[2],v=h[3],x=h[4];h=h[5];var y=m[0];m=m[1];f[0]=q;f[1]=t;f[2]=u;f[3]=v;f[4]=q*y+u*m+x;f[5]=t*y+v*m+h;return f},fromRotation:function(f,h){var m=Math.sin(h);h=Math.cos(h);f[0]=h;f[1]=m;f[2]=-m;f[3]=h;f[4]=0;f[5]=0;return f},fromScaling:function(f,h){f[0]=h[0];f[1]=0;f[2]=0;f[3]=h[1];f[4]=0;f[5]=0;return f},fromTranslation:function(f,h){f[0]=1;f[1]=0;f[2]=0;f[3]=1;f[4]=h[0];f[5]=h[1];return f},str:function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},frob:function(f){return Math.hypot(f[0],
f[1],f[2],f[3],f[4],f[5],1)},add:function(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];f[3]=h[3]+m[3];f[4]=h[4]+m[4];f[5]=h[5]+m[5];return f},subtract:e,multiplyScalar:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;f[3]=h[3]*m;f[4]=h[4]*m;f[5]=h[5]*m;return f},multiplyScalarAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;f[2]=h[2]+m[2]*q;f[3]=h[3]+m[3]*q;f[4]=h[4]+m[4]*q;f[5]=h[5]+m[5]*q;return f},exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]&&f[3]===
h[3]&&f[4]===h[4]&&f[5]===h[5]},equals:function(f,h){var m=f[0],q=f[1],t=f[2],u=f[3],v=f[4];f=f[5];var x=h[0],y=h[1],A=h[2],D=h[3],G=h[4];h=h[5];return Math.abs(m-x)<=1E-6*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(q-y)<=1E-6*Math.max(1,Math.abs(q),Math.abs(y))&&Math.abs(t-A)<=1E-6*Math.max(1,Math.abs(t),Math.abs(A))&&Math.abs(u-D)<=1E-6*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(v-G)<=1E-6*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},mul:c,sub:e}),
lb=Object.freeze({__proto__:null,create:g,fromMat4:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[4];f[4]=h[5];f[5]=h[6];f[6]=h[8];f[7]=h[9];f[8]=h[10];return f},clone:function(f){var h=new U(9);h[0]=f[0];h[1]=f[1];h[2]=f[2];h[3]=f[3];h[4]=f[4];h[5]=f[5];h[6]=f[6];h[7]=f[7];h[8]=f[8];return h},copy:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[3];f[4]=h[4];f[5]=h[5];f[6]=h[6];f[7]=h[7];f[8]=h[8];return f},fromValues:function(f,h,m,q,t,u,v,x,y){var A=new U(9);A[0]=f;A[1]=h;A[2]=m;A[3]=q;A[4]=
t;A[5]=u;A[6]=v;A[7]=x;A[8]=y;return A},set:function(f,h,m,q,t,u,v,x,y,A){f[0]=h;f[1]=m;f[2]=q;f[3]=t;f[4]=u;f[5]=v;f[6]=x;f[7]=y;f[8]=A;return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=1;f[5]=0;f[6]=0;f[7]=0;f[8]=1;return f},transpose:function(f,h){if(f===h){var m=h[1],q=h[2],t=h[5];f[1]=h[3];f[2]=h[6];f[3]=m;f[5]=h[7];f[6]=q;f[7]=t}else f[0]=h[0],f[1]=h[3],f[2]=h[6],f[3]=h[1],f[4]=h[4],f[5]=h[7],f[6]=h[2],f[7]=h[5],f[8]=h[8];return f},invert:function(f,h){var m=h[0],q=h[1],t=h[2],
u=h[3],v=h[4],x=h[5],y=h[6],A=h[7];h=h[8];var D=h*v-x*A,G=-h*u+x*y,J=A*u-v*y,H=m*D+q*G+t*J;if(!H)return null;H=1/H;f[0]=D*H;f[1]=(-h*q+t*A)*H;f[2]=(x*q-t*v)*H;f[3]=G*H;f[4]=(h*m-t*y)*H;f[5]=(-x*m+t*u)*H;f[6]=J*H;f[7]=(-A*m+q*y)*H;f[8]=(v*m-q*u)*H;return f},adjoint:function(f,h){var m=h[0],q=h[1],t=h[2],u=h[3],v=h[4],x=h[5],y=h[6],A=h[7];h=h[8];f[0]=v*h-x*A;f[1]=t*A-q*h;f[2]=q*x-t*v;f[3]=x*y-u*h;f[4]=m*h-t*y;f[5]=t*u-m*x;f[6]=u*A-v*y;f[7]=q*y-m*A;f[8]=m*v-q*u;return f},determinant:function(f){var h=
f[3],m=f[4],q=f[5],t=f[6],u=f[7],v=f[8];return f[0]*(v*m-q*u)+f[1]*(-v*h+q*t)+f[2]*(u*h-m*t)},multiply:k,translate:function(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7];h=h[8];var G=m[0];m=m[1];f[0]=q;f[1]=t;f[2]=u;f[3]=v;f[4]=x;f[5]=y;f[6]=G*q+m*v+A;f[7]=G*t+m*x+D;f[8]=G*u+m*y+h;return f},rotate:function(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7];h=h[8];var G=Math.sin(m);m=Math.cos(m);f[0]=m*q+G*v;f[1]=m*t+G*x;f[2]=m*u+G*y;f[3]=m*v-G*q;f[4]=m*x-G*t;f[5]=
m*y-G*u;f[6]=A;f[7]=D;f[8]=h;return f},scale:function(f,h,m){var q=m[0];m=m[1];f[0]=q*h[0];f[1]=q*h[1];f[2]=q*h[2];f[3]=m*h[3];f[4]=m*h[4];f[5]=m*h[5];f[6]=h[6];f[7]=h[7];f[8]=h[8];return f},fromTranslation:function(f,h){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=1;f[5]=0;f[6]=h[0];f[7]=h[1];f[8]=1;return f},fromRotation:function(f,h){var m=Math.sin(h);h=Math.cos(h);f[0]=h;f[1]=m;f[2]=0;f[3]=-m;f[4]=h;f[5]=0;f[6]=0;f[7]=0;f[8]=1;return f},fromScaling:function(f,h){f[0]=h[0];f[1]=0;f[2]=0;f[3]=0;f[4]=h[1];f[5]=
0;f[6]=0;f[7]=0;f[8]=1;return f},fromMat2d:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=0;f[3]=h[2];f[4]=h[3];f[5]=0;f[6]=h[4];f[7]=h[5];f[8]=1;return f},fromQuat:function(f,h){var m=h[0],q=h[1],t=h[2];h=h[3];var u=m+m,v=q+q,x=t+t;m*=u;var y=q*u;q*=v;var A=t*u,D=t*v;t*=x;u*=h;v*=h;h*=x;f[0]=1-q-t;f[3]=y-h;f[6]=A+v;f[1]=y+h;f[4]=1-m-t;f[7]=D-u;f[2]=A-v;f[5]=D+u;f[8]=1-m-q;return f},normalFromMat4:function(f,h){var m=h[0],q=h[1],t=h[2],u=h[3],v=h[4],x=h[5],y=h[6],A=h[7],D=h[8],G=h[9],J=h[10],H=h[11],M=h[12],
N=h[13],L=h[14];h=h[15];var Q=m*x-q*v,P=m*y-t*v,S=m*A-u*v,T=q*y-t*x,R=q*A-u*x,X=t*A-u*y,Y=D*N-G*M,Z=D*L-J*M;D=D*h-H*M;var aa=G*L-J*N;G=G*h-H*N;J=J*h-H*L;H=Q*J-P*G+S*aa+T*D-R*Z+X*Y;if(!H)return null;H=1/H;f[0]=(x*J-y*G+A*aa)*H;f[1]=(y*D-v*J-A*Z)*H;f[2]=(v*G-x*D+A*Y)*H;f[3]=(t*G-q*J-u*aa)*H;f[4]=(m*J-t*D+u*Z)*H;f[5]=(q*D-m*G-u*Y)*H;f[6]=(N*X-L*R+h*T)*H;f[7]=(L*S-M*X-h*P)*H;f[8]=(M*R-N*S+h*Q)*H;return f},projection:function(f,h,m){f[0]=2/h;f[1]=0;f[2]=0;f[3]=0;f[4]=-2/m;f[5]=0;f[6]=-1;f[7]=1;f[8]=1;
return f},str:function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},frob:function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},add:function(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];f[3]=h[3]+m[3];f[4]=h[4]+m[4];f[5]=h[5]+m[5];f[6]=h[6]+m[6];f[7]=h[7]+m[7];f[8]=h[8]+m[8];return f},subtract:l,multiplyScalar:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;f[3]=h[3]*m;f[4]=h[4]*m;f[5]=h[5]*m;f[6]=h[6]*
m;f[7]=h[7]*m;f[8]=h[8]*m;return f},multiplyScalarAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;f[2]=h[2]+m[2]*q;f[3]=h[3]+m[3]*q;f[4]=h[4]+m[4]*q;f[5]=h[5]+m[5]*q;f[6]=h[6]+m[6]*q;f[7]=h[7]+m[7]*q;f[8]=h[8]+m[8]*q;return f},exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]&&f[3]===h[3]&&f[4]===h[4]&&f[5]===h[5]&&f[6]===h[6]&&f[7]===h[7]&&f[8]===h[8]},equals:function(f,h){var m=f[0],q=f[1],t=f[2],u=f[3],v=f[4],x=f[5],y=f[6],A=f[7];f=f[8];var D=h[0],G=h[1],J=h[2],
H=h[3],M=h[4],N=h[5],L=h[6],Q=h[7];h=h[8];return Math.abs(m-D)<=1E-6*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(q-G)<=1E-6*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(t-J)<=1E-6*Math.max(1,Math.abs(t),Math.abs(J))&&Math.abs(u-H)<=1E-6*Math.max(1,Math.abs(u),Math.abs(H))&&Math.abs(v-M)<=1E-6*Math.max(1,Math.abs(v),Math.abs(M))&&Math.abs(x-N)<=1E-6*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(y-L)<=1E-6*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(A-Q)<=1E-6*Math.max(1,Math.abs(A),Math.abs(Q))&&
Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},mul:k,sub:l}),mb=Object.freeze({__proto__:null,create:function(){var f=new U(16);U!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0);f[0]=1;f[5]=1;f[10]=1;f[15]=1;return f},clone:function(f){var h=new U(16);h[0]=f[0];h[1]=f[1];h[2]=f[2];h[3]=f[3];h[4]=f[4];h[5]=f[5];h[6]=f[6];h[7]=f[7];h[8]=f[8];h[9]=f[9];h[10]=f[10];h[11]=f[11];h[12]=f[12];h[13]=f[13];h[14]=f[14];h[15]=f[15];return h},
copy:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[3];f[4]=h[4];f[5]=h[5];f[6]=h[6];f[7]=h[7];f[8]=h[8];f[9]=h[9];f[10]=h[10];f[11]=h[11];f[12]=h[12];f[13]=h[13];f[14]=h[14];f[15]=h[15];return f},fromValues:function(f,h,m,q,t,u,v,x,y,A,D,G,J,H,M,N){var L=new U(16);L[0]=f;L[1]=h;L[2]=m;L[3]=q;L[4]=t;L[5]=u;L[6]=v;L[7]=x;L[8]=y;L[9]=A;L[10]=D;L[11]=G;L[12]=J;L[13]=H;L[14]=M;L[15]=N;return L},set:function(f,h,m,q,t,u,v,x,y,A,D,G,J,H,M,N,L){f[0]=h;f[1]=m;f[2]=q;f[3]=t;f[4]=u;f[5]=v;f[6]=x;f[7]=y;
f[8]=A;f[9]=D;f[10]=G;f[11]=J;f[12]=H;f[13]=M;f[14]=N;f[15]=L;return f},identity:n,transpose:function(f,h){if(f===h){var m=h[1],q=h[2],t=h[3],u=h[6],v=h[7],x=h[11];f[1]=h[4];f[2]=h[8];f[3]=h[12];f[4]=m;f[6]=h[9];f[7]=h[13];f[8]=q;f[9]=u;f[11]=h[14];f[12]=t;f[13]=v;f[14]=x}else f[0]=h[0],f[1]=h[4],f[2]=h[8],f[3]=h[12],f[4]=h[1],f[5]=h[5],f[6]=h[9],f[7]=h[13],f[8]=h[2],f[9]=h[6],f[10]=h[10],f[11]=h[14],f[12]=h[3],f[13]=h[7],f[14]=h[11],f[15]=h[15];return f},invert:function(f,h){var m=h[0],q=h[1],t=
h[2],u=h[3],v=h[4],x=h[5],y=h[6],A=h[7],D=h[8],G=h[9],J=h[10],H=h[11],M=h[12],N=h[13],L=h[14];h=h[15];var Q=m*x-q*v,P=m*y-t*v,S=m*A-u*v,T=q*y-t*x,R=q*A-u*x,X=t*A-u*y,Y=D*N-G*M,Z=D*L-J*M,aa=D*h-H*M,da=G*L-J*N,ea=G*h-H*N,fa=J*h-H*L,ba=Q*fa-P*ea+S*da+T*aa-R*Z+X*Y;if(!ba)return null;ba=1/ba;f[0]=(x*fa-y*ea+A*da)*ba;f[1]=(t*ea-q*fa-u*da)*ba;f[2]=(N*X-L*R+h*T)*ba;f[3]=(J*R-G*X-H*T)*ba;f[4]=(y*aa-v*fa-A*Z)*ba;f[5]=(m*fa-t*aa+u*Z)*ba;f[6]=(L*S-M*X-h*P)*ba;f[7]=(D*X-J*S+H*P)*ba;f[8]=(v*ea-x*aa+A*Y)*ba;f[9]=
(q*aa-m*ea-u*Y)*ba;f[10]=(M*R-N*S+h*Q)*ba;f[11]=(G*S-D*R-H*Q)*ba;f[12]=(x*Z-v*da-y*Y)*ba;f[13]=(m*da-q*Z+t*Y)*ba;f[14]=(N*P-M*T-L*Q)*ba;f[15]=(D*T-G*P+J*Q)*ba;return f},adjoint:function(f,h){var m=h[0],q=h[1],t=h[2],u=h[3],v=h[4],x=h[5],y=h[6],A=h[7],D=h[8],G=h[9],J=h[10],H=h[11],M=h[12],N=h[13],L=h[14];h=h[15];var Q=m*x-q*v,P=m*y-t*v,S=m*A-u*v,T=q*y-t*x,R=q*A-u*x,X=t*A-u*y,Y=D*N-G*M,Z=D*L-J*M,aa=D*h-H*M,da=G*L-J*N,ea=G*h-H*N,fa=J*h-H*L;f[0]=x*fa-y*ea+A*da;f[1]=t*ea-q*fa-u*da;f[2]=N*X-L*R+h*T;f[3]=
J*R-G*X-H*T;f[4]=y*aa-v*fa-A*Z;f[5]=m*fa-t*aa+u*Z;f[6]=L*S-M*X-h*P;f[7]=D*X-J*S+H*P;f[8]=v*ea-x*aa+A*Y;f[9]=q*aa-m*ea-u*Y;f[10]=M*R-N*S+h*Q;f[11]=G*S-D*R-H*Q;f[12]=x*Z-v*da-y*Y;f[13]=m*da-q*Z+t*Y;f[14]=N*P-M*T-L*Q;f[15]=D*T-G*P+J*Q;return f},determinant:function(f){var h=f[0],m=f[1],q=f[2],t=f[4],u=f[5],v=f[6],x=f[8],y=f[9],A=f[10],D=f[12],G=f[13],J=f[14],H=h*u-m*t,M=h*v-q*t,N=m*v-q*u,L=x*G-y*D,Q=x*J-A*D,P=y*J-A*G;return f[7]*(h*P-m*Q+q*L)-f[3]*(t*P-u*Q+v*L)+f[15]*(x*N-y*M+A*H)-f[11]*(D*N-G*M+J*H)},
multiply:p,translate:function(f,h,m){var q=m[0],t=m[1];m=m[2];if(h===f)f[12]=h[0]*q+h[4]*t+h[8]*m+h[12],f[13]=h[1]*q+h[5]*t+h[9]*m+h[13],f[14]=h[2]*q+h[6]*t+h[10]*m+h[14],f[15]=h[3]*q+h[7]*t+h[11]*m+h[15];else{var u=h[0];var v=h[1];var x=h[2];var y=h[3];var A=h[4];var D=h[5];var G=h[6];var J=h[7];var H=h[8];var M=h[9];var N=h[10];var L=h[11];f[0]=u;f[1]=v;f[2]=x;f[3]=y;f[4]=A;f[5]=D;f[6]=G;f[7]=J;f[8]=H;f[9]=M;f[10]=N;f[11]=L;f[12]=u*q+A*t+H*m+h[12];f[13]=v*q+D*t+M*m+h[13];f[14]=x*q+G*t+N*m+h[14];
f[15]=y*q+J*t+L*m+h[15]}return f},scale:function(f,h,m){var q=m[0],t=m[1];m=m[2];f[0]=h[0]*q;f[1]=h[1]*q;f[2]=h[2]*q;f[3]=h[3]*q;f[4]=h[4]*t;f[5]=h[5]*t;f[6]=h[6]*t;f[7]=h[7]*t;f[8]=h[8]*m;f[9]=h[9]*m;f[10]=h[10]*m;f[11]=h[11]*m;f[12]=h[12];f[13]=h[13];f[14]=h[14];f[15]=h[15];return f},rotate:function(f,h,m,q){var t=q[0],u=q[1];q=q[2];var v=Math.hypot(t,u,q);if(1E-6>v)return null;v=1/v;t*=v;u*=v;q*=v;var x=Math.sin(m);var y=Math.cos(m);var A=1-y;m=h[0];v=h[1];var D=h[2];var G=h[3];var J=h[4];var H=
h[5];var M=h[6];var N=h[7];var L=h[8];var Q=h[9];var P=h[10];var S=h[11];var T=t*t*A+y;var R=u*t*A+q*x;var X=q*t*A-u*x;var Y=t*u*A-q*x;var Z=u*u*A+y;var aa=q*u*A+t*x;var da=t*q*A+u*x;t=u*q*A-t*x;u=q*q*A+y;f[0]=m*T+J*R+L*X;f[1]=v*T+H*R+Q*X;f[2]=D*T+M*R+P*X;f[3]=G*T+N*R+S*X;f[4]=m*Y+J*Z+L*aa;f[5]=v*Y+H*Z+Q*aa;f[6]=D*Y+M*Z+P*aa;f[7]=G*Y+N*Z+S*aa;f[8]=m*da+J*t+L*u;f[9]=v*da+H*t+Q*u;f[10]=D*da+M*t+P*u;f[11]=G*da+N*t+S*u;h!==f&&(f[12]=h[12],f[13]=h[13],f[14]=h[14],f[15]=h[15]);return f},rotateX:function(f,
h,m){var q=Math.sin(m);m=Math.cos(m);var t=h[4],u=h[5],v=h[6],x=h[7],y=h[8],A=h[9],D=h[10],G=h[11];h!==f&&(f[0]=h[0],f[1]=h[1],f[2]=h[2],f[3]=h[3],f[12]=h[12],f[13]=h[13],f[14]=h[14],f[15]=h[15]);f[4]=t*m+y*q;f[5]=u*m+A*q;f[6]=v*m+D*q;f[7]=x*m+G*q;f[8]=y*m-t*q;f[9]=A*m-u*q;f[10]=D*m-v*q;f[11]=G*m-x*q;return f},rotateY:function(f,h,m){var q=Math.sin(m);m=Math.cos(m);var t=h[0],u=h[1],v=h[2],x=h[3],y=h[8],A=h[9],D=h[10],G=h[11];h!==f&&(f[4]=h[4],f[5]=h[5],f[6]=h[6],f[7]=h[7],f[12]=h[12],f[13]=h[13],
f[14]=h[14],f[15]=h[15]);f[0]=t*m-y*q;f[1]=u*m-A*q;f[2]=v*m-D*q;f[3]=x*m-G*q;f[8]=t*q+y*m;f[9]=u*q+A*m;f[10]=v*q+D*m;f[11]=x*q+G*m;return f},rotateZ:function(f,h,m){var q=Math.sin(m);m=Math.cos(m);var t=h[0],u=h[1],v=h[2],x=h[3],y=h[4],A=h[5],D=h[6],G=h[7];h!==f&&(f[8]=h[8],f[9]=h[9],f[10]=h[10],f[11]=h[11],f[12]=h[12],f[13]=h[13],f[14]=h[14],f[15]=h[15]);f[0]=t*m+y*q;f[1]=u*m+A*q;f[2]=v*m+D*q;f[3]=x*m+G*q;f[4]=y*m-t*q;f[5]=A*m-u*q;f[6]=D*m-v*q;f[7]=G*m-x*q;return f},fromTranslation:function(f,h){f[0]=
1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=h[0];f[13]=h[1];f[14]=h[2];f[15]=1;return f},fromScaling:function(f,h){f[0]=h[0];f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=h[1];f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=h[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},fromRotation:function(f,h,m){var q=m[0],t=m[1];m=m[2];var u=Math.hypot(q,t,m);if(1E-6>u)return null;u=1/u;q*=u;t*=u;m*=u;u=Math.sin(h);h=Math.cos(h);var v=1-h;f[0]=q*q*v+h;f[1]=t*q*v+m*u;f[2]=m*q*v-t*u;f[3]=
0;f[4]=q*t*v-m*u;f[5]=t*t*v+h;f[6]=m*t*v+q*u;f[7]=0;f[8]=q*m*v+t*u;f[9]=t*m*v-q*u;f[10]=m*m*v+h;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},fromXRotation:function(f,h){var m=Math.sin(h);h=Math.cos(h);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=h;f[6]=m;f[7]=0;f[8]=0;f[9]=-m;f[10]=h;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},fromYRotation:function(f,h){var m=Math.sin(h);h=Math.cos(h);f[0]=h;f[1]=0;f[2]=-m;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=m;f[9]=0;f[10]=h;f[11]=0;f[12]=0;f[13]=0;f[14]=
0;f[15]=1;return f},fromZRotation:function(f,h){var m=Math.sin(h);h=Math.cos(h);f[0]=h;f[1]=m;f[2]=0;f[3]=0;f[4]=-m;f[5]=h;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},fromRotationTranslation:r,fromQuat2:function(f,h){var m=new U(3),q=-h[0],t=-h[1],u=-h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7],G=q*q+t*t+u*u+v*v;0<G?(m[0]=2*(x*v+D*q+y*u-A*t)/G,m[1]=2*(y*v+D*t+A*q-x*u)/G,m[2]=2*(A*v+D*u+x*t-y*q)/G):(m[0]=2*(x*v+D*q+y*u-A*t),m[1]=2*(y*v+D*t+A*q-x*u),m[2]=2*(A*v+
D*u+x*t-y*q));r(f,h,m);return f},getTranslation:w,getScaling:z,getRotation:B,decompose:function(f,h,m,q){h[0]=q[12];h[1]=q[13];h[2]=q[14];var t=q[0],u=q[1],v=q[2],x=q[4],y=q[5],A=q[6],D=q[8];h=q[9];q=q[10];m[0]=Math.hypot(t,u,v);m[1]=Math.hypot(x,y,A);m[2]=Math.hypot(D,h,q);var G=1/m[0],J=1/m[1],H=1/m[2];m=t*G;u*=J;v*=H;x*=G;y*=J;A*=H;D*=G;h*=J;q*=H;J=m+y+q;0<J?(q=2*Math.sqrt(J+1),f[3]=.25*q,f[0]=(A-h)/q,f[1]=(D-v)/q,f[2]=(u-x)/q):m>y&&m>q?(q=2*Math.sqrt(1+m-y-q),f[3]=(A-h)/q,f[0]=.25*q,f[1]=(u+x)/
q,f[2]=(D+v)/q):y>q?(q=2*Math.sqrt(1+y-m-q),f[3]=(D-v)/q,f[0]=(u+x)/q,f[1]=.25*q,f[2]=(A+h)/q):(q=2*Math.sqrt(1+q-m-y),f[3]=(u-x)/q,f[0]=(D+v)/q,f[1]=(A+h)/q,f[2]=.25*q);return f},fromRotationTranslationScale:function(f,h,m,q){var t=h[0],u=h[1],v=h[2],x=h[3],y=t+t,A=u+u,D=v+v;h=t*y;var G=t*A;t*=D;var J=u*A;u*=D;v*=D;y*=x;A*=x;x*=D;D=q[0];var H=q[1];q=q[2];f[0]=(1-(J+v))*D;f[1]=(G+x)*D;f[2]=(t-A)*D;f[3]=0;f[4]=(G-x)*H;f[5]=(1-(h+v))*H;f[6]=(u+y)*H;f[7]=0;f[8]=(t+A)*q;f[9]=(u-y)*q;f[10]=(1-(h+J))*q;
f[11]=0;f[12]=m[0];f[13]=m[1];f[14]=m[2];f[15]=1;return f},fromRotationTranslationScaleOrigin:function(f,h,m,q,t){var u=h[0],v=h[1],x=h[2],y=h[3],A=u+u,D=v+v,G=x+x;h=u*A;var J=u*D,H=u*G;u=v*D;v*=G;var M=x*G;x=y*A;D*=y;var N=y*G,L=q[0],Q=q[1];G=q[2];q=t[0];y=t[1];t=t[2];A=(1-(u+M))*L;var P=(J+N)*L;L*=H-D;J=(J-N)*Q;M=(1-(h+M))*Q;Q*=v+x;H=(H+D)*G;v=(v-x)*G;h=(1-(h+u))*G;f[0]=A;f[1]=P;f[2]=L;f[3]=0;f[4]=J;f[5]=M;f[6]=Q;f[7]=0;f[8]=H;f[9]=v;f[10]=h;f[11]=0;f[12]=m[0]+q-(A*q+J*y+H*t);f[13]=m[1]+y-(P*q+
M*y+v*t);f[14]=m[2]+t-(L*q+Q*y+h*t);f[15]=1;return f},fromQuat:function(f,h){var m=h[0],q=h[1],t=h[2];h=h[3];var u=m+m,v=q+q,x=t+t;m*=u;var y=q*u;q*=v;var A=t*u,D=t*v;t*=x;u*=h;v*=h;h*=x;f[0]=1-q-t;f[1]=y+h;f[2]=A-v;f[3]=0;f[4]=y-h;f[5]=1-m-t;f[6]=D+u;f[7]=0;f[8]=A+v;f[9]=D-u;f[10]=1-m-q;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},frustum:function(f,h,m,q,t,u,v){var x=1/(m-h),y=1/(t-q),A=1/(u-v);f[0]=2*u*x;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*u*y;f[6]=0;f[7]=0;f[8]=(m+h)*x;f[9]=(t+q)*y;f[10]=
(v+u)*A;f[11]=-1;f[12]=0;f[13]=0;f[14]=v*u*2*A;f[15]=0;return f},perspectiveNO:C,perspective:C,perspectiveZO:function(f,h,m,q,t){h=1/Math.tan(h/2);f[0]=h/m;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=h;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[11]=-1;f[12]=0;f[13]=0;f[15]=0;null!=t&&Infinity!==t?(m=1/(q-t),f[10]=t*m,f[14]=t*q*m):(f[10]=-1,f[14]=-q);return f},perspectiveFromFieldOfView:function(f,h,m,q){var t=Math.tan(h.upDegrees*Math.PI/180),u=Math.tan(h.downDegrees*Math.PI/180),v=Math.tan(h.leftDegrees*Math.PI/180);h=
Math.tan(h.rightDegrees*Math.PI/180);var x=2/(v+h),y=2/(t+u);f[0]=x;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=y;f[6]=0;f[7]=0;f[8]=-((v-h)*x*.5);f[9]=(t-u)*y*.5;f[10]=q/(m-q);f[11]=-1;f[12]=0;f[13]=0;f[14]=q*m/(m-q);f[15]=0;return f},orthoNO:E,ortho:E,orthoZO:function(f,h,m,q,t,u,v){var x=1/(h-m),y=1/(q-t);v=1/(u-v);f[0]=-2*x;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*y;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=v;f[11]=0;f[12]=(h+m)*x;f[13]=(t+q)*y;f[14]=u*v;f[15]=1;return f},lookAt:function(f,h,m,q){var t=h[0],u=h[1];h=
h[2];var v=q[0];var x=q[1];var y=q[2];var A=m[0];q=m[1];var D=m[2];if(1E-6>Math.abs(t-A)&&1E-6>Math.abs(u-q)&&1E-6>Math.abs(h-D))return n(f);m=t-A;q=u-q;A=h-D;var G=1/Math.hypot(m,q,A);m*=G;q*=G;A*=G;D=x*A-y*q;y=y*m-v*A;v=v*q-x*m;(G=Math.hypot(D,y,v))?(G=1/G,D*=G,y*=G,v*=G):v=y=D=0;x=q*v-A*y;var J=A*D-m*v;var H=m*y-q*D;(G=Math.hypot(x,J,H))?(G=1/G,x*=G,J*=G,H*=G):H=J=x=0;f[0]=D;f[1]=x;f[2]=m;f[3]=0;f[4]=y;f[5]=J;f[6]=q;f[7]=0;f[8]=v;f[9]=H;f[10]=A;f[11]=0;f[12]=-(D*t+y*u+v*h);f[13]=-(x*t+J*u+H*h);
f[14]=-(m*t+q*u+A*h);f[15]=1;return f},targetTo:function(f,h,m,q){var t=h[0],u=h[1];h=h[2];var v=q[0],x=q[1],y=q[2];q=t-m[0];var A=u-m[1];m=h-m[2];var D=q*q+A*A+m*m;0<D&&(D=1/Math.sqrt(D),q*=D,A*=D,m*=D);var G=x*m-y*A;y=y*q-v*m;v=v*A-x*q;D=G*G+y*y+v*v;0<D&&(D=1/Math.sqrt(D),G*=D,y*=D,v*=D);f[0]=G;f[1]=y;f[2]=v;f[3]=0;f[4]=A*v-m*y;f[5]=m*G-q*v;f[6]=q*y-A*G;f[7]=0;f[8]=q;f[9]=A;f[10]=m;f[11]=0;f[12]=t;f[13]=u;f[14]=h;f[15]=1;return f},str:function(f){return"mat4("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+
", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+", "+f[9]+", "+f[10]+", "+f[11]+", "+f[12]+", "+f[13]+", "+f[14]+", "+f[15]+")"},frob:function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15])},add:function(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];f[3]=h[3]+m[3];f[4]=h[4]+m[4];f[5]=h[5]+m[5];f[6]=h[6]+m[6];f[7]=h[7]+m[7];f[8]=h[8]+m[8];f[9]=h[9]+m[9];f[10]=h[10]+m[10];f[11]=h[11]+m[11];f[12]=h[12]+m[12];f[13]=h[13]+m[13];f[14]=
h[14]+m[14];f[15]=h[15]+m[15];return f},subtract:F,multiplyScalar:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;f[3]=h[3]*m;f[4]=h[4]*m;f[5]=h[5]*m;f[6]=h[6]*m;f[7]=h[7]*m;f[8]=h[8]*m;f[9]=h[9]*m;f[10]=h[10]*m;f[11]=h[11]*m;f[12]=h[12]*m;f[13]=h[13]*m;f[14]=h[14]*m;f[15]=h[15]*m;return f},multiplyScalarAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;f[2]=h[2]+m[2]*q;f[3]=h[3]+m[3]*q;f[4]=h[4]+m[4]*q;f[5]=h[5]+m[5]*q;f[6]=h[6]+m[6]*q;f[7]=h[7]+m[7]*q;f[8]=h[8]+m[8]*q;f[9]=h[9]+m[9]*
q;f[10]=h[10]+m[10]*q;f[11]=h[11]+m[11]*q;f[12]=h[12]+m[12]*q;f[13]=h[13]+m[13]*q;f[14]=h[14]+m[14]*q;f[15]=h[15]+m[15]*q;return f},exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]&&f[3]===h[3]&&f[4]===h[4]&&f[5]===h[5]&&f[6]===h[6]&&f[7]===h[7]&&f[8]===h[8]&&f[9]===h[9]&&f[10]===h[10]&&f[11]===h[11]&&f[12]===h[12]&&f[13]===h[13]&&f[14]===h[14]&&f[15]===h[15]},equals:function(f,h){var m=f[0],q=f[1],t=f[2],u=f[3],v=f[4],x=f[5],y=f[6],A=f[7],D=f[8],G=f[9],J=f[10],H=f[11],M=f[12],
N=f[13],L=f[14];f=f[15];var Q=h[0],P=h[1],S=h[2],T=h[3],R=h[4],X=h[5],Y=h[6],Z=h[7],aa=h[8],da=h[9],ea=h[10],fa=h[11],ba=h[12],fb=h[13],gb=h[14];h=h[15];return Math.abs(m-Q)<=1E-6*Math.max(1,Math.abs(m),Math.abs(Q))&&Math.abs(q-P)<=1E-6*Math.max(1,Math.abs(q),Math.abs(P))&&Math.abs(t-S)<=1E-6*Math.max(1,Math.abs(t),Math.abs(S))&&Math.abs(u-T)<=1E-6*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(v-R)<=1E-6*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(x-X)<=1E-6*Math.max(1,Math.abs(x),Math.abs(X))&&
Math.abs(y-Y)<=1E-6*Math.max(1,Math.abs(y),Math.abs(Y))&&Math.abs(A-Z)<=1E-6*Math.max(1,Math.abs(A),Math.abs(Z))&&Math.abs(D-aa)<=1E-6*Math.max(1,Math.abs(D),Math.abs(aa))&&Math.abs(G-da)<=1E-6*Math.max(1,Math.abs(G),Math.abs(da))&&Math.abs(J-ea)<=1E-6*Math.max(1,Math.abs(J),Math.abs(ea))&&Math.abs(H-fa)<=1E-6*Math.max(1,Math.abs(H),Math.abs(fa))&&Math.abs(M-ba)<=1E-6*Math.max(1,Math.abs(M),Math.abs(ba))&&Math.abs(N-fb)<=1E-6*Math.max(1,Math.abs(N),Math.abs(fb))&&Math.abs(L-gb)<=1E-6*Math.max(1,Math.abs(L),
Math.abs(gb))&&Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},mul:p,sub:F}),va=function(){var f=I();return function(h,m,q,t,u,v){m||(m=3);q||(q=0);for(t=t?Math.min(t*m+q,h.length):h.length;q<t;q+=m)f[0]=h[q],f[1]=h[q+1],f[2]=h[q+2],u(f,f,v),h[q]=f[0],h[q+1]=f[1],h[q+2]=f[2];return h}}();va=Object.freeze({__proto__:null,create:I,clone:function(f){var h=new U(3);h[0]=f[0];h[1]=f[1];h[2]=f[2];return h},length:K,fromValues:O,copy:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];return f},set:function(f,
h,m,q){f[0]=h;f[1]=m;f[2]=q;return f},add:function(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];return f},subtract:V,multiply:W,divide:ca,ceil:function(f,h){f[0]=Math.ceil(h[0]);f[1]=Math.ceil(h[1]);f[2]=Math.ceil(h[2]);return f},floor:function(f,h){f[0]=Math.floor(h[0]);f[1]=Math.floor(h[1]);f[2]=Math.floor(h[2]);return f},min:function(f,h,m){f[0]=Math.min(h[0],m[0]);f[1]=Math.min(h[1],m[1]);f[2]=Math.min(h[2],m[2]);return f},max:function(f,h,m){f[0]=Math.max(h[0],m[0]);f[1]=Math.max(h[1],
m[1]);f[2]=Math.max(h[2],m[2]);return f},round:function(f,h){f[0]=Math.round(h[0]);f[1]=Math.round(h[1]);f[2]=Math.round(h[2]);return f},scale:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;return f},scaleAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;f[2]=h[2]+m[2]*q;return f},distance:la,squaredDistance:ma,squaredLength:za,negate:function(f,h){f[0]=-h[0];f[1]=-h[1];f[2]=-h[2];return f},inverse:function(f,h){f[0]=1/h[0];f[1]=1/h[1];f[2]=1/h[2];return f},normalize:Aa,dot:oa,cross:pa,
lerp:function(f,h,m,q){var t=h[0],u=h[1];h=h[2];f[0]=t+q*(m[0]-t);f[1]=u+q*(m[1]-u);f[2]=h+q*(m[2]-h);return f},slerp:function(f,h,m,q){var t=Math.acos(Math.min(Math.max(oa(h,m),-1),1)),u=Math.sin(t),v=Math.sin((1-q)*t)/u;q=Math.sin(q*t)/u;f[0]=v*h[0]+q*m[0];f[1]=v*h[1]+q*m[1];f[2]=v*h[2]+q*m[2];return f},hermite:function(f,h,m,q,t,u){var v=u*u,x=v*(2*u-3)+1,y=v*(u-2)+u,A=v*(u-1);u=v*(3-2*u);f[0]=h[0]*x+m[0]*y+q[0]*A+t[0]*u;f[1]=h[1]*x+m[1]*y+q[1]*A+t[1]*u;f[2]=h[2]*x+m[2]*y+q[2]*A+t[2]*u;return f},
bezier:function(f,h,m,q,t,u){var v=1-u,x=v*v,y=u*u,A=x*v;x*=3*u;v*=3*y;u*=y;f[0]=h[0]*A+m[0]*x+q[0]*v+t[0]*u;f[1]=h[1]*A+m[1]*x+q[1]*v+t[1]*u;f[2]=h[2]*A+m[2]*x+q[2]*v+t[2]*u;return f},random:function(f,h){h=h||1;var m=2*ha()*Math.PI,q=2*ha()-1,t=Math.sqrt(1-q*q)*h;f[0]=Math.cos(m)*t;f[1]=Math.sin(m)*t;f[2]=q*h;return f},transformMat4:function(f,h,m){var q=h[0],t=h[1];h=h[2];var u=m[3]*q+m[7]*t+m[11]*h+m[15];u=u||1;f[0]=(m[0]*q+m[4]*t+m[8]*h+m[12])/u;f[1]=(m[1]*q+m[5]*t+m[9]*h+m[13])/u;f[2]=(m[2]*
q+m[6]*t+m[10]*h+m[14])/u;return f},transformMat3:function(f,h,m){var q=h[0],t=h[1];h=h[2];f[0]=q*m[0]+t*m[3]+h*m[6];f[1]=q*m[1]+t*m[4]+h*m[7];f[2]=q*m[2]+t*m[5]+h*m[8];return f},transformQuat:function(f,h,m){var q=m[0],t=m[1],u=m[2],v=h[0],x=h[1];h=h[2];var y=t*h-u*x,A=u*v-q*h,D=q*x-t*v;m=2*m[3];f[0]=v+y*m+2*(t*D-u*A);f[1]=x+A*m+2*(u*y-q*D);f[2]=h+D*m+2*(q*A-t*y);return f},rotateX:function(f,h,m,q){var t=[],u=[];t[0]=h[0]-m[0];t[1]=h[1]-m[1];t[2]=h[2]-m[2];u[0]=t[0];u[1]=t[1]*Math.cos(q)-t[2]*Math.sin(q);
u[2]=t[1]*Math.sin(q)+t[2]*Math.cos(q);f[0]=u[0]+m[0];f[1]=u[1]+m[1];f[2]=u[2]+m[2];return f},rotateY:function(f,h,m,q){var t=[],u=[];t[0]=h[0]-m[0];t[1]=h[1]-m[1];t[2]=h[2]-m[2];u[0]=t[2]*Math.sin(q)+t[0]*Math.cos(q);u[1]=t[1];u[2]=t[2]*Math.cos(q)-t[0]*Math.sin(q);f[0]=u[0]+m[0];f[1]=u[1]+m[1];f[2]=u[2]+m[2];return f},rotateZ:function(f,h,m,q){var t=[],u=[];t[0]=h[0]-m[0];t[1]=h[1]-m[1];t[2]=h[2]-m[2];u[0]=t[0]*Math.cos(q)-t[1]*Math.sin(q);u[1]=t[0]*Math.sin(q)+t[1]*Math.cos(q);u[2]=t[2];f[0]=u[0]+
m[0];f[1]=u[1]+m[1];f[2]=u[2]+m[2];return f},angle:function(f,h){var m=f[0],q=f[1],t=f[2],u=h[0],v=h[1],x=h[2];f=(m=Math.sqrt((m*m+q*q+t*t)*(u*u+v*v+x*x)))&&oa(f,h)/m;return Math.acos(Math.min(Math.max(f,-1),1))},zero:function(f){f[0]=0;f[1]=0;f[2]=0;return f},str:function(f){return"vec3("+f[0]+", "+f[1]+", "+f[2]+")"},exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]},equals:function(f,h){var m=f[0],q=f[1];f=f[2];var t=h[0],u=h[1];h=h[2];return Math.abs(m-t)<=1E-6*Math.max(1,
Math.abs(m),Math.abs(t))&&Math.abs(q-u)<=1E-6*Math.max(1,Math.abs(q),Math.abs(u))&&Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},sub:V,mul:W,div:ca,dist:la,sqrDist:ma,len:K,sqrLen:za,forEach:va});var wa=function(){var f=Ba();return function(h,m,q,t,u,v){m||(m=4);q||(q=0);for(t=t?Math.min(t*m+q,h.length):h.length;q<t;q+=m)f[0]=h[q],f[1]=h[q+1],f[2]=h[q+2],f[3]=h[q+3],u(f,f,v),h[q]=f[0],h[q+1]=f[1],h[q+2]=f[2],h[q+3]=f[3];return h}}();wa=Object.freeze({__proto__:null,create:Ba,clone:Ca,fromValues:Da,
copy:qa,set:Ea,add:Fa,subtract:Ga,multiply:Ha,divide:Ia,ceil:function(f,h){f[0]=Math.ceil(h[0]);f[1]=Math.ceil(h[1]);f[2]=Math.ceil(h[2]);f[3]=Math.ceil(h[3]);return f},floor:function(f,h){f[0]=Math.floor(h[0]);f[1]=Math.floor(h[1]);f[2]=Math.floor(h[2]);f[3]=Math.floor(h[3]);return f},min:function(f,h,m){f[0]=Math.min(h[0],m[0]);f[1]=Math.min(h[1],m[1]);f[2]=Math.min(h[2],m[2]);f[3]=Math.min(h[3],m[3]);return f},max:function(f,h,m){f[0]=Math.max(h[0],m[0]);f[1]=Math.max(h[1],m[1]);f[2]=Math.max(h[2],
m[2]);f[3]=Math.max(h[3],m[3]);return f},round:function(f,h){f[0]=Math.round(h[0]);f[1]=Math.round(h[1]);f[2]=Math.round(h[2]);f[3]=Math.round(h[3]);return f},scale:ua,scaleAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;f[2]=h[2]+m[2]*q;f[3]=h[3]+m[3]*q;return f},distance:Ja,squaredDistance:Ka,length:ja,squaredLength:ia,negate:function(f,h){f[0]=-h[0];f[1]=-h[1];f[2]=-h[2];f[3]=-h[3];return f},inverse:function(f,h){f[0]=1/h[0];f[1]=1/h[1];f[2]=1/h[2];f[3]=1/h[3];return f},normalize:ra,
dot:ka,cross:function(f,h,m,q){var t=m[0]*q[1]-m[1]*q[0],u=m[0]*q[2]-m[2]*q[0],v=m[0]*q[3]-m[3]*q[0],x=m[1]*q[2]-m[2]*q[1],y=m[1]*q[3]-m[3]*q[1];m=m[2]*q[3]-m[3]*q[2];q=h[0];var A=h[1],D=h[2];h=h[3];f[0]=A*m-D*y+h*x;f[1]=-(q*m)+D*v-h*u;f[2]=q*y-A*v+h*t;f[3]=-(q*x)+A*u-D*t;return f},lerp:La,random:function(f,h){h=h||1;do{var m=2*ha()-1;var q=2*ha()-1;var t=m*m+q*q}while(1<=t);do{var u=2*ha()-1;var v=2*ha()-1;var x=u*u+v*v}while(1<=x);t=Math.sqrt((1-t)/x);f[0]=h*m;f[1]=h*q;f[2]=h*u*t;f[3]=h*v*t;return f},
transformMat4:function(f,h,m){var q=h[0],t=h[1],u=h[2];h=h[3];f[0]=m[0]*q+m[4]*t+m[8]*u+m[12]*h;f[1]=m[1]*q+m[5]*t+m[9]*u+m[13]*h;f[2]=m[2]*q+m[6]*t+m[10]*u+m[14]*h;f[3]=m[3]*q+m[7]*t+m[11]*u+m[15]*h;return f},transformQuat:function(f,h,m){var q=h[0],t=h[1],u=h[2],v=m[0],x=m[1],y=m[2];m=m[3];var A=m*q+x*u-y*t,D=m*t+y*q-v*u,G=m*u+v*t-x*q;q=-v*q-x*t-y*u;f[0]=A*m+q*-v+D*-y-G*-x;f[1]=D*m+q*-x+G*-v-A*-y;f[2]=G*m+q*-y+A*-x-D*-v;f[3]=h[3];return f},zero:function(f){f[0]=0;f[1]=0;f[2]=0;f[3]=0;return f},
str:function(f){return"vec4("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},exactEquals:Ma,equals:function(f,h){var m=f[0],q=f[1],t=f[2];f=f[3];var u=h[0],v=h[1],x=h[2];h=h[3];return Math.abs(m-u)<=1E-6*Math.max(1,Math.abs(m),Math.abs(u))&&Math.abs(q-v)<=1E-6*Math.max(1,Math.abs(q),Math.abs(v))&&Math.abs(t-x)<=1E-6*Math.max(1,Math.abs(t),Math.abs(x))&&Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},sub:Ga,mul:Ha,div:Ia,dist:Ja,sqrDist:Ka,len:ja,sqrLen:ia,forEach:wa});var xa=function(){var f=I(),
h=O(1,0,0),m=O(0,1,0);return function(q,t,u){var v=oa(t,u);if(-.999999>v)return pa(f,h,t),1E-6>K(f)&&pa(f,m,t),Aa(f,f),Na(q,f,Math.PI),q;if(.999999<v)return q[0]=0,q[1]=0,q[2]=0,q[3]=1,q;pa(f,t,u);q[0]=f[0];q[1]=f[1];q[2]=f[2];q[3]=1+v;return ra(q,q)}}(),ya=function(){var f=sa(),h=sa();return function(m,q,t,u,v,x){ta(f,q,v,x);ta(h,t,u,x);ta(m,f,h,2*x*(1-x));return m}}(),na=function(){var f=g();return function(h,m,q,t){f[0]=q[0];f[3]=q[1];f[6]=q[2];f[1]=t[0];f[4]=t[1];f[7]=t[2];f[2]=-m[0];f[5]=-m[1];
f[8]=-m[2];return ra(h,Ua(h,f))}}();xa=Object.freeze({__proto__:null,create:sa,identity:function(f){f[0]=0;f[1]=0;f[2]=0;f[3]=1;return f},setAxisAngle:Na,getAxisAngle:function(f,h){var m=2*Math.acos(h[3]),q=Math.sin(m/2);1E-6<q?(f[0]=h[0]/q,f[1]=h[1]/q,f[2]=h[2]/q):(f[0]=1,f[1]=0,f[2]=0);return m},getAngle:function(f,h){f=ka(f,h);return Math.acos(2*f*f-1)},multiply:Oa,rotateX:Pa,rotateY:Qa,rotateZ:Ra,calculateW:function(f,h){var m=h[0],q=h[1];h=h[2];f[0]=m;f[1]=q;f[2]=h;f[3]=Math.sqrt(Math.abs(1-
m*m-q*q-h*h));return f},exp:Sa,ln:Ta,pow:function(f,h,m){Ta(f,h);ua(f,f,m);Sa(f,f);return f},slerp:ta,random:function(f){var h=ha(),m=ha(),q=ha(),t=Math.sqrt(1-h);h=Math.sqrt(h);f[0]=t*Math.sin(2*Math.PI*m);f[1]=t*Math.cos(2*Math.PI*m);f[2]=h*Math.sin(2*Math.PI*q);f[3]=h*Math.cos(2*Math.PI*q);return f},invert:function(f,h){var m=h[0],q=h[1],t=h[2];h=h[3];var u=m*m+q*q+t*t+h*h;u=u?1/u:0;f[0]=-m*u;f[1]=-q*u;f[2]=-t*u;f[3]=h*u;return f},conjugate:function(f,h){f[0]=-h[0];f[1]=-h[1];f[2]=-h[2];f[3]=h[3];
return f},fromMat3:Ua,fromEuler:function(f,h,m,q){var t=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"zyx",u=Math.PI/360;h*=u;q*=u;m*=u;u=Math.sin(h);var v=Math.cos(h),x=Math.sin(m),y=Math.cos(m),A=Math.sin(q),D=Math.cos(q);switch(t){case "xyz":f[0]=u*y*D+v*x*A;f[1]=v*x*D-u*y*A;f[2]=v*y*A+u*x*D;f[3]=v*y*D-u*x*A;break;case "xzy":f[0]=u*y*D-v*x*A;f[1]=v*x*D-u*y*A;f[2]=v*y*A+u*x*D;f[3]=v*y*D+u*x*A;break;case "yxz":f[0]=u*y*D+v*x*A;f[1]=v*x*D-u*y*A;f[2]=v*y*A-u*x*D;f[3]=v*y*D+u*x*A;break;case "yzx":f[0]=
u*y*D+v*x*A;f[1]=v*x*D+u*y*A;f[2]=v*y*A-u*x*D;f[3]=v*y*D-u*x*A;break;case "zxy":f[0]=u*y*D-v*x*A;f[1]=v*x*D+u*y*A;f[2]=v*y*A+u*x*D;f[3]=v*y*D-u*x*A;break;case "zyx":f[0]=u*y*D-v*x*A;f[1]=v*x*D+u*y*A;f[2]=v*y*A-u*x*D;f[3]=v*y*D+u*x*A;break;default:throw Error("Unknown angle order "+t);}return f},str:function(f){return"quat("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},clone:Ca,fromValues:Da,copy:qa,set:Ea,add:Fa,mul:Oa,scale:ua,dot:ka,lerp:La,length:ja,len:ja,squaredLength:ia,sqrLen:ia,normalize:ra,exactEquals:Ma,
equals:function(f,h){return.999999<=Math.abs(ka(f,h))},rotationTo:xa,sqlerp:ya,setAxes:na});ya=Object.freeze({__proto__:null,create:function(){var f=new U(8);U!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0,f[4]=0,f[5]=0,f[6]=0,f[7]=0);f[3]=1;return f},clone:function(f){var h=new U(8);h[0]=f[0];h[1]=f[1];h[2]=f[2];h[3]=f[3];h[4]=f[4];h[5]=f[5];h[6]=f[6];h[7]=f[7];return h},fromValues:function(f,h,m,q,t,u,v,x){var y=new U(8);y[0]=f;y[1]=h;y[2]=m;y[3]=q;y[4]=t;y[5]=u;y[6]=v;y[7]=x;return y},fromRotationTranslationValues:function(f,
h,m,q,t,u,v){var x=new U(8);x[0]=f;x[1]=h;x[2]=m;x[3]=q;t*=.5;u*=.5;v*=.5;x[4]=t*q+u*m-v*h;x[5]=u*q+v*f-t*m;x[6]=v*q+t*h-u*f;x[7]=-t*f-u*h-v*m;return x},fromRotationTranslation:Va,fromTranslation:function(f,h){f[0]=0;f[1]=0;f[2]=0;f[3]=1;f[4]=.5*h[0];f[5]=.5*h[1];f[6]=.5*h[2];f[7]=0;return f},fromRotation:function(f,h){f[0]=h[0];f[1]=h[1];f[2]=h[2];f[3]=h[3];f[4]=0;f[5]=0;f[6]=0;f[7]=0;return f},fromMat4:function(f,h){var m=sa();B(m,h);var q=new U(3);w(q,h);Va(f,m,q);return f},copy:Wa,identity:function(f){f[0]=
0;f[1]=0;f[2]=0;f[3]=1;f[4]=0;f[5]=0;f[6]=0;f[7]=0;return f},set:function(f,h,m,q,t,u,v,x,y){f[0]=h;f[1]=m;f[2]=q;f[3]=t;f[4]=u;f[5]=v;f[6]=x;f[7]=y;return f},getReal:qa,getDual:function(f,h){f[0]=h[4];f[1]=h[5];f[2]=h[6];f[3]=h[7];return f},setReal:qa,setDual:function(f,h){f[4]=h[0];f[5]=h[1];f[6]=h[2];f[7]=h[3];return f},getTranslation:function(f,h){var m=h[4],q=h[5],t=h[6],u=h[7],v=-h[0],x=-h[1],y=-h[2];h=h[3];f[0]=2*(m*h+u*v+q*y-t*x);f[1]=2*(q*h+u*x+t*v-m*y);f[2]=2*(t*h+u*y+m*x-q*v);return f},
translate:function(f,h,m){var q=h[0],t=h[1],u=h[2],v=h[3],x=.5*m[0],y=.5*m[1];m=.5*m[2];var A=h[4],D=h[5],G=h[6];h=h[7];f[0]=q;f[1]=t;f[2]=u;f[3]=v;f[4]=v*x+t*m-u*y+A;f[5]=v*y+u*x-q*m+D;f[6]=v*m+q*y-t*x+G;f[7]=-q*x-t*y-u*m+h;return f},rotateX:function(f,h,m){var q=-h[0],t=-h[1],u=-h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7],G=x*v+D*q+y*u-A*t,J=y*v+D*t+A*q-x*u,H=A*v+D*u+x*t-y*q;x=D*v-x*q-y*t-A*u;Pa(f,h,m);q=f[0];t=f[1];u=f[2];v=f[3];f[4]=G*v+x*q+J*u-H*t;f[5]=J*v+x*t+H*q-G*u;f[6]=H*v+x*u+G*t-J*q;f[7]=x*
v-G*q-J*t-H*u;return f},rotateY:function(f,h,m){var q=-h[0],t=-h[1],u=-h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7],G=x*v+D*q+y*u-A*t,J=y*v+D*t+A*q-x*u,H=A*v+D*u+x*t-y*q;x=D*v-x*q-y*t-A*u;Qa(f,h,m);q=f[0];t=f[1];u=f[2];v=f[3];f[4]=G*v+x*q+J*u-H*t;f[5]=J*v+x*t+H*q-G*u;f[6]=H*v+x*u+G*t-J*q;f[7]=x*v-G*q-J*t-H*u;return f},rotateZ:function(f,h,m){var q=-h[0],t=-h[1],u=-h[2],v=h[3],x=h[4],y=h[5],A=h[6],D=h[7],G=x*v+D*q+y*u-A*t,J=y*v+D*t+A*q-x*u,H=A*v+D*u+x*t-y*q;x=D*v-x*q-y*t-A*u;Ra(f,h,m);q=f[0];t=f[1];u=f[2];
v=f[3];f[4]=G*v+x*q+J*u-H*t;f[5]=J*v+x*t+H*q-G*u;f[6]=H*v+x*u+G*t-J*q;f[7]=x*v-G*q-J*t-H*u;return f},rotateByQuatAppend:function(f,h,m){var q=m[0],t=m[1],u=m[2];m=m[3];var v=h[0],x=h[1],y=h[2],A=h[3];f[0]=v*m+A*q+x*u-y*t;f[1]=x*m+A*t+y*q-v*u;f[2]=y*m+A*u+v*t-x*q;f[3]=A*m-v*q-x*t-y*u;v=h[4];x=h[5];y=h[6];A=h[7];f[4]=v*m+A*q+x*u-y*t;f[5]=x*m+A*t+y*q-v*u;f[6]=y*m+A*u+v*t-x*q;f[7]=A*m-v*q-x*t-y*u;return f},rotateByQuatPrepend:function(f,h,m){var q=h[0],t=h[1],u=h[2];h=h[3];var v=m[0],x=m[1],y=m[2],A=
m[3];f[0]=q*A+h*v+t*y-u*x;f[1]=t*A+h*x+u*v-q*y;f[2]=u*A+h*y+q*x-t*v;f[3]=h*A-q*v-t*x-u*y;v=m[4];x=m[5];y=m[6];A=m[7];f[4]=q*A+h*v+t*y-u*x;f[5]=t*A+h*x+u*v-q*y;f[6]=u*A+h*y+q*x-t*v;f[7]=h*A-q*v-t*x-u*y;return f},rotateAroundAxis:function(f,h,m,q){if(1E-6>Math.abs(q))return Wa(f,h);var t=Math.hypot(m[0],m[1],m[2]);q*=.5;var u=Math.sin(q),v=u*m[0]/t,x=u*m[1]/t;m=u*m[2]/t;q=Math.cos(q);t=h[0];u=h[1];var y=h[2],A=h[3];f[0]=t*q+A*v+u*m-y*x;f[1]=u*q+A*x+y*v-t*m;f[2]=y*q+A*m+t*x-u*v;f[3]=A*q-t*v-u*x-y*m;
t=h[4];u=h[5];y=h[6];h=h[7];f[4]=t*q+h*v+u*m-y*x;f[5]=u*q+h*x+y*v-t*m;f[6]=y*q+h*m+t*x-u*v;f[7]=h*q-t*v-u*x-y*m;return f},add:function(f,h,m){f[0]=h[0]+m[0];f[1]=h[1]+m[1];f[2]=h[2]+m[2];f[3]=h[3]+m[3];f[4]=h[4]+m[4];f[5]=h[5]+m[5];f[6]=h[6]+m[6];f[7]=h[7]+m[7];return f},multiply:Xa,mul:Xa,scale:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;f[2]=h[2]*m;f[3]=h[3]*m;f[4]=h[4]*m;f[5]=h[5]*m;f[6]=h[6]*m;f[7]=h[7]*m;return f},dot:ka,lerp:function(f,h,m,q){var t=1-q;0>ka(h,m)&&(q=-q);f[0]=h[0]*t+m[0]*q;f[1]=
h[1]*t+m[1]*q;f[2]=h[2]*t+m[2]*q;f[3]=h[3]*t+m[3]*q;f[4]=h[4]*t+m[4]*q;f[5]=h[5]*t+m[5]*q;f[6]=h[6]*t+m[6]*q;f[7]=h[7]*t+m[7]*q;return f},invert:function(f,h){var m=ia(h);f[0]=-h[0]/m;f[1]=-h[1]/m;f[2]=-h[2]/m;f[3]=h[3]/m;f[4]=-h[4]/m;f[5]=-h[5]/m;f[6]=-h[6]/m;f[7]=h[7]/m;return f},conjugate:function(f,h){f[0]=-h[0];f[1]=-h[1];f[2]=-h[2];f[3]=h[3];f[4]=-h[4];f[5]=-h[5];f[6]=-h[6];f[7]=h[7];return f},length:ja,len:ja,squaredLength:ia,sqrLen:ia,normalize:function(f,h){var m=ia(h);if(0<m){m=Math.sqrt(m);
var q=h[0]/m,t=h[1]/m,u=h[2]/m,v=h[3]/m,x=h[4],y=h[5],A=h[6];h=h[7];var D=q*x+t*y+u*A+v*h;f[0]=q;f[1]=t;f[2]=u;f[3]=v;f[4]=(x-q*D)/m;f[5]=(y-t*D)/m;f[6]=(A-u*D)/m;f[7]=(h-v*D)/m}return f},str:function(f){return"quat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+")"},exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]&&f[2]===h[2]&&f[3]===h[3]&&f[4]===h[4]&&f[5]===h[5]&&f[6]===h[6]&&f[7]===h[7]},equals:function(f,h){var m=f[0],q=f[1],t=f[2],u=f[3],v=f[4],x=f[5],
y=f[6];f=f[7];var A=h[0],D=h[1],G=h[2],J=h[3],H=h[4],M=h[5],N=h[6];h=h[7];return Math.abs(m-A)<=1E-6*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(q-D)<=1E-6*Math.max(1,Math.abs(q),Math.abs(D))&&Math.abs(t-G)<=1E-6*Math.max(1,Math.abs(t),Math.abs(G))&&Math.abs(u-J)<=1E-6*Math.max(1,Math.abs(u),Math.abs(J))&&Math.abs(v-H)<=1E-6*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(x-M)<=1E-6*Math.max(1,Math.abs(x),Math.abs(M))&&Math.abs(y-N)<=1E-6*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(f-h)<=1E-6*Math.max(1,
Math.abs(f),Math.abs(h))}});na=function(){var f=Ya();return function(h,m,q,t,u,v){m||(m=2);q||(q=0);for(t=t?Math.min(t*m+q,h.length):h.length;q<t;q+=m)f[0]=h[q],f[1]=h[q+1],u(f,f,v),h[q]=f[0],h[q+1]=f[1];return h}}();na=Object.freeze({__proto__:null,create:Ya,clone:function(f){var h=new U(2);h[0]=f[0];h[1]=f[1];return h},fromValues:function(f,h){var m=new U(2);m[0]=f;m[1]=h;return m},copy:function(f,h){f[0]=h[0];f[1]=h[1];return f},set:function(f,h,m){f[0]=h;f[1]=m;return f},add:function(f,h,m){f[0]=
h[0]+m[0];f[1]=h[1]+m[1];return f},subtract:Za,multiply:$a,divide:ab,ceil:function(f,h){f[0]=Math.ceil(h[0]);f[1]=Math.ceil(h[1]);return f},floor:function(f,h){f[0]=Math.floor(h[0]);f[1]=Math.floor(h[1]);return f},min:function(f,h,m){f[0]=Math.min(h[0],m[0]);f[1]=Math.min(h[1],m[1]);return f},max:function(f,h,m){f[0]=Math.max(h[0],m[0]);f[1]=Math.max(h[1],m[1]);return f},round:function(f,h){f[0]=Math.round(h[0]);f[1]=Math.round(h[1]);return f},scale:function(f,h,m){f[0]=h[0]*m;f[1]=h[1]*m;return f},
scaleAndAdd:function(f,h,m,q){f[0]=h[0]+m[0]*q;f[1]=h[1]+m[1]*q;return f},distance:bb,squaredDistance:cb,length:db,squaredLength:eb,negate:function(f,h){f[0]=-h[0];f[1]=-h[1];return f},inverse:function(f,h){f[0]=1/h[0];f[1]=1/h[1];return f},normalize:function(f,h){var m=h[0],q=h[1];m=m*m+q*q;0<m&&(m=1/Math.sqrt(m));f[0]=h[0]*m;f[1]=h[1]*m;return f},dot:function(f,h){return f[0]*h[0]+f[1]*h[1]},cross:function(f,h,m){h=h[0]*m[1]-h[1]*m[0];f[0]=f[1]=0;f[2]=h;return f},lerp:function(f,h,m,q){var t=h[0];
h=h[1];f[0]=t+q*(m[0]-t);f[1]=h+q*(m[1]-h);return f},random:function(f,h){h=h||1;var m=2*ha()*Math.PI;f[0]=Math.cos(m)*h;f[1]=Math.sin(m)*h;return f},transformMat2:function(f,h,m){var q=h[0];h=h[1];f[0]=m[0]*q+m[2]*h;f[1]=m[1]*q+m[3]*h;return f},transformMat2d:function(f,h,m){var q=h[0];h=h[1];f[0]=m[0]*q+m[2]*h+m[4];f[1]=m[1]*q+m[3]*h+m[5];return f},transformMat3:function(f,h,m){var q=h[0];h=h[1];f[0]=m[0]*q+m[3]*h+m[6];f[1]=m[1]*q+m[4]*h+m[7];return f},transformMat4:function(f,h,m){var q=h[0];h=
h[1];f[0]=m[0]*q+m[4]*h+m[12];f[1]=m[1]*q+m[5]*h+m[13];return f},rotate:function(f,h,m,q){var t=h[0]-m[0];h=h[1]-m[1];var u=Math.sin(q);q=Math.cos(q);f[0]=t*q-h*u+m[0];f[1]=t*u+h*q+m[1];return f},angle:function(f,h){var m=f[0];f=f[1];var q=h[0];h=h[1];var t=Math.sqrt((m*m+f*f)*(q*q+h*h));return Math.acos(Math.min(Math.max(t&&(m*q+f*h)/t,-1),1))},zero:function(f){f[0]=0;f[1]=0;return f},str:function(f){return"vec2("+f[0]+", "+f[1]+")"},exactEquals:function(f,h){return f[0]===h[0]&&f[1]===h[1]},equals:function(f,
h){var m=f[0];f=f[1];var q=h[0];h=h[1];return Math.abs(m-q)<=1E-6*Math.max(1,Math.abs(m),Math.abs(q))&&Math.abs(f-h)<=1E-6*Math.max(1,Math.abs(f),Math.abs(h))},len:db,sub:Za,mul:$a,div:ab,dist:bb,sqrDist:cb,sqrLen:eb,forEach:na});a.glMatrix=ib;a.mat2=jb;a.mat2d=kb;a.mat3=lb;a.mat4=mb;a.quat=xa;a.quat2=ya;a.vec2=na;a.vec3=va;a.vec4=wa;Object.defineProperty(a,"__esModule",{value:!0})});
self.GraphemeSplitter=function(){function a(c,e){void 0===e&&(e=0);var g=c.charCodeAt(e);if(55296<=g&&56319>=g&&e<c.length-1){var k=g;c=c.charCodeAt(e+1);return 56320<=c&&57343>=c?1024*(k-55296)+(c-56320)+65536:k}return 56320<=g&&57343>=g&&1<=e?(k=c.charCodeAt(e-1),c=g,55296<=k&&56319>=k?1024*(k-55296)+(c-56320)+65536:c):g}function b(c,e,g){var k=[c].concat(e).concat([g]),l=k[k.length-2],n=k.lastIndexOf(14);if(1<n&&k.slice(1,n).every(function(p){return 3==p})&&-1==[3,13,17].indexOf(c))return 2;c=
k.lastIndexOf(4);if(0<c&&k.slice(1,c).every(function(p){return 4==p})&&-1==[12,4].indexOf(l))return 1==k.filter(function(p){return 4==p}).length%2?3:4;if(0==l&&1==g)return 0;if(2==l||0==l||1==l)return 14==g&&e.every(function(p){return 3==p})?2:1;if(2==g||0==g||1==g)return 1;if(6!=l||6!=g&&7!=g&&9!=g&&10!=g)if(9!=l&&7!=l||7!=g&&8!=g)if(10!=l&&8!=l||8!=g){if(3==g||15==g||5==g||12==l)return 0}else return 0;else return 0;else return 0;c=-1!=k.indexOf(3)?k.lastIndexOf(3)-1:k.length-2;return-1!=[13,17].indexOf(k[c])&&
k.slice(c+1,-1).every(function(p){return 3==p})&&14==g||15==l&&-1!=[16,17].indexOf(g)?0:-1!=e.indexOf(4)?2:4==l&&4==g?0:1}function d(c){return 1536<=c&&1541>=c||1757==c||1807==c||2274==c||3406==c||69821==c||70082<=c&&70083>=c||72250==c||72326<=c&&72329>=c||73030==c?12:13==c?0:10==c?1:0<=c&&9>=c||11<=c&&12>=c||14<=c&&31>=c||127<=c&&159>=c||173==c||1564==c||6158==c||8203==c||8206<=c&&8207>=c||8232==c||8233==c||8234<=c&&8238>=c||8288<=c&&8292>=c||8293==c||8294<=c&&8303>=c||55296<=c&&57343>=c||65279==
c||65520<=c&&65528>=c||65529<=c&&65531>=c||113824<=c&&113827>=c||119155<=c&&119162>=c||917504==c||917505==c||917506<=c&&917535>=c||917632<=c&&917759>=c||918E3<=c&&921599>=c?2:768<=c&&879>=c||1155<=c&&1159>=c||1160<=c&&1161>=c||1425<=c&&1469>=c||1471==c||1473<=c&&1474>=c||1476<=c&&1477>=c||1479==c||1552<=c&&1562>=c||1611<=c&&1631>=c||1648==c||1750<=c&&1756>=c||1759<=c&&1764>=c||1767<=c&&1768>=c||1770<=c&&1773>=c||1809==c||1840<=c&&1866>=c||1958<=c&&1968>=c||2027<=c&&2035>=c||2070<=c&&2073>=c||2075<=
c&&2083>=c||2085<=c&&2087>=c||2089<=c&&2093>=c||2137<=c&&2139>=c||2260<=c&&2273>=c||2275<=c&&2306>=c||2362==c||2364==c||2369<=c&&2376>=c||2381==c||2385<=c&&2391>=c||2402<=c&&2403>=c||2433==c||2492==c||2494==c||2497<=c&&2500>=c||2509==c||2519==c||2530<=c&&2531>=c||2561<=c&&2562>=c||2620==c||2625<=c&&2626>=c||2631<=c&&2632>=c||2635<=c&&2637>=c||2641==c||2672<=c&&2673>=c||2677==c||2689<=c&&2690>=c||2748==c||2753<=c&&2757>=c||2759<=c&&2760>=c||2765==c||2786<=c&&2787>=c||2810<=c&&2815>=c||2817==c||2876==
c||2878==c||2879==c||2881<=c&&2884>=c||2893==c||2902==c||2903==c||2914<=c&&2915>=c||2946==c||3006==c||3008==c||3021==c||3031==c||3072==c||3134<=c&&3136>=c||3142<=c&&3144>=c||3146<=c&&3149>=c||3157<=c&&3158>=c||3170<=c&&3171>=c||3201==c||3260==c||3263==c||3266==c||3270==c||3276<=c&&3277>=c||3285<=c&&3286>=c||3298<=c&&3299>=c||3328<=c&&3329>=c||3387<=c&&3388>=c||3390==c||3393<=c&&3396>=c||3405==c||3415==c||3426<=c&&3427>=c||3530==c||3535==c||3538<=c&&3540>=c||3542==c||3551==c||3633==c||3636<=c&&3642>=
c||3655<=c&&3662>=c||3761==c||3764<=c&&3769>=c||3771<=c&&3772>=c||3784<=c&&3789>=c||3864<=c&&3865>=c||3893==c||3895==c||3897==c||3953<=c&&3966>=c||3968<=c&&3972>=c||3974<=c&&3975>=c||3981<=c&&3991>=c||3993<=c&&4028>=c||4038==c||4141<=c&&4144>=c||4146<=c&&4151>=c||4153<=c&&4154>=c||4157<=c&&4158>=c||4184<=c&&4185>=c||4190<=c&&4192>=c||4209<=c&&4212>=c||4226==c||4229<=c&&4230>=c||4237==c||4253==c||4957<=c&&4959>=c||5906<=c&&5908>=c||5938<=c&&5940>=c||5970<=c&&5971>=c||6002<=c&&6003>=c||6068<=c&&6069>=
c||6071<=c&&6077>=c||6086==c||6089<=c&&6099>=c||6109==c||6155<=c&&6157>=c||6277<=c&&6278>=c||6313==c||6432<=c&&6434>=c||6439<=c&&6440>=c||6450==c||6457<=c&&6459>=c||6679<=c&&6680>=c||6683==c||6742==c||6744<=c&&6750>=c||6752==c||6754==c||6757<=c&&6764>=c||6771<=c&&6780>=c||6783==c||6832<=c&&6845>=c||6846==c||6912<=c&&6915>=c||6964==c||6966<=c&&6970>=c||6972==c||6978==c||7019<=c&&7027>=c||7040<=c&&7041>=c||7074<=c&&7077>=c||7080<=c&&7081>=c||7083<=c&&7085>=c||7142==c||7144<=c&&7145>=c||7149==c||7151<=
c&&7153>=c||7212<=c&&7219>=c||7222<=c&&7223>=c||7376<=c&&7378>=c||7380<=c&&7392>=c||7394<=c&&7400>=c||7405==c||7412==c||7416<=c&&7417>=c||7616<=c&&7673>=c||7675<=c&&7679>=c||8204==c||8400<=c&&8412>=c||8413<=c&&8416>=c||8417==c||8418<=c&&8420>=c||8421<=c&&8432>=c||11503<=c&&11505>=c||11647==c||11744<=c&&11775>=c||12330<=c&&12333>=c||12334<=c&&12335>=c||12441<=c&&12442>=c||42607==c||42608<=c&&42610>=c||42612<=c&&42621>=c||42654<=c&&42655>=c||42736<=c&&42737>=c||43010==c||43014==c||43019==c||43045<=
c&&43046>=c||43204<=c&&43205>=c||43232<=c&&43249>=c||43302<=c&&43309>=c||43335<=c&&43345>=c||43392<=c&&43394>=c||43443==c||43446<=c&&43449>=c||43452==c||43493==c||43561<=c&&43566>=c||43569<=c&&43570>=c||43573<=c&&43574>=c||43587==c||43596==c||43644==c||43696==c||43698<=c&&43700>=c||43703<=c&&43704>=c||43710<=c&&43711>=c||43713==c||43756<=c&&43757>=c||43766==c||44005==c||44008==c||44013==c||64286==c||65024<=c&&65039>=c||65056<=c&&65071>=c||65438<=c&&65439>=c||66045==c||66272==c||66422<=c&&66426>=c||
68097<=c&&68099>=c||68101<=c&&68102>=c||68108<=c&&68111>=c||68152<=c&&68154>=c||68159==c||68325<=c&&68326>=c||69633==c||69688<=c&&69702>=c||69759<=c&&69761>=c||69811<=c&&69814>=c||69817<=c&&69818>=c||69888<=c&&69890>=c||69927<=c&&69931>=c||69933<=c&&69940>=c||70003==c||70016<=c&&70017>=c||70070<=c&&70078>=c||70090<=c&&70092>=c||70191<=c&&70193>=c||70196==c||70198<=c&&70199>=c||70206==c||70367==c||70371<=c&&70378>=c||70400<=c&&70401>=c||70460==c||70462==c||70464==c||70487==c||70502<=c&&70508>=c||70512<=
c&&70516>=c||70712<=c&&70719>=c||70722<=c&&70724>=c||70726==c||70832==c||70835<=c&&70840>=c||70842==c||70845==c||70847<=c&&70848>=c||70850<=c&&70851>=c||71087==c||71090<=c&&71093>=c||71100<=c&&71101>=c||71103<=c&&71104>=c||71132<=c&&71133>=c||71219<=c&&71226>=c||71229==c||71231<=c&&71232>=c||71339==c||71341==c||71344<=c&&71349>=c||71351==c||71453<=c&&71455>=c||71458<=c&&71461>=c||71463<=c&&71467>=c||72193<=c&&72198>=c||72201<=c&&72202>=c||72243<=c&&72248>=c||72251<=c&&72254>=c||72263==c||72273<=c&&
72278>=c||72281<=c&&72283>=c||72330<=c&&72342>=c||72344<=c&&72345>=c||72752<=c&&72758>=c||72760<=c&&72765>=c||72767==c||72850<=c&&72871>=c||72874<=c&&72880>=c||72882<=c&&72883>=c||72885<=c&&72886>=c||73009<=c&&73014>=c||73018==c||73020<=c&&73021>=c||73023<=c&&73029>=c||73031==c||92912<=c&&92916>=c||92976<=c&&92982>=c||94095<=c&&94098>=c||113821<=c&&113822>=c||119141==c||119143<=c&&119145>=c||119150<=c&&119154>=c||119163<=c&&119170>=c||119173<=c&&119179>=c||119210<=c&&119213>=c||119362<=c&&119364>=
c||121344<=c&&121398>=c||121403<=c&&121452>=c||121461==c||121476==c||121499<=c&&121503>=c||121505<=c&&121519>=c||122880<=c&&122886>=c||122888<=c&&122904>=c||122907<=c&&122913>=c||122915<=c&&122916>=c||122918<=c&&122922>=c||125136<=c&&125142>=c||125252<=c&&125258>=c||917536<=c&&917631>=c||917760<=c&&917999>=c?3:127462<=c&&127487>=c?4:2307==c||2363==c||2366<=c&&2368>=c||2377<=c&&2380>=c||2382<=c&&2383>=c||2434<=c&&2435>=c||2495<=c&&2496>=c||2503<=c&&2504>=c||2507<=c&&2508>=c||2563==c||2622<=c&&2624>=
c||2691==c||2750<=c&&2752>=c||2761==c||2763<=c&&2764>=c||2818<=c&&2819>=c||2880==c||2887<=c&&2888>=c||2891<=c&&2892>=c||3007==c||3009<=c&&3010>=c||3014<=c&&3016>=c||3018<=c&&3020>=c||3073<=c&&3075>=c||3137<=c&&3140>=c||3202<=c&&3203>=c||3262==c||3264<=c&&3265>=c||3267<=c&&3268>=c||3271<=c&&3272>=c||3274<=c&&3275>=c||3330<=c&&3331>=c||3391<=c&&3392>=c||3398<=c&&3400>=c||3402<=c&&3404>=c||3458<=c&&3459>=c||3536<=c&&3537>=c||3544<=c&&3550>=c||3570<=c&&3571>=c||3635==c||3763==c||3902<=c&&3903>=c||3967==
c||4145==c||4155<=c&&4156>=c||4182<=c&&4183>=c||4228==c||6070==c||6078<=c&&6085>=c||6087<=c&&6088>=c||6435<=c&&6438>=c||6441<=c&&6443>=c||6448<=c&&6449>=c||6451<=c&&6456>=c||6681<=c&&6682>=c||6741==c||6743==c||6765<=c&&6770>=c||6916==c||6965==c||6971==c||6973<=c&&6977>=c||6979<=c&&6980>=c||7042==c||7073==c||7078<=c&&7079>=c||7082==c||7143==c||7146<=c&&7148>=c||7150==c||7154<=c&&7155>=c||7204<=c&&7211>=c||7220<=c&&7221>=c||7393==c||7410<=c&&7411>=c||7415==c||43043<=c&&43044>=c||43047==c||43136<=c&&
43137>=c||43188<=c&&43203>=c||43346<=c&&43347>=c||43395==c||43444<=c&&43445>=c||43450<=c&&43451>=c||43453<=c&&43456>=c||43567<=c&&43568>=c||43571<=c&&43572>=c||43597==c||43755==c||43758<=c&&43759>=c||43765==c||44003<=c&&44004>=c||44006<=c&&44007>=c||44009<=c&&44010>=c||44012==c||69632==c||69634==c||69762==c||69808<=c&&69810>=c||69815<=c&&69816>=c||69932==c||70018==c||70067<=c&&70069>=c||70079<=c&&70080>=c||70188<=c&&70190>=c||70194<=c&&70195>=c||70197==c||70368<=c&&70370>=c||70402<=c&&70403>=c||70463==
c||70465<=c&&70468>=c||70471<=c&&70472>=c||70475<=c&&70477>=c||70498<=c&&70499>=c||70709<=c&&70711>=c||70720<=c&&70721>=c||70725==c||70833<=c&&70834>=c||70841==c||70843<=c&&70844>=c||70846==c||70849==c||71088<=c&&71089>=c||71096<=c&&71099>=c||71102==c||71216<=c&&71218>=c||71227<=c&&71228>=c||71230==c||71340==c||71342<=c&&71343>=c||71350==c||71456<=c&&71457>=c||71462==c||72199<=c&&72200>=c||72249==c||72279<=c&&72280>=c||72343==c||72751==c||72766==c||72873==c||72881==c||72884==c||94033<=c&&94078>=c||
119142==c||119149==c?5:4352<=c&&4447>=c||43360<=c&&43388>=c?6:4448<=c&&4519>=c||55216<=c&&55238>=c?7:4520<=c&&4607>=c||55243<=c&&55291>=c?8:44032==c||44060==c||44088==c||44116==c||44144==c||44172==c||44200==c||44228==c||44256==c||44284==c||44312==c||44340==c||44368==c||44396==c||44424==c||44452==c||44480==c||44508==c||44536==c||44564==c||44592==c||44620==c||44648==c||44676==c||44704==c||44732==c||44760==c||44788==c||44816==c||44844==c||44872==c||44900==c||44928==c||44956==c||44984==c||45012==c||45040==
c||45068==c||45096==c||45124==c||45152==c||45180==c||45208==c||45236==c||45264==c||45292==c||45320==c||45348==c||45376==c||45404==c||45432==c||45460==c||45488==c||45516==c||45544==c||45572==c||45600==c||45628==c||45656==c||45684==c||45712==c||45740==c||45768==c||45796==c||45824==c||45852==c||45880==c||45908==c||45936==c||45964==c||45992==c||46020==c||46048==c||46076==c||46104==c||46132==c||46160==c||46188==c||46216==c||46244==c||46272==c||46300==c||46328==c||46356==c||46384==c||46412==c||46440==c||
46468==c||46496==c||46524==c||46552==c||46580==c||46608==c||46636==c||46664==c||46692==c||46720==c||46748==c||46776==c||46804==c||46832==c||46860==c||46888==c||46916==c||46944==c||46972==c||47E3==c||47028==c||47056==c||47084==c||47112==c||47140==c||47168==c||47196==c||47224==c||47252==c||47280==c||47308==c||47336==c||47364==c||47392==c||47420==c||47448==c||47476==c||47504==c||47532==c||47560==c||47588==c||47616==c||47644==c||47672==c||47700==c||47728==c||47756==c||47784==c||47812==c||47840==c||47868==
c||47896==c||47924==c||47952==c||47980==c||48008==c||48036==c||48064==c||48092==c||48120==c||48148==c||48176==c||48204==c||48232==c||48260==c||48288==c||48316==c||48344==c||48372==c||48400==c||48428==c||48456==c||48484==c||48512==c||48540==c||48568==c||48596==c||48624==c||48652==c||48680==c||48708==c||48736==c||48764==c||48792==c||48820==c||48848==c||48876==c||48904==c||48932==c||48960==c||48988==c||49016==c||49044==c||49072==c||49100==c||49128==c||49156==c||49184==c||49212==c||49240==c||49268==c||
49296==c||49324==c||49352==c||49380==c||49408==c||49436==c||49464==c||49492==c||49520==c||49548==c||49576==c||49604==c||49632==c||49660==c||49688==c||49716==c||49744==c||49772==c||49800==c||49828==c||49856==c||49884==c||49912==c||49940==c||49968==c||49996==c||50024==c||50052==c||50080==c||50108==c||50136==c||50164==c||50192==c||50220==c||50248==c||50276==c||50304==c||50332==c||50360==c||50388==c||50416==c||50444==c||50472==c||50500==c||50528==c||50556==c||50584==c||50612==c||50640==c||50668==c||50696==
c||50724==c||50752==c||50780==c||50808==c||50836==c||50864==c||50892==c||50920==c||50948==c||50976==c||51004==c||51032==c||51060==c||51088==c||51116==c||51144==c||51172==c||51200==c||51228==c||51256==c||51284==c||51312==c||51340==c||51368==c||51396==c||51424==c||51452==c||51480==c||51508==c||51536==c||51564==c||51592==c||51620==c||51648==c||51676==c||51704==c||51732==c||51760==c||51788==c||51816==c||51844==c||51872==c||51900==c||51928==c||51956==c||51984==c||52012==c||52040==c||52068==c||52096==c||
52124==c||52152==c||52180==c||52208==c||52236==c||52264==c||52292==c||52320==c||52348==c||52376==c||52404==c||52432==c||52460==c||52488==c||52516==c||52544==c||52572==c||52600==c||52628==c||52656==c||52684==c||52712==c||52740==c||52768==c||52796==c||52824==c||52852==c||52880==c||52908==c||52936==c||52964==c||52992==c||53020==c||53048==c||53076==c||53104==c||53132==c||53160==c||53188==c||53216==c||53244==c||53272==c||53300==c||53328==c||53356==c||53384==c||53412==c||53440==c||53468==c||53496==c||53524==
c||53552==c||53580==c||53608==c||53636==c||53664==c||53692==c||53720==c||53748==c||53776==c||53804==c||53832==c||53860==c||53888==c||53916==c||53944==c||53972==c||54E3==c||54028==c||54056==c||54084==c||54112==c||54140==c||54168==c||54196==c||54224==c||54252==c||54280==c||54308==c||54336==c||54364==c||54392==c||54420==c||54448==c||54476==c||54504==c||54532==c||54560==c||54588==c||54616==c||54644==c||54672==c||54700==c||54728==c||54756==c||54784==c||54812==c||54840==c||54868==c||54896==c||54924==c||
54952==c||54980==c||55008==c||55036==c||55064==c||55092==c||55120==c||55148==c||55176==c?9:44033<=c&&44059>=c||44061<=c&&44087>=c||44089<=c&&44115>=c||44117<=c&&44143>=c||44145<=c&&44171>=c||44173<=c&&44199>=c||44201<=c&&44227>=c||44229<=c&&44255>=c||44257<=c&&44283>=c||44285<=c&&44311>=c||44313<=c&&44339>=c||44341<=c&&44367>=c||44369<=c&&44395>=c||44397<=c&&44423>=c||44425<=c&&44451>=c||44453<=c&&44479>=c||44481<=c&&44507>=c||44509<=c&&44535>=c||44537<=c&&44563>=c||44565<=c&&44591>=c||44593<=c&&
44619>=c||44621<=c&&44647>=c||44649<=c&&44675>=c||44677<=c&&44703>=c||44705<=c&&44731>=c||44733<=c&&44759>=c||44761<=c&&44787>=c||44789<=c&&44815>=c||44817<=c&&44843>=c||44845<=c&&44871>=c||44873<=c&&44899>=c||44901<=c&&44927>=c||44929<=c&&44955>=c||44957<=c&&44983>=c||44985<=c&&45011>=c||45013<=c&&45039>=c||45041<=c&&45067>=c||45069<=c&&45095>=c||45097<=c&&45123>=c||45125<=c&&45151>=c||45153<=c&&45179>=c||45181<=c&&45207>=c||45209<=c&&45235>=c||45237<=c&&45263>=c||45265<=c&&45291>=c||45293<=c&&45319>=
c||45321<=c&&45347>=c||45349<=c&&45375>=c||45377<=c&&45403>=c||45405<=c&&45431>=c||45433<=c&&45459>=c||45461<=c&&45487>=c||45489<=c&&45515>=c||45517<=c&&45543>=c||45545<=c&&45571>=c||45573<=c&&45599>=c||45601<=c&&45627>=c||45629<=c&&45655>=c||45657<=c&&45683>=c||45685<=c&&45711>=c||45713<=c&&45739>=c||45741<=c&&45767>=c||45769<=c&&45795>=c||45797<=c&&45823>=c||45825<=c&&45851>=c||45853<=c&&45879>=c||45881<=c&&45907>=c||45909<=c&&45935>=c||45937<=c&&45963>=c||45965<=c&&45991>=c||45993<=c&&46019>=c||
46021<=c&&46047>=c||46049<=c&&46075>=c||46077<=c&&46103>=c||46105<=c&&46131>=c||46133<=c&&46159>=c||46161<=c&&46187>=c||46189<=c&&46215>=c||46217<=c&&46243>=c||46245<=c&&46271>=c||46273<=c&&46299>=c||46301<=c&&46327>=c||46329<=c&&46355>=c||46357<=c&&46383>=c||46385<=c&&46411>=c||46413<=c&&46439>=c||46441<=c&&46467>=c||46469<=c&&46495>=c||46497<=c&&46523>=c||46525<=c&&46551>=c||46553<=c&&46579>=c||46581<=c&&46607>=c||46609<=c&&46635>=c||46637<=c&&46663>=c||46665<=c&&46691>=c||46693<=c&&46719>=c||46721<=
c&&46747>=c||46749<=c&&46775>=c||46777<=c&&46803>=c||46805<=c&&46831>=c||46833<=c&&46859>=c||46861<=c&&46887>=c||46889<=c&&46915>=c||46917<=c&&46943>=c||46945<=c&&46971>=c||46973<=c&&46999>=c||47001<=c&&47027>=c||47029<=c&&47055>=c||47057<=c&&47083>=c||47085<=c&&47111>=c||47113<=c&&47139>=c||47141<=c&&47167>=c||47169<=c&&47195>=c||47197<=c&&47223>=c||47225<=c&&47251>=c||47253<=c&&47279>=c||47281<=c&&47307>=c||47309<=c&&47335>=c||47337<=c&&47363>=c||47365<=c&&47391>=c||47393<=c&&47419>=c||47421<=c&&
47447>=c||47449<=c&&47475>=c||47477<=c&&47503>=c||47505<=c&&47531>=c||47533<=c&&47559>=c||47561<=c&&47587>=c||47589<=c&&47615>=c||47617<=c&&47643>=c||47645<=c&&47671>=c||47673<=c&&47699>=c||47701<=c&&47727>=c||47729<=c&&47755>=c||47757<=c&&47783>=c||47785<=c&&47811>=c||47813<=c&&47839>=c||47841<=c&&47867>=c||47869<=c&&47895>=c||47897<=c&&47923>=c||47925<=c&&47951>=c||47953<=c&&47979>=c||47981<=c&&48007>=c||48009<=c&&48035>=c||48037<=c&&48063>=c||48065<=c&&48091>=c||48093<=c&&48119>=c||48121<=c&&48147>=
c||48149<=c&&48175>=c||48177<=c&&48203>=c||48205<=c&&48231>=c||48233<=c&&48259>=c||48261<=c&&48287>=c||48289<=c&&48315>=c||48317<=c&&48343>=c||48345<=c&&48371>=c||48373<=c&&48399>=c||48401<=c&&48427>=c||48429<=c&&48455>=c||48457<=c&&48483>=c||48485<=c&&48511>=c||48513<=c&&48539>=c||48541<=c&&48567>=c||48569<=c&&48595>=c||48597<=c&&48623>=c||48625<=c&&48651>=c||48653<=c&&48679>=c||48681<=c&&48707>=c||48709<=c&&48735>=c||48737<=c&&48763>=c||48765<=c&&48791>=c||48793<=c&&48819>=c||48821<=c&&48847>=c||
48849<=c&&48875>=c||48877<=c&&48903>=c||48905<=c&&48931>=c||48933<=c&&48959>=c||48961<=c&&48987>=c||48989<=c&&49015>=c||49017<=c&&49043>=c||49045<=c&&49071>=c||49073<=c&&49099>=c||49101<=c&&49127>=c||49129<=c&&49155>=c||49157<=c&&49183>=c||49185<=c&&49211>=c||49213<=c&&49239>=c||49241<=c&&49267>=c||49269<=c&&49295>=c||49297<=c&&49323>=c||49325<=c&&49351>=c||49353<=c&&49379>=c||49381<=c&&49407>=c||49409<=c&&49435>=c||49437<=c&&49463>=c||49465<=c&&49491>=c||49493<=c&&49519>=c||49521<=c&&49547>=c||49549<=
c&&49575>=c||49577<=c&&49603>=c||49605<=c&&49631>=c||49633<=c&&49659>=c||49661<=c&&49687>=c||49689<=c&&49715>=c||49717<=c&&49743>=c||49745<=c&&49771>=c||49773<=c&&49799>=c||49801<=c&&49827>=c||49829<=c&&49855>=c||49857<=c&&49883>=c||49885<=c&&49911>=c||49913<=c&&49939>=c||49941<=c&&49967>=c||49969<=c&&49995>=c||49997<=c&&50023>=c||50025<=c&&50051>=c||50053<=c&&50079>=c||50081<=c&&50107>=c||50109<=c&&50135>=c||50137<=c&&50163>=c||50165<=c&&50191>=c||50193<=c&&50219>=c||50221<=c&&50247>=c||50249<=c&&
50275>=c||50277<=c&&50303>=c||50305<=c&&50331>=c||50333<=c&&50359>=c||50361<=c&&50387>=c||50389<=c&&50415>=c||50417<=c&&50443>=c||50445<=c&&50471>=c||50473<=c&&50499>=c||50501<=c&&50527>=c||50529<=c&&50555>=c||50557<=c&&50583>=c||50585<=c&&50611>=c||50613<=c&&50639>=c||50641<=c&&50667>=c||50669<=c&&50695>=c||50697<=c&&50723>=c||50725<=c&&50751>=c||50753<=c&&50779>=c||50781<=c&&50807>=c||50809<=c&&50835>=c||50837<=c&&50863>=c||50865<=c&&50891>=c||50893<=c&&50919>=c||50921<=c&&50947>=c||50949<=c&&50975>=
c||50977<=c&&51003>=c||51005<=c&&51031>=c||51033<=c&&51059>=c||51061<=c&&51087>=c||51089<=c&&51115>=c||51117<=c&&51143>=c||51145<=c&&51171>=c||51173<=c&&51199>=c||51201<=c&&51227>=c||51229<=c&&51255>=c||51257<=c&&51283>=c||51285<=c&&51311>=c||51313<=c&&51339>=c||51341<=c&&51367>=c||51369<=c&&51395>=c||51397<=c&&51423>=c||51425<=c&&51451>=c||51453<=c&&51479>=c||51481<=c&&51507>=c||51509<=c&&51535>=c||51537<=c&&51563>=c||51565<=c&&51591>=c||51593<=c&&51619>=c||51621<=c&&51647>=c||51649<=c&&51675>=c||
51677<=c&&51703>=c||51705<=c&&51731>=c||51733<=c&&51759>=c||51761<=c&&51787>=c||51789<=c&&51815>=c||51817<=c&&51843>=c||51845<=c&&51871>=c||51873<=c&&51899>=c||51901<=c&&51927>=c||51929<=c&&51955>=c||51957<=c&&51983>=c||51985<=c&&52011>=c||52013<=c&&52039>=c||52041<=c&&52067>=c||52069<=c&&52095>=c||52097<=c&&52123>=c||52125<=c&&52151>=c||52153<=c&&52179>=c||52181<=c&&52207>=c||52209<=c&&52235>=c||52237<=c&&52263>=c||52265<=c&&52291>=c||52293<=c&&52319>=c||52321<=c&&52347>=c||52349<=c&&52375>=c||52377<=
c&&52403>=c||52405<=c&&52431>=c||52433<=c&&52459>=c||52461<=c&&52487>=c||52489<=c&&52515>=c||52517<=c&&52543>=c||52545<=c&&52571>=c||52573<=c&&52599>=c||52601<=c&&52627>=c||52629<=c&&52655>=c||52657<=c&&52683>=c||52685<=c&&52711>=c||52713<=c&&52739>=c||52741<=c&&52767>=c||52769<=c&&52795>=c||52797<=c&&52823>=c||52825<=c&&52851>=c||52853<=c&&52879>=c||52881<=c&&52907>=c||52909<=c&&52935>=c||52937<=c&&52963>=c||52965<=c&&52991>=c||52993<=c&&53019>=c||53021<=c&&53047>=c||53049<=c&&53075>=c||53077<=c&&
53103>=c||53105<=c&&53131>=c||53133<=c&&53159>=c||53161<=c&&53187>=c||53189<=c&&53215>=c||53217<=c&&53243>=c||53245<=c&&53271>=c||53273<=c&&53299>=c||53301<=c&&53327>=c||53329<=c&&53355>=c||53357<=c&&53383>=c||53385<=c&&53411>=c||53413<=c&&53439>=c||53441<=c&&53467>=c||53469<=c&&53495>=c||53497<=c&&53523>=c||53525<=c&&53551>=c||53553<=c&&53579>=c||53581<=c&&53607>=c||53609<=c&&53635>=c||53637<=c&&53663>=c||53665<=c&&53691>=c||53693<=c&&53719>=c||53721<=c&&53747>=c||53749<=c&&53775>=c||53777<=c&&53803>=
c||53805<=c&&53831>=c||53833<=c&&53859>=c||53861<=c&&53887>=c||53889<=c&&53915>=c||53917<=c&&53943>=c||53945<=c&&53971>=c||53973<=c&&53999>=c||54001<=c&&54027>=c||54029<=c&&54055>=c||54057<=c&&54083>=c||54085<=c&&54111>=c||54113<=c&&54139>=c||54141<=c&&54167>=c||54169<=c&&54195>=c||54197<=c&&54223>=c||54225<=c&&54251>=c||54253<=c&&54279>=c||54281<=c&&54307>=c||54309<=c&&54335>=c||54337<=c&&54363>=c||54365<=c&&54391>=c||54393<=c&&54419>=c||54421<=c&&54447>=c||54449<=c&&54475>=c||54477<=c&&54503>=c||
54505<=c&&54531>=c||54533<=c&&54559>=c||54561<=c&&54587>=c||54589<=c&&54615>=c||54617<=c&&54643>=c||54645<=c&&54671>=c||54673<=c&&54699>=c||54701<=c&&54727>=c||54729<=c&&54755>=c||54757<=c&&54783>=c||54785<=c&&54811>=c||54813<=c&&54839>=c||54841<=c&&54867>=c||54869<=c&&54895>=c||54897<=c&&54923>=c||54925<=c&&54951>=c||54953<=c&&54979>=c||54981<=c&&55007>=c||55009<=c&&55035>=c||55037<=c&&55063>=c||55065<=c&&55091>=c||55093<=c&&55119>=c||55121<=c&&55147>=c||55149<=c&&55175>=c||55177<=c&&55203>=c?10:
9757==c||9977==c||9994<=c&&9997>=c||127877==c||127938<=c&&127940>=c||127943==c||127946<=c&&127948>=c||128066<=c&&128067>=c||128070<=c&&128080>=c||128110==c||128112<=c&&128120>=c||128124==c||128129<=c&&128131>=c||128133<=c&&128135>=c||128170==c||128372<=c&&128373>=c||128378==c||128400==c||128405<=c&&128406>=c||128581<=c&&128583>=c||128587<=c&&128591>=c||128675==c||128692<=c&&128694>=c||128704==c||128716==c||129304<=c&&129308>=c||129310<=c&&129311>=c||129318==c||129328<=c&&129337>=c||129341<=c&&129342>=
c||129489<=c&&129501>=c?13:127995<=c&&127999>=c?14:8205==c?15:9792==c||9794==c||9877<=c&&9878>=c||9992==c||10084==c||127752==c||127806==c||127859==c||127891==c||127908==c||127912==c||127979==c||127981==c||128139==c||128187<=c&&128188>=c||128295==c||128300==c||128488==c||128640==c||128658==c?16:128102<=c&&128105>=c?17:11}this.nextBreak=function(c,e){void 0===e&&(e=0);if(0>e)return 0;if(e>=c.length-1)return c.length;var g=d(a(c,e)),k=[];for(e+=1;e<c.length;e++){var l=c,n=e-1;if(!(55296<=l.charCodeAt(n)&&
56319>=l.charCodeAt(n)&&56320<=l.charCodeAt(n+1)&&57343>=l.charCodeAt(n+1))){l=d(a(c,e));if(b(g,k,l))return e;k.push(l)}}return c.length};this.splitGraphemes=function(c){for(var e=[],g=0,k;(k=this.nextBreak(c,g))<c.length;)e.push(c.slice(g,k)),g=k;g<c.length&&e.push(c.slice(g));return e};this.iterateGraphemes=function(c){var e=0,g={next:function(){var k;if((k=this.nextBreak(c,e))<c.length){var l=c.slice(e,k);e=k;return{value:l,done:!1}}return e<c.length?(l=c.slice(e),e=c.length,{value:l,done:!1}):
{value:void 0,done:!0}}.bind(this)};"undefined"!==typeof Symbol&&Symbol.iterator&&(g[Symbol.iterator]=function(){return g});return g};this.countGraphemes=function(c){for(var e=0,g=0,k;(k=this.nextBreak(c,g))<c.length;)g=k,e++;g<c.length&&e++;return e};return this};"use strict";
function lineInt(a,b,d){var c=[0,0];var e=a[1][1]-a[0][1];var g=a[0][0]-a[1][0];a=e*a[0][0]+g*a[0][1];var k=b[1][1]-b[0][1];var l=b[0][0]-b[1][0];b=k*b[0][0]+l*b[0][1];var n=e*l-k*g;scalar_eq(n,0,d||0)||(c[0]=(l*a-g*b)/n,c[1]=(e*b-k*a)/n);return c}function lineSegmentsIntersect(a,b,d,c){var e=b[0]-a[0];b=b[1]-a[1];var g=c[0]-d[0],k=c[1]-d[1];if(0===g*b-k*e)return!1;c=(e*(d[1]-a[1])+b*(a[0]-d[0]))/(g*b-k*e);a=(g*(a[1]-d[1])+k*(d[0]-a[0]))/(k*e-g*b);return 0<=c&&1>=c&&0<=a&&1>=a}
function triangleArea(a,b,d){return(b[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(b[1]-a[1])}function isLeft(a,b,d){return 0<triangleArea(a,b,d)}function isLeftOn(a,b,d){return 0<=triangleArea(a,b,d)}function isRight(a,b,d){return 0>triangleArea(a,b,d)}function isRightOn(a,b,d){return 0>=triangleArea(a,b,d)}var tmpPoint1$$module$working$444913146$c3runtime=[],tmpPoint2$$module$working$444913146$c3runtime=[];
function collinear(a,b,d,c){if(c){var e=tmpPoint1$$module$working$444913146$c3runtime,g=tmpPoint2$$module$working$444913146$c3runtime;e[0]=b[0]-a[0];e[1]=b[1]-a[1];g[0]=d[0]-b[0];g[1]=d[1]-b[1];return Math.acos((e[0]*g[0]+e[1]*g[1])/(Math.sqrt(e[0]*e[0]+e[1]*e[1])*Math.sqrt(g[0]*g[0]+g[1]*g[1])))<c}return 0===triangleArea(a,b,d)}function sqdist(a,b){var d=b[0]-a[0];a=b[1]-a[1];return d*d+a*a}function polygonAt(a,b){var d=a.length;return a[0>b?b%d+d:b%d]}function polygonClear(a){a.length=0}
function polygonAppend(a,b,d,c){for(;d<c;d++)a.push(b[d])}function polygonReverse(a){for(var b=[],d=a.length,c=0;c!==d;c++)b.push(a.pop());for(c=0;c!==d;c++)a[c]=b[c]}function polygonIsReflex(a,b){return isRight(polygonAt(a,b-1),polygonAt(a,b),polygonAt(a,b+1))}var tmpLine1$$module$working$444913146$c3runtime=[],tmpLine2$$module$working$444913146$c3runtime=[];
function polygonCanSee(a,b,d){var c=tmpLine1$$module$working$444913146$c3runtime,e=tmpLine2$$module$working$444913146$c3runtime;if(isLeftOn(polygonAt(a,b+1),polygonAt(a,b),polygonAt(a,d))&&isRightOn(polygonAt(a,b-1),polygonAt(a,b),polygonAt(a,d)))return!1;var g=sqdist(polygonAt(a,b),polygonAt(a,d));for(var k=0;k!==a.length;++k)if((k+1)%a.length!==b&&k!==b&&isLeftOn(polygonAt(a,b),polygonAt(a,d),polygonAt(a,k+1))&&isRightOn(polygonAt(a,b),polygonAt(a,d),polygonAt(a,k))){c[0]=polygonAt(a,b);c[1]=polygonAt(a,
d);e[0]=polygonAt(a,k);e[1]=polygonAt(a,k+1);var l=lineInt(c,e);if(sqdist(polygonAt(a,b),l)<g)return!1}return!0}function polygonCanSee2(a,b,d){for(var c=0;c!==a.length;++c)if(c!==b&&c!==d&&(c+1)%a.length!==b&&(c+1)%a.length!==d&&lineSegmentsIntersect(polygonAt(a,b),polygonAt(a,d),polygonAt(a,c),polygonAt(a,c+1)))return!1;return!0}
function polygonCopy(a,b,d,c){c=c||[];polygonClear(c);if(b<d)for(var e=b;e<=d;e++)c.push(a[e]);else{for(e=0;e<=d;e++)c.push(a[e]);for(e=b;e<a.length;e++)c.push(a[e])}return c}
function polygonGetCutEdges(a){for(var b=[],d,c,e=[],g=Number.MAX_VALUE,k=0;k<a.length;++k)if(polygonIsReflex(a,k))for(var l=0;l<a.length;++l)if(polygonCanSee(a,k,l)){d=polygonGetCutEdges(polygonCopy(a,k,l,e));c=polygonGetCutEdges(polygonCopy(a,l,k,e));for(var n=0;n<c.length;n++)d.push(c[n]);d.length<g&&(b=d,g=d.length,b.push([polygonAt(a,k),polygonAt(a,l)]))}return b}
function polygonSlice(a,b){if(0===b.length)return[a];if(b instanceof Array&&b.length&&b[0]instanceof Array&&2===b[0].length&&b[0][0]instanceof Array){a=[a];for(var d=0;d<b.length;d++)for(var c=b[d],e=0;e<a.length;e++){var g=polygonSlice(a[e],c);if(g){a.splice(e,1);a.push(g[0],g[1]);break}}return a}c=b;d=a.indexOf(c[0]);e=a.indexOf(c[1]);return-1!==d&&-1!==e?[polygonCopy(a,d,e),polygonCopy(a,e,d)]:!1}
function getIntersectionPoint(a,b,d,c,e){var g=b[1]-a[1];b=a[0]-b[0];a=g*a[0]+b*a[1];var k=c[1]-d[1];c=d[0]-c[0];d=k*d[0]+c*d[1];var l=g*c-k*b;return scalar_eq(l,0,e||0)?[0,0]:[(c*a-b*d)/l,(g*d-k*a)/l]}
function polygonQuickDecomp(a,b,d,c,e,g,k){g=g||100;k=k||0;e=e||25;b="undefined"!==typeof b?b:[];d=d||[];c=c||[];var l=[0,0],n=[0,0],p=[0,0],r,w=0,z=0,B=0,C=[],E=[];if(3>a.length)return b;k++;if(k>g)return console.warn("quickDecomp: max level ("+g+") reached."),b;for(var F=0;F<a.length;++F)if(polygonIsReflex(a,F)){d.push(a[F]);var I=r=Number.MAX_VALUE;for(var K=0;K<a.length;++K){if(isLeft(polygonAt(a,F-1),polygonAt(a,F),polygonAt(a,K))&&isRightOn(polygonAt(a,F-1),polygonAt(a,F),polygonAt(a,K-1))&&
(p=getIntersectionPoint(polygonAt(a,F-1),polygonAt(a,F),polygonAt(a,K),polygonAt(a,K-1)),isRight(polygonAt(a,F+1),polygonAt(a,F),p))){var O=sqdist(a[F],p);O<r&&(r=O,n=p,z=K)}isLeft(polygonAt(a,F+1),polygonAt(a,F),polygonAt(a,K+1))&&isRightOn(polygonAt(a,F+1),polygonAt(a,F),polygonAt(a,K))&&(p=getIntersectionPoint(polygonAt(a,F+1),polygonAt(a,F),polygonAt(a,K),polygonAt(a,K+1)),isLeft(polygonAt(a,F-1),polygonAt(a,F),p)&&(O=sqdist(a[F],p),O<I&&(I=O,l=p,w=K)))}if(z===(w+1)%a.length)p[0]=(n[0]+l[0])/
2,p[1]=(n[1]+l[1])/2,c.push(p),F<w?(polygonAppend(C,a,F,w+1),C.push(p),E.push(p),0!==z&&polygonAppend(E,a,z,a.length),polygonAppend(E,a,0,F+1)):(0!==F&&polygonAppend(C,a,F,a.length),polygonAppend(C,a,0,w+1),C.push(p),E.push(p),polygonAppend(E,a,z,F+1));else{z>w&&(w+=a.length);l=Number.MAX_VALUE;if(w<z)return b;for(K=z;K<=w;++K)isLeftOn(polygonAt(a,F-1),polygonAt(a,F),polygonAt(a,K))&&isRightOn(polygonAt(a,F+1),polygonAt(a,F),polygonAt(a,K))&&(O=sqdist(polygonAt(a,F),polygonAt(a,K)),O<l&&polygonCanSee2(a,
F,K)&&(l=O,B=K%a.length));F<B?(polygonAppend(C,a,F,B+1),0!==B&&polygonAppend(E,a,B,a.length),polygonAppend(E,a,0,F+1)):(0!==F&&polygonAppend(C,a,F,a.length),polygonAppend(C,a,0,B+1),polygonAppend(E,a,B,F+1))}C.length<E.length?(polygonQuickDecomp(C,b,d,c,e,g,k),polygonQuickDecomp(E,b,d,c,e,g,k)):(polygonQuickDecomp(E,b,d,c,e,g,k),polygonQuickDecomp(C,b,d,c,e,g,k));return b}b.push(a);return b}function scalar_eq(a,b,d){return Math.abs(a-b)<=(d||0)}
function points_eq(a,b,d){return scalar_eq(a[0],b[0],d)&&scalar_eq(a[1],b[1],d)}
self.polyDecomp={decomp:function(a){var b=polygonGetCutEdges(a);return 0<b.length?polygonSlice(a,b):[a]},quickDecomp:polygonQuickDecomp,isSimple:function(a){var b;for(b=0;b<a.length-1;b++)for(var d=0;d<b-1;d++)if(lineSegmentsIntersect(a[b],a[b+1],a[d],a[d+1]))return!1;for(b=1;b<a.length-2;b++)if(lineSegmentsIntersect(a[0],a[a.length-1],a[b],a[b+1]))return!1;return!0},removeCollinearPoints:function(a,b){for(var d=0,c=a.length-1;3<a.length&&0<=c;--c)collinear(polygonAt(a,c-1),polygonAt(a,c),polygonAt(a,
c+1),b)&&(a.splice(c%a.length,1),d++);return d},removeDuplicatePoints:function(a,b){for(var d=a.length-1;1<=d;--d)for(var c=a[d],e=d-1;0<=e;--e)points_eq(c,a[e],b)&&a.splice(d,1)},makeCCW:function(a){for(var b=0,d=1;d<a.length;++d)if(a[d][1]<a[b][1]||a[d][1]===a[b][1]&&a[d][0]>a[b][0])b=d;if(isLeft(polygonAt(a,b-1),polygonAt(a,b),polygonAt(a,b+1)))return!1;polygonReverse(a);return!0}};"use strict";let isReady=!1,hasAppStarted=!1,buildMode="dev";const internalApiToken=Symbol("Construct internal API token");
let internalApiTokenAccessesRemaining=14;
const C3=self.C3=class{constructor(){throw TypeError("static class can't be instantiated");}static _GetInternalAPIToken(){if(0>=internalApiTokenAccessesRemaining)throw Error("cannot obtain internal API token");--internalApiTokenAccessesRemaining;return internalApiToken}static SetReady(){isReady=!0}static IsReady(){return isReady}static SetAppStarted(){hasAppStarted=!0}static HasAppStarted(){return hasAppStarted}static SetBuildMode(a){buildMode=a}static GetBuildMode(){return buildMode}static IsReleaseBuild(){return"final"===buildMode}};
C3.isDebug=!1;C3.isDebugDefend=!1;C3.hardwareConcurrency=navigator.hardwareConcurrency||2;self.C3X={};"use strict";const C3$jscomp$2=self.C3;
C3$jscomp$2.QueryParser=class{constructor(a){this._queryString=a;this._parameters=new Map;this._Parse()}_Parse(){var a=this._queryString;if(a.startsWith("?")||a.startsWith("#"))a=a.substr(1);a=a.split("&");for(const b of a)this._ParseParameter(b)}_ParseParameter(a){if(a)if(a.includes("=")){var b=a.indexOf("="),d=decodeURIComponent(a.substring(0,b));a=decodeURIComponent(a.substring(b+1));this._parameters.set(d,a)}else this._parameters.set(a,null)}LogAll(){for(const a of this._parameters)console.log("[QueryParser] Parameter '"+
a[0]+"' = "+(null===a[1]?"null":"'"+a[1]+"'"))}Has(a){return this._parameters.has(a)}Get(a){a=this._parameters.get(a);return"undefined"===typeof a?null:a}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(a){this._queryString=a;this._parameters.clear();this._Parse()}};C3$jscomp$2.QueryString=new C3$jscomp$2.QueryParser(location.search);C3$jscomp$2.LocationHashString=new C3$jscomp$2.QueryParser(location.hash);
C3$jscomp$2.QueryString.Has("perf")&&(C3$jscomp$2.isPerformanceProfiling=!0);"dev"!==C3$jscomp$2.QueryString.Get("mode")&&C3$jscomp$2.SetBuildMode("final");"use strict";const C3$jscomp$3=self.C3;C3$jscomp$3.Platform={OS:"(unknown)",OSVersion:"(unknown)",Browser:"(unknown)",BrowserVersion:"(unknown)",BrowserVersionNumber:NaN,BrowserEngine:"(unknown)",Context:"browser",IsDesktop:!0,IsMobile:!1,IsAppleOS:!1,IsIpadOS:!1,GetDetailedInfo:async()=>{}};
const windowsNTVerMap=new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]]);function GetWindowsNTVersionName(a){const b=parseFloat(a),d=windowsNTVerMap.get(b);return d?d:13<=b?"11":"NT "+a}const uaStr=navigator.userAgent,uaData=navigator.userAgentData;
if(uaData&&0<uaData.brands.length){C3$jscomp$3.Platform.OS=uaData.platform;C3$jscomp$3.Platform.IsMobile=uaData.mobile;C3$jscomp$3.Platform.IsDesktop=!C3$jscomp$3.Platform.IsMobile;const a=new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]]),b=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]);function d(e){let g="",k="",l="",n="";for(const p of e)e=
a.get(p.brand),!g&&e&&(g=e,k=p.version),e=b.get(p.brand),!l&&e&&(l=e,n=p.version);g||"Chromium"!==l||(C3$jscomp$3.Platform.Browser="Chromium",C3$jscomp$3.Platform.BrowserVersion=n);C3$jscomp$3.Platform.Browser=g||"(unknown)";C3$jscomp$3.Platform.BrowserVersion=k||"(unknown)";C3$jscomp$3.Platform.BrowserEngine=l||"(unknown)"}d(uaData.brands);let c=!1;C3$jscomp$3.Platform.GetDetailedInfo=async()=>{if(!c)try{const e=await navigator.userAgentData.getHighEntropyValues(["platformVersion","fullVersionList"]);
d(e.fullVersionList);C3$jscomp$3.Platform.OSVersion="Windows"===C3$jscomp$3.Platform.OS?GetWindowsNTVersionName(e.platformVersion):e.platformVersion;c=!0}catch(e){console.warn("Failed to get detailed user agent information: ",e)}}}else{function a(p,r){p=Array.isArray(p)?p:[p];for(const w of p)if(p=w.exec(uaStr)){r(p);break}}a(/windows\s+nt\s+([\d\.]+)/i,p=>{C3$jscomp$3.Platform.OS="Windows";C3$jscomp$3.Platform.OSVersion=GetWindowsNTVersionName(p[1])});a(/mac\s+os\s+x\s+([\d\._]+)/i,p=>{C3$jscomp$3.Platform.OS=
"macOS";C3$jscomp$3.Platform.OSVersion=p[1].replace(/_/g,".")});a(/CrOS/,()=>{C3$jscomp$3.Platform.OS="Chrome OS"});a(/linux|openbsd|freebsd|netbsd/i,()=>{C3$jscomp$3.Platform.OS="Linux"});a(/android/i,()=>{C3$jscomp$3.Platform.OS="Android"});a(/android\s+([\d\.]+)/i,p=>{C3$jscomp$3.Platform.OS="Android";C3$jscomp$3.Platform.OSVersion=p[1]});"(unknown)"===C3$jscomp$3.Platform.OS&&(a(/(iphone|ipod|ipad)/i,p=>{C3$jscomp$3.Platform.OS="iOS"}),a([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],
p=>{C3$jscomp$3.Platform.OS="iOS";C3$jscomp$3.Platform.OSVersion=p[1].replace(/_/g,".")}));const b=/chrome\//i.test(uaStr),d=/chromium\//i.test(uaStr),c=/edg\//i.test(uaStr),e=/OPR\//.test(uaStr),g=/nwjs/i.test(uaStr),k=/safari\//i.test(uaStr),l=/webkit/i.test(uaStr);c||e||a(/chrome\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.Browser="Chrome";C3$jscomp$3.Platform.BrowserVersion=p[1];C3$jscomp$3.Platform.BrowserEngine="Chromium"});a(/edg\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.Browser="Edge";C3$jscomp$3.Platform.BrowserVersion=
p[1];C3$jscomp$3.Platform.BrowserEngine="Chromium"});a(/OPR\/([\d\.]+)/,p=>{C3$jscomp$3.Platform.Browser="Opera";C3$jscomp$3.Platform.BrowserVersion=p[1];C3$jscomp$3.Platform.BrowserEngine="Chromium"});a(/chromium\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.Browser="Chromium";C3$jscomp$3.Platform.BrowserVersion=p[1];C3$jscomp$3.Platform.BrowserEngine="Chromium"});a(/nwjs\/[0-9.]+/i,p=>{C3$jscomp$3.Platform.Browser="NW.js";C3$jscomp$3.Platform.BrowserVersion=p[1];C3$jscomp$3.Platform.BrowserEngine="Chromium";
C3$jscomp$3.Platform.Context="nwjs"});a(/firefox\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.Browser="Firefox";C3$jscomp$3.Platform.BrowserVersion=p[1];C3$jscomp$3.Platform.BrowserEngine="Gecko"});!k||b||d||c||e||g||(C3$jscomp$3.Platform.Browser="Safari",C3$jscomp$3.Platform.BrowserEngine="WebKit",a(/version\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.BrowserVersion=p[1]}),a(/crios\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.Browser="Chrome for iOS";C3$jscomp$3.Platform.BrowserVersion=p[1]}),a(/fxios\/([\d\.]+)/i,
p=>{C3$jscomp$3.Platform.Browser="Firefox for iOS";C3$jscomp$3.Platform.BrowserVersion=p[1]}),a(/edgios\/([\d\.]+)/i,p=>{C3$jscomp$3.Platform.Browser="Edge for iOS";C3$jscomp$3.Platform.BrowserVersion=p[1]}));"(unknown)"===C3$jscomp$3.Platform.BrowserEngine&&l&&(C3$jscomp$3.Platform.BrowserEngine="WebKit");"Android"===C3$jscomp$3.Platform.OS&&"Safari"===C3$jscomp$3.Platform.Browser&&(C3$jscomp$3.Platform.Browser="Stock");const n=(new Set(["Windows","macOS","Linux","Chrome OS"])).has(C3$jscomp$3.Platform.OS)||
"nwjs"===C3$jscomp$3.Platform.Context;C3$jscomp$3.Platform.IsDesktop=n;C3$jscomp$3.Platform.IsMobile=!n}"Chrome"===C3$jscomp$3.Platform.Browser&&"browser"===C3$jscomp$3.Platform.Context&&/wv\)/.test(uaStr)&&(C3$jscomp$3.Platform.Context="webview");"nwjs"!==C3$jscomp$3.Platform.Context&&"undefined"!==typeof window&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)&&(C3$jscomp$3.Platform.Context="webapp");C3$jscomp$3.Platform.BrowserVersionNumber=parseFloat(C3$jscomp$3.Platform.BrowserVersion);
"macOS"===C3$jscomp$3.Platform.OS&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints&&(C3$jscomp$3.Platform.OS="iOS",C3$jscomp$3.Platform.OSVersion=C3$jscomp$3.Platform.BrowserVersion,C3$jscomp$3.Platform.IsDesktop=!1,C3$jscomp$3.Platform.IsMobile=!0,C3$jscomp$3.Platform.IsIpadOS=!0);C3$jscomp$3.Platform.IsAppleOS="macOS"===C3$jscomp$3.Platform.OS||"iOS"===C3$jscomp$3.Platform.OS;"use strict";
const DATABASE_PROMISE_MAP=new Map,SUPPORTS_GETALL="undefined"!==typeof IDBObjectStore&&"function"===typeof IDBObjectStore.prototype.getAll,SUPPORTS_GETALLKEYS="undefined"!==typeof IDBObjectStore&&"function"===typeof IDBObjectStore.prototype.getAllKeys;function asyncifyRequest(a){return new Promise((b,d)=>{a.onsuccess=()=>b(a.result);a.onerror=()=>d(a.error)})}function asyncifyTransaction(a){return new Promise((b,d)=>{a.oncomplete=()=>b();a.onerror=()=>d(a.error);a.onabort=()=>d(a.error)})}
function openReadOnlyTransaction(a,b){return openTransaction(a,b)}function openWriteTransaction(a,b){return openTransaction(a,b,!0)}async function openTransaction(a,b,d=!1,c=!0){const e=await lazyOpenDatabase(a);try{const g=e.transaction(["keyvaluepairs"],d?"readwrite":"readonly");return b(g)}catch(g){if(c&&"InvalidStateError"===g.name)return DATABASE_PROMISE_MAP.delete(a),openTransaction(a,b,d,!1);throw g;}}
function lazyOpenDatabase(a){RequireString(a);let b=DATABASE_PROMISE_MAP.get(a);b instanceof Promise||(b=openDatabase$jscomp$1(a),DATABASE_PROMISE_MAP.set(a,b),b.catch(d=>DATABASE_PROMISE_MAP.delete(a)));return b}async function openDatabase$jscomp$1(a){RequireString(a);const b=indexedDB.open(a,2);b.addEventListener("upgradeneeded",d=>{try{d.target.result.createObjectStore("keyvaluepairs")}catch(c){console.error(`Failed to create objectstore for database ${a}`,c)}});return asyncifyRequest(b)}
function RequireString(a){if("string"!==typeof a)throw new TypeError("expected string");}function getEntriesFromCursor(a,b){const d=a.objectStore("keyvaluepairs").openCursor();return new Promise(c=>{const e=[];d.onsuccess=g=>{if(g=g.target.result){switch(b){case "entries":e.push([g.key,g.value]);break;case "keys":e.push(g.key);break;case "values":e.push(g.value)}g.continue()}else c(e)}})}
class KVStorageContainer{constructor(a){RequireString(a);this.name=a}async ready(){await lazyOpenDatabase(this.name)}set(a,b){RequireString(a);return openWriteTransaction(this.name,async d=>{var c=d.objectStore("keyvaluepairs").put(b,a);c=asyncifyRequest(c);d=asyncifyTransaction(d);await Promise.all([d,c])})}get(a){RequireString(a);return openReadOnlyTransaction(this.name,async b=>{var d=b.objectStore("keyvaluepairs").get(a);d=asyncifyRequest(d);b=asyncifyTransaction(b);[,b]=await Promise.all([b,
d]);return b})}delete(a){RequireString(a);return openWriteTransaction(this.name,async b=>{var d=b.objectStore("keyvaluepairs").delete(a);d=asyncifyRequest(d);b=asyncifyTransaction(b);await Promise.all([b,d])})}clear(){return openWriteTransaction(this.name,async a=>{var b=a.objectStore("keyvaluepairs").clear();b=asyncifyRequest(b);a=asyncifyTransaction(a);await Promise.all([a,b])})}keys(){return openReadOnlyTransaction(this.name,async a=>{if(SUPPORTS_GETALLKEYS){var b=a.objectStore("keyvaluepairs").getAllKeys();
b=asyncifyRequest(b)}else b=getEntriesFromCursor(a,"keys");a=asyncifyTransaction(a);[,a]=await Promise.all([a,b]);return a})}values(){return openReadOnlyTransaction(this.name,async a=>{if(SUPPORTS_GETALL){var b=a.objectStore("keyvaluepairs").getAll();b=asyncifyRequest(b)}else b=getEntriesFromCursor(a,"values");a=asyncifyTransaction(a);[,a]=await Promise.all([a,b]);return a})}entries(){return openReadOnlyTransaction(this.name,async a=>{var b=getEntriesFromCursor(a,"entries");a=asyncifyTransaction(a);
[,b]=await Promise.all([a,b]);return b})}}self.KVStorageContainer=KVStorageContainer;"use strict";const KVStorageContainer$jscomp$1=self.KVStorageContainer,CRITICAL_ERRORS=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i],memoryStorage=new WeakMap;
let isInMemory=!1;"undefined"===typeof indexedDB&&(isInMemory=!0,console.warn("Unable to use local storage because indexedDB is not defined"));function NOT_IMPLEMENTED(a){throw Error(`"${a}" is not implemented`);}function DISALLOW_CALLBACK(a){if("function"===typeof a)throw Error("localforage callback API is not implemented; please use the promise API instead");}
function StructuredClone(a){return"object"===typeof a?new Promise(b=>{const {port1:d,port2:c}=new MessageChannel;c.onmessage=e=>b(e.data);d.postMessage(a)}):Promise.resolve(a)}
class ForageAdaptor{constructor(a){this._inst=a;memoryStorage.set(this,new Map)}_MaybeSwitchToMemoryFallback(a){if(!isInMemory)for(const b of CRITICAL_ERRORS)if(a&&b.test(a.message)){console.error("Unable to use local storage, reverting to in-memory store: ",a,a.message);isInMemory=!0;break}}async _getItemFallback(a){a=memoryStorage.get(this).get(a);a=await StructuredClone(a);return"undefined"===typeof a?null:a}async _setItemFallback(a,b){b=await StructuredClone(b);memoryStorage.get(this).set(a,b)}_removeItemFallback(a){memoryStorage.get(this).delete(a)}_clearFallback(){memoryStorage.get(this).clear()}_keysFallback(){return Array.from(memoryStorage.get(this).keys())}IsUsingFallback(){return isInMemory}async getItem(a,
b){DISALLOW_CALLBACK(b);if(isInMemory)return await this._getItemFallback(a);let d;try{d=await this._inst.get(a)}catch(c){this._MaybeSwitchToMemoryFallback(c);if(isInMemory)return await this._getItemFallback(a);console.error(`Error reading '${a}' from storage, returning null: `,c);return null}return"undefined"===typeof d?null:d}async setItem(a,b,d){DISALLOW_CALLBACK(d);"undefined"===typeof b&&(b=null);if(isInMemory)await this._setItemFallback(a,b);else try{await this._inst.set(a,b)}catch(c){if(this._MaybeSwitchToMemoryFallback(c),
isInMemory)await this._setItemFallback(a,b);else throw c;}}async removeItem(a,b){DISALLOW_CALLBACK(b);if(isInMemory)this._removeItemFallback(a);else try{await this._inst.delete(a)}catch(d){this._MaybeSwitchToMemoryFallback(d),isInMemory?this._removeItemFallback(a):console.error(`Error removing '${a}' from storage: `,d)}}async clear(a){DISALLOW_CALLBACK(a);if(isInMemory)this._clearFallback();else try{await this._inst.clear()}catch(b){this._MaybeSwitchToMemoryFallback(b),isInMemory?this._clearFallback():
console.error("Error clearing storage: ",b)}}async keys(a){DISALLOW_CALLBACK(a);if(isInMemory)return this._keysFallback();a=[];try{a=await this._inst.keys()}catch(b){this._MaybeSwitchToMemoryFallback(b);if(isInMemory)return this._keysFallback();console.error("Error getting storage keys: ",b)}return a}ready(a){DISALLOW_CALLBACK(a);return isInMemory?Promise.resolve(!0):this._inst.ready()}createInstance(a){if("object"!==typeof a)throw new TypeError("invalid options object");a=a.name;if("string"!==typeof a)throw new TypeError("invalid store name");
a=new KVStorageContainer$jscomp$1(a);return new ForageAdaptor(a)}length(a){NOT_IMPLEMENTED("localforage.length()")}key(a,b){NOT_IMPLEMENTED("localforage.key()")}iterate(a,b){NOT_IMPLEMENTED("localforage.iterate()")}setDriver(a){NOT_IMPLEMENTED("localforage.setDriver()")}config(a){NOT_IMPLEMENTED("localforage.config()")}defineDriver(a){NOT_IMPLEMENTED("localforage.defineDriver()")}driver(){NOT_IMPLEMENTED("localforage.driver()")}supports(a){NOT_IMPLEMENTED("localforage.supports()")}dropInstance(){NOT_IMPLEMENTED("localforage.dropInstance()")}disableMemoryMode(){isInMemory=
!1}}self.localforage=new ForageAdaptor(new KVStorageContainer$jscomp$1("localforage"));"use strict";const C3$jscomp$4=self.C3;C3$jscomp$4.Supports={};C3$jscomp$4.Supports.WebAnimations=(()=>{try{if("undefined"===typeof document)return!1;const a=document.createElement("div");return"undefined"===typeof a.animate?!1:"undefined"!==typeof a.animate([{opacity:"0"},{opacity:"1"}],1E3).reverse}catch(a){return!1}})();C3$jscomp$4.Supports.DialogElement="undefined"!==typeof HTMLDialogElement;
C3$jscomp$4.Supports.RequestIdleCallback=!!self.requestIdleCallback;C3$jscomp$4.Supports.ImageBitmap=!!self.createImageBitmap;C3$jscomp$4.Supports.ImageBitmapOptions=!1;C3$jscomp$4.Supports.ImageBitmapOptionsResize=!1;
if(C3$jscomp$4.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{premultiplyAlpha:"none"}).then(()=>{C3$jscomp$4.Supports.ImageBitmapOptions=!0}).catch(()=>{C3$jscomp$4.Supports.ImageBitmapOptions=!1})}catch(a){C3$jscomp$4.Supports.ImageBitmapOptions=!1}try{self.createImageBitmap(new ImageData(32,32),{resizeWidth:10,resizeHeight:10}).then(a=>{C3$jscomp$4.Supports.ImageBitmapOptionsResize=10===a.width&&10===a.height}).catch(()=>{C3$jscomp$4.Supports.ImageBitmapOptionsResize=!1})}catch(a){C3$jscomp$4.Supports.ImageBitmapOptionsResize=
!1}}C3$jscomp$4.Supports.ClipboardReadText=!(!navigator.clipboard||!navigator.clipboard.readText||"Firefox"===C3$jscomp$4.Platform.Browser);C3$jscomp$4.Supports.PermissionsQuery=!(!navigator.permissions||!navigator.permissions.query);C3$jscomp$4.Supports.ClipboardPermissionsQuery=!1;C3$jscomp$4.Supports.PermissionsQuery&&navigator.permissions.query({name:"clipboard-read"}).then(()=>{C3$jscomp$4.Supports.ClipboardPermissionsQuery=!0}).catch(()=>{C3$jscomp$4.Supports.ClipboardPermissionsQuery=!1});
C3$jscomp$4.Supports.AsyncClipboardApi=!!(navigator.permissions&&navigator.clipboard&&self.ClipboardItem);C3$jscomp$4.Supports.Proxies="undefined"!==typeof Proxy;C3$jscomp$4.Supports.DownloadAttribute=(()=>"undefined"===typeof document?!1:"undefined"!==typeof document.createElement("a").download)();C3$jscomp$4.Supports.Fetch="function"===typeof fetch;C3$jscomp$4.Supports.PersistentStorage=!!(self.isSecureContext&&"Opera"!==C3$jscomp$4.Platform.Browser&&navigator.storage&&navigator.storage.persist);
C3$jscomp$4.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator.storage&&navigator.storage.estimate);C3$jscomp$4.Supports.Fullscreen=(()=>{if("undefined"===typeof document||"iOS"===C3$jscomp$4.Platform.OS)return!1;const a=document.documentElement;return!!(a.requestFullscreen||a.msRequestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen)})();C3$jscomp$4.Supports.ImageDecoder="undefined"!==typeof self.ImageDecoder;C3$jscomp$4.Supports.WebCodecs=!!self.VideoEncoder;
C3$jscomp$4.Supports.NativeFileSystemAPI=!!self.showOpenFilePicker;C3$jscomp$4.Supports.QueryLocalFonts=!!self.queryLocalFonts;C3$jscomp$4.Supports.UserActivation=!!navigator.userActivation;C3$jscomp$4.Supports.CanvasToBlobWebP=!1;
(async()=>{let a;"undefined"===typeof document?a=new OffscreenCanvas(32,32):(a=document.createElement("canvas"),a.width=32,a.height=32);var b=a.getContext("2d");b.fillStyle="blue";b.fillRect(0,0,32,32);b=null;try{a.convertToBlob?b=await a.convertToBlob({type:"image/webp",quality:1}):a.toBlob&&(b=await new Promise(d=>a.toBlob(d,"image/webp",1))),C3$jscomp$4.Supports.CanvasToBlobWebP=b&&"image/webp"===b.type}catch(d){C3$jscomp$4.Supports.CanvasToBlobWebP=!1}})();"use strict";const C3$jscomp$5=self.C3;
if(!String.prototype.trimStart){const a=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function(){return this.replace(a,"")}}if(!String.prototype.trimEnd){const a=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function(){return this.replace(a,"")}}
String.prototype.replaceAll||(String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(C3$jscomp$5.EscapeRegex(a),"g"),b)});Array.prototype.values||(Array.prototype.values=function*(){for(const a of this)yield a});if(!Array.prototype.flat){function a(b,d){return b.reduce((c,e)=>{0<d&&Array.isArray(e)?Array.prototype.push.apply(c,a(e,d-1)):c.push(e);return c},[])}Array.prototype.flat=function(b=1){return a(this,b)}}
Array.prototype.at||(Array.prototype.at=function(a){a=Math.trunc(a)||0;0>a&&(a+=this.length);if(!(0>a||a>=this.length))return this[a]});String.prototype.at||(String.prototype.at=function(a){a=Math.trunc(a)||0;0>a&&(a+=this.length);if(!(0>a||a>=this.length))return this[a]});RegExp.escape||(RegExp.escape=function(a){return String(a).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")});
navigator.storage&&!navigator.storage.estimate&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota&&(navigator.storage.estimate=function(){return new Promise((a,b)=>navigator.webkitTemporaryStorage.queryUsageAndQuota((d,c)=>a({usage:d,quota:c}),b))});"undefined"===typeof self.isSecureContext&&(self.isSecureContext="https:"===location.protocol);"undefined"===typeof self.globalThis&&(self.globalThis=self);"use strict";const C3$jscomp$6=self.C3;
function assertFail(a){let b=C3$jscomp$6.GetCallStack();console.error("Assertion failure: "+a+"\n\nStack trace:\n"+b)}self.assert=function(a,b){a||assertFail(b)};"use strict";const C3$jscomp$7=self.C3,C3X=self.C3X;C3$jscomp$7.IsNumber=function(a){return"number"===typeof a};C3$jscomp$7.IsFiniteNumber=function(a){return C3$jscomp$7.IsNumber(a)&&isFinite(a)};C3$jscomp$7.RequireNumber=function(a){if(!C3$jscomp$7.IsNumber(a))throw new TypeError("expected number");};C3$jscomp$7.RequireOptionalNumber=function(a){C3$jscomp$7.IsNullOrUndefined(a)};
C3$jscomp$7.RequireNumberInRange=function(a,b,d){if(!C3$jscomp$7.IsNumber(a)||isNaN(a)||b>a||d<a)throw new RangeError("number outside of range");};C3$jscomp$7.RequireAllNumber=function(...a){for(let b of a);};C3$jscomp$7.RequireFiniteNumber=function(a){if(!C3$jscomp$7.IsFiniteNumber(a))throw new TypeError("expected finite number");};C3$jscomp$7.RequireOptionalFiniteNumber=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllFiniteNumber=function(...a){for(let b of a);};
C3$jscomp$7.IsString=function(a){return"string"===typeof a};C3$jscomp$7.RequireString=function(a){if(!C3$jscomp$7.IsString(a))throw new TypeError("expected string");};C3$jscomp$7.RequireOptionalString=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllString=function(...a){for(let b of a);};C3$jscomp$7.IsSimpleObject=function(a){return"object"!==typeof a||null===a?!1:(a=Object.getPrototypeOf(a))?a.constructor===Object:null===a};
C3$jscomp$7.RequireSimpleObject=function(a){if(!C3$jscomp$7.IsSimpleObject(a))throw new TypeError("expected simple object");};C3$jscomp$7.RequireOptionalSimpleObject=function(a){if(!C3$jscomp$7.IsNullOrUndefined(a)&&!C3$jscomp$7.IsSimpleObject(a))throw new TypeError("expected simple object");};C3$jscomp$7.IsObject=function(a){return"object"===typeof a&&null!==a&&!Array.isArray(a)};C3$jscomp$7.RequireObject=function(a){if(!C3$jscomp$7.IsObject(a))throw new TypeError("expected object");};
C3$jscomp$7.RequireOptionalObject=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllObject=function(...a){for(let b of a);};C3$jscomp$7.IsFileLike=function(a){return C3$jscomp$7.WeakIsInstanceOf(a,Blob)&&"string"===typeof a.name};C3$jscomp$7.RequireFileLike=function(a){if(!C3$jscomp$7.IsFileLike(a))throw new TypeError("expected file");};C3$jscomp$7.RequireOptionalFileLike=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.IsArray=function(a){return Array.isArray(a)};
C3$jscomp$7.RequireArray=function(a){if(!C3$jscomp$7.IsArray(a))throw new TypeError("expected array");};C3$jscomp$7.RequireOptionalArray=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllArray=function(...a){for(let b of a);};C3$jscomp$7.Is2DArray=function(a){return C3$jscomp$7.IsArray(a)?a.length?C3$jscomp$7.IsArray(a[0])?!0:!1:!0:!1};
C3$jscomp$7.Require2DArray=function(a){if(!C3$jscomp$7.Is2DArray(a))throw new TypeError("expected 2d array");for(let b of a)if(!C3$jscomp$7.IsArray(b))throw new TypeError("expected 2d array");};C3$jscomp$7.RequireOptional2DArray=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.IsFunction=function(a){return"function"===typeof a};
C3$jscomp$7.RequireFunction=function(a,b){if(!C3$jscomp$7.IsFunction(a))throw new TypeError("expected function");if(!C3$jscomp$7.IsNullOrUndefined(b)&&a!==b)throw new TypeError("expected same function reference");};C3$jscomp$7.RequireOptionalFunction=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllFunction=function(...a){for(let b of a);};
C3$jscomp$7.RequireAnyFunction=function(a,...b){if(!C3$jscomp$7.IsFunction(a))throw new TypeError("expected function");if(!b.length)throw Error("missing comparison functions");for(let d of b)if(!C3$jscomp$7.IsNullOrUndefined(d)&&a===d)return;throw new TypeError("expected same function reference");};C3$jscomp$7.RequireOptionalAllFunction=function(...a){if(!C3$jscomp$7.IsNullOrUndefined(a))for(let b of a);};C3$jscomp$7.IsInstanceOf=function(a,b){return a instanceof b};
C3$jscomp$7.IsInstanceOfAny=function(a,...b){for(let d of b)if(C3$jscomp$7.IsInstanceOf(a,d))return!0;return!1};C3$jscomp$7.RequireInstanceOf=function(a,b){if(!C3$jscomp$7.IsInstanceOf(a,b))throw new TypeError("unexpected type");};C3$jscomp$7.RequireOptionalInstanceOf=function(a,b){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllInstanceOf=function(a,...b){for(let d of b);};
C3$jscomp$7.RequireAnyInstanceOf=function(a,...b){if(!C3$jscomp$7.IsInstanceOfAny(a,...b))throw new TypeError("unexpected type");};C3$jscomp$7.RequireAnyOptionalInstanceOf=function(a,...b){if(!C3$jscomp$7.IsNullOrUndefined(a)&&!C3$jscomp$7.IsInstanceOfAny(a,...b))throw new TypeError("unexpected type");};C3$jscomp$7.IsArrayOf=function(a,b){for(let d of a)if(!C3$jscomp$7.IsInstanceOf(d,b))return!1;return!0};
C3$jscomp$7.IsArrayOfFiniteNumbers=function(a){for(let b of a)if(!C3$jscomp$7.IsFiniteNumber(b))return!1;return!0};C3$jscomp$7.RequireArrayOf=function(a,b){for(let d of a);};C3$jscomp$7.RequireOptionalArrayOf=function(a,b){if(!C3$jscomp$7.IsNullOrUndefined(a))for(let d of a);};C3$jscomp$7.RequireArrayOfAny=function(a,...b){for(let d of a);};C3$jscomp$7.RequireOptionalArrayOfAny=function(a,...b){if(!C3$jscomp$7.IsNullOrUndefined(a))for(let d of a);};
C3$jscomp$7.IsDOMNode=function(a,b){return C3$jscomp$7.IsNullOrUndefined(a)||!C3$jscomp$7.IsString(a.nodeName)?!1:!b||C3$jscomp$7.equalsNoCase(a.nodeName,b)};C3$jscomp$7.RequireDOMNode=function(a,b){if(C3$jscomp$7.IsNullOrUndefined(a)||!C3$jscomp$7.IsString(a.nodeName))throw new TypeError("expected DOM node");if(b&&!C3$jscomp$7.equalsNoCase(a.nodeName,b))throw new TypeError(`expected DOM '${b}' node`);};C3$jscomp$7.RequireOptionalDOMNode=function(a,b){C3$jscomp$7.IsNullOrUndefined(a)};
C3$jscomp$7.IsHTMLElement=function(a,b){return C3$jscomp$7.IsNullOrUndefined(a)||!C3$jscomp$7.IsString(a.tagName)?!1:!b||C3$jscomp$7.equalsNoCase(a.tagName,b)};C3$jscomp$7.RequireHTMLElement=function(a,b){if(C3$jscomp$7.IsNullOrUndefined(a)||!C3$jscomp$7.IsString(a.tagName))throw new TypeError("expected HTML element");if(b&&!C3$jscomp$7.equalsNoCase(a.tagName,b))throw new TypeError(`expected HTML '${b}' element`);};C3$jscomp$7.RequireOptionalHTMLElement=function(a,b){C3$jscomp$7.IsNullOrUndefined(a)};
C3$jscomp$7.IsDrawable=function(a){return C3$jscomp$7.IsHTMLElement(a,"img")||C3$jscomp$7.IsHTMLElement(a,"canvas")||C3$jscomp$7.IsHTMLElement(a,"video")||"undefined"!==typeof OffscreenCanvas&&a instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap};C3$jscomp$7.RequireDrawable=function(a){if(!C3$jscomp$7.IsDrawable(a))throw new TypeError("expected drawable");};C3$jscomp$7.RequireOptionalDrawable=function(a){C3$jscomp$7.IsNullOrUndefined(a)};
C3$jscomp$7.IsDrawableOrImageData=function(a){return a instanceof ImageData?!0:C3$jscomp$7.IsDrawable(a)};C3$jscomp$7.RequireDrawableOrImageData=function(a){if(!C3$jscomp$7.IsDrawableOrImageData(a))throw new TypeError("expected drawable or image data");};C3$jscomp$7.RequireOptionalDrawableOrImageData=function(a){if(!C3$jscomp$7.IsNullOrUndefined(a)&&!C3$jscomp$7.IsDrawableOrImageData(a))throw new TypeError("expected drawable or image data");};
C3$jscomp$7.IsStringLike=function(a){return"string"===typeof a||C3$jscomp$7.HtmlString&&a instanceof C3$jscomp$7.HtmlString||a instanceof C3$jscomp$7.BBString};C3$jscomp$7.RequireStringLike=function(a){if(!C3$jscomp$7.IsStringLike(a))throw new TypeError("expected string-like");};C3$jscomp$7.RequireOptionalStringLike=function(a){C3$jscomp$7.IsNullOrUndefined(a)};C3$jscomp$7.RequireAllStringLike=function(...a){for(let b of a);};
C3$jscomp$7.RequireOverride=function(){throw Error("must be overridden");};C3$jscomp$7.NotYetImplemented=function(){throw Error("not yet implemented");};C3$jscomp$7.IsDefined=function(a,...b){if("undefined"===typeof a)return!1;for(let d of b){if("undefined"===typeof a[d])return!1;a=a[d]}return!0};C3$jscomp$7.IsNullOrUndefined=function(a){return"undefined"===typeof a||null===a};C3$jscomp$7.AreArrayElementsOfSameType=function(a){let b=a[0].constructor;for(let d of a)if(d.constructor!==b)return!1;return b};
C3$jscomp$7.AreArrayElementsOfType=function(a,b){for(let d of a)if(!(d instanceof b))return!1;return!0};const TypedArray$jscomp$1=Object.getPrototypeOf(Uint8Array);C3$jscomp$7.IsTypedArray=function(a){return C3$jscomp$7.IsInstanceOf(a,TypedArray$jscomp$1)};C3$jscomp$7.RequireTypedArray=function(a){};C3$jscomp$7.WeakRequireTypedArray=function(a){C3$jscomp$7.WeakRequireInstanceOf(a,TypedArray$jscomp$1)};
C3$jscomp$7.WeakRequireAnyInstanceOf=function(a,...b){if(!C3$jscomp$7.WeakIsAnyInstanceOf(a,...b))throw new TypeError("unexpected type");};C3$jscomp$7.WeakIsAnyInstanceOf=function(a,...b){for(const d of b)if(C3$jscomp$7.WeakIsInstanceOf(a,d))return!0;return!1};C3$jscomp$7.WeakRequireInstanceOf=function(a,b){if(!C3$jscomp$7.WeakIsInstanceOf(a,b))throw new TypeError("unexpected type");};
C3$jscomp$7.WeakIsInstanceOf=function(a,b){for(;a=Object.getPrototypeOf(a);)if(a.constructor.name===b.name)return!0;return!1};C3X.RequireNumber=C3$jscomp$7.RequireNumber;C3X.RequireOptionalNumber=C3$jscomp$7.RequireOptionalNumber;C3X.RequireFiniteNumber=C3$jscomp$7.RequireFiniteNumber;C3X.RequireOptionalFiniteNumber=C3$jscomp$7.RequireOptionalFiniteNumber;C3X.RequireString=C3$jscomp$7.RequireString;C3X.RequireOptionalString=C3$jscomp$7.RequireOptionalString;C3X.RequireObject=C3$jscomp$7.RequireObject;
C3X.RequireOptionalObject=C3$jscomp$7.RequireOptionalObject;C3X.RequireArray=C3$jscomp$7.RequireArray;C3X.RequireOptionalArray=C3$jscomp$7.RequireOptionalArray;C3X.RequireFunction=C3$jscomp$7.RequireFunction;C3X.RequireOptionalFunction=C3$jscomp$7.RequireOptionalFunction;C3X.RequireInstanceOf=C3$jscomp$7.RequireInstanceOf;C3X.RequireOptionalInstanceOf=C3$jscomp$7.RequireOptionalInstanceOf;C3X.IsNullOrUndefined=C3$jscomp$7.IsNullOrUndefined;"use strict";const C3$jscomp$8=self.C3,logRafIds=new Map;
C3$jscomp$8.ColorLog=function(a,b){console.log(`%c${a}`,`font-weight: bold; color:${b}`)};C3$jscomp$8.RafLog=function(a,...b){logRafIds.has(a)||logRafIds.set(a,-1);-1===logRafIds.get(a)&&logRafIds.set(a,requestAnimationFrame(()=>{console.log(`%c${a}`,"font-weight: bold",...b);logRafIds.set(a,-1)}))};let measures;C3$jscomp$8.StartMeasure=function(a){performance.mark(a);measures||(measures=new Map);measures.has(a)||measures.set(a,{current:0,total:0,average:0,calls:1,toString:function(){return`${a} :: current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => ${this.calls}`}})};
C3$jscomp$8.EndMeasure=function(a){performance.measure(`measure-${a}`,a);const b=performance.getEntriesByName(`measure-${a}`)[0],d=measures.get(a);d.current=b.duration;d.total+=d.current;d.average=d.total/d.calls;console.log(d.toString());d.calls++;performance.clearMarks(a);performance.clearMeasures(`measure-${a}`)};C3$jscomp$8.GetCallStack=function(){return Error().stack};C3$jscomp$8.Debugger=function(){debugger};C3$jscomp$8.cast=function(a,b){return a&&a instanceof b?a:null};
C3$jscomp$8.getName=function(a){return"undefined"===typeof a?"undefined":null===a?"null":"boolean"===typeof a?"<boolean>":C3$jscomp$8.IsNumber(a)?"<number>":C3$jscomp$8.IsString(a)?"<string>":C3$jscomp$8.IsArray(a)?"<array>":"symbol"===typeof a?"<"+a.toString()+">":C3$jscomp$8.IsFunction(a)?a.name&&"Function"!==a.name?a.name:"<anonymous function>":"object"===typeof a?a.constructor&&a.constructor.name&&"Object"!==a.constructor.name?a.constructor.name:"<anonymous object>":"<unknown>"};
C3$jscomp$8.getType=function(a){return null===a?"null":Array.isArray(a)?"array":typeof a};C3$jscomp$8.range=function*(a,b){if(!isFinite(Math.abs(a-b)))throw Error("Invalid parameters");if(a>b)for(--a;a>=b;a--)yield a;else for(;a<b;a++)yield a};function isValidTypeChange(a,b){a=C3$jscomp$8.getType(a);b=C3$jscomp$8.getType(b);return"null"===a||"null"===b?!0:"undefined"===a||"undefined"===b?!1:a===b}let ctorObjectToProxy=new Map,ctorProxyToObject=new Map,proxyToObject=new WeakMap,releasedObjects=new WeakMap;
C3$jscomp$8.DefendHandler={};const VALID_GET_MISSING_KEYS=new Set(["then","splice"]);function logDefendedObjectWarning(a){console.warn("[Defence] "+a+" @",C3$jscomp$8.GetCallStack())}
C3$jscomp$8.DefendHandler.get=function(a,b){b in a||"symbol"===typeof b||VALID_GET_MISSING_KEYS.has(b)||logDefendedObjectWarning(`Accessed missing property '${b}' from defended object '${C3$jscomp$8.getName(a)}', returning undefined`);releasedObjects.has(a)&&"symbol"!==typeof b&&!VALID_GET_MISSING_KEYS.has(b)&&logDefendedObjectWarning(`Accessed property '${b}' on a released object '${C3$jscomp$8.getName(a)}'\nObject was originally released at: ${releasedObjects.get(a)})\nCall stack at access: `);return a[b]};
C3$jscomp$8.DefendHandler.set=function(a,b,d){b in a||ctorObjectToProxy.has(a)||logDefendedObjectWarning(`Set non-existent property '${b}' to '${d}' on defended object '${C3$jscomp$8.getName(a)}'`);isValidTypeChange(a[b],d)||ctorObjectToProxy.has(a)||logDefendedObjectWarning(`Set '${C3$jscomp$8.getType(a[b])}' property '${b}' to type '${C3$jscomp$8.getType(d)}' on defended object '${C3$jscomp$8.getName(a)}'`);releasedObjects.has(a)&&logDefendedObjectWarning(`Set property '${b}' on a released object '${C3$jscomp$8.getName(a)}'\nObject was originally released at: ${releasedObjects.get(a)})\nCall stack at access: `);
a[b]=d;return!0};C3$jscomp$8.DefendHandler.deleteProperty=function(a,b){throw new ReferenceError(`Cannot delete property '${b}' from defended object '${C3$jscomp$8.getName(a)}'`);};C3$jscomp$8.DefendHandler.defineProperty=function(a,b,d){throw new ReferenceError(`Cannot define property '${b}' on defended object '${C3$jscomp$8.getName(a)}'`);};C3$jscomp$8.DefendHandler.enumerate=function(a){throw new ReferenceError(`Cannot enumerate defended object '${C3$jscomp$8.getName(a)}'`);};let checkRafId=-1;
function CheckDefendedObjectsUsedCorrectly(){checkRafId=-1;if(0<ctorObjectToProxy.size||0<ctorProxyToObject.size){let a=[...(new Set([...ctorObjectToProxy.keys()].map(b=>C3$jscomp$8.getName(b))))].join();console.warn(`An object derived from DefendedBase was not protected with debugDefend(). This will disable some checks. See the coding guidelines! Possible affected class names: ${a}`);ctorObjectToProxy.clear();ctorProxyToObject.clear()}}
C3$jscomp$8.DefendedBase=class{constructor(){if(C3$jscomp$8.isDebugDefend&&C3$jscomp$8.Supports.Proxies){var a=new.target;a=Object.create(a.prototype);var b=new Proxy(a,C3$jscomp$8.DefendHandler);ctorObjectToProxy.set(a,b);ctorProxyToObject.set(b,a);proxyToObject.set(b,a);-1===checkRafId&&(checkRafId=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly));return b}}};
C3$jscomp$8.debugDefend=function(a){if(C3$jscomp$8.isDebugDefend&&C3$jscomp$8.Supports.Proxies&&a instanceof C3$jscomp$8.DefendedBase){if(!ctorProxyToObject.has(a))return a;let b=ctorProxyToObject.get(a);ctorProxyToObject.delete(a);ctorObjectToProxy.delete(b);return a}return C3$jscomp$8.isDebug?Object.seal(a):a};
C3$jscomp$8.New=function(a,...b){let d;try{d=new a(...b)}catch(c){throw ctorProxyToObject.clear(),ctorObjectToProxy.clear(),c;}C3$jscomp$8.isDebugDefend&&VerifyObjectPropertiesConsistent(a,d);return C3$jscomp$8.debugDefend(d)};C3$jscomp$8.Release=function(a){(a=proxyToObject.get(a))&&releasedObjects.set(a,C3$jscomp$8.GetCallStack())};C3$jscomp$8.WasReleased=function(a){return(a=proxyToObject.get(a))?!!releasedObjects.get(a):!1};let typeProperties=new Map;
function getObjectPropertySet(a){let b=new Set;for(let d in a)b.add(d);return b}function VerifyObjectPropertiesConsistent(a,b){b=getObjectPropertySet(b);let d=typeProperties.get(a);if(d){let c=[];for(let e of d.values())b.has(e)?b.delete(e):c.push(e);C3$jscomp$8.appendArray(c,[...b]);c.length&&console.warn(`[Defence] '${C3$jscomp$8.getName(a)}' constructor creates inconsistent properties: ${c.join(", ")}`)}else typeProperties.set(a,b)}
C3$jscomp$8.PerfMark=class{constructor(a){this._name="";a&&this.start(a)}start(a){C3$jscomp$8.isPerformanceProfiling&&(this._name=a,performance.mark(this._name+"-Start"))}end(){C3$jscomp$8.isPerformanceProfiling&&(performance.mark(this._name+"-End"),performance.measure(this._name,this._name+"-Start",this._name+"-End"))}next(a){C3$jscomp$8.isPerformanceProfiling&&(this.end(),this._name=a,performance.mark(this._name+"-Start"))}};"use strict";
const C3$jscomp$9=self.C3,TWO_PI=2*Math.PI,D_TO_R=Math.PI/180,R_TO_D=180/Math.PI;C3$jscomp$9.wrap=function(a,b,d){a=Math.floor(a);b=Math.floor(b);d=Math.floor(d);const c=d-b;return 0===c?d:a<b?(a=d-(b-a)%c,a===d?0:a):b+(a-b)%c};C3$jscomp$9.mapToRange=function(a,b,d,c,e){d-=b;return 0===d&&0===c?a:(a-b)*(e-c)/d+c};C3$jscomp$9.normalize=function(a,b,d){return 0===b-d?1:(a-b)/(d-b)};C3$jscomp$9.clamp=function(a,b,d){return a<b?b:a>d?d:a};
C3$jscomp$9.clampAngle=function(a){a%=TWO_PI;0>a&&(a+=TWO_PI);return a};C3$jscomp$9.toRadians=function(a){return a*D_TO_R};C3$jscomp$9.toDegrees=function(a){return a*R_TO_D};C3$jscomp$9.distanceTo=function(a,b,d,c){return Math.hypot(d-a,c-b)};C3$jscomp$9.distanceSquared=function(a,b,d,c){a=d-a;b=c-b;return a*a+b*b};C3$jscomp$9.angleTo=function(a,b,d,c){return Math.atan2(c-b,d-a)};
C3$jscomp$9.angleDiff=function(a,b){if(a===b)return 0;a=Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b);return 1<=a?0:-1>=a?Math.PI:Math.acos(a)};C3$jscomp$9.angleRotate=function(a,b,d){let c=Math.sin(a),e=Math.cos(a),g=Math.sin(b),k=Math.cos(b);return Math.acos(c*g+e*k)>d?0<e*g-c*k?C3$jscomp$9.clampAngle(a+d):C3$jscomp$9.clampAngle(a-d):C3$jscomp$9.clampAngle(b)};C3$jscomp$9.angleClockwise=function(a,b){return 0>=Math.cos(a)*Math.sin(b)-Math.sin(a)*Math.cos(b)};
C3$jscomp$9.angleLerp=function(a,b,d,c=0){let e=C3$jscomp$9.angleDiff(a,b);c*=TWO_PI;return C3$jscomp$9.angleClockwise(b,a)?C3$jscomp$9.clampAngle(a+(e+c)*d):C3$jscomp$9.clampAngle(a-(e+c)*d)};C3$jscomp$9.angleLerpClockwise=function(a,b,d,c=0){const e=C3$jscomp$9.angleDiff(a,b);c*=TWO_PI;return C3$jscomp$9.angleClockwise(b,a)?C3$jscomp$9.clampAngle(a+(e+c)*d):C3$jscomp$9.clampAngle(a+(TWO_PI-e+c)*d)};
C3$jscomp$9.angleLerpAntiClockwise=function(a,b,d,c=0){const e=C3$jscomp$9.angleDiff(a,b);c*=TWO_PI;return C3$jscomp$9.angleClockwise(b,a)?C3$jscomp$9.clampAngle(a-(-TWO_PI+e-c)*d):C3$jscomp$9.clampAngle(a-(e+c)*d)};C3$jscomp$9.angleReflect=function(a,b){const d=C3$jscomp$9.angleDiff(a,b);return C3$jscomp$9.angleClockwise(a,b)?C3$jscomp$9.clampAngle(b-d):C3$jscomp$9.clampAngle(b+d)};C3$jscomp$9.lerp=function(a,b,d){return a+d*(b-a)};C3$jscomp$9.unlerp=function(a,b,d){return a===b?0:(d-a)/(b-a)};
C3$jscomp$9.relerp=function(a,b,d,c,e){return C3$jscomp$9.lerp(c,e,C3$jscomp$9.unlerp(a,b,d))};C3$jscomp$9.qarp=function(a,b,d,c){return C3$jscomp$9.lerp(C3$jscomp$9.lerp(a,b,c),C3$jscomp$9.lerp(b,d,c),c)};C3$jscomp$9.cubic=function(a,b,d,c,e){return C3$jscomp$9.lerp(C3$jscomp$9.qarp(a,b,d,e),C3$jscomp$9.qarp(b,d,c,e),e)};C3$jscomp$9.cosp=function(a,b,d){return(a+b+(a-b)*Math.cos(d*Math.PI))/2};C3$jscomp$9.isPOT=function(a){return 0<a&&0===(a-1&a)};
C3$jscomp$9.nextHighestPowerOfTwo=function(a){--a;for(let b=1;32>b;b<<=1)a|=a>>b;return a+1};C3$jscomp$9.roundToNearestFraction=function(a,b){return Math.round(a*b)/b};C3$jscomp$9.floorToNearestFraction=function(a,b){return Math.floor(a*b)/b};C3$jscomp$9.roundToDp=function(a,b){b=Math.max(Math.floor(b),0);b=Math.pow(10,b);return Math.round(a*b)/b};C3$jscomp$9.countDecimals=function(a){return Math.floor(a)!==a?a.toString().split(".")[1].length||0:0};
C3$jscomp$9.toFixed=function(a,b){a=a.toFixed(b);for(b=a.length-1;0<=b&&"0"===a.charAt(b);--b);0<=b&&"."===a.charAt(b)&&--b;return 0>b?a:a.substr(0,b+1)};C3$jscomp$9.PackRGB=function(a,b,d){return C3$jscomp$9.clamp(a,0,255)|C3$jscomp$9.clamp(b,0,255)<<8|C3$jscomp$9.clamp(d,0,255)<<16};
C3$jscomp$9.PackRGBAEx=function(a,b,d,c){a=C3$jscomp$9.clamp(Math.floor(1024*a),-8192,8191);b=C3$jscomp$9.clamp(Math.floor(1024*b),-8192,8191);d=C3$jscomp$9.clamp(Math.floor(1024*d),-8192,8191);c=C3$jscomp$9.clamp(Math.floor(1023*c),0,1023);0>a&&(a+=16384);0>b&&(b+=16384);0>d&&(d+=16384);return-(274877906944*a+16777216*b+1024*d+c)};C3$jscomp$9.PackRGBEx=function(a,b,d){return C3$jscomp$9.PackRGBAEx(a,b,d,1)};function isNegativeZero(a){return 0===a&&0>1/a}
C3$jscomp$9.GetRValue=function(a){if(0<=a)return(a&255)/255;a=Math.floor(-a/274877906944);8191<a&&(a-=16384);return a/1024};C3$jscomp$9.GetGValue=function(a){if(0<=a)return((a&65280)>>8)/255;a=Math.floor(-a%274877906944/16777216);8191<a&&(a-=16384);return a/1024};C3$jscomp$9.GetBValue=function(a){if(0<=a)return((a&16711680)>>16)/255;a=Math.floor(-a%16777216/1024);8191<a&&(a-=16384);return a/1024};C3$jscomp$9.GetAValue=function(a){return isNegativeZero(a)?0:0<=a?1:Math.floor(-a%1024)/1023};
C3$jscomp$9.greatestCommonDivisor=function(a,b){a=Math.floor(a);for(b=Math.floor(b);0!==b;){let d=b;b=a%b;a=d}return a};const COMMON_ASPECT_RATIOS=[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]];C3$jscomp$9.getAspectRatio=function(a,b){a=Math.floor(a);b=Math.floor(b);if(a===b)return[1,1];for(var d of COMMON_ASPECT_RATIOS){let c=a/d[0]*d[1];if(1>Math.abs(b-c))return d.slice(0);c=a/d[1]*d[0];if(1>Math.abs(b-c))return[d[1],d[0]]}d=C3$jscomp$9.greatestCommonDivisor(a,b);return[a/d,b/d]};
C3$jscomp$9.segmentsIntersect=function(a,b,d,c,e,g,k,l){var n=Math.min(a,d),p=Math.max(e,k);if(Math.max(a,d)<Math.min(e,k)||n>p)return!1;n=Math.min(b,c);p=Math.max(g,l);if(Math.max(b,c)<Math.min(g,l)||n>p)return!1;n=e-a+k-d;p=g-b+l-c;a=d-a;b=c-b;e=k-e;g=l-g;l=Math.abs(b*e-g*a);return Math.abs(e*p-g*n)>l?!1:Math.abs(a*p-b*n)<=l};
C3$jscomp$9.segmentsIntersectPreCalc=function(a,b,d,c,e,g,k,l,n,p,r,w){const z=Math.max(n,r);if(g<Math.min(n,r)||e>z)return!1;e=Math.max(p,w);if(l<Math.min(p,w)||k>e)return!1;k=n-a+r-d;l=p-b+w-c;a=d-a;b=c-b;n=r-n;p=w-p;w=Math.abs(b*n-p*a);return Math.abs(n*l-p*k)>w?!1:Math.abs(a*l-b*k)<=w};
C3$jscomp$9.segmentIntersectsQuad=function(a,b,d,c,e){const g=Math.min(a,d),k=Math.max(a,d),l=Math.min(b,c),n=Math.max(b,c),p=e.getTlx(),r=e.getTly(),w=e.getTrx(),z=e.getTry(),B=e.getBrx(),C=e.getBry(),E=e.getBlx();e=e.getBly();return C3$jscomp$9.segmentsIntersectPreCalc(a,b,d,c,g,k,l,n,p,r,w,z)||C3$jscomp$9.segmentsIntersectPreCalc(a,b,d,c,g,k,l,n,w,z,B,C)||C3$jscomp$9.segmentsIntersectPreCalc(a,b,d,c,g,k,l,n,B,C,E,e)||C3$jscomp$9.segmentsIntersectPreCalc(a,b,d,c,g,k,l,n,E,e,p,r)};
C3$jscomp$9.segmentIntersectsAnyN=function(a,b,d,c,e){const g=Math.min(a,d),k=Math.max(a,d),l=Math.min(b,c),n=Math.max(b,c);let p=0;for(let r=e.length-4;p<=r;p+=2)if(C3$jscomp$9.segmentsIntersectPreCalc(a,b,d,c,g,k,l,n,e[p],e[p+1],e[p+2],e[p+3]))return!0;return C3$jscomp$9.segmentsIntersectPreCalc(a,b,d,c,g,k,l,n,e[p],e[p+1],e[0],e[1])};
C3$jscomp$9.rayIntersect=function(a,b,d,c,e,g,k,l){d-=a;g=l-g;const n=d*g-(c-b)*(k-e);if(0===n)return 2;c=((b-c)*(k-a)+d*(l-b))/n;return 0<c&&1.000001>c?(g*(k-a)+(e-k)*(l-b))/n:2};C3$jscomp$9.rayIntersectExtended=function(a,b,d,c,e,g,k,l,n){const p=(k-e)*n;n*=l-g;return C3$jscomp$9.rayIntersect(a,b,d,c,e-p,g-n,k+p,l+n)};
C3$jscomp$9.isPointInTriangleInclusive=function(a,b,d,c,e,g,k,l){e-=d;g-=c;k-=d;l-=c;a-=d;d=b-c;b=e*e+g*g;c=e*k+g*l;e=e*a+g*d;g=k*k+l*l;k=k*a+l*d;l=1/(b*g-c*c);g=(g*e-c*k)*l;e=(b*k-c*e)*l;return 0<=g&&0<=e&&1>=g+e};C3$jscomp$9.triangleCartesianToBarycentric=function(a,b,d,c,e,g,k,l){e-=d;g-=c;k-=d;l-=c;a-=d;const n=b-c;b=e*e+g*g;c=e*k+g*l;d=k*k+l*l;e=a*e+n*g;g=a*k+n*l;k=b*d-c*c;l=(d*e-c*g)/k;e=(b*g-c*e)/k;return[1-l-e,l,e]};
C3$jscomp$9.triangleBarycentricToCartesian3d=function(a,b,d,c,e,g,k,l,n,p,r,w){return[a*c+b*k+d*p,a*e+b*l+d*r,a*g+b*n+d*w]};"use strict";const C3$jscomp$10=self.C3;let mainDocument=null,baseHref="";if("undefined"!==typeof document){mainDocument=document;const a=document.querySelector("base");if(baseHref=a&&a.hasAttribute("href")?a.getAttribute("href"):"")baseHref.startsWith("/")&&(baseHref=baseHref.substr(1)),baseHref.endsWith("/")||(baseHref+="/")}C3$jscomp$10.GetBaseHref=function(){return baseHref};
C3$jscomp$10.GetBaseURL=function(){if(!mainDocument)return"";const a=mainDocument.location;return C3$jscomp$10.GetPathFromURL(a.origin+a.pathname)+baseHref};C3$jscomp$10.GetPathFromURL=function(a){if(!a.length||a.endsWith("/")||a.endsWith("\\"))return a;const b=Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"));return-1===b?"":a.substr(0,b+1)};
C3$jscomp$10.GetFilenameFromURL=function(a){if(!a.length)return a;if(a.endsWith("/")||a.endsWith("\\"))return"";const b=Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"));return-1===b?a:a.substr(b+1)};C3$jscomp$10.GetFileExtension=function(a){let b=a.lastIndexOf(".");return 1>b?"":a.substr(b)};C3$jscomp$10.SetFileExtension=function(a,b){const d=a.lastIndexOf(".");return-1===d?a+"."+b:a.substr(0,d+1)+b};C3$jscomp$10.GetFileNamePart=function(a){let b=a.lastIndexOf(".");return 1>b?a:a.substr(0,b)};
C3$jscomp$10.NormalizeFileSeparator=function(a){return a.replace(/\\/g,"/")};C3$jscomp$10.IsFileExtension=function(a,b){a=a?C3$jscomp$10.GetFileExtension(a).slice(1):"";return b===a};
C3$jscomp$10.FileNameEquals=function(a,b){let d,c;C3$jscomp$10.IsFileLike(a)&&(d=C3$jscomp$10.GetFileNamePart(a.name));C3$jscomp$10.IsString(a)&&(d=C3$jscomp$10.GetFileNamePart(a));C3$jscomp$10.IsFileLike(b)&&(c=C3$jscomp$10.GetFileNamePart(b.name));C3$jscomp$10.IsString(b)&&(c=C3$jscomp$10.GetFileNamePart(b));return d===c};
C3$jscomp$10.ParseFilePath=function(a){a=C3$jscomp$10.NormalizeFileSeparator(a);let b=/^\w:\//.exec(a);b?(b=b[0],a=a.slice(3),"/"!==a[0]&&(a="/"+a)):b="";a=a.replace(/\/{2,}/g,"/");1<a.length&&"/"===a.slice(-1)&&(a=a.slice(0,-1));var d=a.lastIndexOf("/")+1;let c="",e=a,g="";0<d&&(c=a.slice(0,d),e=a.slice(d));a=e;d=e.lastIndexOf(".");0<d&&(g=e.slice(d),a=e.slice(0,-g.length));return{dir:c,base:e,name:a,root:b,ext:g,full:b+c+e}};
C3$jscomp$10.Wait=function(a,b){return new Promise((d,c)=>{self.setTimeout(d,a,b)})};C3$jscomp$10.swallowException=function(a){try{a()}catch(b){C3$jscomp$10.isDebug&&console.warn("Swallowed exception: ",b)}};C3$jscomp$10.noop=function(){};C3$jscomp$10.equalsNoCase=function(a,b){return"string"!==typeof a||"string"!==typeof b?!1:a===b||a.normalize().toLowerCase()===b.normalize().toLowerCase()};
C3$jscomp$10.equalsCase=function(a,b){return"string"!==typeof a||"string"!==typeof b?!1:a===b?!0:a.normalize()===b.normalize()};C3$jscomp$10.typedArraySet16=function(a,b,d){a[d++]=b[0];a[d++]=b[1];a[d++]=b[2];a[d++]=b[3];a[d++]=b[4];a[d++]=b[5];a[d++]=b[6];a[d++]=b[7];a[d++]=b[8];a[d++]=b[9];a[d++]=b[10];a[d++]=b[11];a[d++]=b[12];a[d++]=b[13];a[d++]=b[14];a[d]=b[15]};C3$jscomp$10.truncateArray=function(a,b){a.length=b};
C3$jscomp$10.clearArray=function(a){a&&0!==a.length&&C3$jscomp$10.truncateArray(a,0)};C3$jscomp$10.clear2DArray=function(a){if(a){for(let b=0;b<a.length;b++)C3$jscomp$10.truncateArray(a[b],0);C3$jscomp$10.truncateArray(a,0)}};C3$jscomp$10.extendArray=function(a,b,d){b|=0;var c=a.length;if(!(b<=c))for(;c<b;++c)a.push(d)};C3$jscomp$10.resizeArray=function(a,b,d){b|=0;const c=a.length;b<c?C3$jscomp$10.truncateArray(a,b):b>c&&C3$jscomp$10.extendArray(a,b,d)};
C3$jscomp$10.shallowAssignArray=function(a,b){C3$jscomp$10.clearArray(a);C3$jscomp$10.appendArray(a,b)};C3$jscomp$10.appendArray=function(a,b){if(1E4>b.length)a.push(...b);else for(let d=0,c=b.length;d<c;++d)a.push(b[d])};C3$jscomp$10.arrayRemove=function(a,b){b=Math.floor(b);if(!(0>b||b>=a.length)){for(var d=a.length-1;b<d;++b)a[b]=a[b+1];C3$jscomp$10.truncateArray(a,d)}};C3$jscomp$10.arrayFindRemove=function(a,b){b=a.indexOf(b);0<=b&&a.splice(b,1)};
C3$jscomp$10.arraysEqual=function(a,b){let d=a.length;if(b.length!==d)return!1;for(let c=0;c<d;++c)if(a[c]!==b[c])return!1;return!0};C3$jscomp$10.arrayFilterOut=function(a,b){let d=[],c=0;for(let e=0,g=a.length;e<g;++e){let k=a[e];b(k)?d.push(k):(a[c]=k,++c)}C3$jscomp$10.truncateArray(a,c);return d};C3$jscomp$10.arrayRemoveAllInSet=function(a,b){const d=a.length;let c=0;for(let e=0,g=a.length;e<g;++e){let k=a[e];b.has(k)||(a[c++]=k)}C3$jscomp$10.truncateArray(a,c);return d-c};
C3$jscomp$10.isArrayIndexInBounds=function(a,b){return a!==Math.floor(a)?!1:0<=a&&a<b.length};C3$jscomp$10.validateArrayIndex=function(a,b){if(!C3$jscomp$10.isArrayIndexInBounds(a,b))throw new RangeError("array index out of bounds");};C3$jscomp$10.cloneArray=function(a){return a.slice()};
C3$jscomp$10.deepCloneArray=function(a,b){let d=[];for(let c of a)if(C3$jscomp$10.IsObject(c)){a=b(c);if(!a)throw Error("missing clone");if(a.constructor!==c.constructor)throw Error("object is not a clone");d.push(a)}else C3$jscomp$10.IsArray(c)?d.push(C3$jscomp$10.deepCloneArray(c,b)):d.push(c);return d};C3$jscomp$10.clone2DArray=function(a){let b=[];for(let d of a)b.push(d.slice());return b};C3$jscomp$10.mergeSets=function(a,b){return a.union?a.union(b):new Set([...a,...b])};
C3$jscomp$10.mergeSetsInPlace=function(a,b){for(const d of b)a.add(d);return a};C3$jscomp$10.first=function(a){for(let b of a)return b;return null};C3$jscomp$10.xor=function(a,b){return!a!==!b};C3$jscomp$10.compare=function(a,b,d){switch(b){case 0:return a===d;case 1:return a!==d;case 2:return a<d;case 3:return a<=d;case 4:return a>d;case 5:return a>=d;default:return!1}};C3$jscomp$10.hasAnyOwnProperty=function(a){for(let b in a)if(a.hasOwnProperty(b))return!0;return!1};
C3$jscomp$10.PromiseAllWithProgress=function(a,b){return a.length?new Promise((d,c)=>{const e=[];let g=0,k=!1;for(let l=0,n=a.length;l<n;++l)e.push(void 0),a[l].then(p=>{k||(e[l]=p,++g,g===a.length?d(e):b(g,a.length))}).catch(p=>{k=!0;c(p)})}):Promise.resolve([])};let memoryCallbacks=[];C3$jscomp$10.AddLibraryMemoryCallback=function(a){memoryCallbacks.push(a)};C3$jscomp$10.GetEstimatedLibraryMemoryUsage=function(){let a=0;for(let b of memoryCallbacks){let d=b();a+=d}return Math.floor(a)};
let nextTaskId=1;const activeTaskIds=new Map,taskMessageChannel=new MessageChannel;taskMessageChannel.port2.onmessage=function(a){a=a.data;const b=activeTaskIds.get(a);activeTaskIds.delete(a);b&&b(performance.now())};C3$jscomp$10.RequestUnlimitedAnimationFrame=function(a){const b=nextTaskId++;activeTaskIds.set(b,a);taskMessageChannel.port1.postMessage(b);return b};C3$jscomp$10.CancelUnlimitedAnimationFrame=function(a){activeTaskIds.delete(a)};C3$jscomp$10.PostTask=C3$jscomp$10.RequestUnlimitedAnimationFrame;
C3$jscomp$10.WaitForNextTask=function(){return new Promise(a=>C3$jscomp$10.PostTask(a))};const activeRPAFids=new Set;C3$jscomp$10.RequestPostAnimationFrame=function(a){const b=self.requestAnimationFrame(async d=>{await C3$jscomp$10.WaitForNextTask();activeRPAFids.has(b)&&(activeRPAFids.delete(b),a(d))});activeRPAFids.add(b);return b};C3$jscomp$10.CancelPostAnimationFrame=function(a){activeRPAFids.has(a)&&(self.cancelAnimationFrame(a),activeRPAFids.delete(a))};"use strict";const C3$jscomp$11=self.C3;
C3$jscomp$11.IsAbsoluteURL=function(a){return/^(?:[a-z\-]+:)?\/\//.test(a)||"data:"===a.substr(0,5)||"blob:"===a.substr(0,5)};C3$jscomp$11.IsRelativeURL=function(a){return!C3$jscomp$11.IsAbsoluteURL(a)};C3$jscomp$11.ThrowIfNotOk=function(a){if(!a.ok)throw Error(`fetch '${a.url}' response returned ${a.status} ${a.statusText}`);};C3$jscomp$11.FetchOk=function(a,b){return fetch(a,b).then(d=>{C3$jscomp$11.ThrowIfNotOk(d);return d})};
C3$jscomp$11.FetchText=function(a){return C3$jscomp$11.FetchOk(a).then(b=>b.text())};C3$jscomp$11.FetchJson=function(a){return C3$jscomp$11.FetchOk(a).then(b=>b.json())};C3$jscomp$11.FetchBlob=function(a){return C3$jscomp$11.FetchOk(a).then(b=>b.blob())};C3$jscomp$11.FetchArrayBuffer=function(a){return C3$jscomp$11.FetchOk(a).then(b=>b.arrayBuffer())};C3$jscomp$11.FetchImage=function(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>b(c);c.onerror=e=>d(e);c.src=a})};
C3$jscomp$11.BlobToArrayBuffer=function(a){return"function"===typeof a.arrayBuffer?a.arrayBuffer():new Promise((b,d)=>{const c=new FileReader;c.onload=()=>b(c.result);c.onerror=()=>d(c.error);c.readAsArrayBuffer(a)})};C3$jscomp$11.BlobToString=function(a){return"function"===typeof a.text?a.text():new Promise((b,d)=>{const c=new FileReader;c.onload=()=>b(c.result);c.onerror=()=>d(c.error);c.readAsText(a)})};C3$jscomp$11.BlobToJson=function(a){return C3$jscomp$11.BlobToString(a).then(b=>JSON.parse(b))};
C3$jscomp$11.BlobToImage=async function(a,b){a=URL.createObjectURL(a);try{const d=await C3$jscomp$11.FetchImage(a);URL.revokeObjectURL(a);a="";b&&"function"===typeof d.decode&&await d.decode();return d}finally{a&&URL.revokeObjectURL(a)}};C3$jscomp$11.CreateCanvas=function(a,b){if("undefined"!==typeof document&&"function"===typeof document.createElement){const d=document.createElement("canvas");d.width=a;d.height=b;return d}return new OffscreenCanvas(a,b)};
C3$jscomp$11.CanvasToBlob=function(a,b,d){"number"!==typeof d&&(d=1);b=b||"image/png";d=C3$jscomp$11.clamp(d,0,1);if(a.convertToBlob)return a.convertToBlob({type:b,quality:d});if(a.toBlob)return new Promise(c=>a.toBlob(c,b,d));throw Error("could not convert canvas to blob");};C3$jscomp$11.DrawableToBlob=function(a,b,d){const c=C3$jscomp$11.CreateCanvas(a.width,a.height);c.getContext("2d").drawImage(a,0,0);return C3$jscomp$11.CanvasToBlob(c,b,d)};
C3$jscomp$11.ImageDataToBlob=function(a,b,d){if(C3$jscomp$11.Supports.ImageBitmapOptions)return createImageBitmap(a,{premultiplyAlpha:"none"}).then(e=>C3$jscomp$11.DrawableToBlob(e,b,d));if(C3$jscomp$11.Supports.ImageBitmap)return createImageBitmap(a).then(e=>C3$jscomp$11.DrawableToBlob(e,b,d));const c=C3$jscomp$11.CreateCanvas(a.width,a.height);c.getContext("2d").putImageData(a,0,0);return C3$jscomp$11.CanvasToBlob(c,b,d)};C3$jscomp$11.CopySet=function(a,b){a.clear();for(const d of b)a.add(d)};
C3$jscomp$11.MapToObject=function(a){const b=Object.create(null);for(const [d,c]of a.entries())b[d]=c;return b};C3$jscomp$11.ObjectToMap=function(a,b){b.clear();for(const [d,c]of Object.entries(a))b.set(d,c)};
C3$jscomp$11.ToSuperJSON=function ToSuperJSON(a){if("object"===typeof a&&null!==a){if(a instanceof Set)return{_c3type_:"set",data:[...a].map(c=>ToSuperJSON(c))};if(a instanceof Map)return{_c3type_:"map",data:[...a].map(c=>[c[0],ToSuperJSON(c[1])])};const d=Object.create(null);for(const [c,e]of Object.entries(a))d[c]=ToSuperJSON(e);return d}return a};
C3$jscomp$11.FromSuperJSON=function FromSuperJSON(a){if("object"===typeof a&null!==a){if("set"===a._c3type_)return new Set(a.data.map(c=>FromSuperJSON(c)));if("map"===a._c3type_)return new Map(a.data.map(c=>[c[0],FromSuperJSON(c[1])]));const d=Object.create(null);for(const [c,e]of Object.entries(a))d[c]=FromSuperJSON(e);return d}return a};
C3$jscomp$11.CSSToCamelCase=function(a){if(a.startsWith("--"))return a;let b="",d=!1,c=0;for(const e of a)"-"===e?0<c&&(d=!0):d?(b+=e.toUpperCase(),d=!1):b+=e,++c;return b};C3$jscomp$11.IsIterator=function(a){return"object"===typeof a&&"function"===typeof a.next};C3$jscomp$11.MakeFilledArray=function(a,b){const d=[];if("function"===typeof b)for(var c=0;c<a;++c)d.push(b());else for(c=0;c<a;++c)d.push(b);return d};"use strict";
const C3$jscomp$12=self.C3,HSL_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i,HSLA_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;function padTwoDigits(a){return 0===a.length?"00":1===a.length?"0"+a:a}function hueToRGB(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a}
C3$jscomp$12.Color=class{constructor(a,b,d,c){this._a=this._b=this._g=this._r=0;a instanceof C3$jscomp$12.Color?this.set(a):this.setRgba(a||0,b||0,d||0,c||0)}setRgb(a,b,d){this._r=+a;this._g=+b;this._b=+d;this.clamp();return this}setRgba(a,b,d,c){this._r=+a;this._g=+b;this._b=+d;this._a=+c;this.clamp();return this}set(a){this._r=a._r;this._g=a._g;this._b=a._b;this._a=a._a;return this}copy(a){return this.set(a)}add(a){this._r+=a._r;this._g+=a._g;this._b+=a._b;this._a+=a._a;this.clamp()}addRgb(a,b,
d,c=0){this._r+=+a;this._g+=+b;this._b+=+d;this._a+=+c;this.clamp()}diff(a){this.setR(Math.max(this._r,a._r)-Math.min(this._r,a._r));this.setG(Math.max(this._g,a._g)-Math.min(this._g,a._g));this.setB(Math.max(this._b,a._b)-Math.min(this._b,a._b));this.setA(Math.max(this._a,a._a)-Math.min(this._a,a._a));this.clamp()}copyRgb(a){this._r=a._r;this._g=a._g;this._b=a._b}setR(a){this._r=C3$jscomp$12.clamp(+a,0,1)}getR(){return this._r}setG(a){this._g=C3$jscomp$12.clamp(+a,0,1)}getG(){return this._g}setB(a){this._b=
C3$jscomp$12.clamp(+a,0,1)}getB(){return this._b}setA(a){this._a=C3$jscomp$12.clamp(+a,0,1)}getA(){return this._a}clone(){return C3$jscomp$12.New(C3$jscomp$12.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(a,b){a[b++]=this._r;a[b++]=this._g;a[b++]=this._b;a[b]=this._a}writeRGBToTypedArray(a,b){a[b++]=this._r;a[b++]=this._g;a[b]=this._b}equals(a){return this._r===a._r&&this._g===a._g&&
this._b===a._b&&this._a===a._a}equalsIgnoringAlpha(a){return this._r===a._r&&this._g===a._g&&this._b===a._b}equalsRgb(a,b,d){return this._r===a&&this._g===b&&this._b===d}equalsRgba(a,b,d,c){return this._r===a&&this._g===b&&this._b===d&&this._a===c}equalsF32Array(a,b){return a[b]===Math.fround(this._r)&&a[b+1]===Math.fround(this._g)&&a[b+2]===Math.fround(this._b)&&a[b+3]===Math.fround(this._a)}equalsRGBF32Array(a,b){return a[b]===Math.fround(this._r)&&a[b+1]===Math.fround(this._g)&&a[b+2]===Math.fround(this._b)}multiply(a){this._r*=
a._r;this._g*=a._g;this._b*=a._b;this._a*=a._a}multiplyAlpha(a){this._r*=a;this._g*=a;this._b*=a;this._a*=a}premultiply(){this._r*=this._a;this._g*=this._a;this._b*=this._a;return this}unpremultiply(){this._r/=this._a;this._g/=this._a;this._b/=this._a;return this}clamp(){this._r=C3$jscomp$12.clamp(this._r,0,1);this._g=C3$jscomp$12.clamp(this._g,0,1);this._b=C3$jscomp$12.clamp(this._b,0,1);this._a=C3$jscomp$12.clamp(this._a,0,1);return this}setFromRgbValue(a){this._r=C3$jscomp$12.GetRValue(a);this._g=
C3$jscomp$12.GetGValue(a);this._b=C3$jscomp$12.GetBValue(a);this._a=C3$jscomp$12.GetAValue(a)}getCssRgb(a,b,d){a=C3$jscomp$12.IsFiniteNumber(a)?a:this.getR();b=C3$jscomp$12.IsFiniteNumber(b)?b:this.getG();d=C3$jscomp$12.IsFiniteNumber(d)?d:this.getB();return`rgb(${100*a}%, ${100*b}%, ${100*d}%)`}getCssRgba(a,b,d,c){a=C3$jscomp$12.IsFiniteNumber(a)?a:this.getR();b=C3$jscomp$12.IsFiniteNumber(b)?b:this.getG();d=C3$jscomp$12.IsFiniteNumber(d)?d:this.getB();c=C3$jscomp$12.IsFiniteNumber(c)?c:this.getA();
return`rgba(${100*a}%, ${100*b}%, ${100*d}%, ${c})`}toHexString(){const a=Math.round(255*this.getR()),b=Math.round(255*this.getG()),d=Math.round(255*this.getB());return"#"+padTwoDigits(a.toString(16))+padTwoDigits(b.toString(16))+padTwoDigits(d.toString(16))}parseHexString(a){if("string"!==typeof a)return!1;a=a.trim();"#"===a.charAt(0)&&(a=a.substr(1));let b,d;if(3===a.length)b=parseInt(a[0],16)/15,d=parseInt(a[1],16)/15,a=parseInt(a[2],16)/15;else if(6===a.length)b=parseInt(a.substr(0,2),16)/255,
d=parseInt(a.substr(2,2),16)/255,a=parseInt(a.substr(4,2),16)/255;else return!1;isFinite(b)&&this.setR(b);isFinite(d)&&this.setG(d);isFinite(a)&&this.setB(a);this.setA(1);return!0}toCommaSeparatedRgb(){const a=Math.round(255*this.getR()),b=Math.round(255*this.getG()),d=Math.round(255*this.getB());return`${a}, ${b}, ${d}`}toRgbArray(){const a=Math.round(255*this.getR()),b=Math.round(255*this.getG()),d=Math.round(255*this.getB());return[a,b,d]}parseCommaSeparatedRgb(a){if("string"!==typeof a)return!1;
a=a.replace(/^rgb\(|\)|%/,"");var b=a.split(",");if(3>b.length)return!1;a=parseInt(b[0].trim(),10)/255;const d=parseInt(b[1].trim(),10)/255;b=parseInt(b[2].trim(),10)/255;isFinite(a)&&this.setR(a);isFinite(d)&&this.setG(d);isFinite(b)&&this.setB(b);this.setA(1);return!0}parseCommaSeparatedPercentageRgb(a){if("string"!==typeof a)return!1;a=a.replace(/^rgb\(|\)|%/,"");var b=a.split(",");if(3>b.length)return!1;a=parseInt(b[0].trim(),10)/100;const d=parseInt(b[1].trim(),10)/100;b=parseInt(b[2].trim(),
10)/100;isFinite(a)&&this.setR(a);isFinite(d)&&this.setG(d);isFinite(b)&&this.setB(b);this.setA(1);return!0}parseCommaSeparatedRgba(a){if("string"!==typeof a)return!1;a=a.replace(/^rgba\(|\)|%/,"");var b=a.split(",");if(4>b.length)return!1;a=parseInt(b[0].trim(),10)/255;const d=parseInt(b[1].trim(),10)/255,c=parseInt(b[2].trim(),10)/255;b=parseFloat(b[3].trim());isFinite(a)&&this.setR(a);isFinite(d)&&this.setG(d);isFinite(c)&&this.setB(c);isFinite(b)&&this.setA(b);return!0}parseCommaSeparatedPercentageRgba(a){if("string"!==
typeof a)return!1;a=a.replace(/^rgba\(|\)|%/,"");var b=a.split(",");if(4>b.length)return!1;a=parseInt(b[0].trim(),10)/100;const d=parseInt(b[1].trim(),10)/100,c=parseInt(b[2].trim(),10)/100;b=parseFloat(b[3].trim());isFinite(a)&&this.setR(a);isFinite(d)&&this.setG(d);isFinite(c)&&this.setB(c);isFinite(b)&&this.setA(b);return!0}parseString(a){if("string"!==typeof a)return!1;a=a.replace(/\s+/,"");if(a.includes(",")){if(a.startsWith("rgb("))return a.includes("%")?this.parseCommaSeparatedPercentageRgb(a):
this.parseCommaSeparatedRgb(a);if(a.startsWith("rgba("))return a.includes("%")?this.parseCommaSeparatedPercentageRgba(a):this.parseCommaSeparatedRgba(a);if(a.startsWith("hsl(")||a.startsWith("hsla("))return this.parseHSLString(a);const b=a.split(",");if(a.includes("%")){if(3===b.length)return this.parseCommaSeparatedPercentageRgb(a);if(4===b.length)return this.parseCommaSeparatedPercentageRgba(a)}else{if(3===b.length)return this.parseCommaSeparatedRgb(a);if(4===b.length)return this.parseCommaSeparatedRgba(a)}return!1}return this.parseHexString(a)}toJSON(){return[this._r,
this._g,this._b,this._a]}setFromHSLA(a,b,d,c){a%=360;b=C3$jscomp$12.clamp(b,0,100);d=C3$jscomp$12.clamp(d,0,100);c=C3$jscomp$12.clamp(c,0,1);a/=360;b/=100;d/=100;if(0===b)d=b=a=d;else{const e=.5>d?d*(1+b):d+b-d*b,g=2*d-e;d=hueToRGB(g,e,a+1/3);b=hueToRGB(g,e,a);a=hueToRGB(g,e,a-1/3)}this.setR(d);this.setG(b);this.setB(a);this.setA(c);return this}parseHSLString(a){var b=a.replace(/ |hsl|hsla|\(|\)|;/gi,"");a=HSL_TEST.exec(b);b=HSLA_TEST.exec(b);return a&&4===a.length?(this.setFromHSLA(+a[1],+a[2],+a[3],
1),!0):b&&5===b.length?(this.setFromHSLA(+a[1],+a[2],+a[3],+a[4]),!0):!1}toHSLAString(){var a=this._r;const b=this._g,d=this._b,c=this._a,e=C3$jscomp$12.Color.GetHue(a,b,d),g=C3$jscomp$12.Color.GetSaturation(a,b,d);a=C3$jscomp$12.Color.GetLuminosity(a,b,d);return`hsla(${e}, ${g}%, ${a}%, ${c})`}toHSLAArray(){const a=this._r,b=this._g,d=this._b;return[C3$jscomp$12.Color.GetHue(a,b,d),C3$jscomp$12.Color.GetSaturation(a,b,d),C3$jscomp$12.Color.GetLuminosity(a,b,d),this._a]}setFromJSON(a){!Array.isArray(a)||
3>a.length||(this._r=a[0],this._g=a[1],this._b=a[2],this._a=4<=a.length?a[3]:1)}set r(a){this.setR(a)}get r(){return this.getR()}set g(a){this.setG(a)}get g(){return this.getG()}set b(a){this.setB(a)}get b(){return this.getB()}set a(a){this.setA(a)}get a(){return this.getA()}setAtIndex(a,b){switch(a){case 0:this.setR(b);break;case 1:this.setG(b);break;case 2:this.setB(b);break;case 3:this.setA(b);break;default:throw new RangeError("invalid color index");}}getAtIndex(a){switch(a){case 0:return this.getR();
case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index");}}static Equals(a,b){let d;if(Array.isArray(a))d=new C3$jscomp$12.Color,d.setFromJSON(a);else if(a instanceof C3$jscomp$12.Color)d=a;else throw Error("unexpected type");if(Array.isArray(b))a=new C3$jscomp$12.Color,a.setFromJSON(b);else if(b instanceof C3$jscomp$12.Color)a=b;else throw Error("unexpected type");return d.equals(a)}static DiffChannel(a,b){return C3$jscomp$12.clamp(Math.max(a,
b)-Math.min(a,b),0,1)}static Diff(a,b){const d=new C3$jscomp$12.Color;d.setR(Math.max(a._r,b._r)-Math.min(a._r,b._r));d.setG(Math.max(a._g,b._g)-Math.min(a._g,b._g));d.setB(Math.max(a._b,b._b)-Math.min(a._b,b._b));d.setA(Math.max(a._a,b._a)-Math.min(a._a,b._a));return d}static DiffNoAlpha(a,b){const d=new C3$jscomp$12.Color(0,0,0,1);d.setR(Math.max(a._r,b._r)-Math.min(a._r,b._r));d.setG(Math.max(a._g,b._g)-Math.min(a._g,b._g));d.setB(Math.max(a._b,b._b)-Math.min(a._b,b._b));return d}static GetHue(a,
b,d){const c=Math.max(a,b,d),e=Math.min(a,b,d);if(c===e)return 0;let g=0;switch(c){case a:g=(b-d)/(c-e)+(b<d?6:0);break;case b:g=(d-a)/(c-e)+2;break;case d:g=(a-b)/(c-e)+4}return Math.round(g/6*360)}static GetSaturation(a,b,d){const c=Math.max(a,b,d);a=Math.min(a,b,d);if(c===a)return 0;b=c-a;return Math.round(100*(.5<(c+a)/2?b/(2-c-a):b/(c+a)))}static GetLuminosity(a,b,d){const c=Math.max(a,b,d);return c?Math.round((c+Math.min(a,b,d))/2*100):0}};
C3$jscomp$12.Color.White=Object.freeze(C3$jscomp$12.New(C3$jscomp$12.Color,1,1,1,1));C3$jscomp$12.Color.Black=Object.freeze(C3$jscomp$12.New(C3$jscomp$12.Color,0,0,0,1));C3$jscomp$12.Color.TransparentBlack=Object.freeze(C3$jscomp$12.New(C3$jscomp$12.Color,0,0,0,0));"use strict";const C3$jscomp$13=self.C3;
C3$jscomp$13.Vector2=class{constructor(a,b){this._y=this._x=0;a instanceof C3$jscomp$13.Vector2?this.copy(a):this.set(a||0,b||0)}set(a,b){this._x=+a;this._y=+b}copy(a){this._x=a._x;this._y=a._y}equals(a){return this._x===a._x&&this._y===a._y}equalsValues(a,b){return this._x===a&&this._y===b}equalsF32Array(a,b){return a[b]===Math.fround(this._x)&&a[b+1]===Math.fround(this._y)}setX(a){this._x=+a}getX(){return this._x}setY(a){this._y=+a}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(a,
b){a[b++]=this._x;a[b]=this._y}offset(a,b){this._x+=+a;this._y+=+b}scale(a,b){this._x*=a;this._y*=b}divide(a,b){this._x/=a;this._y/=b}round(){this._x=Math.round(this._x);this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x);this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x);this._y=Math.ceil(this._y)}angle(){return C3$jscomp$13.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.hypot(this._x,this._y)}rotatePrecalc(a,b){const d=
this._x*b-this._y*a;this._y=this._y*b+this._x*a;this._x=d}rotate(a){0!==a&&this.rotatePrecalc(Math.sin(a),Math.cos(a))}rotateAbout(a,b,d){0===a||b===this._x&&d===this._y||(this._x-=b,this._y-=d,this.rotatePrecalc(Math.sin(a),Math.cos(a)),this._x+=+b,this._y+=+d)}move(a,b){0!==b&&(this._x+=Math.cos(a)*b,this._y+=Math.sin(a)*b)}normalize(){const a=this.length();0!==a&&1!==a&&(this._x/=a,this._y/=a)}clamp(a,b){this._x=C3$jscomp$13.clamp(this._x,a,b);this._y=C3$jscomp$13.clamp(this._y,a,b)}dot(a){return this._x*
a._x+this._y*a._y}reverse(){this._x=-this._x;this._y=-this._y}perp(){let a=this._x;this._x=this._y;this._y=-a;return this}};"use strict";const C3$jscomp$14=self.C3;
C3$jscomp$14.Rect=class{constructor(a,b,d,c){this._bottom=this._right=this._top=this._left=0;a instanceof C3$jscomp$14.Rect?this.copy(a):this.set(a||0,b||0,d||0,c||0)}set(a,b,d,c){this._left=+a;this._top=+b;this._right=+d;this._bottom=+c}setWH(a,b,d,c){a=+a;b=+b;this._left=a;this._top=b;this._right=a+ +d;this._bottom=b+ +c}copy(a){this._left=+a._left;this._top=+a._top;this._right=+a._right;this._bottom=+a._bottom}clone(){return new C3$jscomp$14.Rect(this._left,this._top,this._right,this._bottom)}static Merge(a,
b){const d=new C3$jscomp$14.Rect;d.setLeft(Math.min(a._left,b._left));d.setTop(Math.min(a._top,b._top));d.setRight(Math.max(a._right,b._right));d.setBottom(Math.max(a._bottom,b._bottom));return d}static FromObject(a){return new C3$jscomp$14.Rect(a.left,a.top,a.right,a.bottom)}equals(a){return this._left===a._left&&this._top===a._top&&this._right===a._right&&this._bottom===a._bottom}equalsWH(a,b,d,c){return this._left===a&&this._top===b&&this.width()===d&&this.height()===c}equalsF32Array(a,b){return a[b]===
Math.fround(this._left)&&a[b+1]===Math.fround(this._top)&&a[b+2]===Math.fround(this._right)&&a[b+3]===Math.fround(this._bottom)}setLeft(a){this._left=+a}getLeft(){return this._left}setTop(a){this._top=+a}getTop(){return this._top}setRight(a){this._right=+a}getRight(){return this._right}setBottom(a){this._bottom=+a}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,
this._top,this.width(),this.height())}static fromDOMRect(a){return C3$jscomp$14.New(C3$jscomp$14.Rect,a.left,a.top,a.right,a.bottom)}writeToTypedArray(a,b){a[b++]=this._left;a[b++]=this._top;a[b++]=this._right;a[b]=this._bottom}writeAsQuadToTypedArray(a,b){a[b++]=this._left;a[b++]=this._top;a[b++]=this._right;a[b++]=this._top;a[b++]=this._right;a[b++]=this._bottom;a[b++]=this._left;a[b]=this._bottom}writeAsQuadToTypedArray3D(a,b,d){a[b++]=this._left;a[b++]=this._top;a[b++]=d;a[b++]=this._right;a[b++]=
this._top;a[b++]=d;a[b++]=this._right;a[b++]=this._bottom;a[b++]=d;a[b++]=this._left;a[b++]=this._bottom;a[b]=d}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+this._bottom)/2}offset(a,b){a=+a;b=+b;this._left+=a;this._top+=b;this._right+=a;this._bottom+=b}offsetLeft(a){this._left+=+a}offsetTop(a){this._top+=+a}offsetRight(a){this._right+=+a}offsetBottom(a){this._bottom+=+a}toSquare(a){if("x"!==a)throw Error("invalid axis, only 'x' supported");
this._bottom=this._top<this._bottom?this._left<this._right?this._top+this.width():this._top-this.width():this._left<this._right?this._top-this.width():this._top+this.width()}inflate(a,b){a=+a;b=+b;this._left-=a;this._top-=b;this._right+=a;this._bottom+=b}deflate(a,b){a=+a;b=+b;this._left+=a;this._top+=b;this._right-=a;this._bottom-=b}multiply(a,b){this._left*=a;this._top*=b;this._right*=a;this._bottom*=b}divide(a,b){this._left/=a;this._top/=b;this._right/=a;this._bottom/=b}mirrorAround(a){this._left=
+a-this._left;this._right=+a-this._right}flipAround(a){this._top=+a-this._top;this._bottom=+a-this._bottom}rotate90DegreesAround(a,b){const d=this.width(),c=this.height(),e=this.getLeft()+d*a,g=this.getTop()+c*b;this.setWH(e-c*b,g-d*a,c,d)}swapLeftRight(){const a=this._left;this._left=this._right;this._right=a}swapTopBottom(){const a=this._top;this._top=this._bottom;this._bottom=a}shuntY(a){const b=this._top;this._top=+a-this._bottom;this._bottom=+a-b}round(){this._left=Math.round(this._left);this._top=
Math.round(this._top);this._right=Math.round(this._right);this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left);this._top=Math.ceil(this._top);this._right=Math.floor(this._right);this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left);this._top=Math.floor(this._top);this._right=Math.ceil(this._right);this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left);this._top=Math.floor(this._top);this._right=Math.floor(this._right);
this._bottom=Math.floor(this._bottom)}ceil(){this._left=Math.ceil(this._left);this._top=Math.ceil(this._top);this._right=Math.ceil(this._right);this._bottom=Math.ceil(this._bottom)}clamp(a,b,d,c){this._left=Math.max(this._left,+a);this._top=Math.max(this._top,+b);this._right=Math.min(this._right,+d);this._bottom=Math.min(this._bottom,+c)}clampBoth(a,b,d,c){a=+a;b=+b;d=+d;c=+c;this._left=C3$jscomp$14.clamp(this._left,a,d);this._top=C3$jscomp$14.clamp(this._top,b,c);this._right=C3$jscomp$14.clamp(this._right,
a,d);this._bottom=C3$jscomp$14.clamp(this._bottom,b,c)}normalize(){this._left>this._right&&this.swapLeftRight();this._top>this._bottom&&this.swapTopBottom()}intersectsRect(a){return!(a._right<this._left||a._bottom<this._top||a._left>this._right||a._top>this._bottom)}intersectsRectOffset(a,b,d){return!(a._right+b<this._left||a._bottom+d<this._top||a._left+b>this._right||a._top+d>this._bottom)}containsPoint(a,b){return a>=this._left&&a<=this._right&&b>=this._top&&b<=this._bottom}containsRect(a){return a._left>=
this._left&&a._top>=this._top&&a._right<=this._right&&a._bottom<=this._bottom}expandToContain(a){a._left<this._left&&(this._left=+a._left);a._top<this._top&&(this._top=+a._top);a._right>this._right&&(this._right=+a._right);a._bottom>this._bottom&&(this._bottom=+a._bottom)}lerpInto(a){this._left=C3$jscomp$14.lerp(a._left,a._right,this._left);this._top=C3$jscomp$14.lerp(a._top,a._bottom,this._top);this._right=C3$jscomp$14.lerp(a._left,a._right,this._right);this._bottom=C3$jscomp$14.lerp(a._top,a._bottom,
this._bottom)}};"use strict";const C3$jscomp$15=self.C3;
C3$jscomp$15.Quad=class{constructor(a,b,d,c,e,g,k,l){this._bly=this._blx=this._bry=this._brx=this._try=this._trx=this._tly=this._tlx=0;a instanceof C3$jscomp$15.Quad?this.copy(a):this.set(a||0,b||0,d||0,c||0,e||0,g||0,k||0,l||0)}set(a,b,d,c,e,g,k,l){this._tlx=+a;this._tly=+b;this._trx=+d;this._try=+c;this._brx=+e;this._bry=+g;this._blx=+k;this._bly=+l}setRect(a,b,d,c){this.set(a,b,d,b,d,c,a,c)}copy(a){this._tlx=a._tlx;this._tly=a._tly;this._trx=a._trx;this._try=a._try;this._brx=a._brx;this._bry=a._bry;
this._blx=a._blx;this._bly=a._bly}equals(a){return this._tlx===a._tlx&&this._tly===a._tly&&this._trx===a._trx&&this._try===a._try&&this._brx===a._brx&&this._bry===a._bry&&this._blx===a._blx&&this._bly===a._bly}setTlx(a){this._tlx=+a}getTlx(){return this._tlx}setTly(a){this._tly=+a}getTly(){return this._tly}setTrx(a){this._trx=+a}getTrx(){return this._trx}setTry(a){this._try=+a}getTry(){return this._try}setBrx(a){this._brx=+a}getBrx(){return this._brx}setBry(a){this._bry=+a}getBry(){return this._bry}setBlx(a){this._blx=
+a}getBlx(){return this._blx}setBly(a){this._bly=+a}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}static fromDOMQuad(a){return C3$jscomp$15.New(C3$jscomp$15.Quad,a.p1.x,a.p1.y,a.p2.x,a.p2.y,a.p3.x,a.p3.y,a.p4.x,a.p4.y)}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(a,
b){a[b++]=this._tlx;a[b++]=this._tly;a[b++]=this._trx;a[b++]=this._try;a[b++]=this._brx;a[b++]=this._bry;a[b++]=this._blx;a[b]=this._bly}writeToTypedArray3D(a,b,d){a[b++]=this._tlx;a[b++]=this._tly;a[b++]=d;a[b++]=this._trx;a[b++]=this._try;a[b++]=d;a[b++]=this._brx;a[b++]=this._bry;a[b++]=d;a[b++]=this._blx;a[b++]=this._bly;a[b]=d}offset(a,b){a=+a;b=+b;this._tlx+=a;this._tly+=b;this._trx+=a;this._try+=b;this._brx+=a;this._bry+=b;this._blx+=a;this._bly+=b}round(){this._tlx=Math.round(this._tlx);this._tly=
Math.round(this._tly);this._trx=Math.round(this._trx);this._try=Math.round(this._try);this._brx=Math.round(this._brx);this._bry=Math.round(this._bry);this._blx=Math.round(this._blx);this._bly=Math.round(this._bly)}floor(){this._tlx=Math.floor(this._tlx);this._tly=Math.floor(this._tly);this._trx=Math.floor(this._trx);this._try=Math.floor(this._try);this._brx=Math.floor(this._brx);this._bry=Math.floor(this._bry);this._blx=Math.floor(this._blx);this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx);
this._tly=Math.ceil(this._tly);this._trx=Math.ceil(this._trx);this._try=Math.ceil(this._try);this._brx=Math.ceil(this._brx);this._bry=Math.ceil(this._bry);this._blx=Math.ceil(this._blx);this._bly=Math.ceil(this._bly)}setFromRect(a){this._tlx=a._left;this._tly=a._top;this._trx=a._right;this._try=a._top;this._brx=a._right;this._bry=a._bottom;this._blx=a._left;this._bly=a._bottom}setFromRotatedRect(a,b){0===b?this.setFromRect(a):this.setFromRotatedRectPrecalc(a,Math.sin(b),Math.cos(b))}setFromRotatedRectPrecalc(a,
b,d){const c=a._left*b,e=a._top*b,g=a._right*b;b*=a._bottom;const k=a._left*d,l=a._top*d,n=a._right*d;a=a._bottom*d;this._tlx=k-e;this._tly=l+c;this._trx=n-e;this._try=l+g;this._brx=n-b;this._bry=a+g;this._blx=k-b;this._bly=a+c}getBoundingBox(a){a.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(a,b){var d=this._trx-this._tlx,c=this._try-
this._tly;const e=this._brx-this._tlx,g=this._bry-this._tly;a-=this._tlx;b-=this._tly;var k=d*d+c*c;let l=d*e+c*g;c=d*a+c*b;const n=e*e+g*g,p=e*a+g*b;let r=1/(k*n-l*l);d=(n*c-l*p)*r;k=(k*p-l*c)*r;if(0<=d&&0<k&&1>d+k)return!0;d=this._blx-this._tlx;c=this._bly-this._tly;k=d*d+c*c;l=d*e+c*g;c=d*a+c*b;r=1/(k*n-l*l);d=(n*c-l*p)*r;k=(k*p-l*c)*r;return 0<=d&&0<k&&1>d+k}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(a,b,
d,c){return this.containsPoint(a,b)||this.containsPoint(d,c)?!0:C3$jscomp$15.segmentIntersectsQuad(a,b,d,c,this)}intersectsQuad(a){var b=a.midX(),d=a.midY();if(this.containsPoint(b,d))return!0;b=this.midX();d=this.midY();if(a.containsPoint(b,d))return!0;b=this._tlx;d=this._tly;const c=this._trx,e=this._try,g=this._brx,k=this._bry,l=this._blx,n=this._bly;return C3$jscomp$15.segmentIntersectsQuad(b,d,c,e,a)||C3$jscomp$15.segmentIntersectsQuad(c,e,g,k,a)||C3$jscomp$15.segmentIntersectsQuad(g,k,l,n,a)||
C3$jscomp$15.segmentIntersectsQuad(l,n,b,d,a)}rotatePointsAnticlockwise(){const a=this._tlx,b=this._tly;this._tlx=this._trx;this._tly=this._try;this._trx=this._brx;this._try=this._bry;this._brx=this._blx;this._bry=this._bly;this._blx=a;this._bly=b}mirror(){this._swap(0,2);this._swap(1,3);this._swap(6,4);this._swap(7,5)}flip(){this._swap(0,6);this._swap(1,7);this._swap(2,4);this._swap(3,5)}diag(){this._swap(2,6);this._swap(3,7)}_swap(a,b){const d=this._getAtIndex(a);this._setAtIndex(a,this._getAtIndex(b));
this._setAtIndex(b,d)}_getAtIndex(a){switch(a){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index");}}_setAtIndex(a,b){b=+b;switch(a){case 0:this._tlx=b;break;case 1:this._tly=b;break;case 2:this._trx=b;break;case 3:this._try=b;break;case 4:this._brx=b;break;case 5:this._bry=b;break;case 6:this._blx=b;break;
case 7:this._bly=b;break;default:throw new RangeError("invalid quad point index");}}};"use strict";const C3$jscomp$16=self.C3,DEFAULT_POLY_POINTS=[0,0,1,0,1,1,0,1],tempQuad=C3$jscomp$16.New(C3$jscomp$16.Quad);
C3$jscomp$16.CollisionPoly=class extends C3$jscomp$16.DefendedBase{constructor(a,b=!0){super();a||(a=DEFAULT_POLY_POINTS);this._ptsArr=Float64Array.from(a);this._bbox=new C3$jscomp$16.Rect;this._isBboxChanged=!0;this._enabled=b}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(a){this._ptsArr.length===a.length?this._ptsArr.set(a):this._ptsArr=Float64Array.from(a);this._isBboxChanged=!0}setDefaultPoints(){this.setPoints(DEFAULT_POLY_POINTS)}copy(a){this.setPoints(a._ptsArr)}setBboxChanged(){this._isBboxChanged=
!0}_updateBbox(){if(this._isBboxChanged){var a=this._ptsArr,b=a[0],d=a[1],c=b,e=d;for(let g=0,k=a.length;g<k;g+=2){const l=a[g],n=a[g+1];l<b&&(b=l);l>c&&(c=l);n<d&&(d=n);n>e&&(e=n)}this._bbox.set(b,d,c,e);this._isBboxChanged=!1}}setFromRect(a,b,d){let c=this._ptsArr;8!==c.length&&(this._ptsArr=c=new Float64Array(8));c[0]=a.getLeft()-b;c[1]=a.getTop()-d;c[2]=a.getRight()-b;c[3]=a.getTop()-d;c[4]=a.getRight()-b;c[5]=a.getBottom()-d;c[6]=a.getLeft()-b;c[7]=a.getBottom()-d;this._bbox.copy(a);0===b&&0===
d||this._bbox.offset(-b,-d);this._isBboxChanged=!1}setFromQuad(a,b,d){tempQuad.copy(a);tempQuad.offset(b,d);this.setPoints(tempQuad.toArray());this._isBboxChanged=!0}transform(a,b,d){let c=0,e=1;0!==d&&(c=Math.sin(d),e=Math.cos(d));this.transformPrecalc(a,b,c,e)}transformPrecalc(a,b,d,c){const e=this._ptsArr;for(let g=0,k=e.length;g<k;g+=2){const l=g+1,n=e[g]*a,p=e[l]*b;e[g]=n*c-p*d;e[l]=p*c+n*d}this._isBboxChanged=!0}offset(a,b){const d=this._ptsArr;for(let c=0,e=d.length;c<e;c+=2)d[c]+=a,d[c+1]+=
b}containsPoint(a,b){const d=this._ptsArr;if(a===d[0]&&b===d[1])return!0;this._updateBbox();var c=this._bbox;const e=c.getLeft()-110,g=c.getTop()-101,k=c.getRight()+131;c=c.getBottom()+120;let l,n,p,r,w,z,B,C;e<a?(l=e,p=a):(l=a,p=e);g<b?(n=g,r=b):(n=b,r=g);k<a?(w=k,B=a):(w=a,B=k);c<b?(z=c,C=b):(z=b,C=c);let E=0,F=0;for(let K=0,O=d.length;K<O;K+=2){var I=(K+2)%O;const V=d[K],W=d[K+1],ca=d[I];I=d[I+1];C3$jscomp$16.segmentsIntersectPreCalc(e,g,a,b,l,p,n,r,V,W,ca,I)&&++E;C3$jscomp$16.segmentsIntersectPreCalc(k,
c,a,b,w,B,z,C,V,W,ca,I)&&++F}return 1===E%2||1===F%2}intersectsPoly(a,b,d){const c=a._ptsArr,e=this._ptsArr;if(this.containsPoint(c[0]+b,c[1]+d)||a.containsPoint(e[0]-b,e[1]-d))return!0;for(let k=0,l=e.length;k<l;k+=2){var g=(k+2)%l;a=e[k];const n=e[k+1],p=e[g];g=e[g+1];let r,w,z,B;a<p?(r=a,z=p):(r=p,z=a);n<g?(w=n,B=g):(w=g,B=n);for(let C=0,E=c.length;C<E;C+=2){const F=(C+2)%E;if(C3$jscomp$16.segmentsIntersectPreCalc(a,n,p,g,r,z,w,B,c[C]+b,c[C+1]+d,c[F]+b,c[F+1]+d))return!0}}return!1}intersectsSegment(a,
b,d,c,e,g){if(this.containsPoint(d-a,c-b)||this.containsPoint(e-a,g-b))return!0;let k,l,n,p;d<e?(k=d,n=e):(k=e,n=d);c<g?(l=c,p=g):(l=g,p=c);const r=this._ptsArr;for(let w=0,z=r.length;w<z;w+=2){const B=(w+2)%z;if(C3$jscomp$16.segmentsIntersectPreCalc(d,c,e,g,k,n,l,p,r[w]+a,r[w+1]+b,r[B]+a,r[B+1]+b))return!0}return!1}mirror(a){const b=this._ptsArr;for(let d=0,c=b.length;d<c;d+=2)b[d]=2*a-b[d];this._isBboxChanged=!0}flip(a){const b=this._ptsArr;for(let d=0,c=b.length;d<c;d+=2){const e=d+1;b[e]=2*a-
b[e]}this._isBboxChanged=!0}diag(){const a=this._ptsArr;for(let b=0,d=a.length;b<d;b+=2){const c=b+1,e=a[b];a[b]=a[c];a[c]=e}this._isBboxChanged=!0}GetMidX(){const a=this._ptsArr;let b=0;for(let d=0,c=a.length;d<c;d+=2)b+=a[d];return b/this.pointCount()}GetMidY(){const a=this._ptsArr;let b=0;for(let d=0,c=a.length;d<c;d+=2)b+=a[d+1];return b/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}};"use strict";
const C3$jscomp$17=self.C3;
C3$jscomp$17.PairMap=class extends C3$jscomp$17.DefendedBase{constructor(a){super();this._firstMap=new Map;if(a)for(const [b,d,c]of a)this.Set(b,d,c)}Release(){this.Clear();this._firstMap=null}IsEmpty(){return 0===this._firstMap.size}Clear(){const a=this._firstMap;for(const b of a.values())b.clear();a.clear()}Set(a,b,d){const c=this._firstMap;let e=c.get(a);e||(e=new Map,c.set(a,e));e.set(b,d)}Get(a,b){return(a=this._firstMap.get(a))?a.get(b):a}Has(a,b){return(a=this._firstMap.get(a))?a.has(b):!1}Delete(a,
b){const d=this._firstMap,c=d.get(a);if(!c)return!1;(b=c.delete(b))&&0===c.size&&d.delete(a);return b}DeleteEither(a){const b=this._firstMap,d=b.get(a);d&&(d.clear(),b.delete(a));for(const [c,e]of b.entries())e.delete(a)&&0===e.size&&b.delete(c)}GetSize(){let a=0;for(const b of this._firstMap.values())a+=b.size;return a}*values(){for(const a of this._firstMap.values())yield*a.values()}*keyPairs(){for(const [a,b]of this._firstMap.entries())for(const d of b.keys())yield[a,d]}*entries(){for(const [a,
b]of this._firstMap.entries())for(const [d,c]of b.entries())yield[a,d,c]}};"use strict";const C3$jscomp$18=self.C3;
C3$jscomp$18.ArraySet=class extends C3$jscomp$18.DefendedBase{constructor(){super();this._set=new Set;this._arr=[];this._needToRebuildArray=!1}Release(){this.Clear()}Clear(){this._set.clear();C3$jscomp$18.clearArray(this._arr);this._needToRebuildArray=!1}Add(a){this._set.has(a)||(this._set.add(a),this._needToRebuildArray||this._arr.push(a))}Has(a){return this._set.has(a)}Delete(a){this._set.delete(a)&&(this._needToRebuildArray=!0)}GetSize(){return this._set.size}IsEmpty(){return 0===this._set.size}GetArray(){this._needToRebuildArray&&
(this._RebuildArray(),this._needToRebuildArray=!1);return this._arr}_RebuildArray(){const a=this._arr;C3$jscomp$18.clearArray(a);for(const b of this._set)a.push(b)}};"use strict";const C3$jscomp$19=self.C3,EASE_MAP=new Map,PREDEFINED_EASE_MAP=new Map,CUSTOM_EASE_EDITOR_MAP=new Map,CUSTOM_EASE_DATA_EDITOR_MAP=new Map,CUSTOM_EASE_RUNTIME_MAP=new Map,CUSTOM_EASE_DATA_RUNTIME_MAP=new Map,PRIVATE_EASE_MAP=new Map,BUILT_IN_TRANSITION_MAP=new Map,ALIAS_MAP=new Map;ALIAS_MAP.set("linear","noease");
ALIAS_MAP.set("default","noease");
const EASE_TRANSLATION_KEYS="default noease easeinquad easeoutquad easeinoutquad easeincubic easeoutcubic easeinoutcubic easeinquart easeoutquart easeinoutquart easeinquint easeoutquint easeinoutquint easeinsine easeoutsine easeinoutsine easeinexpo easeoutexpo easeinoutexpo easeincirc easeoutcirc easeinoutcirc easeinelastic easeoutelastic easeinoutelastic easeinback easeoutback easeinoutback easeinbounce easeoutbounce easeinoutbounce".split(" "),SHORT_EASE_TRANSLATION_KEYS="default noease quad cubic quart quint sine expo circ elastic back bounce".split(" "),
EASE_API2INTERNAL_NAMES=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],
["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]);
self.Ease=class a{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static ToInternal(b){return EASE_API2INTERNAL_NAMES.get(b)}static GetEditorEaseNames(b,...d){this._CreateEaseMap();if(b){CUSTOM_EASE_EDITOR_MAP.has(b)||CUSTOM_EASE_EDITOR_MAP.set(b,new Map);var c=CUSTOM_EASE_EDITOR_MAP.get(b);c=[...c.keys()].filter(e=>a.GetEditorEaseData(e,b)?a.GetEditorEaseData(e,b).transition.IsForAnyPurpose():!0)}else c=CUSTOM_EASE_RUNTIME_MAP,c=[...c.keys()];c=c.sort();return[...PREDEFINED_EASE_MAP.keys()].concat(c).filter(e=>
!d.includes(e))}static GetRuntimeEaseNames(){this._CreateEaseMap();const b=[...CUSTOM_EASE_RUNTIME_MAP.keys()];b.sort();return[...PREDEFINED_EASE_MAP.keys()].concat(b)}static GetCustomRuntimeEaseNames(){this._CreateEaseMap();const b=[...CUSTOM_EASE_RUNTIME_MAP.keys()];b.sort();return b}static IsPredefinedTranslatedName(b){for(const d of EASE_TRANSLATION_KEYS)if(self.lang(`ui.bars.timeline.eases.${d}`)===b)return!0;for(const d of SHORT_EASE_TRANSLATION_KEYS)if(self.lang(`ui.bars.timeline.short-eases.${d}`)===
b)return!0}static IsNamePredefined(b){this._CreateEaseMap();return[...PREDEFINED_EASE_MAP.keys()].includes(b)}static _GetEase(b){const d=ALIAS_MAP.get(b);if(d)return EASE_MAP.get(d);if(a.IsNamePredefined(b))return EASE_MAP.get(b);if(PRIVATE_EASE_MAP.has(b))return PRIVATE_EASE_MAP.get(b)}static GetBuiltInTransition(b){this._CreateEaseMap();return BUILT_IN_TRANSITION_MAP.get(b)}static GetEditorEase(b,d){this._CreateEaseMap();const c=a._GetEase(b);if(c)return c;if(!d)throw Error("missing ease function");
return CUSTOM_EASE_EDITOR_MAP.get(d).get(b)}static GetEditorEaseData(b,d){this._CreateEaseMap();if(d=CUSTOM_EASE_DATA_EDITOR_MAP.get(d))return d.get(b)}static HasEditorEase(b,d){this._CreateEaseMap();return a._GetEase(b)?!0:!!CUSTOM_EASE_EDITOR_MAP.get(d).get(b)}static GetRuntimeEase(b){this._CreateEaseMap();const d=a._GetEase(b);return d?d:CUSTOM_EASE_RUNTIME_MAP.get(b)}static GetRuntimeEaseData(b){this._CreateEaseMap();return CUSTOM_EASE_DATA_RUNTIME_MAP.get(b)}static GetEaseFromIndex(b){this._CreateEaseMap();
return this.GetRuntimeEaseNames()[b]}static GetIndexForEase(b,d){this._CreateEaseMap();return this.GetEditorEaseNames(d).indexOf(b)}static GetIndexForEaseAtRuntime(b){return this.GetIndexForEase(b)}static _CreateEaseMap(){0===EASE_MAP.size&&(this._AddPredifinedEase("default",()=>{}),this._AddPredifinedEase("noease",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}],!0),this._AddPredifinedEase("easeinsine",[{x:0,y:0,sax:.485,say:0,eax:0,eay:0,se:!0,
ee:!1},{x:1,y:1,sax:0,say:0,eax:-.038,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutsine",[{x:0,y:0,sax:.038,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.485,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutsine",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinelastic",[{x:0,y:0,sax:.018,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.116,y:.002,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.266,y:-.005,
sax:.024,say:0,eax:-.021,eay:0,se:!0,ee:!0},{x:.416,y:.016,sax:.024,say:0,eax:-.026,eay:0,se:!0,ee:!0},{x:.566,y:-.045,sax:.061,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.716,y:.132,sax:.072,say:-.004,eax:-.045,eay:0,se:!0,ee:!0},{x:.866,y:-.373,sax:.06,say:0,eax:-.049,eay:-.002,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.038,eay:-.263,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutelastic",[{x:0,y:0,sax:.038,say:.263,eax:0,eay:0,se:!0,ee:!1},{x:.136,y:1.373,sax:.049,say:.002,eax:-.06,eay:0,se:!0,ee:!0},
{x:.286,y:.868,sax:.045,say:0,eax:-.072,eay:.004,se:!0,ee:!0},{x:.436,y:1.045,sax:.025,say:0,eax:-.061,eay:0,se:!0,ee:!0},{x:.586,y:.984,sax:.026,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.736,y:1.005,sax:.021,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.886,y:.998,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.018,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutelastic",[{x:0,y:0,sax:.025,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.067,y:.001,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},
{x:.18,y:-.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.292,y:.025,sax:.053,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.405,y:-.118,sax:.069,say:0,eax:-.027,eay:0,se:!0,ee:!0},{x:.597,y:1.118,sax:.027,say:0,eax:-.069,eay:0,se:!0,ee:!0},{x:.71,y:.975,sax:.025,say:0,eax:-.053,eay:0,se:!0,ee:!0},{x:.822,y:1.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.935,y:.999,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.025,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinback",
[{x:0,y:0,sax:.35,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.34,eay:-1.579,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutback",[{x:0,y:0,sax:.34,say:1.579,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.35,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutback",[{x:0,y:0,sax:.035,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.242,y:-.1,sax:.258,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.76,y:1.1,sax:.025,say:0,eax:-.26,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.035,eay:0,se:!1,ee:!0}]),
this._AddPredifinedEase("easeinbounce",[{x:0,y:0,sax:.033,say:.025,eax:0,eay:0,se:!0,ee:!1},{x:.092,y:0,sax:.026,say:.078,eax:-.033,eay:.025,se:!0,ee:!0},{x:.274,y:0,sax:.097,say:.319,eax:-.026,eay:.078,se:!0,ee:!0},{x:.637,y:0,sax:.105,say:.625,eax:-.097,eay:.319,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:-.004,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutbounce",[{x:0,y:0,sax:.125,say:.004,eax:0,eay:0,se:!0,ee:!1},{x:.365,y:1,sax:.097,say:-.319,eax:-.105,eay:-.625,se:!0,ee:!0},{x:.728,y:1,
sax:.026,say:-.078,eax:-.097,eay:-.319,se:!0,ee:!0},{x:.91,y:1,sax:.033,say:-.025,eax:-.026,eay:-.078,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.033,eay:-.025,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutbounce",[{x:0,y:0,sax:.01,say:.006,eax:0,eay:0,se:!0,ee:!1},{x:.046,y:0,sax:.021,say:.038,eax:-.01,eay:.006,se:!0,ee:!0},{x:.137,y:0,sax:.059,say:.158,eax:-.021,eay:.038,se:!0,ee:!0},{x:.319,y:0,sax:.117,say:.744,eax:-.059,eay:.158,se:!0,ee:!0},{x:.683,y:1,sax:.059,say:-.158,eax:-.117,eay:-.744,
se:!0,ee:!0},{x:.865,y:1,sax:.021,say:-.038,eax:-.059,eay:-.158,se:!0,ee:!0},{x:.956,y:1,sax:.01,say:-.006,eax:-.021,eay:-.038,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.01,eay:-.006,se:!1,ee:!0}]),this._AddPredifinedEase("easeincubic",[{x:0,y:0,sax:.75,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.138,eay:-.321,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcubic",[{x:0,y:0,sax:.138,say:.321,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.75,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcubic",
[{x:0,y:0,sax:.285,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.081,say:.272,eax:-.081,eay:-.272,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.285,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquad",[{x:0,y:0,sax:.4,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.178,eay:-.392,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquad",[{x:0,y:0,sax:.178,say:.392,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.4,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquad",[{x:0,y:0,sax:.25,
say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.03,say:.065,eax:-.03,eay:-.065,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquart",[{x:0,y:0,sax:.25,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.5,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquart",[{x:0,y:0,sax:.5,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquart",[{x:0,y:0,sax:.765,say:.03,eax:0,eay:0,se:!0,
ee:!1},{x:1,y:1,sax:0,say:0,eax:-.765,eay:-.03,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquint",[{x:0,y:0,sax:.6,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.2,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquint",[{x:0,y:0,sax:.2,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.6,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquint",[{eax:0,eay:0,ee:!1,sax:.84,say:0,se:!0,x:0,y:0},{eax:-.84,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPredifinedEase("easeincirc",
[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.024,eay:-.808,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcirc",[{x:0,y:0,sax:.024,say:.808,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcirc",[{x:0,y:0,sax:.125,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.02,say:.428,eax:-.02,eay:-.428,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinexpo",[{x:0,y:0,sax:.66,
say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.14,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutexpo",[{x:0,y:0,sax:.14,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.66,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutexpo",[{eax:0,eay:0,ee:!1,sax:.345,say:0,se:!0,x:0,y:0},{eax:-.06,eay:-.5,ee:!0,sax:.06,say:.5,se:!0,x:.5,y:.5},{eax:-.335,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier),this._AddPrivateCustomEase("spline",
this.EaseSpline))}static _AddPredifinedEase(b,d,c=!1){if("function"===typeof d)a._AddEase(b,d,"predefined");else if(C3$jscomp$19.IsArray(d))if(self.BuiltInTransition){const e=C3$jscomp$19.New(self.BuiltInTransition,b,c);e.SetFromJson(d);a._AddEase(b,(g,k,l,n)=>e.Interpolate(g,k,l,n),"predefined");BUILT_IN_TRANSITION_MAP.set(b,e)}else{const e=C3$jscomp$19.New(C3$jscomp$19.Transition,[b,d.map(g=>[g.x,g.y,g.sax,g.say,g.eax,g.eay,g.se,g.ee])],!1);e.MakeLinear(c);a._AddEase(b,(g,k,l,n)=>e.Interpolate(g,
k,l,n),"predefined")}else throw Error("unexpected arguments");}static _AddPrivateCustomEase(b,d){a._AddEase(b,d,"private")}static AddCustomEase(b,d,c,e){this._CreateEaseMap();a._AddEase(b,d,"custom",c,e)}static RemoveCustomEase(b,d){if(!this.IsNamePredefined(b)&&![...PRIVATE_EASE_MAP.keys()].includes(b)){var c=CUSTOM_EASE_EDITOR_MAP.get(d);c&&c.delete(b);(d=CUSTOM_EASE_DATA_EDITOR_MAP.get(d))&&d.delete(b)}}static _AddEase(b,d,c,e,g){switch(c){case "predefined":EASE_MAP.set(b,d);PREDEFINED_EASE_MAP.set(b,
d);break;case "custom":e?(CUSTOM_EASE_EDITOR_MAP.has(e)||CUSTOM_EASE_EDITOR_MAP.set(e,new Map),CUSTOM_EASE_DATA_EDITOR_MAP.has(e)||CUSTOM_EASE_DATA_EDITOR_MAP.set(e,new Map),CUSTOM_EASE_EDITOR_MAP.get(e).set(b,d),CUSTOM_EASE_DATA_EDITOR_MAP.get(e).set(b,g)):(CUSTOM_EASE_RUNTIME_MAP.set(b,d),CUSTOM_EASE_DATA_RUNTIME_MAP.set(b,g));break;case "private":EASE_MAP.set(b,d);PRIVATE_EASE_MAP.set(b,d);break;default:throw Error("unexpected ease mode");}}static NoEase(b,d,c,e){return 0===e?d:c*b/e+d}static EaseCubicBezier(b,
d,c,e,g){return d+3*b*(c-d)+3*b**2*(d+e-2*c)+b**3*(g-d+3*c-3*e)}static EaseSpline(b,d,c,e,g,k,l,n,p,r){if(e===g&&k===l)return b;b=get_t_for_x(b,d,e,k,n,r);d=a$jscomp$282(c,g,l,p);e=b$jscomp$151(c,g,l,p);c=c$jscomp$42(c,g,l,p);return calc_bezier(b,d,e,c)}static GetBezierSamples(b,d,c,e){const g=[],k=a$jscomp$282(b,d,c,e),l=b$jscomp$151(b,d,c,e);b=c$jscomp$42(b,d,c,e);for(d=0;11>d;++d)c=calc_bezier(d*SAMPLE_STEP,k,l,b),g.push(c);return g}};
const SAMPLE_STEP=.1,a$jscomp$282=(a,b,d,c)=>c-3*d+3*b-a,b$jscomp$151=(a,b,d,c)=>3*d-6*b+3*a,c$jscomp$42=(a,b,d,c)=>3*(b-a),calc_bezier=(a,b,d,c)=>((b*a+d)*a+c)*a,get_slope=(a,b,d,c)=>3*b*a*a+2*d*a+c,get_t_for_x=(a,b,d,c,e,g)=>{if(1==a)return 1;for(var k=0,l=1,n=g[l];10!=l&&n<=a;)l++,n=g[l],k+=SAMPLE_STEP;l--;n=g[l];g=k+(a-n)/(g[l+1]-n)*SAMPLE_STEP;l=a$jscomp$282(b,d,c,e);n=b$jscomp$151(b,d,c,e);b=c$jscomp$42(b,d,c,e);d=get_slope(g,l,n,b);if(0!==d)if(.01<=d)for(k=0;4>k;++k)d=calc_bezier(g,l,n,b)-
a,c=get_slope(g,l,n,b),g-=d/c;else{d=k;k+=SAMPLE_STEP;c=0;let p;do g=d+(k-d)/2,e=calc_bezier(g,l,n,b)-a,0<e?k=g:d=g,e=1E-7<Math.abs(e),p=10>++c;while(e&&p)}return g};"use strict";const C3$jscomp$20=self.C3;function RequireStringOrNumber(a){C3$jscomp$20.IsString(a)}
C3$jscomp$20.ProbabilityTable=class{constructor(a){this._items=[];this._name=a||"";this._totalWeight=0}Release(){this.Clear();this._items=null}GetName(){return this._name}Clear(){C3$jscomp$20.clear2DArray(this._items);this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(a=Math.random()*this.GetTotalWeight()){let b=0;for(const [d,c]of this._items)if(b+=d,a<b)return c;return 0}AddItem(a,b){RequireStringOrNumber(b);this._totalWeight+=a;this._items.push([a,b])}RemoveItem(a,b){RequireStringOrNumber(b);
const d=0===a;for(let c=0;c<this._items.length;c++){const e=this._items[c],g=e[1]===b;if((d||e[0]===a)&&g){this._items.splice(c,1);this._totalWeight-=e[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(a){const b=new C3$jscomp$20.ProbabilityTable;a=JSON.parse(a);for(const d of a)b.AddItem(d[0],d[1]);return b}};"use strict";let nextId=0;
self.C3.ScreenReaderText=class{constructor(a,b){this._runtime=a;this._text=b;this._id=nextId++;this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"create",id:this._id,text:this._text})}Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"release",id:this._id});this._runtime=null;this._text="";this._id=-1}SetText(a){this._text!==a&&(this._text=a,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"update",id:this._id,
text:this._text}))}};"use strict";self.C3.Event=class{constructor(a,b){this.type=a;this.cancelable=!!b;this.isAsync=this.propagationStopped=this.defaultPrevented=!1}preventDefault(){if(!this.cancelable)throw Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=!0}stopPropagation(){if(!this.cancelable)throw Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=!0}};"use strict";
const C3$jscomp$23=self.C3;
C3$jscomp$23.Event.Handler=class extends C3$jscomp$23.DefendedBase{constructor(a){super();this._type=a;this._captureListeners=[];this._captureListenersSet=new Set;this._listeners=[];this._listenersSet=new Set;this._fireDepth=0;this._queueModifyListeners=[]}Release(){0<this._fireDepth||(C3$jscomp$23.clearArray(this._captureListeners),this._captureListenersSet.clear(),C3$jscomp$23.clearArray(this._listeners),this._listenersSet.clear(),C3$jscomp$23.clearArray(this._queueModifyListeners),C3$jscomp$23.Release(this))}_AddListener(a,
b){this._IsFiring()?this._queueModifyListeners.push({op:"add",func:a,capture:b}):b?this._captureListenersSet.has(a)||(this._captureListeners.push(a),this._captureListenersSet.add(a)):this._listenersSet.has(a)||(this._listeners.push(a),this._listenersSet.add(a))}_RemoveListener(a,b){this._IsFiring()?this._queueModifyListeners.push({op:"remove",func:a,capture:b}):b?this._captureListenersSet.has(a)&&(this._captureListenersSet.delete(a),C3$jscomp$23.arrayFindRemove(this._captureListeners,a)):this._listenersSet.has(a)&&
(this._listenersSet.delete(a),C3$jscomp$23.arrayFindRemove(this._listeners,a))}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return 0<this._fireDepth}_ProcessQueuedListeners(){const a=new Set,b=new Set;for(const d of this._queueModifyListeners)if("add"===d.op)this._AddListener(d.func,d.capture),d.capture?b.delete(d.func):a.delete(d.func);else if("remove"===d.op)d.capture?(this._captureListenersSet.delete(d.func),b.add(d.func)):(this._listenersSet.delete(d.func),
a.add(d.func));else throw Error("invalid op");C3$jscomp$23.arrayRemoveAllInSet(this._listeners,a);C3$jscomp$23.arrayRemoveAllInSet(this._captureListeners,b);C3$jscomp$23.clearArray(this._queueModifyListeners)}_FireCancellable(a){this._IncreaseFireDepth();let b=!1;for(let d=0,c=this._captureListeners.length;d<c;++d)if(this._captureListeners[d](a),a.propagationStopped){b=!0;break}if(!b)for(let d=0,c=this._listeners.length;d<c&&(this._listeners[d](a),!a.propagationStopped);++d);this._DecreaseFireDepth();
return!a.defaultPrevented}_FireNonCancellable(a){this._IncreaseFireDepth();for(let b=0,d=this._captureListeners.length;b<d;++b)this._captureListeners[b](a);for(let b=0,d=this._listeners.length;b<d;++b)this._listeners[b](a);this._DecreaseFireDepth();return!0}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--;0===this._fireDepth&&0<this._queueModifyListeners.length&&this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(a){a?this._IncreaseFireDepth():this._DecreaseFireDepth()}_FireAsync(a){let b=
[];for(let d=0,c=this._captureListeners.length;d<c;++d){let e=this._captureListeners[d];b.push(C3$jscomp$23.Asyncify(()=>e(a)))}for(let d=0,c=this._listeners.length;d<c;++d){let e=this._listeners[d];b.push(C3$jscomp$23.Asyncify(()=>e(a)))}return Promise.all(b).then(()=>!a.defaultPrevented)}_FireAndWait_AsyncOptional(a){const b=[];this._IncreaseFireDepth();for(let c=0,e=this._captureListeners.length;c<e;++c){var d=this._captureListeners[c](a);d instanceof Promise&&b.push(d)}for(let c=0,e=this._listeners.length;c<
e;++c)d=this._listeners[c](a),d instanceof Promise&&b.push(d);this._DecreaseFireDepth();return b.length?Promise.all(b).then(()=>!a.defaultPrevented):!a.defaultPrevented}async _FireAndWaitAsync(a){return await this._FireAndWait_AsyncOptional(a)}async _FireAndWaitAsyncSequential(a){this._IncreaseFireDepth();for(let d=0,c=this._captureListeners.length;d<c;++d){var b=this._captureListeners[d](a);b instanceof Promise&&await b}for(let d=0,c=this._listeners.length;d<c;++d)b=this._listeners[d](a),b instanceof
Promise&&await b;this._DecreaseFireDepth();return!a.defaultPrevented}*_FireAsGenerator(a){this._IncreaseFireDepth();for(let d=0,c=this._captureListeners.length;d<c;++d){var b=this._captureListeners[d](a);C3$jscomp$23.IsIterator(b)&&(yield*b)}for(let d=0,c=this._listeners.length;d<c;++d)b=this._listeners[d](a),C3$jscomp$23.IsIterator(b)&&(yield*b);this._DecreaseFireDepth()}};"use strict";const C3$jscomp$24=self.C3;
C3$jscomp$24.Event.Dispatcher=class extends C3$jscomp$24.DefendedBase{constructor(){super();this._eventHandlers=new Map;this._dispatcherWasReleased=!1}Release(){if(this._dispatcherWasReleased)throw Error("already released");this.ClearEvents();this._dispatcherWasReleased=!0;C3$jscomp$24.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){if(this._eventHandlers){for(let a of this._eventHandlers.values())a.Release();this._eventHandlers.clear()}}_GetHandlerByType(a,b){let d=this._eventHandlers.get(a);
return d?d:b?(d=C3$jscomp$24.New(C3$jscomp$24.Event.Handler,a),this._eventHandlers.set(a,d),d):null}HasAnyHandlerFor(a){return this._eventHandlers.has(a)}addEventListener(a,b,d){this._GetHandlerByType(a,!0)._AddListener(b,!!d)}removeEventListener(a,b,d){let c=this._GetHandlerByType(a,!1);c&&(c._RemoveListener(b,!!d),c._IsEmpty()&&this._eventHandlers.delete(a))}dispatchEvent(a){const b=this._GetHandlerByType(a.type,!1);return b?a.cancelable?b._FireCancellable(a):b._FireNonCancellable(a):!0}dispatchEventAsync(a){const b=
this._GetHandlerByType(a.type,!1);if(!b)return Promise.resolve(!0);a.isAsync=!0;return b._FireAsync(a)}async dispatchEventAndClearAsync(a){const b=this._GetHandlerByType(a.type,!1);if(!b)return!0;this._eventHandlers.delete(a.type);a.isAsync=!0;a=await b._FireAsync(a);b.Release();return a}async dispatchEventAndWaitAsync(a){const b=this._GetHandlerByType(a.type,!1);return b?await b._FireAndWaitAsync(a):!0}dispatchEventAndWait_AsyncOptional(a){const b=this._GetHandlerByType(a.type,!1);return b?b._FireAndWait_AsyncOptional(a):
!0}async dispatchEventAndWaitAsyncSequential(a){const b=this._GetHandlerByType(a.type,!1);return b?await b._FireAndWaitAsyncSequential(a):!0}dispatchGeneratorEvent(a){const b=this._GetHandlerByType(a.type,!1);if(!b)return null;if(a.cancelable)throw Error("not supported");return b._FireAsGenerator(a)}SetDelayRemoveEventsEnabled(a){for(const b of this._eventHandlers.values())b.SetDelayRemoveEventsEnabled(a)}};"use strict";const C3$jscomp$25=self.C3,SUPPORTS_RIC="undefined"!==typeof requestIdleCallback;
let workQueue=[],callbackId=-1,highThroughputMode=0;function SetNewCallback(a){callbackId=SUPPORTS_RIC&&0===highThroughputMode?requestIdleCallback(DoAsyncifiedWork,{timeout:35}):setTimeout(DoAsyncifiedWork,0<highThroughputMode?1:a)}
function DoAsyncifiedWork(a){callbackId=-1;if(workQueue.length){var b=performance.now(),d=0;do{DoNextAsyncifiedJob(workQueue.shift());var c=performance.now();++d;var e=(c-b)/d*1.1}while(workQueue.length&&(SUPPORTS_RIC&&0===highThroughputMode&&"undefined"!==typeof a?e<a.timeRemaining():12>c-b+e));-1===callbackId&&workQueue.length&&SetNewCallback(Math.max(16-(c-b),4))}}function DoNextAsyncifiedJob(a){let b;try{b=a.func()}catch(d){a.reject(d);return}a.resolve(b)}let asyncifyDisabled=C3$jscomp$25.QueryString.Has("disable-asyncify");
asyncifyDisabled&&console.warn("[Asyncify] Asyncify has been disabled due to disable-asyncify in the query string. Some work will now be done synchronously.");C3$jscomp$25.Asyncify=function(a){let b=null;C3$jscomp$25.isDebug&&(b=C3$jscomp$25.GetCallStack());return new Promise((d,c)=>{workQueue.push({func:a,resolve:d,reject:c,stack:b});asyncifyDisabled?DoNextAsyncifiedJob(workQueue.pop()):-1===callbackId&&SetNewCallback(16)})};
C3$jscomp$25.Asyncify.SetHighThroughputMode=function(a){if(a)++highThroughputMode;else if(--highThroughputMode,0>highThroughputMode)throw Error("already turned off high throughput mode");};"use strict";const C3$jscomp$26=self.C3;let cachedNowTime=-1;function ClearTimeCache(){cachedNowTime=-1}C3$jscomp$26.FastGetDateNow=function(){-1===cachedNowTime&&(cachedNowTime=Date.now(),self.setTimeout(ClearTimeCache,16));return cachedNowTime};let timerId=-1,nextDeadline=-1,activeIdleTimeouts=new Set;
function CheckActiveIdleTimeouts(){nextDeadline=timerId=-1;let a=Date.now();for(let b of activeIdleTimeouts)if(b._CheckTimeout(a)){let d=b._GetDeadline();if(-1===nextDeadline||d<nextDeadline)nextDeadline=d}else activeIdleTimeouts.delete(b);-1!==nextDeadline&&(timerId=self.setTimeout(CheckActiveIdleTimeouts,Math.max(nextDeadline-a+100,1E3)))}
C3$jscomp$26.IdleTimeout=class{constructor(a,b){this._callback=a;this._timeout=1E3*b;this._deadline=0;this._isActive=!1}Reset(){let a=C3$jscomp$26.FastGetDateNow();this._deadline=a+this._timeout;this._isActive||(activeIdleTimeouts.add(this),this._isActive=!0);-1===timerId?(nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+100)):this._deadline<nextDeadline&&nextDeadline>a+1E3&&(self.clearTimeout(timerId),nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts,
this._timeout+100))}_CheckTimeout(a){return a>=this._deadline?this._callback()?(this._deadline=a+this._timeout,!0):this._isActive=!1:!0}_GetDeadline(){return this._deadline}Cancel(){this._isActive&&(activeIdleTimeouts.delete(this),this._isActive=!1,0===activeIdleTimeouts.size&&-1!==timerId&&(self.clearTimeout(timerId),nextDeadline=timerId=-1))}Release(){this.Cancel();this._callback=null}};"use strict";const C3$jscomp$27=self.C3;
C3$jscomp$27.Disposable=class a{constructor(b){this._disposed=!1;this._disposeAction=b}Dispose(){this._disposed||(this._disposed=!0,this._disposeAction&&(this._disposeAction(),this._disposeAction=null))}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(b){return new a(()=>b.Release())}static From(b,d,c,e,g){if("undefined"===typeof e||null===e)e=!1;else if("boolean"!==typeof e&&"object"!==typeof e)throw new TypeError("invalid event listener options");g&&(c=c.bind(g));if(d.includes(" ")){d=
d.split(" ");g=new C3$jscomp$27.CompositeDisposable;for(let k of d)b.addEventListener(k,c,e),g.Add(C3$jscomp$27.New(C3$jscomp$27.Disposable,()=>b.removeEventListener(k,c,e)));return g}b.addEventListener(d,c,e);return C3$jscomp$27.New(C3$jscomp$27.Disposable,()=>b.removeEventListener(d,c,e))}};C3$jscomp$27.StubDisposable=class extends C3$jscomp$27.Disposable{SetAction(a){this._disposeAction=a}};
C3$jscomp$27.CompositeDisposable=class extends C3$jscomp$27.Disposable{constructor(...a){super();this._disposables=new Set;for(let b of a)this.Add(b)}Add(...a){if(this._disposed)throw Error("already disposed");for(let b of a)this._disposables.add(b)}Remove(a){if(this._disposed)throw Error("already disposed");this._disposables.delete(a)}RemoveAll(){if(this._disposed)throw Error("already disposed");if(this._disposables){for(let a of this._disposables)a.Dispose();this._disposables.clear()}}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw Error("already disposed");
this._disposed=!0;for(let a of this._disposables)a.Dispose();this._disposables.clear();this._disposables=null}Release(){this.Dispose()}};"use strict";const C3$jscomp$28=self.C3;
C3$jscomp$28.KahanSum=class extends C3$jscomp$28.DefendedBase{constructor(){super();this._sum=this._t=this._y=this._c=0}Add(a){this._y=+a-this._c;this._t=this._sum+this._y;this._c=this._t-this._sum-this._y;this._sum=this._t}Subtract(a){this._sum-=+a}Get(){return this._sum}Reset(){this._sum=this._t=this._y=this._c=0}Set(a){this._t=this._y=this._c=0;this._sum=+a}Copy(a){this._c=a._c;this._y=a._y;this._t=a._t;this._sum=a._sum}Release(){}};"use strict";
const C3$jscomp$29=self.C3,js_cols={RBnode:function(a){this.tree=a;this.left=this.right=this.tree.sentinel;this.parent=null;this.color=!1;this.key=null},RedBlackSet:function(a){this.size=0;this.sentinel=new js_cols.RBnode(this);this.sentinel.color=!1;this.root=this.sentinel;this.root.parent=this.sentinel;this.compare=a||this.default_compare}};js_cols.RedBlackSet.prototype.default_compare=function(a,b){return a<b?-1:b<a?1:0};
js_cols.RedBlackSet.prototype.clone=function(){var a=new js_cols.RedBlackSet(this.compare);a.insertAll(this);return a};js_cols.RedBlackSet.prototype.clear=function(){this.size=0;this.sentinel=new js_cols.RBnode(this);this.sentinel.color=!1;this.root=this.sentinel;this.root.parent=this.sentinel};
js_cols.RedBlackSet.prototype.leftRotate=function(a){var b=a.right;a.right=b.left;b.left!=this.sentinel&&(b.left.parent=a);b.parent=a.parent;a.parent==this.sentinel?this.root=b:a==a.parent.left?a.parent.left=b:a.parent.right=b;b.left=a;a.parent=b};js_cols.RedBlackSet.prototype.rightRotate=function(a){var b=a.left;a.left=b.right;b.right!=this.sentinel&&(b.right.parent=a);b.parent=a.parent;a.parent==this.sentinel?this.root=b:a==a.parent.right?a.parent.right=b:a.parent.left=b;b.right=a;a.parent=b};
js_cols.RedBlackSet.prototype.insert=function(a){if(this.contains(a))this.get_(a).key=a;else{var b=new js_cols.RBnode(this);b.key=a;a=this.sentinel;for(var d=this.root;d!=this.sentinel;)a=d,d=0>this.compare(b.key,d.key)?d.left:d.right;b.parent=a;a==this.sentinel?this.root=b:0>this.compare(b.key,a.key)?a.left=b:a.right=b;b.left=this.sentinel;b.right=this.sentinel;b.color=!0;this.insertFixup(b);this.size++}};
js_cols.RedBlackSet.prototype.insertFixup=function(a){for(;a!=this.sentinel&&a!=this.root&&1==a.parent.color;)if(a.parent==a.parent.parent.left){var b=a.parent.parent.right;1==b.color?(a.parent.color=!1,b.color=!1,a.parent.parent.color=!0,a=a.parent.parent):(a==a.parent.right&&(a=a.parent,this.leftRotate(a)),a.parent.color=!1,a.parent.parent.color=!0,a.parent.parent!=this.sentinel&&this.rightRotate(a.parent.parent))}else b=a.parent.parent.left,1==b.color?(a.parent.color=!1,b.color=!1,a.parent.parent.color=
!0,a=a.parent.parent):(a==a.parent.left&&(a=a.parent,this.rightRotate(a)),a.parent.color=!1,a.parent.parent.color=!0,a.parent.parent!=this.sentinel&&this.leftRotate(a.parent.parent));this.root.color=!1};
js_cols.RedBlackSet.prototype.delete_=function(a){var b=a.left==this.sentinel||a.right==this.sentinel?a:this.successor_(a);var d=b.left!=this.sentinel?b.left:b.right;d.parent=b.parent;b.parent==this.sentinel?this.root=d:b==b.parent.left?b.parent.left=d:b.parent.right=d;b!=a&&(a.key=b.key);0==b.color&&this.deleteFixup(d);this.size--};
js_cols.RedBlackSet.prototype.deleteFixup=function(a){for(;a!=this.root&&0==a.color;)if(a==a.parent.left){var b=a.parent.right;1==b.color&&(b.color=!1,a.parent.color=!0,this.leftRotate(a.parent),b=a.parent.right);0==b.left.color&&0==b.right.color?(b.color=!0,a=a.parent):(0==b.right.color&&(b.left.color=!1,b.color=!0,this.rightRotate(b),b=a.parent.right),b.color=a.parent.color,a.parent.color=!1,b.right.color=!1,this.leftRotate(a.parent),a=this.root)}else b=a.parent.left,1==b.color&&(b.color=!1,a.parent.color=
!0,this.rightRotate(a.parent),b=a.parent.left),0==b.right.color&&0==b.left.color?(b.color=!0,a=a.parent):(0==b.left.color&&(b.right.color=!1,b.color=!0,this.leftRotate(b),b=a.parent.left),b.color=a.parent.color,a.parent.color=!1,b.left.color=!1,this.rightRotate(a.parent),a=this.root);a.color=!1};js_cols.RedBlackSet.prototype.remove=function(a){a=this.get_(a);if(a!=this.sentinel){var b=a.key;this.delete_(a);return b}return null};js_cols.RedBlackSet.prototype.removeSwapped=function(a,b){this.remove(b)};
js_cols.RedBlackSet.prototype.min=function(a){for(;a.left!=this.sentinel;)a=a.left;return a};js_cols.RedBlackSet.prototype.max=function(a){for(;a.right!=this.sentinel;)a=a.right;return a};js_cols.RedBlackSet.prototype.successor_=function(a){if(a.right!=this.sentinel)return this.min(a.right);for(var b=a.parent;b!=this.sentinel&&a==b.right;)a=b,b=b.parent;return b};
js_cols.RedBlackSet.prototype.predeccessor_=function(a){if(a.left!=this.sentinel)return this.max(a.left);for(var b=a.parent;b!=this.sentinel&&a==b.left;)a=b,b=b.parent;return b};js_cols.RedBlackSet.prototype.successor=function(a){if(0<this.size){a=this.get_(a);if(a==this.sentinel)return null;if(a.right!=this.sentinel)return this.min(a.right).key;for(var b=a.parent;b!=this.sentinel&&a==b.right;)a=b,b=b.parent;return b!=this.sentinel?b.key:null}return null};
js_cols.RedBlackSet.prototype.predecessor=function(a){if(0<this.size){a=this.get_(a);if(a==this.sentinel)return null;if(a.left!=this.sentinel)return this.max(a.left).key;for(var b=a.parent;b!=this.sentinel&&a==b.left;)a=b,b=b.parent;return b!=this.sentinel?b.key:null}return null};js_cols.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key};js_cols.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key};
js_cols.RedBlackSet.prototype.get_=function(a){for(var b=this.root;b!=this.sentinel&&0!=this.compare(b.key,a);)b=0>this.compare(a,b.key)?b.left:b.right;return b};js_cols.RedBlackSet.prototype.contains=function(a){return null!=this.get_(a).key};js_cols.RedBlackSet.prototype.getValues=function(){var a=[];this.forEach(function(b){a.push(b)});return a};
js_cols.RedBlackSet.prototype.insertAll=function(a){if("array"==js_cols.typeOf(a))for(var b=0;b<a.length;b++)this.insert(a[b]);else if("function"==js_cols.typeOf(a.forEach))a.forEach(this.insert,this);else if("function"==js_cols.typeOf(a.getValues))for(a=a.getValues(),b=0;b<a.length;b++)this.insert(a[b]);else if("object"==js_cols.typeOf(a))for(b in a)this.insert(a[b])};
js_cols.RedBlackSet.prototype.removeAll=function(a){if("array"==js_cols.typeOf(a))for(var b=0;b<a.length;b++)this.remove(a[b]);else if("function"==js_cols.typeOf(a.forEach))a.forEach(this.removeSwapped,this);else if("function"==js_cols.typeOf(a.getValues))for(a=a.getValues(),b=0;b<a.length;b++)this.remove(a[b]);else if("object"==js_cols.typeOf(a))for(b in a)this.remove(a[b])};
js_cols.RedBlackSet.prototype.containsAll=function(a){if("array"==js_cols.typeOf(a)){for(var b=0;b<a.length;b++)if(!this.contains(a[b]))return!1;return!0}if("function"==js_cols.typeOf(a.forEach))return a.every(this.contains,this);if("function"==js_cols.typeOf(a.getValues)){a=a.getValues();for(b=0;b<a.length;b++)if(!this.contains(a[b]))return!1;return!0}if("object"==js_cols.typeOf(a)){for(b in a)if(!this.contains(a[b]))return!1;return!0}};
js_cols.RedBlackSet.prototype.range=function(a,b){var d=[];this.traverseFromTo(function(c){d.push(c)},a,b);return d};js_cols.RedBlackSet.prototype.traverse=function(a,b){if(!this.isEmpty())for(var d=this.min(this.root);d!=this.sentinel&&!a.call(b,d.key,this);)d=this.successor_(d)};js_cols.RedBlackSet.prototype.traverseFrom=function(a,b,d){if(!this.isEmpty())for(b=this.get_(b);b!=this.sentinel&&!a.call(d,b.key,this);)b=this.successor_(b)};
js_cols.RedBlackSet.prototype.traverseTo=function(a,b,d){if(!this.isEmpty()){var c=this.min(this.root);for(b=this.get_(b);c!=b&&!a.call(d,c.key,this);)c=this.successor_(c)}};js_cols.RedBlackSet.prototype.traverseFromTo=function(a,b,d,c){if(!this.isEmpty())for(b=this.get_(b),d=this.get_(d);b!=d&&!a.call(c,b.key,this);)b=this.successor_(b)};js_cols.RedBlackSet.prototype.traverseBackwards=function(a,b){if(!this.isEmpty())for(var d=this.max(this.root);d!=this.sentinel&&!a.call(b,d.key,this);)d=this.predeccessor_(d)};
js_cols.RedBlackSet.prototype.forEach=function(a,b){if(!this.isEmpty())for(var d=this.min(this.root);d!=this.sentinel;d=this.successor_(d))a.call(b,d.key,d.key,this)};js_cols.RedBlackSet.prototype.some=function(a,b){if(this.isEmpty())return!1;for(var d=this.min(this.root);d!=this.sentinel;d=this.successor_(d))if(a.call(b,d.key,d.key,this))return!0;return!1};
js_cols.RedBlackSet.prototype.every=function(a,b){if(this.isEmpty())return!1;for(var d=this.min(this.root);d!=this.sentinel;d=this.successor_(d))if(!a.call(b,d.key,d.key,this))return!1;return!0};js_cols.RedBlackSet.prototype.map=function(a,b){var d=[];if(this.isEmpty())return d;for(var c=this.min(this.root);c!=this.sentinel;c=this.successor_(c))d.push(a.call(b,c.key,c.key,this));return d};
js_cols.RedBlackSet.prototype.filter=function(a,b){var d=[];if(this.isEmpty())return d;for(var c=this.min(this.root);c!=this.sentinel;c=this.successor_(c))a.call(b,c.key,c.key,this)&&d.push(c.key);return d};js_cols.RedBlackSet.prototype.getCount=function(){return this.size};js_cols.RedBlackSet.prototype.isEmpty=function(){return 0==this.size};
js_cols.RedBlackSet.prototype.isSubsetOf=function(a){var b=js_cols.getCount(a);if(this.getCount()>b)return!1;b=0;if(this.isEmpty())return!0;for(var d=this.min(this.root);d!=this.sentinel;d=this.successor_(d))js_cols.contains.call(a,a,d.key)&&b++;return b==this.getCount()};
js_cols.RedBlackSet.prototype.intersection=function(a){var b=new js_cols.RedBlackSet(this.compare);if(this.isEmpty())return b;for(var d=this.min(this.root);d!=this.sentinel;d=this.successor_(d))a.contains.call(a,d.key,d.key,this)&&b.insert(d.key);return b};
C3$jscomp$29.RedBlackSet=class extends C3$jscomp$29.DefendedBase{constructor(a){super();this._rbSet=new js_cols.RedBlackSet(a);this._enableQueue=!1;this._queueInsert=new Set;this._queueRemove=new Set}Add(a){this._enableQueue?this._rbSet.contains(a)?this._queueRemove.delete(a):this._queueInsert.add(a):this._rbSet.insert(a)}Remove(a){this._enableQueue?this._rbSet.contains(a)?this._queueRemove.add(a):this._queueInsert.delete(a):this._rbSet.remove(a)}Has(a){return this._enableQueue?this._queueInsert.has(a)?
!0:!this._queueRemove.has(a)&&this._rbSet.contains(a):this._rbSet.contains(a)}Clear(){this._rbSet.clear();this._queueInsert.clear();this._queueRemove.clear()}toArray(){if(this._enableQueue)throw Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return 0===this.GetSize()}Front(){if(this.IsEmpty())throw Error("empty set");if(this._enableQueue)throw Error("cannot be used in queueing mode");
const a=this._rbSet;return a.min(a.root).key}Shift(){if(this.IsEmpty())throw Error("empty set");if(this._enableQueue)throw Error("cannot be used in queueing mode");const a=this.Front();this.Remove(a);return a}SetQueueingEnabled(a){a=!!a;if(this._enableQueue!==a&&(this._enableQueue=a,!a)){for(const b of this._queueRemove)this._rbSet.remove(b);this._queueRemove.clear();for(const b of this._queueInsert)this._rbSet.insert(b);this._queueInsert.clear()}}ForEach(a){this._rbSet.forEach(a)}*values(){if(!this.IsEmpty()){var a=
this._rbSet;for(let b=a.min(a.root);b!=a.sentinel;b=a.successor_(b))yield b.key}}[Symbol.iterator](){return this.values()}};"use strict";const C3$jscomp$30=self.C3;
C3$jscomp$30.PromiseThrottle=class{constructor(a=C3$jscomp$30.hardwareConcurrency){this._maxParallel=a;this._queue=[];this._activeCount=0}Add(a){return new Promise((b,d)=>{this._queue.push({func:a,resolve:b,reject:d});this._MaybeStartNext()})}_FindInQueue(a){for(let b=0,d=this._queue.length;b<d;++b)if(this._queue[b].func===a)return b;return-1}RemoveAndResolve(a,b){a=this._FindInQueue(a);if(-1===a)throw Error("cannot find promise to resolve");this._queue[a].resolve(b);this._queue.splice(a,1)}RemoveAndReject(a,
b){a=this._FindInQueue(a);if(-1===a)throw Error("cannot find promise to reject");this._queue[a].reject(b);this._queue.splice(a,1)}async _MaybeStartNext(){if(this._queue.length&&!(this._activeCount>=this._maxParallel)){this._activeCount++;var a=this._queue.shift();try{const b=await a.func();a.resolve(b)}catch(b){a.reject(b)}this._activeCount--;this._MaybeStartNext()}}static async Batch(a,b){const d=[];let c=!1;const e=async k=>{for(;(k=b.pop())&&!c;)try{d.push(await k())}catch(l){throw c=!0,l;}},g=
[];for(;a--;)g.push(e());await Promise.all(g);return d}};"use strict";const C3$jscomp$31=self.C3;
C3$jscomp$31.RateLimiter=class{constructor(a,b,d){this._callback=a;this._interval=b;this._intervalOnBattery=d||2*b;this._timerId=-1;this._lastCallTime=-Infinity;this._timerCallFunc=()=>this._OnTimer();this._canRunImmediate=this._ignoreReset=!1;this._callbackArguments=null}SetCanRunImmediate(a){this._canRunImmediate=!!a}_GetInterval(){return"undefined"!==typeof C3$jscomp$31.Battery&&C3$jscomp$31.Battery.IsOnBatteryPower()?this._intervalOnBattery:this._interval}Call(...a){if(-1===this._timerId){this._callbackArguments=
a;a=C3$jscomp$31.FastGetDateNow();var b=a-this._lastCallTime,d=this._GetInterval();b>=d&&this._canRunImmediate?(this._lastCallTime=a,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(d-b,4))}}_RunCallback(){this._ignoreReset=!0;const a=this._callbackArguments;this._callbackArguments=null;a?this._callback(...a):this._callback();this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._callbackArguments=null,this._lastCallTime=C3$jscomp$31.FastGetDateNow())}_OnTimer(){this._timerId=
-1;this._lastCallTime=C3$jscomp$31.FastGetDateNow();this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer();this._timerCallFunc=this._callbackArguments=this._callback=null}};"use strict";const C3$jscomp$32=self.C3;
C3$jscomp$32.SVGRasterManager=class{constructor(){this._images=new Map;this._allowNpotSurfaces=!1;this._redrawCallback=this._releaseResultCallback=this._rasterAtSizeCallback=this._getBaseSizeCallback=null}SetNpotSurfaceAllowed(a){this._allowNpotSurfaces=!!a}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(a){this._getBaseSizeCallback=a}GetBaseSize(a){if(!this._getBaseSizeCallback)throw Error("no get base size callback set");return this._getBaseSizeCallback(a)}SetRasterAtSizeCallback(a){this._rasterAtSizeCallback=
a}RasterAtSize(a,b,d,c,e,g){if(!this._rasterAtSizeCallback)throw Error("no raster at size callback set");return this._rasterAtSizeCallback(a,b,d,c,e,g)}SetReleaseResultCallback(a){this._releaseResultCallback=a}ReleaseResult(a){if(!this._releaseResultCallback)throw Error("no release result callback set");this._releaseResultCallback(a)}SetRedrawCallback(a){this._redrawCallback=a}Redraw(){if(!this._redrawCallback)throw Error("no redraw callback set");this._redrawCallback()}AddImage(a){let b=this._images.get(a);
b||(b=C3$jscomp$32.New(C3$jscomp$32.SVGRasterImage,this,a),this._images.set(a,b));b.IncReference();return b}_RemoveImage(a){this._images.delete(a.GetDataSource())}OnTexturesChanged(){for(const a of this._images.values())a.ReleaseRasterizedResult(),a.ForceRasterAgain()}};"use strict";const C3$jscomp$33=self.C3;
C3$jscomp$33.SVGRasterImage=class{constructor(a,b){this._manager=a;this._dataSource=b;this._baseHeight=this._baseWidth=this._refCount=0;this._getBaseSizePromise=this._manager.GetBaseSize(b).then(d=>{this._manager&&(this._baseWidth=d[0],this._baseHeight=d[1],this._manager.Redraw())}).catch(d=>{console.error("[SVG] Error loading SVG: ",d);this._hadError=!0;this._manager&&this._manager.Redraw()});this._rasterImageHeight=this._rasterImageWidth=this._rasterSurfaceHeight=this._rasterSurfaceWidth=0;this._isRasterizing=
!1;this._rasterizedResult=null;this._hadError=this._forceRaster=!1}Release(){if(0>=this._refCount)throw Error("already released");this._refCount--;0===this._refCount&&this._Release()}ReleaseRasterizedResult(){this._rasterizedResult&&(this._manager.ReleaseResult(this._rasterizedResult),this._rasterizedResult=null)}_Release(){this.ReleaseRasterizedResult();this._manager._RemoveImage(this);this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return 0<
this._refCount}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=!0}async StartRasterForSize(a,b,d){if(0!==b&&0!==d&&!this._hadError&&!this._isRasterizing){var c=C3$jscomp$33.nextHighestPowerOfTwo(Math.ceil(b)),e=C3$jscomp$33.nextHighestPowerOfTwo(Math.ceil(d)),g=Math.max(c,e);4096<g&&(g=4096/g,b*=g,d*=g,c=Math.min(Math.ceil(c*g),4096),e=Math.min(Math.ceil(e*g),4096));b<c&&d<e&&(d=b/d,c/e>d?(b=e*d,d=e):(b=c,d=c/d));this._manager.IsNpotSurfaceAllowed()&&(c=Math.ceil(b),
e=Math.ceil(d));c<=this._rasterSurfaceWidth&&e<=this._rasterSurfaceHeight&&!this._forceRaster||(this._isRasterizing=!0,this._rasterSurfaceWidth=c,this._rasterSurfaceHeight=e,a=await this._manager.RasterAtSize(this._dataSource,a,this._rasterSurfaceWidth,this._rasterSurfaceHeight,b,d),this._manager&&(this.ReleaseRasterizedResult(),this._rasterizedResult=a,this._rasterImageWidth=b,this._rasterImageHeight=d,this._forceRaster=this._isRasterizing=!1,this._manager.Redraw()))}}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}};
"use strict";const C3$jscomp$34=self.C3;C3$jscomp$34.UTF8_BOM="\ufeff";const NUMERIC_CHARS=new Set([..."0123456789"]);C3$jscomp$34.IsNumericChar=function(a){return NUMERIC_CHARS.has(a)};const WHITESPACE_CHARS=new Set([..." \t\n\r\u00a0\u0085\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000"]);C3$jscomp$34.IsWhitespaceChar=function(a){return WHITESPACE_CHARS.has(a)};C3$jscomp$34.FilterWhitespace=function(a){return[...a].filter(b=>!C3$jscomp$34.IsWhitespaceChar(b)).join("")};
C3$jscomp$34.IsStringAllWhitespace=function(a){for(const b of a)if(!C3$jscomp$34.IsWhitespaceChar(b))return!1;return!0};C3$jscomp$34.IsCharArrayAllWhitespace=function(a){for(const b of a)if(!C3$jscomp$34.IsWhitespaceChar(b))return!1;return!0};C3$jscomp$34.IsUnprintableChar=function(a){return 1===a.length&&32>a.charCodeAt(0)};C3$jscomp$34.FilterUnprintableChars=function(a){return[...a].filter(b=>!C3$jscomp$34.IsUnprintableChar(b)).join("")};const NUMERIC_STRING_CHARS=new Set([..."0123456789.+-e"]);
C3$jscomp$34.IsStringNumber=function(a){a=a.trim();if(!a.length)return!1;let b=a.charAt(0);if("-"!==b&&!NUMERIC_CHARS.has(b))return!1;for(let d of a)if(!NUMERIC_STRING_CHARS.has(d))return!1;return!0};C3$jscomp$34.RemoveTrailingDigits=function(a){let b=a.length;for(;0<b;){let d=a.charAt(b-1);if(!C3$jscomp$34.IsNumericChar(d))break;--b}return a.substr(0,b)};
C3$jscomp$34.IncrementNumberAtEndOf=function(a){let b=C3$jscomp$34.RemoveTrailingDigits(a);a=(a=a.substr(b.length))?(parseInt(a,10)+1).toString():"2";return b+a};const HTML_ENTITY_MAP=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]]);function lookupHtmlEntity(a){return HTML_ENTITY_MAP.get(a)}const HTML_ENTITY_REGEX=/[&<>"']/g;C3$jscomp$34.EscapeHTML=function(a){return a.replace(HTML_ENTITY_REGEX,lookupHtmlEntity)};
C3$jscomp$34.EscapeJS=function(a){a=C3$jscomp$34.ReplaceAll(a,"\\","\\\\");a=C3$jscomp$34.ReplaceAll(a,'"','\\"');a=C3$jscomp$34.ReplaceAll(a,"\t","\\t");a=C3$jscomp$34.ReplaceAll(a,"\r","");return C3$jscomp$34.ReplaceAll(a,"\n","\\n")};C3$jscomp$34.EscapeXML=function(a){a=C3$jscomp$34.ReplaceAll(a,"&","&amp;");a=C3$jscomp$34.ReplaceAll(a,"<","&lt;");a=C3$jscomp$34.ReplaceAll(a,">","&gt;");return C3$jscomp$34.ReplaceAll(a,'"',"&quot;")};const ESCAPE_REGEX=/[-[\]{}()*+?.,\\^$|#\s]/g;
C3$jscomp$34.EscapeRegex=function(a){return a.replace(ESCAPE_REGEX,"\\$&")};C3$jscomp$34.CountCharsInString=function(a,b){let d=0;for(const c of a)c===b&&++d;return d};C3$jscomp$34.FindAll=function(a,b,d=!1){if(!b)return[];d||(a=a.toLowerCase(),b=b.toLowerCase());d=b.length;var c=0;let e=[];for(;-1<(c=a.indexOf(b,c));)e.push(c),c+=d;return e};C3$jscomp$34.ReplaceAll=function(a,b,d){return a.replaceAll(b,()=>d)};
C3$jscomp$34.ReplaceAllCaseInsensitive=function(a,b,d){return a.replace(new RegExp(C3$jscomp$34.EscapeRegex(b),"gi"),()=>d)};C3$jscomp$34.SetElementContent=function(a,b){"string"===typeof b?a.textContent=b:b.isPlainText()?a.textContent=b.toString():(a.innerHTML=b.toHTML(),b instanceof C3$jscomp$34.BBString&&b.attachLinkHandlers(a))};
C3$jscomp$34.StringLikeEquals=function(a,b){return a instanceof C3$jscomp$34.HtmlString||a instanceof C3$jscomp$34.BBString?a.equals(b):b instanceof C3$jscomp$34.HtmlString||b instanceof C3$jscomp$34.BBString?b.equals(a):a===b};C3$jscomp$34.StringSubstitute=function(a,...b){let d=a;for(let c=0,e=b.length;c<e;++c){const g=`{${c}}`;if(!a.includes(g))throw Error(`missing placeholder '${g}' in string substitution`);d=d.replace(g,b[c].toString())}return d};
C3$jscomp$34.StringSubstituteAllowMissing=function(a,...b){let d=a,c=-1,e=-1;for(let g=0,k=b.length;g<k;++g){const l=`{${g}}`;a.includes(l)?(e=g,d=d.replace(l,b[g].toString())):-1===c&&(c=g)}if(0<=c&&0<=e&&c<e)throw Error(`missing placeholder '${c}' in string substitution`);return d};C3$jscomp$34.StringSubstituteMap=function(a,b){for(let [d,c]of Object.entries(b))a=a.replaceAll(d,c.toString());return a};C3$jscomp$34.SortAZ=function(a,b){return a>b?1:a<b?-1:0};
C3$jscomp$34.SortAZCaseInsensitive=function(a,b){a=a.toLowerCase();b=b.toLowerCase();return a>b?1:a<b?-1:0};let intlSegmenter=null,graphemeSplitter=null;self.Intl&&self.Intl.Segmenter?intlSegmenter=new self.Intl.Segmenter:graphemeSplitter=new self.GraphemeSplitter;C3$jscomp$34.SplitGraphemes=function(a){if(intlSegmenter){const b=[];for(const d of intlSegmenter.segment(a))b.push(d.segment);return b}return graphemeSplitter.splitGraphemes(a)};
C3$jscomp$34.IterateGraphemes=function*(a){if(intlSegmenter)for(const b of intlSegmenter.segment(a))yield b.segment;else yield*graphemeSplitter.iterateGraphemes(a)};C3$jscomp$34.CountGraphemes=function(a){if(intlSegmenter){let b=0;for(const d of intlSegmenter.segment(a))++b;return b}return graphemeSplitter.countGraphemes(a)};const MEGABYTE=1048576,GIGABYTE=1024*MEGABYTE,TERABYTE=1024*GIGABYTE;
C3$jscomp$34.FormatDataSize=function(a,b){b="common."+(b?"dataRates":"dataSizes")+".";const d=self.langSub;if(1024>a)return d(b+"bytes",a);if(a<MEGABYTE)return a/=1024,a=10>a?Math.round(10*a)/10:Math.round(a),d(b+"kilobytes",a);if(a<GIGABYTE)return a/=MEGABYTE,a=10>a?Math.round(10*a)/10:Math.round(a),d(b+"megabytes",a);if(a<TERABYTE)return a/=GIGABYTE,a=10>a?Math.round(10*a)/10:Math.round(a),d(b+"gigabytes",a);a/=TERABYTE;a=10>a?Math.round(10*a)/10:Math.round(a);return d(b+"terabytes",a)};
const DEFAULT_FORMATTIME_OPTS={approximate:!1,days:!0,hours:!0,minutes:!0,seconds:!0};
C3$jscomp$34.FormatTime=function(a,b){b=Object.assign({},DEFAULT_FORMATTIME_OPTS,b);C3$jscomp$34.Lang.PushContext("common.time");const d=[],c=self.lang,e=self.langPluralSub;if(b.days){var g=Math.floor(a/86400);0<g&&(a-=86400*g,d.push(e(".days",null,g)))}b.hours&&(g=Math.floor(a/3600),0<g||d.length)&&(a-=3600*g,d.push(e(".hours",null,g)));b.minutes&&(g=Math.floor(a/60),0<g||d.length||!b.seconds)&&(a-=60*g,d.push(e(".minutes",null,g)));b.seconds&&d.push(e(".seconds",null,Math.floor(a%60)));a=(b.approximate?
c(".approx-prefix"):"")+d.join(c(".separator"));C3$jscomp$34.Lang.PopContext();return a};C3$jscomp$34.ZeroPad=function(a,b){let d=0>a?"-":"";a=Math.abs(a);a=a.toString();b-=a.length;for(let c=0;c<b;++c)d+="0";return d+a};C3$jscomp$34.StringToTitleCase=function(a){return a.toLowerCase().replace(/\b\w/g,b=>b.toUpperCase())};
C3$jscomp$34.CompareVersionStrings=function(a,b){a=a.split(".").map(d=>d.trim());b=b.split(".").map(d=>d.trim());C3$jscomp$34.resizeArray(a,4,"0");C3$jscomp$34.resizeArray(b,4,"0");a=a.map(d=>parseInt(d,10));b=b.map(d=>parseInt(d,10));for(let d=0;4>d;++d){const c=a[d]-b[d];if(0!==c)return 0>c?-1:1}return 0};C3$jscomp$34.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{const b=Math.floor(16*Math.random());return("x"===a?b:b&3|8).toString(16)})};
C3$jscomp$34.StringHammingDistance=function(a,b){if(a.length!==b.length)throw Error("strings must be same length");let d=0;for(let c=0,e=a.length;c<e;++c)a.charAt(c)!==b.charAt(c)&&++d;return d};
C3$jscomp$34.StringLevenshteinDistance=function(a,b){if(0===a.length)return b.length;if(0===b.length)return a.length;let d,c,e,g;if(a.length>b.length){var k=a;a=b;b=k}g=Array(a.length+1);for(k=0;k<=a.length;k++)g[k]=k;for(k=1;k<=b.length;k++){c=k;for(d=1;d<=a.length;d++)e=b[k-1]===a[d-1]?g[d-1]:Math.min(g[d-1]+1,Math.min(c+1,g[d]+1)),g[d-1]=c,c=e;g[a.length]=c}return g[a.length]};"use strict";
const C3$jscomp$35=self.C3,BB_CODE_MAP=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],
["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]),SELF_CLOSING_TAGS=new Set(["icon"]),BBREGEX=/\[(\/?)([a-zA-Z0-9]+)\]/g,CUSTOM_BBREGEX=/\[(\/?)([^\[\n]*?)\]/g;let linkActions=null,tipList=null,classIndex=0;
function bbToHtmlReplacerFunc(a,b,d){var c=BB_CODE_MAP.get(d);if(c){if("string"===typeof c){if("a"===c&&0===linkActions.length||"abbr"===c&&0===tipList.length)return a;if("a"!==c||b){if("abbr"!==c||b)return"<"+b+c+">";b=parseInt(d.substring(3),10)-1;if(0>b||b>=tipList.length)throw Error("invalid bbcode tip substitution");b=tipList[b];c="";"string"===typeof b?c=b:"function"===typeof b&&(c=b());if("string"!==typeof c)throw new TypeError("invalid bbcode tip");return`<abbr title="${C3$jscomp$35.ReplaceAll(c,
'"',"&quot;")}">`}b=parseInt(d.substring(1),10)-1;if(0>b||b>=linkActions.length)throw Error("invalid bbcode link substitution");c=linkActions[b];if("string"===typeof c)return`<a href="${linkActions[b]}">`;if("function"===typeof c)return`<a class="bblink${b}">`;throw new TypeError("invalid bbcode link action");}if(Array.isArray(c))return a=c[0],c=c[1],b?"</"+a+">":`<${a} class="${c}">`}else return"class"===d?b?"</span>":`<span class="bbclass${classIndex++}">`:a}const LINEBREAK_REGEX=/\n/g;
C3$jscomp$35.BBString=class{constructor(a,b){this._bbstr=b&&b.noEscape?a:C3$jscomp$35.EscapeHTML(a);this._htmlstr="";this._convertLineBreaks=!1;this._linkActions=[];this._tipList=[];if(b){this._convertLineBreaks=!!b.convertLineBreaks;if(b.links){if(9<b.links.length)throw Error("too many links");this._linkActions=b.links}if(b.tips){if(9<b.tips.length)throw Error("too many tips");this._tipList=b.tips}}this._hasAnyBBtags=this._bbstr.includes("[");this._needsLineBreakConversion=this._convertLineBreaks&&
this._bbstr.includes("\n");this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&");this._hasParsedFragments=!1;this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){return this._hasAnyBBtags?this._bbstr.replace(BBREGEX,""):this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let a=this._bbstr;this._hasAnyBBtags&&(classIndex=0,linkActions=this._linkActions,
tipList=this._tipList,a=a.replace(BBREGEX,bbToHtmlReplacerFunc),tipList=linkActions=null);this._needsLineBreakConversion&&(a=a.replace(LINEBREAK_REGEX,"<br>"));this._htmlstr=a}return this._htmlstr}attachLinkHandlers(a){if(this._linkActions.length)for(let b=0,d=this._linkActions.length;b<d;++b){const c=this._linkActions[b];if("function"!==typeof c)continue;const e=a.querySelector(".bblink"+b);if(!e)throw Error("unable to attach BBString link handler");e.onclick=c}}equals(a){return a instanceof C3$jscomp$35.HtmlString?
this.toHTML()===a.toHTML():a instanceof C3$jscomp$35.BBString?this._bbstr===a._bbstr:this._bbstr===a}toFragmentList(){if(this._hasParsedFragments)return this._fragments;const a=[],b=this._bbstr,d=[];let c=CUSTOM_BBREGEX.lastIndex=0;for(var e=null;null!==(e=CUSTOM_BBREGEX.exec(b));){var g=e.index;if(0<g&&"\\"===b.charAt(g-1))continue;var k=e[0],l=e[1];e=e[2];const n=b.substring(c,g);c=g+k.length;n&&a.push({text:n,styles:d.slice(0)});if(e)if(l)for(e=e.toLowerCase(),g=d.length-1;0<=g;--g){if(d[g].tag===
e){d.splice(g,1);break}}else if(g=e,k=null,l=e.indexOf("="),-1!==l?(g=e.substring(0,l).toLowerCase(),k=e.substring(l+1)):g=g.toLowerCase(),SELF_CLOSING_TAGS.has(g))if("icon"===g)a.push({icon:k,styles:d.slice(0)});else throw Error(`unknown self-closing tag ${g}`);else d.push({tag:g,param:k})}c<b.length&&a.push({text:b.substring(c),styles:d.slice(0)});for(const n of a)n.text&&(n.text=this._ProcessBBCodeEscapeSequences(n.text));this._fragments=a.map(n=>n.icon?C3$jscomp$35.New(C3$jscomp$35.IconFragment,
{icon:n.icon,styles:n.styles}):C3$jscomp$35.New(C3$jscomp$35.TextFragment,{chArr:C3$jscomp$35.SplitGraphemes(n.text),styles:n.styles}));this._hasParsedFragments=!0;return this._fragments}_ProcessBBCodeEscapeSequences(a){a=C3$jscomp$35.ReplaceAll(a,"\\[","[");return C3$jscomp$35.ReplaceAll(a,"\\\\","\\")}static StripTags(a){return C3$jscomp$35.New(C3$jscomp$35.BBString,a,{noEscape:!0}).toPlainText()}static StripAnyTags(a){return a.replace(CUSTOM_BBREGEX,"")}};"use strict";const C3$jscomp$36=self.C3;
function IsWordBreakWhiteSpace(a){return"\u00a0"===a||"\u202f"===a?!1:C3$jscomp$36.IsWhitespaceChar(a)}function WordBreakTrimEnd(a){for(;0<a.length&&IsWordBreakWhiteSpace(a.at(-1));)a.pop()}function IsNewline(a){return"\n"===a||"\r\n"===a}
C3$jscomp$36.WordWrap=class{constructor(){this._lines=[];this._iconSet=null}GetLines(){return this._lines}GetLineCount(){return this._lines.length}SetIconSet(a){this._iconSet=a}_MeasureLine(a,b){let d=0,c=0,e=0,g=0,k=0;for(const l of a)-1===l.GetWidth()&&(a=b(l),l.SetHeight(a.height),l.SetFontBoundingBoxAscent(a.fontBoundingBoxAscent||0),l.SetFontBoundingBoxDescent(a.fontBoundingBoxDescent||0),l.SetTopToAlphabeticDistance(a.topToAlphabeticDistance||0),l.IsText()?l.SetWidth(a.width):l.IsIcon()&&l.CalculateWidthFromHeight(this._iconSet)),
d+=l.GetWidth(),c=Math.max(c,l.GetHeight()),e=Math.max(e,l.GetFontBoundingBoxAscent()),g=Math.max(g,l.GetFontBoundingBoxDescent()),k=Math.max(k,l.GetTopToAlphabeticDistance());return{width:d,height:c,fontBoundingBoxAscent:e,fontBoundingBoxDescent:g,topToAlphabeticDistance:k}}_AddLine(a,b,d,c,e,g){this._lines.push(C3$jscomp$36.New(C3$jscomp$36.WordWrap.Line,{fragments:a,width:b,height:d,fontBoundingBoxAscent:c,fontBoundingBoxDescent:e,topToAlphabeticDistance:g}))}WordWrap(a,b,d,c,e){"string"===typeof a&&
(a=[C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:C3$jscomp$36.SplitGraphemes(a)})]);C3$jscomp$36.clearArray(this._lines);if(!(!a.length||1===a.length&&a[0].IsText()&&a[0].IsEmpty()||2>d)){if(1===a.length){const g=a[0];if(g.IsText()&&100>=g.GetLength()&&!g.HasNewLine()){let {width:k,height:l,fontBoundingBoxAscent:n,fontBoundingBoxDescent:p,topToAlphabeticDistance:r}=b(g);k+=e;g.SetWidth(k);g.SetHeight(l);g.SetFontBoundingBoxAscent(n||0);g.SetFontBoundingBoxDescent(p||0);g.SetTopToAlphabeticDistance(r||
0);if(k<=d){this._AddLine([g],k,l,n,p,r);return}}}if("word"===c)c=this._TokeniseWords(a);else{c=[];for(const g of a)g.IsText()?(a=g.GetCharacterArray(),C3$jscomp$36.appendArray(c,a.map(k=>[C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:[k],styles:g.GetStyles()})]))):c.push([g])}this._WrapText(c,b,d,e)}}_TokeniseWords(a){const b=[];var d=[],c=!1;for(const g of a)if(a=g.GetStyles(),g.IsIcon())0<d.length&&b.push(d),b.push([g]),d=[];else for(const k of g.GetCharacterArray())if(IsNewline(k))0<d.length&&
b.push(d),d=C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:["\n"],styles:a}),b.push([d]),d=[];else if(0===d.length)c=C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:[k],styles:a}),d.push(c),c=IsWordBreakWhiteSpace(k);else{var e=IsWordBreakWhiteSpace(k);e===c?(e=d.at(-1),e.GetStyles()===a?e._AppendChar(k):(e=C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:[k],styles:a}),d.push(e))):(b.push(d),d=[],c=C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:[k],styles:a}),d.push(c),c=e)}0<d.length&&
b.push(d);return b}_CopyLine(a){return a.map(b=>b._Clone())}_AddWordToLine(a,b){var d=a.length?a.at(-1):null;let c=0;d&&d.IsText()&&b[0].IsText()&&b[0].GetStyles()===d.GetStyles()&&(d._Append(b[0].GetCharacterArray()),c=1);for(d=b.length;c<d;++c)a.push(b[c]._Clone())}_WrapText(a,b,d,c){let e=[],g=0;var k=0;let l=0,n=0;var p=0;for(const r of a){if(1===r.length&&r[0].IsText()&&1===r[0].GetLength()&&IsNewline(r[0].GetCharacterArray()[0])){0===k&&(k=C3$jscomp$36.New(C3$jscomp$36.TextFragment,{chArr:[" "],
styles:r[0].GetStyles()}),p=b(k),k=p.height,l=p.fontBoundingBoxAscent||0,n=p.fontBoundingBoxDescent||0,p=p.topToAlphabeticDistance||0);this._AddLine(e,g,k,l,n,p);e=[];p=n=l=k=g=0;continue}a=this._CopyLine(e);this._AddWordToLine(a,r);const w=this._MeasureLine(a,b),z=w.width;z>=d?(0<e.length&&this._AddLine(e,g,k,l,n,p),e=[],r[0].IsText()&&C3$jscomp$36.IsCharArrayAllWhitespace(r[0].GetCharacterArray())?p=n=l=k=g=0:(this._AddWordToLine(e,r),p=this._MeasureLine(e,b),g=p.width,k=p.height,l=p.fontBoundingBoxAscent,
n=p.fontBoundingBoxDescent,p=p.topToAlphabeticDistance)):(e=a,g=z,k=w.height,l=w.fontBoundingBoxAscent,n=w.fontBoundingBoxDescent,p=w.topToAlphabeticDistance)}0<e.length&&this._AddLine(e,g,k,l,n,p);this._TrimLinesTrailingWhitespace(b,c)}_TrimLinesTrailingWhitespace(a,b){for(const e of this._lines){const g=e._GetFragmentsArray();if(!g.length)continue;let k=g.at(-1);if(k.IsText()){var d=k.GetCharacterArray(),c=d.slice(0);WordBreakTrimEnd(c);0===c.length?(e.OffsetWidth(-k.GetWidth()),g.pop()):c.length<
d.length&&(k.SetCharacterArray(c),d=a(k).width,c=k.GetWidth()-d,k.SetWidth(d),e.OffsetWidth(-c));0!==b&&0<g.length&&(k=g.at(-1),k.OffsetWidth(b),e.OffsetWidth(b))}}}Clear(){C3$jscomp$36.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce((a,b)=>Math.max(a,b.GetWidth()),0)}GetTotalLineHeight(){return this._lines.reduce((a,b)=>a+b.GetHeight(),0)}};"use strict";
self.C3.WordWrap.Line=class{constructor(a){this._fragments=a.fragments||[];this._width=a.width||-1;this._height=a.height||-1;this._fontBoundingBoxAscent=a.fontBoundingBoxAscent||-1;this._fontBoundingBoxDescent=a.fontBoundingBoxDescent||-1;this._topToAlphabeticDistance=a.topToAlphabeticDistance||-1;this._posY=this._posX=0}fragments(){return this._fragments.values()}*fragmentsReverse(){const a=this._fragments;for(let b=a.length-1;0<=b;--b)yield a[b]}_GetFragmentsArray(){return this._fragments}OffsetWidth(a){this._width+=
a}GetWidth(){return this._width}GetHeight(){return this._height}GetFoundBoundingBoxAscent(){return this._fontBoundingBoxAscent}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(a){this._posX=a}GetPosX(){return this._posX}SetPosY(a){this._posY=a}GetPosY(){return this._posY}};"use strict";
self.C3.FragmentBase=class{constructor(a){this._styles=a.styles||[];this._width=a.width||-1;this._height=a.height||-1;this._fontBoundingBoxAscent=a.fontBoundingBoxAscent||-1;this._fontBoundingBoxDescent=a.fontBoundingBoxDescent||-1;this._topToAlphabeticDistance=a.topToAlphabeticDistance||-1;this._posY=this._posX=0}IsText(){return!1}IsIcon(){return!1}GetStyles(){return this._styles}GetStyleTag(a){const b=this._styles;for(let d=b.length-1;0<=d;--d){const c=b[d];if(c.tag===a)return c}return null}HasStyleTag(a){return!!this.GetStyleTag(a)}GetStyleMap(){const a=
new Map;for(const b of this._styles)a.set(b.tag,b.param);return a}OffsetWidth(a){this._width+=a}SetWidth(a){this._width=a}GetWidth(){return this._width}SetHeight(a){this._height=a}GetHeight(){return this._height}SetFontBoundingBoxAscent(a){this._fontBoundingBoxAscent=a}GetFontBoundingBoxAscent(){return this._fontBoundingBoxAscent}SetFontBoundingBoxDescent(a){this._fontBoundingBoxDescent=a}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}SetTopToAlphabeticDistance(a){this._topToAlphabeticDistance=
a}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(a){this._posX=a}GetPosX(){return this._posX}SetPosY(a){this._posY=a}GetPosY(){return this._posY}};"use strict";const C3$jscomp$39=self.C3;
C3$jscomp$39.TextFragment=class extends C3$jscomp$39.FragmentBase{constructor(a){super(a);this._chArr=a.chArr}IsText(){return!0}_Append(a){C3$jscomp$39.appendArray(this._chArr,a);this._topToAlphabeticDistance=this._fontBoundingBoxDescent=this._fontBoundingBoxAscent=this._height=this._width=-1}_AppendChar(a){this._chArr.push(a)}_Clone(){return C3$jscomp$39.New(C3$jscomp$39.TextFragment,{chArr:this._chArr.slice(0),styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,
fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetCharacterArray(){return this._chArr}SetCharacterArray(a){this._chArr=a}GetLength(){return this._chArr.length}IsEmpty(){return 0===this._chArr.length}HasNewLine(){return this._chArr.includes("\n")}};"use strict";const C3$jscomp$40=self.C3;
C3$jscomp$40.IconFragment=class extends C3$jscomp$40.FragmentBase{constructor(a){super(a);this._icon=a.icon}IsIcon(){return!0}GetIconParameter(){return this._icon}_Clone(){return C3$jscomp$40.New(C3$jscomp$40.IconFragment,{icon:this._icon,styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetTextIcon(a){if(!a)return null;let b=Number(this._icon);
return String(b)===this._icon?(b=Math.floor(b),a.GetTextIconByIndex(b)):a.GetTextIconByTag(this._icon)}CalculateWidthFromHeight(a){this._width=(a=this.GetTextIcon(a))?this._height*a.GetWidth()/a.GetHeight():0}GetDrawable(a){return(a=this.GetTextIcon(a))?a.GetDrawable():null}GetLength(){return 1}};"use strict";const C3$jscomp$41=self.C3;
C3$jscomp$41.TextIconManager=class{constructor(a){this._iconSets=new Map;this._getIconSetMetaCallback=a.getIconSetMeta;this._getIconSetContentCallback=a.getIconSetContent}Release(){for(const a of this._iconSets.values())a.Release();this._iconSets.clear()}GetIconSet(a){var b=this._iconSets.get(a);if(b)return b;b=this._getIconSetMetaCallback(a);b=C3$jscomp$41.New(C3$jscomp$41.TextIconSet,this,{source:a,iconMeta:b});this._iconSets.set(a,b);return b}HasIconSet(a){return this._iconSets.has(a)}DeleteIconSet(a){const b=
this._iconSets.get(a);b&&b.Release();this._iconSets.delete(a)}async _GetIconSetContent(a){return await this._getIconSetContentCallback(a)}};"use strict";const C3$jscomp$42=self.C3;
C3$jscomp$42.TextIconSet=class{constructor(a,b){this._textIconManager=a;this._source=b.source;this._iconsArray=[];this._iconsByTag=new Map;this._isLoading=this._hasStartedLoad=!1;this._loadPromise=null;a=b.iconMeta.icons;for(let d=0,c=a.length;d<c;++d){b=a[d];const e=C3$jscomp$42.New(C3$jscomp$42.TextIcon,this,{index:d,tag:b.tag,source:b.source,width:b.width,height:b.height});this._iconsArray.push(e);b.tag&&this._iconsByTag.set(b.tag.toLowerCase(),e)}}Release(){for(const a of this._iconsArray)a.Release();
C3$jscomp$42.clearArray(this._iconsArray);this._iconsByTag.clear();this._source=this._textIconManager=null}HasLoaded(){return this._hasStartedLoad}IsLoading(){return this._isLoading}LoadContent(){this._loadPromise||(this._loadPromise=this._DoLoadContent());return this._loadPromise}async _DoLoadContent(){if(!this._hasStartedLoad){this._isLoading=this._hasStartedLoad=!0;var a=await this._textIconManager._GetIconSetContent(this._source);if(this._textIconManager){a=a.icons;for(let b=0,d=Math.min(a.length,
this._iconsArray.length);b<d;++b)this._iconsArray[b]._SetDrawable(a[b].drawable);this._isLoading=!1}}}GetTextIconByIndex(a){a=Math.floor(a);return 0>a||a>=this._iconsArray.length?null:this._iconsArray[a]}GetTextIconByTag(a){return this._iconsByTag.get(a.toLowerCase())||null}};"use strict";
self.C3.TextIcon=class{constructor(a,b){this._textIconSet=a;this._source=b.source||null;this._index=b.index;this._tag=b.tag;this._width=b.width;this._height=b.height;this._drawable=null}Release(){this._height=this._width=0;this._textIconSet=null}GetSource(){return this._source}GetWidth(){return this._width}GetHeight(){return this._height}_SetDrawable(a){this._drawable=a}GetDrawable(){return this._drawable}};"use strict";
const C3$jscomp$44=self.C3,glMatrix=self.glMatrix,vec3$jscomp$1=glMatrix.vec3,vec4$jscomp$1=glMatrix.vec4,mat4$jscomp$1=glMatrix.mat4,tempVec3a=vec3$jscomp$1.create(),tempVec3b=vec3$jscomp$1.create(),tempVec3c=vec3$jscomp$1.create(),tempVec4=vec4$jscomp$1.create(),tempMat4=mat4$jscomp$1.create(),neartl=vec3$jscomp$1.create(),neartr=vec3$jscomp$1.create(),nearbl=vec3$jscomp$1.create(),nearbr=vec3$jscomp$1.create(),fartl=vec3$jscomp$1.create(),fartr=vec3$jscomp$1.create(),farbl=vec3$jscomp$1.create(),
farbr=vec3$jscomp$1.create(),unitViewport=vec4$jscomp$1.fromValues(0,0,1,1);
C3$jscomp$44.Gfx={Project(a,b,d,c,e,g,k){const l=c[0]*a+c[4]*b+c[8]*d+c[12],n=c[1]*a+c[5]*b+c[9]*d+c[13],p=c[2]*a+c[6]*b+c[10]*d+c[14];c=c[3]*a+c[7]*b+c[11]*d+c[15];a=e[0]*l+e[4]*n+e[8]*p+e[12]*c;b=e[1]*l+e[5]*n+e[9]*p+e[13]*c;d=e[2]*l+e[6]*n+e[10]*p+e[14]*c;e=e[3]*l+e[7]*n+e[11]*p+e[15]*c;if(0===e)return!1;e=1/e;k[0]=(a*e*.5+.5)*g[2]+g[0];k[1]=(b*e*.5+.5)*g[3]+g[1];k[2]=.5*(1+d*e);return!0},Unproject(a,b,d,c,e,g,k){mat4$jscomp$1.multiply(tempMat4,e,c);if(null===mat4$jscomp$1.invert(tempMat4,tempMat4))return!1;
tempVec4[0]=(a-g[0])/g[2]*2-1;tempVec4[1]=(b-g[1])/g[3]*2-1;tempVec4[2]=2*d-1;tempVec4[3]=1;vec4$jscomp$1.transformMat4(tempVec4,tempVec4,tempMat4);if(0===tempVec4[3])return!1;tempVec4[3]=1/tempVec4[3];k[0]=tempVec4[0]*tempVec4[3];k[1]=tempVec4[1]*tempVec4[3];k[2]=tempVec4[2]*tempVec4[3];return!0},UnprojectScreenToWorldZ(a,b,d,c,e,g,k){if(!C3$jscomp$44.Gfx.Unproject(a,b,0,c,e,g,tempVec3a)||!C3$jscomp$44.Gfx.Unproject(a,b,1,c,e,g,tempVec3b))return!1;vec3$jscomp$1.subtract(tempVec3b,tempVec3b,tempVec3a);
vec3$jscomp$1.set(tempVec3c,0,0,1);a=-d;b=vec3$jscomp$1.dot(tempVec3c,tempVec3b);d=0;if(0===b){if(0!==vec3$jscomp$1.dot(tempVec3c,tempVec3a)+a)return!1}else if(d=-(vec3$jscomp$1.dot(tempVec3a,tempVec3c)+a)/b,0>d)return!1;vec3$jscomp$1.scaleAndAdd(k,tempVec3a,tempVec3b,d);return!0}};
function PlaneFromPoints(a,b,d,c){vec3$jscomp$1.subtract(tempVec3a,d,b);vec3$jscomp$1.subtract(tempVec3b,a,b);vec3$jscomp$1.cross(tempVec3c,tempVec3a,tempVec3b);vec3$jscomp$1.normalize(tempVec3c,tempVec3c);c.set(tempVec3c[0],tempVec3c[1],tempVec3c[2],vec3$jscomp$1.dot(a,tempVec3c))}function IsInFrontOfPlane(a,b,d,c,e,g,k){const l=k.x,n=k.y,p=k.z,r=k.w,w=k.xF,z=k.yF;k=k.zF;const B=1-w,C=1-z,E=1-k;return l*a*w+l*c*B+n*b*z+n*e*C+p*d*k+p*g*E>=r?!0:l*c*w+l*a*B+n*e*z+n*b*C+p*g*k+p*d*E>r}
function IsPointInFrontOfPlane(a,b,d,c){return c.x*a+c.y*b+c.z*d>=c.w}class Plane{constructor(){this.zF=this.yF=this.xF=this.w=this.z=this.y=this.x=NaN}set(a,b,d,c){this.x=a;this.y=b;this.z=d;this.w=c;this.xF=0<a?1:0;this.yF=0<b?1:0;this.zF=0<d?1:0}}
C3$jscomp$44.Gfx.ViewFrustum=class{constructor(){this._leftP=new Plane;this._topP=new Plane;this._rightP=new Plane;this._bottomP=new Plane;this._nearP=new Plane;this._farP=new Plane}CalculatePlanes(a,b){C3$jscomp$44.Gfx.Unproject(0,1,0,a,b,unitViewport,neartl);C3$jscomp$44.Gfx.Unproject(1,1,0,a,b,unitViewport,neartr);C3$jscomp$44.Gfx.Unproject(0,0,0,a,b,unitViewport,nearbl);C3$jscomp$44.Gfx.Unproject(1,0,0,a,b,unitViewport,nearbr);C3$jscomp$44.Gfx.Unproject(0,1,1,a,b,unitViewport,fartl);C3$jscomp$44.Gfx.Unproject(1,
1,1,a,b,unitViewport,fartr);C3$jscomp$44.Gfx.Unproject(0,0,1,a,b,unitViewport,farbl);C3$jscomp$44.Gfx.Unproject(1,0,1,a,b,unitViewport,farbr);PlaneFromPoints(nearbl,neartl,fartl,this._leftP);PlaneFromPoints(neartl,neartr,fartr,this._topP);PlaneFromPoints(neartr,nearbr,farbr,this._rightP);PlaneFromPoints(nearbr,nearbl,farbl,this._bottomP);PlaneFromPoints(farbl,fartl,fartr,this._farP);PlaneFromPoints(nearbr,neartr,neartl,this._nearP)}ContainsAABB(a,b,d,c,e,g){return IsInFrontOfPlane(a,b,d,c,e,g,this._leftP)&&
IsInFrontOfPlane(a,b,d,c,e,g,this._topP)&&IsInFrontOfPlane(a,b,d,c,e,g,this._rightP)&&IsInFrontOfPlane(a,b,d,c,e,g,this._bottomP)&&IsInFrontOfPlane(a,b,d,c,e,g,this._nearP)&&IsInFrontOfPlane(a,b,d,c,e,g,this._farP)}IsBehindNearPlane(a,b,d){return!IsPointInFrontOfPlane(a,b,d,this._nearP)}};"use strict";
const C3$jscomp$45=self.C3,glMatrix$jscomp$1=self.glMatrix,vec3$jscomp$2=glMatrix$jscomp$1.vec3,vec4$jscomp$2=glMatrix$jscomp$1.vec4,mat4$jscomp$2=glMatrix$jscomp$1.mat4,tempMat4$jscomp$1=mat4$jscomp$2.create(),tmpVec3a=vec3$jscomp$2.fromValues(0,0,0),tmpVec3b=vec3$jscomp$2.fromValues(0,0,0),tmpVec3c=vec3$jscomp$2.fromValues(0,0,0),defaultUpVector=vec3$jscomp$2.fromValues(0,1,0);vec4$jscomp$2.fromValues(0,0,0,0);
const tmpQuad=new C3$jscomp$45.Quad,tmpRect=new C3$jscomp$45.Rect,defaultTexCoordsQuad=new C3$jscomp$45.Quad(0,0,1,0,1,1,0,1),DEFAULT_RENDERERBASE_OPTS={nearZ:1,farZ:1E4},matWebGLtoWebGPU=mat4$jscomp$2.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);
C3$jscomp$45.Gfx.RendererBase=class{constructor(a){a=Object.assign({},DEFAULT_RENDERERBASE_OPTS,a);this._height=this._width=0;this._fovY=C3$jscomp$45.toRadians(45);this._tan_fovY_2=Math.tan(this._fovY/2);this._matP=mat4$jscomp$2.create();this._matMV=mat4$jscomp$2.create();this._zAxisScale=!1;this._nearZ=a.nearZ;this._farZ=a.farZ;this._allShaderPrograms=[];this._shaderProgramsByName=new Map;this._spSmoothLineFill=this._spSmoothEllipseOutline=this._spSmoothEllipseFill=this._spHardEllipseOutline=this._spHardEllipseFill=
this._spPenumbraFill=this._spLinearGradientFill=this._spColorFill=this._spTileRandomization=this._spTilemapFill=this._spPoints=this._spTextureFill=null;this._stateGroups=new Map;this._currentStateGroup=null;this._blendModeTable=[];this._namedBlendModeMap=new Map;this._currentZ=this._baseZ=0;this._lineWidth=1;this._lineWidthStack=[this._lineWidth];this._lineCap=1;this._lineCapStack=[this._lineCap];this._lineOffset=.5;this._lineOffsetStack=[this._lineOffset];this._frameNumber=0;this._enableMipmaps=
!0;this._hasMajorPerformanceCaveat=!1}FillIndexBufferData(a){let b=0,d=a.length,c=0;for(;b<d;)a[b++]=c,a[b++]=c+1,a[b++]=c+2,a[b++]=c,a[b++]=c+2,a[b++]=c+3,c+=4}_ClearState(){this._currentZ=this._baseZ=0;this._spSmoothLineFill=this._spSmoothEllipseOutline=this._spSmoothEllipseFill=this._spHardEllipseOutline=this._spHardEllipseFill=this._spPenumbraFill=this._spLinearGradientFill=this._spColorFill=this._spTileRandomization=this._spTilemapFill=this._spPoints=this._spTextureFill=null;this._ClearAllShaderPrograms()}InitState(){this._ClearState();
this._currentStateGroup=null}OnDeviceOrContextLost(){for(const a of this._allShaderPrograms)a.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(a){return this.IsZAxisScaleNormalized()?100:a/(2*this._GetTanFovYDiv2())}GetZAxisScaleFactor(a){return this.IsZAxisScaleNormalized()?a/(2*this._GetTanFovYDiv2())/this.GetDefaultCameraZ(a):1}SetNearZ(a){this._nearZ=a}GetNearZ(){return this._nearZ}SetFarZ(a){this._farZ=a}GetFarZ(){return this._farZ}SetFovY(a){this._fovY=
a;this._tan_fovY_2=Math.tan(this._fovY/2)}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}SetZAxisScaleNormalized(){this._zAxisScale=!1}SetZAxisScaleRegular(){this._zAxisScale=!0}IsZAxisScaleNormalized(){return!this._zAxisScale}IsZAxisScaleRegular(){return this._zAxisScale}CalculatePerspectiveMatrix(a,b,d=.5,c=.5){const e=this.GetNearZ(),g=this.GetFarZ();var k=this.GetFovY();if(.5===d&&.5===c)this.IsWebGPU()?mat4$jscomp$2.perspectiveZO(a,k,b,e,g):mat4$jscomp$2.perspective(a,
k,b,e,g);else{d=1-d;k=2*d-2;d*=2;const l=2*c-2;c*=2;const n=this._GetTanFovYDiv2()*e;b*=n;mat4$jscomp$2.frustum(a,k*b,d*b,l*n,c*n,e,g);this.IsWebGPU()&&mat4$jscomp$2.mul(a,matWebGLtoWebGPU,a)}}CalculateOrthographicMatrix(a,b,d,c=1){var e=self.devicePixelRatio;const g=2*this.GetDefaultCameraZ(d)*e*this._GetTanFovYDiv2()/d;b=b*g/(2*e*c);d=d*g/(2*e*c);c=-b;e=-d;this.IsWebGPU()?mat4$jscomp$2.orthoZO(a,c,b,e,d,this.GetNearZ(),this.GetFarZ()):mat4$jscomp$2.ortho(a,c,b,e,d,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(a,
b,d,c,e,g=1){let k=1;this.IsZAxisScaleNormalized()&&(k=200*this._GetTanFovYDiv2()/e);vec3$jscomp$2.set(tmpVec3c,k,-k,1);vec3$jscomp$2.multiply(tmpVec3a,b,tmpVec3c);vec3$jscomp$2.multiply(tmpVec3b,d,tmpVec3c);mat4$jscomp$2.lookAt(a,tmpVec3a,tmpVec3b,c||defaultUpVector);tmpVec3c[2]=g;mat4$jscomp$2.scale(a,a,tmpVec3c)}CalculateLookAtModelView2(a,b,d,c,e,g,k,l){vec3$jscomp$2.set(tmpVec3a,a,b,d);vec3$jscomp$2.set(tmpVec3b,c,e,g);this.CalculateLookAtModelView(tempMat4$jscomp$1,tmpVec3a,tmpVec3b,defaultUpVector,
k,l);return tempMat4$jscomp$1}_AddShaderProgram(a){this._allShaderPrograms.push(a);this._shaderProgramsByName.set(a.GetName(),a)}_RemoveShaderProgram(a){const b=this._allShaderPrograms.indexOf(a);-1!==b&&this._allShaderPrograms.splice(b,1);this._shaderProgramsByName.delete(a.GetName())}_ClearAllShaderPrograms(){C3$jscomp$45.clearArray(this._allShaderPrograms);this._shaderProgramsByName.clear()}GetShaderProgramByName(a){return this._shaderProgramsByName.get(a)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(a){this._currentStateGroup=
a}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(a,b,d,c){const e=C3$jscomp$45.Gfx.StateGroup.MakeKey(a,b,d,c);let g=this._stateGroups.get(e);g||(g=C3$jscomp$45.New(C3$jscomp$45.Gfx.StateGroup,this,a,b,d,c),this._stateGroups.set(e,g));g.AddRef();return g}ReleaseStateGroup(a){a.DecRef();0===a._GetRefCount()&&(this._currentStateGroup===a&&(this._currentStateGroup=null),this._stateGroups.delete(a.GetKey()),a.Release())}_InitBlendModeData(a){C3$jscomp$45.clearArray(this._blendModeTable);
this._namedBlendModeMap.clear();let b=0;for(const d of a){a=d[0];const c=d[1],e=d[2];this._blendModeTable.push([c,e]);this._namedBlendModeMap.set(a,{number:b,srcBlend:c,destBlend:e});b++}}_GetBlendByIndex(a){return this._blendModeTable[a]}GetSrcBlendByIndex(a){return this._GetBlendByIndex(a)[0]}GetDestBlendByIndex(a){return this._GetBlendByIndex(a)[1]}GetNamedBlend(a){a=this._namedBlendModeMap.get(a);if("undefined"===typeof a)throw Error("invalid blend name");return a}NamedBlendToNumber(a){a=this._namedBlendModeMap.get(a);
if("undefined"===typeof a)throw Error("invalid blend name");return a.number}SetBaseZ(a){this._baseZ=a}GetBaseZ(){return this._baseZ}SetCurrentZ(a){this._currentZ=a;this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(a,b,d,c){var e=C3$jscomp$45.angleTo(a,b,d,c),g=.5*this._lineWidth;const k=Math.sin(e)*g;e=Math.cos(e)*g;g=this._lineCap;2===g?this.LinePreCalc_LineCap2(a,b,0,d,c,0,k,e):1===g?this.LinePreCalc_LineCap1(a,b,0,d,c,0,k,e):this.LinePreCalc_LineCap0(a,b,0,d,c,0,k,e)}Line3D(a,
b,d,c,e,g){var k=C3$jscomp$45.angleTo(a,b,c,e),l=.5*this._lineWidth;const n=Math.sin(k)*l;k=Math.cos(k)*l;l=this._lineCap;2===l?this.LinePreCalc_LineCap2(a,b,d,c,e,g,n,k):1===l?this.LinePreCalc_LineCap1(a,b,d,c,e,g,n,k):this.LinePreCalc_LineCap0(a,b,d,c,e,g,n,k)}LinePreCalc_LineCap2(a,b,d,c,e,g,k,l){var n=this._lineOffset;a=a+n-l;b=b+n-k;c=c+n+l;e=e+n+k;n=2*l;const p=2*k;this.Quad3D2(a+k,b-l,d,c+k,e-l,g,c-k-n,e+l-p,g,a-k+n,b+l+p,d,defaultTexCoordsQuad)}LinePreCalc_LineCap1(a,b,d,c,e,g,k,l){const n=
this._lineOffset;a=a+n-l;b=b+n-k;c=c+n+l;e=e+n+k;this.Quad3D2(a+k,b-l,d,c+k,e-l,g,c-k,e+l,g,a-k,b+l,d,defaultTexCoordsQuad)}LinePreCalc_LineCap0(a,b,d,c,e,g,k,l){const n=this._lineOffset;a+=n;b+=n;c+=n;e+=n;this.Quad3D2(a+k,b-l,d,c+k,e-l,g,c-k,e+l,g,a-k,b+l,d,defaultTexCoordsQuad)}TexturedLine(a,b,d,c,e,g){var k=C3$jscomp$45.angleTo(a,b,d,c),l=.5*this._lineWidth;const n=Math.sin(k)*l;k=Math.cos(k)*l;l=this._lineCap;2===l?this.TexturedLinePreCalc_LineCap2(a,b,d,c,n,k,e,g):1===l?this.TexturedLinePreCalc_LineCap1(a,
b,d,c,n,k,e,g):this.TexturedLinePreCalc_LineCap0(a,b,d,c,n,k,e,g)}TexturedLinePreCalc_LineCap2(a,b,d,c,e,g,k,l){var n=this._lineOffset;a=a+n-g;b=b+n-e;d=d+n+g;c=c+n+e;n=2*g;const p=2*e;tmpQuad.set(a+e,b-g,d+e,c-g,d-e-n,c+g-p,a-e+n,b+g+p);tmpRect.set(k,0,l,0);this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap1(a,b,d,c,e,g,k,l){const n=this._lineOffset;a=a+n-g;b=b+n-e;d=d+n+g;c=c+n+e;tmpQuad.set(a+e,b-g,d+e,c-g,d-e,c+g,a-e,b+g);tmpRect.set(k,0,l,0);this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap0(a,
b,d,c,e,g,k,l){const n=this._lineOffset;a+=n;b+=n;d+=n;c+=n;tmpQuad.set(a+e,b-g,d+e,c-g,d-e,c+g,a-e,b+g);tmpRect.set(k,0,l,0);this.Quad3(tmpQuad,tmpRect)}LineRect(a,b,d,c){const e=.5*this._lineWidth,g=this._lineCap;2===g?this._LineRectPreCalc_LineCap2(a,b,d,c,e):1===g?this._LineRectPreCalc_LineCap1(a,b,d,c,e):this._LineRectPreCalc_LineCap0(a,b,d,c,e)}_LineRectPreCalc_LineCap2(a,b,d,c,e){this.LinePreCalc_LineCap2(a,b,0,d,b,0,0,e);this.LinePreCalc_LineCap2(d,b,0,d,c,0,e,0);this.LinePreCalc_LineCap2(d,
c,0,a,c,0,0,-e);this.LinePreCalc_LineCap2(a,c,0,a,b,0,-e,0)}_LineRectPreCalc_LineCap1(a,b,d,c,e){this.LinePreCalc_LineCap1(a,b,0,d,b,0,0,e);this.LinePreCalc_LineCap1(d,b,0,d,c,0,e,0);this.LinePreCalc_LineCap1(d,c,0,a,c,0,0,-e);this.LinePreCalc_LineCap1(a,c,0,a,b,0,-e,0)}_LineRectPreCalc_LineCap0(a,b,d,c,e){this.LinePreCalc_LineCap0(a,b,0,d,b,0,0,e);this.LinePreCalc_LineCap0(d,b,0,d,c,0,e,0);this.LinePreCalc_LineCap0(d,c,0,a,c,0,0,-e);this.LinePreCalc_LineCap0(a,c,0,a,b,0,-e,0)}LineRect2(a){this.LineRect(a.getLeft(),
a.getTop(),a.getRight(),a.getBottom())}LineQuad(a){var b=C3$jscomp$45.angleTo(a.getTlx(),a.getTly(),a.getTrx(),a.getTry()),d=.5*this._lineWidth;const c=Math.sin(b)*d;b=Math.cos(b)*d;d=this._lineCap;2===d?this._LineQuadPreCalc_LineCap2(a,c,b):1===d?this._LineQuadPreCalc_LineCap1(a,c,b):this._LineQuadPreCalc_LineCap0(a,c,b)}_LineQuadPreCalc_LineCap2(a,b,d){this.LinePreCalc_LineCap2(a.getTlx(),a.getTly(),0,a.getTrx(),a.getTry(),0,b,d);this.LinePreCalc_LineCap2(a.getTrx(),a.getTry(),0,a.getBrx(),a.getBry(),
0,d,-b);this.LinePreCalc_LineCap2(a.getBrx(),a.getBry(),0,a.getBlx(),a.getBly(),0,-b,-d);this.LinePreCalc_LineCap2(a.getBlx(),a.getBly(),0,a.getTlx(),a.getTly(),0,-d,b)}_LineQuadPreCalc_LineCap1(a,b,d){this.LinePreCalc_LineCap1(a.getTlx(),a.getTly(),0,a.getTrx(),a.getTry(),0,b,d);this.LinePreCalc_LineCap1(a.getTrx(),a.getTry(),0,a.getBrx(),a.getBry(),0,d,-b);this.LinePreCalc_LineCap1(a.getBrx(),a.getBry(),0,a.getBlx(),a.getBly(),0,-b,-d);this.LinePreCalc_LineCap1(a.getBlx(),a.getBly(),0,a.getTlx(),
a.getTly(),0,-d,b)}_LineQuadPreCalc_LineCap0(a,b,d){this.LinePreCalc_LineCap0(a.getTlx(),a.getTly(),0,a.getTrx(),a.getTry(),0,b,d);this.LinePreCalc_LineCap0(a.getTrx(),a.getTry(),0,a.getBrx(),a.getBry(),0,d,-b);this.LinePreCalc_LineCap0(a.getBrx(),a.getBry(),0,a.getBlx(),a.getBly(),0,-b,-d);this.LinePreCalc_LineCap0(a.getBlx(),a.getBly(),0,a.getTlx(),a.getTly(),0,-d,b)}SetLineWidth(a){this._lineWidth=a;this._lineWidthStack[this._lineWidthStack.length-1]=a}GetLineWidth(){return this._lineWidth}PushLineWidth(a){if(100<=
this._lineWidthStack.length)throw Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(a);this._lineWidth=a}PopLineWidth(){if(1>=this._lineWidthStack.length)throw Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop();this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0;this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1;this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=
2;this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(a){if("butt"===a)this.PushLineCapButt();else if("square"===a)this.PushLineCapSquare();else if("zag"===a)this.PushLineCapZag();else throw Error("invalid line cap");}PushLineCapButt(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0);this._lineCap=0}PushLineCapSquare(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");
this._lineCapStack.push(1);this._lineCap=1}PushLineCapZag(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2);this._lineCap=2}PopLineCap(){if(1>=this._lineCapStack.length)throw Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop();this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(a){this._lineOffset=a;this._lineOffsetStack[this._lineOffsetStack.length-1]=a}GetLineOffset(){return this._lineOffset}PushLineOffset(a){if(100<=
this._lineOffsetStack.length)throw Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(a);this._lineOffset=a}PopLineOffset(){if(1>=this._lineOffsetStack.length)throw Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop();this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(a){var b=a.length/2;if(3>b)throw Error("need at least 3 points");b-=2;const d=b-1,c=a[0],e=a[1];for(let g=0;g<b;g+=2){const k=2*g,l=a[k+2],n=a[k+3],p=a[k+
4],r=a[k+5];g===d?this.Quad2(c,e,l,n,p,r,p,r):this.Quad2(c,e,l,n,p,r,a[k+6],a[k+7])}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(!0);this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(a){this._enableMipmaps=!!a}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(a){this._hasMajorPerformanceCaveat=!!a}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return!1}IsWebGPU(){return!1}GetEstimatedBackBufferMemoryUsage(){}GetEstimatedRenderBufferMemoryUsage(){}GetEstimatedTextureMemoryUsage(){}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+
this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}CreateRendererText(){return C3$jscomp$45.New(C3$jscomp$45.Gfx.RendererText,this)}};"use strict";
self.C3.Gfx.ShaderProgramBase=class{constructor(a,b){this._name=b.name;this._renderer=a;this._extendBoxHorizontal=b.extendBoxHorizontal||0;this._extendBoxVertical=b.extendBoxVertical||0;this._crossSampling=!!b.crossSampling;this._mustPreDraw=!!b.mustPreDraw;this._preservesOpaqueness=!!b.preservesOpaqueness;this._supports3dDirectRendering=!!b.supports3dDirectRendering;this._animated=!!b.animated;this._blendsBackground=!!b.blendsBackground;this._usesDepth=!!b.usesDepth;this._usesAnySrcRectOrPixelSize=
!1;this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return 0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}Supports3DDirectRendering(){return this._supports3dDirectRendering}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}UsesIsSrcTexRotated(){return!1}};
"use strict";const C3$jscomp$47=self.C3;
C3$jscomp$47.Gfx.StateGroup=class{constructor(a,b,d,c,e){this._renderer=a;this._refCount=0;this._shaderProgram=null;this._shaderProgramName="";this._blendMode=d;this._color=C3$jscomp$47.New(C3$jscomp$47.Color);this._color.set(c);this._zElevation=e;"string"===typeof b?this._shaderProgramName=b:(this._shaderProgram=b,this._shaderProgramName=this._shaderProgram.GetName())}Release(){if(0<this._refCount)throw Error("releasing state group still in use");this._shaderProgram=this._renderer=null;this._shaderProgramName=
""}Apply(){const a=this._renderer;a.SetProgram(this._shaderProgram);a.SetBlendMode(this._blendMode);a.SetColor(this._color);a.SetCurrentZ(this._zElevation);a._SetCurrentStateGroup(this)}GetKey(){return C3$jscomp$47.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=null}OnContextRestored(a){this._shaderProgram=a.GetShaderProgramByName(this._shaderProgramName);
if(!this._shaderProgram)throw Error("failed to restore shader program");}static MakeKey(a,b,d,c){return("string"===typeof a?a:a.GetName())+","+b+","+d.getR()+","+d.getG()+","+d.getB()+","+d.getA()+","+c}};"use strict";const C3$jscomp$48=self.C3,tempQuadTex=C3$jscomp$48.New(C3$jscomp$48.Quad);function interpolateQuad(a,b,d){const c=d.getTlx(),e=d.getTly(),g=d.getTrx()-c,k=d.getTry()-e,l=d.getBlx()-c;d=d.getBly()-e;return[c+g*a+l*b,e+k*a+d*b]}
C3$jscomp$48.Gfx.MeshPoint=class{constructor(a,b,d){this._mesh=a;this._col=b;this._row=d;this._v=this._u=this._zElevation=this._y=this._x=0}_Init(a,b,d,c){this._x=a;this._y=b;this._u=d;this._v=c}GetX(){return this._x}SetX(a){this._x!==a&&(this._x=a,this._mesh._SetPointsChanged())}GetY(){return this._y}SetY(a){this._y!==a&&(this._y=a,this._mesh._SetPointsChanged())}GetZElevation(){return this._zElevation}SetZElevation(a){this._zElevation!==a&&(this._zElevation=Math.max(a,0),this._mesh._SetPointsChanged())}GetU(){return this._u}SetU(a){this._u=
a}GetV(){return this._v}SetV(a){this._v=a}_Interpolate_TexRect(a,b,d){[this._x,this._y]=interpolateQuad(a._x,a._y,b);this._zElevation=a._zElevation;this._u=C3$jscomp$48.lerp(d.getLeft(),d.getRight(),a._u);this._v=C3$jscomp$48.lerp(d.getTop(),d.getBottom(),a._v)}_Interpolate_TexQuad(a,b,d){[this._x,this._y]=interpolateQuad(a._x,a._y,b);this._zElevation=a._zElevation;[this._u,this._v]=interpolateQuad(a._u,a._v,d)}SaveToJson(){return{x:this.GetX(),y:this.GetY(),z:this.GetZElevation(),u:this.GetU(),v:this.GetV()}}LoadFromJson(a){this.SetX(a.x);
this.SetY(a.y);a.hasOwnProperty("z")&&this.SetZElevation(a.z);this.SetU(a.u);this.SetV(a.v)}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}};
C3$jscomp$48.Gfx.Mesh=class{constructor(a,b,d){if(2>a||2>b)throw Error("invalid mesh size");this._hsize=a;this._vsize=b;this._owner=d||null;this._pts=[];this._minY=this._minX=0;this._maxY=this._maxX=1;this._maxZ=0;this._pointsChanged=!1;d=a-1;const c=b-1;for(let e=0;e<b;++e){const g=[];for(let k=0;k<a;++k){const l=C3$jscomp$48.New(C3$jscomp$48.Gfx.MeshPoint,this,k,e),n=k/d,p=e/c;l._Init(n,p,n,p);g.push(l)}this._pts.push(g)}}Release(){C3$jscomp$48.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=
!0}_MaybeComputeBounds(){if(this._pointsChanged){var a=Infinity,b=Infinity,d=-Infinity,c=-Infinity,e=0;for(const g of this._pts)for(const k of g){const l=k.GetX(),n=k.GetY();a=Math.min(a,l);b=Math.min(b,n);d=Math.max(d,l);c=Math.max(c,n);e=Math.max(e,k.GetZElevation())}this._minX=a;this._minY=b;this._maxX=d;this._maxY=c;this._maxZ=e;this._pointsChanged=!1}}GetMinX(){this._MaybeComputeBounds();return this._minX}GetMinY(){this._MaybeComputeBounds();return this._minY}GetMaxX(){this._MaybeComputeBounds();
return this._maxX}GetMaxY(){this._MaybeComputeBounds();return this._maxY}GetMaxZ(){this._MaybeComputeBounds();return this._maxZ}HasAnyZElevation(){return 0<this.GetMaxZ()}GetMeshPointAt(a,b){a=Math.floor(a);b=Math.floor(b);return 0>a||a>=this._hsize||0>b||b>=this._vsize?null:this._pts[b][a]}CalculateTransformedMesh(a,b,d){const c=d instanceof C3$jscomp$48.Rect;if(a.GetHSize()!==this.GetHSize()||a.GetVSize()!==this.GetVSize())throw Error("source mesh wrong size");a=a._pts;const e=this._pts;for(let g=
0,k=e.length;g<k;++g){const l=a[g],n=e[g];for(let p=0,r=n.length;p<r;++p){const w=l[p],z=n[p];c?z._Interpolate_TexRect(w,b,d):z._Interpolate_TexQuad(w,b,d)}}}Draw(a){const b=this._pts;let d=b[0];for(let c=1,e=b.length;c<e;++c){const g=b[c];let k=d[0],l=g[0];for(let n=1,p=g.length;n<p;++n){const r=d[n],w=g[n];tempQuadTex.set(k.GetU(),k.GetV(),r.GetU(),r.GetV(),w.GetU(),w.GetV(),l.GetU(),l.GetV());a.Quad3D2(k.GetX(),k.GetY(),k.GetZElevation(),r.GetX(),r.GetY(),r.GetZElevation(),w.GetX(),w.GetY(),w.GetZElevation(),
l.GetX(),l.GetY(),l.GetZElevation(),tempQuadTex);k=r;l=w}d=g}}Outline(a,b){b||(b=(e,g,k)=>[e,g,k]);const d=this._pts;let c=d[0];for(let e=1,g=d.length;e<g;++e){const k=d[e];let l=c[0],n=k[0];for(let p=1,r=k.length;p<r;++p){const w=c[p],z=k[p],[B,C,E]=b(l.GetX(),l.GetY(),l.GetZElevation()),[F,I,K]=b(w.GetX(),w.GetY(),w.GetZElevation()),[O,V,W]=b(z.GetX(),z.GetY(),z.GetZElevation()),[ca,la,ma]=b(n.GetX(),n.GetY(),n.GetZElevation());a.Line3D(B,C,E,F,I,K);a.Line3D(B,C,E,O,V,W);a.Line3D(B,C,E,ca,la,ma);
p===r-1&&a.Line3D(F,I,K,O,V,W);e===g-1&&a.Line3D(ca,la,ma,O,V,W);l=w;n=z}c=k}}InsertPolyMeshVertices(a){a=a.pointsArr();const b=[],d=this.GetHSize()-1,c=this.GetVSize()-1,e=1/d,g=1/c,k=d-1,l=c-1;let n=a[0],p=a[1],r=C3$jscomp$48.clamp(Math.floor(n*d),0,k),w=C3$jscomp$48.clamp(Math.floor(p*c),0,l),z=0,B=0,C=0;var E=-1;const F=()=>{n=C3$jscomp$48.clamp(C3$jscomp$48.lerp(n,z,C),0,1);p=C3$jscomp$48.clamp(C3$jscomp$48.lerp(p,B,C),0,1);b.push(n,p)};for(let I=0,K=a.length;I<K;I+=2)for(n=a[I],p=a[I+1],b.push(n,
p),r=C3$jscomp$48.clamp(Math.floor(n*d),0,k),w=C3$jscomp$48.clamp(Math.floor(p*c),0,l),E=(I+2)%K,z=a[E],B=a[E+1],E=-1;;){if(1E6<b.length)throw Error("Too many mesh poly points");const O=r*e,V=w*g,W=(r+1)*e,ca=(w+1)*g;C3$jscomp$48.isPointInTriangleInclusive(n,p,O,V,W,V,W,ca);if(0!==E&&(C=C3$jscomp$48.rayIntersectExtended(n,p,z,B,O,V,W,ca,-.001),0<=C&&.99999999>=C)){F();E=0;continue}if(0<w&&2!==E&&(C=C3$jscomp$48.rayIntersectExtended(n,p,z,B,O,V,W,V,.001),0<=C&&.99999999>=C)){F();w--;E=4;continue}if(r<
k&&3!==E&&(C=C3$jscomp$48.rayIntersectExtended(n,p,z,B,W,V,W,ca,.001),0<=C&&.99999999>=C)){F();r++;E=1;continue}if(0<r&&1!==E&&(C=C3$jscomp$48.rayIntersectExtended(n,p,z,B,O,V,O,ca,.001),0<=C&&.99999999>=C)){F();r--;E=3;continue}if(w<l&&4!==E&&(C=C3$jscomp$48.rayIntersectExtended(n,p,z,B,O,ca,W,ca,.001),0<=C&&.99999999>=C)){F();w++;E=2;continue}break}return C3$jscomp$48.New(C3$jscomp$48.CollisionPoly,b)}TransformCollisionPoly(a,b){a=this._TransformPolyPoints(a);this._SimplifyPoly(a);b.setPoints(a)}_TransformPolyPoints(a){const b=
[];a=a.pointsArr();for(let d=0,c=a.length;d<c;d+=2){const [e,g]=this.TransformPoint(a[d],a[d+1]);b.push(e,g)}return b}TransformPoint(a,b){var d=this.GetHSize()-1,c=this.GetVSize()-1,e=1/d,g=1/c;d=C3$jscomp$48.clamp(Math.floor(a*d),0,d-1);const k=C3$jscomp$48.clamp(Math.floor(b*c),0,c-1);c=d*e;const l=k*g,n=(d+1)*e,p=(k+1)*g,r=this.GetMeshPointAt(d,k),w=this.GetMeshPointAt(d+1,k+1),z=C3$jscomp$48.isPointInTriangleInclusive(a,b,c,l,n,l,n,p);e=z?c+e:c;g=z?l:l+g;d=this.GetMeshPointAt(d+(z?1:0),k+(z?0:
1));const [B,C,E]=C3$jscomp$48.triangleCartesianToBarycentric(a,b,c,l,e,g,n,p);return C3$jscomp$48.triangleBarycentricToCartesian3d(B,C,E,r.GetX(),r.GetY(),r.GetZElevation(),d.GetX(),d.GetY(),d.GetZElevation(),w.GetX(),w.GetY(),w.GetZElevation())}_SimplifyPoly(a){const b=[];let d=a[0],c=a[1],e=d-a.at(-2),g=c-a.at(-1);for(let l=0,n=a.length;l<n;l+=2){var k=(l+2)%n;const p=a[k];k=a[k+1];const r=p-d,w=k-c,z=1E-7>Math.abs(w)&&1E-7>Math.abs(g)&&Math.sign(r)===Math.sign(e);(!(1E-7>Math.abs(r)&&1E-7>Math.abs(e)&&
Math.sign(w)===Math.sign(g)||z)&&.001<Math.abs(r/e-w/g)||0==r&&0===w)&&b.push(d,c);d=p;c=k;e=r;g=w}6<=b.length&&b.length<a.length&&C3$jscomp$48.shallowAssignArray(a,b)}SaveToJson(){return{cols:this.GetHSize(),rows:this.GetVSize(),points:this._pts.map(a=>a.map(b=>b.SaveToJson()))}}LoadFromJson(a){const b=this.GetHSize(),d=this.GetVSize();if(a.cols!==b||a.rows!==d)throw Error("mesh data wrong size");a=a.points;for(let c=0;c<d;++c){const e=a[c];for(let g=0;g<b;++g)this.GetMeshPointAt(g,c).LoadFromJson(e[g])}}};
"use strict";const C3$jscomp$49=self.C3,VALID_PIXEL_FORMATS=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]),VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]),VALID_MIPMAP_QUALITIES=new Set(["default","low","high"]),VALID_WRAP_MODES=new Set(["clamp-to-edge","repeat","mirror-repeat"]);
function GetFormatSpecifiers(a,b){let d,c;switch(a){case "rgba8":a=b.RGBA8;c=d=b.RGBA;b=b.UNSIGNED_BYTE;break;case "rgb8":a=b.RGB8;c=d=b.RGB;b=b.UNSIGNED_BYTE;break;case "rgba4":a=b.RGBA4;c=d=b.RGBA;b=b.UNSIGNED_SHORT_4_4_4_4;break;case "rgb5_a1":a=b.RGB5_A1;c=d=b.RGBA;b=b.UNSIGNED_SHORT_5_5_5_1;break;case "rgb565":a=b.RGB565;c=d=b.RGB;b=b.UNSIGNED_SHORT_5_6_5;break;default:throw Error("invalid pixel format");}return{sizedinternalformat:a,internalformat:d,format:c,type:b}}
const CREATEFROM_DEFAULT_OPTIONS={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:!0,mipMapQuality:"default",premultiplyAlpha:!0,isSvg:!1,width:-1,height:-1},UPDATE_DEFAULT_OPTIONS={premultiplyAlpha:!0,flipY:!1},allTextures=new Set;
C3$jscomp$49.Gfx.WebGLRendererTexture=class{constructor(a){this._renderer=a;this._texture=null;this._height=this._width=0;this._isStatic=!0;this._wrapY=this._wrapX="clamp-to-edge";this._sampling="trilinear";this._anisotropy=0;this._pixelFormat="rgba8";this._isMipMapped=!1;this._mipMapQuality="default";this._refCount=0}_CreateStatic(a,b){if(!("undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&
a instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&a instanceof OffscreenCanvas||a instanceof ImageData||a instanceof ArrayBuffer)&&null!==a)throw Error("invalid texture source");b=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,b);if(this._texture)throw Error("already created texture");this._wrapX=b.wrapX;this._wrapY=b.wrapY;this._sampling=b.sampling;this._anisotropy=b.anisotropy;this._pixelFormat=b.pixelFormat;this._isMipMapped=!!b.mipMap&&this._renderer.AreMipmapsEnabled();this._mipMapQuality=
b.mipMapQuality;if(!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw Error("invalid mipmap quality");this._isStatic=!0;if(a instanceof ArrayBuffer||null===a||b.isSvg){if(this._width=b.width,this._height=b.height,a instanceof ArrayBuffer&&
a.byteLength!==this._width*this._height*4)throw Error("ArrayBuffer wrong size");}else this._width=a.width,this._height=a.height;if(0>=this._width||0>=this._height)throw Error("invalid texture data size");if(b.isSvg){var d=C3$jscomp$49.CreateCanvas(this._width,this._height);d.getContext("2d").drawImage(a,0,0,this._width,this._height);a=d}var c=C3$jscomp$49.isPOT(this._width)&&C3$jscomp$49.isPOT(this._height);d=this._renderer.GetMaxTextureSize();if(this._width>d||this._height>d)throw Error("texture data exceeds maximum texture size");
d=this._renderer.GetContext();var e=this._renderer.GetWebGLVersionNumber();this._texture=d.createTexture();d.bindTexture(d.TEXTURE_2D,this._texture);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);b=GetFormatSpecifiers(this._pixelFormat,d);if(this._renderer.SupportsNPOTTextures()||c||!this._IsTiled())2<=e?(d.texStorage2D(d.TEXTURE_2D,this._isMipMapped?Math.floor(Math.log2(Math.max(this._width,this._height))+1):1,b.sizedinternalformat,this._width,
this._height),a instanceof ArrayBuffer?d.texSubImage2D(d.TEXTURE_2D,0,0,0,this._width,this._height,b.format,b.type,new Uint8Array(a)):null!==a&&d.texSubImage2D(d.TEXTURE_2D,0,0,0,b.format,b.type,a)):a instanceof ArrayBuffer?d.texImage2D(d.TEXTURE_2D,0,b.internalformat,this._width,this._height,0,b.format,b.type,new Uint8Array(a)):null===a?d.texImage2D(d.TEXTURE_2D,0,b.internalformat,this._width,this._height,0,b.format,b.type,null):d.texImage2D(d.TEXTURE_2D,0,b.internalformat,b.format,b.type,a);else{if(null===
a)throw Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");a instanceof ArrayBuffer&&(a=new ImageData(new Uint8ClampedArray(a),this._width,this._height));a instanceof ImageData&&(c=C3$jscomp$49.CreateCanvas(this._width,this._height),c.getContext("2d").putImageData(a,0,0),a=c);c=C3$jscomp$49.CreateCanvas(C3$jscomp$49.nextHighestPowerOfTwo(this._width),C3$jscomp$49.nextHighestPowerOfTwo(this._height));e=c.getContext("2d");e.imageSmoothingEnabled="nearest"!==this._sampling;
e.drawImage(a,0,0,this._width,this._height,0,0,c.width,c.height);d.texImage2D(d.TEXTURE_2D,0,b.internalformat,b.format,b.type,c)}null!==a&&this._SetTextureParameters(d);d.bindTexture(d.TEXTURE_2D,null);this._renderer._ResetLastTexture();this._refCount=1;allTextures.add(this)}_CreateDynamic(a,b,d){d=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,d);if(this._texture)throw Error("already created texture");this._wrapX=d.wrapX;this._wrapY=d.wrapY;this._sampling=d.sampling;this._pixelFormat=d.pixelFormat;
this._isMipMapped=!!d.mipMap&&this._renderer.AreMipmapsEnabled();this._mipMapQuality=d.mipMapQuality;if(!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw Error("invalid mipmap quality");this._isStatic=!1;this._width=Math.floor(a);this._height=
Math.floor(b);a=C3$jscomp$49.isPOT(this._width)&&C3$jscomp$49.isPOT(this._height);b=this._renderer.GetMaxTextureSize();if(0>=this._width||0>=this._height)throw Error("invalid texture size");if(this._width>b||this._height>b)throw Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!a)throw Error("non-power-of-two tiled textures not supported");a=this._renderer.GetContext();b=this._renderer.GetWebGLVersionNumber();this._texture=a.createTexture();
a.bindTexture(a.TEXTURE_2D,this._texture);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d.premultiplyAlpha);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);d=GetFormatSpecifiers(this._pixelFormat,a);a.texImage2D(a.TEXTURE_2D,0,2<=b?d.sizedinternalformat:d.internalformat,this._width,this._height,0,d.format,d.type,null);this._SetTextureParameters(a);a.bindTexture(a.TEXTURE_2D,null);this._renderer._ResetLastTexture();this._refCount=1;allTextures.add(this)}_GetMipMapHint(a){if("default"===this._mipMapQuality)return this._isStatic?
a.NICEST:a.FASTEST;if("low"===this._mipMapQuality)return a.FASTEST;if("high"===this._mipMapQuality)return a.NICEST;throw Error("invalid mipmap quality");}_IsTiled(){return"clamp-to-edge"!==this._wrapX||"clamp-to-edge"!==this._wrapY}_GetTextureWrapMode(a,b){if("clamp-to-edge"===b)return a.CLAMP_TO_EDGE;if("repeat"===b)return a.REPEAT;if("mirror-repeat"===b)return a.MIRRORED_REPEAT;throw Error("invalid wrap mode");}_SetTextureParameters(a){var b=C3$jscomp$49.isPOT(this._width)&&C3$jscomp$49.isPOT(this._height);
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,this._GetTextureWrapMode(a,this._wrapX));a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,this._GetTextureWrapMode(a,this._wrapY));"nearest"===this._sampling?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),this._isMipMapped=!1):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),(b||this._renderer.SupportsNPOTTextures())&&this._isMipMapped?(a.hint(a.GENERATE_MIPMAP_HINT,this._GetMipMapHint(a)),
a.generateMipmap(a.TEXTURE_2D),b="trilinear"===this._sampling&&!this._renderer.HasMajorPerformanceCaveat(),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b?a.LINEAR_MIPMAP_LINEAR:a.LINEAR_MIPMAP_NEAREST)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),this._isMipMapped=!1));(b=this._renderer._GetAnisotropicExtension())&&0<this._anisotropy&&"nearest"!==this._sampling&&a.texParameterf(a.TEXTURE_2D,b.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(a,
b){if(!("undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement||"undefined"!==typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&a instanceof OffscreenCanvas||a instanceof ImageData))throw Error("invalid texture source");if(!this._texture||0>=this._refCount)throw Error("texture not created");if(this._isStatic)throw Error("cannot update static texture");
b=Object.assign({},UPDATE_DEFAULT_OPTIONS,b);const d=a.width||a.videoWidth,c=a.height||a.videoHeight;var e=this._renderer.GetWebGLVersionNumber();const g=this._renderer.GetContext();g.bindTexture(g.TEXTURE_2D,this._texture);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!!b.flipY);b=GetFormatSpecifiers(this._pixelFormat,g);e=2<=e?b.sizedinternalformat:b.internalformat;try{if(this._width===d&&this._height===c){const k=C3$jscomp$49.isPOT(this._width)&&
C3$jscomp$49.isPOT(this._height);g.texSubImage2D(g.TEXTURE_2D,0,0,0,b.format,b.type,a);(k||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(g.hint(g.GENERATE_MIPMAP_HINT,this._GetMipMapHint(g)),g.generateMipmap(g.TEXTURE_2D))}else{this._width=d;this._height=c;const k=C3$jscomp$49.isPOT(this._width)&&C3$jscomp$49.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!k)throw Error("non-power-of-two tiled textures not supported");g.texImage2D(g.TEXTURE_2D,0,e,b.format,
b.type,a);(k||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(g.hint(g.GENERATE_MIPMAP_HINT,this._GetMipMapHint(g)),g.generateMipmap(g.TEXTURE_2D))}}catch(k){console.error("Error updating WebGL texture: ",k)}g.bindTexture(g.TEXTURE_2D,null);this._renderer._ResetLastTexture()}_Delete(){if(0<this._refCount)throw Error("texture still has references");if(!this._texture)throw Error("already deleted texture");allTextures.delete(this);this._renderer.GetContext().deleteTexture(this._texture);
this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(0>=this._refCount)throw Error("no more references");this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let a=this._width*this._height;switch(this._pixelFormat){case "rgba8":a*=4;break;case "rgb8":a*=
3;break;case "rgba4":case "rgb5_a1":case "rgb565":a*=2}this._isMipMapped&&(a+=Math.floor(a/3));return a}static OnContextLost(){allTextures.clear()}static allTextures(){return allTextures.values()}};"use strict";
const C3$jscomp$50=self.C3,glMatrix$jscomp$2=self.glMatrix,mat4$jscomp$3=glMatrix$jscomp$2.mat4,VALID_SAMPLINGS$jscomp$1=new Set(["nearest","bilinear","trilinear"]),DEFAULT_RENDERTARGET_OPTIONS={sampling:"trilinear",alpha:!0,depth:!1,isSampled:!0,isDefaultSize:!0,multisampling:0},allRenderTargets=new Set;
C3$jscomp$50.Gfx.WebGLRenderTarget=class{constructor(a){this._renderer=a;this._renderBuffer=this._texture=this._frameBufferNoDepth=this._frameBuffer=null;this._height=this._width=0;this._isDefaultSize=!0;this._sampling="trilinear";this._alpha=!0;this._depth=!1;this._isSampled=!0;this._multisampling=0;this._projectionMatrix=mat4$jscomp$3.create();this._lastFarZ=this._lastNearZ=this._lastFov=0}_Create(a,b,d){d=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,d);const c=this._renderer.GetWebGLVersionNumber();
if(this._texture||this._renderBuffer)throw Error("already created render target");this._sampling=d.sampling;this._alpha=!!d.alpha;this._depth=!!d.depth;this._isSampled=!!d.isSampled;this._isDefaultSize=!!d.isDefaultSize;this._multisampling=d.multisampling;if(!VALID_SAMPLINGS$jscomp$1.has(this._sampling))throw Error("invalid sampling");if(0<this._multisampling&&(2>c||this._isSampled))throw Error("invalid use of multisampling");2>c&&(this._isSampled=!0);this._width=a;this._height=b;if(0>=this._width||
0>=this._height)throw Error("invalid render target size");this._CalculateProjection();a=this._renderer.GetContext();this._frameBuffer=a.createFramebuffer();this._depth&&(this._frameBufferNoDepth=a.createFramebuffer());this._isSampled?(this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:!1}),b=this._texture._GetTexture(),a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,
a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0),this._depth&&(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBufferNoDepth),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0))):(this._renderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this._renderBuffer),b=this._alpha?a.RGBA8:a.RGB8,0<this._multisampling&&((d=a.getInternalformatParameter(a.RENDERBUFFER,b,a.SAMPLES))&&d[0]?(d=d[0],this._multisampling>d&&(this._multisampling=d)):this._multisampling=0),0===this._multisampling?
a.renderbufferStorage(a.RENDERBUFFER,b,this._width,this._height):a.renderbufferStorageMultisample(a.RENDERBUFFER,this._multisampling,b,this._width,this._height),a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,this._renderBuffer),this._depth&&(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBufferNoDepth),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,this._renderBuffer)),a.bindRenderbuffer(a.RENDERBUFFER,
null));b=this._renderer._GetDepthBuffer();this._depth&&b&&(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),this._renderer._CanSampleDepth()?a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,b,0):a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b));a.bindFramebuffer(a.FRAMEBUFFER,null);allRenderTargets.add(this)}_Resize(a,b){if(this._width!==a||this._height!==b)this._width=a,this._height=b,this._CalculateProjection(),a=this._renderer.GetContext(),
a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),this._texture?this._texture._Update(new ImageData(this._width,this._height)):(a.bindRenderbuffer(a.RENDERBUFFER,this._renderBuffer),a.renderbufferStorage(a.RENDERBUFFER,this._alpha?a.RGBA8:a.RGB8,this._width,this._height),a.bindRenderbuffer(a.RENDERBUFFER,null)),b=this._renderer._GetDepthBuffer(),this._depth&&b&&(this._renderer._CanSampleDepth()?a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,b,0):a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)),a.bindFramebuffer(a.FRAMEBUFFER,null)}_Delete(){if(!this._texture&&!this._renderBuffer)throw Error("already deleted render target");allRenderTargets.delete(this);var a=this._renderer.GetContext();this._texture?(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),this._depth&&(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBufferNoDepth),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,
a.TEXTURE_2D,null,0)),this._renderer.DeleteTexture(this._texture),this._texture=null):this._renderBuffer&&(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,null),this._depth&&(a.bindFramebuffer(a.FRAMEBUFFER,this._frameBufferNoDepth),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,null)),a.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null);a.bindFramebuffer(a.FRAMEBUFFER,null);2<=this._renderer.GetWebGLVersionNumber()&&
(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null));a.deleteFramebuffer(this._frameBuffer);this._depth&&a.deleteFramebuffer(this._frameBufferNoDepth);a=this._renderer.GetBatchState();a.currentFramebuffer=null;this._frameBuffer=a.currentFramebufferNoDepth=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height);this._lastFov=this._renderer.GetFovY();this._lastNearZ=this._renderer.GetNearZ();this._lastFarZ=
this._renderer.GetFarZ()}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){this._renderer.GetFovY()===this._lastFov&&this._renderer.GetNearZ()===this._lastNearZ&&this._renderer.GetFarZ()===this._lastFarZ||this._CalculateProjection();return this._projectionMatrix}IsLinearSampling(){return"nearest"!==this._sampling}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){const a=
{sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};this._isDefaultSize||(a.width=this._width,a.height=this._height);return a}IsCompatibleWithOptions(a){a=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,a);return"nearest"!==a.sampling!==this.IsLinearSampling()||!!a.alpha!==this.HasAlpha()||!!a.depth!==this.HasDepthBuffer()||2<=this._renderer.GetWebGLVersionNumber()&&!!a.isSampled!==this.IsSampled()?!1:"number"===typeof a.width||"number"===typeof a.height?!this.IsDefaultSize()&&this.GetWidth()===
Math.floor(a.width)&&this.GetHeight()===Math.floor(a.height):this.IsDefaultSize()}_GetWebGLTexture(){return this._texture?this._texture._GetTexture():null}GetEstimatedMemoryUsage(){return this._texture?this._texture.GetEstimatedMemoryUsage():this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(a,b){a=await a.ReadBackRenderTargetToImageData(b,!0);return await C3$jscomp$50.ImageDataToBlob(a)}static OnContextLost(){allRenderTargets.clear()}static allRenderTargets(){return allRenderTargets.values()}static ResizeAll(a,
b){for(const d of allRenderTargets)d.IsDefaultSize()&&d._Resize(a,b)}};"use strict";const C3$jscomp$51=self.C3,RESERVED_UNIFORM_NAMES=new Set("aPos aTex aPoints matP matMV samplerFront samplerBack samplerDepth destStart destEnd srcStart srcEnd srcOriginStart srcOriginEnd pixelSize seconds devicePixelRatio layerScale layerAngle layoutStart layoutEnd color color2_ pointTexStart pointTexEnd zElevation tileSize tileSpacing outlineThickness zNear zFar".split(" "));
C3$jscomp$51.Gfx.WebGLShaderProgram=class extends C3$jscomp$51.Gfx.ShaderProgramBase{static async Compile(a,b){const d=a.GetContext();var c=b.src;const e=b.vertexSrc,g=b.name;b=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(b,c);d.compileShader(b);c=d.createShader(d.VERTEX_SHADER);d.shaderSource(c,e);d.compileShader(c);const k=d.createProgram();d.attachShader(k,b);d.attachShader(k,c);d.bindAttribLocation(k,0,"aPos");d.bindAttribLocation(k,1,"aTex");d.bindAttribLocation(k,2,"aPoints");d.linkProgram(k);
const l=a._GetParallelShaderCompileExtension();l?await a._WaitForObjectReady(()=>d.getProgramParameter(k,l.COMPLETION_STATUS_KHR)):await C3$jscomp$51.Wait(5);if(!d.getShaderParameter(b,d.COMPILE_STATUS))throw a=d.getShaderInfoLog(b),d.deleteShader(b),d.deleteShader(c),d.deleteProgram(k),Error("Error compiling fragment shader: "+a);if(!d.getShaderParameter(c,d.COMPILE_STATUS))throw a=d.getShaderInfoLog(c),d.deleteShader(b),d.deleteShader(c),d.deleteProgram(k),Error("Error compiling vertex shader: "+
a);if(!d.getProgramParameter(k,d.LINK_STATUS))throw a=d.getProgramInfoLog(k),d.deleteShader(b),d.deleteShader(c),d.deleteProgram(k),Error("Error linking shader program: "+a);(a=C3$jscomp$51.FilterUnprintableChars(d.getProgramInfoLog(k)||"").trim())&&!C3$jscomp$51.IsStringAllWhitespace(a)&&console.info(`[WebGL] Shader program '${g}' compilation log: `,a);d.deleteShader(b);d.deleteShader(c);return k}static async Create(a,b){const d=await C3$jscomp$51.Gfx.WebGLShaderProgram.Compile(a,b);return new C3$jscomp$51.Gfx.WebGLShaderProgram(a,
d,b)}constructor(a,b,d){super(a,d);const c=a.GetContext();var e=a.GetBatchState();a.EndBatch();c.useProgram(b);this._gl=c;this._shaderProgram=b;this._isDeviceTransform="<default-device-transform>"===d.name;const g=c.getAttribLocation(b,"aPos"),k=c.getAttribLocation(b,"aTex");this._locAPoints=c.getAttribLocation(b,"aPoints");-1!==g&&(c.bindBuffer(c.ARRAY_BUFFER,a._vertexBuffer),c.vertexAttribPointer(g,a.GetNumVertexComponents(),c.FLOAT,!1,0,0),c.enableVertexAttribArray(g));-1!==k&&(c.bindBuffer(c.ARRAY_BUFFER,
a._texcoordBuffer),c.vertexAttribPointer(k,2,c.FLOAT,!1,0,0),c.enableVertexAttribArray(k));-1!==this._locAPoints&&(c.bindBuffer(c.ARRAY_BUFFER,a._pointBuffer),c.vertexAttribPointer(this._locAPoints,4,c.FLOAT,!1,0,0),c.enableVertexAttribArray(this._locAPoints));c.bindBuffer(c.ARRAY_BUFFER,null);this._uMatP=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"matP","mat4");this._uMatMV=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"matMV","mat4");this._uColor=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"color",
"vec4");this._uSamplerFront=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"samplerFront","sampler");this._uPointTexStart=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2");this._uPointTexEnd=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2");this._uZElevation=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"zElevation","float");this._uTileSize=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"tileSize","vec2");this._uTileSpacing=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,
"tileSpacing","vec2");this._uColor2=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"color2_","vec4");this._uOutlineThickness=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"outlineThickness","float");this._uSamplerBack=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"samplerBack","sampler");this._uSamplerDepth=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler");this._uDestStart=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"destStart","vec2");this._uDestEnd=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,
"destEnd","vec2");this._uSrcStart=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"srcStart","vec2");this._uSrcEnd=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"srcEnd","vec2");this._uSrcOriginStart=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"srcOriginStart","vec2");this._uSrcOriginEnd=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2");this._uPixelSize=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"pixelSize","vec2");this._uSeconds=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"seconds",
"float");this._uDevicePixelRatio=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float");this._uLayerScale=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"layerScale","float");this._uLayerAngle=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"layerAngle","float");this._uLayoutStart=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"layoutStart","vec2");this._uLayoutEnd=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2");this._uZNear=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,
"zNear","float");this._uZFar=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,"zFar","float");this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed());
b=d.parameters||[];this._uCustomParameters=[];this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed();this._hasCurrentMatMV=this._hasCurrentMatP=!1;this._uColor.Init4f(1,1,1,1);this._uColor2.Init4f(1,1,1,1);this._uSamplerFront.Init1i(0);this._uSamplerBack.Init1i(1);this._uSamplerDepth.Init1i(2);this._uPointTexStart.Init2f(0,0);this._uPointTexEnd.Init2f(1,1);this._uZElevation.Init1f(0);
this._uTileSize.Init2f(0,0);this._uTileSpacing.Init2f(0,0);this._uDestStart.Init2f(0,0);this._uDestEnd.Init2f(1,1);this._uSrcStart.Init2f(0,0);this._uSrcEnd.Init2f(0,0);this._uSrcOriginStart.Init2f(0,0);this._uSrcOriginEnd.Init2f(0,0);this._uPixelSize.Init2f(0,0);this._uDevicePixelRatio.Init1f(1);this._uZNear.Init1f(a.GetNearZ());this._uZFar.Init1f(a.GetFarZ());this._uLayerScale.Init1f(1);this._uLayerAngle.Init1f(0);this._uSeconds.Init1f(0);this._uLayoutStart.Init2f(0,0);this._uLayoutEnd.Init2f(0,
0);this._uOutlineThickness.Init1f(1);for(const l of b)a=l[2],b=new C3$jscomp$51.Gfx.WebGLShaderUniform(this,l[0],a),"color"===a?b.Init3f(0,0,0):b.Init1f(0),this._uCustomParameters.push(b);this._isDeviceTransform?this._UpdateDeviceTransformUniforms(e.currentMatP):(this.UpdateMatP(e.currentMatP,!0),this.UpdateMatMV(e.currentMV,!0));e=e.currentShader;c.useProgram(e?e._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram);this._shaderProgram=null;this._renderer._RemoveShaderProgram(this);
this._gl=null;super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(a){return 0>a||a>=this._uCustomParameters.length?null:this._uCustomParameters[a].GetType()}AreCustomParametersAlreadySetInBatch(a){for(let b=0,d=a.length;b<d;++b)if(!this._uCustomParameters[b].IsSetToCustomInBatch(a[b]))return!1;return!0}SetCustomParametersInBatch(a){for(let b=0,d=a.length;b<d;++b)this._uCustomParameters[b].SetBatchValueCustom(a[b])}AreOptionalUniformsAlreadySetInBatch(a,
b,d,c,e,g,k,l,n,p){return this._uSamplerBack.IsUsed()||this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(e,g)||this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(a.getLeft(),a.getTop())||this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(a.getRight(),a.getBottom())||this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(k)||this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(l)||this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(n)||
this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(b.getLeft(),b.getTop())||this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(b.getRight(),b.getBottom())||this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(d.getLeft(),d.getTop())||this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(d.getRight(),d.getBottom())||this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(c.getLeft(),c.getTop())||this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(c.getTop(),
c.getBottom())||this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(p)?!1:!0}SetOptionalUniformsInBatch(a,b,d,c,e,g,k,l,n,p){this._uSamplerBack.IsUsed()||(this._uPixelSize.IsUsed()&&this._uPixelSize.SetBatch2(e,g),this._uDestStart.IsUsed()&&this._uDestStart.SetBatch2(a.getLeft(),a.getTop()),this._uDestEnd.IsUsed()&&this._uDestEnd.SetBatch2(a.getRight(),a.getBottom()),this._uDevicePixelRatio.IsUsed()&&this._uDevicePixelRatio.SetBatch1(k),this._uLayerScale.IsUsed()&&this._uLayerScale.SetBatch1(l),
this._uLayerAngle.IsUsed()&&this._uLayerAngle.SetBatch1(n),this._uSrcStart.IsUsed()&&this._uSrcStart.SetBatch2(b.getLeft(),b.getTop()),this._uSrcEnd.IsUsed()&&this._uSrcEnd.SetBatch2(b.getRight(),b.getBottom()),this._uSrcOriginStart.IsUsed()&&this._uSrcOriginStart.SetBatch2(d.getLeft(),d.getTop()),this._uSrcOriginEnd.IsUsed()&&this._uSrcOriginEnd.SetBatch2(d.getRight(),d.getBottom()),this._uLayoutStart.IsUsed()&&this._uLayoutStart.SetBatch2(c.getLeft(),c.getTop()),this._uLayoutEnd.IsUsed()&&this._uLayoutEnd.SetBatch2(c.getTop(),
c.getBottom()),this._uSeconds.IsUsed()&&this._uSeconds.SetBatch1(p))}UpdateMatP(a,b){this._hasCurrentMatP&&!b||this._isDeviceTransform||(this._uMatP.IsUsed()&&this._uMatP.UpdateMatrix4fv(a),this._hasCurrentMatP=!0)}SetMatPStale(){this._hasCurrentMatP=!1}UpdateMatMV(a,b){this._hasCurrentMatMV&&!b||this._isDeviceTransform||(this._uMatMV.IsUsed()&&this._uMatMV.UpdateMatrix4fv(a),this._hasCurrentMatMV=!0)}SetMatMVStale(){this._hasCurrentMatMV=!1}_UpdateDeviceTransformUniforms(a){if(!this._isDeviceTransform)throw Error("not device transform shader");
this._uMatP.UpdateMatrix4fv(a);a=this._renderer;const b=a.GetWidth()/2,d=a.GetHeight()/2;a=a.CalculateLookAtModelView2(b,d,a.GetDefaultCameraZ(a.GetHeight()),b,d,0,a.GetHeight());this._uMatMV.UpdateMatrix4fv(a)}UpdateColor(a){this._uColor.IsUsed()&&this._uColor.Update4f(a[0],a[1],a[2],a[3])}static GetReservedUniformNames(){return RESERVED_UNIFORM_NAMES}static GetDefaultVertexShaderSource(a){a=a?"highmedp":"mediump";return["#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nattribute highp vec3 aPos;",
`attribute ${a} vec2 aTex;`,`varying ${a} vec2 vTex;`,"uniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos, 1.0);\n\tvTex = aTex;\n}"].join("\n")}static GetDefaultVertexShaderSource_WebGL2(a){a=a?"highp":"mediump";return["#version 300 es\nin highp vec3 aPos;",`in ${a} vec2 aTex;`,`out ${a} vec2 vTex;`,"uniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos, 1.0);\n\tvTex = aTex;\n}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex) * color;\n}"}static GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return"#extension GL_EXT_frag_depth : enable\nvarying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex) * color;\n\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTextureFillFragmentShaderSource_WebGL2(){return"#version 300 es\nin mediump vec2 vTex;\nout lowp vec4 outColor;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\toutColor = texture(samplerFront, vTex) * color;\n\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying highmedp vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highmedp vec2 srcStart;\nuniform highmedp vec2 pixelSize;\nuniform highmedp vec2 tileSize;\nuniform highmedp vec2 tileSpacing;\nvoid main(void) {\n\thighmedp vec2 tile = floor(vTex);\n\thighmedp vec2 tex = fract(vTex);\n\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n}"}static GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return"#extension GL_EXT_frag_depth : enable\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying highmedp vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highmedp vec2 srcStart;\nuniform highmedp vec2 pixelSize;\nuniform highmedp vec2 tileSize;\nuniform highmedp vec2 tileSpacing;\nvoid main(void) {\n\thighmedp vec2 tile = floor(vTex);\n\thighmedp vec2 tex = fract(vTex);\n\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTilemapFragmentShaderSource_WebGL2(){return"#version 300 es\nin highp vec2 vTex;\nout lowp vec4 outColor;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highp vec2 srcStart;\nuniform highp vec2 pixelSize;\nuniform highp vec2 tileSize;\nuniform highp vec2 tileSpacing;\nvoid main(void) {\n\thighp vec2 tile = floor(vTex);\n\thighp vec2 tex = fract(vTex);\n\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetTileRandomizationFragmentShaderSource(a,
b,d){let c="";2<=a?c="#version 300 es\n":(b&&(c="#extension GL_EXT_frag_depth : enable\n"),d&&(c+="#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n"));return c+`
=======
// ../3rdparty/glmatrix.js
{
/*
 @fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.4.1

Copyright (c) 2015-2021, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
'use strict';(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):(global=typeof globalThis!=="undefined"?globalThis:global||self,factory(global.glMatrix={}))})(this,function(exports){var EPSILON=1E-6;var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;var RANDOM=Math.random;var ANGLE_ORDER="zyx";function setMatrixArrayType(type){ARRAY_TYPE=type}var degree=Math.PI/180;function toRadian(a){return a*
degree}function equals$9(a,b){return Math.abs(a-b)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}if(!Math.hypot)Math.hypot=function(){var y=0,i=arguments.length;while(i--)y+=arguments[i]*arguments[i];return Math.sqrt(y)};var common=Object.freeze({__proto__:null,EPSILON:EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM:RANDOM,ANGLE_ORDER:ANGLE_ORDER,setMatrixArrayType:setMatrixArrayType,toRadian:toRadian,equals:equals$9});function create$8(){var out=new ARRAY_TYPE(4);if(ARRAY_TYPE!=Float32Array){out[1]=
0;out[2]=0}out[0]=1;out[3]=1;return out}function clone$8(a){var out=new ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function copy$8(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function identity$5(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out}function fromValues$8(m00,m01,m10,m11){var out=new ARRAY_TYPE(4);out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out}function set$8(out,m00,m01,m10,m11){out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out}
function transpose$2(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out}function invert$5(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var det=a0*a3-a2*a1;if(!det)return null;det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out}function adjoint$2(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out}function determinant$3(a){return a[0]*a[3]-a[2]*a[1]}function multiply$8(out,a,b){var a0=
a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out}function rotate$4(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var s=Math.sin(rad);var c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out}function scale$8(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out}function fromRotation$4(out,
rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;return out}function fromScaling$3(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];return out}function str$8(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}function frob$3(a){return Math.hypot(a[0],a[1],a[2],a[3])}function LDU(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]}function add$8(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out}function subtract$6(out,
a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out}function exactEquals$8(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals$8(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),
Math.abs(b3))}function multiplyScalar$3(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out}function multiplyScalarAndAdd$3(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out}var mul$8=multiply$8;var sub$6=subtract$6;var mat2=Object.freeze({__proto__:null,create:create$8,clone:clone$8,copy:copy$8,identity:identity$5,fromValues:fromValues$8,set:set$8,transpose:transpose$2,invert:invert$5,adjoint:adjoint$2,determinant:determinant$3,
multiply:multiply$8,rotate:rotate$4,scale:scale$8,fromRotation:fromRotation$4,fromScaling:fromScaling$3,str:str$8,frob:frob$3,LDU:LDU,add:add$8,subtract:subtract$6,exactEquals:exactEquals$8,equals:equals$8,multiplyScalar:multiplyScalar$3,multiplyScalarAndAdd:multiplyScalarAndAdd$3,mul:mul$8,sub:sub$6});function create$7(){var out=new ARRAY_TYPE(6);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[4]=0;out[5]=0}out[0]=1;out[3]=1;return out}function clone$7(a){var out=new ARRAY_TYPE(6);out[0]=a[0];
out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out}function copy$7(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out}function identity$4(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out}function fromValues$7(a,b,c,d,tx,ty){var out=new ARRAY_TYPE(6);out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out}function set$7(out,a,b,c,d,tx,ty){out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out}function invert$4(out,
a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3];var atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det)return null;det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out}function determinant$2(a){return a[0]*a[3]-a[1]*a[2]}function multiply$7(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=
a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out}function rotate$3(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var s=Math.sin(rad);var c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out}function scale$7(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out}function translate$3(out,a,v){var a0=a[0],a1=a[1],
a2=a[2],a3=a[3],a4=a[4],a5=a[5];var v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out}function fromRotation$3(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;out[4]=0;out[5]=0;return out}function fromScaling$2(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];out[4]=0;out[5]=0;return out}function fromTranslation$3(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=v[0];out[5]=v[1];return out}function str$7(a){return"mat2d("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"}function frob$2(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)}function add$7(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];return out}function subtract$5(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];return out}function multiplyScalar$2(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=
a[4]*b;out[5]=a[5]*b;return out}function multiplyScalarAndAdd$2(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;return out}function exactEquals$7(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]}function equals$7(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=EPSILON*Math.max(1,
Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))}var mul$7=multiply$7;var sub$5=subtract$5;var mat2d=Object.freeze({__proto__:null,create:create$7,clone:clone$7,copy:copy$7,identity:identity$4,fromValues:fromValues$7,
set:set$7,invert:invert$4,determinant:determinant$2,multiply:multiply$7,rotate:rotate$3,scale:scale$7,translate:translate$3,fromRotation:fromRotation$3,fromScaling:fromScaling$2,fromTranslation:fromTranslation$3,str:str$7,frob:frob$2,add:add$7,subtract:subtract$5,multiplyScalar:multiplyScalar$2,multiplyScalarAndAdd:multiplyScalarAndAdd$2,exactEquals:exactEquals$7,equals:equals$7,mul:mul$7,sub:sub$5});function create$6(){var out=new ARRAY_TYPE(9);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[3]=
0;out[5]=0;out[6]=0;out[7]=0}out[0]=1;out[4]=1;out[8]=1;return out}function fromMat4$1(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out}function clone$6(a){var out=new ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out}function copy$6(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=
a[8];return out}function fromValues$6(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new ARRAY_TYPE(9);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out}function set$6(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out}function identity$3(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function transpose$1(out,
a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out}function invert$3(out,a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];var b01=a22*a11-a12*a21;var b11=-a22*a10+a12*a20;var b21=a21*a10-a11*a20;var det=a00*b01+a01*b11+a02*b21;if(!det)return null;det=1/det;out[0]=b01*
det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out}function adjoint$1(out,a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;
out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out}function determinant$1(a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)}function multiply$6(out,a,b){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];var b00=b[0],b01=b[1],b02=b[2];var b10=b[3],b11=b[4],b12=b[5];var b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=
b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out}function translate$2(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*
a02+y*a12+a22;return out}function rotate$2(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out}function scale$6(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out}
function fromTranslation$2(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=v[0];out[7]=v[1];out[8]=1;return out}function fromRotation$2(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function fromScaling$1(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=v[1];out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function fromMat2d(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];
out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out}function fromQuat$1(out,q){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out}function normalFromMat4(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=
a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)return null;det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*
b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out}function projection(out,width,height){out[0]=2/width;out[1]=0;out[2]=0;out[3]=0;out[4]=-2/height;out[5]=0;out[6]=-1;out[7]=1;out[8]=1;return out}function str$6(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+
a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"}function frob$1(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function add$6(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];return out}function subtract$4(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=
a[8]-b[8];return out}function multiplyScalar$1(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;return out}function multiplyScalarAndAdd$1(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;return out}function exactEquals$6(a,b){return a[0]===b[0]&&
a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]}function equals$6(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*
Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))}var mul$6=multiply$6;var sub$4=subtract$4;var mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:clone$6,copy:copy$6,
fromValues:fromValues$6,set:set$6,identity:identity$3,transpose:transpose$1,invert:invert$3,adjoint:adjoint$1,determinant:determinant$1,multiply:multiply$6,translate:translate$2,rotate:rotate$2,scale:scale$6,fromTranslation:fromTranslation$2,fromRotation:fromRotation$2,fromScaling:fromScaling$1,fromMat2d:fromMat2d,fromQuat:fromQuat$1,normalFromMat4:normalFromMat4,projection:projection,str:str$6,frob:frob$1,add:add$6,subtract:subtract$4,multiplyScalar:multiplyScalar$1,multiplyScalarAndAdd:multiplyScalarAndAdd$1,
exactEquals:exactEquals$6,equals:equals$6,mul:mul$6,sub:sub$4});function create$5(){var out=new ARRAY_TYPE(16);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=0;out[12]=0;out[13]=0;out[14]=0}out[0]=1;out[5]=1;out[10]=1;out[15]=1;return out}function clone$5(a){var out=new ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=
a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function copy$5(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function fromValues$5(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new ARRAY_TYPE(16);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=
m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out}function set$5(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out}function identity$2(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=
0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3];var a12=a[6],a13=a[7];var a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=
a[15]}return out}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=
b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)return null;det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-
a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}function adjoint(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=
a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;out[0]=a11*b11-a12*b10+a13*b09;out[1]=a02*b10-a01*b11-a03*b09;out[2]=a31*b05-a32*b04+a33*b03;out[3]=a22*b04-a21*b05-a23*b03;out[4]=a12*b08-a10*b11-a13*b07;out[5]=a00*b11-a02*b08+a03*b07;out[6]=a32*b02-a30*b05-a33*b01;out[7]=a20*b05-a22*b02+a23*b01;out[8]=a10*b10-a11*b08+a13*b06;out[9]=a01*b08-a00*b10-a03*b06;out[10]=a30*b04-a31*b02+a33*b00;
out[11]=a21*b02-a20*b04-a23*b00;out[12]=a11*b07-a10*b09-a12*b06;out[13]=a00*b09-a01*b07+a02*b06;out[14]=a31*b01-a30*b03-a32*b00;out[15]=a20*b03-a21*b01+a22*b00;return out}function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=a00*a11-a01*a10;var b1=a00*a12-a02*a10;var b2=a01*a12-a02*a11;var b3=a20*a31-a21*a30;var b4=a20*a32-a22*a30;var b5=a21*a32-a22*a31;var b6=
a00*b5-a01*b4+a02*b3;var b7=a10*b5-a11*b4+a12*b3;var b8=a20*b2-a21*b1+a22*b0;var b9=a30*b2-a31*b1+a32*b0;return a13*b6-a03*b7+a33*b8-a23*b9}function multiply$5(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+
b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=
b0*a03+b1*a13+b2*a23+b3*a33;return out}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2];var a00,a01,a02,a03;var a10,a11,a12,a13;var a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=
a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}function scale$5(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function rotate$1(out,
a,rad,axis){var x=axis[0],y=axis[1],z=axis[2];var len=Math.hypot(x,y,z);var s,c,t;var a00,a01,a02,a03;var a10,a11,a12,a13;var a20,a21,a22,a23;var b00,b01,b02;var b10,b11,b12;var b20,b21,b22;if(len<EPSILON)return null;len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*
s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out}function rotateX$3(out,a,rad){var s=
Math.sin(rad);var c=Math.cos(rad);var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out}function rotateY$3(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];
var a01=a[1];var a02=a[2];var a03=a[3];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out}function rotateZ$3(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=
a[4];var a11=a[5];var a12=a[6];var a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out}function fromTranslation$1(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=
v[2];out[15]=1;return out}function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromRotation$1(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2];var len=Math.hypot(x,y,z);var s,c,t;if(len<EPSILON)return null;len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*
s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromXRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=c;out[6]=s;out[7]=0;out[8]=0;out[9]=-s;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromYRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=0;out[2]=-s;out[3]=0;out[4]=
0;out[5]=1;out[6]=0;out[7]=0;out[8]=s;out[9]=0;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromZRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=0;out[4]=-s;out[5]=c;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromRotationTranslation$1(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=
y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}function fromQuat2(out,a){var translation=new ARRAY_TYPE(3);var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7];var magnitude=bx*bx+by*by+bz*bz+bw*bw;if(magnitude>0){translation[0]=(ax*bw+aw*bx+ay*bz-
az*by)*2/magnitude;translation[1]=(ay*bw+aw*by+az*bx-ax*bz)*2/magnitude;translation[2]=(az*bw+aw*bz+ax*by-ay*bx)*2/magnitude}else{translation[0]=(ax*bw+aw*bx+ay*bz-az*by)*2;translation[1]=(ay*bw+aw*by+az*bx-ax*bz)*2;translation[2]=(az*bw+aw*bz+ax*by-ay*bx)*2}fromRotationTranslation$1(out,a,translation);return out}function getTranslation$1(out,mat){out[0]=mat[12];out[1]=mat[13];out[2]=mat[14];return out}function getScaling(out,mat){var m11=mat[0];var m12=mat[1];var m13=mat[2];var m21=mat[4];var m22=
mat[5];var m23=mat[6];var m31=mat[8];var m32=mat[9];var m33=mat[10];out[0]=Math.hypot(m11,m12,m13);out[1]=Math.hypot(m21,m22,m23);out[2]=Math.hypot(m31,m32,m33);return out}function getRotation(out,mat){var scaling=new ARRAY_TYPE(3);getScaling(scaling,mat);var is1=1/scaling[0];var is2=1/scaling[1];var is3=1/scaling[2];var sm11=mat[0]*is1;var sm12=mat[1]*is2;var sm13=mat[2]*is3;var sm21=mat[4]*is1;var sm22=mat[5]*is2;var sm23=mat[6]*is3;var sm31=mat[8]*is1;var sm32=mat[9]*is2;var sm33=mat[10]*is3;var trace=
sm11+sm22+sm33;var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out[3]=.25*S;out[0]=(sm23-sm32)/S;out[1]=(sm31-sm13)/S;out[2]=(sm12-sm21)/S}else if(sm11>sm22&&sm11>sm33){S=Math.sqrt(1+sm11-sm22-sm33)*2;out[3]=(sm23-sm32)/S;out[0]=.25*S;out[1]=(sm12+sm21)/S;out[2]=(sm31+sm13)/S}else if(sm22>sm33){S=Math.sqrt(1+sm22-sm11-sm33)*2;out[3]=(sm31-sm13)/S;out[0]=(sm12+sm21)/S;out[1]=.25*S;out[2]=(sm23+sm32)/S}else{S=Math.sqrt(1+sm33-sm11-sm22)*2;out[3]=(sm12-sm21)/S;out[0]=(sm31+sm13)/S;out[1]=(sm23+sm32)/S;out[2]=
.25*S}return out}function decompose(out_r,out_t,out_s,mat){out_t[0]=mat[12];out_t[1]=mat[13];out_t[2]=mat[14];var m11=mat[0];var m12=mat[1];var m13=mat[2];var m21=mat[4];var m22=mat[5];var m23=mat[6];var m31=mat[8];var m32=mat[9];var m33=mat[10];out_s[0]=Math.hypot(m11,m12,m13);out_s[1]=Math.hypot(m21,m22,m23);out_s[2]=Math.hypot(m31,m32,m33);var is1=1/out_s[0];var is2=1/out_s[1];var is3=1/out_s[2];var sm11=m11*is1;var sm12=m12*is2;var sm13=m13*is3;var sm21=m21*is1;var sm22=m22*is2;var sm23=m23*is3;
var sm31=m31*is1;var sm32=m32*is2;var sm33=m33*is3;var trace=sm11+sm22+sm33;var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out_r[3]=.25*S;out_r[0]=(sm23-sm32)/S;out_r[1]=(sm31-sm13)/S;out_r[2]=(sm12-sm21)/S}else if(sm11>sm22&&sm11>sm33){S=Math.sqrt(1+sm11-sm22-sm33)*2;out_r[3]=(sm23-sm32)/S;out_r[0]=.25*S;out_r[1]=(sm12+sm21)/S;out_r[2]=(sm31+sm13)/S}else if(sm22>sm33){S=Math.sqrt(1+sm22-sm11-sm33)*2;out_r[3]=(sm31-sm13)/S;out_r[0]=(sm12+sm21)/S;out_r[1]=.25*S;out_r[2]=(sm23+sm32)/S}else{S=Math.sqrt(1+
sm33-sm11-sm22)*2;out_r[3]=(sm12-sm21)/S;out_r[0]=(sm31+sm13)/S;out_r[1]=(sm23+sm32)/S;out_r[2]=.25*S}return out_r}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s[0];var sy=s[1];var sz=s[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=
0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}function fromRotationTranslationScaleOrigin(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s[0];var sy=s[1];var sz=s[2];var ox=o[0];var oy=o[1];var oz=o[2];var out0=(1-(yy+zz))*sx;var out1=(xy+wz)*sx;var out2=(xz-wy)*sx;var out4=
(xy-wz)*sy;var out5=(1-(xx+zz))*sy;var out6=(yz+wx)*sy;var out8=(xz+wy)*sz;var out9=(yz-wx)*sz;var out10=(1-(xx+yy))*sz;out[0]=out0;out[1]=out1;out[2]=out2;out[3]=0;out[4]=out4;out[5]=out5;out[6]=out6;out[7]=0;out[8]=out8;out[9]=out9;out[10]=out10;out[11]=0;out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz);out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz);out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz);out[15]=1;return out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=
x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function frustum(out,left,right,bottom,top,near,far){var rl=1/(right-left);var tb=1/(top-bottom);var nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=
0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out}function perspectiveNO(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=-1;out[12]=0;out[13]=0;out[15]=0;if(far!=null&&far!==Infinity){var nf=1/(near-far);out[10]=(far+near)*nf;out[14]=2*far*near*nf}else{out[10]=-1;out[14]=-2*near}return out}var perspective=
perspectiveNO;function perspectiveZO(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=-1;out[12]=0;out[13]=0;out[15]=0;if(far!=null&&far!==Infinity){var nf=1/(near-far);out[10]=far*nf;out[14]=far*near*nf}else{out[10]=-1;out[14]=-near}return out}function perspectiveFromFieldOfView(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180);var downTan=Math.tan(fov.downDegrees*Math.PI/180);
var leftTan=Math.tan(fov.leftDegrees*Math.PI/180);var rightTan=Math.tan(fov.rightDegrees*Math.PI/180);var xScale=2/(leftTan+rightTan);var yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*.5);out[9]=(upTan-downTan)*yScale*.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out}function orthoNO(out,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=
1/(bottom-top);var nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out}var ortho=orthoNO;function orthoZO(out,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=nf;out[11]=0;
out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=near*nf;out[15]=1;return out}function lookAt(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len;var eyex=eye[0];var eyey=eye[1];var eyez=eye[2];var upx=up[0];var upy=up[1];var upz=up[2];var centerx=center[0];var centery=center[1];var centerz=center[2];if(Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON)return identity$2(out);z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.hypot(z0,z1,
z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.hypot(x0,x1,x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.hypot(y0,y1,y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*
eyex+z1*eyey+z2*eyez);out[15]=1;return out}function targetTo(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2];var z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2];var len=z0*z0+z1*z1+z2*z2;if(len>0){len=1/Math.sqrt(len);z0*=len;z1*=len;z2*=len}var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;len=x0*x0+x1*x1+x2*x2;if(len>0){len=1/Math.sqrt(len);x0*=len;x1*=len;x2*=len}out[0]=x0;out[1]=x1;out[2]=x2;out[3]=0;out[4]=z1*x2-z2*x1;out[5]=z2*x0-z0*x2;out[6]=
z0*x1-z1*x0;out[7]=0;out[8]=z0;out[9]=z1;out[10]=z2;out[11]=0;out[12]=eyex;out[13]=eyey;out[14]=eyez;out[15]=1;return out}function str$5(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}function frob(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function add$5(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=
a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];out[9]=a[9]+b[9];out[10]=a[10]+b[10];out[11]=a[11]+b[11];out[12]=a[12]+b[12];out[13]=a[13]+b[13];out[14]=a[14]+b[14];out[15]=a[15]+b[15];return out}function subtract$3(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];out[9]=a[9]-b[9];out[10]=a[10]-b[10];out[11]=a[11]-b[11];out[12]=
a[12]-b[12];out[13]=a[13]-b[13];out[14]=a[14]-b[14];out[15]=a[15]-b[15];return out}function multiplyScalar(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;out[9]=a[9]*b;out[10]=a[10]*b;out[11]=a[11]*b;out[12]=a[12]*b;out[13]=a[13]*b;out[14]=a[14]*b;out[15]=a[15]*b;return out}function multiplyScalarAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=
a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;out[9]=a[9]+b[9]*scale;out[10]=a[10]+b[10]*scale;out[11]=a[11]+b[11]*scale;out[12]=a[12]+b[12]*scale;out[13]=a[13]+b[13]*scale;out[14]=a[14]+b[14]*scale;out[15]=a[15]+b[15]*scale;return out}function exactEquals$5(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===
b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}function equals$5(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var a4=a[4],a5=a[5],a6=a[6],a7=a[7];var a8=a[8],a9=a[9],a10=a[10],a11=a[11];var a12=a[12],a13=a[13],a14=a[14],a15=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];var b4=b[4],b5=b[5],b6=b[6],b7=b[7];var b8=b[8],b9=b[9],b10=b[10],b11=b[11];var b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),
Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=EPSILON*Math.max(1,Math.abs(a9),
Math.abs(b9))&&Math.abs(a10-b10)<=EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))}var mul$5=multiply$5;var sub$3=subtract$3;var mat4=Object.freeze({__proto__:null,
create:create$5,clone:clone$5,copy:copy$5,fromValues:fromValues$5,set:set$5,identity:identity$2,transpose:transpose,invert:invert$2,adjoint:adjoint,determinant:determinant,multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:rotate$1,rotateX:rotateX$3,rotateY:rotateY$3,rotateZ:rotateZ$3,fromTranslation:fromTranslation$1,fromScaling:fromScaling,fromRotation:fromRotation$1,fromXRotation:fromXRotation,fromYRotation:fromYRotation,fromZRotation:fromZRotation,fromRotationTranslation:fromRotationTranslation$1,
fromQuat2:fromQuat2,getTranslation:getTranslation$1,getScaling:getScaling,getRotation:getRotation,decompose:decompose,fromRotationTranslationScale:fromRotationTranslationScale,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin,fromQuat:fromQuat,frustum:frustum,perspectiveNO:perspectiveNO,perspective:perspective,perspectiveZO:perspectiveZO,perspectiveFromFieldOfView:perspectiveFromFieldOfView,orthoNO:orthoNO,ortho:ortho,orthoZO:orthoZO,lookAt:lookAt,targetTo:targetTo,str:str$5,frob:frob,
add:add$5,subtract:subtract$3,multiplyScalar:multiplyScalar,multiplyScalarAndAdd:multiplyScalarAndAdd,exactEquals:exactEquals$5,equals:equals$5,mul:mul$5,sub:sub$3});function create$4(){var out=new ARRAY_TYPE(3);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0}return out}function clone$4(a){var out=new ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}function length$4(a){var x=a[0];var y=a[1];var z=a[2];return Math.hypot(x,y,z)}function fromValues$4(x,y,z){var out=new ARRAY_TYPE(3);
out[0]=x;out[1]=y;out[2]=z;return out}function copy$4(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}function set$4(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out}function add$4(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out}function subtract$2(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out}function multiply$4(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out}function divide$2(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];
out[2]=a[2]/b[2];return out}function ceil$2(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);return out}function floor$2(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);return out}function min$2(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out}function max$2(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out}function round$2(out,a){out[0]=
Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);return out}function scale$4(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out}function scaleAndAdd$2(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out}function distance$2(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];return Math.hypot(x,y,z)}function squaredDistance$2(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];return x*x+y*y+z*z}function squaredLength$4(a){var x=
a[0];var y=a[1];var z=a[2];return x*x+y*y+z*z}function negate$2(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out}function inverse$2(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out}function normalize$4(out,a){var x=a[0];var y=a[1];var z=a[2];var len=x*x+y*y+z*z;if(len>0)len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len;return out}function dot$4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cross$2(out,a,b){var ax=a[0],ay=a[1],az=a[2];var bx=b[0],by=b[1],
bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out}function lerp$4(out,a,b,t){var ax=a[0];var ay=a[1];var az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out}function slerp$1(out,a,b,t){var angle=Math.acos(Math.min(Math.max(dot$4(a,b),-1),1));var sinTotal=Math.sin(angle);var ratioA=Math.sin((1-t)*angle)/sinTotal;var ratioB=Math.sin(t*angle)/sinTotal;out[0]=ratioA*a[0]+ratioB*b[0];out[1]=ratioA*a[1]+ratioB*b[1];out[2]=ratioA*a[2]+ratioB*b[2];
return out}function hermite(out,a,b,c,d,t){var factorTimes2=t*t;var factor1=factorTimes2*(2*t-3)+1;var factor2=factorTimes2*(t-2)+t;var factor3=factorTimes2*(t-1);var factor4=factorTimes2*(3-2*t);out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out}function bezier(out,a,b,c,d,t){var inverseFactor=1-t;var inverseFactorTimesTwo=inverseFactor*inverseFactor;var factorTimes2=
t*t;var factor1=inverseFactorTimesTwo*inverseFactor;var factor2=3*t*inverseFactorTimesTwo;var factor3=3*factorTimes2*inverseFactor;var factor4=factorTimes2*t;out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out}function random$3(out,scale){scale=scale||1;var r=RANDOM()*2*Math.PI;var z=RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=
Math.sin(r)*zScale;out[2]=z*scale;return out}function transformMat4$2(out,a,m){var x=a[0],y=a[1],z=a[2];var w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out}function transformMat3$1(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out}function transformQuat$1(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3];var x=
a[0],y=a[1],z=a[2];var uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x;var uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx;var w2=qw*2;uvx*=w2;uvy*=w2;uvz*=w2;uuvx*=2;uuvy*=2;uuvz*=2;out[0]=x+uvx+uuvx;out[1]=y+uvy+uuvy;out[2]=z+uvz+uuvz;return out}function rotateX$2(out,a,b,rad){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(rad)-p[2]*Math.sin(rad);r[2]=p[1]*Math.sin(rad)+p[2]*Math.cos(rad);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out}function rotateY$2(out,
a,b,rad){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(rad)+p[0]*Math.cos(rad);r[1]=p[1];r[2]=p[2]*Math.cos(rad)-p[0]*Math.sin(rad);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out}function rotateZ$2(out,a,b,rad){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(rad)-p[1]*Math.sin(rad);r[1]=p[0]*Math.sin(rad)+p[1]*Math.cos(rad);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out}function angle$1(a,b){var ax=
a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2],mag=Math.sqrt((ax*ax+ay*ay+az*az)*(bx*bx+by*by+bz*bz)),cosine=mag&&dot$4(a,b)/mag;return Math.acos(Math.min(Math.max(cosine,-1),1))}function zero$2(out){out[0]=0;out[1]=0;out[2]=0;return out}function str$4(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"}function exactEquals$4(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function equals$4(a,b){var a0=a[0],a1=a[1],a2=a[2];var b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),
Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))}var sub$2=subtract$2;var mul$4=multiply$4;var div$2=divide$2;var dist$2=distance$2;var sqrDist$2=squaredDistance$2;var len$4=length$4;var sqrLen$4=squaredLength$4;var forEach$2=function(){var vec=create$4();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride)stride=3;if(!offset)offset=0;if(count)l=Math.min(count*stride+offset,a.length);else l=a.length;
for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();var vec3=Object.freeze({__proto__:null,create:create$4,clone:clone$4,length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:ceil$2,floor:floor$2,min:min$2,max:max$2,round:round$2,scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,
negate:negate$2,inverse:inverse$2,normalize:normalize$4,dot:dot$4,cross:cross$2,lerp:lerp$4,slerp:slerp$1,hermite:hermite,bezier:bezier,random:random$3,transformMat4:transformMat4$2,transformMat3:transformMat3$1,transformQuat:transformQuat$1,rotateX:rotateX$2,rotateY:rotateY$2,rotateZ:rotateZ$2,angle:angle$1,zero:zero$2,str:str$4,exactEquals:exactEquals$4,equals:equals$4,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var out=
new ARRAY_TYPE(4);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0;out[3]=0}return out}function clone$3(a){var out=new ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function fromValues$3(x,y,z,w){var out=new ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}function copy$3(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function set$3(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}function add$3(out,a,b){out[0]=a[0]+b[0];
out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out}function subtract$1(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out}function multiply$3(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out}function divide$1(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out}function ceil$1(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);out[3]=Math.ceil(a[3]);return out}
function floor$1(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);out[3]=Math.floor(a[3]);return out}function min$1(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out}function max$1(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out}function round$1(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);
out[3]=Math.round(a[3]);return out}function scale$3(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out}function scaleAndAdd$1(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out}function distance$1(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];var w=b[3]-a[3];return Math.hypot(x,y,z,w)}function squaredDistance$1(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];var w=b[3]-a[3];return x*x+y*y+z*z+w*
w}function length$3(a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];return Math.hypot(x,y,z,w)}function squaredLength$3(a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];return x*x+y*y+z*z+w*w}function negate$1(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out}function inverse$1(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out}function normalize$3(out,a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0)len=1/Math.sqrt(len);out[0]=
x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len;return out}function dot$3(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function cross$1(out,u,v,w){var A=v[0]*w[1]-v[1]*w[0],B=v[0]*w[2]-v[2]*w[0],C=v[0]*w[3]-v[3]*w[0],D=v[1]*w[2]-v[2]*w[1],E=v[1]*w[3]-v[3]*w[1],F=v[2]*w[3]-v[3]*w[2];var G=u[0];var H=u[1];var I=u[2];var J=u[3];out[0]=H*F-I*E+J*D;out[1]=-(G*F)+I*C-J*B;out[2]=G*E-H*C+J*A;out[3]=-(G*D)+H*B-I*A;return out}function lerp$3(out,a,b,t){var ax=a[0];var ay=a[1];var az=a[2];var aw=a[3];out[0]=
ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out}function random$2(out,scale){scale=scale||1;var v1,v2,v3,v4;var s1,s2;do{v1=RANDOM()*2-1;v2=RANDOM()*2-1;s1=v1*v1+v2*v2}while(s1>=1);do{v3=RANDOM()*2-1;v4=RANDOM()*2-1;s2=v3*v3+v4*v4}while(s2>=1);var d=Math.sqrt((1-s1)/s2);out[0]=scale*v1;out[1]=scale*v2;out[2]=scale*v3*d;out[3]=scale*v4*d;return out}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=
m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out}function transformQuat(out,a,q){var x=a[0],y=a[1],z=a[2];var qx=q[0],qy=q[1],qz=q[2],qw=q[3];var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;out[3]=a[3];return out}function zero$1(out){out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out}function str$3(a){return"vec4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}function exactEquals$3(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals$3(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))}var sub$1=subtract$1;
var mul$3=multiply$3;var div$1=divide$1;var dist$1=distance$1;var sqrDist$1=squaredDistance$1;var len$3=length$3;var sqrLen$3=squaredLength$3;var forEach$1=function(){var vec=create$3();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride)stride=4;if(!offset)offset=0;if(count)l=Math.min(count*stride+offset,a.length);else l=a.length;for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();
var vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:ceil$1,floor:floor$1,min:min$1,max:max$1,round:round$1,scale:scale$3,scaleAndAdd:scaleAndAdd$1,distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:negate$1,inverse:inverse$1,normalize:normalize$3,dot:dot$3,cross:cross$1,lerp:lerp$3,random:random$2,transformMat4:transformMat4$1,
transformQuat:transformQuat,zero:zero$1,str:str$3,exactEquals:exactEquals$3,equals:equals$3,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var out=new ARRAY_TYPE(4);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0}out[3]=1;return out}function identity$1(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}function setAxisAngle(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*
axis[2];out[3]=Math.cos(rad);return out}function getAxisAngle(out_axis,q){var rad=Math.acos(q[3])*2;var s=Math.sin(rad/2);if(s>EPSILON){out_axis[0]=q[0]/s;out_axis[1]=q[1]/s;out_axis[2]=q[2]/s}else{out_axis[0]=1;out_axis[1]=0;out_axis[2]=0}return rad}function getAngle(a,b){var dotproduct=dot$2(a,b);return Math.acos(2*dotproduct*dotproduct-1)}function multiply$2(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-
ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out}function rotateX$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out}function rotateY$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out}function rotateZ$1(out,a,
rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out}function calculateW(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out}function exp(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var r=Math.sqrt(x*x+y*y+z*z);var et=Math.exp(w);var s=r>0?et*Math.sin(r)/r:0;out[0]=x*s;out[1]=y*s;out[2]=z*s;out[3]=et*Math.cos(r);return out}
function ln(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var r=Math.sqrt(x*x+y*y+z*z);var t=r>0?Math.atan2(r,w)/r:0;out[0]=x*t;out[1]=y*t;out[2]=z*t;out[3]=.5*Math.log(x*x+y*y+z*z+w*w);return out}function pow(out,a,b){ln(out,a);scale$2(out,out,b);exp(out,out);return out}function slerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>EPSILON){omega=
Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out}function random$1(out){var u1=RANDOM();var u2=RANDOM();var u3=RANDOM();var sqrt1MinusU1=Math.sqrt(1-u1);var sqrtU1=Math.sqrt(u1);out[0]=sqrt1MinusU1*Math.sin(2*Math.PI*u2);out[1]=sqrt1MinusU1*Math.cos(2*Math.PI*u2);out[2]=sqrtU1*Math.sin(2*Math.PI*u3);
out[3]=sqrtU1*Math.cos(2*Math.PI*u3);return out}function invert$1(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var dot=a0*a0+a1*a1+a2*a2+a3*a3;var invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out}function conjugate$1(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out}function fromMat3(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-
m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out}function fromEuler(out,x,y,z){var order=arguments.length>4&&arguments[4]!==undefined?arguments[4]:ANGLE_ORDER;var halfToRad=Math.PI/360;x*=halfToRad;z*=halfToRad;y*=halfToRad;var sx=Math.sin(x);var cx=
Math.cos(x);var sy=Math.sin(y);var cy=Math.cos(y);var sz=Math.sin(z);var cz=Math.cos(z);switch(order){case "xyz":out[0]=sx*cy*cz+cx*sy*sz;out[1]=cx*sy*cz-sx*cy*sz;out[2]=cx*cy*sz+sx*sy*cz;out[3]=cx*cy*cz-sx*sy*sz;break;case "xzy":out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz-sx*cy*sz;out[2]=cx*cy*sz+sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;break;case "yxz":out[0]=sx*cy*cz+cx*sy*sz;out[1]=cx*sy*cz-sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;break;case "yzx":out[0]=sx*cy*cz+cx*sy*sz;out[1]=cx*sy*
cz+sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz-sx*sy*sz;break;case "zxy":out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz+sx*cy*sz;out[2]=cx*cy*sz+sx*sy*cz;out[3]=cx*cy*cz-sx*sy*sz;break;case "zyx":out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz+sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;break;default:throw new Error("Unknown angle order "+order);}return out}function str$2(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}var clone$2=clone$3;var fromValues$2=fromValues$3;var copy$2=copy$3;
var set$2=set$3;var add$2=add$3;var mul$2=multiply$2;var scale$2=scale$3;var dot$2=dot$3;var lerp$2=lerp$3;var length$2=length$3;var len$2=length$2;var squaredLength$2=squaredLength$3;var sqrLen$2=squaredLength$2;var normalize$2=normalize$3;var exactEquals$2=exactEquals$3;function equals$2(a,b){return Math.abs(dot$3(a,b))>=1-EPSILON}var rotationTo=function(){var tmpvec3=create$4();var xUnitVec3=fromValues$4(1,0,0);var yUnitVec3=fromValues$4(0,1,0);return function(out,a,b){var dot=dot$4(a,b);if(dot<
-.999999){cross$2(tmpvec3,xUnitVec3,a);if(len$4(tmpvec3)<1E-6)cross$2(tmpvec3,yUnitVec3,a);normalize$4(tmpvec3,tmpvec3);setAxisAngle(out,tmpvec3,Math.PI);return out}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{cross$2(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return normalize$2(out,out)}}}();var sqlerp=function(){var temp1=create$2();var temp2=create$2();return function(out,a,b,c,d,t){slerp(temp1,a,d,t);slerp(temp2,b,c,t);slerp(out,
temp1,temp2,2*t*(1-t));return out}}();var setAxes=function(){var matr=create$6();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return normalize$2(out,fromMat3(out,matr))}}();var quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle:setAxisAngle,getAxisAngle:getAxisAngle,getAngle:getAngle,multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,
rotateZ:rotateZ$1,calculateW:calculateW,exp:exp,ln:ln,pow:pow,slerp:slerp,random:random$1,invert:invert$1,conjugate:conjugate$1,fromMat3:fromMat3,fromEuler:fromEuler,str:str$2,clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$2,rotationTo:rotationTo,sqlerp:sqlerp,setAxes:setAxes});function create$1(){var dq=
new ARRAY_TYPE(8);if(ARRAY_TYPE!=Float32Array){dq[0]=0;dq[1]=0;dq[2]=0;dq[4]=0;dq[5]=0;dq[6]=0;dq[7]=0}dq[3]=1;return dq}function clone$1(a){var dq=new ARRAY_TYPE(8);dq[0]=a[0];dq[1]=a[1];dq[2]=a[2];dq[3]=a[3];dq[4]=a[4];dq[5]=a[5];dq[6]=a[6];dq[7]=a[7];return dq}function fromValues$1(x1,y1,z1,w1,x2,y2,z2,w2){var dq=new ARRAY_TYPE(8);dq[0]=x1;dq[1]=y1;dq[2]=z1;dq[3]=w1;dq[4]=x2;dq[5]=y2;dq[6]=z2;dq[7]=w2;return dq}function fromRotationTranslationValues(x1,y1,z1,w1,x2,y2,z2){var dq=new ARRAY_TYPE(8);
dq[0]=x1;dq[1]=y1;dq[2]=z1;dq[3]=w1;var ax=x2*.5,ay=y2*.5,az=z2*.5;dq[4]=ax*w1+ay*z1-az*y1;dq[5]=ay*w1+az*x1-ax*z1;dq[6]=az*w1+ax*y1-ay*x1;dq[7]=-ax*x1-ay*y1-az*z1;return dq}function fromRotationTranslation(out,q,t){var ax=t[0]*.5,ay=t[1]*.5,az=t[2]*.5,bx=q[0],by=q[1],bz=q[2],bw=q[3];out[0]=bx;out[1]=by;out[2]=bz;out[3]=bw;out[4]=ax*bw+ay*bz-az*by;out[5]=ay*bw+az*bx-ax*bz;out[6]=az*bw+ax*by-ay*bx;out[7]=-ax*bx-ay*by-az*bz;return out}function fromTranslation(out,t){out[0]=0;out[1]=0;out[2]=0;out[3]=
1;out[4]=t[0]*.5;out[5]=t[1]*.5;out[6]=t[2]*.5;out[7]=0;return out}function fromRotation(out,q){out[0]=q[0];out[1]=q[1];out[2]=q[2];out[3]=q[3];out[4]=0;out[5]=0;out[6]=0;out[7]=0;return out}function fromMat4(out,a){var outer=create$2();getRotation(outer,a);var t=new ARRAY_TYPE(3);getTranslation$1(t,a);fromRotationTranslation(out,outer,t);return out}function copy$1(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];return out}function identity(out){out[0]=
0;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;out[6]=0;out[7]=0;return out}function set$1(out,x1,y1,z1,w1,x2,y2,z2,w2){out[0]=x1;out[1]=y1;out[2]=z1;out[3]=w1;out[4]=x2;out[5]=y2;out[6]=z2;out[7]=w2;return out}var getReal=copy$2;function getDual(out,a){out[0]=a[4];out[1]=a[5];out[2]=a[6];out[3]=a[7];return out}var setReal=copy$2;function setDual(out,q){out[4]=q[0];out[5]=q[1];out[6]=q[2];out[7]=q[3];return out}function getTranslation(out,a){var ax=a[4],ay=a[5],az=a[6],aw=a[7],bx=-a[0],by=-a[1],bz=
-a[2],bw=a[3];out[0]=(ax*bw+aw*bx+ay*bz-az*by)*2;out[1]=(ay*bw+aw*by+az*bx-ax*bz)*2;out[2]=(az*bw+aw*bz+ax*by-ay*bx)*2;return out}function translate(out,a,v){var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3],bx1=v[0]*.5,by1=v[1]*.5,bz1=v[2]*.5,ax2=a[4],ay2=a[5],az2=a[6],aw2=a[7];out[0]=ax1;out[1]=ay1;out[2]=az1;out[3]=aw1;out[4]=aw1*bx1+ay1*bz1-az1*by1+ax2;out[5]=aw1*by1+az1*bx1-ax1*bz1+ay2;out[6]=aw1*bz1+ax1*by1-ay1*bx1+az2;out[7]=-ax1*bx1-ay1*by1-az1*bz1+aw2;return out}function rotateX(out,a,rad){var bx=
-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;rotateX$1(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out}function rotateY(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+
ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;rotateY$1(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out}function rotateZ(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-
ax*bx-ay*by-az*bz;rotateZ$1(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out}function rotateByQuatAppend(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax*qw+aw*qx+ay*qz-az*qy;out[1]=ay*qw+aw*qy+az*qx-ax*qz;out[2]=az*qw+aw*qz+ax*qy-ay*qx;out[3]=aw*qw-ax*qx-ay*qy-az*qz;ax=a[4];ay=a[5];az=a[6];aw=a[7];out[4]=ax*
qw+aw*qx+ay*qz-az*qy;out[5]=ay*qw+aw*qy+az*qx-ax*qz;out[6]=az*qw+aw*qz+ax*qy-ay*qx;out[7]=aw*qw-ax*qx-ay*qy-az*qz;return out}function rotateByQuatPrepend(out,q,a){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],bx=a[0],by=a[1],bz=a[2],bw=a[3];out[0]=qx*bw+qw*bx+qy*bz-qz*by;out[1]=qy*bw+qw*by+qz*bx-qx*bz;out[2]=qz*bw+qw*bz+qx*by-qy*bx;out[3]=qw*bw-qx*bx-qy*by-qz*bz;bx=a[4];by=a[5];bz=a[6];bw=a[7];out[4]=qx*bw+qw*bx+qy*bz-qz*by;out[5]=qy*bw+qw*by+qz*bx-qx*bz;out[6]=qz*bw+qw*bz+qx*by-qy*bx;out[7]=qw*bw-qx*bx-qy*
by-qz*bz;return out}function rotateAroundAxis(out,a,axis,rad){if(Math.abs(rad)<EPSILON)return copy$1(out,a);var axisLength=Math.hypot(axis[0],axis[1],axis[2]);rad=rad*.5;var s=Math.sin(rad);var bx=s*axis[0]/axisLength;var by=s*axis[1]/axisLength;var bz=s*axis[2]/axisLength;var bw=Math.cos(rad);var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3];out[0]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[1]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[2]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[3]=aw1*bw-ax1*bx-ay1*by-az1*bz;var ax=a[4],ay=a[5],az=a[6],
aw=a[7];out[4]=ax*bw+aw*bx+ay*bz-az*by;out[5]=ay*bw+aw*by+az*bx-ax*bz;out[6]=az*bw+aw*bz+ax*by-ay*bx;out[7]=aw*bw-ax*bx-ay*by-az*bz;return out}function add$1(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];return out}function multiply$1(out,a,b){var ax0=a[0],ay0=a[1],az0=a[2],aw0=a[3],bx1=b[4],by1=b[5],bz1=b[6],bw1=b[7],ax1=a[4],ay1=a[5],az1=a[6],aw1=a[7],bx0=b[0],by0=b[1],bz0=b[2],bw0=b[3];out[0]=ax0*
bw0+aw0*bx0+ay0*bz0-az0*by0;out[1]=ay0*bw0+aw0*by0+az0*bx0-ax0*bz0;out[2]=az0*bw0+aw0*bz0+ax0*by0-ay0*bx0;out[3]=aw0*bw0-ax0*bx0-ay0*by0-az0*bz0;out[4]=ax0*bw1+aw0*bx1+ay0*bz1-az0*by1+ax1*bw0+aw1*bx0+ay1*bz0-az1*by0;out[5]=ay0*bw1+aw0*by1+az0*bx1-ax0*bz1+ay1*bw0+aw1*by0+az1*bx0-ax1*bz0;out[6]=az0*bw1+aw0*bz1+ax0*by1-ay0*bx1+az1*bw0+aw1*bz0+ax1*by0-ay1*bx0;out[7]=aw0*bw1-ax0*bx1-ay0*by1-az0*bz1+aw1*bw0-ax1*bx0-ay1*by0-az1*bz0;return out}var mul$1=multiply$1;function scale$1(out,a,b){out[0]=a[0]*b;
out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;return out}var dot$1=dot$2;function lerp$1(out,a,b,t){var mt=1-t;if(dot$1(a,b)<0)t=-t;out[0]=a[0]*mt+b[0]*t;out[1]=a[1]*mt+b[1]*t;out[2]=a[2]*mt+b[2]*t;out[3]=a[3]*mt+b[3]*t;out[4]=a[4]*mt+b[4]*t;out[5]=a[5]*mt+b[5]*t;out[6]=a[6]*mt+b[6]*t;out[7]=a[7]*mt+b[7]*t;return out}function invert(out,a){var sqlen=squaredLength$1(a);out[0]=-a[0]/sqlen;out[1]=-a[1]/sqlen;out[2]=-a[2]/sqlen;out[3]=a[3]/sqlen;out[4]=
-a[4]/sqlen;out[5]=-a[5]/sqlen;out[6]=-a[6]/sqlen;out[7]=a[7]/sqlen;return out}function conjugate(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];out[4]=-a[4];out[5]=-a[5];out[6]=-a[6];out[7]=a[7];return out}var length$1=length$2;var len$1=length$1;var squaredLength$1=squaredLength$2;var sqrLen$1=squaredLength$1;function normalize$1(out,a){var magnitude=squaredLength$1(a);if(magnitude>0){magnitude=Math.sqrt(magnitude);var a0=a[0]/magnitude;var a1=a[1]/magnitude;var a2=a[2]/magnitude;var a3=
a[3]/magnitude;var b0=a[4];var b1=a[5];var b2=a[6];var b3=a[7];var a_dot_b=a0*b0+a1*b1+a2*b2+a3*b3;out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=(b0-a0*a_dot_b)/magnitude;out[5]=(b1-a1*a_dot_b)/magnitude;out[6]=(b2-a2*a_dot_b)/magnitude;out[7]=(b3-a3*a_dot_b)/magnitude}return out}function str$1(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"}function exactEquals$1(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===
b[5]&&a[6]===b[6]&&a[7]===b[7]}function equals$1(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),
Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))}var quat2=Object.freeze({__proto__:null,create:create$1,clone:clone$1,fromValues:fromValues$1,fromRotationTranslationValues:fromRotationTranslationValues,fromRotationTranslation:fromRotationTranslation,fromTranslation:fromTranslation,fromRotation:fromRotation,fromMat4:fromMat4,copy:copy$1,identity:identity,
set:set$1,getReal:getReal,getDual:getDual,setReal:setReal,setDual:setDual,getTranslation:getTranslation,translate:translate,rotateX:rotateX,rotateY:rotateY,rotateZ:rotateZ,rotateByQuatAppend:rotateByQuatAppend,rotateByQuatPrepend:rotateByQuatPrepend,rotateAroundAxis:rotateAroundAxis,add:add$1,multiply:multiply$1,mul:mul$1,scale:scale$1,dot:dot$1,lerp:lerp$1,invert:invert,conjugate:conjugate,length:length$1,len:len$1,squaredLength:squaredLength$1,sqrLen:sqrLen$1,normalize:normalize$1,str:str$1,exactEquals:exactEquals$1,
equals:equals$1});function create(){var out=new ARRAY_TYPE(2);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0}return out}function clone(a){var out=new ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out}function fromValues(x,y){var out=new ARRAY_TYPE(2);out[0]=x;out[1]=y;return out}function copy(out,a){out[0]=a[0];out[1]=a[1];return out}function set(out,x,y){out[0]=x;out[1]=y;return out}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=
a[1]-b[1];return out}function multiply(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out}function divide(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out}function ceil(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);return out}function floor(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);return out}function min(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out}function max(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out}function round(out,
a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);return out}function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out}function scaleAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out}function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.hypot(x,y)}function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y}function length(a){var x=a[0],y=a[1];return Math.hypot(x,y)}function squaredLength(a){var x=a[0],y=a[1];return x*x+y*y}function negate(out,
a){out[0]=-a[0];out[1]=-a[1];return out}function inverse(out,a){out[0]=1/a[0];out[1]=1/a[1];return out}function normalize(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0)len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;return out}function dot(a,b){return a[0]*b[0]+a[1]*b[1]}function cross(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out}function lerp(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out}function random(out,scale){scale=scale||
1;var r=RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out}function transformMat2(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out}function transformMat2d(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out}function transformMat3(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out}function transformMat4(out,a,m){var x=a[0];var y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=
m[1]*x+m[5]*y+m[13];return out}function rotate(out,a,b,rad){var p0=a[0]-b[0],p1=a[1]-b[1],sinC=Math.sin(rad),cosC=Math.cos(rad);out[0]=p0*cosC-p1*sinC+b[0];out[1]=p0*sinC+p1*cosC+b[1];return out}function angle(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1],mag=Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2)),cosine=mag&&(x1*x2+y1*y2)/mag;return Math.acos(Math.min(Math.max(cosine,-1),1))}function zero(out){out[0]=0;out[1]=0;return out}function str(a){return"vec2("+a[0]+", "+a[1]+")"}function exactEquals(a,b){return a[0]===
b[0]&&a[1]===b[1]}function equals(a,b){var a0=a[0],a1=a[1];var b0=b[0],b1=b[1];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))}var len=length;var sub=subtract;var mul=multiply;var div=divide;var dist=distance;var sqrDist=squaredDistance;var sqrLen=squaredLength;var forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride)stride=2;if(!offset)offset=0;if(count)l=Math.min(count*
stride+offset,a.length);else l=a.length;for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();var vec2=Object.freeze({__proto__:null,create:create,clone:clone,fromValues:fromValues,copy:copy,set:set,add:add,subtract:subtract,multiply:multiply,divide:divide,ceil:ceil,floor:floor,min:min,max:max,round:round,scale:scale,scaleAndAdd:scaleAndAdd,distance:distance,squaredDistance:squaredDistance,length:length,squaredLength:squaredLength,negate:negate,
inverse:inverse,normalize:normalize,dot:dot,cross:cross,lerp:lerp,random:random,transformMat2:transformMat2,transformMat2d:transformMat2d,transformMat3:transformMat3,transformMat4:transformMat4,rotate:rotate,angle:angle,zero:zero,str:str,exactEquals:exactEquals,equals:equals,len:len,sub:sub,mul:mul,div:div,dist:dist,sqrDist:sqrDist,sqrLen:sqrLen,forEach:forEach});exports.glMatrix=common;exports.mat2=mat2;exports.mat2d=mat2d;exports.mat3=mat3;exports.mat4=mat4;exports.quat=quat;exports.quat2=quat2;
exports.vec2=vec2;exports.vec3=vec3;exports.vec4=vec4;Object.defineProperty(exports,"__esModule",{value:true})});

}

// ../3rdparty/grapheme-splitter.js
{
function GraphemeSplitter(){function h(a,c){void 0===c&&(c=0);var b=a.charCodeAt(c);if(55296<=b&&56319>=b&&c<a.length-1){var d=b;a=a.charCodeAt(c+1);return 56320<=a&&57343>=a?1024*(d-55296)+(a-56320)+65536:d}return 56320<=b&&57343>=b&&1<=c?(d=a.charCodeAt(c-1),a=b,55296<=d&&56319>=d?1024*(d-55296)+(a-56320)+65536:a):b}function l(a,c,b){var d=[a].concat(c).concat([b]),e=d[d.length-2],g=d.lastIndexOf(14);if(1<g&&d.slice(1,g).every(function(f){return 3==f})&&-1==[3,13,17].indexOf(a))return 2;a=d.lastIndexOf(4);
if(0<a&&d.slice(1,a).every(function(f){return 4==f})&&-1==[12,4].indexOf(e))return 1==d.filter(function(f){return 4==f}).length%2?3:4;if(0==e&&1==b)return 0;if(2==e||0==e||1==e)return 14==b&&c.every(function(f){return 3==f})?2:1;if(2==b||0==b||1==b)return 1;if(6!=e||6!=b&&7!=b&&9!=b&&10!=b)if(9!=e&&7!=e||7!=b&&8!=b)if(10!=e&&8!=e||8!=b){if(3==b||15==b||5==b||12==e)return 0}else return 0;else return 0;else return 0;a=-1!=d.indexOf(3)?d.lastIndexOf(3)-1:d.length-2;return-1!=[13,17].indexOf(d[a])&&d.slice(a+
1,-1).every(function(f){return 3==f})&&14==b||15==e&&-1!=[16,17].indexOf(b)?0:-1!=c.indexOf(4)?2:4==e&&4==b?0:1}function k(a){return 1536<=a&&1541>=a||1757==a||1807==a||2274==a||3406==a||69821==a||70082<=a&&70083>=a||72250==a||72326<=a&&72329>=a||73030==a?12:13==a?0:10==a?1:0<=a&&9>=a||11<=a&&12>=a||14<=a&&31>=a||127<=a&&159>=a||173==a||1564==a||6158==a||8203==a||8206<=a&&8207>=a||8232==a||8233==a||8234<=a&&8238>=a||8288<=a&&8292>=a||8293==a||8294<=a&&8303>=a||55296<=a&&57343>=a||65279==a||65520<=
a&&65528>=a||65529<=a&&65531>=a||113824<=a&&113827>=a||119155<=a&&119162>=a||917504==a||917505==a||917506<=a&&917535>=a||917632<=a&&917759>=a||918E3<=a&&921599>=a?2:768<=a&&879>=a||1155<=a&&1159>=a||1160<=a&&1161>=a||1425<=a&&1469>=a||1471==a||1473<=a&&1474>=a||1476<=a&&1477>=a||1479==a||1552<=a&&1562>=a||1611<=a&&1631>=a||1648==a||1750<=a&&1756>=a||1759<=a&&1764>=a||1767<=a&&1768>=a||1770<=a&&1773>=a||1809==a||1840<=a&&1866>=a||1958<=a&&1968>=a||2027<=a&&2035>=a||2070<=a&&2073>=a||2075<=a&&2083>=
a||2085<=a&&2087>=a||2089<=a&&2093>=a||2137<=a&&2139>=a||2260<=a&&2273>=a||2275<=a&&2306>=a||2362==a||2364==a||2369<=a&&2376>=a||2381==a||2385<=a&&2391>=a||2402<=a&&2403>=a||2433==a||2492==a||2494==a||2497<=a&&2500>=a||2509==a||2519==a||2530<=a&&2531>=a||2561<=a&&2562>=a||2620==a||2625<=a&&2626>=a||2631<=a&&2632>=a||2635<=a&&2637>=a||2641==a||2672<=a&&2673>=a||2677==a||2689<=a&&2690>=a||2748==a||2753<=a&&2757>=a||2759<=a&&2760>=a||2765==a||2786<=a&&2787>=a||2810<=a&&2815>=a||2817==a||2876==a||2878==
a||2879==a||2881<=a&&2884>=a||2893==a||2902==a||2903==a||2914<=a&&2915>=a||2946==a||3006==a||3008==a||3021==a||3031==a||3072==a||3134<=a&&3136>=a||3142<=a&&3144>=a||3146<=a&&3149>=a||3157<=a&&3158>=a||3170<=a&&3171>=a||3201==a||3260==a||3263==a||3266==a||3270==a||3276<=a&&3277>=a||3285<=a&&3286>=a||3298<=a&&3299>=a||3328<=a&&3329>=a||3387<=a&&3388>=a||3390==a||3393<=a&&3396>=a||3405==a||3415==a||3426<=a&&3427>=a||3530==a||3535==a||3538<=a&&3540>=a||3542==a||3551==a||3633==a||3636<=a&&3642>=a||3655<=
a&&3662>=a||3761==a||3764<=a&&3769>=a||3771<=a&&3772>=a||3784<=a&&3789>=a||3864<=a&&3865>=a||3893==a||3895==a||3897==a||3953<=a&&3966>=a||3968<=a&&3972>=a||3974<=a&&3975>=a||3981<=a&&3991>=a||3993<=a&&4028>=a||4038==a||4141<=a&&4144>=a||4146<=a&&4151>=a||4153<=a&&4154>=a||4157<=a&&4158>=a||4184<=a&&4185>=a||4190<=a&&4192>=a||4209<=a&&4212>=a||4226==a||4229<=a&&4230>=a||4237==a||4253==a||4957<=a&&4959>=a||5906<=a&&5908>=a||5938<=a&&5940>=a||5970<=a&&5971>=a||6002<=a&&6003>=a||6068<=a&&6069>=a||6071<=
a&&6077>=a||6086==a||6089<=a&&6099>=a||6109==a||6155<=a&&6157>=a||6277<=a&&6278>=a||6313==a||6432<=a&&6434>=a||6439<=a&&6440>=a||6450==a||6457<=a&&6459>=a||6679<=a&&6680>=a||6683==a||6742==a||6744<=a&&6750>=a||6752==a||6754==a||6757<=a&&6764>=a||6771<=a&&6780>=a||6783==a||6832<=a&&6845>=a||6846==a||6912<=a&&6915>=a||6964==a||6966<=a&&6970>=a||6972==a||6978==a||7019<=a&&7027>=a||7040<=a&&7041>=a||7074<=a&&7077>=a||7080<=a&&7081>=a||7083<=a&&7085>=a||7142==a||7144<=a&&7145>=a||7149==a||7151<=a&&7153>=
a||7212<=a&&7219>=a||7222<=a&&7223>=a||7376<=a&&7378>=a||7380<=a&&7392>=a||7394<=a&&7400>=a||7405==a||7412==a||7416<=a&&7417>=a||7616<=a&&7673>=a||7675<=a&&7679>=a||8204==a||8400<=a&&8412>=a||8413<=a&&8416>=a||8417==a||8418<=a&&8420>=a||8421<=a&&8432>=a||11503<=a&&11505>=a||11647==a||11744<=a&&11775>=a||12330<=a&&12333>=a||12334<=a&&12335>=a||12441<=a&&12442>=a||42607==a||42608<=a&&42610>=a||42612<=a&&42621>=a||42654<=a&&42655>=a||42736<=a&&42737>=a||43010==a||43014==a||43019==a||43045<=a&&43046>=
a||43204<=a&&43205>=a||43232<=a&&43249>=a||43302<=a&&43309>=a||43335<=a&&43345>=a||43392<=a&&43394>=a||43443==a||43446<=a&&43449>=a||43452==a||43493==a||43561<=a&&43566>=a||43569<=a&&43570>=a||43573<=a&&43574>=a||43587==a||43596==a||43644==a||43696==a||43698<=a&&43700>=a||43703<=a&&43704>=a||43710<=a&&43711>=a||43713==a||43756<=a&&43757>=a||43766==a||44005==a||44008==a||44013==a||64286==a||65024<=a&&65039>=a||65056<=a&&65071>=a||65438<=a&&65439>=a||66045==a||66272==a||66422<=a&&66426>=a||68097<=a&&
68099>=a||68101<=a&&68102>=a||68108<=a&&68111>=a||68152<=a&&68154>=a||68159==a||68325<=a&&68326>=a||69633==a||69688<=a&&69702>=a||69759<=a&&69761>=a||69811<=a&&69814>=a||69817<=a&&69818>=a||69888<=a&&69890>=a||69927<=a&&69931>=a||69933<=a&&69940>=a||70003==a||70016<=a&&70017>=a||70070<=a&&70078>=a||70090<=a&&70092>=a||70191<=a&&70193>=a||70196==a||70198<=a&&70199>=a||70206==a||70367==a||70371<=a&&70378>=a||70400<=a&&70401>=a||70460==a||70462==a||70464==a||70487==a||70502<=a&&70508>=a||70512<=a&&70516>=
a||70712<=a&&70719>=a||70722<=a&&70724>=a||70726==a||70832==a||70835<=a&&70840>=a||70842==a||70845==a||70847<=a&&70848>=a||70850<=a&&70851>=a||71087==a||71090<=a&&71093>=a||71100<=a&&71101>=a||71103<=a&&71104>=a||71132<=a&&71133>=a||71219<=a&&71226>=a||71229==a||71231<=a&&71232>=a||71339==a||71341==a||71344<=a&&71349>=a||71351==a||71453<=a&&71455>=a||71458<=a&&71461>=a||71463<=a&&71467>=a||72193<=a&&72198>=a||72201<=a&&72202>=a||72243<=a&&72248>=a||72251<=a&&72254>=a||72263==a||72273<=a&&72278>=a||
72281<=a&&72283>=a||72330<=a&&72342>=a||72344<=a&&72345>=a||72752<=a&&72758>=a||72760<=a&&72765>=a||72767==a||72850<=a&&72871>=a||72874<=a&&72880>=a||72882<=a&&72883>=a||72885<=a&&72886>=a||73009<=a&&73014>=a||73018==a||73020<=a&&73021>=a||73023<=a&&73029>=a||73031==a||92912<=a&&92916>=a||92976<=a&&92982>=a||94095<=a&&94098>=a||113821<=a&&113822>=a||119141==a||119143<=a&&119145>=a||119150<=a&&119154>=a||119163<=a&&119170>=a||119173<=a&&119179>=a||119210<=a&&119213>=a||119362<=a&&119364>=a||121344<=
a&&121398>=a||121403<=a&&121452>=a||121461==a||121476==a||121499<=a&&121503>=a||121505<=a&&121519>=a||122880<=a&&122886>=a||122888<=a&&122904>=a||122907<=a&&122913>=a||122915<=a&&122916>=a||122918<=a&&122922>=a||125136<=a&&125142>=a||125252<=a&&125258>=a||917536<=a&&917631>=a||917760<=a&&917999>=a?3:127462<=a&&127487>=a?4:2307==a||2363==a||2366<=a&&2368>=a||2377<=a&&2380>=a||2382<=a&&2383>=a||2434<=a&&2435>=a||2495<=a&&2496>=a||2503<=a&&2504>=a||2507<=a&&2508>=a||2563==a||2622<=a&&2624>=a||2691==
a||2750<=a&&2752>=a||2761==a||2763<=a&&2764>=a||2818<=a&&2819>=a||2880==a||2887<=a&&2888>=a||2891<=a&&2892>=a||3007==a||3009<=a&&3010>=a||3014<=a&&3016>=a||3018<=a&&3020>=a||3073<=a&&3075>=a||3137<=a&&3140>=a||3202<=a&&3203>=a||3262==a||3264<=a&&3265>=a||3267<=a&&3268>=a||3271<=a&&3272>=a||3274<=a&&3275>=a||3330<=a&&3331>=a||3391<=a&&3392>=a||3398<=a&&3400>=a||3402<=a&&3404>=a||3458<=a&&3459>=a||3536<=a&&3537>=a||3544<=a&&3550>=a||3570<=a&&3571>=a||3635==a||3763==a||3902<=a&&3903>=a||3967==a||4145==
a||4155<=a&&4156>=a||4182<=a&&4183>=a||4228==a||6070==a||6078<=a&&6085>=a||6087<=a&&6088>=a||6435<=a&&6438>=a||6441<=a&&6443>=a||6448<=a&&6449>=a||6451<=a&&6456>=a||6681<=a&&6682>=a||6741==a||6743==a||6765<=a&&6770>=a||6916==a||6965==a||6971==a||6973<=a&&6977>=a||6979<=a&&6980>=a||7042==a||7073==a||7078<=a&&7079>=a||7082==a||7143==a||7146<=a&&7148>=a||7150==a||7154<=a&&7155>=a||7204<=a&&7211>=a||7220<=a&&7221>=a||7393==a||7410<=a&&7411>=a||7415==a||43043<=a&&43044>=a||43047==a||43136<=a&&43137>=a||
43188<=a&&43203>=a||43346<=a&&43347>=a||43395==a||43444<=a&&43445>=a||43450<=a&&43451>=a||43453<=a&&43456>=a||43567<=a&&43568>=a||43571<=a&&43572>=a||43597==a||43755==a||43758<=a&&43759>=a||43765==a||44003<=a&&44004>=a||44006<=a&&44007>=a||44009<=a&&44010>=a||44012==a||69632==a||69634==a||69762==a||69808<=a&&69810>=a||69815<=a&&69816>=a||69932==a||70018==a||70067<=a&&70069>=a||70079<=a&&70080>=a||70188<=a&&70190>=a||70194<=a&&70195>=a||70197==a||70368<=a&&70370>=a||70402<=a&&70403>=a||70463==a||70465<=
a&&70468>=a||70471<=a&&70472>=a||70475<=a&&70477>=a||70498<=a&&70499>=a||70709<=a&&70711>=a||70720<=a&&70721>=a||70725==a||70833<=a&&70834>=a||70841==a||70843<=a&&70844>=a||70846==a||70849==a||71088<=a&&71089>=a||71096<=a&&71099>=a||71102==a||71216<=a&&71218>=a||71227<=a&&71228>=a||71230==a||71340==a||71342<=a&&71343>=a||71350==a||71456<=a&&71457>=a||71462==a||72199<=a&&72200>=a||72249==a||72279<=a&&72280>=a||72343==a||72751==a||72766==a||72873==a||72881==a||72884==a||94033<=a&&94078>=a||119142==
a||119149==a?5:4352<=a&&4447>=a||43360<=a&&43388>=a?6:4448<=a&&4519>=a||55216<=a&&55238>=a?7:4520<=a&&4607>=a||55243<=a&&55291>=a?8:44032==a||44060==a||44088==a||44116==a||44144==a||44172==a||44200==a||44228==a||44256==a||44284==a||44312==a||44340==a||44368==a||44396==a||44424==a||44452==a||44480==a||44508==a||44536==a||44564==a||44592==a||44620==a||44648==a||44676==a||44704==a||44732==a||44760==a||44788==a||44816==a||44844==a||44872==a||44900==a||44928==a||44956==a||44984==a||45012==a||45040==a||
45068==a||45096==a||45124==a||45152==a||45180==a||45208==a||45236==a||45264==a||45292==a||45320==a||45348==a||45376==a||45404==a||45432==a||45460==a||45488==a||45516==a||45544==a||45572==a||45600==a||45628==a||45656==a||45684==a||45712==a||45740==a||45768==a||45796==a||45824==a||45852==a||45880==a||45908==a||45936==a||45964==a||45992==a||46020==a||46048==a||46076==a||46104==a||46132==a||46160==a||46188==a||46216==a||46244==a||46272==a||46300==a||46328==a||46356==a||46384==a||46412==a||46440==a||46468==
a||46496==a||46524==a||46552==a||46580==a||46608==a||46636==a||46664==a||46692==a||46720==a||46748==a||46776==a||46804==a||46832==a||46860==a||46888==a||46916==a||46944==a||46972==a||47E3==a||47028==a||47056==a||47084==a||47112==a||47140==a||47168==a||47196==a||47224==a||47252==a||47280==a||47308==a||47336==a||47364==a||47392==a||47420==a||47448==a||47476==a||47504==a||47532==a||47560==a||47588==a||47616==a||47644==a||47672==a||47700==a||47728==a||47756==a||47784==a||47812==a||47840==a||47868==a||
47896==a||47924==a||47952==a||47980==a||48008==a||48036==a||48064==a||48092==a||48120==a||48148==a||48176==a||48204==a||48232==a||48260==a||48288==a||48316==a||48344==a||48372==a||48400==a||48428==a||48456==a||48484==a||48512==a||48540==a||48568==a||48596==a||48624==a||48652==a||48680==a||48708==a||48736==a||48764==a||48792==a||48820==a||48848==a||48876==a||48904==a||48932==a||48960==a||48988==a||49016==a||49044==a||49072==a||49100==a||49128==a||49156==a||49184==a||49212==a||49240==a||49268==a||49296==
a||49324==a||49352==a||49380==a||49408==a||49436==a||49464==a||49492==a||49520==a||49548==a||49576==a||49604==a||49632==a||49660==a||49688==a||49716==a||49744==a||49772==a||49800==a||49828==a||49856==a||49884==a||49912==a||49940==a||49968==a||49996==a||50024==a||50052==a||50080==a||50108==a||50136==a||50164==a||50192==a||50220==a||50248==a||50276==a||50304==a||50332==a||50360==a||50388==a||50416==a||50444==a||50472==a||50500==a||50528==a||50556==a||50584==a||50612==a||50640==a||50668==a||50696==a||
50724==a||50752==a||50780==a||50808==a||50836==a||50864==a||50892==a||50920==a||50948==a||50976==a||51004==a||51032==a||51060==a||51088==a||51116==a||51144==a||51172==a||51200==a||51228==a||51256==a||51284==a||51312==a||51340==a||51368==a||51396==a||51424==a||51452==a||51480==a||51508==a||51536==a||51564==a||51592==a||51620==a||51648==a||51676==a||51704==a||51732==a||51760==a||51788==a||51816==a||51844==a||51872==a||51900==a||51928==a||51956==a||51984==a||52012==a||52040==a||52068==a||52096==a||52124==
a||52152==a||52180==a||52208==a||52236==a||52264==a||52292==a||52320==a||52348==a||52376==a||52404==a||52432==a||52460==a||52488==a||52516==a||52544==a||52572==a||52600==a||52628==a||52656==a||52684==a||52712==a||52740==a||52768==a||52796==a||52824==a||52852==a||52880==a||52908==a||52936==a||52964==a||52992==a||53020==a||53048==a||53076==a||53104==a||53132==a||53160==a||53188==a||53216==a||53244==a||53272==a||53300==a||53328==a||53356==a||53384==a||53412==a||53440==a||53468==a||53496==a||53524==a||
53552==a||53580==a||53608==a||53636==a||53664==a||53692==a||53720==a||53748==a||53776==a||53804==a||53832==a||53860==a||53888==a||53916==a||53944==a||53972==a||54E3==a||54028==a||54056==a||54084==a||54112==a||54140==a||54168==a||54196==a||54224==a||54252==a||54280==a||54308==a||54336==a||54364==a||54392==a||54420==a||54448==a||54476==a||54504==a||54532==a||54560==a||54588==a||54616==a||54644==a||54672==a||54700==a||54728==a||54756==a||54784==a||54812==a||54840==a||54868==a||54896==a||54924==a||54952==
a||54980==a||55008==a||55036==a||55064==a||55092==a||55120==a||55148==a||55176==a?9:44033<=a&&44059>=a||44061<=a&&44087>=a||44089<=a&&44115>=a||44117<=a&&44143>=a||44145<=a&&44171>=a||44173<=a&&44199>=a||44201<=a&&44227>=a||44229<=a&&44255>=a||44257<=a&&44283>=a||44285<=a&&44311>=a||44313<=a&&44339>=a||44341<=a&&44367>=a||44369<=a&&44395>=a||44397<=a&&44423>=a||44425<=a&&44451>=a||44453<=a&&44479>=a||44481<=a&&44507>=a||44509<=a&&44535>=a||44537<=a&&44563>=a||44565<=a&&44591>=a||44593<=a&&44619>=
a||44621<=a&&44647>=a||44649<=a&&44675>=a||44677<=a&&44703>=a||44705<=a&&44731>=a||44733<=a&&44759>=a||44761<=a&&44787>=a||44789<=a&&44815>=a||44817<=a&&44843>=a||44845<=a&&44871>=a||44873<=a&&44899>=a||44901<=a&&44927>=a||44929<=a&&44955>=a||44957<=a&&44983>=a||44985<=a&&45011>=a||45013<=a&&45039>=a||45041<=a&&45067>=a||45069<=a&&45095>=a||45097<=a&&45123>=a||45125<=a&&45151>=a||45153<=a&&45179>=a||45181<=a&&45207>=a||45209<=a&&45235>=a||45237<=a&&45263>=a||45265<=a&&45291>=a||45293<=a&&45319>=a||
45321<=a&&45347>=a||45349<=a&&45375>=a||45377<=a&&45403>=a||45405<=a&&45431>=a||45433<=a&&45459>=a||45461<=a&&45487>=a||45489<=a&&45515>=a||45517<=a&&45543>=a||45545<=a&&45571>=a||45573<=a&&45599>=a||45601<=a&&45627>=a||45629<=a&&45655>=a||45657<=a&&45683>=a||45685<=a&&45711>=a||45713<=a&&45739>=a||45741<=a&&45767>=a||45769<=a&&45795>=a||45797<=a&&45823>=a||45825<=a&&45851>=a||45853<=a&&45879>=a||45881<=a&&45907>=a||45909<=a&&45935>=a||45937<=a&&45963>=a||45965<=a&&45991>=a||45993<=a&&46019>=a||46021<=
a&&46047>=a||46049<=a&&46075>=a||46077<=a&&46103>=a||46105<=a&&46131>=a||46133<=a&&46159>=a||46161<=a&&46187>=a||46189<=a&&46215>=a||46217<=a&&46243>=a||46245<=a&&46271>=a||46273<=a&&46299>=a||46301<=a&&46327>=a||46329<=a&&46355>=a||46357<=a&&46383>=a||46385<=a&&46411>=a||46413<=a&&46439>=a||46441<=a&&46467>=a||46469<=a&&46495>=a||46497<=a&&46523>=a||46525<=a&&46551>=a||46553<=a&&46579>=a||46581<=a&&46607>=a||46609<=a&&46635>=a||46637<=a&&46663>=a||46665<=a&&46691>=a||46693<=a&&46719>=a||46721<=a&&
46747>=a||46749<=a&&46775>=a||46777<=a&&46803>=a||46805<=a&&46831>=a||46833<=a&&46859>=a||46861<=a&&46887>=a||46889<=a&&46915>=a||46917<=a&&46943>=a||46945<=a&&46971>=a||46973<=a&&46999>=a||47001<=a&&47027>=a||47029<=a&&47055>=a||47057<=a&&47083>=a||47085<=a&&47111>=a||47113<=a&&47139>=a||47141<=a&&47167>=a||47169<=a&&47195>=a||47197<=a&&47223>=a||47225<=a&&47251>=a||47253<=a&&47279>=a||47281<=a&&47307>=a||47309<=a&&47335>=a||47337<=a&&47363>=a||47365<=a&&47391>=a||47393<=a&&47419>=a||47421<=a&&47447>=
a||47449<=a&&47475>=a||47477<=a&&47503>=a||47505<=a&&47531>=a||47533<=a&&47559>=a||47561<=a&&47587>=a||47589<=a&&47615>=a||47617<=a&&47643>=a||47645<=a&&47671>=a||47673<=a&&47699>=a||47701<=a&&47727>=a||47729<=a&&47755>=a||47757<=a&&47783>=a||47785<=a&&47811>=a||47813<=a&&47839>=a||47841<=a&&47867>=a||47869<=a&&47895>=a||47897<=a&&47923>=a||47925<=a&&47951>=a||47953<=a&&47979>=a||47981<=a&&48007>=a||48009<=a&&48035>=a||48037<=a&&48063>=a||48065<=a&&48091>=a||48093<=a&&48119>=a||48121<=a&&48147>=a||
48149<=a&&48175>=a||48177<=a&&48203>=a||48205<=a&&48231>=a||48233<=a&&48259>=a||48261<=a&&48287>=a||48289<=a&&48315>=a||48317<=a&&48343>=a||48345<=a&&48371>=a||48373<=a&&48399>=a||48401<=a&&48427>=a||48429<=a&&48455>=a||48457<=a&&48483>=a||48485<=a&&48511>=a||48513<=a&&48539>=a||48541<=a&&48567>=a||48569<=a&&48595>=a||48597<=a&&48623>=a||48625<=a&&48651>=a||48653<=a&&48679>=a||48681<=a&&48707>=a||48709<=a&&48735>=a||48737<=a&&48763>=a||48765<=a&&48791>=a||48793<=a&&48819>=a||48821<=a&&48847>=a||48849<=
a&&48875>=a||48877<=a&&48903>=a||48905<=a&&48931>=a||48933<=a&&48959>=a||48961<=a&&48987>=a||48989<=a&&49015>=a||49017<=a&&49043>=a||49045<=a&&49071>=a||49073<=a&&49099>=a||49101<=a&&49127>=a||49129<=a&&49155>=a||49157<=a&&49183>=a||49185<=a&&49211>=a||49213<=a&&49239>=a||49241<=a&&49267>=a||49269<=a&&49295>=a||49297<=a&&49323>=a||49325<=a&&49351>=a||49353<=a&&49379>=a||49381<=a&&49407>=a||49409<=a&&49435>=a||49437<=a&&49463>=a||49465<=a&&49491>=a||49493<=a&&49519>=a||49521<=a&&49547>=a||49549<=a&&
49575>=a||49577<=a&&49603>=a||49605<=a&&49631>=a||49633<=a&&49659>=a||49661<=a&&49687>=a||49689<=a&&49715>=a||49717<=a&&49743>=a||49745<=a&&49771>=a||49773<=a&&49799>=a||49801<=a&&49827>=a||49829<=a&&49855>=a||49857<=a&&49883>=a||49885<=a&&49911>=a||49913<=a&&49939>=a||49941<=a&&49967>=a||49969<=a&&49995>=a||49997<=a&&50023>=a||50025<=a&&50051>=a||50053<=a&&50079>=a||50081<=a&&50107>=a||50109<=a&&50135>=a||50137<=a&&50163>=a||50165<=a&&50191>=a||50193<=a&&50219>=a||50221<=a&&50247>=a||50249<=a&&50275>=
a||50277<=a&&50303>=a||50305<=a&&50331>=a||50333<=a&&50359>=a||50361<=a&&50387>=a||50389<=a&&50415>=a||50417<=a&&50443>=a||50445<=a&&50471>=a||50473<=a&&50499>=a||50501<=a&&50527>=a||50529<=a&&50555>=a||50557<=a&&50583>=a||50585<=a&&50611>=a||50613<=a&&50639>=a||50641<=a&&50667>=a||50669<=a&&50695>=a||50697<=a&&50723>=a||50725<=a&&50751>=a||50753<=a&&50779>=a||50781<=a&&50807>=a||50809<=a&&50835>=a||50837<=a&&50863>=a||50865<=a&&50891>=a||50893<=a&&50919>=a||50921<=a&&50947>=a||50949<=a&&50975>=a||
50977<=a&&51003>=a||51005<=a&&51031>=a||51033<=a&&51059>=a||51061<=a&&51087>=a||51089<=a&&51115>=a||51117<=a&&51143>=a||51145<=a&&51171>=a||51173<=a&&51199>=a||51201<=a&&51227>=a||51229<=a&&51255>=a||51257<=a&&51283>=a||51285<=a&&51311>=a||51313<=a&&51339>=a||51341<=a&&51367>=a||51369<=a&&51395>=a||51397<=a&&51423>=a||51425<=a&&51451>=a||51453<=a&&51479>=a||51481<=a&&51507>=a||51509<=a&&51535>=a||51537<=a&&51563>=a||51565<=a&&51591>=a||51593<=a&&51619>=a||51621<=a&&51647>=a||51649<=a&&51675>=a||51677<=
a&&51703>=a||51705<=a&&51731>=a||51733<=a&&51759>=a||51761<=a&&51787>=a||51789<=a&&51815>=a||51817<=a&&51843>=a||51845<=a&&51871>=a||51873<=a&&51899>=a||51901<=a&&51927>=a||51929<=a&&51955>=a||51957<=a&&51983>=a||51985<=a&&52011>=a||52013<=a&&52039>=a||52041<=a&&52067>=a||52069<=a&&52095>=a||52097<=a&&52123>=a||52125<=a&&52151>=a||52153<=a&&52179>=a||52181<=a&&52207>=a||52209<=a&&52235>=a||52237<=a&&52263>=a||52265<=a&&52291>=a||52293<=a&&52319>=a||52321<=a&&52347>=a||52349<=a&&52375>=a||52377<=a&&
52403>=a||52405<=a&&52431>=a||52433<=a&&52459>=a||52461<=a&&52487>=a||52489<=a&&52515>=a||52517<=a&&52543>=a||52545<=a&&52571>=a||52573<=a&&52599>=a||52601<=a&&52627>=a||52629<=a&&52655>=a||52657<=a&&52683>=a||52685<=a&&52711>=a||52713<=a&&52739>=a||52741<=a&&52767>=a||52769<=a&&52795>=a||52797<=a&&52823>=a||52825<=a&&52851>=a||52853<=a&&52879>=a||52881<=a&&52907>=a||52909<=a&&52935>=a||52937<=a&&52963>=a||52965<=a&&52991>=a||52993<=a&&53019>=a||53021<=a&&53047>=a||53049<=a&&53075>=a||53077<=a&&53103>=
a||53105<=a&&53131>=a||53133<=a&&53159>=a||53161<=a&&53187>=a||53189<=a&&53215>=a||53217<=a&&53243>=a||53245<=a&&53271>=a||53273<=a&&53299>=a||53301<=a&&53327>=a||53329<=a&&53355>=a||53357<=a&&53383>=a||53385<=a&&53411>=a||53413<=a&&53439>=a||53441<=a&&53467>=a||53469<=a&&53495>=a||53497<=a&&53523>=a||53525<=a&&53551>=a||53553<=a&&53579>=a||53581<=a&&53607>=a||53609<=a&&53635>=a||53637<=a&&53663>=a||53665<=a&&53691>=a||53693<=a&&53719>=a||53721<=a&&53747>=a||53749<=a&&53775>=a||53777<=a&&53803>=a||
53805<=a&&53831>=a||53833<=a&&53859>=a||53861<=a&&53887>=a||53889<=a&&53915>=a||53917<=a&&53943>=a||53945<=a&&53971>=a||53973<=a&&53999>=a||54001<=a&&54027>=a||54029<=a&&54055>=a||54057<=a&&54083>=a||54085<=a&&54111>=a||54113<=a&&54139>=a||54141<=a&&54167>=a||54169<=a&&54195>=a||54197<=a&&54223>=a||54225<=a&&54251>=a||54253<=a&&54279>=a||54281<=a&&54307>=a||54309<=a&&54335>=a||54337<=a&&54363>=a||54365<=a&&54391>=a||54393<=a&&54419>=a||54421<=a&&54447>=a||54449<=a&&54475>=a||54477<=a&&54503>=a||54505<=
a&&54531>=a||54533<=a&&54559>=a||54561<=a&&54587>=a||54589<=a&&54615>=a||54617<=a&&54643>=a||54645<=a&&54671>=a||54673<=a&&54699>=a||54701<=a&&54727>=a||54729<=a&&54755>=a||54757<=a&&54783>=a||54785<=a&&54811>=a||54813<=a&&54839>=a||54841<=a&&54867>=a||54869<=a&&54895>=a||54897<=a&&54923>=a||54925<=a&&54951>=a||54953<=a&&54979>=a||54981<=a&&55007>=a||55009<=a&&55035>=a||55037<=a&&55063>=a||55065<=a&&55091>=a||55093<=a&&55119>=a||55121<=a&&55147>=a||55149<=a&&55175>=a||55177<=a&&55203>=a?10:9757==
a||9977==a||9994<=a&&9997>=a||127877==a||127938<=a&&127940>=a||127943==a||127946<=a&&127948>=a||128066<=a&&128067>=a||128070<=a&&128080>=a||128110==a||128112<=a&&128120>=a||128124==a||128129<=a&&128131>=a||128133<=a&&128135>=a||128170==a||128372<=a&&128373>=a||128378==a||128400==a||128405<=a&&128406>=a||128581<=a&&128583>=a||128587<=a&&128591>=a||128675==a||128692<=a&&128694>=a||128704==a||128716==a||129304<=a&&129308>=a||129310<=a&&129311>=a||129318==a||129328<=a&&129337>=a||129341<=a&&129342>=a||
129489<=a&&129501>=a?13:127995<=a&&127999>=a?14:8205==a?15:9792==a||9794==a||9877<=a&&9878>=a||9992==a||10084==a||127752==a||127806==a||127859==a||127891==a||127908==a||127912==a||127979==a||127981==a||128139==a||128187<=a&&128188>=a||128295==a||128300==a||128488==a||128640==a||128658==a?16:128102<=a&&128105>=a?17:11}this.nextBreak=function(a,c){void 0===c&&(c=0);if(0>c)return 0;if(c>=a.length-1)return a.length;var b=k(h(a,c)),d=[];for(c+=1;c<a.length;c++){var e=a,g=c-1;if(!(55296<=e.charCodeAt(g)&&
56319>=e.charCodeAt(g)&&56320<=e.charCodeAt(g+1)&&57343>=e.charCodeAt(g+1))){e=k(h(a,c));if(l(b,d,e))return c;d.push(e)}}return a.length};this.splitGraphemes=function(a){for(var c=[],b=0,d;(d=this.nextBreak(a,b))<a.length;)c.push(a.slice(b,d)),b=d;b<a.length&&c.push(a.slice(b));return c};this.iterateGraphemes=function(a){var c=0,b={next:function(){var d;if((d=this.nextBreak(a,c))<a.length){var e=a.slice(c,d);c=d;return{value:e,done:!1}}return c<a.length?(e=a.slice(c),c=a.length,{value:e,done:!1}):
{value:void 0,done:!0}}.bind(this)};"undefined"!==typeof Symbol&&Symbol.iterator&&(b[Symbol.iterator]=function(){return b});return b};this.countGraphemes=function(a){for(var c=0,b=0,d;(d=this.nextBreak(a,b))<a.length;)b=d,c++;b<a.length&&c++;return c};return this}self.GraphemeSplitter=GraphemeSplitter;

}

// 3rdparty/poly-decomp.js
{
'use strict';function lineInt(l1,l2,precision){precision=precision||0;var i=[0,0];var a1,b1,c1,a2,b2,c2,det;a1=l1[1][1]-l1[0][1];b1=l1[0][0]-l1[1][0];c1=a1*l1[0][0]+b1*l1[0][1];a2=l2[1][1]-l2[0][1];b2=l2[0][0]-l2[1][0];c2=a2*l2[0][0]+b2*l2[0][1];det=a1*b2-a2*b1;if(!scalar_eq(det,0,precision)){i[0]=(b2*c1-b1*c2)/det;i[1]=(a1*c2-a2*c1)/det}return i}
function lineSegmentsIntersect(p1,p2,q1,q2){var dx=p2[0]-p1[0];var dy=p2[1]-p1[1];var da=q2[0]-q1[0];var db=q2[1]-q1[1];if(da*dy-db*dx===0)return false;var s=(dx*(q1[1]-p1[1])+dy*(p1[0]-q1[0]))/(da*dy-db*dx);var t=(da*(p1[1]-q1[1])+db*(q1[0]-p1[0]))/(db*dx-da*dy);return s>=0&&s<=1&&t>=0&&t<=1}function triangleArea(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])}function isLeft(a,b,c){return triangleArea(a,b,c)>0}function isLeftOn(a,b,c){return triangleArea(a,b,c)>=0}
function isRight(a,b,c){return triangleArea(a,b,c)<0}function isRightOn(a,b,c){return triangleArea(a,b,c)<=0}var tmpPoint1=[],tmpPoint2=[];
function collinear(a,b,c,thresholdAngle){if(!thresholdAngle)return triangleArea(a,b,c)===0;else{var ab=tmpPoint1,bc=tmpPoint2;ab[0]=b[0]-a[0];ab[1]=b[1]-a[1];bc[0]=c[0]-b[0];bc[1]=c[1]-b[1];var dot=ab[0]*bc[0]+ab[1]*bc[1],magA=Math.sqrt(ab[0]*ab[0]+ab[1]*ab[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]),angle=Math.acos(dot/(magA*magB));return angle<thresholdAngle}}function sqdist(a,b){var dx=b[0]-a[0];var dy=b[1]-a[1];return dx*dx+dy*dy}
function polygonAt(polygon,i){var s=polygon.length;return polygon[i<0?i%s+s:i%s]}function polygonClear(polygon){polygon.length=0}function polygonAppend(polygon,poly,from,to){for(var i=from;i<to;i++)polygon.push(poly[i])}
function polygonMakeCCW(polygon){var br=0,v=polygon;for(var i=1;i<polygon.length;++i)if(v[i][1]<v[br][1]||v[i][1]===v[br][1]&&v[i][0]>v[br][0])br=i;if(!isLeft(polygonAt(polygon,br-1),polygonAt(polygon,br),polygonAt(polygon,br+1))){polygonReverse(polygon);return true}else return false}function polygonReverse(polygon){var tmp=[];var N=polygon.length;for(var i=0;i!==N;i++)tmp.push(polygon.pop());for(var i=0;i!==N;i++)polygon[i]=tmp[i]}
function polygonIsReflex(polygon,i){return isRight(polygonAt(polygon,i-1),polygonAt(polygon,i),polygonAt(polygon,i+1))}var tmpLine1=[],tmpLine2=[];
function polygonCanSee(polygon,a,b){var p,dist,l1=tmpLine1,l2=tmpLine2;if(isLeftOn(polygonAt(polygon,a+1),polygonAt(polygon,a),polygonAt(polygon,b))&&isRightOn(polygonAt(polygon,a-1),polygonAt(polygon,a),polygonAt(polygon,b)))return false;dist=sqdist(polygonAt(polygon,a),polygonAt(polygon,b));for(var i=0;i!==polygon.length;++i){if((i+1)%polygon.length===a||i===a)continue;if(isLeftOn(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i+1))&&isRightOn(polygonAt(polygon,a),polygonAt(polygon,
b),polygonAt(polygon,i))){l1[0]=polygonAt(polygon,a);l1[1]=polygonAt(polygon,b);l2[0]=polygonAt(polygon,i);l2[1]=polygonAt(polygon,i+1);p=lineInt(l1,l2);if(sqdist(polygonAt(polygon,a),p)<dist)return false}}return true}
function polygonCanSee2(polygon,a,b){for(var i=0;i!==polygon.length;++i){if(i===a||i===b||(i+1)%polygon.length===a||(i+1)%polygon.length===b)continue;if(lineSegmentsIntersect(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i),polygonAt(polygon,i+1)))return false}return true}
function polygonCopy(polygon,i,j,targetPoly){var p=targetPoly||[];polygonClear(p);if(i<j)for(var k=i;k<=j;k++)p.push(polygon[k]);else{for(var k=0;k<=j;k++)p.push(polygon[k]);for(var k=i;k<polygon.length;k++)p.push(polygon[k])}return p}
function polygonGetCutEdges(polygon){var min=[],tmp1=[],tmp2=[],tmpPoly=[];var nDiags=Number.MAX_VALUE;for(var i=0;i<polygon.length;++i)if(polygonIsReflex(polygon,i))for(var j=0;j<polygon.length;++j)if(polygonCanSee(polygon,i,j)){tmp1=polygonGetCutEdges(polygonCopy(polygon,i,j,tmpPoly));tmp2=polygonGetCutEdges(polygonCopy(polygon,j,i,tmpPoly));for(var k=0;k<tmp2.length;k++)tmp1.push(tmp2[k]);if(tmp1.length<nDiags){min=tmp1;nDiags=tmp1.length;min.push([polygonAt(polygon,i),polygonAt(polygon,j)])}}return min}
function polygonDecomp(polygon){var edges=polygonGetCutEdges(polygon);if(edges.length>0)return polygonSlice(polygon,edges);else return[polygon]}
function polygonSlice(polygon,cutEdges){if(cutEdges.length===0)return[polygon];if(cutEdges instanceof Array&&cutEdges.length&&cutEdges[0]instanceof Array&&cutEdges[0].length===2&&cutEdges[0][0]instanceof Array){var polys=[polygon];for(var i=0;i<cutEdges.length;i++){var cutEdge=cutEdges[i];for(var j=0;j<polys.length;j++){var poly=polys[j];var result=polygonSlice(poly,cutEdge);if(result){polys.splice(j,1);polys.push(result[0],result[1]);break}}}return polys}else{var cutEdge=cutEdges;var i=polygon.indexOf(cutEdge[0]);
var j=polygon.indexOf(cutEdge[1]);if(i!==-1&&j!==-1)return[polygonCopy(polygon,i,j),polygonCopy(polygon,j,i)];else return false}}function polygonIsSimple(polygon){var path=polygon,i;for(i=0;i<path.length-1;i++)for(var j=0;j<i-1;j++)if(lineSegmentsIntersect(path[i],path[i+1],path[j],path[j+1]))return false;for(i=1;i<path.length-2;i++)if(lineSegmentsIntersect(path[0],path[path.length-1],path[i],path[i+1]))return false;return true}
function getIntersectionPoint(p1,p2,q1,q2,delta){delta=delta||0;var a1=p2[1]-p1[1];var b1=p1[0]-p2[0];var c1=a1*p1[0]+b1*p1[1];var a2=q2[1]-q1[1];var b2=q1[0]-q2[0];var c2=a2*q1[0]+b2*q1[1];var det=a1*b2-a2*b1;if(!scalar_eq(det,0,delta))return[(b2*c1-b1*c2)/det,(a1*c2-a2*c1)/det];else return[0,0]}
function polygonQuickDecomp(polygon,result,reflexVertices,steinerPoints,delta,maxlevel,level){maxlevel=maxlevel||100;level=level||0;delta=delta||25;result=typeof result!=="undefined"?result:[];reflexVertices=reflexVertices||[];steinerPoints=steinerPoints||[];var upperInt=[0,0],lowerInt=[0,0],p=[0,0];var upperDist=0,lowerDist=0,d=0,closestDist=0;var upperIndex=0,lowerIndex=0,closestIndex=0;var lowerPoly=[],upperPoly=[];var poly=polygon,v=polygon;if(v.length<3)return result;level++;if(level>maxlevel){console.warn("quickDecomp: max level ("+
maxlevel+") reached.");return result}for(var i=0;i<polygon.length;++i)if(polygonIsReflex(poly,i)){reflexVertices.push(poly[i]);upperDist=lowerDist=Number.MAX_VALUE;for(var j=0;j<polygon.length;++j){if(isLeft(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j))&&isRightOn(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j-1))){p=getIntersectionPoint(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j),polygonAt(poly,j-1));if(isRight(polygonAt(poly,i+1),polygonAt(poly,i),p)){d=sqdist(poly[i],
p);if(d<lowerDist){lowerDist=d;lowerInt=p;lowerIndex=j}}}if(isLeft(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j+1))&&isRightOn(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j))){p=getIntersectionPoint(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j),polygonAt(poly,j+1));if(isLeft(polygonAt(poly,i-1),polygonAt(poly,i),p)){d=sqdist(poly[i],p);if(d<upperDist){upperDist=d;upperInt=p;upperIndex=j}}}}if(lowerIndex===(upperIndex+1)%polygon.length){p[0]=(lowerInt[0]+upperInt[0])/2;
p[1]=(lowerInt[1]+upperInt[1])/2;steinerPoints.push(p);if(i<upperIndex){polygonAppend(lowerPoly,poly,i,upperIndex+1);lowerPoly.push(p);upperPoly.push(p);if(lowerIndex!==0)polygonAppend(upperPoly,poly,lowerIndex,poly.length);polygonAppend(upperPoly,poly,0,i+1)}else{if(i!==0)polygonAppend(lowerPoly,poly,i,poly.length);polygonAppend(lowerPoly,poly,0,upperIndex+1);lowerPoly.push(p);upperPoly.push(p);polygonAppend(upperPoly,poly,lowerIndex,i+1)}}else{if(lowerIndex>upperIndex)upperIndex+=polygon.length;
closestDist=Number.MAX_VALUE;if(upperIndex<lowerIndex)return result;for(var j=lowerIndex;j<=upperIndex;++j)if(isLeftOn(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j))&&isRightOn(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j))){d=sqdist(polygonAt(poly,i),polygonAt(poly,j));if(d<closestDist&&polygonCanSee2(poly,i,j)){closestDist=d;closestIndex=j%polygon.length}}if(i<closestIndex){polygonAppend(lowerPoly,poly,i,closestIndex+1);if(closestIndex!==0)polygonAppend(upperPoly,poly,closestIndex,
v.length);polygonAppend(upperPoly,poly,0,i+1)}else{if(i!==0)polygonAppend(lowerPoly,poly,i,v.length);polygonAppend(lowerPoly,poly,0,closestIndex+1);polygonAppend(upperPoly,poly,closestIndex,i+1)}}if(lowerPoly.length<upperPoly.length){polygonQuickDecomp(lowerPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);polygonQuickDecomp(upperPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level)}else{polygonQuickDecomp(upperPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);polygonQuickDecomp(lowerPoly,
result,reflexVertices,steinerPoints,delta,maxlevel,level)}return result}result.push(polygon);return result}function polygonRemoveCollinearPoints(polygon,precision){var num=0;for(var i=polygon.length-1;polygon.length>3&&i>=0;--i)if(collinear(polygonAt(polygon,i-1),polygonAt(polygon,i),polygonAt(polygon,i+1),precision)){polygon.splice(i%polygon.length,1);num++}return num}
function polygonRemoveDuplicatePoints(polygon,precision){for(var i=polygon.length-1;i>=1;--i){var pi=polygon[i];for(var j=i-1;j>=0;--j)if(points_eq(pi,polygon[j],precision)){polygon.splice(i,1);continue}}}function scalar_eq(a,b,precision){precision=precision||0;return Math.abs(a-b)<=precision}function points_eq(a,b,precision){return scalar_eq(a[0],b[0],precision)&&scalar_eq(a[1],b[1],precision)}
self.polyDecomp={decomp:polygonDecomp,quickDecomp:polygonQuickDecomp,isSimple:polygonIsSimple,removeCollinearPoints:polygonRemoveCollinearPoints,removeDuplicatePoints:polygonRemoveDuplicatePoints,makeCCW:polygonMakeCCW};

}

// lib/c3.js
{
'use strict';let isReady=false;let hasAppStarted=false;let buildMode="dev";const internalApiToken=Symbol("Construct internal API token");let internalApiTokenAccessesRemaining=14;
const C3=self.C3=class C3{constructor(){throw TypeError("static class can't be instantiated");}static _GetInternalAPIToken(){if(internalApiTokenAccessesRemaining<=0)throw new Error("cannot obtain internal API token");--internalApiTokenAccessesRemaining;return internalApiToken}static SetReady(){isReady=true}static IsReady(){return isReady}static SetAppStarted(){hasAppStarted=true}static HasAppStarted(){return hasAppStarted}static SetBuildMode(m){buildMode=m}static GetBuildMode(){return buildMode}static IsReleaseBuild(){return buildMode===
"final"}};C3.isDebug=false;C3.isDebugDefend=false;C3.hardwareConcurrency=navigator.hardwareConcurrency||2;self.C3X={};

}

// ../lib/queryParser.js
{
'use strict';const C3=self.C3;
C3.QueryParser=class QueryParser{constructor(queryString){this._queryString=queryString;this._parameters=new Map;this._Parse()}_Parse(){let str=this._queryString;if(str.startsWith("?")||str.startsWith("#"))str=str.substr(1);const arr=str.split("&");for(const p of arr)this._ParseParameter(p)}_ParseParameter(p){if(!p)return;if(!p.includes("=")){this._parameters.set(p,null);return}const i=p.indexOf("=");const parameterName=decodeURIComponent(p.substring(0,i));const parameterValue=decodeURIComponent(p.substring(i+
1));this._parameters.set(parameterName,parameterValue)}LogAll(){for(const e of this._parameters)console.log("[QueryParser] Parameter '"+e[0]+"' = "+(e[1]===null?"null":"'"+e[1]+"'"))}Has(name){return this._parameters.has(name)}Get(name){const ret=this._parameters.get(name);if(typeof ret==="undefined")return null;else return ret}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(str){this._queryString=str;this._parameters.clear();this._Parse()}};
C3.QueryString=new C3.QueryParser(location.search);C3.LocationHashString=new C3.QueryParser(location.hash);if(C3.QueryString.Has("perf"))C3.isPerformanceProfiling=true;if(C3.QueryString.Get("mode")!=="dev")C3.SetBuildMode("final");

}

// ../lib/detect/detect.js
{
'use strict';const C3=self.C3;const UNKNOWN="(unknown)";C3.Platform={OS:UNKNOWN,OSVersion:UNKNOWN,Browser:UNKNOWN,BrowserVersion:UNKNOWN,BrowserVersionNumber:NaN,BrowserEngine:UNKNOWN,Context:"browser",IsDesktop:true,IsMobile:false,IsAppleOS:false,IsIpadOS:false,GetDetailedInfo:async()=>{}};const windowsNTVerMap=new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]]);
function GetWindowsNTVersionName(ntVer){const num=parseFloat(ntVer);const ret=windowsNTVerMap.get(num);if(ret)return ret;if(num>=13)return"11";return"NT "+ntVer}const uaStr=navigator.userAgent;const uaData=navigator["userAgentData"];
if(uaData&&uaData["brands"].length>0){C3.Platform.OS=uaData["platform"];C3.Platform.IsMobile=uaData["mobile"];C3.Platform.IsDesktop=!C3.Platform.IsMobile;const RECOGNIZED_BROWSERS=new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]]);const RECOGNIZED_ENGINES=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]);function ReadBrandList(brands){let browser=
"";let browser_version="";let engine="";let engine_version="";for(const o of brands){const recognizedBrowser=RECOGNIZED_BROWSERS.get(o["brand"]);if(!browser&&recognizedBrowser){browser=recognizedBrowser;browser_version=o["version"]}const recognizedEngine=RECOGNIZED_ENGINES.get(o["brand"]);if(!engine&&recognizedEngine){engine=recognizedEngine;engine_version=o["version"]}}if(!browser&&engine==="Chromium"){C3.Platform.Browser="Chromium";C3.Platform.BrowserVersion=engine_version}C3.Platform.Browser=browser||
UNKNOWN;C3.Platform.BrowserVersion=browser_version||UNKNOWN;C3.Platform.BrowserEngine=engine||UNKNOWN}ReadBrandList(uaData["brands"]);let didGetDetailedInfo=false;C3.Platform.GetDetailedInfo=async()=>{if(didGetDetailedInfo)return;try{const details=await navigator["userAgentData"]["getHighEntropyValues"](["platformVersion","fullVersionList"]);ReadBrandList(details["fullVersionList"]);if(C3.Platform.OS==="Windows")C3.Platform.OSVersion=GetWindowsNTVersionName(details["platformVersion"]);else C3.Platform.OSVersion=
details["platformVersion"];didGetDetailedInfo=true}catch(err){console.warn("Failed to get detailed user agent information: ",err)}}}else{function RunTest(regex_or_arr,handler){const arr=Array.isArray(regex_or_arr)?regex_or_arr:[regex_or_arr];for(const regex of arr){const result=regex.exec(uaStr);if(result){handler(result);break}}}RunTest(/windows\s+nt\s+([\d\.]+)/i,result=>{C3.Platform.OS="Windows";const ntVer=result[1];C3.Platform.OSVersion=GetWindowsNTVersionName(ntVer)});RunTest(/mac\s+os\s+x\s+([\d\._]+)/i,
result=>{C3.Platform.OS="macOS";C3.Platform.OSVersion=result[1].replace(/_/g,".")});RunTest(/CrOS/,()=>{C3.Platform.OS="Chrome OS"});RunTest(/linux|openbsd|freebsd|netbsd/i,()=>{C3.Platform.OS="Linux"});RunTest(/android/i,()=>{C3.Platform.OS="Android"});RunTest(/android\s+([\d\.]+)/i,result=>{C3.Platform.OS="Android";C3.Platform.OSVersion=result[1]});if(C3.Platform.OS===UNKNOWN){RunTest(/(iphone|ipod|ipad)/i,result=>{C3.Platform.OS="iOS"});RunTest([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],
result=>{C3.Platform.OS="iOS";C3.Platform.OSVersion=result[1].replace(/_/g,".")})}const hasChrome=/chrome\//i.test(uaStr);const hasChromium=/chromium\//i.test(uaStr);const hasEdge=/edg\//i.test(uaStr);const hasOpera=/OPR\//.test(uaStr);const hasNWjs=/nwjs/i.test(uaStr);const hasSafari=/safari\//i.test(uaStr);const hasWebKit=/webkit/i.test(uaStr);if(!hasEdge&&!hasOpera)RunTest(/chrome\/([\d\.]+)/i,result=>{C3.Platform.Browser="Chrome";C3.Platform.BrowserVersion=result[1];C3.Platform.BrowserEngine=
"Chromium"});RunTest(/edg\/([\d\.]+)/i,result=>{C3.Platform.Browser="Edge";C3.Platform.BrowserVersion=result[1];C3.Platform.BrowserEngine="Chromium"});RunTest(/OPR\/([\d\.]+)/,result=>{C3.Platform.Browser="Opera";C3.Platform.BrowserVersion=result[1];C3.Platform.BrowserEngine="Chromium"});RunTest(/chromium\/([\d\.]+)/i,result=>{C3.Platform.Browser="Chromium";C3.Platform.BrowserVersion=result[1];C3.Platform.BrowserEngine="Chromium"});RunTest(/nwjs\/[0-9.]+/i,result=>{C3.Platform.Browser="NW.js";C3.Platform.BrowserVersion=
result[1];C3.Platform.BrowserEngine="Chromium";C3.Platform.Context="nwjs"});RunTest(/firefox\/([\d\.]+)/i,result=>{C3.Platform.Browser="Firefox";C3.Platform.BrowserVersion=result[1];C3.Platform.BrowserEngine="Gecko"});if(hasSafari&&!hasChrome&&!hasChromium&&!hasEdge&&!hasOpera&&!hasNWjs){C3.Platform.Browser="Safari";C3.Platform.BrowserEngine="WebKit";RunTest(/version\/([\d\.]+)/i,result=>{C3.Platform.BrowserVersion=result[1]});RunTest(/crios\/([\d\.]+)/i,result=>{C3.Platform.Browser="Chrome for iOS";
C3.Platform.BrowserVersion=result[1]});RunTest(/fxios\/([\d\.]+)/i,result=>{C3.Platform.Browser="Firefox for iOS";C3.Platform.BrowserVersion=result[1]});RunTest(/edgios\/([\d\.]+)/i,result=>{C3.Platform.Browser="Edge for iOS";C3.Platform.BrowserVersion=result[1]})}if(C3.Platform.BrowserEngine===UNKNOWN&&hasWebKit)C3.Platform.BrowserEngine="WebKit";if(C3.Platform.OS==="Android"&&C3.Platform.Browser==="Safari")C3.Platform.Browser="Stock";const desktopOSs=new Set(["Windows","macOS","Linux","Chrome OS"]);
const isDesktop=desktopOSs.has(C3.Platform.OS)||C3.Platform.Context==="nwjs";C3.Platform.IsDesktop=isDesktop;C3.Platform.IsMobile=!isDesktop}if(C3.Platform.Browser==="Chrome"&&C3.Platform.Context==="browser"&&/wv\)/.test(uaStr))C3.Platform.Context="webview";if(C3.Platform.Context!=="nwjs"&&typeof window!=="undefined"&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator["standalone"]))C3.Platform.Context="webapp";C3.Platform.BrowserVersionNumber=parseFloat(C3.Platform.BrowserVersion);
const looksLikeIPadOS=C3.Platform.OS==="macOS"&&navigator["maxTouchPoints"]&&navigator["maxTouchPoints"]>2;if(looksLikeIPadOS){C3.Platform.OS="iOS";C3.Platform.OSVersion=C3.Platform.BrowserVersion;C3.Platform.IsDesktop=false;C3.Platform.IsMobile=true;C3.Platform.IsIpadOS=true}C3.Platform.IsAppleOS=C3.Platform.OS==="macOS"||C3.Platform.OS==="iOS";

}

// ../lib/storage/kvStorage.js
{
'use strict';{const VERSION=2;const STORE_NAME="keyvaluepairs";const DATABASE_PROMISE_MAP=new Map;const SUPPORTS_GETALL=typeof IDBObjectStore!=="undefined"&&typeof IDBObjectStore.prototype.getAll==="function";const SUPPORTS_GETALLKEYS=typeof IDBObjectStore!=="undefined"&&typeof IDBObjectStore.prototype.getAllKeys==="function";function asyncifyRequest(request){return new Promise((res,rej)=>{request.onsuccess=()=>res(request.result);request.onerror=()=>rej(request.error)})}function asyncifyTransaction(tx){return new Promise((res,
rej)=>{tx.oncomplete=()=>res();tx.onerror=()=>rej(tx.error);tx.onabort=()=>rej(tx.error)})}function openReadOnlyTransaction(name,method){return openTransaction(name,method)}function openWriteTransaction(name,method){return openTransaction(name,method,true)}async function openTransaction(name,method,write=false,allowRetry=true){const db=await lazyOpenDatabase(name);try{const tx=db.transaction([STORE_NAME],write?"readwrite":"readonly");return method(tx)}catch(err){if(allowRetry&&err["name"]==="InvalidStateError"){DATABASE_PROMISE_MAP.delete(name);
return openTransaction(name,method,write,false)}else throw err;}}function lazyOpenDatabase(name){RequireString(name);let dbPromise=DATABASE_PROMISE_MAP.get(name);if(!(dbPromise instanceof Promise)){dbPromise=openDatabase(name);DATABASE_PROMISE_MAP.set(name,dbPromise);dbPromise.catch(err=>DATABASE_PROMISE_MAP.delete(name))}return dbPromise}async function openDatabase(name){RequireString(name);const openRequest=indexedDB.open(name,VERSION);openRequest.addEventListener("upgradeneeded",e=>{try{const db=
e.target.result;db.createObjectStore(STORE_NAME)}catch(err){console.error(`Failed to create objectstore for database ${name}`,err)}});return asyncifyRequest(openRequest)}function RequireString(x){if(typeof x!=="string")throw new TypeError("expected string");}function getEntriesFromCursor(tx,type){const request=tx.objectStore(STORE_NAME).openCursor();return new Promise(resolve=>{const results=[];request.onsuccess=event=>{const cursor=event.target.result;if(cursor){switch(type){case "entries":results.push([cursor.key,
cursor.value]);break;case "keys":results.push(cursor.key);break;case "values":results.push(cursor.value);break}cursor.continue()}else resolve(results)}})}class KVStorageContainer{constructor(name){RequireString(name);this.name=name}async ready(){await lazyOpenDatabase(this.name)}set(key,value){RequireString(key);return openWriteTransaction(this.name,async tx=>{const request=tx.objectStore(STORE_NAME).put(value,key);const requestPromise=asyncifyRequest(request);const txPromise=asyncifyTransaction(tx);
await Promise.all([txPromise,requestPromise])})}get(key){RequireString(key);return openReadOnlyTransaction(this.name,async tx=>{const request=tx.objectStore(STORE_NAME).get(key);const requestPromise=asyncifyRequest(request);const txPromise=asyncifyTransaction(tx);const [_,value]=await Promise.all([txPromise,requestPromise]);return value})}delete(key){RequireString(key);return openWriteTransaction(this.name,async tx=>{const request=tx.objectStore(STORE_NAME).delete(key);const requestPromise=asyncifyRequest(request);
const txPromise=asyncifyTransaction(tx);await Promise.all([txPromise,requestPromise])})}clear(){return openWriteTransaction(this.name,async tx=>{const request=tx.objectStore(STORE_NAME).clear();const requestPromise=asyncifyRequest(request);const txPromise=asyncifyTransaction(tx);await Promise.all([txPromise,requestPromise])})}keys(){return openReadOnlyTransaction(this.name,async tx=>{let requestPromise;if(SUPPORTS_GETALLKEYS){const request=tx.objectStore(STORE_NAME).getAllKeys();requestPromise=asyncifyRequest(request)}else requestPromise=
getEntriesFromCursor(tx,"keys");const txPromise=asyncifyTransaction(tx);const [_,value]=await Promise.all([txPromise,requestPromise]);return value})}values(){return openReadOnlyTransaction(this.name,async tx=>{let requestPromise;if(SUPPORTS_GETALL){const request=tx.objectStore(STORE_NAME).getAll();requestPromise=asyncifyRequest(request)}else requestPromise=getEntriesFromCursor(tx,"values");const txPromise=asyncifyTransaction(tx);const [_,value]=await Promise.all([txPromise,requestPromise]);return value})}entries(){return openReadOnlyTransaction(this.name,
async tx=>{const requestPromise=getEntriesFromCursor(tx,"entries");const txPromise=asyncifyTransaction(tx);const [_,value]=await Promise.all([txPromise,requestPromise]);return value})}}self.KVStorageContainer=KVStorageContainer};

}

// ../lib/storage/localForageAdaptor.js
{
'use strict';{const KVStorageContainer=self.KVStorageContainer;const CRITICAL_ERRORS=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i];const memoryStorage=new WeakMap;let isInMemory=false;if(typeof indexedDB==="undefined"){isInMemory=true;
console.warn("Unable to use local storage because indexedDB is not defined")}function NOT_IMPLEMENTED(name){throw new Error(`"${name}" is not implemented`);}function DISALLOW_CALLBACK(fn){if(typeof fn==="function")throw new Error(`localforage callback API is not implemented; please use the promise API instead`);}function StructuredClone(value){if(typeof value==="object")return new Promise(resolve=>{const {port1,port2}=new MessageChannel;port2.onmessage=ev=>resolve(ev.data);port1.postMessage(value)});
else return Promise.resolve(value)}class ForageAdaptor{constructor(inst){this._inst=inst;memoryStorage.set(this,new Map)}_MaybeSwitchToMemoryFallback(err){if(isInMemory)return;for(const regex of CRITICAL_ERRORS)if(err&&regex.test(err.message)){console.error("Unable to use local storage, reverting to in-memory store: ",err,err.message);isInMemory=true;break}}async _getItemFallback(name){const value=memoryStorage.get(this).get(name);const ret=await StructuredClone(value);return typeof ret==="undefined"?
null:ret}async _setItemFallback(name,value){value=await StructuredClone(value);memoryStorage.get(this).set(name,value)}_removeItemFallback(name){memoryStorage.get(this).delete(name)}_clearFallback(){memoryStorage.get(this).clear()}_keysFallback(){return Array.from(memoryStorage.get(this).keys())}IsUsingFallback(){return isInMemory}async getItem(key,successCallback){DISALLOW_CALLBACK(successCallback);if(isInMemory)return await this._getItemFallback(key);let result;try{result=await this._inst.get(key)}catch(err){this._MaybeSwitchToMemoryFallback(err);
if(isInMemory)return await this._getItemFallback(key);else{console.error(`Error reading '${key}' from storage, returning null: `,err);return null}}return typeof result==="undefined"?null:result}async setItem(key,value,successCallback){DISALLOW_CALLBACK(successCallback);if(typeof value==="undefined")value=null;if(isInMemory){await this._setItemFallback(key,value);return}try{await this._inst.set(key,value)}catch(err){this._MaybeSwitchToMemoryFallback(err);if(isInMemory)await this._setItemFallback(key,
value);else throw err;}}async removeItem(key,successCallback){DISALLOW_CALLBACK(successCallback);if(isInMemory){this._removeItemFallback(key);return}try{await this._inst.delete(key)}catch(err){this._MaybeSwitchToMemoryFallback(err);if(isInMemory)this._removeItemFallback(key);else console.error(`Error removing '${key}' from storage: `,err)}}async clear(successCallback){DISALLOW_CALLBACK(successCallback);if(isInMemory){this._clearFallback();return}try{await this._inst.clear()}catch(err){this._MaybeSwitchToMemoryFallback(err);
if(isInMemory)this._clearFallback();else console.error(`Error clearing storage: `,err)}}async keys(successCallback){DISALLOW_CALLBACK(successCallback);if(isInMemory)return this._keysFallback();let result=[];try{result=await this._inst.keys()}catch(err){this._MaybeSwitchToMemoryFallback(err);if(isInMemory)return this._keysFallback();else console.error(`Error getting storage keys: `,err)}return result}ready(successCallback){DISALLOW_CALLBACK(successCallback);if(isInMemory)return Promise.resolve(true);
else return this._inst.ready()}createInstance(options){if(typeof options!=="object")throw new TypeError("invalid options object");const name=options["name"];if(typeof name!=="string")throw new TypeError("invalid store name");const inst=new KVStorageContainer(name);return new ForageAdaptor(inst)}length(successCallback){NOT_IMPLEMENTED("localforage.length()")}key(index,successCallback){NOT_IMPLEMENTED("localforage.key()")}iterate(iteratorCallback,successCallback){NOT_IMPLEMENTED("localforage.iterate()")}setDriver(driverName){NOT_IMPLEMENTED("localforage.setDriver()")}config(options){NOT_IMPLEMENTED("localforage.config()")}defineDriver(customDriver){NOT_IMPLEMENTED("localforage.defineDriver()")}driver(){NOT_IMPLEMENTED("localforage.driver()")}supports(driverName){NOT_IMPLEMENTED("localforage.supports()")}dropInstance(){NOT_IMPLEMENTED("localforage.dropInstance()")}disableMemoryMode(){isInMemory=
false}}self["localforage"]=new ForageAdaptor(new KVStorageContainer("localforage"))};

}

// ../lib/misc/supports.js
{
'use strict';const C3=self.C3;C3.Supports={};C3.Supports.WebAnimations=(()=>{try{if(typeof document==="undefined")return false;const e=document.createElement("div");if(typeof e.animate==="undefined")return false;const player=e.animate([{opacity:"0"},{opacity:"1"}],1E3);return typeof player.reverse!=="undefined"}catch(e){return false}})();C3.Supports.DialogElement=typeof HTMLDialogElement!=="undefined";C3.Supports.RequestIdleCallback=!!self.requestIdleCallback;C3.Supports.ImageBitmap=!!self.createImageBitmap;
C3.Supports.ImageBitmapOptions=false;C3.Supports.ImageBitmapOptionsResize=false;
if(C3.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{"premultiplyAlpha":"none"}).then(()=>{C3.Supports.ImageBitmapOptions=true}).catch(()=>{C3.Supports.ImageBitmapOptions=false})}catch(err){C3.Supports.ImageBitmapOptions=false}try{self.createImageBitmap(new ImageData(32,32),{"resizeWidth":10,"resizeHeight":10}).then(imageBitmap=>{C3.Supports.ImageBitmapOptionsResize=imageBitmap.width===10&&imageBitmap.height===10}).catch(()=>{C3.Supports.ImageBitmapOptionsResize=false})}catch(err){C3.Supports.ImageBitmapOptionsResize=
false}}C3.Supports.ClipboardReadText=!!(navigator["clipboard"]&&navigator["clipboard"]["readText"]&&C3.Platform.Browser!=="Firefox");C3.Supports.PermissionsQuery=!!(navigator["permissions"]&&navigator["permissions"]["query"]);C3.Supports.ClipboardPermissionsQuery=false;if(C3.Supports.PermissionsQuery){const permission={"name":"clipboard-read"};navigator["permissions"]["query"](permission).then(()=>{C3.Supports.ClipboardPermissionsQuery=true}).catch(()=>{C3.Supports.ClipboardPermissionsQuery=false})}
C3.Supports.AsyncClipboardApi=!!(navigator["permissions"]&&navigator["clipboard"]&&self["ClipboardItem"]);C3.Supports.Proxies=typeof Proxy!=="undefined";C3.Supports.DownloadAttribute=(()=>{if(typeof document==="undefined")return false;const a=document.createElement("a");return typeof a.download!=="undefined"})();C3.Supports.Fetch=typeof fetch==="function";C3.Supports.PersistentStorage=!!(self.isSecureContext&&C3.Platform.Browser!=="Opera"&&(navigator["storage"]&&navigator["storage"]["persist"]));
C3.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&(navigator["storage"]&&navigator["storage"]["estimate"]));C3.Supports.Fullscreen=(()=>{if(typeof document==="undefined")return false;if(C3.Platform.OS==="iOS")return false;const elem=document.documentElement;return!!(elem.requestFullscreen||elem.msRequestFullscreen||elem.mozRequestFullScreen||elem.webkitRequestFullscreen)})();C3.Supports.ImageDecoder=typeof self["ImageDecoder"]!=="undefined";C3.Supports.WebCodecs=!!self["VideoEncoder"];
C3.Supports.NativeFileSystemAPI=!!self["showOpenFilePicker"];C3.Supports.QueryLocalFonts=!!self["queryLocalFonts"];C3.Supports.UserActivation=!!navigator["userActivation"];C3.Supports.CanvasToBlobWebP=false;
(async()=>{let canvas;if(typeof document==="undefined")canvas=new OffscreenCanvas(32,32);else{canvas=document.createElement("canvas");canvas.width=32;canvas.height=32}const ctx=canvas.getContext("2d");ctx.fillStyle="blue";ctx.fillRect(0,0,32,32);let blob=null;try{if(canvas["convertToBlob"])blob=await canvas["convertToBlob"]({"type":"image/webp","quality":1});else if(canvas.toBlob)blob=await new Promise(resolve=>canvas.toBlob(resolve,"image/webp",1));C3.Supports.CanvasToBlobWebP=blob&&blob.type===
"image/webp"}catch(err){C3.Supports.CanvasToBlobWebP=false}})();

}

// ../lib/misc/polyfills.js
{
'use strict';const C3=self.C3;if(!String.prototype.trimStart){const startWhitespace=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function trimStart(){return this.replace(startWhitespace,"")}}
if(!String.prototype.trimEnd){const endWhitespace=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function trimEnd(){return this.replace(endWhitespace,"")}}if(!String.prototype.replaceAll)String.prototype.replaceAll=function replaceAll(find,replace){return this.replace(new RegExp(C3.EscapeRegex(find),"g"),replace)};if(!Array.prototype.values)Array.prototype.values=function*(){for(const i of this)yield i};
if(!Array.prototype.flat){function arrayFlat(arr,depth){return arr.reduce((acc,val)=>{if(depth>0&&Array.isArray(val)){Array.prototype.push.apply(acc,arrayFlat(val,depth-1));return acc}else{acc.push(val);return acc}},[])}Array.prototype.flat=function(depth=1){return arrayFlat(this,depth)}}if(!Array.prototype.at)Array.prototype.at=function at(n){n=Math.trunc(n)||0;if(n<0)n+=this.length;if(n<0||n>=this.length)return undefined;return this[n]};
if(!String.prototype.at)String.prototype.at=function at(n){n=Math.trunc(n)||0;if(n<0)n+=this.length;if(n<0||n>=this.length)return undefined;return this[n]};if(!RegExp.escape)RegExp.escape=function(s){return String(s).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")};
if(navigator["storage"]&&!navigator["storage"]["estimate"]&&navigator["webkitTemporaryStorage"]&&navigator["webkitTemporaryStorage"]["queryUsageAndQuota"])navigator["storage"]["estimate"]=function(){return new Promise((resolve,reject)=>{return navigator["webkitTemporaryStorage"]["queryUsageAndQuota"]((usage,quota)=>resolve({"usage":usage,"quota":quota}),reject)})};if(typeof self.isSecureContext==="undefined")self.isSecureContext=location.protocol==="https:";
if(typeof self["globalThis"]==="undefined")self["globalThis"]=self;

}

// lib/misc/assert.js
{
'use strict';const C3=self.C3;function assertFail(msg_){let stack=C3.GetCallStack();let msg="Assertion failure: "+msg_+"\n\nStack trace:\n"+stack;console.error(msg)}self.assert=function assert(cnd_,msg_){if(!cnd_)assertFail(msg_)};

}

// ../lib/misc/typeChecks.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;C3.IsNumber=function IsNumber(x){return typeof x==="number"};C3.IsFiniteNumber=function IsFiniteNumber(x){return C3.IsNumber(x)&&isFinite(x)};C3.RequireNumber=function RequireNumber(x){if(!C3.IsNumber(x))throw new TypeError("expected number");};C3.RequireOptionalNumber=function RequireOptionalNumber(x){if(C3.IsNullOrUndefined(x))return};
C3.RequireNumberInRange=function RequireNumberInRange(x,low,high){if(!C3.IsNumber(x)||isNaN(x)||low>x||high<x)throw new RangeError("number outside of range");};C3.RequireAllNumber=function RequireAllNumber(...args){for(let a of args);};C3.RequireFiniteNumber=function RequireFiniteNumber(x){if(!C3.IsFiniteNumber(x))throw new TypeError("expected finite number");};C3.RequireOptionalFiniteNumber=function RequireOptionalFiniteNumber(x){if(C3.IsNullOrUndefined(x))return};
C3.RequireAllFiniteNumber=function RequireAllFiniteNumber(...args){for(let a of args);};C3.IsString=function IsString(x){return typeof x==="string"};C3.RequireString=function RequireString(x){if(!C3.IsString(x))throw new TypeError("expected string");};C3.RequireOptionalString=function RequireOptionalString(x){if(C3.IsNullOrUndefined(x))return};C3.RequireAllString=function RequireAllString(...args){for(let a of args);};
C3.IsSimpleObject=function IsSimpleObject(x){if(typeof x!=="object"||x===null)return false;let proto=Object.getPrototypeOf(x);return proto?proto.constructor===Object:proto===null};C3.RequireSimpleObject=function RequireSimpleObject(x){if(!C3.IsSimpleObject(x))throw new TypeError("expected simple object");};C3.RequireOptionalSimpleObject=function RequireSimpleObject(x){if(C3.IsNullOrUndefined(x))return;if(!C3.IsSimpleObject(x))throw new TypeError("expected simple object");};
C3.IsObject=function IsObject(x){return typeof x==="object"&&x!==null&&!Array.isArray(x)};C3.RequireObject=function RequireObject(x){if(!C3.IsObject(x))throw new TypeError("expected object");};C3.RequireOptionalObject=function RequireOptionalObject(x){if(C3.IsNullOrUndefined(x))return};C3.RequireAllObject=function RequireAllObject(...args){for(let a of args);};C3.IsFileLike=function IsFileLike(x){return C3.WeakIsInstanceOf(x,Blob)&&typeof x["name"]==="string"};
C3.RequireFileLike=function RequireFileLike(x){if(!C3.IsFileLike(x))throw new TypeError("expected file");};C3.RequireOptionalFileLike=function RequireOptionalFileLike(x){if(C3.IsNullOrUndefined(x))return};C3.IsArray=function IsArray(x){return Array.isArray(x)};C3.RequireArray=function RequireArray(x){if(!C3.IsArray(x))throw new TypeError("expected array");};C3.RequireOptionalArray=function RequireOptionalArray(x){if(C3.IsNullOrUndefined(x))return};
C3.RequireAllArray=function RequireAllArray(...args){for(let a of args);};C3.Is2DArray=function(x){if(!C3.IsArray(x))return false;if(!x.length)return true;if(!C3.IsArray(x[0]))return false;return true};C3.Require2DArray=function Require2DArray(x){if(!C3.Is2DArray(x))throw new TypeError("expected 2d array");for(let arr of x)if(!C3.IsArray(arr))throw new TypeError("expected 2d array");};C3.RequireOptional2DArray=function Require2DArray(x){if(C3.IsNullOrUndefined(x))return};
C3.IsFunction=function IsFunction(x){return typeof x==="function"};C3.RequireFunction=function RequireFunction(x,f){if(!C3.IsFunction(x))throw new TypeError("expected function");if(!C3.IsNullOrUndefined(f))if(x!==f)throw new TypeError("expected same function reference");};C3.RequireOptionalFunction=function RequireOptionalFunction(x){if(C3.IsNullOrUndefined(x))return};C3.RequireAllFunction=function RequireAllFunction(...args){for(let a of args);};
C3.RequireAnyFunction=function RequireAllFunction(x,...args){if(!C3.IsFunction(x))throw new TypeError("expected function");if(!args.length)throw new Error("missing comparison functions");for(let a of args)if(!C3.IsNullOrUndefined(a))if(x===a)return;throw new TypeError("expected same function reference");};C3.RequireOptionalAllFunction=function RequireAllFunction(...args){if(C3.IsNullOrUndefined(args))return;for(let a of args);};C3.IsInstanceOf=function IsInstanceOf(x,t){return x instanceof t};
C3.IsInstanceOfAny=function IsInstanceOfAny(x,...args){for(let t of args)if(C3.IsInstanceOf(x,t))return true;return false};C3.RequireInstanceOf=function RequireInstanceOf(x,t){if(!C3.IsInstanceOf(x,t))throw new TypeError("unexpected type");};C3.RequireOptionalInstanceOf=function RequireOptionalInstanceOf(x,t){if(C3.IsNullOrUndefined(x))return};C3.RequireAllInstanceOf=function RequireAllInstanceOf(t,...args){for(let a of args);};
C3.RequireAnyInstanceOf=function RequireAnyInstanceOf(x,...args){if(!C3.IsInstanceOfAny(x,...args))throw new TypeError("unexpected type");};C3.RequireAnyOptionalInstanceOf=function RequireAnyOptionalInstanceOf(x,...args){if(C3.IsNullOrUndefined(x))return;if(!C3.IsInstanceOfAny(x,...args))throw new TypeError("unexpected type");};C3.IsArrayOf=function IsArrayOf(x,t){for(let i of x)if(!C3.IsInstanceOf(i,t))return false;return true};
C3.IsArrayOfFiniteNumbers=function IsArrayOfFiniteNumbers(x){for(let i of x)if(!C3.IsFiniteNumber(i))return false;return true};C3.RequireArrayOf=function RequireArrayOf(x,t){for(let i of x);};C3.RequireOptionalArrayOf=function RequireOptionalArrayOf(x,t){if(C3.IsNullOrUndefined(x))return;for(let i of x);};C3.RequireArrayOfAny=function RequireArrayOf(x,...args){for(let i of x);};
C3.RequireOptionalArrayOfAny=function RequireOptionalArrayOfAny(x,...args){if(C3.IsNullOrUndefined(x))return;for(let i of x);};C3.IsDOMNode=function IsDOMNode(d,n){if(C3.IsNullOrUndefined(d)||!C3.IsString(d.nodeName))return false;return!n||C3.equalsNoCase(d.nodeName,n)};C3.RequireDOMNode=function RequireDOMNode(d,n){if(C3.IsNullOrUndefined(d)||!C3.IsString(d.nodeName))throw new TypeError("expected DOM node");if(n&&!C3.equalsNoCase(d.nodeName,n))throw new TypeError(`expected DOM '${n}' node`);};
C3.RequireOptionalDOMNode=function RequireOptionalDOMNode(d,n){if(C3.IsNullOrUndefined(d))return};C3.IsHTMLElement=function IsHTMLElement(e,t){if(C3.IsNullOrUndefined(e)||!C3.IsString(e.tagName))return false;return!t||C3.equalsNoCase(e.tagName,t)};C3.RequireHTMLElement=function RequireHTMLElement(e,t){if(C3.IsNullOrUndefined(e)||!C3.IsString(e.tagName))throw new TypeError("expected HTML element");if(t&&!C3.equalsNoCase(e.tagName,t))throw new TypeError(`expected HTML '${t}' element`);};
C3.RequireOptionalHTMLElement=function RequireOptionalHTMLElement(e,t){if(C3.IsNullOrUndefined(e))return};C3.IsDrawable=function IsDrawable(d){return C3.IsHTMLElement(d,"img")||C3.IsHTMLElement(d,"canvas")||C3.IsHTMLElement(d,"video")||typeof OffscreenCanvas!=="undefined"&&d instanceof OffscreenCanvas||typeof ImageBitmap!=="undefined"&&d instanceof ImageBitmap};C3.RequireDrawable=function RequireDrawable(d){if(!C3.IsDrawable(d))throw new TypeError("expected drawable");};
C3.RequireOptionalDrawable=function RequireOptionalDrawable(d){if(C3.IsNullOrUndefined(d))return};C3.IsDrawableOrImageData=function IsDrawableOrImageData(x){if(x instanceof ImageData)return true;return C3.IsDrawable(x)};C3.RequireDrawableOrImageData=function RequireDrawableOrImageData(d){if(!C3.IsDrawableOrImageData(d))throw new TypeError("expected drawable or image data");};
C3.RequireOptionalDrawableOrImageData=function RequireOptionalDrawableOrImageData(d){if(C3.IsNullOrUndefined(d))return;if(!C3.IsDrawableOrImageData(d))throw new TypeError("expected drawable or image data");};C3.IsStringLike=function IsStringLike(x){return typeof x==="string"||C3.HtmlString&&x instanceof C3.HtmlString||x instanceof C3.BBString};C3.RequireStringLike=function RequireStringLike(x){if(!C3.IsStringLike(x))throw new TypeError("expected string-like");};C3.RequireOptionalStringLike=function RequireOptionalStringLike(x){if(C3.IsNullOrUndefined(x))return};
C3.RequireAllStringLike=function RequireAllStringLike(...args){for(let a of args);};C3.RequireOverride=function RequireOverride(){throw new Error("must be overridden");};C3.NotYetImplemented=function NotYetImplemented(){throw new Error("not yet implemented");};C3.IsDefined=function isDefined(obj,...follow){let currentObject=obj;if(typeof currentObject==="undefined")return false;for(let key of follow){if(typeof currentObject[key]==="undefined")return false;currentObject=currentObject[key]}return true};
C3.IsNullOrUndefined=function(x){return typeof x==="undefined"||x===null};C3.AreArrayElementsOfSameType=function(arr){let type=arr[0].constructor;for(let x of arr)if(x.constructor!==type)return false;return type};C3.AreArrayElementsOfType=function(arr,t){for(let x of arr)if(!(x instanceof t))return false;return true};const TypedArray=Object.getPrototypeOf(Uint8Array);C3.IsTypedArray=function(view){return C3.IsInstanceOf(view,TypedArray)};C3.RequireTypedArray=function(view){};
C3.WeakRequireTypedArray=function WeakRequireTypedArray(inst){C3.WeakRequireInstanceOf(inst,TypedArray)};C3.WeakRequireAnyInstanceOf=function WeakRequireAnyInstanceOf(inst,...ctors){if(!C3.WeakIsAnyInstanceOf(inst,...ctors))throw new TypeError("unexpected type");};C3.WeakIsAnyInstanceOf=function WeakIsAnyInstanceOf(inst,...ctors){for(const ctor of ctors)if(C3.WeakIsInstanceOf(inst,ctor))return true;return false};
C3.WeakRequireInstanceOf=function WeakRequireInstanceOf(inst,ctor){if(!C3.WeakIsInstanceOf(inst,ctor))throw new TypeError("unexpected type");};C3.WeakIsInstanceOf=function WeakIsInstanceOf(inst,ctor){while(inst=Object.getPrototypeOf(inst))if(inst.constructor.name===ctor.name)return true;return false};C3X.RequireNumber=C3.RequireNumber;C3X.RequireOptionalNumber=C3.RequireOptionalNumber;C3X.RequireFiniteNumber=C3.RequireFiniteNumber;C3X.RequireOptionalFiniteNumber=C3.RequireOptionalFiniteNumber;
C3X.RequireString=C3.RequireString;C3X.RequireOptionalString=C3.RequireOptionalString;C3X.RequireObject=C3.RequireObject;C3X.RequireOptionalObject=C3.RequireOptionalObject;C3X.RequireArray=C3.RequireArray;C3X.RequireOptionalArray=C3.RequireOptionalArray;C3X.RequireFunction=C3.RequireFunction;C3X.RequireOptionalFunction=C3.RequireOptionalFunction;C3X.RequireInstanceOf=C3.RequireInstanceOf;C3X.RequireOptionalInstanceOf=C3.RequireOptionalInstanceOf;C3X.IsNullOrUndefined=C3.IsNullOrUndefined;

}

// ../lib/misc/jsutil.js
{
'use strict';const C3=self.C3;const logRafIds=new Map;C3.ColorLog=function(message,color){console.log(`%c${message}`,`font-weight: bold; color:${color}`)};C3.RafLog=function RaFLog(name,...args){if(!logRafIds.has(name))logRafIds.set(name,-1);if(logRafIds.get(name)===-1)logRafIds.set(name,requestAnimationFrame(()=>{console.log(`%c${name}`,"font-weight: bold",...args);logRafIds.set(name,-1)}))};let measures;
C3.StartMeasure=function StartMeasure(name){performance.mark(name);if(!measures)measures=new Map;if(!measures.has(name))measures.set(name,{current:0,total:0,average:0,calls:1,toString:function(){return`${name} :: current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => ${this.calls}`}})};
C3.EndMeasure=function EndMeasure(name){performance.measure(`measure-${name}`,name);const entry=performance.getEntriesByName(`measure-${name}`)[0];const m=measures.get(name);m.current=entry.duration;m.total+=m.current;m.average=m.total/m.calls;console.log(m.toString());m.calls++;performance.clearMarks(name);performance.clearMeasures(`measure-${name}`)};C3.GetCallStack=function GetCallStack(){return(new Error).stack};C3.Debugger=function Debugger(){debugger};
C3.cast=function cast(o,T){if(o&&o instanceof T)return o;else return null};
C3.getName=function getName(o){if(typeof o==="undefined")return"undefined";if(o===null)return"null";if(typeof o==="boolean")return"<boolean>";if(C3.IsNumber(o))return"<number>";if(C3.IsString(o))return"<string>";if(C3.IsArray(o))return"<array>";if(typeof o==="symbol")return"<"+o.toString()+">";if(C3.IsFunction(o)){if(o.name&&o.name!=="Function")return o.name;return"<anonymous function>"}if(typeof o==="object"){if(o.constructor&&o.constructor.name&&o.constructor.name!=="Object")return o.constructor.name;
return"<anonymous object>"}return"<unknown>"};C3.getType=function getType(o){if(o===null)return"null";if(Array.isArray(o))return"array";return typeof o};C3.range=function*range(a,b){if(!isFinite(Math.abs(a-b)))throw new Error("Invalid parameters");if(a>b)for(let i=a-1;i>=b;i--)yield i;else for(let i=a;i<b;i++)yield i};
function isValidTypeChange(from,to){let fromType=C3.getType(from);let toType=C3.getType(to);if(fromType==="null"||toType==="null")return true;if(fromType==="undefined"||toType==="undefined")return false;return fromType===toType}let ctorObjectToProxy=new Map;let ctorProxyToObject=new Map;let proxyToObject=new WeakMap;let releasedObjects=new WeakMap;C3.DefendHandler={};const VALID_GET_MISSING_KEYS=new Set(["then","splice"]);
function logDefendedObjectWarning(msg){console.warn("[Defence] "+msg+" @",C3.GetCallStack())}
C3.DefendHandler.get=function defended_get(target,key){if(!(key in target)&&typeof key!=="symbol"&&!VALID_GET_MISSING_KEYS.has(key))logDefendedObjectWarning(`Accessed missing property '${key}' from defended object '${C3.getName(target)}', returning undefined`);if(releasedObjects.has(target)&&typeof key!=="symbol"&&!VALID_GET_MISSING_KEYS.has(key))logDefendedObjectWarning(`Accessed property '${key}' on a released object '${C3.getName(target)}'\nObject was originally released at: ${releasedObjects.get(target)})\nCall stack at access: `);return target[key]};
C3.DefendHandler.set=function defended_set(target,key,value){if(!(key in target)&&!ctorObjectToProxy.has(target))logDefendedObjectWarning(`Set non-existent property '${key}' to '${value}' on defended object '${C3.getName(target)}'`);if(!isValidTypeChange(target[key],value)&&!ctorObjectToProxy.has(target))logDefendedObjectWarning(`Set '${C3.getType(target[key])}' property '${key}' to type '${C3.getType(value)}' on defended object '${C3.getName(target)}'`);if(releasedObjects.has(target))logDefendedObjectWarning(`Set property '${key}' on a released object '${C3.getName(target)}'\nObject was originally released at: ${releasedObjects.get(target)})\nCall stack at access: `);
target[key]=value;return true};C3.DefendHandler.deleteProperty=function defended_deleteProperty(target,key){throw new ReferenceError(`Cannot delete property '${key}' from defended object '${C3.getName(target)}'`);};C3.DefendHandler.defineProperty=function defended_defineProperty(target,key,desc){throw new ReferenceError(`Cannot define property '${key}' on defended object '${C3.getName(target)}'`);};
C3.DefendHandler.enumerate=function defended_enumerate(target){throw new ReferenceError(`Cannot enumerate defended object '${C3.getName(target)}'`);};let checkRafId=-1;
function CheckDefendedObjectsUsedCorrectly(){checkRafId=-1;if(ctorObjectToProxy.size>0||ctorProxyToObject.size>0){let uniqueNames=new Set([...ctorObjectToProxy.keys()].map(o=>C3.getName(o)));let leftoverNames=[...uniqueNames].join(",");console.warn(`An object derived from DefendedBase was not protected with debugDefend(). This will disable some checks. See the coding guidelines! Possible affected class names: ${leftoverNames}`);ctorObjectToProxy.clear();ctorProxyToObject.clear()}}
C3.DefendedBase=class DefendedBase{constructor(){if(!C3.isDebugDefend||!C3.Supports.Proxies)return;let newTarget=new.target;let realObject=Object.create(newTarget.prototype);let proxy=new Proxy(realObject,C3.DefendHandler);ctorObjectToProxy.set(realObject,proxy);ctorProxyToObject.set(proxy,realObject);proxyToObject.set(proxy,realObject);if(checkRafId===-1)checkRafId=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly);return proxy}};
C3.debugDefend=function debugDefend(o){if(C3.isDebugDefend&&C3.Supports.Proxies&&o instanceof C3.DefendedBase){if(!ctorProxyToObject.has(o))return o;let realObject=ctorProxyToObject.get(o);ctorProxyToObject.delete(o);ctorObjectToProxy.delete(realObject);return o}else if(C3.isDebug)return Object.seal(o);else return o};
C3.New=function New(Type,...args){let o;try{o=new Type(...args)}catch(e){ctorProxyToObject.clear();ctorObjectToProxy.clear();throw e;}if(C3.isDebugDefend)VerifyObjectPropertiesConsistent(Type,o);return C3.debugDefend(o)};C3.Release=function Release(o){let realObject=proxyToObject.get(o);if(realObject)releasedObjects.set(realObject,C3.GetCallStack())};C3.WasReleased=function(o){let realObject=proxyToObject.get(o);if(!realObject)return false;return!!releasedObjects.get(realObject)};
let typeProperties=new Map;function getObjectPropertySet(o){let ret=new Set;for(let k in o)ret.add(k);return ret}
function VerifyObjectPropertiesConsistent(Type,o){let properties=getObjectPropertySet(o);let existingProperties=typeProperties.get(Type);if(existingProperties){let inconsistentProperties=[];for(let k of existingProperties.values())if(properties.has(k))properties.delete(k);else inconsistentProperties.push(k);C3.appendArray(inconsistentProperties,[...properties]);if(inconsistentProperties.length)console.warn(`[Defence] '${C3.getName(Type)}' constructor creates inconsistent properties: ${inconsistentProperties.join(", ")}`)}else typeProperties.set(Type,properties)}
C3.PerfMark=class PerfMark{constructor(name){this._name="";if(name)this.start(name)}start(name){if(!C3.isPerformanceProfiling)return;this._name=name;performance.mark(this._name+"-Start")}end(){if(!C3.isPerformanceProfiling)return;performance.mark(this._name+"-End");performance.measure(this._name,this._name+"-Start",this._name+"-End")}next(name){if(!C3.isPerformanceProfiling)return;this.end();this._name=name;performance.mark(this._name+"-Start")}};

}

// ../lib/misc/mathutil.js
{
'use strict';const C3=self.C3;const TWO_PI=Math.PI*2;const D_TO_R=Math.PI/180;const R_TO_D=180/Math.PI;C3.wrap=function wrap(x,min,max){x=Math.floor(x);min=Math.floor(min);max=Math.floor(max);const diff=max-min;if(diff===0)return max;if(x<min){const r=max-(min-x)%diff;return r===max?0:r}else return min+(x-min)%diff};
C3.mapToRange=function mapToRange(x,inMin,inMax,outMin,outMax){const inDelta=inMax-inMin;if(inDelta===0&&outMin===0)return x;const outDelta=outMax-outMin;return(x-inMin)*outDelta/inDelta+outMin};C3.normalize=function normalize(value,minimum,maximum){if(minimum-maximum===0)return 1;return(value-minimum)/(maximum-minimum)};C3.clamp=function clamp(x,a,b){if(x<a)return a;else if(x>b)return b;else return x};C3.clampAngle=function clampAngle(a){a%=TWO_PI;if(a<0)a+=TWO_PI;return a};
C3.toRadians=function toRadians(x){return x*D_TO_R};C3.toDegrees=function toDegrees(x){return x*R_TO_D};C3.distanceTo=function distanceTo(x1,y1,x2,y2){return Math.hypot(x2-x1,y2-y1)};C3.distanceSquared=function distanceSquared(x1,y1,x2,y2){const dx=x2-x1;const dy=y2-y1;return dx*dx+dy*dy};C3.angleTo=function angleTo(x1,y1,x2,y2){return Math.atan2(y2-y1,x2-x1)};
C3.angleDiff=function angleDiff(a1,a2){if(a1===a2)return 0;let s1=Math.sin(a1);let c1=Math.cos(a1);let s2=Math.sin(a2);let c2=Math.cos(a2);let n=s1*s2+c1*c2;if(n>=1)return 0;if(n<=-1)return Math.PI;return Math.acos(n)};C3.angleRotate=function angleRotate(start,end,step){let ss=Math.sin(start);let cs=Math.cos(start);let se=Math.sin(end);let ce=Math.cos(end);if(Math.acos(ss*se+cs*ce)>step)if(cs*se-ss*ce>0)return C3.clampAngle(start+step);else return C3.clampAngle(start-step);else return C3.clampAngle(end)};
C3.angleClockwise=function angleClockwise(a1,a2){let s1=Math.sin(a1);let c1=Math.cos(a1);let s2=Math.sin(a2);let c2=Math.cos(a2);return c1*s2-s1*c2<=0};C3.angleLerp=function angleLerp(a,b,x,r=0){let diff=C3.angleDiff(a,b);const revs=TWO_PI*r;if(C3.angleClockwise(b,a))return C3.clampAngle(a+(diff+revs)*x);else return C3.clampAngle(a-(diff+revs)*x)};
C3.angleLerpClockwise=function angleLerpClockwise(a,b,x,r=0){const diff=C3.angleDiff(a,b);const revs=TWO_PI*r;if(C3.angleClockwise(b,a))return C3.clampAngle(a+(diff+revs)*x);return C3.clampAngle(a+(TWO_PI-diff+revs)*x)};C3.angleLerpAntiClockwise=function angleLerpAntiClockwise(a,b,x,r=0){const diff=C3.angleDiff(a,b);const revs=TWO_PI*r;if(C3.angleClockwise(b,a))return C3.clampAngle(a-(-TWO_PI+diff-revs)*x);return C3.clampAngle(a-(diff+revs)*x)};
C3.angleReflect=function angleReflect(a,b){const diff=C3.angleDiff(a,b);if(C3.angleClockwise(a,b))return C3.clampAngle(b-diff);else return C3.clampAngle(b+diff)};C3.lerp=function lerp(a,b,x){return a+x*(b-a)};C3.unlerp=function unlerp(a,b,x){if(a===b)return 0;return(x-a)/(b-a)};C3.relerp=function relerp(a,b,x,c,d){return C3.lerp(c,d,C3.unlerp(a,b,x))};C3.qarp=function qarp(a,b,c,x){return C3.lerp(C3.lerp(a,b,x),C3.lerp(b,c,x),x)};
C3.cubic=function cubic(a,b,c,d,x){return C3.lerp(C3.qarp(a,b,c,x),C3.qarp(b,c,d,x),x)};C3.cosp=function cosp(a,b,x){return(a+b+(a-b)*Math.cos(x*Math.PI))/2};C3.isPOT=function isPOT(x){return x>0&&(x-1&x)===0};C3.nextHighestPowerOfTwo=function nextHighestPowerOfTwo(x){--x;for(let i=1;i<32;i<<=1)x=x|x>>i;return x+1};C3.roundToNearestFraction=function roundToNearestFraction(x,n){return Math.round(x*n)/n};C3.floorToNearestFraction=function floorToNearestFraction(x,n){return Math.floor(x*n)/n};
C3.roundToDp=function roundToDp(x,dp){dp=Math.max(Math.floor(dp),0);const m=Math.pow(10,dp);return Math.round(x*m)/m};C3.countDecimals=function countDecimals(value){if(Math.floor(value)!==value)return value.toString().split(".")[1].length||0;return 0};C3.toFixed=function toFixed(n,dp){let ret=n.toFixed(dp);let last=ret.length-1;for(;last>=0&&ret.charAt(last)==="0";--last);if(last>=0&&ret.charAt(last)===".")--last;if(last<0)return ret;return ret.substr(0,last+1)};
C3.PackRGB=function PackRGB(red,green,blue){return C3.clamp(red,0,255)|C3.clamp(green,0,255)<<8|C3.clamp(blue,0,255)<<16};const ALPHAEX_SHIFT=1024;const ALPHAEX_MAX=1023;const RGBEX_SHIFT=16384;const RGBEX_MAX=8191;const RGBEX_MIN=-8192;
C3.PackRGBAEx=function PackRGBAEx(red,green,blue,alpha){red=C3.clamp(Math.floor(red*1024),RGBEX_MIN,RGBEX_MAX);green=C3.clamp(Math.floor(green*1024),RGBEX_MIN,RGBEX_MAX);blue=C3.clamp(Math.floor(blue*1024),RGBEX_MIN,RGBEX_MAX);alpha=C3.clamp(Math.floor(alpha*ALPHAEX_MAX),0,ALPHAEX_MAX);if(red<0)red+=RGBEX_SHIFT;if(green<0)green+=RGBEX_SHIFT;if(blue<0)blue+=RGBEX_SHIFT;return-(red*RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT+green*RGBEX_SHIFT*ALPHAEX_SHIFT+blue*ALPHAEX_SHIFT+alpha)};
C3.PackRGBEx=function PackRGBEx(red,green,blue){return C3.PackRGBAEx(red,green,blue,1)};function isNegativeZero(x){return x===0&&1/x<0}C3.GetRValue=function GetRValue(rgb){if(rgb>=0)return(rgb&255)/255;else{let v=Math.floor(-rgb/(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT));if(v>RGBEX_MAX)v-=RGBEX_SHIFT;return v/1024}};
C3.GetGValue=function GetGValue(rgb){if(rgb>=0)return((rgb&65280)>>8)/255;else{let v=Math.floor(-rgb%(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT)/(RGBEX_SHIFT*ALPHAEX_SHIFT));if(v>RGBEX_MAX)v-=RGBEX_SHIFT;return v/1024}};C3.GetBValue=function GetBValue(rgb){if(rgb>=0)return((rgb&16711680)>>16)/255;else{let v=Math.floor(-rgb%(RGBEX_SHIFT*ALPHAEX_SHIFT)/ALPHAEX_SHIFT);if(v>RGBEX_MAX)v-=RGBEX_SHIFT;return v/1024}};
C3.GetAValue=function GetAValue(rgb){if(isNegativeZero(rgb))return 0;else if(rgb>=0)return 1;else{const v=Math.floor(-rgb%ALPHAEX_SHIFT);return v/ALPHAEX_MAX}};C3.greatestCommonDivisor=function greatestCommonDivisor(a,b){a=Math.floor(a);b=Math.floor(b);while(b!==0){let t=b;b=a%b;a=t}return a};const COMMON_ASPECT_RATIOS=[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]];
C3.getAspectRatio=function getAspectRatio(w,h){w=Math.floor(w);h=Math.floor(h);if(w===h)return[1,1];for(let aspect of COMMON_ASPECT_RATIOS){let approxH=w/aspect[0]*aspect[1];if(Math.abs(h-approxH)<1)return aspect.slice(0);approxH=w/aspect[1]*aspect[0];if(Math.abs(h-approxH)<1)return[aspect[1],aspect[0]]}let gcd=C3.greatestCommonDivisor(w,h);return[w/gcd,h/gcd]};
C3.segmentsIntersect=function segmentsIntersect(a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y){const min_ax=Math.min(a1x,a2x);const max_ax=Math.max(a1x,a2x);const min_bx=Math.min(b1x,b2x);const max_bx=Math.max(b1x,b2x);if(max_ax<min_bx||min_ax>max_bx)return false;const min_ay=Math.min(a1y,a2y);const max_ay=Math.max(a1y,a2y);const min_by=Math.min(b1y,b2y);const max_by=Math.max(b1y,b2y);if(max_ay<min_by||min_ay>max_by)return false;const dpx=b1x-a1x+b2x-a2x;const dpy=b1y-a1y+b2y-a2y;const qax=a2x-a1x;const qay=a2y-
a1y;const qbx=b2x-b1x;const qby=b2y-b1y;const d=Math.abs(qay*qbx-qby*qax);const la=qbx*dpy-qby*dpx;if(Math.abs(la)>d)return false;const lb=qax*dpy-qay*dpx;return Math.abs(lb)<=d};
C3.segmentsIntersectPreCalc=function segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,min_ax,max_ax,min_ay,max_ay,b1x,b1y,b2x,b2y){const min_bx=Math.min(b1x,b2x);const max_bx=Math.max(b1x,b2x);if(max_ax<min_bx||min_ax>max_bx)return false;const min_by=Math.min(b1y,b2y);const max_by=Math.max(b1y,b2y);if(max_ay<min_by||min_ay>max_by)return false;const dpx=b1x-a1x+b2x-a2x;const dpy=b1y-a1y+b2y-a2y;const qax=a2x-a1x;const qay=a2y-a1y;const qbx=b2x-b1x;const qby=b2y-b1y;const d=Math.abs(qay*qbx-qby*qax);const la=
qbx*dpy-qby*dpx;if(Math.abs(la)>d)return false;const lb=qax*dpy-qay*dpx;return Math.abs(lb)<=d};
C3.segmentIntersectsQuad=function segmentIntersectsQuad(x1,y1,x2,y2,q){const min_x=Math.min(x1,x2);const max_x=Math.max(x1,x2);const min_y=Math.min(y1,y2);const max_y=Math.max(y1,y2);const tlx=q.getTlx(),tly=q.getTly(),trx=q.getTrx(),try_=q.getTry(),brx=q.getBrx(),bry=q.getBry(),blx=q.getBlx(),bly=q.getBly();return C3.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,tlx,tly,trx,try_)||C3.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,trx,try_,brx,bry)||C3.segmentsIntersectPreCalc(x1,
y1,x2,y2,min_x,max_x,min_y,max_y,brx,bry,blx,bly)||C3.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,blx,bly,tlx,tly)};
C3.segmentIntersectsAnyN=function segmentIntersectsAnyN(x1,y1,x2,y2,points){const min_x=Math.min(x1,x2);const max_x=Math.max(x1,x2);const min_y=Math.min(y1,y2);const max_y=Math.max(y1,y2);let i=0;for(let last=points.length-4;i<=last;i+=2)if(C3.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,points[i],points[i+1],points[i+2],points[i+3]))return true;return C3.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,points[i],points[i+1],points[0],points[1])};const NO_HIT=2;
const PADDING=1E-6;C3.rayIntersect=function rayIntersect(rx1,ry1,rx2,ry2,sx1,sy1,sx2,sy2){const rdx=rx2-rx1;const rdy=ry2-ry1;const sdx=sx2-sx1;const sdy=sy2-sy1;const det=rdx*sdy-rdy*sdx;if(det===0)return NO_HIT;const gamma=((ry1-ry2)*(sx2-rx1)+rdx*(sy2-ry1))/det;if(0<gamma&&gamma<1+PADDING)return(sdy*(sx2-rx1)+(sx1-sx2)*(sy2-ry1))/det;return NO_HIT};
C3.rayIntersectExtended=function rayIntersect(rx1,ry1,rx2,ry2,sx1,sy1,sx2,sy2,f){const dx=(sx2-sx1)*f;const dy=(sy2-sy1)*f;return C3.rayIntersect(rx1,ry1,rx2,ry2,sx1-dx,sy1-dy,sx2+dx,sy2+dy)};
C3.isPointInTriangleInclusive=function isPointInTriangleInclusive(px,py,tx1,ty1,tx2,ty2,tx3,ty3){const v0x=tx2-tx1;const v0y=ty2-ty1;const v1x=tx3-tx1;const v1y=ty3-ty1;const v2x=px-tx1;const v2y=py-ty1;const dot00=v0x*v0x+v0y*v0y;const dot01=v0x*v1x+v0y*v1y;const dot02=v0x*v2x+v0y*v2y;const dot11=v1x*v1x+v1y*v1y;const dot12=v1x*v2x+v1y*v2y;const invDenom=1/(dot00*dot11-dot01*dot01);const u=(dot11*dot02-dot01*dot12)*invDenom;const v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&u+v<=1};
C3.triangleCartesianToBarycentric=function triangleCartesianToBarycentric(px,py,tx1,ty1,tx2,ty2,tx3,ty3){const v0x=tx2-tx1;const v0y=ty2-ty1;const v1x=tx3-tx1;const v1y=ty3-ty1;const v2x=px-tx1;const v2y=py-ty1;const dot00=v0x*v0x+v0y*v0y;const dot01=v0x*v1x+v0y*v1y;const dot11=v1x*v1x+v1y*v1y;const dot20=v2x*v0x+v2y*v0y;const dot21=v2x*v1x+v2y*v1y;const denom=dot00*dot11-dot01*dot01;const v=(dot11*dot20-dot01*dot21)/denom;const w=(dot00*dot21-dot01*dot20)/denom;const u=1-v-w;return[u,v,w]};
C3.triangleBarycentricToCartesian3d=function triangleBarycentricToCartesian3d(u,v,w,tx1,ty1,tz1,tx2,ty2,tz2,tx3,ty3,tz3){return[u*tx1+v*tx2+w*tx3,u*ty1+v*ty2+w*ty3,u*tz1+v*tz2+w*tz3]};

}

// ../lib/misc/miscutil.js
{
'use strict';const C3=self.C3;let mainDocument=null;let baseHref="";if(typeof document!=="undefined"){mainDocument=document;const baseElem=document.querySelector("base");baseHref=baseElem&&baseElem.hasAttribute("href")?baseElem.getAttribute("href"):"";if(baseHref){if(baseHref.startsWith("/"))baseHref=baseHref.substr(1);if(!baseHref.endsWith("/"))baseHref+="/"}}C3.GetBaseHref=function GetBaseHref(){return baseHref};
C3.GetBaseURL=function GetBaseURL(){if(!mainDocument)return"";const loc=mainDocument.location;return C3.GetPathFromURL(loc.origin+loc.pathname)+baseHref};C3.GetPathFromURL=function GetPathFromURL(url){if(!url.length)return url;if(url.endsWith("/")||url.endsWith("\\"))return url;const lastSlash=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));if(lastSlash===-1)return"";return url.substr(0,lastSlash+1)};
C3.GetFilenameFromURL=function GetFilenameFromURL(url){if(!url.length)return url;if(url.endsWith("/")||url.endsWith("\\"))return"";const lastSlash=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));if(lastSlash===-1)return url;return url.substr(lastSlash+1)};C3.GetFileExtension=function GetFileExtension(filename){let i=filename.lastIndexOf(".");if(i<1)return"";else return filename.substr(i)};
C3.SetFileExtension=function SetFileExtension(filename,newExt){const i=filename.lastIndexOf(".");if(i===-1)return filename+"."+newExt;else return filename.substr(0,i+1)+newExt};C3.GetFileNamePart=function GetFileNamePart(filename){let i=filename.lastIndexOf(".");if(i<1)return filename;else return filename.substr(0,i)};C3.NormalizeFileSeparator=function NormalizeFileSeparator(path){return path.replace(/\\/g,"/")};
C3.IsFileExtension=function IsFileExtension(filename,extension){const ext=filename?C3.GetFileExtension(filename).slice(1):"";return extension===ext};
C3.FileNameEquals=function FileNameEquals(file_or_filename,other_file_or_filename){let firstName;let secondName;if(C3.IsFileLike(file_or_filename))firstName=C3.GetFileNamePart(file_or_filename["name"]);if(C3.IsString(file_or_filename))firstName=C3.GetFileNamePart(file_or_filename);if(C3.IsFileLike(other_file_or_filename))secondName=C3.GetFileNamePart(other_file_or_filename["name"]);if(C3.IsString(other_file_or_filename))secondName=C3.GetFileNamePart(other_file_or_filename);return firstName===secondName};
C3.ParseFilePath=function ParseFilePath(path){path=C3.NormalizeFileSeparator(path);let root=/^\w:\//.exec(path);if(root){root=root[0];path=path.slice(3);if(path[0]!=="/")path="/"+path}else root="";path=path.replace(/\/{2,}/g,"/");if(path.length>1&&path.slice(-1)==="/")path=path.slice(0,-1);const start=path.lastIndexOf("/")+1;let dir="",base=path,name,ext="";if(start>0){dir=path.slice(0,start);base=path.slice(start)}name=base;const end=base.lastIndexOf(".");if(end>0){ext=base.slice(end);name=base.slice(0,
-ext.length)}const full=root+dir+base;return{dir,base,name,root,ext,full}};C3.Wait=function Wait(delay,argument){return new Promise((resolve,reject)=>{self.setTimeout(resolve,delay,argument)})};C3.swallowException=function swallowException(f){try{f()}catch(e){if(C3.isDebug)console.warn("Swallowed exception: ",e)}};C3.noop=function noop(){};C3.equalsNoCase=function equalsNoCase(a,b){if(typeof a!=="string"||typeof b!=="string")return false;return a===b||a.normalize().toLowerCase()===b.normalize().toLowerCase()};
C3.equalsCase=function equalsCase(a,b){if(typeof a!=="string"||typeof b!=="string")return false;if(a===b)return true;return a.normalize()===b.normalize()};C3.typedArraySet16=function typedArraySet16(dest,src,i){dest[i++]=src[0];dest[i++]=src[1];dest[i++]=src[2];dest[i++]=src[3];dest[i++]=src[4];dest[i++]=src[5];dest[i++]=src[6];dest[i++]=src[7];dest[i++]=src[8];dest[i++]=src[9];dest[i++]=src[10];dest[i++]=src[11];dest[i++]=src[12];dest[i++]=src[13];dest[i++]=src[14];dest[i]=src[15]};
C3.truncateArray=function truncateArray(arr,index){arr.length=index};C3.clearArray=function clearArray(arr){if(!arr)return;if(arr.length===0)return;C3.truncateArray(arr,0)};C3.clear2DArray=function clear2DArray(arr){if(!arr)return;for(let i=0;i<arr.length;i++){let a=arr[i];C3.truncateArray(a,0)}C3.truncateArray(arr,0)};C3.extendArray=function extendArray(arr,len,filler){len=len|0;const arrayLength=arr.length;if(len<=arrayLength)return;for(let i=arrayLength;i<len;++i)arr.push(filler)};
C3.resizeArray=function resizeArray(arr,len,filler){len=len|0;const arrayLength=arr.length;if(len<arrayLength)C3.truncateArray(arr,len);else if(len>arrayLength)C3.extendArray(arr,len,filler)};C3.shallowAssignArray=function shallowAssignArray(dest,src){C3.clearArray(dest);C3.appendArray(dest,src)};C3.appendArray=function appendArray(a,b){if(b.length<1E4)a.push(...b);else for(let i=0,len=b.length;i<len;++i)a.push(b[i])};
C3.arrayRemove=function(arr,index){index=Math.floor(index);if(index<0||index>=arr.length)return;let len=arr.length-1;for(let i=index;i<len;++i)arr[i]=arr[i+1];C3.truncateArray(arr,len)};C3.arrayFindRemove=function arrayFindRemove(a,o){let i=a.indexOf(o);if(i>=0)a.splice(i,1)};C3.arraysEqual=function arraysEqual(a,b){let len=a.length;if(b.length!==len)return false;for(let i=0;i<len;++i)if(a[i]!==b[i])return false;return true};
C3.arrayFilterOut=function arrayFilterOut(arr,callback){let ret=[];let j=0;for(let i=0,len=arr.length;i<len;++i){let item=arr[i];if(callback(item))ret.push(item);else{arr[j]=item;++j}}C3.truncateArray(arr,j);return ret};C3.arrayRemoveAllInSet=function arrayRemoveAllInSet(arr,s){const oldLen=arr.length;let j=0;for(let i=0,len=arr.length;i<len;++i){let item=arr[i];if(!s.has(item))arr[j++]=item}C3.truncateArray(arr,j);return oldLen-j};
C3.isArrayIndexInBounds=function isArrayIndexInBounds(index,array){if(index!==Math.floor(index))return false;return index>=0&&index<array.length};C3.validateArrayIndex=function validateArrayIndex(index,array){if(!C3.isArrayIndexInBounds(index,array))throw new RangeError("array index out of bounds");};C3.cloneArray=function cloneArray(array){return array.slice()};
C3.deepCloneArray=function deepCloneArray(array,f){let ret=[];for(let e of array)if(C3.IsObject(e)){let clone=f(e);if(!clone)throw new Error("missing clone");if(clone.constructor!==e.constructor)throw new Error("object is not a clone");ret.push(clone)}else if(C3.IsArray(e))ret.push(C3.deepCloneArray(e,f));else ret.push(e);return ret};C3.clone2DArray=function cloneArray(array){let ret=[];for(let arr of array)ret.push(arr.slice());return ret};
C3.mergeSets=function mergeSets(set1,set2){if(set1["union"])return set1["union"](set2);else return new Set([...set1,...set2])};C3.mergeSetsInPlace=function mergeSetsInPlace(set1,set2){for(const item of set2)set1.add(item);return set1};C3.first=function first(iterable){for(let i of iterable)return i;return null};C3.xor=function(x,y){return!x!==!y};
C3.compare=function compare(x,cmp,y){switch(cmp){case 0:return x===y;case 1:return x!==y;case 2:return x<y;case 3:return x<=y;case 4:return x>y;case 5:return x>=y;default:return false}};C3.hasAnyOwnProperty=function hasAnyOwnProperty(o){for(let p in o)if(o.hasOwnProperty(p))return true;return false};
C3.PromiseAllWithProgress=function PromiseAllWithProgress(arr,progressCallback){if(!arr.length)return Promise.resolve([]);return new Promise((resolve,reject)=>{const results=[];let numberCompleted=0;let cancelled=false;for(let i=0,len=arr.length;i<len;++i){results.push(void 0);arr[i].then(result=>{if(cancelled)return;results[i]=result;++numberCompleted;if(numberCompleted===arr.length)resolve(results);else progressCallback(numberCompleted,arr.length)}).catch(err=>{cancelled=true;reject(err)})}})};
let memoryCallbacks=[];C3.AddLibraryMemoryCallback=function AddLibraryMemoryCallback(f){memoryCallbacks.push(f)};C3.GetEstimatedLibraryMemoryUsage=function GetEstimatedLibraryMemoryUsage(){let ret=0;for(let f of memoryCallbacks){let m=f();ret+=m}return Math.floor(ret)};let nextTaskId=1;const activeTaskIds=new Map;const taskMessageChannel=new MessageChannel;taskMessageChannel.port2.onmessage=function OnTask(e){const id=e.data;const callback=activeTaskIds.get(id);activeTaskIds.delete(id);if(callback)callback(performance.now())};
C3.RequestUnlimitedAnimationFrame=function RequestUnlimitedAnimationFrame(callback){const id=nextTaskId++;activeTaskIds.set(id,callback);taskMessageChannel.port1.postMessage(id);return id};C3.CancelUnlimitedAnimationFrame=function CancelUnlimitedAnimationFrame(id){activeTaskIds.delete(id)};C3.PostTask=C3.RequestUnlimitedAnimationFrame;C3.WaitForNextTask=function WaitForNextTask(){return new Promise(resolve=>C3.PostTask(resolve))};const activeRPAFids=new Set;
C3.RequestPostAnimationFrame=function RequestPostAnimationFrame(callback){const id=self.requestAnimationFrame(async timestamp=>{await C3.WaitForNextTask();if(!activeRPAFids.has(id))return;activeRPAFids.delete(id);callback(timestamp)});activeRPAFids.add(id);return id};C3.CancelPostAnimationFrame=function CancelPostAnimationFrame(id){if(!activeRPAFids.has(id))return;self.cancelAnimationFrame(id);activeRPAFids.delete(id)};

}

// lib/misc/runtimeutil.js
{
'use strict';const C3=self.C3;C3.IsAbsoluteURL=function IsAbsoluteURL(url){return/^(?:[a-z\-]+:)?\/\//.test(url)||url.substr(0,5)==="data:"||url.substr(0,5)==="blob:"};C3.IsRelativeURL=function IsRelativeURL(url){return!C3.IsAbsoluteURL(url)};C3.ThrowIfNotOk=function ThrowIfNotOk(response){if(!response.ok)throw new Error(`fetch '${response.url}' response returned ${response.status} ${response.statusText}`);};
C3.FetchOk=function FetchOk(url,init){return fetch(url,init).then(response=>{C3.ThrowIfNotOk(response);return response})};C3.FetchText=function FetchText(url){return C3.FetchOk(url).then(response=>response.text())};C3.FetchJson=function FetchJson(url){return C3.FetchOk(url).then(response=>response.json())};C3.FetchBlob=function FetchBlob(url){return C3.FetchOk(url).then(response=>response.blob())};C3.FetchArrayBuffer=function FetchArrayBuffer(url){return C3.FetchOk(url).then(response=>response.arrayBuffer())};
C3.FetchImage=function FetchImage(url){return new Promise((resolve,reject)=>{const img=new Image;img.onload=()=>resolve(img);img.onerror=err=>reject(err);img.src=url})};C3.BlobToArrayBuffer=function BlobToArrayBuffer(blob){if(typeof blob["arrayBuffer"]==="function")return blob["arrayBuffer"]();else return new Promise((resolve,reject)=>{const fileReader=new FileReader;fileReader.onload=()=>resolve(fileReader.result);fileReader.onerror=()=>reject(fileReader.error);fileReader.readAsArrayBuffer(blob)})};
C3.BlobToString=function BlobToString(blob){if(typeof blob["text"]==="function")return blob["text"]();else return new Promise((resolve,reject)=>{const fileReader=new FileReader;fileReader.onload=()=>resolve(fileReader.result);fileReader.onerror=()=>reject(fileReader.error);fileReader.readAsText(blob)})};C3.BlobToJson=function BlobToJson(blob){return C3.BlobToString(blob).then(text=>JSON.parse(text))};
C3.BlobToImage=async function BlobToImage(blob,decodeImage){let blobUrl=URL.createObjectURL(blob);try{const img=await C3.FetchImage(blobUrl);URL.revokeObjectURL(blobUrl);blobUrl="";if(decodeImage&&typeof img["decode"]==="function")await img["decode"]();return img}finally{if(blobUrl)URL.revokeObjectURL(blobUrl)}};
C3.CreateCanvas=function CreateCanvas(width,height){if(typeof document!=="undefined"&&typeof document.createElement==="function"){const canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas}else return new OffscreenCanvas(width,height)};
C3.CanvasToBlob=function CanvasToBlob(canvas,type,quality){if(typeof quality!=="number")quality=1;type=type||"image/png";quality=C3.clamp(quality,0,1);if(canvas["convertToBlob"])return canvas["convertToBlob"]({"type":type,"quality":quality});else if(canvas.toBlob)return new Promise(resolve=>canvas.toBlob(resolve,type,quality));else throw new Error("could not convert canvas to blob");};
C3.DrawableToBlob=function DrawableToBlob(drawable,type,quality){const canvas=C3.CreateCanvas(drawable.width,drawable.height);const ctx=canvas.getContext("2d");ctx.drawImage(drawable,0,0);return C3.CanvasToBlob(canvas,type,quality)};
C3.ImageDataToBlob=function ImageDataToBlob(imageData,type,quality){if(C3.Supports.ImageBitmapOptions)return createImageBitmap(imageData,{"premultiplyAlpha":"none"}).then(imageBitmap=>C3.DrawableToBlob(imageBitmap,type,quality));else if(C3.Supports.ImageBitmap)return createImageBitmap(imageData).then(imageBitmap=>C3.DrawableToBlob(imageBitmap,type,quality));else{const canvas=C3.CreateCanvas(imageData.width,imageData.height);const ctx=canvas.getContext("2d");ctx.putImageData(imageData,0,0);return C3.CanvasToBlob(canvas,
type,quality)}};C3.CopySet=function CopySet(dest,src){dest.clear();for(const x of src)dest.add(x)};C3.MapToObject=function MapToObject(map){const ret=Object.create(null);for(const [k,v]of map.entries())ret[k]=v;return ret};C3.ObjectToMap=function ObjectToMap(o,map){map.clear();for(const [k,v]of Object.entries(o))map.set(k,v)};
C3.ToSuperJSON=function ToSuperJSON(v){if(typeof v==="object"&&v!==null)if(v instanceof Set)return{"_c3type_":"set","data":[...v].map(o=>ToSuperJSON(o))};else if(v instanceof Map)return{"_c3type_":"map","data":[...v].map(pair=>[pair[0],ToSuperJSON(pair[1])])};else{const ret=Object.create(null);for(const [key,value]of Object.entries(v))ret[key]=ToSuperJSON(value);return ret}return v};
C3.FromSuperJSON=function FromSuperJSON(v){if(typeof v==="object"&v!==null)if(v["_c3type_"]==="set")return new Set(v["data"].map(o=>FromSuperJSON(o)));else if(v["_c3type_"]==="map")return new Map(v["data"].map(pair=>[pair[0],FromSuperJSON(pair[1])]));else{const ret=Object.create(null);for(const [key,value]of Object.entries(v))ret[key]=FromSuperJSON(value);return ret}return v};
C3.CSSToCamelCase=function(str){if(str.startsWith("--"))return str;let ret="";let isAfterHyphen=false;let index=0;for(const ch of str){if(ch==="-"){if(index>0)isAfterHyphen=true}else if(isAfterHyphen){ret+=ch.toUpperCase();isAfterHyphen=false}else ret+=ch;++index}return ret};C3.IsIterator=function(o){return typeof o==="object"&&typeof o.next==="function"};
C3.MakeFilledArray=function MakeFilledArray(len,data){const ret=[];if(typeof data==="function")for(let i=0;i<len;++i)ret.push(data());else for(let i=0;i<len;++i)ret.push(data);return ret};

}

// ../lib/misc/color.js
{
'use strict';const C3=self.C3;const HSL_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i;const HSLA_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;function padTwoDigits(str){if(str.length===0)return"00";else if(str.length===1)return"0"+str;else return str}function hueToRGB(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}
C3.Color=class Color{constructor(r,g,b,a){this._r=NaN;this._g=NaN;this._b=NaN;this._a=NaN;this._r=0;this._g=0;this._b=0;this._a=0;if(r instanceof C3.Color)this.set(r);else this.setRgba(r||0,g||0,b||0,a||0)}setRgb(r,g,b){this._r=+r;this._g=+g;this._b=+b;this.clamp();return this}setRgba(r,g,b,a){this._r=+r;this._g=+g;this._b=+b;this._a=+a;this.clamp();return this}set(c){this._r=c._r;this._g=c._g;this._b=c._b;this._a=c._a;return this}copy(c){return this.set(c)}add(c){this._r+=c._r;this._g+=c._g;this._b+=
c._b;this._a+=c._a;this.clamp()}addRgb(r,g,b,a=0){this._r+=+r;this._g+=+g;this._b+=+b;this._a+=+a;this.clamp()}diff(c){this.setR(Math.max(this._r,c._r)-Math.min(this._r,c._r));this.setG(Math.max(this._g,c._g)-Math.min(this._g,c._g));this.setB(Math.max(this._b,c._b)-Math.min(this._b,c._b));this.setA(Math.max(this._a,c._a)-Math.min(this._a,c._a));this.clamp()}copyRgb(c){this._r=c._r;this._g=c._g;this._b=c._b}setR(r){this._r=C3.clamp(+r,0,1)}getR(){return this._r}setG(g){this._g=C3.clamp(+g,0,1)}getG(){return this._g}setB(b){this._b=
C3.clamp(+b,0,1)}getB(){return this._b}setA(a){this._a=C3.clamp(+a,0,1)}getA(){return this._a}clone(){return C3.New(C3.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(ta,i){ta[i++]=this._r;ta[i++]=this._g;ta[i++]=this._b;ta[i]=this._a}writeRGBToTypedArray(ta,i){ta[i++]=this._r;ta[i++]=this._g;ta[i]=this._b}equals(c){return this._r===c._r&&this._g===c._g&&this._b===c._b&&this._a===c._a}equalsIgnoringAlpha(c){return this._r===
c._r&&this._g===c._g&&this._b===c._b}equalsRgb(r,g,b){return this._r===r&&this._g===g&&this._b===b}equalsRgba(r,g,b,a){return this._r===r&&this._g===g&&this._b===b&&this._a===a}equalsF32Array(arr,offset){return arr[offset]===Math.fround(this._r)&&arr[offset+1]===Math.fround(this._g)&&arr[offset+2]===Math.fround(this._b)&&arr[offset+3]===Math.fround(this._a)}equalsRGBF32Array(arr,offset){return arr[offset]===Math.fround(this._r)&&arr[offset+1]===Math.fround(this._g)&&arr[offset+2]===Math.fround(this._b)}multiply(c){this._r*=
c._r;this._g*=c._g;this._b*=c._b;this._a*=c._a}multiplyAlpha(a){this._r*=a;this._g*=a;this._b*=a;this._a*=a}premultiply(){this._r*=this._a;this._g*=this._a;this._b*=this._a;return this}unpremultiply(){this._r/=this._a;this._g/=this._a;this._b/=this._a;return this}clamp(){this._r=C3.clamp(this._r,0,1);this._g=C3.clamp(this._g,0,1);this._b=C3.clamp(this._b,0,1);this._a=C3.clamp(this._a,0,1);return this}setFromRgbValue(rgb){this._r=C3.GetRValue(rgb);this._g=C3.GetGValue(rgb);this._b=C3.GetBValue(rgb);
this._a=C3.GetAValue(rgb)}getCssRgb(_r,_g,_b){const r=C3.IsFiniteNumber(_r)?_r:this.getR();const g=C3.IsFiniteNumber(_g)?_g:this.getG();const b=C3.IsFiniteNumber(_b)?_b:this.getB();return`rgb(${r*100}%, ${g*100}%, ${b*100}%)`}getCssRgba(_r,_g,_b,_a){const r=C3.IsFiniteNumber(_r)?_r:this.getR();const g=C3.IsFiniteNumber(_g)?_g:this.getG();const b=C3.IsFiniteNumber(_b)?_b:this.getB();const a=C3.IsFiniteNumber(_a)?_a:this.getA();return`rgba(${r*100}%, ${g*100}%, ${b*100}%, ${a})`}toHexString(){const rh=
Math.round(this.getR()*255);const gh=Math.round(this.getG()*255);const bh=Math.round(this.getB()*255);return"#"+padTwoDigits(rh.toString(16))+padTwoDigits(gh.toString(16))+padTwoDigits(bh.toString(16))}parseHexString(str){if(typeof str!=="string")return false;str=str.trim();if(str.charAt(0)==="#")str=str.substr(1);let rv;let gv;let bv;if(str.length===3){rv=parseInt(str[0],16)/15;gv=parseInt(str[1],16)/15;bv=parseInt(str[2],16)/15}else if(str.length===6){rv=parseInt(str.substr(0,2),16)/255;gv=parseInt(str.substr(2,
2),16)/255;bv=parseInt(str.substr(4,2),16)/255}else return false;if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);this.setA(1);return true}toCommaSeparatedRgb(){const rv=Math.round(this.getR()*255);const gv=Math.round(this.getG()*255);const bv=Math.round(this.getB()*255);return`${rv}, ${gv}, ${bv}`}toRgbArray(){const rv=Math.round(this.getR()*255);const gv=Math.round(this.getG()*255);const bv=Math.round(this.getB()*255);return[rv,gv,bv]}parseCommaSeparatedRgb(str){if(typeof str!==
"string")return false;str=str.replace(/^rgb\(|\)|%/,"");const arr=str.split(",");if(arr.length<3)return false;const rv=parseInt(arr[0].trim(),10)/255;const gv=parseInt(arr[1].trim(),10)/255;const bv=parseInt(arr[2].trim(),10)/255;if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);this.setA(1);return true}parseCommaSeparatedPercentageRgb(str){if(typeof str!=="string")return false;str=str.replace(/^rgb\(|\)|%/,"");const arr=str.split(",");if(arr.length<3)return false;
const rv=parseInt(arr[0].trim(),10)/100;const gv=parseInt(arr[1].trim(),10)/100;const bv=parseInt(arr[2].trim(),10)/100;if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);this.setA(1);return true}parseCommaSeparatedRgba(str){if(typeof str!=="string")return false;str=str.replace(/^rgba\(|\)|%/,"");const arr=str.split(",");if(arr.length<4)return false;const rv=parseInt(arr[0].trim(),10)/255;const gv=parseInt(arr[1].trim(),10)/255;const bv=parseInt(arr[2].trim(),
10)/255;const av=parseFloat(arr[3].trim());if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);if(isFinite(av))this.setA(av);return true}parseCommaSeparatedPercentageRgba(str){if(typeof str!=="string")return false;str=str.replace(/^rgba\(|\)|%/,"");const arr=str.split(",");if(arr.length<4)return false;const rv=parseInt(arr[0].trim(),10)/100;const gv=parseInt(arr[1].trim(),10)/100;const bv=parseInt(arr[2].trim(),10)/100;const av=parseFloat(arr[3].trim());if(isFinite(rv))this.setR(rv);
if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);if(isFinite(av))this.setA(av);return true}parseString(str){if(typeof str!=="string")return false;str=str.replace(/\s+/,"");if(str.includes(","))if(str.startsWith("rgb("))if(str.includes("%"))return this.parseCommaSeparatedPercentageRgb(str);else return this.parseCommaSeparatedRgb(str);else if(str.startsWith("rgba("))if(str.includes("%"))return this.parseCommaSeparatedPercentageRgba(str);else return this.parseCommaSeparatedRgba(str);else if(str.startsWith("hsl(")||
str.startsWith("hsla("))return this.parseHSLString(str);else{const components=str.split(",");if(str.includes("%")){if(components.length===3)return this.parseCommaSeparatedPercentageRgb(str);else if(components.length===4)return this.parseCommaSeparatedPercentageRgba(str);return false}else{if(components.length===3)return this.parseCommaSeparatedRgb(str);else if(components.length===4)return this.parseCommaSeparatedRgba(str);return false}}else return this.parseHexString(str)}toJSON(){return[this._r,this._g,
this._b,this._a]}setFromHSLA(h,s,l,a){let r;let g;let b;h%=360;s=C3.clamp(s,0,100);l=C3.clamp(l,0,100);a=C3.clamp(a,0,1);h/=360;s/=100;l/=100;if(s===0)r=g=b=l;else{const q=l<.5?l*(1+s):l+s-l*s;const p=2*l-q;r=hueToRGB(p,q,h+1/3);g=hueToRGB(p,q,h);b=hueToRGB(p,q,h-1/3)}this.setR(r);this.setG(g);this.setB(b);this.setA(a);return this}parseHSLString(str){const cleanString=str.replace(/ |hsl|hsla|\(|\)|;/gi,"");const hsl=HSL_TEST.exec(cleanString);const hsla=HSLA_TEST.exec(cleanString);if(hsl&&hsl.length===
4){this.setFromHSLA(+hsl[1],+hsl[2],+hsl[3],1);return true}else if(hsla&&hsla.length===5){this.setFromHSLA(+hsl[1],+hsl[2],+hsl[3],+hsl[4]);return true}return false}toHSLAString(){const r=this._r;const g=this._g;const b=this._b;const a=this._a;const h=C3.Color.GetHue(r,g,b);const s=C3.Color.GetSaturation(r,g,b);const l=C3.Color.GetLuminosity(r,g,b);return`hsla(${h}, ${s}%, ${l}%, ${a})`}toHSLAArray(){const r=this._r;const g=this._g;const b=this._b;return[C3.Color.GetHue(r,g,b),C3.Color.GetSaturation(r,
g,b),C3.Color.GetLuminosity(r,g,b),this._a]}setFromJSON(arr){if(!Array.isArray(arr))return;if(arr.length<3)return;this._r=arr[0];this._g=arr[1];this._b=arr[2];if(arr.length>=4)this._a=arr[3];else this._a=1}set r(r){this.setR(r)}get r(){return this.getR()}set g(g){this.setG(g)}get g(){return this.getG()}set b(b){this.setB(b)}get b(){return this.getB()}set a(a){this.setA(a)}get a(){return this.getA()}setAtIndex(i,v){switch(i){case 0:this.setR(v);break;case 1:this.setG(v);break;case 2:this.setB(v);break;
case 3:this.setA(v);break;default:throw new RangeError("invalid color index");}}getAtIndex(i){switch(i){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index");}}static Equals(color_or_json_1,color_or_json_2){let c1;let c2;if(Array.isArray(color_or_json_1)){c1=new C3.Color;c1.setFromJSON(color_or_json_1)}else if(color_or_json_1 instanceof C3.Color)c1=color_or_json_1;else throw new Error("unexpected type");
if(Array.isArray(color_or_json_2)){c2=new C3.Color;c2.setFromJSON(color_or_json_2)}else if(color_or_json_2 instanceof C3.Color)c2=color_or_json_2;else throw new Error("unexpected type");return c1.equals(c2)}static DiffChannel(channel1,channel2){return C3.clamp(Math.max(channel1,channel2)-Math.min(channel1,channel2),0,1)}static Diff(c1,c2){const ret=new C3.Color;ret.setR(Math.max(c1._r,c2._r)-Math.min(c1._r,c2._r));ret.setG(Math.max(c1._g,c2._g)-Math.min(c1._g,c2._g));ret.setB(Math.max(c1._b,c2._b)-
Math.min(c1._b,c2._b));ret.setA(Math.max(c1._a,c2._a)-Math.min(c1._a,c2._a));return ret}static DiffNoAlpha(c1,c2){const ret=new C3.Color(0,0,0,1);ret.setR(Math.max(c1._r,c2._r)-Math.min(c1._r,c2._r));ret.setG(Math.max(c1._g,c2._g)-Math.min(c1._g,c2._g));ret.setB(Math.max(c1._b,c2._b)-Math.min(c1._b,c2._b));return ret}static GetHue(r,g,b){const max=Math.max(r,g,b);const min=Math.min(r,g,b);if(max===min)return 0;let h=0;switch(max){case r:h=(g-b)/(max-min)+(g<b?6:0);break;case g:h=(b-r)/(max-min)+2;
break;case b:h=(r-g)/(max-min)+4;break}return Math.round(h/6*360)}static GetSaturation(r,g,b){const max=Math.max(r,g,b);const min=Math.min(r,g,b);if(max===min)return 0;const l=(max+min)/2;const d=max-min;const s=l>.5?d/(2-max-min):d/(max+min);return Math.round(s*100)}static GetLuminosity(r,g,b){const max=Math.max(r,g,b);const min=Math.min(r,g,b);const l=(max+min)/2;if(!max)return 0;return Math.round(l*100)}};C3.Color.White=Object.freeze(C3.New(C3.Color,1,1,1,1));
C3.Color.Black=Object.freeze(C3.New(C3.Color,0,0,0,1));C3.Color.TransparentBlack=Object.freeze(C3.New(C3.Color,0,0,0,0));

}

// ../lib/misc/vector2.js
{
'use strict';const C3=self.C3;
C3.Vector2=class Vector2{constructor(x,y){this._x=0;this._y=0;if(x instanceof C3.Vector2)this.copy(x);else this.set(x||0,y||0)}set(x,y){this._x=+x;this._y=+y}copy(v){this._x=v._x;this._y=v._y}equals(v){return this._x===v._x&&this._y===v._y}equalsValues(x,y){return this._x===x&&this._y===y}equalsF32Array(arr,offset){return arr[offset]===Math.fround(this._x)&&arr[offset+1]===Math.fround(this._y)}setX(x){this._x=+x}getX(){return this._x}setY(y){this._y=+y}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(ta,
i){ta[i++]=this._x;ta[i]=this._y}offset(x,y){this._x+=+x;this._y+=+y}scale(x,y){this._x*=x;this._y*=y}divide(x,y){this._x/=x;this._y/=y}round(){this._x=Math.round(this._x);this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x);this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x);this._y=Math.ceil(this._y)}angle(){return C3.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.hypot(this._x,this._y)}rotatePrecalc(sin_a,cos_a){const temp=
this._x*cos_a-this._y*sin_a;this._y=this._y*cos_a+this._x*sin_a;this._x=temp}rotate(a){if(a===0)return;this.rotatePrecalc(Math.sin(a),Math.cos(a))}rotateAbout(a,x,y){if(a===0||x===this._x&&y===this._y)return;this._x-=x;this._y-=y;this.rotatePrecalc(Math.sin(a),Math.cos(a));this._x+=+x;this._y+=+y}move(a,dist){if(dist===0)return;this._x+=Math.cos(a)*dist;this._y+=Math.sin(a)*dist}normalize(){const m=this.length();if(m!==0&&m!==1){this._x/=m;this._y/=m}}clamp(lower,upper){this._x=C3.clamp(this._x,lower,
upper);this._y=C3.clamp(this._y,lower,upper)}dot(other){return this._x*other._x+this._y*other._y}reverse(){this._x=-this._x;this._y=-this._y}perp(){let x=this._x;this._x=this._y;this._y=-x;return this}};

}

// ../lib/misc/rect.js
{
'use strict';const C3=self.C3;
C3.Rect=class Rect{constructor(left,top,right,bottom){this._left=NaN;this._top=NaN;this._right=NaN;this._bottom=NaN;this._left=0;this._top=0;this._right=0;this._bottom=0;if(left instanceof C3.Rect)this.copy(left);else this.set(left||0,top||0,right||0,bottom||0)}set(left,top,right,bottom){this._left=+left;this._top=+top;this._right=+right;this._bottom=+bottom}setWH(left,top,width,height){left=+left;top=+top;this._left=left;this._top=top;this._right=left+ +width;this._bottom=top+ +height}copy(rect){this._left=
+rect._left;this._top=+rect._top;this._right=+rect._right;this._bottom=+rect._bottom}clone(){return new C3.Rect(this._left,this._top,this._right,this._bottom)}static Merge(first,second){const ret=new C3.Rect;ret.setLeft(Math.min(first._left,second._left));ret.setTop(Math.min(first._top,second._top));ret.setRight(Math.max(first._right,second._right));ret.setBottom(Math.max(first._bottom,second._bottom));return ret}static FromObject(o){return new C3.Rect(o.left,o.top,o.right,o.bottom)}equals(rect){return this._left===
rect._left&&this._top===rect._top&&this._right===rect._right&&this._bottom===rect._bottom}equalsWH(x,y,w,h){return this._left===x&&this._top===y&&this.width()===w&&this.height()===h}equalsF32Array(arr,offset){return arr[offset]===Math.fround(this._left)&&arr[offset+1]===Math.fround(this._top)&&arr[offset+2]===Math.fround(this._right)&&arr[offset+3]===Math.fround(this._bottom)}setLeft(l){this._left=+l}getLeft(){return this._left}setTop(t){this._top=+t}getTop(){return this._top}setRight(r){this._right=
+r}getRight(){return this._right}setBottom(b){this._bottom=+b}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height())}static fromDOMRect(domRect){return C3.New(C3.Rect,domRect.left,domRect.top,domRect.right,domRect.bottom)}writeToTypedArray(ta,i){ta[i++]=this._left;ta[i++]=this._top;ta[i++]=this._right;ta[i]=this._bottom}writeAsQuadToTypedArray(ta,
i){ta[i++]=this._left;ta[i++]=this._top;ta[i++]=this._right;ta[i++]=this._top;ta[i++]=this._right;ta[i++]=this._bottom;ta[i++]=this._left;ta[i]=this._bottom}writeAsQuadToTypedArray3D(ta,i,z){ta[i++]=this._left;ta[i++]=this._top;ta[i++]=z;ta[i++]=this._right;ta[i++]=this._top;ta[i++]=z;ta[i++]=this._right;ta[i++]=this._bottom;ta[i++]=z;ta[i++]=this._left;ta[i++]=this._bottom;ta[i]=z}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+
this._bottom)/2}offset(x,y){x=+x;y=+y;this._left+=x;this._top+=y;this._right+=x;this._bottom+=y}offsetLeft(x){this._left+=+x}offsetTop(y){this._top+=+y}offsetRight(x){this._right+=+x}offsetBottom(y){this._bottom+=+y}toSquare(axis){if(axis!=="x")throw new Error("invalid axis, only 'x' supported");if(this._top<this._bottom)if(this._left<this._right)this._bottom=this._top+this.width();else this._bottom=this._top-this.width();else if(this._left<this._right)this._bottom=this._top-this.width();else this._bottom=
this._top+this.width()}inflate(x,y){x=+x;y=+y;this._left-=x;this._top-=y;this._right+=x;this._bottom+=y}deflate(x,y){x=+x;y=+y;this._left+=x;this._top+=y;this._right-=x;this._bottom-=y}multiply(x,y){this._left*=x;this._top*=y;this._right*=x;this._bottom*=y}divide(x,y){this._left/=x;this._top/=y;this._right/=x;this._bottom/=y}mirrorAround(origin){this._left=+origin-this._left;this._right=+origin-this._right}flipAround(origin){this._top=+origin-this._top;this._bottom=+origin-this._bottom}rotate90DegreesAround(normalizedX,
normalizedY){const w=this.width();const h=this.height();const cx=this.getLeft()+w*normalizedX;const cy=this.getTop()+h*normalizedY;this.setWH(cx-h*normalizedY,cy-w*normalizedX,h,w)}swapLeftRight(){const temp=this._left;this._left=this._right;this._right=temp}swapTopBottom(){const temp=this._top;this._top=this._bottom;this._bottom=temp}shuntY(h){const top=this._top;this._top=+h-this._bottom;this._bottom=+h-top}round(){this._left=Math.round(this._left);this._top=Math.round(this._top);this._right=Math.round(this._right);
this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left);this._top=Math.ceil(this._top);this._right=Math.floor(this._right);this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left);this._top=Math.floor(this._top);this._right=Math.ceil(this._right);this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left);this._top=Math.floor(this._top);this._right=Math.floor(this._right);this._bottom=Math.floor(this._bottom)}ceil(){this._left=
Math.ceil(this._left);this._top=Math.ceil(this._top);this._right=Math.ceil(this._right);this._bottom=Math.ceil(this._bottom)}clamp(l,t,r,b){this._left=Math.max(this._left,+l);this._top=Math.max(this._top,+t);this._right=Math.min(this._right,+r);this._bottom=Math.min(this._bottom,+b)}clampBoth(l,t,r,b){l=+l;t=+t;r=+r;b=+b;this._left=C3.clamp(this._left,l,r);this._top=C3.clamp(this._top,t,b);this._right=C3.clamp(this._right,l,r);this._bottom=C3.clamp(this._bottom,t,b)}normalize(){if(this._left>this._right)this.swapLeftRight();
if(this._top>this._bottom)this.swapTopBottom()}intersectsRect(rect){return!(rect._right<this._left||rect._bottom<this._top||rect._left>this._right||rect._top>this._bottom)}intersectsRectOffset(rect,x,y){return!(rect._right+x<this._left||rect._bottom+y<this._top||rect._left+x>this._right||rect._top+y>this._bottom)}containsPoint(x,y){return x>=this._left&&x<=this._right&&y>=this._top&&y<=this._bottom}containsRect(rect){return rect._left>=this._left&&rect._top>=this._top&&rect._right<=this._right&&rect._bottom<=
this._bottom}expandToContain(rect){if(rect._left<this._left)this._left=+rect._left;if(rect._top<this._top)this._top=+rect._top;if(rect._right>this._right)this._right=+rect._right;if(rect._bottom>this._bottom)this._bottom=+rect._bottom}lerpInto(rect){this._left=C3.lerp(rect._left,rect._right,this._left);this._top=C3.lerp(rect._top,rect._bottom,this._top);this._right=C3.lerp(rect._left,rect._right,this._right);this._bottom=C3.lerp(rect._top,rect._bottom,this._bottom)}};

}

// ../lib/misc/quad.js
{
'use strict';const C3=self.C3;
C3.Quad=class Quad{constructor(tlx,tly,trx,try_,brx,bry,blx,bly){this._tlx=NaN;this._tly=NaN;this._trx=NaN;this._try=NaN;this._brx=NaN;this._bry=NaN;this._blx=NaN;this._bly=NaN;this._tlx=0;this._tly=0;this._trx=0;this._try=0;this._brx=0;this._bry=0;this._blx=0;this._bly=0;if(tlx instanceof C3.Quad)this.copy(tlx);else this.set(tlx||0,tly||0,trx||0,try_||0,brx||0,bry||0,blx||0,bly||0)}set(tlx,tly,trx,try_,brx,bry,blx,bly){this._tlx=+tlx;this._tly=+tly;this._trx=+trx;this._try=+try_;this._brx=+brx;this._bry=
+bry;this._blx=+blx;this._bly=+bly}setRect(left,top,right,bottom){this.set(left,top,right,top,right,bottom,left,bottom)}copy(q){this._tlx=q._tlx;this._tly=q._tly;this._trx=q._trx;this._try=q._try;this._brx=q._brx;this._bry=q._bry;this._blx=q._blx;this._bly=q._bly}equals(q){return this._tlx===q._tlx&&this._tly===q._tly&&this._trx===q._trx&&this._try===q._try&&this._brx===q._brx&&this._bry===q._bry&&this._blx===q._blx&&this._bly===q._bly}setTlx(v){this._tlx=+v}getTlx(){return this._tlx}setTly(v){this._tly=
+v}getTly(){return this._tly}setTrx(v){this._trx=+v}getTrx(){return this._trx}setTry(v){this._try=+v}getTry(){return this._try}setBrx(v){this._brx=+v}getBrx(){return this._brx}setBry(v){this._bry=+v}getBry(){return this._bry}setBlx(v){this._blx=+v}getBlx(){return this._blx}setBly(v){this._bly=+v}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}static fromDOMQuad(domQuad){return C3.New(C3.Quad,
domQuad.p1.x,domQuad.p1.y,domQuad.p2.x,domQuad.p2.y,domQuad.p3.x,domQuad.p3.y,domQuad.p4.x,domQuad.p4.y)}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(ta,i){ta[i++]=this._tlx;ta[i++]=this._tly;ta[i++]=this._trx;ta[i++]=this._try;ta[i++]=this._brx;ta[i++]=this._bry;ta[i++]=this._blx;ta[i]=this._bly}writeToTypedArray3D(ta,i,z){ta[i++]=this._tlx;ta[i++]=this._tly;ta[i++]=z;ta[i++]=
this._trx;ta[i++]=this._try;ta[i++]=z;ta[i++]=this._brx;ta[i++]=this._bry;ta[i++]=z;ta[i++]=this._blx;ta[i++]=this._bly;ta[i]=z}offset(x,y){x=+x;y=+y;this._tlx+=x;this._tly+=y;this._trx+=x;this._try+=y;this._brx+=x;this._bry+=y;this._blx+=x;this._bly+=y}round(){this._tlx=Math.round(this._tlx);this._tly=Math.round(this._tly);this._trx=Math.round(this._trx);this._try=Math.round(this._try);this._brx=Math.round(this._brx);this._bry=Math.round(this._bry);this._blx=Math.round(this._blx);this._bly=Math.round(this._bly)}floor(){this._tlx=
Math.floor(this._tlx);this._tly=Math.floor(this._tly);this._trx=Math.floor(this._trx);this._try=Math.floor(this._try);this._brx=Math.floor(this._brx);this._bry=Math.floor(this._bry);this._blx=Math.floor(this._blx);this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx);this._tly=Math.ceil(this._tly);this._trx=Math.ceil(this._trx);this._try=Math.ceil(this._try);this._brx=Math.ceil(this._brx);this._bry=Math.ceil(this._bry);this._blx=Math.ceil(this._blx);this._bly=Math.ceil(this._bly)}setFromRect(rect){this._tlx=
rect._left;this._tly=rect._top;this._trx=rect._right;this._try=rect._top;this._brx=rect._right;this._bry=rect._bottom;this._blx=rect._left;this._bly=rect._bottom}setFromRotatedRect(rect,a){if(a===0)this.setFromRect(rect);else this.setFromRotatedRectPrecalc(rect,Math.sin(a),Math.cos(a))}setFromRotatedRectPrecalc(rect,sin_a,cos_a){const left_sin_a=rect._left*sin_a;const top_sin_a=rect._top*sin_a;const right_sin_a=rect._right*sin_a;const bottom_sin_a=rect._bottom*sin_a;const left_cos_a=rect._left*cos_a;
const top_cos_a=rect._top*cos_a;const right_cos_a=rect._right*cos_a;const bottom_cos_a=rect._bottom*cos_a;this._tlx=left_cos_a-top_sin_a;this._tly=top_cos_a+left_sin_a;this._trx=right_cos_a-top_sin_a;this._try=top_cos_a+right_sin_a;this._brx=right_cos_a-bottom_sin_a;this._bry=bottom_cos_a+right_sin_a;this._blx=left_cos_a-bottom_sin_a;this._bly=bottom_cos_a+left_sin_a}getBoundingBox(rect){rect.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,
this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(x,y){let v0x=this._trx-this._tlx;let v0y=this._try-this._tly;const v1x=this._brx-this._tlx;const v1y=this._bry-this._tly;const v2x=x-this._tlx;const v2y=y-this._tly;let dot00=v0x*v0x+v0y*v0y;let dot01=v0x*v1x+v0y*v1y;let dot02=v0x*v2x+v0y*v2y;const dot11=v1x*v1x+v1y*v1y;const dot12=v1x*v2x+v1y*v2y;let invDenom=1/(dot00*dot11-dot01*dot01);let u=(dot11*dot02-dot01*dot12)*invDenom;let v=(dot00*dot12-dot01*
dot02)*invDenom;if(u>=0&&v>0&&u+v<1)return true;v0x=this._blx-this._tlx;v0y=this._bly-this._tly;dot00=v0x*v0x+v0y*v0y;dot01=v0x*v1x+v0y*v1y;dot02=v0x*v2x+v0y*v2y;invDenom=1/(dot00*dot11-dot01*dot01);u=(dot11*dot02-dot01*dot12)*invDenom;v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>0&&u+v<1}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(x1,y1,x2,y2){if(this.containsPoint(x1,y1)||this.containsPoint(x2,y2))return true;
return C3.segmentIntersectsQuad(x1,y1,x2,y2,this)}intersectsQuad(rhs){let midX=rhs.midX();let midY=rhs.midY();if(this.containsPoint(midX,midY))return true;midX=this.midX();midY=this.midY();if(rhs.containsPoint(midX,midY))return true;const tlx=this._tlx,tly=this._tly,trx=this._trx,try_=this._try,brx=this._brx,bry=this._bry,blx=this._blx,bly=this._bly;return C3.segmentIntersectsQuad(tlx,tly,trx,try_,rhs)||C3.segmentIntersectsQuad(trx,try_,brx,bry,rhs)||C3.segmentIntersectsQuad(brx,bry,blx,bly,rhs)||
C3.segmentIntersectsQuad(blx,bly,tlx,tly,rhs)}rotatePointsAnticlockwise(){const tlx=this._tlx;const tly=this._tly;this._tlx=this._trx;this._tly=this._try;this._trx=this._brx;this._try=this._bry;this._brx=this._blx;this._bry=this._bly;this._blx=tlx;this._bly=tly}mirror(){this._swap(0,2);this._swap(1,3);this._swap(6,4);this._swap(7,5)}flip(){this._swap(0,6);this._swap(1,7);this._swap(2,4);this._swap(3,5)}diag(){this._swap(2,6);this._swap(3,7)}_swap(i,j){const tmp=this._getAtIndex(i);this._setAtIndex(i,
this._getAtIndex(j));this._setAtIndex(j,tmp)}_getAtIndex(i){switch(i){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index");}}_setAtIndex(i,v){v=+v;switch(i){case 0:this._tlx=v;break;case 1:this._tly=v;break;case 2:this._trx=v;break;case 3:this._try=v;break;case 4:this._brx=v;break;case 5:this._bry=v;break;
case 6:this._blx=v;break;case 7:this._bly=v;break;default:throw new RangeError("invalid quad point index");}}};

}

// lib/misc/collisionPoly.js
{
'use strict';const C3=self.C3;const assert=self.assert;const DEFAULT_POLY_POINTS=[0,0,1,0,1,1,0,1];const tempQuad=C3.New(C3.Quad);
C3.CollisionPoly=class CollisionPoly extends C3.DefendedBase{constructor(pointsArr,enabled=true){super();if(!pointsArr)pointsArr=DEFAULT_POLY_POINTS;this._ptsArr=Float64Array.from(pointsArr);this._bbox=new C3.Rect;this._isBboxChanged=true;this._enabled=enabled}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(pointsArr){if(this._ptsArr.length===pointsArr.length)this._ptsArr.set(pointsArr);else this._ptsArr=Float64Array.from(pointsArr);this._isBboxChanged=
true}setDefaultPoints(){this.setPoints(DEFAULT_POLY_POINTS)}copy(poly){this.setPoints(poly._ptsArr)}setBboxChanged(){this._isBboxChanged=true}_updateBbox(){if(!this._isBboxChanged)return;const ptsArr=this._ptsArr;let left=ptsArr[0];let top=ptsArr[1];let right=left;let bottom=top;for(let i=0,len=ptsArr.length;i<len;i+=2){const x=ptsArr[i];const y=ptsArr[i+1];if(x<left)left=x;if(x>right)right=x;if(y<top)top=y;if(y>bottom)bottom=y}this._bbox.set(left,top,right,bottom);this._isBboxChanged=false}setFromRect(rc,
offX,offY){let ptsArr=this._ptsArr;if(ptsArr.length!==8){ptsArr=new Float64Array(8);this._ptsArr=ptsArr}ptsArr[0]=rc.getLeft()-offX;ptsArr[1]=rc.getTop()-offY;ptsArr[2]=rc.getRight()-offX;ptsArr[3]=rc.getTop()-offY;ptsArr[4]=rc.getRight()-offX;ptsArr[5]=rc.getBottom()-offY;ptsArr[6]=rc.getLeft()-offX;ptsArr[7]=rc.getBottom()-offY;this._bbox.copy(rc);if(offX!==0||offY!==0)this._bbox.offset(-offX,-offY);this._isBboxChanged=false}setFromQuad(q,offX,offY){tempQuad.copy(q);tempQuad.offset(offX,offY);this.setPoints(tempQuad.toArray());
this._isBboxChanged=true}transform(w,h,a){let sina=0;let cosa=1;if(a!==0){sina=Math.sin(a);cosa=Math.cos(a)}this.transformPrecalc(w,h,sina,cosa)}transformPrecalc(w,h,sina,cosa){const ptsArr=this._ptsArr;for(let i=0,len=ptsArr.length;i<len;i+=2){const j=i+1;const x=ptsArr[i]*w;const y=ptsArr[j]*h;ptsArr[i]=x*cosa-y*sina;ptsArr[j]=y*cosa+x*sina}this._isBboxChanged=true}offset(x,y){const ptsArr=this._ptsArr;for(let i=0,len=ptsArr.length;i<len;i+=2){ptsArr[i]+=x;ptsArr[i+1]+=y}}containsPoint(a2x,a2y){const ptsArr=
this._ptsArr;if(a2x===ptsArr[0]&&a2y===ptsArr[1])return true;this._updateBbox();const bbox=this._bbox;const a1x=bbox.getLeft()-110;const a1y=bbox.getTop()-101;const a3x=bbox.getRight()+131;const a3y=bbox.getBottom()+120;let minAx12=0;let minAy12=0;let maxAx12=0;let maxAy12=0;let minAx32=0;let minAy32=0;let maxAx32=0;let maxAy32=0;if(a1x<a2x){minAx12=a1x;maxAx12=a2x}else{minAx12=a2x;maxAx12=a1x}if(a1y<a2y){minAy12=a1y;maxAy12=a2y}else{minAy12=a2y;maxAy12=a1y}if(a3x<a2x){minAx32=a3x;maxAx32=a2x}else{minAx32=
a2x;maxAx32=a3x}if(a3y<a2y){minAy32=a3y;maxAy32=a2y}else{minAy32=a2y;maxAy32=a3y}let count1=0;let count2=0;for(let i=0,len=ptsArr.length;i<len;i+=2){const j=(i+2)%len;const b1x=ptsArr[i];const b1y=ptsArr[i+1];const b2x=ptsArr[j];const b2y=ptsArr[j+1];if(C3.segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,minAx12,maxAx12,minAy12,maxAy12,b1x,b1y,b2x,b2y))++count1;if(C3.segmentsIntersectPreCalc(a3x,a3y,a2x,a2y,minAx32,maxAx32,minAy32,maxAy32,b1x,b1y,b2x,b2y))++count2}return count1%2===1||count2%2===1}intersectsPoly(poly,
offX,offY){const rPts=poly._ptsArr;const lPts=this._ptsArr;if(this.containsPoint(rPts[0]+offX,rPts[1]+offY))return true;if(poly.containsPoint(lPts[0]-offX,lPts[1]-offY))return true;for(let i=0,leni=lPts.length;i<leni;i+=2){const j=(i+2)%leni;const a1x=lPts[i];const a1y=lPts[i+1];const a2x=lPts[j];const a2y=lPts[j+1];let minAx=0;let minAy=0;let maxAx=0;let maxAy=0;if(a1x<a2x){minAx=a1x;maxAx=a2x}else{minAx=a2x;maxAx=a1x}if(a1y<a2y){minAy=a1y;maxAy=a2y}else{minAy=a2y;maxAy=a1y}for(let k=0,lenk=rPts.length;k<
lenk;k+=2){const l=(k+2)%lenk;const b1x=rPts[k]+offX;const b1y=rPts[k+1]+offY;const b2x=rPts[l]+offX;const b2y=rPts[l+1]+offY;if(C3.segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,minAx,maxAx,minAy,maxAy,b1x,b1y,b2x,b2y))return true}}return false}intersectsSegment(offX,offY,a1x,a1y,a2x,a2y){if(this.containsPoint(a1x-offX,a1y-offY))return true;if(this.containsPoint(a2x-offX,a2y-offY))return true;let minAx=0;let minAy=0;let maxAx=0;let maxAy=0;if(a1x<a2x){minAx=a1x;maxAx=a2x}else{minAx=a2x;maxAx=a1x}if(a1y<
a2y){minAy=a1y;maxAy=a2y}else{minAy=a2y;maxAy=a1y}const ptsArr=this._ptsArr;for(let i=0,len=ptsArr.length;i<len;i+=2){const j=(i+2)%len;const b1x=ptsArr[i]+offX;const b1y=ptsArr[i+1]+offY;const b2x=ptsArr[j]+offX;const b2y=ptsArr[j+1]+offY;if(C3.segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,minAx,maxAx,minAy,maxAy,b1x,b1y,b2x,b2y))return true}return false}mirror(px){const ptsArr=this._ptsArr;for(let i=0,len=ptsArr.length;i<len;i+=2)ptsArr[i]=px*2-ptsArr[i];this._isBboxChanged=true}flip(py){const ptsArr=
this._ptsArr;for(let i=0,len=ptsArr.length;i<len;i+=2){const j=i+1;ptsArr[j]=py*2-ptsArr[j]}this._isBboxChanged=true}diag(){const ptsArr=this._ptsArr;for(let i=0,len=ptsArr.length;i<len;i+=2){const j=i+1;const temp=ptsArr[i];ptsArr[i]=ptsArr[j];ptsArr[j]=temp}this._isBboxChanged=true}GetMidX(){const ptsArr=this._ptsArr;let ret=0;for(let i=0,len=ptsArr.length;i<len;i+=2)ret+=ptsArr[i];return ret/this.pointCount()}GetMidY(){const ptsArr=this._ptsArr;let ret=0;for(let i=0,len=ptsArr.length;i<len;i+=
2)ret+=ptsArr[i+1];return ret/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}};

}

// lib/misc/pairMap.js
{
'use strict';const C3=self.C3;
C3.PairMap=class PairMap extends C3.DefendedBase{constructor(iterable){super();this._firstMap=new Map;if(iterable)for(const [x,y,value]of iterable)this.Set(x,y,value)}Release(){this.Clear();this._firstMap=null}IsEmpty(){return this._firstMap.size===0}Clear(){const firstMap=this._firstMap;for(const secondMap of firstMap.values())secondMap.clear();firstMap.clear()}Set(x,y,value){const firstMap=this._firstMap;let secondMap=firstMap.get(x);if(!secondMap){secondMap=new Map;firstMap.set(x,secondMap)}secondMap.set(y,
value)}Get(x,y){const secondMap=this._firstMap.get(x);if(!secondMap)return secondMap;return secondMap.get(y)}Has(x,y){const secondMap=this._firstMap.get(x);if(!secondMap)return false;return secondMap.has(y)}Delete(x,y){const firstMap=this._firstMap;const secondMap=firstMap.get(x);if(!secondMap)return false;const ret=secondMap.delete(y);if(ret&&secondMap.size===0)firstMap.delete(x);return ret}DeleteEither(k){const firstMap=this._firstMap;const secondMap=firstMap.get(k);if(secondMap){secondMap.clear();
firstMap.delete(k)}for(const [x,secondMap]of firstMap.entries())if(secondMap.delete(k)&&secondMap.size===0)firstMap.delete(x)}GetSize(){let ret=0;for(const secondMap of this._firstMap.values())ret+=secondMap.size;return ret}*values(){for(const secondMap of this._firstMap.values())yield*secondMap.values()}*keyPairs(){for(const [x,secondMap]of this._firstMap.entries())for(const y of secondMap.keys())yield[x,y]}*entries(){for(const [x,secondMap]of this._firstMap.entries())for(const [y,value]of secondMap.entries())yield[x,
y,value]}};

}

// lib/misc/arraySet.js
{
'use strict';const C3=self.C3;
C3.ArraySet=class ArraySet extends C3.DefendedBase{constructor(){super();this._set=new Set;this._arr=[];this._needToRebuildArray=false}Release(){this.Clear()}Clear(){this._set.clear();C3.clearArray(this._arr);this._needToRebuildArray=false}Add(v){if(this._set.has(v))return;this._set.add(v);if(!this._needToRebuildArray)this._arr.push(v)}Has(v){return this._set.has(v)}Delete(v){if(this._set.delete(v))this._needToRebuildArray=true}GetSize(){return this._set.size}IsEmpty(){return this._set.size===0}GetArray(){if(this._needToRebuildArray){this._RebuildArray();
this._needToRebuildArray=false}return this._arr}_RebuildArray(){const arr=this._arr;C3.clearArray(arr);for(const v of this._set)arr.push(v)}};

}

// ../lib/misc/ease.js
{
'use strict';const C3=self.C3;const EASE_MAP=new Map;const PREDEFINED_EASE_MAP=new Map;const CUSTOM_EASE_EDITOR_MAP=new Map;const CUSTOM_EASE_DATA_EDITOR_MAP=new Map;const CUSTOM_EASE_RUNTIME_MAP=new Map;const CUSTOM_EASE_DATA_RUNTIME_MAP=new Map;const PRIVATE_EASE_MAP=new Map;const BUILT_IN_TRANSITION_MAP=new Map;const ALIAS_MAP=new Map;ALIAS_MAP.set("linear","noease");ALIAS_MAP.set("default","noease");
const EASE_TRANSLATION_KEYS=["default","noease","easeinquad","easeoutquad","easeinoutquad","easeincubic","easeoutcubic","easeinoutcubic","easeinquart","easeoutquart","easeinoutquart","easeinquint","easeoutquint","easeinoutquint","easeinsine","easeoutsine","easeinoutsine","easeinexpo","easeoutexpo","easeinoutexpo","easeincirc","easeoutcirc","easeinoutcirc","easeinelastic","easeoutelastic","easeinoutelastic","easeinback","easeoutback","easeinoutback","easeinbounce","easeoutbounce","easeinoutbounce"];
const SHORT_EASE_TRANSLATION_KEYS=["default","noease","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"];
const EASE_API2INTERNAL_NAMES=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],
["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]);
self.Ease=class Ease{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static ToInternal(ease){return EASE_API2INTERNAL_NAMES.get(ease)}static GetEditorEaseNames(project,...filter){this._CreateEaseMap();let customEaseMap;let customEases;if(project){if(!CUSTOM_EASE_EDITOR_MAP.has(project))CUSTOM_EASE_EDITOR_MAP.set(project,new Map);customEaseMap=CUSTOM_EASE_EDITOR_MAP.get(project);customEases=[...customEaseMap.keys()].filter(ease=>{if(Ease.GetEditorEaseData(ease,
project))return Ease.GetEditorEaseData(ease,project).transition.IsForAnyPurpose();return true})}else{customEaseMap=CUSTOM_EASE_RUNTIME_MAP;customEases=[...customEaseMap.keys()]}const sortedCustomEases=customEases.sort();return[...PREDEFINED_EASE_MAP.keys()].concat(sortedCustomEases).filter(ease=>!filter.includes(ease))}static GetRuntimeEaseNames(){this._CreateEaseMap();const sortedCustomEases=[...CUSTOM_EASE_RUNTIME_MAP.keys()];sortedCustomEases.sort();return[...PREDEFINED_EASE_MAP.keys()].concat(sortedCustomEases)}static GetCustomRuntimeEaseNames(){this._CreateEaseMap();
const sortedCustomEases=[...CUSTOM_EASE_RUNTIME_MAP.keys()];sortedCustomEases.sort();return sortedCustomEases}static IsPredefinedTranslatedName(easeName){for(const k of EASE_TRANSLATION_KEYS){const translatedName=self.lang(`ui.bars.timeline.eases.${k}`);if(translatedName===easeName)return true}for(const k of SHORT_EASE_TRANSLATION_KEYS){const translatedName=self.lang(`ui.bars.timeline.short-eases.${k}`);if(translatedName===easeName)return true}}static IsNamePredefined(easeName){this._CreateEaseMap();
return[...PREDEFINED_EASE_MAP.keys()].includes(easeName)}static _GetEase(easeName){const realEaseName=ALIAS_MAP.get(easeName);if(realEaseName)return EASE_MAP.get(realEaseName);if(Ease.IsNamePredefined(easeName))return EASE_MAP.get(easeName);if(PRIVATE_EASE_MAP.has(easeName))return PRIVATE_EASE_MAP.get(easeName)}static GetBuiltInTransition(builtInTransitionName){this._CreateEaseMap();return BUILT_IN_TRANSITION_MAP.get(builtInTransitionName)}static GetEditorEase(easeName,project){this._CreateEaseMap();
const ease=Ease._GetEase(easeName);if(ease)return ease;if(!project)throw new Error("missing ease function");return CUSTOM_EASE_EDITOR_MAP.get(project).get(easeName)}static GetEditorEaseData(easeName,project){this._CreateEaseMap();const customEaseDataMap=CUSTOM_EASE_DATA_EDITOR_MAP.get(project);if(customEaseDataMap)return customEaseDataMap.get(easeName)}static HasEditorEase(easeName,project){this._CreateEaseMap();const ease=Ease._GetEase(easeName);if(ease)return true;return!!CUSTOM_EASE_EDITOR_MAP.get(project).get(easeName)}static GetRuntimeEase(easeName){this._CreateEaseMap();
const ease=Ease._GetEase(easeName);if(ease)return ease;return CUSTOM_EASE_RUNTIME_MAP.get(easeName)}static GetRuntimeEaseData(easeName){this._CreateEaseMap();return CUSTOM_EASE_DATA_RUNTIME_MAP.get(easeName)}static GetEaseFromIndex(index){this._CreateEaseMap();const names=this.GetRuntimeEaseNames();return names[index]}static GetIndexForEase(name,project){this._CreateEaseMap();const names=this.GetEditorEaseNames(project);return names.indexOf(name)}static GetIndexForEaseAtRuntime(name){return this.GetIndexForEase(name)}static _CreateEaseMap(){if(EASE_MAP.size!==
0)return;this._AddPredifinedEase("default",()=>{});this._AddPredifinedEase("noease",[{"x":0,"y":0,"sax":.336,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.336,"eay":0,"se":false,"ee":true}],true);this._AddPredifinedEase("easeinsine",[{"x":0,"y":0,"sax":.485,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.038,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutsine",[{"x":0,"y":0,"sax":.038,"say":0,"eax":0,"eay":0,
"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.485,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutsine",[{"x":0,"y":0,"sax":.336,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.336,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinelastic",[{"x":0,"y":0,"sax":.018,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.116,"y":.002,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.266,"y":-.005,"sax":.024,"say":0,
"eax":-.021,"eay":0,"se":true,"ee":true},{"x":.416,"y":.016,"sax":.024,"say":0,"eax":-.026,"eay":0,"se":true,"ee":true},{"x":.566,"y":-.045,"sax":.061,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.716,"y":.132,"sax":.072,"say":-.004,"eax":-.045,"eay":0,"se":true,"ee":true},{"x":.866,"y":-.373,"sax":.06,"say":0,"eax":-.049,"eay":-.002,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.038,"eay":-.263,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutelastic",[{"x":0,"y":0,"sax":.038,
"say":.263,"eax":0,"eay":0,"se":true,"ee":false},{"x":.136,"y":1.373,"sax":.049,"say":.002,"eax":-.06,"eay":0,"se":true,"ee":true},{"x":.286,"y":.868,"sax":.045,"say":0,"eax":-.072,"eay":.004,"se":true,"ee":true},{"x":.436,"y":1.045,"sax":.025,"say":0,"eax":-.061,"eay":0,"se":true,"ee":true},{"x":.586,"y":.984,"sax":.026,"say":0,"eax":-.024,"eay":0,"se":true,"ee":true},{"x":.736,"y":1.005,"sax":.021,"say":0,"eax":-.024,"eay":0,"se":true,"ee":true},{"x":.886,"y":.998,"sax":.025,"say":0,"eax":-.025,
"eay":0,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.018,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutelastic",[{"x":0,"y":0,"sax":.025,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.067,"y":.001,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.18,"y":-.005,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.292,"y":.025,"sax":.053,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.405,"y":-.118,"sax":.069,"say":0,"eax":-.027,
"eay":0,"se":true,"ee":true},{"x":.597,"y":1.118,"sax":.027,"say":0,"eax":-.069,"eay":0,"se":true,"ee":true},{"x":.71,"y":.975,"sax":.025,"say":0,"eax":-.053,"eay":0,"se":true,"ee":true},{"x":.822,"y":1.005,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.935,"y":.999,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.025,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinback",[{"x":0,"y":0,"sax":.35,"say":0,"eax":0,"eay":0,
"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.34,"eay":-1.579,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutback",[{"x":0,"y":0,"sax":.34,"say":1.579,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.35,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutback",[{"x":0,"y":0,"sax":.035,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.242,"y":-.1,"sax":.258,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.76,"y":1.1,"sax":.025,"say":0,
"eax":-.26,"eay":0,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.035,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinbounce",[{"x":0,"y":0,"sax":.033,"say":.025,"eax":0,"eay":0,"se":true,"ee":false},{"x":.092,"y":0,"sax":.026,"say":.078,"eax":-.033,"eay":.025,"se":true,"ee":true},{"x":.274,"y":0,"sax":.097,"say":.319,"eax":-.026,"eay":.078,"se":true,"ee":true},{"x":.637,"y":0,"sax":.105,"say":.625,"eax":-.097,"eay":.319,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,
"eax":-.125,"eay":-.004,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutbounce",[{"x":0,"y":0,"sax":.125,"say":.004,"eax":0,"eay":0,"se":true,"ee":false},{"x":.365,"y":1,"sax":.097,"say":-.319,"eax":-.105,"eay":-.625,"se":true,"ee":true},{"x":.728,"y":1,"sax":.026,"say":-.078,"eax":-.097,"eay":-.319,"se":true,"ee":true},{"x":.91,"y":1,"sax":.033,"say":-.025,"eax":-.026,"eay":-.078,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.033,"eay":-.025,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutbounce",
[{"x":0,"y":0,"sax":.01,"say":.006,"eax":0,"eay":0,"se":true,"ee":false},{"x":.046,"y":0,"sax":.021,"say":.038,"eax":-.01,"eay":.006,"se":true,"ee":true},{"x":.137,"y":0,"sax":.059,"say":.158,"eax":-.021,"eay":.038,"se":true,"ee":true},{"x":.319,"y":0,"sax":.117,"say":.744,"eax":-.059,"eay":.158,"se":true,"ee":true},{"x":.683,"y":1,"sax":.059,"say":-.158,"eax":-.117,"eay":-.744,"se":true,"ee":true},{"x":.865,"y":1,"sax":.021,"say":-.038,"eax":-.059,"eay":-.158,"se":true,"ee":true},{"x":.956,"y":1,
"sax":.01,"say":-.006,"eax":-.021,"eay":-.038,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.01,"eay":-.006,"se":false,"ee":true}]);this._AddPredifinedEase("easeincubic",[{"x":0,"y":0,"sax":.75,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.138,"eay":-.321,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutcubic",[{"x":0,"y":0,"sax":.138,"say":.321,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.75,"eay":0,"se":false,"ee":true}]);
this._AddPredifinedEase("easeinoutcubic",[{"x":0,"y":0,"sax":.285,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.5,"y":.5,"sax":.081,"say":.272,"eax":-.081,"eay":-.272,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.285,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinquad",[{"x":0,"y":0,"sax":.4,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.178,"eay":-.392,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutquad",[{"x":0,"y":0,
"sax":.178,"say":.392,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.4,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutquad",[{"x":0,"y":0,"sax":.25,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.5,"y":.5,"sax":.03,"say":.065,"eax":-.03,"eay":-.065,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.25,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinquart",[{"x":0,"y":0,"sax":.25,"say":1,"eax":0,"eay":0,"se":true,"ee":false},
{"x":1,"y":1,"sax":0,"say":0,"eax":-.5,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutquart",[{"x":0,"y":0,"sax":.5,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.25,"eay":-1,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutquart",[{"x":0,"y":0,"sax":.765,"say":.03,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.765,"eay":-.03,"se":false,"ee":true}]);this._AddPredifinedEase("easeinquint",[{"x":0,"y":0,"sax":.6,
"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.2,"eay":-1,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutquint",[{"x":0,"y":0,"sax":.2,"say":1,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.6,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutquint",[{"eax":0,"eay":0,"ee":false,"sax":.84,"say":0,"se":true,"x":0,"y":0},{"eax":-.84,"eay":0,"ee":true,"sax":0,"say":0,"se":false,"x":1,"y":1}]);this._AddPredifinedEase("easeincirc",
[{"x":0,"y":0,"sax":.25,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.024,"eay":-.808,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutcirc",[{"x":0,"y":0,"sax":.024,"say":.808,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.25,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutcirc",[{"x":0,"y":0,"sax":.125,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.5,"y":.5,"sax":.02,"say":.428,"eax":-.02,"eay":-.428,
"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.125,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinexpo",[{"x":0,"y":0,"sax":.66,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.14,"eay":-1,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutexpo",[{"x":0,"y":0,"sax":.14,"say":1,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.66,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutexpo",[{"eax":0,
"eay":0,"ee":false,"sax":.345,"say":0,"se":true,"x":0,"y":0},{"eax":-.06,"eay":-.5,"ee":true,"sax":.06,"say":.5,"se":true,"x":.5,"y":.5},{"eax":-.335,"eay":0,"ee":true,"sax":0,"say":0,"se":false,"x":1,"y":1}]);this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier);this._AddPrivateCustomEase("spline",this.EaseSpline)}static _AddPredifinedEase(name,dataArray_or_function,linear=false){if(typeof dataArray_or_function==="function")Ease._AddEase(name,dataArray_or_function,"predefined");else if(C3.IsArray(dataArray_or_function))if(self.BuiltInTransition){const builtInTransition=
C3.New(self.BuiltInTransition,name,linear);builtInTransition.SetFromJson(dataArray_or_function);Ease._AddEase(name,(t,sv,dv,tt)=>builtInTransition.Interpolate(t,sv,dv,tt),"predefined");BUILT_IN_TRANSITION_MAP.set(name,builtInTransition)}else{const builtInTransition=C3.New(C3.Transition,[name,dataArray_or_function.map(data=>{return[data["x"],data["y"],data["sax"],data["say"],data["eax"],data["eay"],data["se"],data["ee"]]})],false);builtInTransition.MakeLinear(linear);Ease._AddEase(name,(t,sv,dv,tt)=>
builtInTransition.Interpolate(t,sv,dv,tt),"predefined")}else throw new Error("unexpected arguments");}static _AddPrivateCustomEase(name,func){Ease._AddEase(name,func,"private")}static AddCustomEase(name,func,project,data){this._CreateEaseMap();Ease._AddEase(name,func,"custom",project,data)}static RemoveCustomEase(name,project){if(this.IsNamePredefined(name))return;if([...PRIVATE_EASE_MAP.keys()].includes(name))return;const customEaseMap=CUSTOM_EASE_EDITOR_MAP.get(project);if(customEaseMap)customEaseMap.delete(name);
const customEaseDataMap=CUSTOM_EASE_DATA_EDITOR_MAP.get(project);if(customEaseDataMap)customEaseDataMap.delete(name)}static _AddEase(name,func,mode,project,data){switch(mode){case "predefined":{EASE_MAP.set(name,func);PREDEFINED_EASE_MAP.set(name,func);break}case "custom":{if(project){if(!CUSTOM_EASE_EDITOR_MAP.has(project))CUSTOM_EASE_EDITOR_MAP.set(project,new Map);if(!CUSTOM_EASE_DATA_EDITOR_MAP.has(project))CUSTOM_EASE_DATA_EDITOR_MAP.set(project,new Map);const customEaseMap=CUSTOM_EASE_EDITOR_MAP.get(project);
customEaseMap.set(name,func);const customEaseDataMap=CUSTOM_EASE_DATA_EDITOR_MAP.get(project);customEaseDataMap.set(name,data)}else{CUSTOM_EASE_RUNTIME_MAP.set(name,func);CUSTOM_EASE_DATA_RUNTIME_MAP.set(name,data)}break}case "private":{EASE_MAP.set(name,func);PRIVATE_EASE_MAP.set(name,func);break}default:throw new Error("unexpected ease mode");}}static NoEase(t,b,c,d){if(d===0)return b;return c*t/d+b}static EaseCubicBezier(t,p0,p1,p2,p3){const _0=p0;const _1=3*t*(p1-p0);const _2=3*t**2*(p0+p2-2*
p1);const _3=t**3*(p3-p0+3*p1-3*p2);return _0+_1+_2+_3}static EaseSpline(t,sx,sy,x1,y1,x2,y2,ex,ey,samples){if(x1===y1&&x2===y2)return t;const tx=get_t_for_x(t,sx,x1,x2,ex,samples);const va=a(sy,y1,y2,ey);const vb=b(sy,y1,y2,ey);const vc=c(sy,y1,y2,ey);return calc_bezier(tx,va,vb,vc)}static GetBezierSamples(startx,a1x,a2x,endx){const ret=[];const va=a(startx,a1x,a2x,endx);const vb=b(startx,a1x,a2x,endx);const vc=c(startx,a1x,a2x,endx);for(let i=0;i<SAMPLE_COUNT;++i){const sample=calc_bezier(i*SAMPLE_STEP,
va,vb,vc);ret.push(sample)}return ret}};const SAMPLE_COUNT=11;const SAMPLE_STEP=1/(SAMPLE_COUNT-1);const NEWTON_RAPHSON_ITERATIONS=4;const NEWTON_RAPHSON_MIN_SLOPE=.01;const SUBDIVISION_PRECISION=1E-7;const SUBDIVISION_MAX_ITERATIONS=10;const a=(p0,p1,p2,p3)=>{return p3-3*p2+3*p1-p0};const b=(p0,p1,p2,p3)=>{return 3*p2-6*p1+3*p0};const c=(p0,p1,p2,p3)=>{return 3*(p1-p0)};const calc_bezier=(aT,a,b,c)=>{return((a*aT+b)*aT+c)*aT};const get_slope=(aT,a,b,c)=>{return 3*a*aT*aT+2*b*aT+c};
const get_t_for_x=(aX,p0,p1,p2,p3,samples)=>{if(aX==1)return 1;let intervalStart=0;let currentSampleIndex=1;let currentSampleValue=samples[currentSampleIndex];let lastSampleIndex=SAMPLE_COUNT-1;let lastSampleValue=samples[SAMPLE_COUNT-1];while(currentSampleIndex!=lastSampleIndex&&currentSampleValue<=aX){currentSampleIndex++;currentSampleValue=samples[currentSampleIndex];intervalStart+=SAMPLE_STEP}currentSampleIndex--;currentSampleValue=samples[currentSampleIndex];const dist=(aX-currentSampleValue)/
(samples[currentSampleIndex+1]-currentSampleValue);let guess=intervalStart+dist*SAMPLE_STEP;const va=a(p0,p1,p2,p3);const vb=b(p0,p1,p2,p3);const vc=c(p0,p1,p2,p3);const initSlope=get_slope(guess,va,vb,vc);if(initSlope===0)return guess;else if(initSlope>=NEWTON_RAPHSON_MIN_SLOPE){for(let i=0;i<NEWTON_RAPHSON_ITERATIONS;++i){const x=calc_bezier(guess,va,vb,vc)-aX;const slope=get_slope(guess,va,vb,vc);guess-=x/slope}return guess}else{let aA=intervalStart;let aB=intervalStart+SAMPLE_STEP;let i=0;let precissionLimit;
let maxIterations;do{guess=aA+(aB-aA)/2;let x=calc_bezier(guess,va,vb,vc)-aX;if(x>0)aB=guess;else aA=guess;precissionLimit=Math.abs(x)>SUBDIVISION_PRECISION;maxIterations=++i<SUBDIVISION_MAX_ITERATIONS}while(precissionLimit&&maxIterations);return guess}};

}

// ../lib/misc/probability.js
{
'use strict';const C3=self.C3;function RequireStringOrNumber(value){if(!C3.IsString(value));}
C3.ProbabilityTable=class ProbabilityTable{constructor(name){this._items=[];this._name=name||"";this._totalWeight=0}Release(){this.Clear();this._items=null}GetName(){return this._name}Clear(){C3.clear2DArray(this._items);this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(t=Math.random()*this.GetTotalWeight()){let sumWeight=0;for(const [weight,value]of this._items){sumWeight+=weight;if(t<sumWeight)return value}return 0}AddItem(weight,value){RequireStringOrNumber(value);this._totalWeight+=
weight;this._items.push([weight,value])}RemoveItem(weight,value){RequireStringOrNumber(value);const ignoreWeight=weight===0;for(let i=0;i<this._items.length;i++){const item=this._items[i];const doesWeightMatch=ignoreWeight||item[0]===weight;const doesValueMatch=item[1]===value;if(doesWeightMatch&&doesValueMatch){this._items.splice(i,1);this._totalWeight-=item[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(str){const table=new C3.ProbabilityTable;const items=JSON.parse(str);
for(const item of items){const weight=item[0];const value=item[1];table.AddItem(weight,value)}return table}};

}

// lib/misc/screenReaderText.js
{
'use strict';const C3=self.C3;let nextId=0;
C3.ScreenReaderText=class ScreenReaderText{constructor(runtime,text){this._runtime=runtime;this._text=text;this._id=nextId++;this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{"type":"create","id":this._id,"text":this._text})}Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{"type":"release","id":this._id});this._runtime=null;this._text="";this._id=-1}SetText(text){if(this._text===text)return;this._text=text;this._runtime.PostComponentMessageToDOM("runtime",
"screen-reader-text",{"type":"update","id":this._id,"text":this._text})}};

}

// ../lib/events/event.js
{
'use strict';const C3=self.C3;
C3.Event=class Event{constructor(type,cancelable){this.type=type;this.cancelable=!!cancelable;this.defaultPrevented=false;this.propagationStopped=false;this.isAsync=false}preventDefault(){if(!this.cancelable)throw new Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=true}stopPropagation(){if(!this.cancelable)throw new Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw new Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=true}};

}

// ../lib/events/handler.js
{
'use strict';const C3=self.C3;const assert=self.assert;
C3.Event.Handler=class EventHandler extends C3.DefendedBase{constructor(type){super();this._type=type;this._captureListeners=[];this._captureListenersSet=new Set;this._listeners=[];this._listenersSet=new Set;this._fireDepth=0;this._queueModifyListeners=[]}Release(){if(this._fireDepth>0)return;C3.clearArray(this._captureListeners);this._captureListenersSet.clear();C3.clearArray(this._listeners);this._listenersSet.clear();C3.clearArray(this._queueModifyListeners);C3.Release(this)}_AddListener(func,
capture){if(this._IsFiring()){this._queueModifyListeners.push({op:"add",func,capture});return}if(capture){if(this._captureListenersSet.has(func))return;this._captureListeners.push(func);this._captureListenersSet.add(func)}else{if(this._listenersSet.has(func))return;this._listeners.push(func);this._listenersSet.add(func)}}_RemoveListener(func,capture){if(this._IsFiring()){this._queueModifyListeners.push({op:"remove",func,capture});return}if(capture){if(this._captureListenersSet.has(func)){this._captureListenersSet.delete(func);
C3.arrayFindRemove(this._captureListeners,func)}}else if(this._listenersSet.has(func)){this._listenersSet.delete(func);C3.arrayFindRemove(this._listeners,func)}}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return this._fireDepth>0}_ProcessQueuedListeners(){const removeListenersSet=new Set;const removeCaptureListenersSet=new Set;for(const q of this._queueModifyListeners)if(q.op==="add"){this._AddListener(q.func,q.capture);if(q.capture)removeCaptureListenersSet.delete(q.func);
else removeListenersSet.delete(q.func)}else if(q.op==="remove")if(q.capture){this._captureListenersSet.delete(q.func);removeCaptureListenersSet.add(q.func)}else{this._listenersSet.delete(q.func);removeListenersSet.add(q.func)}else throw new Error("invalid op");C3.arrayRemoveAllInSet(this._listeners,removeListenersSet);C3.arrayRemoveAllInSet(this._captureListeners,removeCaptureListenersSet);C3.clearArray(this._queueModifyListeners)}_FireCancellable(event){this._IncreaseFireDepth();let isStopped=false;
for(let i=0,len=this._captureListeners.length;i<len;++i){this._captureListeners[i](event);if(event.propagationStopped){isStopped=true;break}}if(!isStopped)for(let i=0,len=this._listeners.length;i<len;++i){this._listeners[i](event);if(event.propagationStopped)break}this._DecreaseFireDepth();return!event.defaultPrevented}_FireNonCancellable(event){this._IncreaseFireDepth();for(let i=0,len=this._captureListeners.length;i<len;++i)this._captureListeners[i](event);for(let i=0,len=this._listeners.length;i<
len;++i)this._listeners[i](event);this._DecreaseFireDepth();return true}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--;if(this._fireDepth===0&&this._queueModifyListeners.length>0)this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(e){if(e)this._IncreaseFireDepth();else this._DecreaseFireDepth()}_FireAsync(event){let callbackPromises=[];for(let i=0,len=this._captureListeners.length;i<len;++i){let func=this._captureListeners[i];callbackPromises.push(C3.Asyncify(()=>
func(event)))}for(let i=0,len=this._listeners.length;i<len;++i){let func=this._listeners[i];callbackPromises.push(C3.Asyncify(()=>func(event)))}return Promise.all(callbackPromises).then(()=>!event.defaultPrevented)}_FireAndWait_AsyncOptional(event){const results=[];this._IncreaseFireDepth();for(let i=0,len=this._captureListeners.length;i<len;++i){const ret=this._captureListeners[i](event);if(ret instanceof Promise)results.push(ret)}for(let i=0,len=this._listeners.length;i<len;++i){const ret=this._listeners[i](event);
if(ret instanceof Promise)results.push(ret)}this._DecreaseFireDepth();if(results.length)return Promise.all(results).then(()=>!event.defaultPrevented);else return!event.defaultPrevented}async _FireAndWaitAsync(event){return await this._FireAndWait_AsyncOptional(event)}async _FireAndWaitAsyncSequential(event){this._IncreaseFireDepth();for(let i=0,len=this._captureListeners.length;i<len;++i){const ret=this._captureListeners[i](event);if(ret instanceof Promise)await ret}for(let i=0,len=this._listeners.length;i<
len;++i){const ret=this._listeners[i](event);if(ret instanceof Promise)await ret}this._DecreaseFireDepth();return!event.defaultPrevented}*_FireAsGenerator(event){this._IncreaseFireDepth();for(let i=0,len=this._captureListeners.length;i<len;++i){const ret=this._captureListeners[i](event);if(C3.IsIterator(ret))yield*ret}for(let i=0,len=this._listeners.length;i<len;++i){const ret=this._listeners[i](event);if(C3.IsIterator(ret))yield*ret}this._DecreaseFireDepth()}};

}

// ../lib/events/dispatcher.js
{
'use strict';const C3=self.C3;
C3.Event.Dispatcher=class EventDispatcher extends C3.DefendedBase{constructor(){super();this._eventHandlers=new Map;this._dispatcherWasReleased=false}Release(){if(this._dispatcherWasReleased)throw new Error("already released");this.ClearEvents();this._dispatcherWasReleased=true;C3.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){if(this._eventHandlers){for(let handler of this._eventHandlers.values())handler.Release();this._eventHandlers.clear()}}_GetHandlerByType(type,create_if_missing){let handler=
this._eventHandlers.get(type);if(handler)return handler;if(create_if_missing){handler=C3.New(C3.Event.Handler,type);this._eventHandlers.set(type,handler);return handler}return null}HasAnyHandlerFor(type){return this._eventHandlers.has(type)}addEventListener(type,func,capture){let handler=this._GetHandlerByType(type,true);handler._AddListener(func,!!capture)}removeEventListener(type,func,capture){let handler=this._GetHandlerByType(type,false);if(!handler)return;handler._RemoveListener(func,!!capture);
if(handler._IsEmpty())this._eventHandlers.delete(type)}dispatchEvent(event){const handler=this._GetHandlerByType(event.type,false);if(!handler)return true;if(event.cancelable)return handler._FireCancellable(event);else return handler._FireNonCancellable(event)}dispatchEventAsync(event){const handler=this._GetHandlerByType(event.type,false);if(!handler)return Promise.resolve(true);event.isAsync=true;return handler._FireAsync(event)}async dispatchEventAndClearAsync(event){const handler=this._GetHandlerByType(event.type,
false);if(!handler)return true;this._eventHandlers.delete(event.type);event.isAsync=true;const ret=await handler._FireAsync(event);handler.Release();return ret}async dispatchEventAndWaitAsync(event){const handler=this._GetHandlerByType(event.type,false);if(!handler)return true;return await handler._FireAndWaitAsync(event)}dispatchEventAndWait_AsyncOptional(event){const handler=this._GetHandlerByType(event.type,false);if(!handler)return true;return handler._FireAndWait_AsyncOptional(event)}async dispatchEventAndWaitAsyncSequential(event){const handler=
this._GetHandlerByType(event.type,false);if(!handler)return true;return await handler._FireAndWaitAsyncSequential(event)}dispatchGeneratorEvent(event){const handler=this._GetHandlerByType(event.type,false);if(!handler)return null;if(event.cancelable)throw new Error("not supported");else return handler._FireAsGenerator(event)}SetDelayRemoveEventsEnabled(e){for(const handler of this._eventHandlers.values())handler.SetDelayRemoveEventsEnabled(e)}};

}

// ../lib/util/asyncify.js
{
'use strict';const C3=self.C3;const SETTIMEOUT_WORK_DURATION=12;const SETTIMEOUT_INTERVAL=16;const IDLECALLBACK_TIMEOUT=35;const SUPPORTS_RIC=typeof requestIdleCallback!=="undefined";let workQueue=[];let callbackId=-1;let highThroughputMode=0;function SetNewCallback(timerTimeout){if(SUPPORTS_RIC&&highThroughputMode===0)callbackId=requestIdleCallback(DoAsyncifiedWork,{timeout:IDLECALLBACK_TIMEOUT});else callbackId=setTimeout(DoAsyncifiedWork,highThroughputMode>0?1:timerTimeout)}
function DoAsyncifiedWork(deadline){callbackId=-1;if(!workQueue.length)return;let startTime=performance.now();let curTime=startTime;let jobCount=0;let estimatedNextJobDuration=0;do{DoNextAsyncifiedJob(workQueue.shift());curTime=performance.now();++jobCount;estimatedNextJobDuration=(curTime-startTime)/jobCount*1.1}while(workQueue.length&&(SUPPORTS_RIC&&highThroughputMode===0&&typeof deadline!=="undefined"?estimatedNextJobDuration<deadline["timeRemaining"]():curTime-startTime+estimatedNextJobDuration<
SETTIMEOUT_WORK_DURATION));if(callbackId===-1&&workQueue.length){let workDuration=curTime-startTime;let timeout=Math.max(SETTIMEOUT_INTERVAL-workDuration,4);SetNewCallback(timeout)}}function DoNextAsyncifiedJob(w){let ret;try{ret=w.func()}catch(e){w.reject(e);return}w.resolve(ret)}let asyncifyDisabled=C3.QueryString.Has("disable-asyncify");if(asyncifyDisabled)console.warn("[Asyncify] Asyncify has been disabled due to disable-asyncify in the query string. Some work will now be done synchronously.");
C3.Asyncify=function Asyncify(func){let stack=null;if(C3.isDebug)stack=C3.GetCallStack();return new Promise((resolve,reject)=>{workQueue.push({func:func,resolve:resolve,reject:reject,stack:stack});if(asyncifyDisabled){DoNextAsyncifiedJob(workQueue.pop());return}if(callbackId===-1)SetNewCallback(SETTIMEOUT_INTERVAL)})};
C3.Asyncify.SetHighThroughputMode=function SetHighThroughputMode(m){if(m)++highThroughputMode;else{--highThroughputMode;if(highThroughputMode<0)throw new Error("already turned off high throughput mode");}};

}

// ../lib/util/idleTimeout.js
{
'use strict';const C3=self.C3;const IDLE_CHECK_MIN_INTERVAL=1E3;const IDLE_CHECK_TIMER_OVERSHOOT=100;let cachedNowTime=-1;function ClearTimeCache(){cachedNowTime=-1}C3.FastGetDateNow=function FastGetDateNow(){if(cachedNowTime===-1){cachedNowTime=Date.now();self.setTimeout(ClearTimeCache,16)}return cachedNowTime};let timerId=-1;let nextDeadline=-1;let activeIdleTimeouts=new Set;
function CheckActiveIdleTimeouts(){timerId=-1;nextDeadline=-1;let nowTime=Date.now();for(let i of activeIdleTimeouts)if(i._CheckTimeout(nowTime)){let deadline=i._GetDeadline();if(nextDeadline===-1||deadline<nextDeadline)nextDeadline=deadline}else activeIdleTimeouts.delete(i);if(nextDeadline!==-1){let duration=Math.max(nextDeadline-nowTime+IDLE_CHECK_TIMER_OVERSHOOT,IDLE_CHECK_MIN_INTERVAL);timerId=self.setTimeout(CheckActiveIdleTimeouts,duration)}}
C3.IdleTimeout=class IdleTimeout{constructor(callback,timeoutInSeconds){this._callback=callback;this._timeout=timeoutInSeconds*1E3;this._deadline=0;this._isActive=false}Reset(){let nowTime=C3.FastGetDateNow();this._deadline=nowTime+this._timeout;if(!this._isActive){activeIdleTimeouts.add(this);this._isActive=true}if(timerId===-1){nextDeadline=this._deadline;timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT)}else if(this._deadline<nextDeadline&&nextDeadline>nowTime+
IDLE_CHECK_MIN_INTERVAL){self.clearTimeout(timerId);nextDeadline=this._deadline;timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT)}}_CheckTimeout(nowTime){if(nowTime>=this._deadline){if(this._callback()){this._deadline=nowTime+this._timeout;return true}this._isActive=false;return false}return true}_GetDeadline(){return this._deadline}Cancel(){if(this._isActive){activeIdleTimeouts.delete(this);this._isActive=false;if(activeIdleTimeouts.size===0&&timerId!==-1){self.clearTimeout(timerId);
timerId=-1;nextDeadline=-1}}}Release(){this.Cancel();this._callback=null}};

}

// ../lib/util/disposable.js
{
'use strict';const C3=self.C3;
C3.Disposable=class Disposable{constructor(disposeAction){this._disposed=false;this._disposeAction=disposeAction}Dispose(){if(this._disposed)return;this._disposed=true;if(this._disposeAction){this._disposeAction();this._disposeAction=null}}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(instance){return new Disposable(()=>instance.Release())}static From(eventDispatcher,eventNames,eventHandler,opts,scope){if(typeof opts==="undefined"||opts===null)opts=false;else if(typeof opts!==
"boolean"&&typeof opts!=="object")throw new TypeError("invalid event listener options");if(scope)eventHandler=eventHandler.bind(scope);if(eventNames.includes(" ")){eventNames=eventNames.split(" ");const disposable=new C3.CompositeDisposable;for(let eventName of eventNames){eventDispatcher.addEventListener(eventName,eventHandler,opts);disposable.Add(C3.New(C3.Disposable,()=>eventDispatcher.removeEventListener(eventName,eventHandler,opts)))}return disposable}else{eventDispatcher.addEventListener(eventNames,
eventHandler,opts);return C3.New(C3.Disposable,()=>eventDispatcher.removeEventListener(eventNames,eventHandler,opts))}}};C3.StubDisposable=class StubDisposable extends C3.Disposable{SetAction(disposeAction){this._disposeAction=disposeAction}};
C3.CompositeDisposable=class CompositeDisposable extends C3.Disposable{constructor(...disposables){super();this._disposables=new Set;for(let disposable of disposables)this.Add(disposable)}Add(...disposables){if(this._disposed)throw new Error("already disposed");for(let disposable of disposables)this._disposables.add(disposable)}Remove(disposable){if(this._disposed)throw new Error("already disposed");this._disposables.delete(disposable)}RemoveAll(){if(this._disposed)throw new Error("already disposed");
if(!this._disposables)return;for(let disposable of this._disposables)disposable.Dispose();this._disposables.clear()}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw new Error("already disposed");this._disposed=true;for(let disposable of this._disposables)disposable.Dispose();this._disposables.clear();this._disposables=null}Release(){this.Dispose()}};

}

// lib/util/kahanSum.js
{
'use strict';const C3=self.C3;C3.KahanSum=class KahanSum extends C3.DefendedBase{constructor(){super();this._c=0;this._y=0;this._t=0;this._sum=0}Add(v){v=+v;this._y=v-this._c;this._t=this._sum+this._y;this._c=this._t-this._sum-this._y;this._sum=this._t}Subtract(v){this._sum-=+v}Get(){return this._sum}Reset(){this._c=0;this._y=0;this._t=0;this._sum=0}Set(s){this._c=0;this._y=0;this._t=0;this._sum=+s}Copy(ks){this._c=ks._c;this._y=ks._y;this._t=ks._t;this._sum=ks._sum}Release(){}};

}

// lib/util/redblackset.js
{
'use strict';const C3=self.C3;const js_cols={};const RED=true;const BLACK=false;js_cols.RBnode=function(tree){this.tree=tree;this.right=this.tree.sentinel;this.left=this.tree.sentinel;this.parent=null;this.color=false;this.key=null};js_cols.RedBlackSet=function(compare_func){this.size=0;this.sentinel=new js_cols.RBnode(this);this.sentinel.color=BLACK;this.root=this.sentinel;this.root.parent=this.sentinel;this.compare=compare_func||this.default_compare};
js_cols.RedBlackSet.prototype.default_compare=function(a,b){if(a<b)return-1;else if(b<a)return 1;else return 0};js_cols.RedBlackSet.prototype.clone=function(){var rv=new js_cols.RedBlackSet(this.compare);rv.insertAll(this);return rv};js_cols.RedBlackSet.prototype.clear=function(){this.size=0;this.sentinel=new js_cols.RBnode(this);this.sentinel.color=BLACK;this.root=this.sentinel;this.root.parent=this.sentinel};
js_cols.RedBlackSet.prototype.leftRotate=function(x){var y=x.right;x.right=y.left;if(y.left!=this.sentinel)y.left.parent=x;y.parent=x.parent;if(x.parent==this.sentinel)this.root=y;else if(x==x.parent.left)x.parent.left=y;else x.parent.right=y;y.left=x;x.parent=y};
js_cols.RedBlackSet.prototype.rightRotate=function(x){var y=x.left;x.left=y.right;if(y.right!=this.sentinel)y.right.parent=x;y.parent=x.parent;if(x.parent==this.sentinel)this.root=y;else if(x==x.parent.right)x.parent.right=y;else x.parent.left=y;y.right=x;x.parent=y};
js_cols.RedBlackSet.prototype.insert=function(key){if(!this.contains(key)){var z=new js_cols.RBnode(this);z.key=key;var y=this.sentinel;var x=this.root;while(x!=this.sentinel){y=x;if(this.compare(z.key,x.key)<0)x=x.left;else x=x.right}z.parent=y;if(y==this.sentinel)this.root=z;else if(this.compare(z.key,y.key)<0)y.left=z;else y.right=z;z.left=this.sentinel;z.right=this.sentinel;z.color=RED;this.insertFixup(z);this.size++}else{var node=this.get_(key);node.key=key}};
js_cols.RedBlackSet.prototype.insertFixup=function(z){while(z!=this.sentinel&&z!=this.root&&z.parent.color==RED)if(z.parent==z.parent.parent.left){var y=z.parent.parent.right;if(y.color==RED){z.parent.color=BLACK;y.color=BLACK;z.parent.parent.color=RED;z=z.parent.parent}else{if(z==z.parent.right){z=z.parent;this.leftRotate(z)}z.parent.color=BLACK;z.parent.parent.color=RED;if(z.parent.parent!=this.sentinel)this.rightRotate(z.parent.parent)}}else{var y=z.parent.parent.left;if(y.color==RED){z.parent.color=
BLACK;y.color=BLACK;z.parent.parent.color=RED;z=z.parent.parent}else{if(z==z.parent.left){z=z.parent;this.rightRotate(z)}z.parent.color=BLACK;z.parent.parent.color=RED;if(z.parent.parent!=this.sentinel)this.leftRotate(z.parent.parent)}}this.root.color=BLACK};
js_cols.RedBlackSet.prototype.delete_=function(z){var y;var x;if(z.left==this.sentinel||z.right==this.sentinel)y=z;else y=this.successor_(z);if(y.left!=this.sentinel)x=y.left;else x=y.right;x.parent=y.parent;if(y.parent==this.sentinel)this.root=x;else if(y==y.parent.left)y.parent.left=x;else y.parent.right=x;if(y!=z)z.key=y.key;if(y.color==BLACK)this.deleteFixup(x);this.size--};
js_cols.RedBlackSet.prototype.deleteFixup=function(x){while(x!=this.root&&x.color==BLACK)if(x==x.parent.left){var w=x.parent.right;if(w.color==RED){w.color=BLACK;x.parent.color=RED;this.leftRotate(x.parent);w=x.parent.right}if(w.left.color==BLACK&&w.right.color==BLACK){w.color=RED;x=x.parent}else{if(w.right.color==BLACK){w.left.color=BLACK;w.color=RED;this.rightRotate(w);w=x.parent.right}w.color=x.parent.color;x.parent.color=BLACK;w.right.color=BLACK;this.leftRotate(x.parent);x=this.root}}else{var w=
x.parent.left;if(w.color==RED){w.color=BLACK;x.parent.color=RED;this.rightRotate(x.parent);w=x.parent.left}if(w.right.color==BLACK&&w.left.color==BLACK){w.color=RED;x=x.parent}else{if(w.left.color==BLACK){w.right.color=BLACK;w.color=RED;this.leftRotate(w);w=x.parent.left}w.color=x.parent.color;x.parent.color=BLACK;w.left.color=BLACK;this.rightRotate(x.parent);x=this.root}}x.color=BLACK};
js_cols.RedBlackSet.prototype.remove=function(key){var x=this.get_(key);if(x!=this.sentinel){var retval=x.key;this.delete_(x);return retval}else return null};js_cols.RedBlackSet.prototype.removeSwapped=function(value,key){this.remove(key)};js_cols.RedBlackSet.prototype.min=function(x){while(x.left!=this.sentinel)x=x.left;return x};js_cols.RedBlackSet.prototype.max=function(x){while(x.right!=this.sentinel)x=x.right;return x};
js_cols.RedBlackSet.prototype.successor_=function(x){if(x.right!=this.sentinel)return this.min(x.right);var y=x.parent;while(y!=this.sentinel&&x==y.right){x=y;y=y.parent}return y};js_cols.RedBlackSet.prototype.predeccessor_=function(x){if(x.left!=this.sentinel)return this.max(x.left);var y=x.parent;while(y!=this.sentinel&&x==y.left){x=y;y=y.parent}return y};
js_cols.RedBlackSet.prototype.successor=function(key){if(this.size>0){var x=this.get_(key);if(x==this.sentinel)return null;if(x.right!=this.sentinel)return this.min(x.right).key;var y=x.parent;while(y!=this.sentinel&&x==y.right){x=y;y=y.parent}if(y!=this.sentinel)return y.key;else return null}else return null};
js_cols.RedBlackSet.prototype.predecessor=function(key){if(this.size>0){var x=this.get_(key);if(x==this.sentinel)return null;if(x.left!=this.sentinel)return this.max(x.left).key;var y=x.parent;while(y!=this.sentinel&&x==y.left){x=y;y=y.parent}if(y!=this.sentinel)return y.key;else return null}else return null};js_cols.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key};js_cols.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key};
js_cols.RedBlackSet.prototype.get_=function(key){var x=this.root;while(x!=this.sentinel&&this.compare(x.key,key)!=0)if(this.compare(key,x.key)<0)x=x.left;else x=x.right;return x};js_cols.RedBlackSet.prototype.contains=function(key){return this.get_(key).key!=null};js_cols.RedBlackSet.prototype.getValues=function(){var ret=[];this.forEach(function(x){ret.push(x)});return ret};
js_cols.RedBlackSet.prototype.insertAll=function(col){if(js_cols.typeOf(col)=="array")for(var i=0;i<col.length;i++)this.insert(col[i]);else if(js_cols.typeOf(col.forEach)=="function")col.forEach(this.insert,this);else if(js_cols.typeOf(col.getValues)=="function"){var arr=col.getValues();for(var i=0;i<arr.length;i++)this.insert(arr[i])}else if(js_cols.typeOf(col)=="object")for(var key in col)this.insert(col[key])};
js_cols.RedBlackSet.prototype.removeAll=function(col){if(js_cols.typeOf(col)=="array")for(var i=0;i<col.length;i++)this.remove(col[i]);else if(js_cols.typeOf(col.forEach)=="function")col.forEach(this.removeSwapped,this);else if(js_cols.typeOf(col.getValues)=="function"){var arr=col.getValues();for(var i=0;i<arr.length;i++)this.remove(arr[i])}else if(js_cols.typeOf(col)=="object")for(var key in col)this.remove(col[key])};
js_cols.RedBlackSet.prototype.containsAll=function(col){if(js_cols.typeOf(col)=="array"){for(var i=0;i<col.length;i++)if(!this.contains(col[i]))return false;return true}else if(js_cols.typeOf(col.forEach)=="function")return col.every(this.contains,this);else if(js_cols.typeOf(col.getValues)=="function"){var arr=col.getValues();for(var i=0;i<arr.length;i++)if(!this.contains(arr[i]))return false;return true}else if(js_cols.typeOf(col)=="object"){for(var key in col)if(!this.contains(col[key]))return false;
return true}};js_cols.RedBlackSet.prototype.range=function(from,to){var retArray=[];this.traverseFromTo(function(x){retArray.push(x)},from,to);return retArray};js_cols.RedBlackSet.prototype.traverse=function(f,opt_obj){if(this.isEmpty())return;var node=this.min(this.root);while(node!=this.sentinel){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node)}};
js_cols.RedBlackSet.prototype.traverseFrom=function(f,fromKey,opt_obj){if(this.isEmpty())return;var node=this.get_(fromKey);while(node!=this.sentinel){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node)}};js_cols.RedBlackSet.prototype.traverseTo=function(f,toKey,opt_obj){if(this.isEmpty())return;var node=this.min(this.root);var toNode=this.get_(toKey);while(node!=toNode){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node)}};
js_cols.RedBlackSet.prototype.traverseFromTo=function(f,fromKey,toKey,opt_obj){if(this.isEmpty())return;var node=this.get_(fromKey);var toNode=this.get_(toKey);while(node!=toNode){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node)}};js_cols.RedBlackSet.prototype.traverseBackwards=function(f,opt_obj){if(this.isEmpty())return;var node=this.max(this.root);while(node!=this.sentinel){if(f.call(opt_obj,node.key,this))return;node=this.predeccessor_(node)}};
js_cols.RedBlackSet.prototype.forEach=function(f,opt_obj){if(this.isEmpty())return;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))f.call(opt_obj,n.key,n.key,this)};js_cols.RedBlackSet.prototype.some=function(f,opt_obj){if(this.isEmpty())return false;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))if(f.call(opt_obj,n.key,n.key,this))return true;return false};
js_cols.RedBlackSet.prototype.every=function(f,opt_obj){if(this.isEmpty())return false;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))if(!f.call(opt_obj,n.key,n.key,this))return false;return true};js_cols.RedBlackSet.prototype.map=function(f,opt_obj){var rv=[];if(this.isEmpty())return rv;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))rv.push(f.call(opt_obj,n.key,n.key,this));return rv};
js_cols.RedBlackSet.prototype.filter=function(f,opt_obj){var rv=[];if(this.isEmpty())return rv;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))if(f.call(opt_obj,n.key,n.key,this))rv.push(n.key);return rv};js_cols.RedBlackSet.prototype.getCount=function(){return this.size};js_cols.RedBlackSet.prototype.isEmpty=function(){return this.size==0};
js_cols.RedBlackSet.prototype.isSubsetOf=function(col){var colCount=js_cols.getCount(col);if(this.getCount()>colCount)return false;var i=0;if(this.isEmpty())return true;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))if(js_cols.contains.call(col,col,n.key))i++;return i==this.getCount()};
js_cols.RedBlackSet.prototype.intersection=function(col){var result=new js_cols.RedBlackSet(this.compare);if(this.isEmpty())return result;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))if(col.contains.call(col,n.key,n.key,this))result.insert(n.key);return result};
C3.RedBlackSet=class RedBlackSet extends C3.DefendedBase{constructor(sortFunc){super();this._rbSet=new js_cols.RedBlackSet(sortFunc);this._enableQueue=false;this._queueInsert=new Set;this._queueRemove=new Set}Add(item){if(this._enableQueue)if(this._rbSet.contains(item))this._queueRemove.delete(item);else this._queueInsert.add(item);else this._rbSet.insert(item)}Remove(item){if(this._enableQueue)if(this._rbSet.contains(item))this._queueRemove.add(item);else this._queueInsert.delete(item);else this._rbSet.remove(item)}Has(item){if(this._enableQueue){if(this._queueInsert.has(item))return true;
return!this._queueRemove.has(item)&&this._rbSet.contains(item)}else return this._rbSet.contains(item)}Clear(){this._rbSet.clear();this._queueInsert.clear();this._queueRemove.clear()}toArray(){if(this._enableQueue)throw new Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return this.GetSize()===0}Front(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");
const rbSet=this._rbSet;const n=rbSet.min(rbSet.root);return n.key}Shift(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");const item=this.Front();this.Remove(item);return item}SetQueueingEnabled(q){q=!!q;if(this._enableQueue===q)return;this._enableQueue=q;if(!q){for(const item of this._queueRemove)this._rbSet.remove(item);this._queueRemove.clear();for(const item of this._queueInsert)this._rbSet.insert(item);this._queueInsert.clear()}}ForEach(func){this._rbSet.forEach(func)}*values(){if(this.IsEmpty())return;
const rbSet=this._rbSet;for(let n=rbSet.min(rbSet.root);n!=rbSet.sentinel;n=rbSet.successor_(n))yield n.key}[Symbol.iterator](){return this.values()}};

}

// ../lib/util/promiseThrottle.js
{
'use strict';const C3=self.C3;
C3.PromiseThrottle=class PromiseThrottle{constructor(maxParallel=C3.hardwareConcurrency){this._maxParallel=maxParallel;this._queue=[];this._activeCount=0}Add(func){return new Promise((resolve,reject)=>{this._queue.push({func,resolve,reject});this._MaybeStartNext()})}_FindInQueue(func){for(let i=0,len=this._queue.length;i<len;++i)if(this._queue[i].func===func)return i;return-1}RemoveAndResolve(func,value){const i=this._FindInQueue(func);if(i===-1)throw new Error("cannot find promise to resolve");this._queue[i].resolve(value);
this._queue.splice(i,1)}RemoveAndReject(func,value){const i=this._FindInQueue(func);if(i===-1)throw new Error("cannot find promise to reject");this._queue[i].reject(value);this._queue.splice(i,1)}async _MaybeStartNext(){if(!this._queue.length)return;if(this._activeCount>=this._maxParallel)return;this._activeCount++;const job=this._queue.shift();try{const result=await job.func();job.resolve(result)}catch(err){job.reject(err)}this._activeCount--;this._MaybeStartNext()}static async Batch(concurrency,
methods){const results=[];let failed=false;const execute=async _=>{let fn;while(fn=methods.pop()){if(failed)return;try{results.push(await fn())}catch(e){failed=true;throw e;}}};const promises=[];while(concurrency--)promises.push(execute());await Promise.all(promises);return results}};

}

// ../lib/util/rateLimiter.js
{
'use strict';const C3=self.C3;
C3.RateLimiter=class RateLimiter{constructor(callback,interval,intervalOnBattery){this._callback=callback;this._interval=interval;this._intervalOnBattery=intervalOnBattery||interval*2;this._timerId=-1;this._lastCallTime=-Infinity;this._timerCallFunc=()=>this._OnTimer();this._ignoreReset=false;this._canRunImmediate=false;this._callbackArguments=null}SetCanRunImmediate(c){this._canRunImmediate=!!c}_GetInterval(){if(typeof C3.Battery!=="undefined"&&C3.Battery.IsOnBatteryPower())return this._intervalOnBattery;else return this._interval}Call(...args){if(this._timerId!==
-1)return;this._callbackArguments=args;let nowTime=C3.FastGetDateNow();let timeSinceLastCall=nowTime-this._lastCallTime;let interval=this._GetInterval();if(timeSinceLastCall>=interval&&this._canRunImmediate){this._lastCallTime=nowTime;this._RunCallback()}else this._timerId=self.setTimeout(this._timerCallFunc,Math.max(interval-timeSinceLastCall,4))}_RunCallback(){this._ignoreReset=true;const args=this._callbackArguments;this._callbackArguments=null;if(args)this._callback(...args);else this._callback();
this._ignoreReset=false}Reset(){if(this._ignoreReset)return;this._CancelTimer();this._callbackArguments=null;this._lastCallTime=C3.FastGetDateNow()}_OnTimer(){this._timerId=-1;this._lastCallTime=C3.FastGetDateNow();this._RunCallback()}_CancelTimer(){if(this._timerId!==-1){self.clearTimeout(this._timerId);this._timerId=-1}}Release(){this._CancelTimer();this._callback=null;this._callbackArguments=null;this._timerCallFunc=null}};

}

// ../lib/util/svgRaster/svgRasterManager.js
{
'use strict';const C3=self.C3;
C3.SVGRasterManager=class SVGRasterManager{constructor(){this._images=new Map;this._allowNpotSurfaces=false;this._getBaseSizeCallback=null;this._rasterAtSizeCallback=null;this._releaseResultCallback=null;this._redrawCallback=null}SetNpotSurfaceAllowed(a){this._allowNpotSurfaces=!!a}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(f){this._getBaseSizeCallback=f}GetBaseSize(dataSource){if(!this._getBaseSizeCallback)throw new Error("no get base size callback set");return this._getBaseSizeCallback(dataSource)}SetRasterAtSizeCallback(f){this._rasterAtSizeCallback=
f}RasterAtSize(dataSource,context,surfaceWidth,surfaceHeight,imageWidth,imageHeight){if(!this._rasterAtSizeCallback)throw new Error("no raster at size callback set");return this._rasterAtSizeCallback(dataSource,context,surfaceWidth,surfaceHeight,imageWidth,imageHeight)}SetReleaseResultCallback(f){this._releaseResultCallback=f}ReleaseResult(rasterizedResult){if(!this._releaseResultCallback)throw new Error("no release result callback set");this._releaseResultCallback(rasterizedResult)}SetRedrawCallback(f){this._redrawCallback=
f}Redraw(){if(!this._redrawCallback)throw new Error("no redraw callback set");this._redrawCallback()}AddImage(dataSource){let ret=this._images.get(dataSource);if(!ret){ret=C3.New(C3.SVGRasterImage,this,dataSource);this._images.set(dataSource,ret)}ret.IncReference();return ret}_RemoveImage(ri){this._images.delete(ri.GetDataSource())}OnTexturesChanged(){for(const ri of this._images.values()){ri.ReleaseRasterizedResult();ri.ForceRasterAgain()}}};

}

// ../lib/util/svgRaster/svgRasterImage.js
{
'use strict';const C3=self.C3;const MAX_SURFACE_SIZE=4096;
C3.SVGRasterImage=class SVGRasterImage{constructor(manager,dataSource){this._manager=manager;this._dataSource=dataSource;this._refCount=0;this._baseWidth=0;this._baseHeight=0;this._getBaseSizePromise=this._manager.GetBaseSize(dataSource).then(baseSize=>{if(!this._manager)return;this._baseWidth=baseSize[0];this._baseHeight=baseSize[1];this._manager.Redraw()}).catch(err=>{console.error("[SVG] Error loading SVG: ",err);this._hadError=true;if(this._manager)this._manager.Redraw()});this._rasterSurfaceWidth=
0;this._rasterSurfaceHeight=0;this._rasterImageWidth=0;this._rasterImageHeight=0;this._isRasterizing=false;this._rasterizedResult=null;this._forceRaster=false;this._hadError=false}Release(){if(this._refCount<=0)throw new Error("already released");this._refCount--;if(this._refCount===0)this._Release()}ReleaseRasterizedResult(){if(this._rasterizedResult){this._manager.ReleaseResult(this._rasterizedResult);this._rasterizedResult=null}}_Release(){this.ReleaseRasterizedResult();this._manager._RemoveImage(this);
this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return this._refCount>0}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=true}async StartRasterForSize(context,width,height){if(width===0||height===0||this._hadError)return;if(this._isRasterizing)return;let rasterSurfaceWidth=C3.nextHighestPowerOfTwo(Math.ceil(width));let rasterSurfaceHeight=C3.nextHighestPowerOfTwo(Math.ceil(height));const maxDim=Math.max(rasterSurfaceWidth,
rasterSurfaceHeight);if(maxDim>MAX_SURFACE_SIZE){const scale=MAX_SURFACE_SIZE/maxDim;width*=scale;height*=scale;rasterSurfaceWidth=Math.min(Math.ceil(rasterSurfaceWidth*scale),MAX_SURFACE_SIZE);rasterSurfaceHeight=Math.min(Math.ceil(rasterSurfaceHeight*scale),MAX_SURFACE_SIZE)}if(width<rasterSurfaceWidth&&height<rasterSurfaceHeight){const imageAspectRatio=width/height;const surfaceAspectRatio=rasterSurfaceWidth/rasterSurfaceHeight;if(surfaceAspectRatio>imageAspectRatio){width=rasterSurfaceHeight*
imageAspectRatio;height=rasterSurfaceHeight}else{width=rasterSurfaceWidth;height=rasterSurfaceWidth/imageAspectRatio}}if(this._manager.IsNpotSurfaceAllowed()){rasterSurfaceWidth=Math.ceil(width);rasterSurfaceHeight=Math.ceil(height)}if(rasterSurfaceWidth<=this._rasterSurfaceWidth&&rasterSurfaceHeight<=this._rasterSurfaceHeight&&!this._forceRaster)return;this._isRasterizing=true;this._rasterSurfaceWidth=rasterSurfaceWidth;this._rasterSurfaceHeight=rasterSurfaceHeight;const newRasterizedResult=await this._manager.RasterAtSize(this._dataSource,
context,this._rasterSurfaceWidth,this._rasterSurfaceHeight,width,height);if(!this._manager)return;this.ReleaseRasterizedResult();this._rasterizedResult=newRasterizedResult;this._rasterImageWidth=width;this._rasterImageHeight=height;this._isRasterizing=false;this._forceRaster=false;this._manager.Redraw()}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}};

}

// ../lib/str/str.js
{
'use strict';const C3=self.C3;C3.UTF8_BOM="\ufeff";const NUMERIC_CHARS=new Set([..."0123456789"]);C3.IsNumericChar=function IsNumericChar(c){return NUMERIC_CHARS.has(c)};const WHITESPACE_CHARS=new Set([..." \t\n\r\u00a0\u0085\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u202f\u205f\u3000"]);C3.IsWhitespaceChar=function IsWhitespaceChar(c){return WHITESPACE_CHARS.has(c)};C3.FilterWhitespace=function FilterWhitespace(str){return[...str].filter(ch=>!C3.IsWhitespaceChar(ch)).join("")};
C3.IsStringAllWhitespace=function IsStringAllWhitespace(str){for(const ch of str)if(!C3.IsWhitespaceChar(ch))return false;return true};C3.IsCharArrayAllWhitespace=function IsStringAllWhitespace(chArr){for(const ch of chArr)if(!C3.IsWhitespaceChar(ch))return false;return true};C3.IsUnprintableChar=function IsUnprintableChar(c){return c.length===1&&c.charCodeAt(0)<32};C3.FilterUnprintableChars=function FilterUnprintableChars(str){return[...str].filter(ch=>!C3.IsUnprintableChar(ch)).join("")};
const NUMERIC_STRING_CHARS=new Set([..."0123456789.+-e"]);C3.IsStringNumber=function IsStringNumber(str){str=str.trim();if(!str.length)return false;let firstChar=str.charAt(0);if(firstChar!=="-"&&!NUMERIC_CHARS.has(firstChar))return false;for(let ch of str)if(!NUMERIC_STRING_CHARS.has(ch))return false;return true};C3.RemoveTrailingDigits=function RemoveTrailingDigits(str){let i=str.length;while(i>0){let prev_ch=str.charAt(i-1);if(!C3.IsNumericChar(prev_ch))break;--i}return str.substr(0,i)};
C3.IncrementNumberAtEndOf=function IncrementNumberAtEndOf(str){let baseStr=C3.RemoveTrailingDigits(str);let numberStr=str.substr(baseStr.length);if(numberStr)numberStr=(parseInt(numberStr,10)+1).toString();else numberStr="2";return baseStr+numberStr};const HTML_ENTITY_MAP=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]]);function lookupHtmlEntity(s){return HTML_ENTITY_MAP.get(s)}const HTML_ENTITY_REGEX=/[&<>"']/g;
C3.EscapeHTML=function EscapeHTML(str){return str.replace(HTML_ENTITY_REGEX,lookupHtmlEntity)};C3.EscapeJS=function EscapeJS(str){let ret=C3.ReplaceAll(str,"\\","\\\\");ret=C3.ReplaceAll(ret,'"','\\"');ret=C3.ReplaceAll(ret,"\t","\\t");ret=C3.ReplaceAll(ret,"\r","");return C3.ReplaceAll(ret,"\n","\\n")};C3.EscapeXML=function EscapeXML(str){let ret=C3.ReplaceAll(str,"&","&amp;");ret=C3.ReplaceAll(ret,"<","&lt;");ret=C3.ReplaceAll(ret,">","&gt;");return C3.ReplaceAll(ret,'"',"&quot;")};
const ESCAPE_REGEX=/[-[\]{}()*+?.,\\^$|#\s]/g;C3.EscapeRegex=function EscapeRegex(str){return str.replace(ESCAPE_REGEX,"\\$&")};C3.CountCharsInString=function CountCharsInString(str,ch){let count=0;for(const c of str)if(c===ch)++count;return count};
C3.FindAll=function FindAll(str,find,matchCase=false){if(!find)return[];if(!matchCase){str=str.toLowerCase();find=find.toLowerCase()}const findLen=find.length;let startIndex=0;let index=0;let ret=[];while((index=str.indexOf(find,startIndex))>-1){ret.push(index);startIndex=index+findLen}return ret};C3.ReplaceAll=function ReplaceAll(str,find,replace){return str.replaceAll(find,()=>replace)};
C3.ReplaceAllCaseInsensitive=function ReplaceAll(str,find,replace){return str.replace(new RegExp(C3.EscapeRegex(find),"gi"),()=>replace)};C3.SetElementContent=function SetElementContent(elem,stringlike){if(typeof stringlike==="string")elem.textContent=stringlike;else if(stringlike.isPlainText())elem.textContent=stringlike.toString();else{elem.innerHTML=stringlike.toHTML();if(stringlike instanceof C3.BBString)stringlike.attachLinkHandlers(elem)}};
C3.StringLikeEquals=function StringLikeEquals(a,b){if(a instanceof C3.HtmlString||a instanceof C3.BBString)return a.equals(b);else if(b instanceof C3.HtmlString||b instanceof C3.BBString)return b.equals(a);else return a===b};C3.StringSubstitute=function StringSubstitute(str,...arr){let ret=str;for(let i=0,len=arr.length;i<len;++i){const sub=`{${i}}`;if(!str.includes(sub))throw new Error(`missing placeholder '${sub}' in string substitution`);ret=ret.replace(sub,arr[i].toString())}return ret};
C3.StringSubstituteAllowMissing=function StringSubstituteAllowMissing(str,...arr){let ret=str;let lowestMissingIndex=-1;let highestUsedIndex=-1;for(let i=0,len=arr.length;i<len;++i){const sub=`{${i}}`;if(str.includes(sub)){highestUsedIndex=i;ret=ret.replace(sub,arr[i].toString())}else if(lowestMissingIndex===-1)lowestMissingIndex=i}if(lowestMissingIndex>=0&&highestUsedIndex>=0&&lowestMissingIndex<highestUsedIndex)throw new Error(`missing placeholder '${lowestMissingIndex}' in string substitution`);
return ret};C3.StringSubstituteMap=function StringSubstituteMap(str,o){let ret=str;for(let [placeholder,substitution]of Object.entries(o))ret=ret.replaceAll(placeholder,substitution.toString());return ret};C3.SortAZ=function SortAZ(a,b){if(a>b)return 1;else if(a<b)return-1;else return 0};C3.SortAZCaseInsensitive=function SortAZCaseInsensitive(a,b){let lowerA=a.toLowerCase();let lowerB=b.toLowerCase();if(lowerA>lowerB)return 1;else if(lowerA<lowerB)return-1;else return 0};let intlSegmenter=null;
let graphemeSplitter=null;if(self["Intl"]&&self["Intl"]["Segmenter"])intlSegmenter=new self["Intl"]["Segmenter"];else graphemeSplitter=new self.GraphemeSplitter;C3.SplitGraphemes=function SplitGraphemes(str){if(intlSegmenter){const ret=[];for(const s of intlSegmenter["segment"](str))ret.push(s["segment"]);return ret}else return graphemeSplitter.splitGraphemes(str)};C3.IterateGraphemes=function*IterateGraphemes(str){if(intlSegmenter)for(const s of intlSegmenter["segment"](str))yield s["segment"];else yield*graphemeSplitter.iterateGraphemes(str)};
C3.CountGraphemes=function CountGraphemes(str){if(intlSegmenter){let ret=0;for(const s of intlSegmenter["segment"](str))++ret;return ret}else return graphemeSplitter.countGraphemes(str)};const KILOBYTE=1024;const MEGABYTE=KILOBYTE*1024;const GIGABYTE=MEGABYTE*1024;const TERABYTE=GIGABYTE*1024;
C3.FormatDataSize=function FormatDataSize(sizeInBytes,asRate){let rootKey="common."+(asRate?"dataRates":"dataSizes")+".";const langSub=self.langSub;if(sizeInBytes<KILOBYTE)return langSub(rootKey+"bytes",sizeInBytes);else if(sizeInBytes<MEGABYTE){let kb=sizeInBytes/KILOBYTE;if(kb<10)kb=Math.round(kb*10)/10;else kb=Math.round(kb);return langSub(rootKey+"kilobytes",kb)}else if(sizeInBytes<GIGABYTE){let mb=sizeInBytes/MEGABYTE;if(mb<10)mb=Math.round(mb*10)/10;else mb=Math.round(mb);return langSub(rootKey+
"megabytes",mb)}else if(sizeInBytes<TERABYTE){let gb=sizeInBytes/GIGABYTE;if(gb<10)gb=Math.round(gb*10)/10;else gb=Math.round(gb);return langSub(rootKey+"gigabytes",gb)}else{let tb=sizeInBytes/TERABYTE;if(tb<10)tb=Math.round(tb*10)/10;else tb=Math.round(tb);return langSub(rootKey+"terabytes",tb)}};const DEFAULT_FORMATTIME_OPTS={approximate:false,days:true,hours:true,minutes:true,seconds:true};
C3.FormatTime=function FormatTime(secondsTotal,opts){opts=Object.assign({},DEFAULT_FORMATTIME_OPTS,opts);C3.Lang.PushContext("common.time");const parts=[];const lang=self.lang;const langPluralSub=self.langPluralSub;if(opts.days){const days=Math.floor(secondsTotal/(24*3600));if(days>0){secondsTotal-=days*24*3600;parts.push(langPluralSub(".days",null,days))}}if(opts.hours){const hours=Math.floor(secondsTotal/3600);if(hours>0||parts.length){secondsTotal-=hours*3600;parts.push(langPluralSub(".hours",
null,hours))}}if(opts.minutes){const minutes=Math.floor(secondsTotal/60);if(minutes>0||parts.length||!opts.seconds){secondsTotal-=minutes*60;parts.push(langPluralSub(".minutes",null,minutes))}}if(opts.seconds){const seconds=Math.floor(secondsTotal%60);parts.push(langPluralSub(".seconds",null,seconds))}const ret=(opts.approximate?lang(".approx-prefix"):"")+parts.join(lang(".separator"));C3.Lang.PopContext();return ret};
C3.ZeroPad=function(n,d){let s=n<0?"-":"";n=Math.abs(n);let nStr=n.toString();let zeroes=d-nStr.length;for(let i=0;i<zeroes;++i)s+="0";return s+nStr};C3.StringToTitleCase=function StringToTitleCase(str){return str.toLowerCase().replace(/\b\w/g,t=>t.toUpperCase())};
C3.CompareVersionStrings=function CompareVersionStrings(v1,v2){let a1=v1.split(".").map(s=>s.trim());let a2=v2.split(".").map(s=>s.trim());C3.resizeArray(a1,4,"0");C3.resizeArray(a2,4,"0");a1=a1.map(s=>parseInt(s,10));a2=a2.map(s=>parseInt(s,10));for(let i=0;i<4;++i){const diff=a1[i]-a2[i];if(diff!==0)return diff<0?-1:1}return 0};C3.CreateGUID=function CreateGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const r=Math.floor(Math.random()*16);const v=c==="x"?r:r&3|8;return v.toString(16)})};
C3.StringHammingDistance=function StringHammingDistance(a,b){if(a.length!==b.length)throw new Error("strings must be same length");let ret=0;for(let i=0,len=a.length;i<len;++i)if(a.charAt(i)!==b.charAt(i))++ret;return ret};
C3.StringLevenshteinDistance=function StringLevenshteinDistance(a,b){if(a.length===0)return b.length;if(b.length===0)return a.length;let tmp,i,j,prev,val,row;if(a.length>b.length){tmp=a;a=b;b=tmp}row=Array(a.length+1);for(i=0;i<=a.length;i++)row[i]=i;for(i=1;i<=b.length;i++){prev=i;for(j=1;j<=a.length;j++){if(b[i-1]===a[j-1])val=row[j-1];else val=Math.min(row[j-1]+1,Math.min(prev+1,row[j]+1));row[j-1]=prev;prev=val}row[a.length]=prev}return row[a.length]};

}

// ../lib/str/bbstring.js
{
'use strict';const C3=self.C3;const assert=self.assert;
const BB_CODE_MAP=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],
["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]);const SELF_CLOSING_TAGS=new Set(["icon"]);const BBREGEX=/\[(\/?)([a-zA-Z0-9]+)\]/g;const CUSTOM_BBREGEX=/\[(\/?)([^\[\n]*?)\]/g;let linkActions=null;let tipList=null;let classIndex=0;
function bbToHtmlReplacerFunc(match,closeSlash,tagName){const entry=BB_CODE_MAP.get(tagName);if(entry)if(typeof entry==="string"){if(entry==="a"&&linkActions.length===0||entry==="abbr"&&tipList.length===0)return match;if(entry==="a"&&!closeSlash){const index=parseInt(tagName.substring(1),10)-1;if(index<0||index>=linkActions.length)throw new Error("invalid bbcode link substitution");const linkAction=linkActions[index];if(typeof linkAction==="string")return`<a href="${linkActions[index]}">`;else if(typeof linkAction===
"function")return`<a class="bblink${index}">`;else throw new TypeError("invalid bbcode link action");}else if(entry==="abbr"&&!closeSlash){const index=parseInt(tagName.substring(3),10)-1;if(index<0||index>=tipList.length)throw new Error("invalid bbcode tip substitution");const tip=tipList[index];let tipStr="";if(typeof tip==="string")tipStr=tip;else if(typeof tip==="function")tipStr=tip();if(typeof tipStr!=="string")throw new TypeError("invalid bbcode tip");return`<abbr title="${C3.ReplaceAll(tipStr,
'"',"&quot;")}">`}else return"<"+closeSlash+entry+">"}else if(Array.isArray(entry)){let tag=entry[0];let className=entry[1];if(closeSlash)return"</"+tag+">";else return`<${tag} class="${className}">`}else;else if(tagName==="class")if(closeSlash)return"</span>";else return`<span class="bbclass${classIndex++}">`;else return match}const LINEBREAK_REGEX=/\n/g;
C3.BBString=class BBString{constructor(str,opts){this._bbstr=opts&&opts.noEscape?str:C3.EscapeHTML(str);this._htmlstr="";this._convertLineBreaks=false;this._linkActions=[];this._tipList=[];if(opts){this._convertLineBreaks=!!opts.convertLineBreaks;if(opts.links){if(opts.links.length>9)throw new Error("too many links");this._linkActions=opts.links}if(opts.tips){if(opts.tips.length>9)throw new Error("too many tips");this._tipList=opts.tips}}this._hasAnyBBtags=this._bbstr.includes("[");this._needsLineBreakConversion=
this._convertLineBreaks&&this._bbstr.includes("\n");this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&");this._hasParsedFragments=false;this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){if(this._hasAnyBBtags)return this._bbstr.replace(BBREGEX,"");else return this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let str=this._bbstr;if(this._hasAnyBBtags){classIndex=
0;linkActions=this._linkActions;tipList=this._tipList;str=str.replace(BBREGEX,bbToHtmlReplacerFunc);linkActions=null;tipList=null}if(this._needsLineBreakConversion)str=str.replace(LINEBREAK_REGEX,"<br>");this._htmlstr=str}return this._htmlstr}attachLinkHandlers(parentElem){if(!this._linkActions.length)return;for(let i=0,len=this._linkActions.length;i<len;++i){const linkAction=this._linkActions[i];if(typeof linkAction!=="function")continue;const linkElem=parentElem.querySelector(".bblink"+i);if(!linkElem)throw new Error("unable to attach BBString link handler");
linkElem.onclick=linkAction}}equals(s){if(s instanceof C3.HtmlString)return this.toHTML()===s.toHTML();else if(s instanceof C3.BBString)return this._bbstr===s._bbstr;else return this._bbstr===s}toFragmentList(){if(this._hasParsedFragments)return this._fragments;const fragments=[];const bbStr=this._bbstr;const styleStack=[];CUSTOM_BBREGEX.lastIndex=0;let prevIndex=0;let result=null;while((result=CUSTOM_BBREGEX.exec(bbStr))!==null){const index=result.index;if(index>0&&bbStr.charAt(index-1)==="\\")continue;
const matchStr=result[0];const closeSlash=result[1];const tagName=result[2];const strFrag=bbStr.substring(prevIndex,index);prevIndex=index+matchStr.length;if(strFrag)fragments.push({text:strFrag,styles:styleStack.slice(0)});if(!tagName)continue;if(closeSlash){const lowerTagName=tagName.toLowerCase();for(let i=styleStack.length-1;i>=0;--i)if(styleStack[i].tag===lowerTagName){styleStack.splice(i,1);break}}else{let tag=tagName;let param=null;const eq=tagName.indexOf("=");if(eq!==-1){tag=tagName.substring(0,
eq).toLowerCase();param=tagName.substring(eq+1)}else tag=tag.toLowerCase();if(SELF_CLOSING_TAGS.has(tag))if(tag==="icon")fragments.push({icon:param,styles:styleStack.slice(0)});else throw new Error(`unknown self-closing tag ${tag}`);else styleStack.push({tag,param})}}if(prevIndex<bbStr.length)fragments.push({text:bbStr.substring(prevIndex),styles:styleStack.slice(0)});for(const frag of fragments)if(frag.text)frag.text=this._ProcessBBCodeEscapeSequences(frag.text);this._fragments=fragments.map(frag=>
{if(frag.icon)return C3.New(C3.IconFragment,{icon:frag.icon,styles:frag.styles});else return C3.New(C3.TextFragment,{chArr:C3.SplitGraphemes(frag.text),styles:frag.styles})});this._hasParsedFragments=true;return this._fragments}_ProcessBBCodeEscapeSequences(text){text=C3.ReplaceAll(text,"\\[","[");return C3.ReplaceAll(text,"\\\\","\\")}static StripTags(str){return C3.New(C3.BBString,str,{noEscape:true}).toPlainText()}static StripAnyTags(str){return str.replace(CUSTOM_BBREGEX,"")}};

}

// ../lib/str/textLayout/wordWrap.js
{
'use strict';const C3=self.C3;function IsWordBreakWhiteSpace(ch){if(ch==="\u00a0"||ch==="\u202f")return false;else return C3.IsWhitespaceChar(ch)}function WordBreakTrimEnd(chArr){while(chArr.length>0&&IsWordBreakWhiteSpace(chArr.at(-1)))chArr.pop()}function IsNewline(ch){return ch==="\n"||ch==="\r\n"}
C3.WordWrap=class WordWrap{constructor(){this._lines=[];this._iconSet=null}GetLines(){return this._lines}GetLineCount(){return this._lines.length}SetIconSet(iconSet){this._iconSet=iconSet}_MeasureLine(line,measureFunc){let width=0;let height=0;let fbbAscent=0;let fbbDescent=0;let topToAlphabeticDistance=0;for(const frag of line){if(frag.GetWidth()===-1){const m=measureFunc(frag);frag.SetHeight(m.height);frag.SetFontBoundingBoxAscent(m.fontBoundingBoxAscent||0);frag.SetFontBoundingBoxDescent(m.fontBoundingBoxDescent||
0);frag.SetTopToAlphabeticDistance(m.topToAlphabeticDistance||0);if(frag.IsText())frag.SetWidth(m.width);else if(frag.IsIcon())frag.CalculateWidthFromHeight(this._iconSet)}width+=frag.GetWidth();height=Math.max(height,frag.GetHeight());fbbAscent=Math.max(fbbAscent,frag.GetFontBoundingBoxAscent());fbbDescent=Math.max(fbbDescent,frag.GetFontBoundingBoxDescent());topToAlphabeticDistance=Math.max(topToAlphabeticDistance,frag.GetTopToAlphabeticDistance())}return{width,height,fontBoundingBoxAscent:fbbAscent,
fontBoundingBoxDescent:fbbDescent,topToAlphabeticDistance}}_AddLine(fragments,width,height,fbbAscent,fbbDescent,topToAlphabeticDistance){this._lines.push(C3.New(C3.WordWrap.Line,{fragments,width,height,fontBoundingBoxAscent:fbbAscent,fontBoundingBoxDescent:fbbDescent,topToAlphabeticDistance}))}WordWrap(fragmentArr,measureFunc,wrapWidth,wrapMode,endOfLineMargin){if(typeof fragmentArr==="string")fragmentArr=[C3.New(C3.TextFragment,{chArr:C3.SplitGraphemes(fragmentArr)})];C3.clearArray(this._lines);
if(!fragmentArr.length||fragmentArr.length===1&&fragmentArr[0].IsText()&&fragmentArr[0].IsEmpty()||wrapWidth<2)return;if(fragmentArr.length===1){const frag=fragmentArr[0];if(frag.IsText()&&frag.GetLength()<=100&&!frag.HasNewLine()){let {width,height,fontBoundingBoxAscent,fontBoundingBoxDescent,topToAlphabeticDistance}=measureFunc(frag);width+=endOfLineMargin;frag.SetWidth(width);frag.SetHeight(height);frag.SetFontBoundingBoxAscent(fontBoundingBoxAscent||0);frag.SetFontBoundingBoxDescent(fontBoundingBoxDescent||
0);frag.SetTopToAlphabeticDistance(topToAlphabeticDistance||0);if(width<=wrapWidth){this._AddLine([frag],width,height,fontBoundingBoxAscent,fontBoundingBoxDescent,topToAlphabeticDistance);return}}}let tokenisedFragments;if(wrapMode==="word")tokenisedFragments=this._TokeniseWords(fragmentArr);else{tokenisedFragments=[];for(const frag of fragmentArr)if(frag.IsText()){const chArr=frag.GetCharacterArray();C3.appendArray(tokenisedFragments,chArr.map(ch=>[C3.New(C3.TextFragment,{chArr:[ch],styles:frag.GetStyles()})]))}else tokenisedFragments.push([frag])}this._WrapText(tokenisedFragments,
measureFunc,wrapWidth,endOfLineMargin)}_TokeniseWords(fragmentArr){const ret=[];let curWord=[];let isCurWhitespace=false;for(const frag of fragmentArr){const styles=frag.GetStyles();if(frag.IsIcon()){if(curWord.length>0)ret.push(curWord);ret.push([frag]);curWord=[];continue}for(const ch of frag.GetCharacterArray())if(IsNewline(ch)){if(curWord.length>0)ret.push(curWord);const newlineFrag=C3.New(C3.TextFragment,{chArr:["\n"],styles});ret.push([newlineFrag]);curWord=[]}else if(curWord.length===0){const newFrag=
C3.New(C3.TextFragment,{chArr:[ch],styles});curWord.push(newFrag);isCurWhitespace=IsWordBreakWhiteSpace(ch)}else{const isWhitespace=IsWordBreakWhiteSpace(ch);if(isWhitespace===isCurWhitespace){const curFrag=curWord.at(-1);if(curFrag.GetStyles()===styles)curFrag._AppendChar(ch);else{const newFrag=C3.New(C3.TextFragment,{chArr:[ch],styles});curWord.push(newFrag)}}else{ret.push(curWord);curWord=[];const newFrag=C3.New(C3.TextFragment,{chArr:[ch],styles});curWord.push(newFrag);isCurWhitespace=isWhitespace}}}if(curWord.length>
0)ret.push(curWord);return ret}_CopyLine(line){return line.map(f=>f._Clone())}_AddWordToLine(currentLine,curWord){const lastFrag=currentLine.length?currentLine.at(-1):null;let i=0;if(lastFrag&&lastFrag.IsText()&&curWord[0].IsText()&&curWord[0].GetStyles()===lastFrag.GetStyles()){lastFrag._Append(curWord[0].GetCharacterArray());i=1}for(let len=curWord.length;i<len;++i){const f=curWord[i];currentLine.push(f._Clone())}}_WrapText(tokenisedFragments,measureFunc,wrapWidth,endOfLineMargin){let currentLine=
[];let currentLineWidth=0;let currentLineHeight=0;let currentLineFbbAscent=0;let currentLineFbbDescent=0;let currentLineTopToAlphabetic=0;for(const curWord of tokenisedFragments){if(curWord.length===1&&curWord[0].IsText()&&curWord[0].GetLength()===1&&IsNewline(curWord[0].GetCharacterArray()[0])){if(currentLineHeight===0){const tempFrag=C3.New(C3.TextFragment,{chArr:[" "],styles:curWord[0].GetStyles()});const m=measureFunc(tempFrag);currentLineHeight=m.height;currentLineFbbAscent=m.fontBoundingBoxAscent||
0;currentLineFbbDescent=m.fontBoundingBoxDescent||0;currentLineTopToAlphabetic=m.topToAlphabeticDistance||0}this._AddLine(currentLine,currentLineWidth,currentLineHeight,currentLineFbbAscent,currentLineFbbDescent,currentLineTopToAlphabetic);currentLine=[];currentLineWidth=0;currentLineHeight=0;currentLineFbbAscent=0;currentLineFbbDescent=0;currentLineTopToAlphabetic=0;continue}const tryLine=this._CopyLine(currentLine);this._AddWordToLine(tryLine,curWord);const tryMetrics=this._MeasureLine(tryLine,
measureFunc);const tryLineWidth=tryMetrics.width;if(tryLineWidth>=wrapWidth){if(currentLine.length>0)this._AddLine(currentLine,currentLineWidth,currentLineHeight,currentLineFbbAscent,currentLineFbbDescent,currentLineTopToAlphabetic);currentLine=[];if(curWord[0].IsText()&&C3.IsCharArrayAllWhitespace(curWord[0].GetCharacterArray())){currentLineWidth=0;currentLineHeight=0;currentLineFbbAscent=0;currentLineFbbDescent=0;currentLineTopToAlphabetic=0}else{this._AddWordToLine(currentLine,curWord);const metrics=
this._MeasureLine(currentLine,measureFunc);currentLineWidth=metrics.width;currentLineHeight=metrics.height;currentLineFbbAscent=metrics.fontBoundingBoxAscent;currentLineFbbDescent=metrics.fontBoundingBoxDescent;currentLineTopToAlphabetic=metrics.topToAlphabeticDistance}}else{currentLine=tryLine;currentLineWidth=tryLineWidth;currentLineHeight=tryMetrics.height;currentLineFbbAscent=tryMetrics.fontBoundingBoxAscent;currentLineFbbDescent=tryMetrics.fontBoundingBoxDescent;currentLineTopToAlphabetic=tryMetrics.topToAlphabeticDistance}}if(currentLine.length>
0)this._AddLine(currentLine,currentLineWidth,currentLineHeight,currentLineFbbAscent,currentLineFbbDescent,currentLineTopToAlphabetic);this._TrimLinesTrailingWhitespace(measureFunc,endOfLineMargin)}_TrimLinesTrailingWhitespace(measureFunc,endOfLineMargin){for(const line of this._lines){const fragments=line._GetFragmentsArray();if(!fragments.length)continue;let lastFrag=fragments.at(-1);if(lastFrag.IsText()){const chArr=lastFrag.GetCharacterArray();const trimmedArr=chArr.slice(0);WordBreakTrimEnd(trimmedArr);
if(trimmedArr.length===0){line.OffsetWidth(-lastFrag.GetWidth());fragments.pop()}else if(trimmedArr.length<chArr.length){lastFrag.SetCharacterArray(trimmedArr);const trimmedWidth=measureFunc(lastFrag).width;const diff=lastFrag.GetWidth()-trimmedWidth;lastFrag.SetWidth(trimmedWidth);line.OffsetWidth(-diff)}if(endOfLineMargin!==0&&fragments.length>0){lastFrag=fragments.at(-1);lastFrag.OffsetWidth(endOfLineMargin);line.OffsetWidth(endOfLineMargin)}}}}Clear(){C3.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce((a,
v)=>Math.max(a,v.GetWidth()),0)}GetTotalLineHeight(){return this._lines.reduce((a,v)=>a+v.GetHeight(),0)}};

}

// ../lib/str/textLayout/line.js
{
'use strict';const C3=self.C3;
C3.WordWrap.Line=class WordWrapLine{constructor(opts){this._fragments=opts.fragments||[];this._width=opts.width||-1;this._height=opts.height||-1;this._fontBoundingBoxAscent=opts.fontBoundingBoxAscent||-1;this._fontBoundingBoxDescent=opts.fontBoundingBoxDescent||-1;this._topToAlphabeticDistance=opts.topToAlphabeticDistance||-1;this._posX=0;this._posY=0}fragments(){return this._fragments.values()}*fragmentsReverse(){const fragments=this._fragments;for(let i=fragments.length-1;i>=0;--i)yield fragments[i]}_GetFragmentsArray(){return this._fragments}OffsetWidth(w){this._width+=
w}GetWidth(){return this._width}GetHeight(){return this._height}GetFoundBoundingBoxAscent(){return this._fontBoundingBoxAscent}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(x){this._posX=x}GetPosX(){return this._posX}SetPosY(y){this._posY=y}GetPosY(){return this._posY}};

}

// ../lib/str/textLayout/fragmentBase.js
{
'use strict';const C3=self.C3;
C3.FragmentBase=class FragmentBase{constructor(opts){this._styles=opts.styles||[];this._width=opts.width||-1;this._height=opts.height||-1;this._fontBoundingBoxAscent=opts.fontBoundingBoxAscent||-1;this._fontBoundingBoxDescent=opts.fontBoundingBoxDescent||-1;this._topToAlphabeticDistance=opts.topToAlphabeticDistance||-1;this._posX=0;this._posY=0}IsText(){return false}IsIcon(){return false}GetStyles(){return this._styles}GetStyleTag(tag){const styles=this._styles;for(let i=styles.length-1;i>=0;--i){const s=
styles[i];if(s.tag===tag)return s}return null}HasStyleTag(tag){return!!this.GetStyleTag(tag)}GetStyleMap(){const ret=new Map;for(const s of this._styles)ret.set(s.tag,s.param);return ret}OffsetWidth(w){this._width+=w}SetWidth(w){this._width=w}GetWidth(){return this._width}SetHeight(h){this._height=h}GetHeight(){return this._height}SetFontBoundingBoxAscent(v){this._fontBoundingBoxAscent=v}GetFontBoundingBoxAscent(){return this._fontBoundingBoxAscent}SetFontBoundingBoxDescent(v){this._fontBoundingBoxDescent=
v}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}SetTopToAlphabeticDistance(v){this._topToAlphabeticDistance=v}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(x){this._posX=x}GetPosX(){return this._posX}SetPosY(y){this._posY=y}GetPosY(){return this._posY}};

}

// ../lib/str/textLayout/textFragment.js
{
'use strict';const C3=self.C3;
C3.TextFragment=class TextFragment extends C3.FragmentBase{constructor(opts){super(opts);this._chArr=opts.chArr}IsText(){return true}_Append(chArr){C3.appendArray(this._chArr,chArr);this._width=-1;this._height=-1;this._fontBoundingBoxAscent=-1;this._fontBoundingBoxDescent=-1;this._topToAlphabeticDistance=-1}_AppendChar(ch){this._chArr.push(ch)}_Clone(){return C3.New(C3.TextFragment,{chArr:this._chArr.slice(0),styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,
fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetCharacterArray(){return this._chArr}SetCharacterArray(arr){this._chArr=arr}GetLength(){return this._chArr.length}IsEmpty(){return this._chArr.length===0}HasNewLine(){return this._chArr.includes("\n")}};

}

// ../lib/str/textLayout/iconFragment.js
{
'use strict';const C3=self.C3;
C3.IconFragment=class IconFragment extends C3.FragmentBase{constructor(opts){super(opts);this._icon=opts.icon}IsIcon(){return true}GetIconParameter(){return this._icon}_Clone(){return C3.New(C3.IconFragment,{icon:this._icon,styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetTextIcon(iconSet){if(!iconSet)return null;let index=Number(this._icon);
if(String(index)===this._icon){index=Math.floor(index);return iconSet.GetTextIconByIndex(index)}else return iconSet.GetTextIconByTag(this._icon)}CalculateWidthFromHeight(iconSet){const textIcon=this.GetTextIcon(iconSet);if(!textIcon){this._width=0;return}this._width=this._height*textIcon.GetWidth()/textIcon.GetHeight()}GetDrawable(iconSet){const textIcon=this.GetTextIcon(iconSet);return textIcon?textIcon.GetDrawable():null}GetLength(){return 1}};

}

// ../lib/str/textLayout/textIconManager.js
{
'use strict';const C3=self.C3;
C3.TextIconManager=class TextIconManager{constructor(opts){this._iconSets=new Map;this._getIconSetMetaCallback=opts.getIconSetMeta;this._getIconSetContentCallback=opts.getIconSetContent}Release(){for(const iconSet of this._iconSets.values())iconSet.Release();this._iconSets.clear()}GetIconSet(iconSource){let iconSet=this._iconSets.get(iconSource);if(iconSet)return iconSet;const iconMeta=this._getIconSetMetaCallback(iconSource);iconSet=C3.New(C3.TextIconSet,this,{source:iconSource,iconMeta});this._iconSets.set(iconSource,
iconSet);return iconSet}HasIconSet(iconSource){return this._iconSets.has(iconSource)}DeleteIconSet(iconSource){const iconSet=this._iconSets.get(iconSource);if(iconSet)iconSet.Release();this._iconSets.delete(iconSource)}async _GetIconSetContent(iconSource){return await this._getIconSetContentCallback(iconSource)}};

}

// ../lib/str/textLayout/textIconSet.js
{
'use strict';const C3=self.C3;
C3.TextIconSet=class TextIconSet{constructor(textIconManager,opts){this._textIconManager=textIconManager;this._source=opts.source;this._iconsArray=[];this._iconsByTag=new Map;this._hasStartedLoad=false;this._isLoading=false;this._loadPromise=null;const iconMetaArr=opts.iconMeta.icons;for(let i=0,len=iconMetaArr.length;i<len;++i){const m=iconMetaArr[i];const textIcon=C3.New(C3.TextIcon,this,{index:i,tag:m.tag,source:m.source,width:m.width,height:m.height});this._iconsArray.push(textIcon);if(m.tag)this._iconsByTag.set(m.tag.toLowerCase(),
textIcon)}}Release(){for(const textIcon of this._iconsArray)textIcon.Release();C3.clearArray(this._iconsArray);this._iconsByTag.clear();this._textIconManager=null;this._source=null}HasLoaded(){return this._hasStartedLoad}IsLoading(){return this._isLoading}LoadContent(){if(!this._loadPromise)this._loadPromise=this._DoLoadContent();return this._loadPromise}async _DoLoadContent(){if(this._hasStartedLoad)return;this._hasStartedLoad=true;this._isLoading=true;const iconContent=await this._textIconManager._GetIconSetContent(this._source);
if(!this._textIconManager)return;const iconsArr=iconContent.icons;for(let i=0,len=Math.min(iconsArr.length,this._iconsArray.length);i<len;++i){const drawable=iconsArr[i].drawable;this._iconsArray[i]._SetDrawable(drawable)}this._isLoading=false}GetTextIconByIndex(index){index=Math.floor(index);if(index<0||index>=this._iconsArray.length)return null;return this._iconsArray[index]}GetTextIconByTag(tag){return this._iconsByTag.get(tag.toLowerCase())||null}};

}

// ../lib/str/textLayout/textIcon.js
{
'use strict';const C3=self.C3;C3.TextIcon=class TextIcon{constructor(textIconSet,opts){this._textIconSet=textIconSet;this._source=opts.source||null;this._index=opts.index;this._tag=opts.tag;this._width=opts.width;this._height=opts.height;this._drawable=null}Release(){this._width=0;this._height=0;this._textIconSet=null}GetSource(){return this._source}GetWidth(){return this._width}GetHeight(){return this._height}_SetDrawable(drawable){this._drawable=drawable}GetDrawable(){return this._drawable}};

}

// ../lib/gfx/gfx.js
{
'use strict';const C3=self.C3;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const vec4=glMatrix.vec4;const mat4=glMatrix.mat4;const tempVec3a=vec3.create();const tempVec3b=vec3.create();const tempVec3c=vec3.create();const tempVec4=vec4.create();const tempMat4=mat4.create();const neartl=vec3.create();const neartr=vec3.create();const nearbl=vec3.create();const nearbr=vec3.create();const fartl=vec3.create();const fartr=vec3.create();const farbl=vec3.create();const farbr=vec3.create();
const unitViewport=vec4.fromValues(0,0,1,1);
C3.Gfx={Project(objx,objy,objz,mv,proj,viewport,windowCoordinate){const fTemp0=mv[0]*objx+mv[4]*objy+mv[8]*objz+mv[12];const fTemp1=mv[1]*objx+mv[5]*objy+mv[9]*objz+mv[13];const fTemp2=mv[2]*objx+mv[6]*objy+mv[10]*objz+mv[14];const fTemp3=mv[3]*objx+mv[7]*objy+mv[11]*objz+mv[15];let fTemp4=proj[0]*fTemp0+proj[4]*fTemp1+proj[8]*fTemp2+proj[12]*fTemp3;let fTemp5=proj[1]*fTemp0+proj[5]*fTemp1+proj[9]*fTemp2+proj[13]*fTemp3;let fTemp6=proj[2]*fTemp0+proj[6]*fTemp1+proj[10]*fTemp2+proj[14]*fTemp3;let fTemp7=
proj[3]*fTemp0+proj[7]*fTemp1+proj[11]*fTemp2+proj[15]*fTemp3;if(fTemp7===0)return false;fTemp7=1/fTemp7;fTemp4*=fTemp7;fTemp5*=fTemp7;fTemp6*=fTemp7;windowCoordinate[0]=(fTemp4*.5+.5)*viewport[2]+viewport[0];windowCoordinate[1]=(fTemp5*.5+.5)*viewport[3]+viewport[1];windowCoordinate[2]=(1+fTemp6)*.5;return true},Unproject(winx,winy,winz,mv,proj,viewport,objectCoordinate){const A=tempMat4;const vec=tempVec4;mat4.multiply(A,proj,mv);if(mat4.invert(A,A)===null)return false;vec[0]=(winx-viewport[0])/
viewport[2]*2-1;vec[1]=(winy-viewport[1])/viewport[3]*2-1;vec[2]=2*winz-1;vec[3]=1;vec4.transformMat4(vec,vec,A);if(vec[3]===0)return false;vec[3]=1/vec[3];objectCoordinate[0]=vec[0]*vec[3];objectCoordinate[1]=vec[1]*vec[3];objectCoordinate[2]=vec[2]*vec[3];return true},UnprojectScreenToWorldZ(winx,winy,worldZ,mv,proj,viewport,objectCoordinate){const nearPt=tempVec3a;const farPt=tempVec3b;if(!C3.Gfx.Unproject(winx,winy,0,mv,proj,viewport,nearPt))return false;if(!C3.Gfx.Unproject(winx,winy,1,mv,proj,
viewport,farPt))return false;const dirVec=tempVec3b;vec3.subtract(dirVec,farPt,nearPt);const planeNormal=tempVec3c;vec3.set(planeNormal,0,0,1);const planeConstant=-worldZ;const denominator=vec3.dot(planeNormal,dirVec);let distance=0;if(denominator===0){const planeDistToPt=vec3.dot(planeNormal,nearPt)+planeConstant;if(planeDistToPt!==0)return false}else{distance=-(vec3.dot(nearPt,planeNormal)+planeConstant)/denominator;if(distance<0)return false}vec3.scaleAndAdd(objectCoordinate,nearPt,dirVec,distance);
return true}};function PlaneFromPoints(ptA,ptB,ptC,plane){const normal=tempVec3c;vec3.subtract(tempVec3a,ptC,ptB);vec3.subtract(tempVec3b,ptA,ptB);vec3.cross(normal,tempVec3a,tempVec3b);vec3.normalize(normal,normal);plane.set(normal[0],normal[1],normal[2],vec3.dot(ptA,normal))}
function IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,plane){const nx=plane.x;const ny=plane.y;const nz=plane.z;const d=plane.w;const nxT=plane.xF;const nyT=plane.yF;const nzT=plane.zF;const nxF=1-nxT;const nyF=1-nyT;const nzF=1-nzT;const minD=nx*minX*nxT+nx*maxX*nxF+ny*minY*nyT+ny*maxY*nyF+nz*minZ*nzT+nz*maxZ*nzF;if(minD>=d)return true;const maxD=nx*maxX*nxT+nx*minX*nxF+ny*maxY*nyT+ny*minY*nyF+nz*maxZ*nzT+nz*minZ*nzF;return maxD>d}
function IsPointInFrontOfPlane(x,y,z,plane){const nx=plane.x;const ny=plane.y;const nz=plane.z;const d=plane.w;const minD=nx*x+ny*y+nz*z;return minD>=d}class Plane{constructor(){this.x=NaN;this.y=NaN;this.z=NaN;this.w=NaN;this.xF=NaN;this.yF=NaN;this.zF=NaN}set(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;this.xF=x>0?1:0;this.yF=y>0?1:0;this.zF=z>0?1:0}}
C3.Gfx.ViewFrustum=class ViewFrustum{constructor(){this._leftP=new Plane;this._topP=new Plane;this._rightP=new Plane;this._bottomP=new Plane;this._nearP=new Plane;this._farP=new Plane}CalculatePlanes(mv,proj){const vp=unitViewport;C3.Gfx.Unproject(0,1,0,mv,proj,vp,neartl);C3.Gfx.Unproject(1,1,0,mv,proj,vp,neartr);C3.Gfx.Unproject(0,0,0,mv,proj,vp,nearbl);C3.Gfx.Unproject(1,0,0,mv,proj,vp,nearbr);C3.Gfx.Unproject(0,1,1,mv,proj,vp,fartl);C3.Gfx.Unproject(1,1,1,mv,proj,vp,fartr);C3.Gfx.Unproject(0,0,
1,mv,proj,vp,farbl);C3.Gfx.Unproject(1,0,1,mv,proj,vp,farbr);PlaneFromPoints(nearbl,neartl,fartl,this._leftP);PlaneFromPoints(neartl,neartr,fartr,this._topP);PlaneFromPoints(neartr,nearbr,farbr,this._rightP);PlaneFromPoints(nearbr,nearbl,farbl,this._bottomP);PlaneFromPoints(farbl,fartl,fartr,this._farP);PlaneFromPoints(nearbr,neartr,neartl,this._nearP)}ContainsAABB(minX,minY,minZ,maxX,maxY,maxZ){return IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._leftP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,
maxY,maxZ,this._topP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._rightP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._bottomP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._nearP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._farP)}IsBehindNearPlane(x,y,z){return!IsPointInFrontOfPlane(x,y,z,this._nearP)}};

}

// ../lib/gfx/rendererBase.js
{
'use strict';const C3=self.C3;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const vec4=glMatrix.vec4;const mat4=glMatrix.mat4;const tempMat4=mat4.create();const tmpVec3a=vec3.fromValues(0,0,0);const tmpVec3b=vec3.fromValues(0,0,0);const tmpVec3c=vec3.fromValues(0,0,0);const defaultUpVector=vec3.fromValues(0,1,0);const tmpVec4=vec4.fromValues(0,0,0,0);const tmpQuad=new C3.Quad;const tmpRect=new C3.Rect;const defaultTexCoordsQuad=new C3.Quad(0,0,1,0,1,1,0,1);
const DEFAULT_RENDERERBASE_OPTS={nearZ:1,farZ:1E4};const matWebGLtoWebGPU=mat4.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);
C3.Gfx.RendererBase=class RendererBase{constructor(opts){opts=Object.assign({},DEFAULT_RENDERERBASE_OPTS,opts);this._width=0;this._height=0;this._fovY=C3.toRadians(45);this._tan_fovY_2=Math.tan(this._fovY/2);this._matP=mat4.create();this._matMV=mat4.create();this._zAxisScale=false;this._nearZ=opts.nearZ;this._farZ=opts.farZ;this._allShaderPrograms=[];this._shaderProgramsByName=new Map;this._spTextureFill=null;this._spPoints=null;this._spTilemapFill=null;this._spTileRandomization=null;this._spColorFill=
null;this._spLinearGradientFill=null;this._spPenumbraFill=null;this._spHardEllipseFill=null;this._spHardEllipseOutline=null;this._spSmoothEllipseFill=null;this._spSmoothEllipseOutline=null;this._spSmoothLineFill=null;this._stateGroups=new Map;this._currentStateGroup=null;this._blendModeTable=[];this._namedBlendModeMap=new Map;this._baseZ=0;this._currentZ=0;this._lineWidth=1;this._lineWidthStack=[this._lineWidth];this._lineCap=1;this._lineCapStack=[this._lineCap];this._lineOffset=.5;this._lineOffsetStack=
[this._lineOffset];this._frameNumber=0;this._enableMipmaps=true;this._hasMajorPerformanceCaveat=false}FillIndexBufferData(indexData){let i=0,len=indexData.length,fv=0;while(i<len){indexData[i++]=fv;indexData[i++]=fv+1;indexData[i++]=fv+2;indexData[i++]=fv;indexData[i++]=fv+2;indexData[i++]=fv+3;fv+=4}}_ClearState(){this._baseZ=0;this._currentZ=0;this._spTextureFill=null;this._spPoints=null;this._spTilemapFill=null;this._spTileRandomization=null;this._spColorFill=null;this._spLinearGradientFill=null;
this._spPenumbraFill=null;this._spHardEllipseFill=null;this._spHardEllipseOutline=null;this._spSmoothEllipseFill=null;this._spSmoothEllipseOutline=null;this._spSmoothLineFill=null;this._ClearAllShaderPrograms()}InitState(){this._ClearState();this._currentStateGroup=null}OnDeviceOrContextLost(){for(const s of this._allShaderPrograms)s.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(viewH){if(this.IsZAxisScaleNormalized())return 100;else return viewH/
(2*this._GetTanFovYDiv2())}GetZAxisScaleFactor(viewH){if(this.IsZAxisScaleNormalized()){const realZunits=viewH/(2*this._GetTanFovYDiv2());return realZunits/this.GetDefaultCameraZ(viewH)}else return 1}SetNearZ(z){this._nearZ=z}GetNearZ(){return this._nearZ}SetFarZ(z){this._farZ=z}GetFarZ(){return this._farZ}SetFovY(f){this._fovY=f;this._tan_fovY_2=Math.tan(this._fovY/2)}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}SetZAxisScaleNormalized(){this._zAxisScale=false}SetZAxisScaleRegular(){this._zAxisScale=
true}IsZAxisScaleNormalized(){return!this._zAxisScale}IsZAxisScaleRegular(){return this._zAxisScale}CalculatePerspectiveMatrix(outMat,aspect,vpX=.5,vpY=.5){const zNear=this.GetNearZ();const zFar=this.GetFarZ();const fovY=this.GetFovY();if(vpX===.5&&vpY===.5)if(this.IsWebGPU())mat4.perspectiveZO(outMat,fovY,aspect,zNear,zFar);else mat4.perspective(outMat,fovY,aspect,zNear,zFar);else{vpX=1-vpX;const fLeft=vpX*2-2;const fRight=vpX*2;const fBottom=vpY*2-2;const fTop=vpY*2;const fH=this._GetTanFovYDiv2()*
zNear;const fW=fH*aspect;mat4.frustum(outMat,fLeft*fW,fRight*fW,fBottom*fH,fTop*fH,zNear,zFar);if(this.IsWebGPU())mat4.mul(outMat,matWebGLtoWebGPU,outMat)}}CalculateOrthographicMatrix(outMat,width,height,scale=1){const dpr=self.devicePixelRatio;const worldScale=this.GetDefaultCameraZ(height)*2*dpr*this._GetTanFovYDiv2()/height;const hScaleX=width*worldScale/(2*dpr*scale);const hScaleY=height*worldScale/(2*dpr*scale);const left=-hScaleX;const right=hScaleX;const bottom=-hScaleY;const top=hScaleY;if(this.IsWebGPU())mat4.orthoZO(outMat,
left,right,bottom,top,this.GetNearZ(),this.GetFarZ());else mat4.ortho(outMat,left,right,bottom,top,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(outMat,cam,look,up,viewH,zScale=1){let worldScale=1;if(this.IsZAxisScaleNormalized())worldScale=200*this._GetTanFovYDiv2()/viewH;const worldScaleVec3=tmpVec3c;vec3.set(worldScaleVec3,worldScale,-worldScale,1);const tmpCam=tmpVec3a;const tmpLook=tmpVec3b;vec3.multiply(tmpCam,cam,worldScaleVec3);vec3.multiply(tmpLook,look,worldScaleVec3);mat4.lookAt(outMat,
tmpCam,tmpLook,up||defaultUpVector);worldScaleVec3[2]=zScale;mat4.scale(outMat,outMat,worldScaleVec3)}CalculateLookAtModelView2(camX,camY,camZ,lookX,lookY,lookZ,viewH,zScale){vec3.set(tmpVec3a,camX,camY,camZ);vec3.set(tmpVec3b,lookX,lookY,lookZ);this.CalculateLookAtModelView(tempMat4,tmpVec3a,tmpVec3b,defaultUpVector,viewH,zScale);return tempMat4}_AddShaderProgram(sp){this._allShaderPrograms.push(sp);this._shaderProgramsByName.set(sp.GetName(),sp)}_RemoveShaderProgram(sp){const i=this._allShaderPrograms.indexOf(sp);
if(i!==-1)this._allShaderPrograms.splice(i,1);this._shaderProgramsByName.delete(sp.GetName())}_ClearAllShaderPrograms(){C3.clearArray(this._allShaderPrograms);this._shaderProgramsByName.clear()}GetShaderProgramByName(name){return this._shaderProgramsByName.get(name)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(sg){this._currentStateGroup=
sg}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(shaderProgram_or_name,blendMode,color,zElevation){const key=C3.Gfx.StateGroup.MakeKey(shaderProgram_or_name,blendMode,color,zElevation);let stateGroup=this._stateGroups.get(key);if(!stateGroup){stateGroup=C3.New(C3.Gfx.StateGroup,this,shaderProgram_or_name,blendMode,color,zElevation);this._stateGroups.set(key,stateGroup)}stateGroup.AddRef();return stateGroup}ReleaseStateGroup(stateGroup){stateGroup.DecRef();if(stateGroup._GetRefCount()===
0){if(this._currentStateGroup===stateGroup)this._currentStateGroup=null;this._stateGroups.delete(stateGroup.GetKey());stateGroup.Release()}}_InitBlendModeData(blendModeData){C3.clearArray(this._blendModeTable);this._namedBlendModeMap.clear();let number=0;for(const bmd of blendModeData){const name=bmd[0];const srcBlend=bmd[1];const destBlend=bmd[2];this._blendModeTable.push([srcBlend,destBlend]);this._namedBlendModeMap.set(name,{number,srcBlend,destBlend});number++}}_GetBlendByIndex(blendIndex){return this._blendModeTable[blendIndex]}GetSrcBlendByIndex(blendIndex){return this._GetBlendByIndex(blendIndex)[0]}GetDestBlendByIndex(blendIndex){return this._GetBlendByIndex(blendIndex)[1]}GetNamedBlend(blendName){const ret=
this._namedBlendModeMap.get(blendName);if(typeof ret==="undefined")throw new Error("invalid blend name");return ret}NamedBlendToNumber(blendName){const ret=this._namedBlendModeMap.get(blendName);if(typeof ret==="undefined")throw new Error("invalid blend name");return ret.number}SetBaseZ(z){this._baseZ=z}GetBaseZ(){return this._baseZ}SetCurrentZ(z){this._currentZ=z;this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(x1,y1,x2,y2){const a=C3.angleTo(x1,y1,x2,y2);const sin_a=Math.sin(a);
const cos_a=Math.cos(a);const halfLineWidth=this._lineWidth*.5;const sin_a_hlw=sin_a*halfLineWidth;const cos_a_hlw=cos_a*halfLineWidth;const lineCap=this._lineCap;if(lineCap===2)this.LinePreCalc_LineCap2(x1,y1,0,x2,y2,0,sin_a_hlw,cos_a_hlw);else if(lineCap===1)this.LinePreCalc_LineCap1(x1,y1,0,x2,y2,0,sin_a_hlw,cos_a_hlw);else this.LinePreCalc_LineCap0(x1,y1,0,x2,y2,0,sin_a_hlw,cos_a_hlw)}Line3D(x1,y1,z1,x2,y2,z2){const a=C3.angleTo(x1,y1,x2,y2);const sin_a=Math.sin(a);const cos_a=Math.cos(a);const halfLineWidth=
this._lineWidth*.5;const sin_a_hlw=sin_a*halfLineWidth;const cos_a_hlw=cos_a*halfLineWidth;const lineCap=this._lineCap;if(lineCap===2)this.LinePreCalc_LineCap2(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw);else if(lineCap===1)this.LinePreCalc_LineCap1(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw);else this.LinePreCalc_LineCap0(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw)}LinePreCalc_LineCap2(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw){const lineOffset=this._lineOffset;const startX=x1+lineOffset-cos_a_hlw;const startY=y1+
lineOffset-sin_a_hlw;const endX=x2+lineOffset+cos_a_hlw;const endY=y2+lineOffset+sin_a_hlw;const cos_a_lw=cos_a_hlw*2;const sin_a_lw=sin_a_hlw*2;const tlx=startX+sin_a_hlw;const tly=startY-cos_a_hlw;const blx=startX-sin_a_hlw+cos_a_lw;const bly=startY+cos_a_hlw+sin_a_lw;const trx=endX+sin_a_hlw;const try_=endY-cos_a_hlw;const brx=endX-sin_a_hlw-cos_a_lw;const bry=endY+cos_a_hlw-sin_a_lw;this.Quad3D2(tlx,tly,z1,trx,try_,z2,brx,bry,z2,blx,bly,z1,defaultTexCoordsQuad)}LinePreCalc_LineCap1(x1,y1,z1,x2,
y2,z2,sin_a_hlw,cos_a_hlw){const lineOffset=this._lineOffset;const startX=x1+lineOffset-cos_a_hlw;const startY=y1+lineOffset-sin_a_hlw;const endX=x2+lineOffset+cos_a_hlw;const endY=y2+lineOffset+sin_a_hlw;const tlx=startX+sin_a_hlw;const tly=startY-cos_a_hlw;const blx=startX-sin_a_hlw;const bly=startY+cos_a_hlw;const trx=endX+sin_a_hlw;const try_=endY-cos_a_hlw;const brx=endX-sin_a_hlw;const bry=endY+cos_a_hlw;this.Quad3D2(tlx,tly,z1,trx,try_,z2,brx,bry,z2,blx,bly,z1,defaultTexCoordsQuad)}LinePreCalc_LineCap0(x1,
y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw){const lineOffset=this._lineOffset;const startX=x1+lineOffset;const startY=y1+lineOffset;const endX=x2+lineOffset;const endY=y2+lineOffset;const tlx=startX+sin_a_hlw;const tly=startY-cos_a_hlw;const blx=startX-sin_a_hlw;const bly=startY+cos_a_hlw;const trx=endX+sin_a_hlw;const try_=endY-cos_a_hlw;const brx=endX-sin_a_hlw;const bry=endY+cos_a_hlw;this.Quad3D2(tlx,tly,z1,trx,try_,z2,brx,bry,z2,blx,bly,z1,defaultTexCoordsQuad)}TexturedLine(x1,y1,x2,y2,u,v){const a=
C3.angleTo(x1,y1,x2,y2);const sin_a=Math.sin(a);const cos_a=Math.cos(a);const halfLineWidth=this._lineWidth*.5;const sin_a_hlw=sin_a*halfLineWidth;const cos_a_hlw=cos_a*halfLineWidth;const lineCap=this._lineCap;if(lineCap===2)this.TexturedLinePreCalc_LineCap2(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v);else if(lineCap===1)this.TexturedLinePreCalc_LineCap1(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v);else this.TexturedLinePreCalc_LineCap0(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v)}TexturedLinePreCalc_LineCap2(x1,y1,x2,
y2,sin_a_hlw,cos_a_hlw,u,v){const lineOffset=this._lineOffset;const startX=x1+lineOffset-cos_a_hlw;const startY=y1+lineOffset-sin_a_hlw;const endX=x2+lineOffset+cos_a_hlw;const endY=y2+lineOffset+sin_a_hlw;const cos_a_lw=cos_a_hlw*2;const sin_a_lw=sin_a_hlw*2;const tlx=startX+sin_a_hlw;const tly=startY-cos_a_hlw;const blx=startX-sin_a_hlw+cos_a_lw;const bly=startY+cos_a_hlw+sin_a_lw;const trx=endX+sin_a_hlw;const try_=endY-cos_a_hlw;const brx=endX-sin_a_hlw-cos_a_lw;const bry=endY+cos_a_hlw-sin_a_lw;
tmpQuad.set(tlx,tly,trx,try_,brx,bry,blx,bly);tmpRect.set(u,0,v,0);this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap1(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v){const lineOffset=this._lineOffset;const startX=x1+lineOffset-cos_a_hlw;const startY=y1+lineOffset-sin_a_hlw;const endX=x2+lineOffset+cos_a_hlw;const endY=y2+lineOffset+sin_a_hlw;const tlx=startX+sin_a_hlw;const tly=startY-cos_a_hlw;const blx=startX-sin_a_hlw;const bly=startY+cos_a_hlw;const trx=endX+sin_a_hlw;const try_=endY-cos_a_hlw;const brx=
endX-sin_a_hlw;const bry=endY+cos_a_hlw;tmpQuad.set(tlx,tly,trx,try_,brx,bry,blx,bly);tmpRect.set(u,0,v,0);this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap0(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v){const lineOffset=this._lineOffset;const startX=x1+lineOffset;const startY=y1+lineOffset;const endX=x2+lineOffset;const endY=y2+lineOffset;const tlx=startX+sin_a_hlw;const tly=startY-cos_a_hlw;const blx=startX-sin_a_hlw;const bly=startY+cos_a_hlw;const trx=endX+sin_a_hlw;const try_=endY-cos_a_hlw;const brx=
endX-sin_a_hlw;const bry=endY+cos_a_hlw;tmpQuad.set(tlx,tly,trx,try_,brx,bry,blx,bly);tmpRect.set(u,0,v,0);this.Quad3(tmpQuad,tmpRect)}LineRect(left,top,right,bottom){const halfLineWidth=this._lineWidth*.5;const lineCap=this._lineCap;if(lineCap===2)this._LineRectPreCalc_LineCap2(left,top,right,bottom,halfLineWidth);else if(lineCap===1)this._LineRectPreCalc_LineCap1(left,top,right,bottom,halfLineWidth);else this._LineRectPreCalc_LineCap0(left,top,right,bottom,halfLineWidth)}_LineRectPreCalc_LineCap2(left,
top,right,bottom,halfLineWidth){this.LinePreCalc_LineCap2(left,top,0,right,top,0,0,halfLineWidth);this.LinePreCalc_LineCap2(right,top,0,right,bottom,0,halfLineWidth,0);this.LinePreCalc_LineCap2(right,bottom,0,left,bottom,0,0,-halfLineWidth);this.LinePreCalc_LineCap2(left,bottom,0,left,top,0,-halfLineWidth,0)}_LineRectPreCalc_LineCap1(left,top,right,bottom,halfLineWidth){this.LinePreCalc_LineCap1(left,top,0,right,top,0,0,halfLineWidth);this.LinePreCalc_LineCap1(right,top,0,right,bottom,0,halfLineWidth,
0);this.LinePreCalc_LineCap1(right,bottom,0,left,bottom,0,0,-halfLineWidth);this.LinePreCalc_LineCap1(left,bottom,0,left,top,0,-halfLineWidth,0)}_LineRectPreCalc_LineCap0(left,top,right,bottom,halfLineWidth){this.LinePreCalc_LineCap0(left,top,0,right,top,0,0,halfLineWidth);this.LinePreCalc_LineCap0(right,top,0,right,bottom,0,halfLineWidth,0);this.LinePreCalc_LineCap0(right,bottom,0,left,bottom,0,0,-halfLineWidth);this.LinePreCalc_LineCap0(left,bottom,0,left,top,0,-halfLineWidth,0)}LineRect2(r){this.LineRect(r.getLeft(),
r.getTop(),r.getRight(),r.getBottom())}LineQuad(q){const a=C3.angleTo(q.getTlx(),q.getTly(),q.getTrx(),q.getTry());const sin_a=Math.sin(a);const cos_a=Math.cos(a);const halfLineWidth=this._lineWidth*.5;const sin_a_hlw=sin_a*halfLineWidth;const cos_a_hlw=cos_a*halfLineWidth;const lineCap=this._lineCap;if(lineCap===2)this._LineQuadPreCalc_LineCap2(q,sin_a_hlw,cos_a_hlw);else if(lineCap===1)this._LineQuadPreCalc_LineCap1(q,sin_a_hlw,cos_a_hlw);else this._LineQuadPreCalc_LineCap0(q,sin_a_hlw,cos_a_hlw)}_LineQuadPreCalc_LineCap2(q,
sin_a_hlw,cos_a_hlw){this.LinePreCalc_LineCap2(q.getTlx(),q.getTly(),0,q.getTrx(),q.getTry(),0,sin_a_hlw,cos_a_hlw);this.LinePreCalc_LineCap2(q.getTrx(),q.getTry(),0,q.getBrx(),q.getBry(),0,cos_a_hlw,-sin_a_hlw);this.LinePreCalc_LineCap2(q.getBrx(),q.getBry(),0,q.getBlx(),q.getBly(),0,-sin_a_hlw,-cos_a_hlw);this.LinePreCalc_LineCap2(q.getBlx(),q.getBly(),0,q.getTlx(),q.getTly(),0,-cos_a_hlw,sin_a_hlw)}_LineQuadPreCalc_LineCap1(q,sin_a_hlw,cos_a_hlw){this.LinePreCalc_LineCap1(q.getTlx(),q.getTly(),
0,q.getTrx(),q.getTry(),0,sin_a_hlw,cos_a_hlw);this.LinePreCalc_LineCap1(q.getTrx(),q.getTry(),0,q.getBrx(),q.getBry(),0,cos_a_hlw,-sin_a_hlw);this.LinePreCalc_LineCap1(q.getBrx(),q.getBry(),0,q.getBlx(),q.getBly(),0,-sin_a_hlw,-cos_a_hlw);this.LinePreCalc_LineCap1(q.getBlx(),q.getBly(),0,q.getTlx(),q.getTly(),0,-cos_a_hlw,sin_a_hlw)}_LineQuadPreCalc_LineCap0(q,sin_a_hlw,cos_a_hlw){this.LinePreCalc_LineCap0(q.getTlx(),q.getTly(),0,q.getTrx(),q.getTry(),0,sin_a_hlw,cos_a_hlw);this.LinePreCalc_LineCap0(q.getTrx(),
q.getTry(),0,q.getBrx(),q.getBry(),0,cos_a_hlw,-sin_a_hlw);this.LinePreCalc_LineCap0(q.getBrx(),q.getBry(),0,q.getBlx(),q.getBly(),0,-sin_a_hlw,-cos_a_hlw);this.LinePreCalc_LineCap0(q.getBlx(),q.getBly(),0,q.getTlx(),q.getTly(),0,-cos_a_hlw,sin_a_hlw)}SetLineWidth(n){this._lineWidth=n;this._lineWidthStack[this._lineWidthStack.length-1]=n}GetLineWidth(){return this._lineWidth}PushLineWidth(n){if(this._lineWidthStack.length>=100)throw new Error("pushed too many line widths - check push/pop pairs");
this._lineWidthStack.push(n);this._lineWidth=n}PopLineWidth(){if(this._lineWidthStack.length<=1)throw new Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop();this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0;this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1;this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=2;this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(type){if(type===
"butt")this.PushLineCapButt();else if(type==="square")this.PushLineCapSquare();else if(type==="zag")this.PushLineCapZag();else throw new Error("invalid line cap");}PushLineCapButt(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0);this._lineCap=0}PushLineCapSquare(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1);this._lineCap=1}PushLineCapZag(){if(this._lineCapStack.length>=
100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2);this._lineCap=2}PopLineCap(){if(this._lineCapStack.length<=1)throw new Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop();this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(n){this._lineOffset=n;this._lineOffsetStack[this._lineOffsetStack.length-1]=n}GetLineOffset(){return this._lineOffset}PushLineOffset(n){if(this._lineOffsetStack.length>=100)throw new Error("pushed too many line offsets - check push/pop pairs");
this._lineOffsetStack.push(n);this._lineOffset=n}PopLineOffset(){if(this._lineOffsetStack.length<=1)throw new Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop();this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(pts){const pts_count=pts.length/2;if(pts_count<3)throw new Error("need at least 3 points");const tris=pts_count-2;const last_tri=tris-1;const p0x=pts[0];const p0y=pts[1];for(let i=0;i<tris;i+=2){const i2=i*2;const p1x=pts[i2+2];const p1y=pts[i2+3];
const p2x=pts[i2+4];const p2y=pts[i2+5];if(i===last_tri)this.Quad2(p0x,p0y,p1x,p1y,p2x,p2y,p2x,p2y);else{const p3x=pts[i2+6];const p3y=pts[i2+7];this.Quad2(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y)}}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(true);this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(e){this._enableMipmaps=!!e}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(c){this._hasMajorPerformanceCaveat=
!!c}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return false}IsWebGPU(){return false}GetEstimatedBackBufferMemoryUsage(){}GetEstimatedRenderBufferMemoryUsage(){}GetEstimatedTextureMemoryUsage(){}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}CreateRendererText(){return C3.New(C3.Gfx.RendererText,this)}};

}

// ../lib/gfx/shaderProgramBase.js
{
'use strict';const C3=self.C3;
C3.Gfx.ShaderProgramBase=class ShaderProgramBase{constructor(renderer,shaderInfo){this._name=shaderInfo.name;this._renderer=renderer;this._extendBoxHorizontal=shaderInfo.extendBoxHorizontal||0;this._extendBoxVertical=shaderInfo.extendBoxVertical||0;this._crossSampling=!!shaderInfo.crossSampling;this._mustPreDraw=!!shaderInfo.mustPreDraw;this._preservesOpaqueness=!!shaderInfo.preservesOpaqueness;this._supports3dDirectRendering=!!shaderInfo.supports3dDirectRendering;this._animated=!!shaderInfo.animated;
this._blendsBackground=!!shaderInfo.blendsBackground;this._usesDepth=!!shaderInfo.usesDepth;this._usesAnySrcRectOrPixelSize=false;this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||this._extendBoxHorizontal!==0||this._extendBoxVertical!==0}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return this._extendBoxHorizontal!==0||this._extendBoxVertical!==0}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}Supports3DDirectRendering(){return this._supports3dDirectRendering}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}UsesIsSrcTexRotated(){return false}};

}

// ../lib/gfx/stateGroup.js
{
'use strict';const C3=self.C3;
C3.Gfx.StateGroup=class StateGroup{constructor(renderer,shaderProgram_or_name,blendMode,color,zElevation){this._renderer=renderer;this._refCount=0;this._shaderProgram=null;this._shaderProgramName="";this._blendMode=blendMode;this._color=C3.New(C3.Color);this._color.set(color);this._zElevation=zElevation;if(typeof shaderProgram_or_name==="string")this._shaderProgramName=shaderProgram_or_name;else{this._shaderProgram=shaderProgram_or_name;this._shaderProgramName=this._shaderProgram.GetName()}}Release(){if(this._refCount>0)throw new Error("releasing state group still in use");
this._renderer=null;this._shaderProgram=null;this._shaderProgramName=""}Apply(){const renderer=this._renderer;renderer.SetProgram(this._shaderProgram);renderer.SetBlendMode(this._blendMode);renderer.SetColor(this._color);renderer.SetCurrentZ(this._zElevation);renderer._SetCurrentStateGroup(this)}GetKey(){return C3.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=
null}OnContextRestored(renderer){this._shaderProgram=renderer.GetShaderProgramByName(this._shaderProgramName);if(!this._shaderProgram)throw new Error("failed to restore shader program");}static MakeKey(shaderProgram_or_name,blendMode,c,zElevation){const shaderProgramName=typeof shaderProgram_or_name==="string"?shaderProgram_or_name:shaderProgram_or_name.GetName();return shaderProgramName+","+blendMode+","+c.getR()+","+c.getG()+","+c.getB()+","+c.getA()+","+zElevation}};

}

// ../lib/gfx/mesh.js
{
'use strict';const C3=self.C3;const tempQuadTex=C3.New(C3.Quad);function interpolateQuad(srcX,srcY,quad){const qtlx=quad.getTlx();const qtly=quad.getTly();const qtrx=quad.getTrx()-qtlx;const qtry=quad.getTry()-qtly;const qblx=quad.getBlx()-qtlx;const qbly=quad.getBly()-qtly;const xix=qtrx*srcX;const xiy=qtry*srcX;const yix=qblx*srcY;const yiy=qbly*srcY;return[qtlx+xix+yix,qtly+xiy+yiy]}
C3.Gfx.MeshPoint=class MeshPoint{constructor(mesh,col,row){this._mesh=mesh;this._col=col;this._row=row;this._x=NaN;this._y=NaN;this._zElevation=NaN;this._u=NaN;this._v=NaN;this._x=0;this._y=0;this._zElevation=0;this._u=0;this._v=0}_Init(x,y,u,v){this._x=x;this._y=y;this._u=u;this._v=v}GetX(){return this._x}SetX(x){if(this._x===x)return;this._x=x;this._mesh._SetPointsChanged()}GetY(){return this._y}SetY(y){if(this._y===y)return;this._y=y;this._mesh._SetPointsChanged()}GetZElevation(){return this._zElevation}SetZElevation(z){if(this._zElevation===
z)return;this._zElevation=Math.max(z,0);this._mesh._SetPointsChanged()}GetU(){return this._u}SetU(u){this._u=u}GetV(){return this._v}SetV(v){this._v=v}_Interpolate_TexRect(srcPoint,quadPos,rcTex){[this._x,this._y]=interpolateQuad(srcPoint._x,srcPoint._y,quadPos);this._zElevation=srcPoint._zElevation;this._u=C3.lerp(rcTex.getLeft(),rcTex.getRight(),srcPoint._u);this._v=C3.lerp(rcTex.getTop(),rcTex.getBottom(),srcPoint._v)}_Interpolate_TexQuad(srcPoint,quadPos,quadTex){[this._x,this._y]=interpolateQuad(srcPoint._x,
srcPoint._y,quadPos);this._zElevation=srcPoint._zElevation;[this._u,this._v]=interpolateQuad(srcPoint._u,srcPoint._v,quadTex)}SaveToJson(){return{"x":this.GetX(),"y":this.GetY(),"z":this.GetZElevation(),"u":this.GetU(),"v":this.GetV()}}LoadFromJson(o){this.SetX(o["x"]);this.SetY(o["y"]);if(o.hasOwnProperty("z"))this.SetZElevation(o["z"]);this.SetU(o["u"]);this.SetV(o["v"])}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}};
C3.Gfx.Mesh=class Mesh{constructor(hsize,vsize,owner){if(hsize<2||vsize<2)throw new Error("invalid mesh size");this._hsize=hsize;this._vsize=vsize;this._owner=owner||null;this._pts=[];this._minX=0;this._minY=0;this._maxX=1;this._maxY=1;this._maxZ=0;this._pointsChanged=false;const lastX=hsize-1;const lastY=vsize-1;for(let y=0;y<vsize;++y){const row=[];for(let x=0;x<hsize;++x){const meshPoint=C3.New(C3.Gfx.MeshPoint,this,x,y);const xf=x/lastX;const yf=y/lastY;meshPoint._Init(xf,yf,xf,yf);row.push(meshPoint)}this._pts.push(row)}}Release(){C3.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=
true}_MaybeComputeBounds(){if(!this._pointsChanged)return;let minX=Infinity;let minY=Infinity;let maxX=-Infinity;let maxY=-Infinity;let maxZ=0;for(const row of this._pts)for(const meshPoint of row){const x=meshPoint.GetX();const y=meshPoint.GetY();minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y);maxZ=Math.max(maxZ,meshPoint.GetZElevation())}this._minX=minX;this._minY=minY;this._maxX=maxX;this._maxY=maxY;this._maxZ=maxZ;this._pointsChanged=false}GetMinX(){this._MaybeComputeBounds();
return this._minX}GetMinY(){this._MaybeComputeBounds();return this._minY}GetMaxX(){this._MaybeComputeBounds();return this._maxX}GetMaxY(){this._MaybeComputeBounds();return this._maxY}GetMaxZ(){this._MaybeComputeBounds();return this._maxZ}HasAnyZElevation(){return this.GetMaxZ()>0}GetMeshPointAt(x,y){x=Math.floor(x);y=Math.floor(y);if(x<0||x>=this._hsize||y<0||y>=this._vsize)return null;return this._pts[y][x]}CalculateTransformedMesh(srcMesh,quadPos,rcTex_or_quad){const isTexRect=rcTex_or_quad instanceof
C3.Rect;if(srcMesh.GetHSize()!==this.GetHSize()||srcMesh.GetVSize()!==this.GetVSize())throw new Error("source mesh wrong size");const srcPts=srcMesh._pts;const destPts=this._pts;for(let y=0,lenY=destPts.length;y<lenY;++y){const srcRow=srcPts[y];const destRow=destPts[y];for(let x=0,lenX=destRow.length;x<lenX;++x){const srcPoint=srcRow[x];const destPoint=destRow[x];if(isTexRect)destPoint._Interpolate_TexRect(srcPoint,quadPos,rcTex_or_quad);else destPoint._Interpolate_TexQuad(srcPoint,quadPos,rcTex_or_quad)}}}Draw(renderer){const pts=
this._pts;let prevRow=pts[0];for(let y=1,lenY=pts.length;y<lenY;++y){const row=pts[y];let tl=prevRow[0];let bl=row[0];for(let x=1,lenX=row.length;x<lenX;++x){const tr=prevRow[x];const br=row[x];tempQuadTex.set(tl.GetU(),tl.GetV(),tr.GetU(),tr.GetV(),br.GetU(),br.GetV(),bl.GetU(),bl.GetV());renderer.Quad3D2(tl.GetX(),tl.GetY(),tl.GetZElevation(),tr.GetX(),tr.GetY(),tr.GetZElevation(),br.GetX(),br.GetY(),br.GetZElevation(),bl.GetX(),bl.GetY(),bl.GetZElevation(),tempQuadTex);tl=tr;bl=br}prevRow=row}}Outline(renderer,
transformFunc){if(!transformFunc)transformFunc=(x,y,z)=>[x,y,z];const pts=this._pts;let prevRow=pts[0];for(let y=1,lenY=pts.length;y<lenY;++y){const row=pts[y];let tl=prevRow[0];let bl=row[0];for(let x=1,lenX=row.length;x<lenX;++x){const tr=prevRow[x];const br=row[x];const [tlx,tly,tlz]=transformFunc(tl.GetX(),tl.GetY(),tl.GetZElevation());const [trx,try_,trz]=transformFunc(tr.GetX(),tr.GetY(),tr.GetZElevation());const [brx,bry,brz]=transformFunc(br.GetX(),br.GetY(),br.GetZElevation());const [blx,
bly,blz]=transformFunc(bl.GetX(),bl.GetY(),bl.GetZElevation());renderer.Line3D(tlx,tly,tlz,trx,try_,trz);renderer.Line3D(tlx,tly,tlz,brx,bry,brz);renderer.Line3D(tlx,tly,tlz,blx,bly,blz);if(x===lenX-1)renderer.Line3D(trx,try_,trz,brx,bry,brz);if(y===lenY-1)renderer.Line3D(blx,bly,blz,brx,bry,brz);tl=tr;bl=br}prevRow=row}}InsertPolyMeshVertices(srcPoly){const RAY_EXT_DIST=.001;const MIN_RAY_DIST=0;const MAX_RAY_DIST=.99999999;const inPts=srcPoly.pointsArr();const outPts=[];const colCount=this.GetHSize()-
1;const rowCount=this.GetVSize()-1;const colWidthNorm=1/colCount;const rowHeightNorm=1/rowCount;const lastCol=colCount-1;const lastRow=rowCount-1;let curX=inPts[0];let curY=inPts[1];let curCol=C3.clamp(Math.floor(curX*colCount),0,lastCol);let curRow=C3.clamp(Math.floor(curY*rowCount),0,lastRow);let isUpper=true;let nextX=0;let nextY=0;let rayHit=0;const NOTHING_DISABLED=-1;const DISABLE_DIAGONAL=0;const DISABLE_LEFT_EDGE=1;const DISABLE_TOP_EDGE=2;const DISABLE_RIGHT_EDGE=3;const DISABLE_BOTTOM_EDGE=
4;let disableCheck=NOTHING_DISABLED;const addVertexAtRayHit=()=>{curX=C3.clamp(C3.lerp(curX,nextX,rayHit),0,1);curY=C3.clamp(C3.lerp(curY,nextY,rayHit),0,1);outPts.push(curX,curY)};for(let i=0,len=inPts.length;i<len;i+=2){curX=inPts[i];curY=inPts[i+1];outPts.push(curX,curY);curCol=C3.clamp(Math.floor(curX*colCount),0,lastCol);curRow=C3.clamp(Math.floor(curY*rowCount),0,lastRow);const j=(i+2)%len;nextX=inPts[j];nextY=inPts[j+1];disableCheck=NOTHING_DISABLED;while(true){if(outPts.length>1E6)throw new Error("Too many mesh poly points");
const srcTlx=curCol*colWidthNorm;const srcTly=curRow*rowHeightNorm;const srcBrx=(curCol+1)*colWidthNorm;const srcBry=(curRow+1)*rowHeightNorm;isUpper=C3.isPointInTriangleInclusive(curX,curY,srcTlx,srcTly,srcBrx,srcTly,srcBrx,srcBry);if(disableCheck!==DISABLE_DIAGONAL){rayHit=C3.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcTly,srcBrx,srcBry,-RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();isUpper=!isUpper;disableCheck=DISABLE_DIAGONAL;continue}}if(curRow>0&&
disableCheck!==DISABLE_TOP_EDGE){rayHit=C3.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcTly,srcBrx,srcTly,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curRow--;isUpper=false;disableCheck=DISABLE_BOTTOM_EDGE;continue}}if(curCol<lastCol&&disableCheck!==DISABLE_RIGHT_EDGE){rayHit=C3.rayIntersectExtended(curX,curY,nextX,nextY,srcBrx,srcTly,srcBrx,srcBry,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curCol++;isUpper=false;disableCheck=
DISABLE_LEFT_EDGE;continue}}if(curCol>0&&disableCheck!==DISABLE_LEFT_EDGE){rayHit=C3.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcTly,srcTlx,srcBry,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curCol--;isUpper=true;disableCheck=DISABLE_RIGHT_EDGE;continue}}if(curRow<lastRow&&disableCheck!==DISABLE_BOTTOM_EDGE){rayHit=C3.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcBry,srcBrx,srcBry,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();
curRow++;isUpper=true;disableCheck=DISABLE_TOP_EDGE;continue}}break}}return C3.New(C3.CollisionPoly,outPts)}TransformCollisionPoly(srcPoly,destPoly){const ptsArr=this._TransformPolyPoints(srcPoly);this._SimplifyPoly(ptsArr);destPoly.setPoints(ptsArr)}_TransformPolyPoints(srcPoly){const outPts=[];const ptsArr=srcPoly.pointsArr();for(let i=0,len=ptsArr.length;i<len;i+=2){const srcX=ptsArr[i];const srcY=ptsArr[i+1];const [destX,destY]=this.TransformPoint(srcX,srcY);outPts.push(destX,destY)}return outPts}TransformPoint(srcX,
srcY){const lastCol=this.GetHSize()-1;const lastRow=this.GetVSize()-1;const colWidthNorm=1/lastCol;const rowHeightNorm=1/lastRow;const srcCol=C3.clamp(Math.floor(srcX*lastCol),0,lastCol-1);const srcRow=C3.clamp(Math.floor(srcY*lastRow),0,lastRow-1);const srcTlx=srcCol*colWidthNorm;const srcTly=srcRow*rowHeightNorm;const srcBrx=(srcCol+1)*colWidthNorm;const srcBry=(srcRow+1)*rowHeightNorm;const destTl=this.GetMeshPointAt(srcCol,srcRow);const destBr=this.GetMeshPointAt(srcCol+1,srcRow+1);const isUpper=
C3.isPointInTriangleInclusive(srcX,srcY,srcTlx,srcTly,srcBrx,srcTly,srcBrx,srcBry);const srcAltX=isUpper?srcTlx+colWidthNorm:srcTlx;const srcAltY=isUpper?srcTly:srcTly+rowHeightNorm;const destAlt=this.GetMeshPointAt(srcCol+(isUpper?1:0),srcRow+(isUpper?0:1));const [u,v,w]=C3.triangleCartesianToBarycentric(srcX,srcY,srcTlx,srcTly,srcAltX,srcAltY,srcBrx,srcBry);return C3.triangleBarycentricToCartesian3d(u,v,w,destTl.GetX(),destTl.GetY(),destTl.GetZElevation(),destAlt.GetX(),destAlt.GetY(),destAlt.GetZElevation(),
destBr.GetX(),destBr.GetY(),destBr.GetZElevation())}_SimplifyPoly(ptsArr){const outPts=[];const NZ_EPSILON=1E-7;const R_EPSILON=.001;let curX=ptsArr[0];let curY=ptsArr[1];let lastDx=curX-ptsArr.at(-2);let lastDy=curY-ptsArr.at(-1);for(let i=0,len=ptsArr.length;i<len;i+=2){const j=(i+2)%len;const nextX=ptsArr[j];const nextY=ptsArr[j+1];const dx=nextX-curX;const dy=nextY-curY;const bothXNearZero=Math.abs(dx)<NZ_EPSILON&&Math.abs(lastDx)<NZ_EPSILON&&Math.sign(dy)===Math.sign(lastDy);const bothYNearZero=
Math.abs(dy)<NZ_EPSILON&&Math.abs(lastDy)<NZ_EPSILON&&Math.sign(dx)===Math.sign(lastDx);if(!bothXNearZero&&!bothYNearZero&&Math.abs(dx/lastDx-dy/lastDy)>R_EPSILON||dx==0&&dy===0)outPts.push(curX,curY);curX=nextX;curY=nextY;lastDx=dx;lastDy=dy}if(outPts.length>=6&&outPts.length<ptsArr.length)C3.shallowAssignArray(ptsArr,outPts)}SaveToJson(){return{"cols":this.GetHSize(),"rows":this.GetVSize(),"points":this._pts.map(row=>row.map(pt=>pt.SaveToJson()))}}LoadFromJson(o){const cols=this.GetHSize();const rows=
this.GetVSize();if(o["cols"]!==cols||o["rows"]!==rows)throw new Error("mesh data wrong size");const meshRows=o["points"];for(let y=0;y<rows;++y){const rowData=meshRows[y];for(let x=0;x<cols;++x){const pt=this.GetMeshPointAt(x,y);pt.LoadFromJson(rowData[x])}}}};

}

// ../lib/gfx/webgl/texture.js
{
'use strict';const C3=self.C3;const VALID_PIXEL_FORMATS=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]);const VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]);const VALID_MIPMAP_QUALITIES=new Set(["default","low","high"]);const VALID_WRAP_MODES=new Set(["clamp-to-edge","repeat","mirror-repeat"]);
function GetFormatSpecifiers(pixelFormat,gl){let sizedinternalformat;let internalformat;let format;let type;switch(pixelFormat){case "rgba8":sizedinternalformat=gl.RGBA8;internalformat=gl.RGBA;format=gl.RGBA;type=gl.UNSIGNED_BYTE;break;case "rgb8":sizedinternalformat=gl.RGB8;internalformat=gl.RGB;format=gl.RGB;type=gl.UNSIGNED_BYTE;break;case "rgba4":sizedinternalformat=gl.RGBA4;internalformat=gl.RGBA;format=gl.RGBA;type=gl.UNSIGNED_SHORT_4_4_4_4;break;case "rgb5_a1":sizedinternalformat=gl.RGB5_A1;
internalformat=gl.RGBA;format=gl.RGBA;type=gl.UNSIGNED_SHORT_5_5_5_1;break;case "rgb565":sizedinternalformat=gl.RGB565;internalformat=gl.RGB;format=gl.RGB;type=gl.UNSIGNED_SHORT_5_6_5;break;default:throw new Error("invalid pixel format");}return{sizedinternalformat,internalformat,format,type}}
const CREATEFROM_DEFAULT_OPTIONS={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:true,mipMapQuality:"default",premultiplyAlpha:true,isSvg:false,width:-1,height:-1};const UPDATE_DEFAULT_OPTIONS={premultiplyAlpha:true,flipY:false};const allTextures=new Set;
C3.Gfx.WebGLRendererTexture=class WebGLRendererTexture{constructor(renderer){this._renderer=renderer;this._texture=null;this._width=0;this._height=0;this._isStatic=true;this._wrapX="clamp-to-edge";this._wrapY="clamp-to-edge";this._sampling="trilinear";this._anisotropy=0;this._pixelFormat="rgba8";this._isMipMapped=false;this._mipMapQuality="default";this._refCount=0}_CreateStatic(data,opts){if((typeof HTMLImageElement==="undefined"||!(data instanceof HTMLImageElement))&&(typeof HTMLCanvasElement===
"undefined"||!(data instanceof HTMLCanvasElement))&&(typeof ImageBitmap==="undefined"||!(data instanceof ImageBitmap))&&(typeof OffscreenCanvas==="undefined"||!(data instanceof OffscreenCanvas))&&!(data instanceof ImageData)&&!(data instanceof ArrayBuffer)&&data!==null)throw new Error("invalid texture source");opts=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,opts);if(this._texture)throw new Error("already created texture");this._wrapX=opts.wrapX;this._wrapY=opts.wrapY;this._sampling=opts.sampling;
this._anisotropy=opts.anisotropy;this._pixelFormat=opts.pixelFormat;this._isMipMapped=!!opts.mipMap&&this._renderer.AreMipmapsEnabled();this._mipMapQuality=opts.mipMapQuality;if(!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");
this._isStatic=true;if(data instanceof ArrayBuffer||data===null||opts.isSvg){this._width=opts.width;this._height=opts.height;if(data instanceof ArrayBuffer&&data.byteLength!==this._width*this._height*4)throw new Error("ArrayBuffer wrong size");}else{this._width=data.width;this._height=data.height}if(this._width<=0||this._height<=0)throw new Error("invalid texture data size");if(opts.isSvg){const canvas=C3.CreateCanvas(this._width,this._height);const ctx=canvas.getContext("2d");ctx.drawImage(data,
0,0,this._width,this._height);data=canvas}const isPOT=C3.isPOT(this._width)&&C3.isPOT(this._height);const maxTextureSize=this._renderer.GetMaxTextureSize();if(this._width>maxTextureSize||this._height>maxTextureSize)throw new Error("texture data exceeds maximum texture size");const gl=this._renderer.GetContext();const webglVersion=this._renderer.GetWebGLVersionNumber();this._texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"],opts.premultiplyAlpha);
gl.pixelStorei(gl["UNPACK_FLIP_Y_WEBGL"],false);const formatspec=GetFormatSpecifiers(this._pixelFormat,gl);if(!this._renderer.SupportsNPOTTextures()&&!isPOT&&this._IsTiled()){if(data===null)throw new Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");if(data instanceof ArrayBuffer)data=new ImageData(new Uint8ClampedArray(data),this._width,this._height);if(data instanceof ImageData){const tmpCanvas=C3.CreateCanvas(this._width,this._height);const tmpCtx=tmpCanvas.getContext("2d");
tmpCtx.putImageData(data,0,0);data=tmpCanvas}const canvas=C3.CreateCanvas(C3.nextHighestPowerOfTwo(this._width),C3.nextHighestPowerOfTwo(this._height));const ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=this._sampling!=="nearest";ctx.drawImage(data,0,0,this._width,this._height,0,0,canvas.width,canvas.height);gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,formatspec.format,formatspec.type,canvas)}else if(webglVersion>=2){let levels;if(this._isMipMapped)levels=Math.floor(Math.log2(Math.max(this._width,
this._height))+1);else levels=1;gl.texStorage2D(gl.TEXTURE_2D,levels,formatspec.sizedinternalformat,this._width,this._height);if(data instanceof ArrayBuffer)gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this._width,this._height,formatspec.format,formatspec.type,new Uint8Array(data));else if(data!==null)gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,formatspec.format,formatspec.type,data)}else if(data instanceof ArrayBuffer)gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,this._width,this._height,0,formatspec.format,
formatspec.type,new Uint8Array(data));else if(data===null)gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,this._width,this._height,0,formatspec.format,formatspec.type,null);else gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,formatspec.format,formatspec.type,data);if(data!==null)this._SetTextureParameters(gl);gl.bindTexture(gl.TEXTURE_2D,null);this._renderer._ResetLastTexture();this._refCount=1;allTextures.add(this)}_CreateDynamic(width,height,opts){opts=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,
opts);if(this._texture)throw new Error("already created texture");this._wrapX=opts.wrapX;this._wrapY=opts.wrapY;this._sampling=opts.sampling;this._pixelFormat=opts.pixelFormat;this._isMipMapped=!!opts.mipMap&&this._renderer.AreMipmapsEnabled();this._mipMapQuality=opts.mipMapQuality;if(!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");
if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");this._isStatic=false;this._width=Math.floor(width);this._height=Math.floor(height);const isPOT=C3.isPOT(this._width)&&C3.isPOT(this._height);const maxTextureSize=this._renderer.GetMaxTextureSize();if(this._width<=0||this._height<=0)throw new Error("invalid texture size");if(this._width>maxTextureSize||this._height>maxTextureSize)throw new Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&
this._IsTiled()&&!isPOT)throw new Error("non-power-of-two tiled textures not supported");const gl=this._renderer.GetContext();const webglVersion=this._renderer.GetWebGLVersionNumber();this._texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"],opts.premultiplyAlpha);gl.pixelStorei(gl["UNPACK_FLIP_Y_WEBGL"],false);const formatspec=GetFormatSpecifiers(this._pixelFormat,gl);const internalformat=webglVersion>=2?formatspec.sizedinternalformat:
formatspec.internalformat;gl.texImage2D(gl.TEXTURE_2D,0,internalformat,this._width,this._height,0,formatspec.format,formatspec.type,null);this._SetTextureParameters(gl);gl.bindTexture(gl.TEXTURE_2D,null);this._renderer._ResetLastTexture();this._refCount=1;allTextures.add(this)}_GetMipMapHint(gl){if(this._mipMapQuality==="default")return this._isStatic?gl.NICEST:gl.FASTEST;else if(this._mipMapQuality==="low")return gl.FASTEST;else if(this._mipMapQuality==="high")return gl.NICEST;else throw new Error("invalid mipmap quality");
}_IsTiled(){return this._wrapX!=="clamp-to-edge"||this._wrapY!=="clamp-to-edge"}_GetTextureWrapMode(gl,wrapMode){if(wrapMode==="clamp-to-edge")return gl.CLAMP_TO_EDGE;else if(wrapMode==="repeat")return gl.REPEAT;else if(wrapMode==="mirror-repeat")return gl.MIRRORED_REPEAT;else throw new Error("invalid wrap mode");}_SetTextureParameters(gl){const isPOT=C3.isPOT(this._width)&&C3.isPOT(this._height);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this._GetTextureWrapMode(gl,this._wrapX));gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_WRAP_T,this._GetTextureWrapMode(gl,this._wrapY));if(this._sampling==="nearest"){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);this._isMipMapped=false}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);if((isPOT||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){gl.hint(gl.GENERATE_MIPMAP_HINT,this._GetMipMapHint(gl));gl.generateMipmap(gl.TEXTURE_2D);const useTrilinear=this._sampling===
"trilinear"&&!this._renderer.HasMajorPerformanceCaveat();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,useTrilinear?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR_MIPMAP_NEAREST)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);this._isMipMapped=false}}const anisotropicExt=this._renderer._GetAnisotropicExtension();if(anisotropicExt&&this._anisotropy>0&&this._sampling!=="nearest")gl.texParameterf(gl.TEXTURE_2D,anisotropicExt["TEXTURE_MAX_ANISOTROPY_EXT"],Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(data,
opts){if((typeof HTMLImageElement==="undefined"||!(data instanceof HTMLImageElement))&&(typeof HTMLVideoElement==="undefined"||!(data instanceof HTMLVideoElement))&&(typeof HTMLCanvasElement==="undefined"||!(data instanceof HTMLCanvasElement))&&(typeof ImageBitmap==="undefined"||!(data instanceof ImageBitmap))&&(typeof OffscreenCanvas==="undefined"||!(data instanceof OffscreenCanvas))&&!(data instanceof ImageData))throw new Error("invalid texture source");if(!this._texture||this._refCount<=0)throw new Error("texture not created");
if(this._isStatic)throw new Error("cannot update static texture");opts=Object.assign({},UPDATE_DEFAULT_OPTIONS,opts);const dataWidth=data.width||data.videoWidth;const dataHeight=data.height||data.videoHeight;const webglVersion=this._renderer.GetWebGLVersionNumber();const gl=this._renderer.GetContext();gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"],opts.premultiplyAlpha);gl.pixelStorei(gl["UNPACK_FLIP_Y_WEBGL"],!!opts.flipY);const formatspec=GetFormatSpecifiers(this._pixelFormat,
gl);const internalformat=webglVersion>=2?formatspec.sizedinternalformat:formatspec.internalformat;try{if(this._width===dataWidth&&this._height===dataHeight){const isPOT=C3.isPOT(this._width)&&C3.isPOT(this._height);gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,formatspec.format,formatspec.type,data);if((isPOT||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){gl.hint(gl.GENERATE_MIPMAP_HINT,this._GetMipMapHint(gl));gl.generateMipmap(gl.TEXTURE_2D)}}else{this._width=dataWidth;this._height=dataHeight;
const isPOT=C3.isPOT(this._width)&&C3.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!isPOT)throw new Error("non-power-of-two tiled textures not supported");gl.texImage2D(gl.TEXTURE_2D,0,internalformat,formatspec.format,formatspec.type,data);if((isPOT||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){gl.hint(gl.GENERATE_MIPMAP_HINT,this._GetMipMapHint(gl));gl.generateMipmap(gl.TEXTURE_2D)}}}catch(e){console.error("Error updating WebGL texture: ",e)}gl.bindTexture(gl.TEXTURE_2D,
null);this._renderer._ResetLastTexture()}_Delete(){if(this._refCount>0)throw new Error("texture still has references");if(!this._texture)throw new Error("already deleted texture");allTextures.delete(this);const gl=this._renderer.GetContext();gl.deleteTexture(this._texture);this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(this._refCount<=0)throw new Error("no more references");
this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let size=this._width*this._height;switch(this._pixelFormat){case "rgba8":size*=4;break;case "rgb8":size*=3;break;case "rgba4":case "rgb5_a1":case "rgb565":size*=2;break}if(this._isMipMapped)size+=Math.floor(size/3);return size}static OnContextLost(){allTextures.clear()}static allTextures(){return allTextures.values()}};

}

// ../lib/gfx/webgl/renderTarget.js
{
'use strict';const C3=self.C3;const assert=self.assert;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const mat4=glMatrix.mat4;const VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]);const DEFAULT_RENDERTARGET_OPTIONS={sampling:"trilinear",alpha:true,depth:false,isSampled:true,isDefaultSize:true,multisampling:0};const allRenderTargets=new Set;
C3.Gfx.WebGLRenderTarget=class WebGLRenderTarget{constructor(renderer){this._renderer=renderer;this._frameBuffer=null;this._frameBufferNoDepth=null;this._texture=null;this._renderBuffer=null;this._width=0;this._height=0;this._isDefaultSize=true;this._sampling="trilinear";this._alpha=true;this._depth=false;this._isSampled=true;this._multisampling=0;this._projectionMatrix=mat4.create();this._lastFov=0;this._lastNearZ=0;this._lastFarZ=0}_Create(width,height,opts){opts=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,
opts);const webGLVersion=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw new Error("already created render target");this._sampling=opts.sampling;this._alpha=!!opts.alpha;this._depth=!!opts.depth;this._isSampled=!!opts.isSampled;this._isDefaultSize=!!opts.isDefaultSize;this._multisampling=opts.multisampling;if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(this._multisampling>0&&(webGLVersion<2||this._isSampled))throw new Error("invalid use of multisampling");
if(webGLVersion<2)this._isSampled=true;this._width=width;this._height=height;if(this._width<=0||this._height<=0)throw new Error("invalid render target size");this._CalculateProjection();const gl=this._renderer.GetContext();this._frameBuffer=gl.createFramebuffer();if(this._depth)this._frameBufferNoDepth=gl.createFramebuffer();if(this._isSampled){this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:false});
const tex=this._texture._GetTexture();gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,tex,0);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,tex,0)}}else{this._renderBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this._renderBuffer);const internalFormat=this._alpha?gl.RGBA8:gl.RGB8;if(this._multisampling>
0){const formatSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,internalFormat,gl.SAMPLES);if(formatSamples&&formatSamples[0]){const maxSamples=formatSamples[0];if(this._multisampling>maxSamples)this._multisampling=maxSamples}else this._multisampling=0}if(this._multisampling===0)gl.renderbufferStorage(gl.RENDERBUFFER,internalFormat,this._width,this._height);else gl.renderbufferStorageMultisample(gl.RENDERBUFFER,this._multisampling,internalFormat,this._width,this._height);gl.bindFramebuffer(gl.FRAMEBUFFER,
this._frameBuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,this._renderBuffer);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,this._renderBuffer)}gl.bindRenderbuffer(gl.RENDERBUFFER,null)}const rendererDepthBuffer=this._renderer._GetDepthBuffer();if(this._depth&&rendererDepthBuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);if(this._renderer._CanSampleDepth())gl.framebufferTexture2D(gl.FRAMEBUFFER,
gl.DEPTH_STENCIL_ATTACHMENT,gl.TEXTURE_2D,rendererDepthBuffer,0);else gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,rendererDepthBuffer)}gl.bindFramebuffer(gl.FRAMEBUFFER,null);allRenderTargets.add(this)}_Resize(width,height){if(this._width===width&&this._height===height)return;this._width=width;this._height=height;this._CalculateProjection();const gl=this._renderer.GetContext();gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);if(this._texture)this._texture._Update(new ImageData(this._width,
this._height));else{gl.bindRenderbuffer(gl.RENDERBUFFER,this._renderBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,this._alpha?gl.RGBA8:gl.RGB8,this._width,this._height);gl.bindRenderbuffer(gl.RENDERBUFFER,null)}const rendererDepthBuffer=this._renderer._GetDepthBuffer();if(this._depth&&rendererDepthBuffer)if(this._renderer._CanSampleDepth())gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.TEXTURE_2D,rendererDepthBuffer,0);else gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,
gl.RENDERBUFFER,rendererDepthBuffer);gl.bindFramebuffer(gl.FRAMEBUFFER,null)}_Delete(){if(!this._texture&&!this._renderBuffer)throw new Error("already deleted render target");allRenderTargets.delete(this);const gl=this._renderer.GetContext();if(this._texture){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferTexture2D(gl.FRAMEBUFFER,
gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0)}this._renderer.DeleteTexture(this._texture);this._texture=null}else if(this._renderBuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,null);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,null)}gl.deleteRenderbuffer(this._renderBuffer);this._renderBuffer=null}gl.bindFramebuffer(gl.FRAMEBUFFER,
null);if(this._renderer.GetWebGLVersionNumber()>=2){gl.bindFramebuffer(gl.READ_FRAMEBUFFER,null);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null)}gl.deleteFramebuffer(this._frameBuffer);if(this._depth)gl.deleteFramebuffer(this._frameBufferNoDepth);const batchState=this._renderer.GetBatchState();batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;this._frameBuffer=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height);
this._lastFov=this._renderer.GetFovY();this._lastNearZ=this._renderer.GetNearZ();this._lastFarZ=this._renderer.GetFarZ()}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){if(this._renderer.GetFovY()!==this._lastFov||this._renderer.GetNearZ()!==this._lastNearZ||this._renderer.GetFarZ()!==this._lastFarZ)this._CalculateProjection();return this._projectionMatrix}IsLinearSampling(){return this._sampling!==
"nearest"}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){const ret={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};if(!this._isDefaultSize){ret.width=this._width;ret.height=this._height}return ret}IsCompatibleWithOptions(opts){opts=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,
opts);if(opts.sampling!=="nearest"!==this.IsLinearSampling())return false;if(!!opts.alpha!==this.HasAlpha())return false;if(!!opts.depth!==this.HasDepthBuffer())return false;if(this._renderer.GetWebGLVersionNumber()>=2)if(!!opts.isSampled!==this.IsSampled())return false;if(typeof opts.width==="number"||typeof opts.height==="number")return!this.IsDefaultSize()&&this.GetWidth()===Math.floor(opts.width)&&this.GetHeight()===Math.floor(opts.height);else return this.IsDefaultSize()}_GetWebGLTexture(){if(!this._texture)return null;
return this._texture._GetTexture()}GetEstimatedMemoryUsage(){if(this._texture)return this._texture.GetEstimatedMemoryUsage();return this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(renderer,renderTarget){const imageData=await renderer.ReadBackRenderTargetToImageData(renderTarget,true);return await C3.ImageDataToBlob(imageData)}static OnContextLost(){allRenderTargets.clear()}static allRenderTargets(){return allRenderTargets.values()}static ResizeAll(width,height){for(const rt of allRenderTargets)if(rt.IsDefaultSize())rt._Resize(width,
height)}};

}

// ../lib/gfx/webgl/shaderProgram.js
{
'use strict';const C3=self.C3;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const mat4=glMatrix.mat4;
const RESERVED_UNIFORM_NAMES=new Set(["aPos","aTex","aPoints","matP","matMV","samplerFront","samplerBack","samplerDepth","destStart","destEnd","srcStart","srcEnd","srcOriginStart","srcOriginEnd","pixelSize","seconds","devicePixelRatio","layerScale","layerAngle","layoutStart","layoutEnd","color","color2_","pointTexStart","pointTexEnd","zElevation","tileSize","tileSpacing","outlineThickness","zNear","zFar"]);
C3.Gfx.WebGLShaderProgram=class WebGLShaderProgram extends C3.Gfx.ShaderProgramBase{static async Compile(renderer,shaderInfo){const gl=renderer.GetContext();const fragSrc=shaderInfo.src;const vertexSrc=shaderInfo.vertexSrc;const name=shaderInfo.name;const fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragSrc);gl.compileShader(fragmentShader);const vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexSrc);gl.compileShader(vertexShader);
const shaderProgram=gl.createProgram();gl.attachShader(shaderProgram,fragmentShader);gl.attachShader(shaderProgram,vertexShader);gl.bindAttribLocation(shaderProgram,0,"aPos");gl.bindAttribLocation(shaderProgram,1,"aTex");gl.bindAttribLocation(shaderProgram,2,"aPoints");gl.linkProgram(shaderProgram);const parallelShaderCompileExt=renderer._GetParallelShaderCompileExtension();if(parallelShaderCompileExt)await renderer._WaitForObjectReady(()=>gl.getProgramParameter(shaderProgram,parallelShaderCompileExt["COMPLETION_STATUS_KHR"]));
else await C3.Wait(5);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){const log=gl.getShaderInfoLog(fragmentShader);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);throw new Error("Error compiling fragment shader: "+log);}if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){const log=gl.getShaderInfoLog(vertexShader);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);throw new Error("Error compiling vertex shader: "+
log);}if(!gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)){const log=gl.getProgramInfoLog(shaderProgram);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);throw new Error("Error linking shader program: "+log);}const infoLog=C3.FilterUnprintableChars(gl.getProgramInfoLog(shaderProgram)||"").trim();if(infoLog&&!C3.IsStringAllWhitespace(infoLog))console.info(`[WebGL] Shader program '${name}' compilation log: `,infoLog);gl.deleteShader(fragmentShader);
gl.deleteShader(vertexShader);return shaderProgram}static async Create(renderer,shaderInfo){const shaderProgram=await C3.Gfx.WebGLShaderProgram.Compile(renderer,shaderInfo);return new C3.Gfx.WebGLShaderProgram(renderer,shaderProgram,shaderInfo)}constructor(renderer,shaderProgram,shaderInfo){super(renderer,shaderInfo);const gl=renderer.GetContext();const batchState=renderer.GetBatchState();renderer.EndBatch();gl.useProgram(shaderProgram);this._gl=gl;this._shaderProgram=shaderProgram;this._isDeviceTransform=
shaderInfo.name==="<default-device-transform>";const locAPos=gl.getAttribLocation(shaderProgram,"aPos");const locATex=gl.getAttribLocation(shaderProgram,"aTex");this._locAPoints=gl.getAttribLocation(shaderProgram,"aPoints");if(locAPos!==-1){gl.bindBuffer(gl.ARRAY_BUFFER,renderer._vertexBuffer);gl.vertexAttribPointer(locAPos,renderer.GetNumVertexComponents(),gl.FLOAT,false,0,0);gl.enableVertexAttribArray(locAPos)}if(locATex!==-1){gl.bindBuffer(gl.ARRAY_BUFFER,renderer._texcoordBuffer);gl.vertexAttribPointer(locATex,
2,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(locATex)}if(this._locAPoints!==-1){gl.bindBuffer(gl.ARRAY_BUFFER,renderer._pointBuffer);gl.vertexAttribPointer(this._locAPoints,4,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(this._locAPoints)}gl.bindBuffer(gl.ARRAY_BUFFER,null);this._uMatP=new C3.Gfx.WebGLShaderUniform(this,"matP","mat4");this._uMatMV=new C3.Gfx.WebGLShaderUniform(this,"matMV","mat4");this._uColor=new C3.Gfx.WebGLShaderUniform(this,"color","vec4");this._uSamplerFront=new C3.Gfx.WebGLShaderUniform(this,
"samplerFront","sampler");this._uPointTexStart=new C3.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2");this._uPointTexEnd=new C3.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2");this._uZElevation=new C3.Gfx.WebGLShaderUniform(this,"zElevation","float");this._uTileSize=new C3.Gfx.WebGLShaderUniform(this,"tileSize","vec2");this._uTileSpacing=new C3.Gfx.WebGLShaderUniform(this,"tileSpacing","vec2");this._uColor2=new C3.Gfx.WebGLShaderUniform(this,"color2_","vec4");this._uOutlineThickness=new C3.Gfx.WebGLShaderUniform(this,
"outlineThickness","float");this._uSamplerBack=new C3.Gfx.WebGLShaderUniform(this,"samplerBack","sampler");this._uSamplerDepth=new C3.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler");this._uDestStart=new C3.Gfx.WebGLShaderUniform(this,"destStart","vec2");this._uDestEnd=new C3.Gfx.WebGLShaderUniform(this,"destEnd","vec2");this._uSrcStart=new C3.Gfx.WebGLShaderUniform(this,"srcStart","vec2");this._uSrcEnd=new C3.Gfx.WebGLShaderUniform(this,"srcEnd","vec2");this._uSrcOriginStart=new C3.Gfx.WebGLShaderUniform(this,
"srcOriginStart","vec2");this._uSrcOriginEnd=new C3.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2");this._uPixelSize=new C3.Gfx.WebGLShaderUniform(this,"pixelSize","vec2");this._uSeconds=new C3.Gfx.WebGLShaderUniform(this,"seconds","float");this._uDevicePixelRatio=new C3.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float");this._uLayerScale=new C3.Gfx.WebGLShaderUniform(this,"layerScale","float");this._uLayerAngle=new C3.Gfx.WebGLShaderUniform(this,"layerAngle","float");this._uLayoutStart=new C3.Gfx.WebGLShaderUniform(this,
"layoutStart","vec2");this._uLayoutEnd=new C3.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2");this._uZNear=new C3.Gfx.WebGLShaderUniform(this,"zNear","float");this._uZFar=new C3.Gfx.WebGLShaderUniform(this,"zFar","float");this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||
this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed());const customParameterDefs=shaderInfo.parameters||[];this._uCustomParameters=[];this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed();this._hasCurrentMatP=false;this._hasCurrentMatMV=false;this._uColor.Init4f(1,1,1,1);this._uColor2.Init4f(1,1,1,1);this._uSamplerFront.Init1i(0);
this._uSamplerBack.Init1i(1);this._uSamplerDepth.Init1i(2);this._uPointTexStart.Init2f(0,0);this._uPointTexEnd.Init2f(1,1);this._uZElevation.Init1f(0);this._uTileSize.Init2f(0,0);this._uTileSpacing.Init2f(0,0);this._uDestStart.Init2f(0,0);this._uDestEnd.Init2f(1,1);this._uSrcStart.Init2f(0,0);this._uSrcEnd.Init2f(0,0);this._uSrcOriginStart.Init2f(0,0);this._uSrcOriginEnd.Init2f(0,0);this._uPixelSize.Init2f(0,0);this._uDevicePixelRatio.Init1f(1);this._uZNear.Init1f(renderer.GetNearZ());this._uZFar.Init1f(renderer.GetFarZ());
this._uLayerScale.Init1f(1);this._uLayerAngle.Init1f(0);this._uSeconds.Init1f(0);this._uLayoutStart.Init2f(0,0);this._uLayoutEnd.Init2f(0,0);this._uOutlineThickness.Init1f(1);for(const p of customParameterDefs){const uniformName=p[0];const paramType=p[2];const shaderUniform=new C3.Gfx.WebGLShaderUniform(this,uniformName,paramType);if(paramType==="color")shaderUniform.Init3f(0,0,0);else shaderUniform.Init1f(0);this._uCustomParameters.push(shaderUniform)}if(this._isDeviceTransform)this._UpdateDeviceTransformUniforms(batchState.currentMatP);
else{this.UpdateMatP(batchState.currentMatP,true);this.UpdateMatMV(batchState.currentMV,true)}const currentShader=batchState.currentShader;gl.useProgram(currentShader?currentShader._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram);this._shaderProgram=null;this._renderer._RemoveShaderProgram(this);this._gl=null;super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(paramIndex){if(paramIndex<
0||paramIndex>=this._uCustomParameters.length)return null;return this._uCustomParameters[paramIndex].GetType()}AreCustomParametersAlreadySetInBatch(params){for(let i=0,len=params.length;i<len;++i)if(!this._uCustomParameters[i].IsSetToCustomInBatch(params[i]))return false;return true}SetCustomParametersInBatch(params){for(let i=0,len=params.length;i<len;++i)this._uCustomParameters[i].SetBatchValueCustom(params[i])}AreOptionalUniformsAlreadySetInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,
pixelHeight,dpr,layerScale,layerAngle,time){if(this._uSamplerBack.IsUsed())return false;if(this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(pixelWidth,pixelHeight))return false;if(this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(destRect.getLeft(),destRect.getTop()))return false;if(this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(destRect.getRight(),destRect.getBottom()))return false;if(this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(dpr))return false;
if(this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(layerScale))return false;if(this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(layerAngle))return false;if(this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(srcRect.getLeft(),srcRect.getTop()))return false;if(this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(srcRect.getRight(),srcRect.getBottom()))return false;if(this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(srcOriginRect.getLeft(),
srcOriginRect.getTop()))return false;if(this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(srcOriginRect.getRight(),srcOriginRect.getBottom()))return false;if(this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(layoutRect.getLeft(),layoutRect.getTop()))return false;if(this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(layoutRect.getTop(),layoutRect.getBottom()))return false;if(this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(time))return false;return true}SetOptionalUniformsInBatch(destRect,
srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time){if(this._uSamplerBack.IsUsed())return;if(this._uPixelSize.IsUsed())this._uPixelSize.SetBatch2(pixelWidth,pixelHeight);if(this._uDestStart.IsUsed())this._uDestStart.SetBatch2(destRect.getLeft(),destRect.getTop());if(this._uDestEnd.IsUsed())this._uDestEnd.SetBatch2(destRect.getRight(),destRect.getBottom());if(this._uDevicePixelRatio.IsUsed())this._uDevicePixelRatio.SetBatch1(dpr);if(this._uLayerScale.IsUsed())this._uLayerScale.SetBatch1(layerScale);
if(this._uLayerAngle.IsUsed())this._uLayerAngle.SetBatch1(layerAngle);if(this._uSrcStart.IsUsed())this._uSrcStart.SetBatch2(srcRect.getLeft(),srcRect.getTop());if(this._uSrcEnd.IsUsed())this._uSrcEnd.SetBatch2(srcRect.getRight(),srcRect.getBottom());if(this._uSrcOriginStart.IsUsed())this._uSrcOriginStart.SetBatch2(srcOriginRect.getLeft(),srcOriginRect.getTop());if(this._uSrcOriginEnd.IsUsed())this._uSrcOriginEnd.SetBatch2(srcOriginRect.getRight(),srcOriginRect.getBottom());if(this._uLayoutStart.IsUsed())this._uLayoutStart.SetBatch2(layoutRect.getLeft(),
layoutRect.getTop());if(this._uLayoutEnd.IsUsed())this._uLayoutEnd.SetBatch2(layoutRect.getTop(),layoutRect.getBottom());if(this._uSeconds.IsUsed())this._uSeconds.SetBatch1(time)}UpdateMatP(matP,force){if(this._hasCurrentMatP&&!force)return;if(this._isDeviceTransform)return;if(this._uMatP.IsUsed())this._uMatP.UpdateMatrix4fv(matP);this._hasCurrentMatP=true}SetMatPStale(){this._hasCurrentMatP=false}UpdateMatMV(matMV,force){if(this._hasCurrentMatMV&&!force)return;if(this._isDeviceTransform)return;if(this._uMatMV.IsUsed())this._uMatMV.UpdateMatrix4fv(matMV);
this._hasCurrentMatMV=true}SetMatMVStale(){this._hasCurrentMatMV=false}_UpdateDeviceTransformUniforms(matP){if(!this._isDeviceTransform)throw new Error("not device transform shader");this._uMatP.UpdateMatrix4fv(matP);const renderer=this._renderer;const scrollX=renderer.GetWidth()/2;const scrollY=renderer.GetHeight()/2;const tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(renderer.GetHeight()),scrollX,scrollY,0,renderer.GetHeight());this._uMatMV.UpdateMatrix4fv(tempMat4)}UpdateColor(c){if(this._uColor.IsUsed())this._uColor.Update4f(c[0],
c[1],c[2],c[3])}static GetReservedUniformNames(){return RESERVED_UNIFORM_NAMES}static GetDefaultVertexShaderSource(useHighP){const texPrecision=useHighP?"highmedp":"mediump";return[`#ifdef GL_FRAGMENT_PRECISION_HIGH`,`#define highmedp highp`,`#else`,`#define highmedp mediump`,`#endif`,`attribute highp vec3 aPos;`,`attribute ${texPrecision} vec2 aTex;`,`varying ${texPrecision} vec2 vTex;`,`uniform highp mat4 matP;`,`uniform highp mat4 matMV;`,`void main(void) {`,`	gl_Position = matP * matMV * vec4(aPos, 1.0);`,
`	vTex = aTex;`,`}`].join("\n")}static GetDefaultVertexShaderSource_WebGL2(useHighP){const texPrecision=useHighP?"highp":"mediump";return[`#version 300 es`,`in highp vec3 aPos;`,`in ${texPrecision} vec2 aTex;`,`out ${texPrecision} vec2 vTex;`,`uniform highp mat4 matP;`,`uniform highp mat4 matMV;`,`void main(void) {`,`	gl_Position = matP * matMV * vec4(aPos, 1.0);`,`	vTex = aTex;`,`}`].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;",
"uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL2(){return["#version 300 es",
"in mediump vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\toutColor = texture(samplerFront, vTex) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;",
"uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;",
"}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);",
"\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL2(){return["#version 300 es","in highp vec2 vTex;",
"out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highp vec2 srcStart;","uniform highp vec2 pixelSize;","uniform highp vec2 tileSize;","uniform highp vec2 tileSpacing;","void main(void) {","\thighp vec2 tile = floor(vTex);","\thighp vec2 tex = fract(vTex);","\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;",
"\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTileRandomizationFragmentShaderSource(webGLVer,hasFragDepthExt,useDerivatives){let prefix="";if(webGLVer>=2)prefix="#version 300 es\n";else{if(hasFragDepthExt)prefix="#extension GL_EXT_frag_depth : enable\n";if(useDerivatives){prefix+="#extension GL_EXT_shader_texture_lod : enable\n";prefix+="#extension GL_OES_standard_derivatives : enable\n"}}return prefix+
`
>>>>>>> 5cded7f85cb2b1699bb1ddd59c6cb02dcbfb3393
#ifdef GL_FRAGMENT_PRECISION_HIGH
#define highmedp highp
#else
#define highmedp mediump
#endif
precision highmedp float;
${webGLVer>=2?"in":"varying"} vec2 vTex;
${webGLVer>=2?"out lowp vec4 outColor;":""}
uniform lowp vec4 color;
uniform lowp sampler2D samplerFront;
uniform vec2 pixelSize;

uniform vec2 tileSize;
uniform vec2 tileSpacing;
uniform float outlineThickness;

const float PI = 3.1415926;

lowp vec4 cospVec4(lowp vec4 a, lowp vec4 b, float x)
{
	return (a + b + (a - b) * cos(x * PI)) / 2.0;
}

vec3 randVec3(vec2 seed)
{
	return vec3(fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(12.9898,78.233))) * 43758.5453),
				fract(sin(dot(seed.yx + vec2(0.1, 0.1), vec2(12.9898,-78.233))) * 43758.5453),
				fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(-12.9898,-78.233))) * 43758.5453));
}

lowp vec4 sampleTile(vec2 tile, vec2 uv, vec2 ddx, vec2 ddy)
{
	vec2 posRandom = tileSize;
	float angleRandom = outlineThickness;
	
	vec3 rand = (randVec3(floor(tile + 0.5)) - 0.5) * 2.0;
	
	float angle = angleRandom * rand.z * PI;
	float sin_a = sin(angle);
	float cos_a = cos(angle);
	float aspect = pixelSize.x / pixelSize.y;

	vec2 mid = tile + vec2(0.5, 0.5);
	vec2 dp = uv - mid;
	dp.x /= aspect;
	vec2 r = vec2(dp.x * cos_a - dp.y * sin_a,
				  dp.y * cos_a + dp.x * sin_a);
	r.x *= aspect;

	vec2 p = mid + r + (posRandom * rand.xy / 2.0);
	
	${webGLVer>=2?"return textureGrad(samplerFront, p, ddx, ddy);":""}
	${webGLVer<2&&useDerivatives?"return texture2DGradEXT(samplerFront, p, ddx, ddy);":""}
	${webGLVer<2&&!useDerivatives?"return texture2D(samplerFront, p);":""}
}

void main(void) {
	
	${webGLVer<2?"lowp vec4 outColor;":""}
	
	float blendMarginX = tileSpacing.x;
	float blendMarginY = tileSpacing.y;
	
	vec2 tile = floor(vTex);
	vec2 tex = fract(vTex);
	vec2 ddx = ${webGLVer>=2||useDerivatives?"dFdx(vTex)":"vec2(0.0, 0.0)"};
	vec2 ddy = ${webGLVer>=2||useDerivatives?"dFdy(vTex)":"vec2(0.0, 0.0)"};
	
	vec4 curTile = sampleTile(tile, vTex, ddx, ddy);
	
	bool inLeftMargin = (tex.x < blendMarginX);
	bool inRightMargin = (tex.x > 1.0 - blendMarginX);
	bool inTopMargin = (tex.y < blendMarginY);
	bool inBottomMargin = (tex.y > 1.0 - blendMarginY);
	
	if (inLeftMargin)
	{
		lowp vec4 leftTile = sampleTile(tile + vec2(-1.0, 0.0), vTex, ddx, ddy);
		float leftMix = (tex.x / (blendMarginX * 2.0)) + 0.5;
		lowp vec4 leftMixedTile = cospVec4(leftTile, curTile, leftMix);
		
		if (inTopMargin)
		{
			lowp vec4 topTile =     sampleTile(tile + vec2(0.0,  -1.0), vTex, ddx, ddy);
			lowp vec4 topLeftTile = sampleTile(tile + vec2(-1.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topLeftMixedTile = cospVec4(topLeftTile, topTile, leftMix);
			
			outColor = cospVec4(topLeftMixedTile, leftMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
		}
		else if (inBottomMargin)
		{
			lowp vec4 bottomTile =     sampleTile(tile + vec2(0.0,  1.0), vTex, ddx, ddy);
			lowp vec4 bottomLeftTile = sampleTile(tile + vec2(-1.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomLeftMixedTile = cospVec4(bottomLeftTile, bottomTile, leftMix);
			
			outColor = cospVec4(leftMixedTile, bottomLeftMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
		}
		else
		{
			outColor = leftMixedTile;
		}
	}
	else if (inRightMargin)
	{
		lowp vec4 rightTile = sampleTile(tile + vec2(1.0, 0.0), vTex, ddx, ddy);
		float rightMix = (tex.x - (1.0 - blendMarginX)) / (blendMarginX * 2.0);
		lowp vec4 rightMixedTile = cospVec4(curTile, rightTile, rightMix);
		
		if (inTopMargin)
		{
			lowp vec4 topTile =      sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topRightTile = sampleTile(tile + vec2(1.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topRightMixedTile = cospVec4(topTile, topRightTile, rightMix);
			
			outColor = cospVec4(topRightMixedTile, rightMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
		}
		else if (inBottomMargin)
		{
			lowp vec4 bottomTile =      sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomRightTile = sampleTile(tile + vec2(1.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomRightMixedTile = cospVec4(bottomTile, bottomRightTile, rightMix);
			
			outColor = cospVec4(rightMixedTile, bottomRightMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
		}
		else
		{
			outColor = rightMixedTile;
		}
	}
	else if (inTopMargin)
	{
		lowp vec4 topTile = sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);
		outColor = cospVec4(topTile, curTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
	}
	else if (inBottomMargin)
	{
		lowp vec4 bottomTile = sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);
		outColor = cospVec4(curTile, bottomTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
	}
	else
	{
		outColor = curTile;
	}
	
	outColor *= color;
	${webGLVer<2?"gl_FragColor = outColor;":""}
	${webGLVer>=2?"gl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}
	${webGLVer<2&&hasFragDepthExt?"gl_FragDepthEXT = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}
}
<<<<<<< HEAD
`}static GetPointVertexShaderSource_WebGL1(){return"attribute vec4 aPoints;\nvarying float pointOpacity;\nuniform float zElevation;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);\n\tgl_PointSize = aPoints.z;\n\tpointOpacity = aPoints.w;\n}"}static GetPointVertexShaderSource_WebGL2(){return"#version 300 es\nin vec4 aPoints;\nout float pointOpacity;\nuniform float zElevation;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);\n\tgl_PointSize = aPoints.z;\n\tpointOpacity = aPoints.w;\n}"}static GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return"uniform lowp sampler2D samplerFront;\nvarying lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nvoid main(void) {\n\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);\n\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);\n\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));\n\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;\n}"}static GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return"#extension GL_EXT_frag_depth : enable\nuniform lowp sampler2D samplerFront;\nvarying lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nvoid main(void) {\n\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);\n\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);\n\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));\n\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;\n\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetPointFragmentShaderSource_WebGL2(){return"#version 300 es\nuniform lowp sampler2D samplerFront;\nin lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nout lowp vec4 outColor;\nvoid main(void) {\n\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);\n\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);\n\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));\n\toutColor = texture(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;\n\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);\n}"}static GetColorFillFragmentShaderSource(){return"uniform lowp vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}"}static GetLinearGradientFillFragmentShaderSource(){return"precision lowp float;\nvarying mediump vec2 vTex;\nuniform vec4 color;\nuniform vec4 color2_;\nvec3 fromLinear(vec3 linearRGB)\n{\n\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));\n\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);\n\tvec3 lower = linearRGB * vec3(12.92);\n\treturn mix(higher, lower, vec3(cutoff));\n}\nvec3 toLinear(vec3 sRGB)\n{\n\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));\n\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));\n\tvec3 lower = sRGB/vec3(12.92);\n\treturn mix(higher, lower, vec3(cutoff));\n}\nvoid main(void) {\n\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);\n\tfloat a = mix(color.a, color2_.a, vTex.x);\n\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);\n}"}static GetPenumbraFillFragmentShaderSource(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision lowp float;\nvarying highmedp vec2 vTex;\nuniform vec4 color;\nvoid main(void) {\n\thighmedp float grad = vTex.x / (1.0 - vTex.y);\n\tgl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);\n}"}static GetSmoothLineFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nvoid main(void) {\n\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;\n\tgl_FragColor = color * f;\n}"}static GetHardEllipseFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float f = step(diffSq.x + diffSq.y, 0.25);\n\tgl_FragColor = color * f;\n}"}static GetHardEllipseOutlineFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nuniform mediump float outlineThickness;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float distSq = diffSq.x + diffSq.y;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump float innerF = step(distSq, 0.25);\n\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;\n\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;\n\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);\n\tgl_FragColor = color * innerF * outerF;\n}"}static GetSmoothEllipseFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump vec2 halfNormSq = halfNorm * halfNorm;\n\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;\n\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;\n\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);\n\tgl_FragColor = color * f;\n}"}static GetSmoothEllipseOutlineFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nuniform mediump float outlineThickness;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float distSq = diffSq.x + diffSq.y;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump vec2 halfNormSq = halfNorm * halfNorm;\n\tmediump vec2 pxNorm = pixelSize * norm;\n\tmediump vec2 innerEdge1 = halfNorm - pxNorm;\n\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;\n\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);\n\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;\n\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;\n\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);\n\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;\n\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);\n\tgl_FragColor = color * innerF * outerF;\n}"}};
"use strict";const C3$jscomp$52=self.C3,mat4$jscomp$5=self.glMatrix.mat4,TYPE_SIZES=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);
C3$jscomp$52.Gfx.WebGLShaderUniform=class{constructor(a,b,d){if(!TYPE_SIZES.has(d))throw Error("invalid uniform type");this._owner=a;this._gl=this._owner.GetWebGLContext();this._name=b;this._type=d;this._isColorType="color"===this._type;this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),b);this._isUsed=!!this._location;a=TYPE_SIZES.get(d);this._lastValue=new Float32Array(a);this._lastBatchValue=new Float32Array(a)}Release(){this._location=this._gl=this._owner=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(a){this.IsUsed()&&
(this._lastValue[0]=a,this._lastBatchValue.set(this._lastValue),this._gl.uniform1f(this._location,a))}Init1i(a){this.IsUsed()&&(this._lastValue[0]=a,this._lastBatchValue.set(this._lastValue),this._gl.uniform1i(this._location,a))}Init2f(a,b){this.IsUsed()&&(this._lastValue[0]=a,this._lastValue[1]=b,this._lastBatchValue.set(this._lastValue),this._gl.uniform2f(this._location,a,b))}Init3f(a,b,d){this.IsUsed()&&(this._lastValue[0]=a,this._lastValue[1]=b,this._lastValue[2]=d,this._lastBatchValue.set(this._lastValue),
this._gl.uniform3f(this._location,a,b,d))}Init4f(a,b,d,c){this.IsUsed()&&(this._lastValue[0]=a,this._lastValue[1]=b,this._lastValue[2]=d,this._lastValue[3]=c,this._lastBatchValue.set(this._lastValue),this._gl.uniform4f(this._location,a,b,d,c))}Update1f(a){a=Math.fround(a);const b=this._lastValue;b[0]!==a&&(b[0]=a,this._gl.uniform1f(this._location,a))}Update1i(a){const b=this._lastValue;b[0]!==a&&(b[0]=a,this._gl.uniform1i(this._location,a))}Update2f(a,b){a=Math.fround(a);b=Math.fround(b);const d=
this._lastValue;if(d[0]!==a||d[1]!==b)d[0]=a,d[1]=b,this._gl.uniform2f(this._location,a,b)}Update3f(a,b,d){a=Math.fround(a);b=Math.fround(b);d=Math.fround(d);const c=this._lastValue;if(c[0]!==a||c[1]!==b||c[2]!==d)c[0]=a,c[1]=b,c[2]=d,this._gl.uniform3f(this._location,a,b,d)}Update4f(a,b,d,c){a=Math.fround(a);b=Math.fround(b);d=Math.fround(d);c=Math.fround(c);const e=this._lastValue;if(e[0]!==a||e[1]!==b||e[2]!==d||e[3]!==c)e[0]=a,e[1]=b,e[2]=d,e[3]=c,this._gl.uniform4f(this._location,a,b,d,c)}UpdateMatrix4fv(a){const b=
this._lastValue;mat4$jscomp$5.exactEquals(b,a)||(C3$jscomp$52.typedArraySet16(b,a,0),this._gl.uniformMatrix4fv(this._location,!1,a))}IsSetToCustomInBatch(a){const b=this._lastBatchValue;return this.IsColorType()?b[0]===Math.fround(a.getR())&&b[1]===Math.fround(a.getG())&&b[2]===Math.fround(a.getB()):b[0]===Math.fround(a)}SetBatchValueCustom(a){const b=this._lastBatchValue;this.IsColorType()?(b[0]=a.getR(),b[1]=a.getG(),b[2]=a.getB()):b[0]=a}IsSetTo1InBatch(a){return this._lastBatchValue[0]===Math.fround(a)}IsSetTo2InBatch(a,
b){const d=this._lastBatchValue;return d[0]===Math.fround(a)&&d[1]===Math.fround(b)}SetBatch1(a){this._lastBatchValue[0]=a}SetBatch2(a,b){const d=this._lastBatchValue;d[0]=a;d[1]=b}};"use strict";const C3$jscomp$53=self.C3,glMatrix$jscomp$5=self.glMatrix,vec4$jscomp$3=glMatrix$jscomp$5.vec4,mat4$jscomp$6=glMatrix$jscomp$5.mat4;
C3$jscomp$53.Gfx.BatchState=class{constructor(a){this.renderer=a;this.currentMV=mat4$jscomp$6.create();this.currentMatP=mat4$jscomp$6.create();this.currentFramebufferNoDepth=this.currentFramebuffer=null;this.isDepthSamplingEnabled=!1;this.currentColor=vec4$jscomp$3.fromValues(1,1,1,1);this.currentShader=null;this.pointTexCoords=new C3$jscomp$53.Rect;this.clearColor=C3$jscomp$53.New(C3$jscomp$53.Color,0,0,0,0)}};
C3$jscomp$53.Gfx.WebGLBatchJob=class{constructor(a){const b=new ArrayBuffer(96);this._type=0;this._batchState=a;this._gl=a.renderer.GetContext();this._indexCount=this._startIndex=0;this._texParam=null;this._mat4param=new Float32Array(b,0,16);this._colorParam=new Float32Array(b,64,4);this._srcOriginRect=new Float32Array(b,80,4);this._shaderParams=[]}InitQuad(a,b){this._type=1;this._startIndex=a;this._indexCount=b}DoQuad(){const a=this._gl;a.drawElements(a.TRIANGLES,this._indexCount,a.UNSIGNED_SHORT,
this._startIndex)}InitSetTexture(a){this._type=2;this._texParam=a}DoSetTexture(){const a=this._gl,b=this._texParam;a.bindTexture(a.TEXTURE_2D,b?b._GetTexture():null)}InitSetColor(a){this._type=3;a.writeToTypedArray(this._colorParam,0)}DoSetColor(){const a=this._colorParam,b=this._batchState;vec4$jscomp$3.copy(b.currentColor,a);b.currentShader.UpdateColor(a)}InitSetGradientColor(a){this._type=21;a.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){const a=this._colorParam,b=this._batchState.currentShader;
b._uColor2.IsUsed()&&b._uColor2.Update4f(a[0],a[1],a[2],a[3])}InitSetBlend(a,b){this._type=4;this._startIndex=a;this._indexCount=b}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(a,b,d,c){this._type=5;const e=this._colorParam;e[0]=a;e[1]=b;e[2]=d;e[3]=c}DoSetViewport(){const a=this._colorParam;this._gl.viewport(a[0],a[1],a[2],a[3])}InitSetProjection(a){this._type=6;mat4$jscomp$6.copy(this._mat4param,a)}DoSetProjection(){const a=this._batchState,b=a.renderer._allShaderPrograms,
d=a.currentShader,c=this._mat4param;for(let e=0,g=b.length;e<g;++e){const k=b[e];k===d?k.UpdateMatP(c,!0):k.SetMatPStale()}mat4$jscomp$6.copy(a.currentMatP,c)}InitSetModelView(a){this._type=7;mat4$jscomp$6.copy(this._mat4param,a)}DoSetModelView(){const a=this._batchState,b=a.renderer._allShaderPrograms,d=a.currentShader,c=this._mat4param;for(let e=0,g=b.length;e<g;++e){const k=b[e];k===d?k.UpdateMatMV(c,!0):k.SetMatMVStale()}mat4$jscomp$6.copy(a.currentMV,c)}InitSetRenderTarget(a){this._type=8;this._texParam=
a}DoSetRenderTarget(){const a=this._gl,b=this._texParam,d=this._batchState;b?(d.currentFramebuffer=b._GetFramebuffer(),d.currentFramebufferNoDepth=b._GetFramebufferNoDepth(),d.isDepthSamplingEnabled&&d.currentFramebufferNoDepth?a.bindFramebuffer(a.FRAMEBUFFER,d.currentFramebufferNoDepth):a.bindFramebuffer(a.FRAMEBUFFER,d.currentFramebuffer)):(d.currentFramebuffer=null,d.currentFramebufferNoDepth=null,a.bindFramebuffer(a.FRAMEBUFFER,null))}InitClearSurface(a){this._type=9;a.writeToTypedArray(this._mat4param,
0)}InitClearSurface2(a,b,d,c){this._type=9;const e=this._mat4param;e[0]=a;e[1]=b;e[2]=d;e[3]=c}DoClearSurface(){const a=this._gl;var b=this._mat4param;const d=this._batchState.clearColor,c=b[0],e=b[1],g=b[2];b=b[3];d.equalsRgba(c,e,g,b)||(a.clearColor(c,e,g,b),d.setRgba(c,e,g,b));a.clear(a.COLOR_BUFFER_BIT)}InitSetPointTexCoords(a){this._type=15;a.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){const a=this._mat4param;this._batchState.pointTexCoords.set(a[0],a[1],a[2],a[3])}InitPoints(a,
b){this._type=10;this._startIndex=a;this._indexCount=1;this._mat4param[0]=b}DoPoints(){const a=this._gl,b=this._batchState,d=b.renderer._spPoints;a.useProgram(d._shaderProgram);d.UpdateMatP(b.currentMatP,!1);d.UpdateMatMV(b.currentMV,!1);var c=b.pointTexCoords;d._uPointTexStart.IsUsed()&&d._uPointTexStart.Update2f(c.getLeft(),c.getTop());d._uPointTexEnd.IsUsed()&&d._uPointTexEnd.Update2f(c.getRight(),c.getBottom());c=this._mat4param[0];d._uZElevation.IsUsed()&&d._uZElevation.Update1f(c);d._uColor.IsUsed()&&
(c=b.currentColor,d._uColor.Update4f(c[0],c[1],c[2],c[3]));a.drawArrays(a.POINTS,this._startIndex/4,this._indexCount);a.useProgram(b.currentShader._shaderProgram)}InitSetProgram(a){this._type=11;this._texParam=a}DoSetProgram(){var a=this._gl;const b=this._batchState,d=this._texParam;b.currentShader=d;a.useProgram(d._shaderProgram);d.UpdateMatP(b.currentMatP,!1);d.UpdateMatMV(b.currentMV,!1);d._uColor.IsUsed()&&(a=b.currentColor,d._uColor.Update4f(a[0],a[1],a[2],a[3]))}InitSetProgramParameters(){this._type=
12}DoSetProgramParameters(){const a=this._batchState.currentShader,b=this._gl,d=this._mat4param,c=this._colorParam,e=this._srcOriginRect;if(a._uSamplerBack.IsUsed()){const g=this._batchState.renderer,k=this._texParam;g._lastTexture1!==k&&(b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,k?k._GetTexture():null),g._lastTexture1=k,b.activeTexture(b.TEXTURE0))}a._uPixelSize.IsUsed()&&a._uPixelSize.Update2f(d[0],d[1]);a._uDestStart.IsUsed()&&a._uDestStart.Update2f(d[2],d[3]);a._uDestEnd.IsUsed()&&
a._uDestEnd.Update2f(d[4],d[5]);a._uDevicePixelRatio.IsUsed()&&a._uDevicePixelRatio.Update1f(this._indexCount);a._uLayerScale.IsUsed()&&a._uLayerScale.Update1f(d[6]);a._uLayerAngle.IsUsed()&&a._uLayerAngle.Update1f(d[7]);a._uSrcStart.IsUsed()&&a._uSrcStart.Update2f(d[12],d[13]);a._uSrcEnd.IsUsed()&&a._uSrcEnd.Update2f(d[14],d[15]);a._uSrcOriginStart.IsUsed()&&a._uSrcOriginStart.Update2f(e[0],e[1]);a._uSrcOriginEnd.IsUsed()&&a._uSrcOriginEnd.Update2f(e[2],e[3]);a._uLayoutStart.IsUsed()&&a._uLayoutStart.Update2f(c[0],
c[1]);a._uLayoutEnd.IsUsed()&&a._uLayoutEnd.Update2f(c[2],c[3]);a._uSeconds.IsUsed()&&a._uSeconds.Update1f(this._startIndex)}InitSetProgramCustomParameters(){this._type=13}DoSetProgramCustomParameters(){const a=this._batchState.currentShader._uCustomParameters,b=this._shaderParams;for(let d=0,c=a.length;d<c;++d){const e=a[d],g=b[d];e.IsColorType()?e.Update3f(g.getR(),g.getG(),g.getB()):e.Update1f(g)}}InitInvalidateFramebuffer(a){this._type=14;this._texParam=a}DoInvalidateFramebuffer(){const a=this._gl,
b=this._texParam,d=this._batchState.currentFramebuffer;b!==d&&a.bindFramebuffer(a.FRAMEBUFFER,b);a.invalidateFramebuffer(a.FRAMEBUFFER,[a.COLOR_ATTACHMENT0]);b!==d&&a.bindFramebuffer(a.FRAMEBUFFER,d)}InitBlitFramebuffer(a,b,d){this._type=17;const c=this._mat4param,e=this._batchState.renderer;c[0]=a.GetWidth();c[1]=a.GetHeight();c[2]=b?b.GetWidth():e.GetWidth();c[3]=b?b.GetHeight():e.GetHeight();c[4]=a.IsLinearSampling()?1:0;c[5]="stretch"===d;d=this._shaderParams;C3$jscomp$53.clearArray(d);d.push(a._GetFramebuffer());
d.push(b?b._GetFramebuffer():null)}DoBlitFramebuffer(){var a=this._mat4param,b=this._shaderParams;const d=this._gl;var c=a[0],e=a[1],g=a[2];const k=a[3],l=0!==a[4];a=0!==a[5];const n=b[1];d.bindFramebuffer(d.READ_FRAMEBUFFER,b[0]);d.bindFramebuffer(d.DRAW_FRAMEBUFFER,n);a?d.blitFramebuffer(0,0,c,e,0,0,g,k,d.COLOR_BUFFER_BIT,l?d.LINEAR:d.NEAREST):(b=Math.min(c,g),c=Math.min(e,k),g=Math.max(e-k,0),e=Math.max(k-e,0),d.blitFramebuffer(0,g,b,c+g,0,e,b,c+e,d.COLOR_BUFFER_BIT,d.NEAREST))}InitStartQuery(a){this._type=
18;this._texParam=a}DoStartQuery(){this._texParam.BeginTimeElapsed();this._texParam=null}InitEndQuery(a){this._type=19;this._texParam=a}DoEndQuery(){this._texParam.EndTimeElapsed();this._texParam=null}InitSetEllipseParams(a,b,d){this._type=20;const c=this._mat4param;c[0]=a;c[1]=b;c[2]=d}DoSetEllipseParams(){const a=this._batchState.currentShader,b=this._mat4param;a._uPixelSize.IsUsed()&&a._uPixelSize.Update2f(b[0],b[1]);a._uOutlineThickness.IsUsed()&&a._uOutlineThickness.Update1f(b[2])}InitSetTilemapInfo(a,
b,d,c,e,g,k){this._type=16;const l=this._mat4param;a.writeToTypedArray(l,0);l[4]=1/b;l[5]=1/d;l[6]=c/b;l[7]=e/d;l[8]=g/b;l[9]=k/d}DoSetTilemapInfo(){const a=this._batchState.currentShader,b=this._mat4param;a._uSrcStart.IsUsed()&&a._uSrcStart.Update2f(b[0],b[1]);a._uPixelSize.IsUsed()&&a._uPixelSize.Update2f(b[4],b[5]);a._uTileSize.IsUsed()&&a._uTileSize.Update2f(b[6],b[7]);a._uTileSpacing.IsUsed()&&a._uTileSpacing.Update2f(b[8],b[9])}InitSetTileRandomizationInfo(a,b,d,c,e,g,k){this._type=29;const l=
this._mat4param;l[0]=1/a;l[1]=1/b;l[2]=d;l[3]=c;l[4]=e;l[5]=g;l[6]=k}DoSetTileRandomizationInfo(){const a=this._batchState.currentShader,b=this._mat4param;a._uPixelSize.IsUsed()&&a._uPixelSize.Update2f(b[0],b[1]);a._uTileSize.IsUsed()&&a._uTileSize.Update2f(b[2],b[3]);a._uOutlineThickness.IsUsed()&&a._uOutlineThickness.Update1f(b[4]);a._uTileSpacing.IsUsed()&&a._uTileSpacing.Update2f(b[5],b[6])}InitClearDepth(a){this._type=22;this._startIndex=a?1:0}DoClearDepth(){const a=this._gl,b=0!==this._startIndex;
b||a.depthMask(!0);a.clear(a.DEPTH_BUFFER_BIT);b||a.depthMask(!1)}InitSetDepthEnabled(a){this._type=23;this._startIndex=a?1:0}DoSetDepthEnabled(){const a=this._gl;0===this._startIndex?(a.disable(a.DEPTH_TEST),a.depthMask(!1)):(a.enable(a.DEPTH_TEST),a.depthMask(!0))}InitSetDepthSamplingEnabled(a){this._type=24;this._startIndex=a?1:0}DoSetDepthSamplingEnabled(){const a=this._gl,b=this._batchState,d=b.renderer,c=0!==this._startIndex;b.isDepthSamplingEnabled=c;a.activeTexture(a.TEXTURE2);c?(b.currentFramebufferNoDepth&&
a.bindFramebuffer(a.FRAMEBUFFER,b.currentFramebufferNoDepth),a.bindTexture(a.TEXTURE_2D,d._GetDepthBuffer())):(a.bindTexture(a.TEXTURE_2D,null),b.currentFramebufferNoDepth&&a.bindFramebuffer(a.FRAMEBUFFER,b.currentFramebuffer));a.activeTexture(a.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=25}DoCoplanarStartStencilPass(){const a=this._gl;a.clear(a.STENCIL_BUFFER_BIT);a.enable(a.STENCIL_TEST);a.stencilFunc(a.ALWAYS,1,1);a.stencilOp(a.KEEP,a.KEEP,a.REPLACE);a.colorMask(!1,!1,!1,!1)}InitCoplanarStartColorPass(){this._type=
26}DoCoplanarStartColorPass(){const a=this._gl;a.colorMask(!0,!0,!0,!0);a.stencilFunc(a.EQUAL,1,1);a.stencilOp(a.KEEP,a.KEEP,a.KEEP)}InitCoplanarRestore(){this._type=27}DoCoplanarRestore(){const a=this._gl;a.disable(a.STENCIL_TEST)}InitSetScissor(a,b,d,c,e){this._type=28;this._startIndex=a?1:0;a=this._mat4param;a[0]=b;a[1]=d;a[2]=c;a[3]=e}DoSetScissor(){const a=this._gl,b=this._mat4param;1===this._startIndex?(a.enable(a.SCISSOR_TEST),a.scissor(b[0],b[1],b[2],b[3])):a.disable(a.SCISSOR_TEST)}Run(){switch(this._type){case 1:this.DoQuad();
break;case 2:this.DoSetTexture();break;case 3:this.DoSetColor();break;case 4:this.DoSetBlend();break;case 5:this.DoSetViewport();break;case 6:this.DoSetProjection();break;case 7:this.DoSetModelView();break;case 8:this.DoSetRenderTarget();break;case 9:this.DoClearSurface();break;case 10:this.DoPoints();break;case 11:this.DoSetProgram();break;case 12:this.DoSetProgramParameters();break;case 13:this.DoSetProgramCustomParameters();break;case 14:this.DoInvalidateFramebuffer();break;case 15:this.DoSetPointTextureCoords();
break;case 16:this.DoSetTilemapInfo();break;case 17:this.DoBlitFramebuffer();break;case 18:this.DoStartQuery();break;case 19:this.DoEndQuery();break;case 20:this.DoSetEllipseParams();break;case 21:this.DoSetGradientColor();break;case 22:this.DoClearDepth();break;case 23:this.DoSetDepthEnabled();break;case 24:this.DoSetDepthSamplingEnabled();break;case 25:this.DoCoplanarStartStencilPass();break;case 26:this.DoCoplanarStartColorPass();break;case 27:this.DoCoplanarRestore();break;case 28:this.DoSetScissor();
break;case 29:this.DoSetTileRandomizationInfo()}}};"use strict";
const C3$jscomp$54=self.C3,GENERIC_FONT_FAMILIES=new Set("serif sans-serif monospace cursive fantasy system-ui ui-serif ui-sans-serif ui-monospace ui-rounded math emoji fangsong".split(" ")),DEFAULT_OPTS={timeout:60},tempColor=new C3$jscomp$54.Color(0,0,0,1),VALID_HORIZ_ALIGNMENTS=new Set(["left","center","right"]),VALID_VERT_ALIGNMENTS=new Set(["top","center","bottom"]),VALID_WORD_WRAP_MODES=new Set(["word","character"]),VALID_TEXT_DIRECTIONS=new Set(["ltr","rtl"]),allRendererTexts=new Set;
C3$jscomp$54.FontManager&&C3$jscomp$54.FontManager.addEventListener("fontload",a=>{a=a.font.GetName();for(const b of allRendererTexts)(b.IsBBCodeEnabled()||C3$jscomp$54.equalsNoCase(b.GetFontName(),a))&&b._SetWordWrapChanged()});function fillOrStrokeRect(a,b,d,c,e,g){b?a.strokeRect(d,c,e,g):a.fillRect(d,c,e,g)}function ptToPx(a){return 4/3*a}function getOffsetParam(a,b){a=a.trim();const d=parseFloat(a);return isFinite(d)?a.endsWith("%")?b*d/100:d:0}
let didCheckFoundBoundingBoxSupport=!1,supportsFontBoundingBoxMeasurements=!1;
C3$jscomp$54.Gfx.RendererText=class{constructor(a,b){b=Object.assign({},DEFAULT_OPTS,b);this._renderer=a;this._fontName="Arial";this._fontSize=16;this._fontSizeScale=1;this._lineHeight=0;this._isItalic=this._isBold=!1;this._colorStr="black";this._isBBcodeEnabled=!1;this._iconSet=null;this._iconSmoothing=!0;this.onloadfont=null;this._alreadyLoadedFonts=new Set;this._horizontalAlign="left";this._verticalAlign="top";this._text="";this._bbString=null;this._wrappedText=C3$jscomp$54.New(C3$jscomp$54.WordWrap);
this._wrapMode="word";this._textDirection="ltr";this._drawChanged=this._textLayoutChanged=this._wordWrapChanged=!1;this._drawMaxCharCount=-1;this._height=this._width=this._cssHeight=this._cssWidth=this._drawCharCount=0;this._zoom=1;this._measureContextTop=this._measureContext=this._textContext=this._textCanvas=null;this._lastCanvasHeight=this._lastCanvasWidth=-1;this._lastTextCanvasFillStyle=this._lastMeasureCanvasFont=this._lastTextCanvasFont="";this._lastTextCanvasLineWidth=this._lastTextCanvasOpacity=
1;this._measureTextCallback=d=>this._MeasureText(d);this._texture=null;this._rcTex=new C3$jscomp$54.Rect;this._scaleFactor=1;this._textureTimeout=new C3$jscomp$54.IdleTimeout(()=>{this.ReleaseTexture();this._SetTextCanvasSize(8,8)},b.timeout);this.ontextureupdate=null;this._wasReleased=!1;allRendererTexts.add(this)}Release(){this.onloadfont=null;this._alreadyLoadedFonts.clear();this._measureTextCallback=this._measureContextTop=this._measureContext=this._textContext=this._textCanvas=this._bbString=
this._iconSet=null;this._textureTimeout.Release();this.ontextureupdate=null;this.ReleaseTexture();this._wrappedText.Clear();this._renderer=this._wrappedText=null;this._wasReleased=!0;allRendererTexts.delete(this)}_SetDrawChanged(){this._drawChanged=!0}_SetTextLayoutChanged(){this._SetDrawChanged();this._textLayoutChanged=!0}_SetWordWrapChanged(){this._SetTextLayoutChanged();this._wordWrapChanged=!0}SetBBCodeEnabled(a){a=!!a;this._isBBcodeEnabled!==a&&(a=(this._isBBcodeEnabled=a)?"alphabetic":"top",
this._textContext&&(this._textContext.textBaseline=a),this._measureContext&&(this._measureContext.textBaseline=a),this._SetWordWrapChanged())}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetIconSet(a){this._iconSet!==a&&(this._iconSet=a,this._wrappedText.SetIconSet(a),this._iconSet&&this._iconSet.IsLoading()&&this._iconSet.LoadContent().then(()=>this._SetDrawChanged()),this._SetWordWrapChanged())}SetIconSmoothing(a){a=!!a;this._iconSmoothing!==a&&(this._iconSmoothing=a,this._SetDrawChanged())}SetFontName(a){a||
(a="serif");this._fontName!==a&&(this._fontName=a,this._SetWordWrapChanged())}GetFontName(){return this._fontName}SetFontSize(a){.1>a&&(a=.1);this._fontSize!==a&&(this._fontSize=a,this._SetWordWrapChanged())}GetFontSize(){return this._fontSize}SetFontSizeScale(a){this._fontSizeScale!==a&&(this._fontSizeScale=a,this._SetWordWrapChanged())}SetLineHeight(a){this._lineHeight!==a&&(this._lineHeight=a,this._SetTextLayoutChanged())}GetLineHeight(){return this._lineHeight}SetBold(a){a=!!a;this._isBold!==
a&&(this._isBold=a,this._SetWordWrapChanged())}IsBold(){return this._isBold}SetItalic(a){a=!!a;this._isItalic!==a&&(this._isItalic=a,this._SetWordWrapChanged())}IsItalic(){return this._isItalic}SetDrawMaxCharacterCount(a){a=Math.floor(a);this._drawMaxCharCount!==a&&(this._drawMaxCharCount=a,this._SetDrawChanged())}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetFontString(a,b){let d=[];(this._isBold||b.HasStyleTag("b"))&&d.push("bold");(this._isItalic||b.HasStyleTag("i"))&&d.push("italic");
var c=b.GetStyleTag("size");c=(c?parseFloat(c.param):this._fontSize)*this._fontSizeScale;a?d.push(c+"pt"):d.push(c*this.GetDrawScale()+"pt");a=this._fontName;(b=b.GetStyleTag("font"))&&b.param&&(a=b.param,this.onloadfont&&!this._alreadyLoadedFonts.has(a)&&(this.onloadfont(a),this._alreadyLoadedFonts.add(a)));a&&(GENERIC_FONT_FAMILIES.has(a)?d.push(a):d.push('"'+a+'"'));return d.join(" ")}SetColor(a){a instanceof C3$jscomp$54.Color&&(a=a.getCssRgb());this._colorStr!==a&&(this._colorStr=a,this._SetDrawChanged())}SetColorRgb(a,
b,d){tempColor.setRgb(a,b,d);this.SetColor(tempColor)}SetHorizontalAlignment(a){if(!VALID_HORIZ_ALIGNMENTS.has(a))throw Error("invalid horizontal alignment");this._horizontalAlign!==a&&(this._horizontalAlign=a,this._SetTextLayoutChanged())}GetHorizontalAlignment(){return this._horizontalAlign}SetVerticalAlignment(a){if(!VALID_VERT_ALIGNMENTS.has(a))throw Error("invalid vertical alignment");this._verticalAlign!==a&&(this._verticalAlign=a,this._SetTextLayoutChanged())}GetVerticalAlignment(){return this._verticalAlign}SetWordWrapMode(a){if(!VALID_WORD_WRAP_MODES.has(a))throw Error("invalid word wrap mode");
this._wrapMode!==a&&(this._wrapMode=a,this._SetWordWrapChanged())}GetWordWrapMode(){return this._wrapMode}SetTextDirection(a){if(!VALID_TEXT_DIRECTIONS.has(a))throw Error("invalid text direction");this._textDirection!==a&&(this._textDirection=a,this._textContext&&(this._textContext.direction=this._textDirection),this._measureContext&&(this._measureContext.direction=this._textDirection),this._SetWordWrapChanged())}GetTextDirection(){return this._textDirection}SetText(a){this._text!==a&&(this._text=
a,this._SetWordWrapChanged())}GetText(){return this._text}GetDrawScale(){return this._scaleFactor*this._zoom*self.devicePixelRatio}SetSize(a,b,d){"undefined"===typeof d&&(d=1);if(!(0>=a||0>=a||this._cssWidth===a&&this._cssHeight===b&&this._zoom===d)){var c=this._cssWidth;this._cssWidth=a;this._cssHeight=b;this._zoom=d;a=self.devicePixelRatio;this._width=this._cssWidth*this._zoom*a;this._height=this._cssHeight*this._zoom*a;a=Math.max(this._width,this._height);b=Math.min(this._renderer.GetMaxTextureSize(),
4096);d=1;a>b&&(d=b/a,this._width=Math.min(this._width*d,b),this._height=Math.min(this._height*d,b));this._scaleFactor=d;this._cssWidth!==c?this._SetWordWrapChanged():this._SetTextLayoutChanged()}}GetWidth(){return this._width}GetHeight(){return this._height}GetZoom(){return this._zoom}GetTextWidth(){this._UpdateTextMeasurements();return this._wrappedText.GetMaxLineWidth()}GetTextHeight(){this._UpdateTextMeasurements();return this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*
(this._lineHeight+4)-this._lineHeight}GetLengthInGraphemes(){this._UpdateTextMeasurements();let a=0;for(const b of this._wrappedText.GetLines())for(const d of b.fragments())a+=d.GetLength();return a}GetTexture(){this._textureTimeout.Reset();this._MaybeUpdate();return this._texture}HitTestFragment(a,b){this._UpdateTextMeasurements();const d=this.GetDrawScale();var c=this._wrappedText.GetLines();for(const e of c)if(c=e.GetFontBoundingBoxDescent()*d,b>=e.GetPosY()-e.GetHeight()*d+c&&b<e.GetPosY()+c)for(const g of e.fragments())if(a>=
g.GetPosX()&&a<g.GetPosX()+g.GetWidth()*d)return g;return null}*fragmentsWithTag(a){this._UpdateTextMeasurements();var b=this._wrappedText.GetLines();for(const d of b)for(const c of d.fragments())(b=c.GetStyleTag("tag"))&&C3$jscomp$54.equalsNoCase(b.param,a)&&(yield c)}FindFragmentWithTag(a,b){for(const d of this.fragmentsWithTag(a)){if(0===b)return d;--b}return null}CountFragmentsWithTag(a){let b=0;for(const d of this.fragmentsWithTag(a))++b;return b}_MaybeUpdate(){this._texture&&!this._drawChanged&&
!this._textLayoutChanged&&!this._wordWrapChanged||this._wasReleased||0>=this._width||0>=this._height||(this._drawChanged=!1,this._DoUpdate())}_DoUpdate(){this._wasReleased||(this._UpdateTextMeasurements(),this._SetTextCanvasSize(Math.max(C3$jscomp$54.nextHighestPowerOfTwo(Math.ceil(this._width)),128),Math.max(C3$jscomp$54.nextHighestPowerOfTwo(Math.ceil(this._height)),64)),this._DrawTextToCanvas(),this._UpdateTexture(),this._textureTimeout.Reset())}_SetTextCanvasSize(a,b){this._textCanvas||(this._textCanvas=
C3$jscomp$54.CreateCanvas(16,16));let d=!1;if(this._lastCanvasWidth!==a||this._lastCanvasHeight!==b)this._lastCanvasWidth=a,this._lastCanvasHeight=b,this._textCanvas.width=a,this._textCanvas.height=b,d=!0;this._textContext||(this._textContext=this._textCanvas.getContext("2d"),d=!0);d?(this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._textContext.direction=this._textDirection,this._textContext.font=this._lastTextCanvasFont,this._textContext.fillStyle=this._lastTextCanvasFillStyle,
this._textContext.strokeStyle=this._lastTextCanvasFillStyle,this._textContext.globalAlpha=this._lastTextCanvasOpacity,this._textContext.lineWidth=this._lastTextCanvasLineWidth):this._textContext.clearRect(0,0,a,b)}_MaybeCreateMeasureContext(){this._measureContext||(this._measureContext=C3$jscomp$54.CreateCanvas(16,16).getContext("2d"),this._measureContextTop=C3$jscomp$54.CreateCanvas(16,16).getContext("2d"),this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._measureContextTop.textBaseline=
"top",this._measureContext.direction=this._textDirection,this._measureContextTop.direction=this._textDirection)}_SetMeasureFontString(a){this._lastMeasureCanvasFont!==a&&(this._lastMeasureCanvasFont=a,this._measureContext.font=a,this._measureContextTop.font=a)}_SupportsFontBoundingBoxMeasurements(){if(!didCheckFoundBoundingBoxSupport){didCheckFoundBoundingBoxSupport=!0;this._MaybeCreateMeasureContext();const a=this._measureContext.measureText("test");supportsFontBoundingBoxMeasurements="number"===
typeof a.fontBoundingBoxAscent&&"number"===typeof a.fontBoundingBoxDescent}return supportsFontBoundingBoxMeasurements}_UpdateTextMeasurements(){this._UpdateWordWrap();this._UpdateTextLayout()}_UpdateWordWrap(){this._wordWrapChanged&&(this._MaybeCreateMeasureContext(),!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new C3$jscomp$54.BBString(this._text,{noEscape:!0})),this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,
this._measureTextCallback,this._cssWidth,this._wrapMode,0),this._wordWrapChanged=!1)}_UpdateTextLayout(){this._textLayoutChanged&&(this._LayoutText(),this._textLayoutChanged=!1)}_MeasureText(a){var b=a.IsText()?a.GetCharacterArray().join(""):" ";this._SetMeasureFontString(this._GetFontString(!0,a));a=a.GetStyleTag("size");a=(a?parseFloat(a.param):this._fontSize)*this._fontSizeScale;const d=this._measureContext.measureText(b);let c=0;this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()&&
(b=this._measureContextTop.measureText(b),c=d.fontBoundingBoxAscent-b.fontBoundingBoxAscent);return{width:d.width,height:ptToPx(a),fontBoundingBoxAscent:d.fontBoundingBoxAscent||0,fontBoundingBoxDescent:d.fontBoundingBoxDescent||0,topToAlphabeticDistance:c}}_SetDrawFontString(a){this._lastTextCanvasFont!==a&&(this._lastTextCanvasFont=a,this._textContext.font=a)}_SetDrawCanvasColor(a){this._lastTextCanvasFillStyle!==a&&(this._lastTextCanvasFillStyle=a,this._textContext.fillStyle=a,this._textContext.strokeStyle=
a)}_SetDrawCanvasOpacity(a){this._lastTextCanvasOpacity!==a&&(this._lastTextCanvasOpacity=a,this._textContext.globalAlpha=a)}_SetDrawCanvasLineWith(a){this._lastTextCanvasLineWidth!==a&&(this._lastTextCanvasLineWidth=a,this._textContext.lineWidth=a)}_LayoutText(){const a=this.GetDrawScale(),b=(4+this._lineHeight)*a;var d=0;const c=this._wrappedText.GetLines();if(0!==c.length){for(var e of c){e.SetPosX(NaN);e.SetPosY(NaN);for(var g of e.fragments())g.SetPosX(NaN),g.SetPosY(NaN)}g=this._isBBcodeEnabled&&
this._SupportsFontBoundingBoxMeasurements();e=c[0].GetHeight()*a;"center"===this._verticalAlign?(d=c.reduce((k,l)=>k+l.GetHeight()*a+b,0)-b,d=Math.max(this._height/2-d/2,0),g&&(e=c[0].GetTopToAlphabeticDistance()*a)):"bottom"===this._verticalAlign&&(d=c.reduce((k,l)=>k+l.GetHeight()*a+b,0)-this._lineHeight*a,g=g?c.at(-1).GetFontBoundingBoxDescent()*a:0,d=this._height-d-g-2);for(let k=0,l=c.length;k<l;++k){g=c[k];const n=g.GetHeight()*a,p=d;if(this._isBBcodeEnabled){if(d+=0===k?e:n,0<k&&d>this._height-
4*a)break}else if(0<k&&d>=this._height-n)break;0<=p&&this._LayoutTextLine(g,d,a);this._isBBcodeEnabled||(d+=n);d+=b}}}_LayoutTextLine(a,b,d){let c=0;"center"===this._horizontalAlign?c=(this._width-a.GetWidth()*d)/2:"right"===this._horizontalAlign&&(c=this._width-a.GetWidth()*d);a.SetPosX(c);a.SetPosY(b);for(const e of"ltr"===this._textDirection?a.fragments():a.fragmentsReverse())this._LayoutFragment(e,c,b,d),c+=e.GetWidth()*d}_LayoutFragment(a,b,d,c){var e=a.GetStyleTag("offsetx");b+=e?getOffsetParam(e.param,
a.GetHeight())*c:0;e=a.GetStyleTag("offsety");d+=e?getOffsetParam(e.param,a.GetHeight())*c:0;a.IsIcon()&&(e=a.GetStyleTag("iconoffsety"),d+=e?getOffsetParam(e.param,a.GetHeight())*c:.2*a.GetHeight()*c);a.SetPosX(b);a.SetPosY(d)}_DrawTextToCanvas(){this._textContext.imageSmoothingEnabled=this._iconSmoothing;this._drawCharCount=0;const a=this.GetDrawScale(),b=this._wrappedText.GetLines();for(const d of b)this._DrawTextLine(d,a)}_DrawTextLine(a,b){const d=a.GetPosX(),c=a.GetPosY();if(Number.isFinite(d)&&
Number.isFinite(c))for(const e of"ltr"===this._textDirection?a.fragments():a.fragmentsReverse())this._DrawFragment(e,b,a.GetHeight())}_DrawFragment(a,b,d){const c=this._textContext,e=a.GetPosX(),g=a.GetPosY();if(Number.isFinite(e)&&Number.isFinite(g)){var k=d/16;d=a.GetWidth()*b;var l=a.GetHeight()*b,n=a.GetHeight()/16,p=(4+this._lineHeight)*b,r=a.IsText()?a.GetCharacterArray():null;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;a.IsText()&&this._drawCharCount+
r.length>this._drawMaxCharCount&&(r=r.slice(0,this._drawMaxCharCount-this._drawCharCount),d=this._MeasureText(a).width*b);this._drawCharCount+=a.GetLength()}var w=a.GetStyleTag("background"),z=a.HasStyleTag("u"),B=a.HasStyleTag("s");if((!a.IsText()||!C3$jscomp$54.IsCharArrayAllWhitespace(r)||w||z||B)&&!a.HasStyleTag("hide")){var C=a.GetStyleTag("color"),E=a.GetStyleTag("opacity");this._SetDrawCanvasOpacity(E?parseFloat(E.param)/100:1);w&&(this._SetDrawCanvasColor(w.param),c.fillRect(e,g-l,d,l+p));
p=(p=a.GetStyleTag("linethickness"))?parseFloat(p.param):1;(w=a.HasStyleTag("stroke"))&&this._SetDrawCanvasLineWith(.5*n*p*this.GetDrawScale());a.IsText()?(r=r.join(""),this._SetDrawFontString(this._GetFontString(!1,a)),!w&&(this._SetDrawCanvasLineWith(.5*n*p*this.GetDrawScale()),E=a.GetStyleTag("outlineback"))&&(this._SetDrawCanvasColor(E.param),this._FillOrStrokeText(!0,r,e,g,d)),this._SetDrawCanvasColor(C?C.param:this._colorStr),this._FillOrStrokeText(w,r,e,g,d),!w&&(this._SetDrawCanvasLineWith(.5*
n*p*this.GetDrawScale()),a=a.GetStyleTag("outline"))&&(this._SetDrawCanvasColor(a.param),this._FillOrStrokeText(!0,r,e,g,d))):a.IsIcon()&&0<a.GetWidth()&&(a=a.GetDrawable(this._iconSet))&&c.drawImage(a,e,g-l,d,l);this._SetDrawCanvasColor(C?C.param:this._colorStr);z&&fillOrStrokeRect(c,w,e,g+b*k,d,b*k*p);B&&(b*=n,c.fillRect(e,g-l/4+b/2-b*p/2,d,b*p))}}}_FillOrStrokeText(a,b,d,c,e){"rtl"===this._textDirection&&(d+=e);a?"Gecko"===C3$jscomp$54.Platform.BrowserEngine?this._textContext.strokeText(b,d,c,
e):this._textContext.strokeText(b,d,c):"Gecko"===C3$jscomp$54.Platform.BrowserEngine?this._textContext.fillText(b,d,c,e):this._textContext.fillText(b,d,c)}_UpdateTexture(){if(!this._renderer.IsContextLost()&&(this._texture||(this._texture=this._renderer.CreateDynamicTexture(this._textCanvas.width,this._textCanvas.height,{mipMap:!0,mipMapQuality:"high"})),this._renderer.UpdateTexture(this._textCanvas,this._texture),this._rcTex.set(0,0,this._width/this._texture.GetWidth(),this._height/this._texture.GetHeight()),
this.ontextureupdate))this.ontextureupdate()}GetTexRect(){return this._rcTex}ReleaseTexture(){this._texture&&(this._renderer.IsContextLost()||this._renderer.DeleteTexture(this._texture),this._texture=null)}static OnContextLost(){for(const a of allRendererTexts)a.ReleaseTexture()}static GetAll(){return allRendererTexts.values()}};"use strict";const C3$jscomp$55=self.C3;
class WebGLRealTimeElapsedQuery{constructor(a){this._gl=a.GetContext();this._version=a.GetWebGLVersionNumber();this._timerExt=a._GetDisjointTimerQueryExtension();this._query=null;this._hasResult=this._isActive=!1;this._result=0;this._query=1===this._version?this._timerExt.createQueryEXT():this._gl.createQuery()}Release(){this._DeleteQueryObject();this._timerExt=this._gl=null;this._hasResult=!1}_DeleteQueryObject(){this._query&&(1===this._version?this._timerExt.deleteQueryEXT(this._query):this._gl.deleteQuery(this._query),
this._query=null)}BeginTimeElapsed(){if(this._isActive)throw Error("query already active");1===this._version?this._timerExt.beginQueryEXT(this._timerExt.TIME_ELAPSED_EXT,this._query):this._gl.beginQuery(this._timerExt.TIME_ELAPSED_EXT,this._query);this._isActive=!0}EndTimeElapsed(){if(!this._isActive)throw Error("query not active");1===this._version?this._timerExt.endQueryEXT(this._timerExt.TIME_ELAPSED_EXT):this._gl.endQuery(this._timerExt.TIME_ELAPSED_EXT);this._isActive=!1}CheckForResult(){if(this._query&&
!this._hasResult&&!this._isActive){var a=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_AVAILABLE_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE);var b=this._gl.getParameter(this._timerExt.GPU_DISJOINT_EXT);a&&!b&&(this._result=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT),this._result/=1E9,this._hasResult=!0);(a||
b)&&this._DeleteQueryObject()}}HasResult(){return this._hasResult}GetResult(){if(!this._hasResult)throw Error("no result available");return this._result}}
C3$jscomp$55.Gfx.WebGLTimeElapsedQuery=class{constructor(a){this._renderer=a;this._frameNumber=a.GetFrameNumber();this._isActive=!1;this._parentQuery=null;this._isNested=!1;this._realQuery=null;this._queries=[]}Release(){for(const a of this._queries)a instanceof WebGLRealTimeElapsedQuery&&a.Release();C3$jscomp$55.clearArray(this._queries);this._renderer=this._realQuery=this._parentQuery=null}BeginTimeElapsed(){if(this._isActive)throw Error("query already active");const a=this._renderer._GetTimeQueryStack();
0<a.length?(this._isNested=!0,this._parentQuery=a.at(-1),this._parentQuery._EndReal(),this._parentQuery._queries.push(this)):(this._isNested=!1,this._parentQuery=null);this._isActive=!0;a.push(this);this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw Error("query not active");if(this._renderer._GetTimeQueryStack().pop()!==this)throw Error("can only end most nested query");this._isActive=!1;this._EndReal();this._parentQuery&&(this._parentQuery._StartReal(),this._parentQuery=null)}_StartReal(){this._realQuery=
C3$jscomp$55.New(WebGLRealTimeElapsedQuery,this._renderer);this._queries.push(this._realQuery);this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed();this._realQuery=null}CheckForResult(){for(const a of this._queries)a.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every(a=>a.HasResult())}GetResult(){return this._queries.reduce((a,b)=>a+b.GetResult(),0)}GetFrameNumber(){return this._frameNumber}};"use strict";const C3$jscomp$56=self.C3;
C3$jscomp$56.Gfx.WebGLQueryResultBuffer=class{constructor(a,b=1E3){this._renderer=a;this._maxQueries=b;this._buffer=[];this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear();this._renderer._RemoveQueryResultBuffer(this);this._renderer=null}Clear(){for(const a of this._buffer)a.Release();C3$jscomp$56.clearArray(this._buffer)}AddTimeElapsedQuery(){const a=new C3$jscomp$56.Gfx.WebGLTimeElapsedQuery(this._renderer);this._buffer.push(a);this._buffer.length>this._maxQueries&&this._buffer.shift().Release();
return a}CheckForResults(a){for(const b of this._buffer){if(b.GetFrameNumber()>=a)break;if(b.IsNested())break;b.CheckForResult()}}GetFrameRangeResultSum(a,b){if(b<=a)return NaN;let d=0;for(const c of this._buffer){if(c.GetFrameNumber()>=b)break;if(!(c.GetFrameNumber()<a))if(c.HasResult())d+=c.GetResult();else return NaN}return d}DeleteAllBeforeFrameNumber(a){for(let b=0,d=this._buffer.length;b<d;++b){const c=this._buffer[b];if(c.GetFrameNumber()<a)c.Release();else{0<b&&this._buffer.splice(0,b);break}}}};
"use strict";
const C3$jscomp$57=self.C3,glMatrix$jscomp$6=self.glMatrix,vec4$jscomp$4=glMatrix$jscomp$6.vec4,mat4$jscomp$7=glMatrix$jscomp$6.mat4,DEFAULT_WEBGLRENDERER_OPTS={powerPreference:"default",enableGpuProfiling:!0,alpha:!1,depth:!1,canSampleDepth:!1,maxWebGLVersion:2,failIfMajorPerformanceCaveat:!1},VALID_POWER_PREFERENCES=new Set(["default","low-power","high-performance"]),MAX_INDICES=12E3,LAST_POINT=7996,defaultTexCoordsQuad$jscomp$1=new C3$jscomp$57.Quad(0,0,1,0,1,1,0,1),tmpProjection=mat4$jscomp$7.create(),
tmpModelView=mat4$jscomp$7.create(),tmpQuad$jscomp$1=new C3$jscomp$57.Quad,tmpRect$jscomp$1=new C3$jscomp$57.Rect;let loseContextExtension=null;C3$jscomp$57.isDebug&&(self.debug_lose_webgl_context=function(){loseContextExtension?loseContextExtension.loseContext():console.warn("WEBGL_lose_context not supported")},self.debug_restore_webgl_context=function(){loseContextExtension?loseContextExtension.restoreContext():console.warn("WEBGL_lose_context not supported")});const pendingPolls=new Set;
let pollRafId=-1;function CheckPendingPolls(){pollRafId=-1;for(const a of pendingPolls)a.checkFunc()&&(a.resolve(),pendingPolls.delete(a));0<pendingPolls.size&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls))}
C3$jscomp$57.Gfx.WebGLRenderer=class extends C3$jscomp$57.Gfx.RendererBase{constructor(a,b){super(b);b=Object.assign({},DEFAULT_WEBGLRENDERER_OPTS,b);if(!VALID_POWER_PREFERENCES.has(b.powerPreference))throw Error("invalid power preference");const d={alpha:!!b.alpha,depth:!1,antialias:!1,powerPreference:b.powerPreference,failIfMajorPerformanceCaveat:!!b.failIfMajorPerformanceCaveat};let c=null,e=0;2<=b.maxWebGLVersion&&(c=a.getContext("webgl2",d),e=2);c||(c=a.getContext("webgl",d),e=1);if(!c)throw Error("renderer-unavailable (could not get WebGL context)");
this._gl=c;this._attribs=c.getContextAttributes();this._versionString=c.getParameter(c.VERSION);this._version=e;this._viewport=vec4$jscomp$4.create();this._didChangeTransform=!1;this._bbProjectionMatrix=mat4$jscomp$7.create();this._usesDepthBuffer=!!b.depth;this._canSampleDepth=!(!b.depth||!b.canSampleDepth);this._isDepthEnabled=this._usesDepthBuffer;this._isDepthSamplingEnabled=!1;this._depthBuffer=null;this._isAutoSizeDepthBuffer=!0;this._depthBufferHeight=this._depthBufferWidth=0;this._pointBuffer=
this._indexBuffer=this._texcoordBuffer=this._vertexBuffer=null;this._vertexData=new Float32Array(8E3*this.GetNumVertexComponents());this._indexData=new Uint16Array(MAX_INDICES);this._texcoordData=new Float32Array(16E3);this._pointData=new Float32Array(32E3);this._lastVertexPtr=this._pointPtr=this._texPtr=this._vertexPtr=0;this._spDeviceTransformTextureFill=this._lastProgram=null;this._batch=[];this._topOfBatch=this._batchPtr=0;this._currentRenderTarget=null;this._lastPointZ=0;this._batchState=C3$jscomp$57.New(C3$jscomp$57.Gfx.BatchState,
this);this._lastColor=C3$jscomp$57.New(C3$jscomp$57.Color,1,1,1,1);this._lastTexture1=this._lastTexture0=null;this._lastDestBlend=this._lastSrcBlend=0;this._lastPointTexCoords=new C3$jscomp$57.Rect;this._lastScissorRect=C3$jscomp$57.New(C3$jscomp$57.Rect,0,0,-1,-1);this._coplanarMode=0;this._maxTextureSize=-1;this._highpPrecision=this._maxPointSize=this._minPointSize=0;this._unmaskedRenderer=this._unmaskedVendor="(unavailable)";this._extensions=[];this._isInitialisingAfterContextRestored=!1;this._textureLodExt=
this._stdDerivativesExt=this._fragDepthExt=this._depthTextureExt=this._anisotropicExt=this._parallelShaderCompileExt=null;this._maxAnisotropy=0;this._isGpuProfilingEnabled=!!b.enableGpuProfiling;this._timerExt=null;this._allQueryResultBuffers=new Set;this._timeQueryStack=[];this.FillIndexBufferData(this._indexData)}IsWebGL(){return!0}async InitState(){super.InitState();var a=this._gl,b=this.GetNumVertexComponents();this._lastColor.setRgba(1,1,1,1);this._lastTexture1=this._lastTexture0=null;this._pointPtr=
this._vertexPtr=0;this._lastVertexPtr=8E3*b-4*b;C3$jscomp$57.clearArray(this._batch);this._topOfBatch=this._batchPtr=0;this._currentRenderTarget=this._lastProgram=null;this._lastPointTexCoords.set(0,0,1,1);this._lastPointZ=0;b=this._batchState;b.currentShader=null;b.currentFramebuffer=null;b.currentFramebufferNoDepth=null;vec4$jscomp$4.set(b.currentColor,1,1,1,1);b.clearColor.setRgba(0,0,0,0);b.pointTexCoords.set(0,0,1,1);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,
a.ONE_MINUS_SRC_ALPHA);this._lastSrcBlend=a.ONE;this._lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this._InitBlendModes(a);a.disable(a.CULL_FACE);a.disable(a.STENCIL_TEST);a.disable(a.DITHER);this._usesDepthBuffer?(a.enable(a.DEPTH_TEST),a.depthMask(!0),a.depthFunc(a.LEQUAL)):(a.disable(a.DEPTH_TEST),a.depthMask(!1));this._isDepthEnabled=this._usesDepthBuffer;this._isDepthSamplingEnabled=!1;this._pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._pointBuffer);a.bufferData(a.ARRAY_BUFFER,this._pointData.byteLength,
a.DYNAMIC_DRAW);this._vertexBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this._vertexData.byteLength,a.DYNAMIC_DRAW);this._texcoordBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._texcoordBuffer);a.bufferData(a.ARRAY_BUFFER,this._texcoordData.byteLength,a.DYNAMIC_DRAW);this._indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indexData,a.STATIC_DRAW);a.activeTexture(a.TEXTURE0);
a.bindTexture(a.TEXTURE_2D,null);this._maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);b=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this._minPointSize=b[0];this._maxPointSize=b[1];b=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT);var d=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);this._highpPrecision=b&&d?Math.min(b.precision,d.precision):0;2048<this._maxPointSize&&(this._maxPointSize=2048);this._extensions=a.getSupportedExtensions();if(b=a.getExtension("WEBGL_debug_renderer_info"))this._unmaskedVendor=
a.getParameter(b.UNMASKED_VENDOR_WEBGL),this._unmaskedRenderer=a.getParameter(b.UNMASKED_RENDERER_WEBGL);this._parallelShaderCompileExt=a.getExtension("KHR_parallel_shader_compile");C3$jscomp$57.isDebug&&(loseContextExtension=a.getExtension("WEBGL_lose_context"));this._isGpuProfilingEnabled&&(1===this.GetWebGLVersionNumber()?this._timerExt=a.getExtension("EXT_disjoint_timer_query"):this._timerExt=a.getExtension("EXT_disjoint_timer_query_webgl2")||a.getExtension("EXT_disjoint_timer_query"));this._maxAnisotropy=
(this._anisotropicExt=a.getExtension("EXT_texture_filter_anisotropic"))?a.getParameter(this._anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;if(2>this.GetWebGLVersionNumber()&&this._usesDepthBuffer&&this._canSampleDepth&&(this._depthTextureExt=a.getExtension("WEBGL_depth_texture"),!this._depthTextureExt))throw Error("no depth texture support");2>this.GetWebGLVersionNumber()&&(this._fragDepthExt=a.getExtension("EXT_frag_depth"),this._stdDerivativesExt=a.getExtension("OES_standard_derivatives"),this._textureLodExt=
a.getExtension("EXT_shader_texture_lod"));a=C3$jscomp$57.Gfx.WebGLShaderProgram;b=a.GetDefaultVertexShaderSource(!1);d=a.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth();let c=b,e=a.GetPointFragmentShaderSource_WebGL1_NoFragDepth(),g=a.GetPointVertexShaderSource_WebGL1(),k=a.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(),l=a.GetDefaultVertexShaderSource(!0);var n=!1;this._usesDepthBuffer&&(2>this.GetWebGLVersionNumber()?this._fragDepthExt&&(d=a.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(),
e=a.GetPointFragmentShaderSource_WebGL1_FragDepthEXT(),k=a.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(),n=!0):(c=a.GetDefaultVertexShaderSource_WebGL2(),d=a.GetTextureFillFragmentShaderSource_WebGL2(),e=a.GetPointFragmentShaderSource_WebGL2(),g=a.GetPointVertexShaderSource_WebGL2(),k=a.GetTilemapFragmentShaderSource_WebGL2(),l=a.GetDefaultVertexShaderSource_WebGL2(!0)));n=a.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),n,this._stdDerivativesExt&&this._textureLodExt);
const p=2<=this.GetWebGLVersionNumber()?a.GetDefaultVertexShaderSource_WebGL2():b;a=[[d,c,"<default>"],[d,c,"<default-device-transform>"],[e,g,"<point>"],[a.GetColorFillFragmentShaderSource(),b,"<fill>"],[a.GetLinearGradientFillFragmentShaderSource(),b,"<lineargradient>"],[a.GetPenumbraFillFragmentShaderSource(),b,"<penumbra>"],[a.GetHardEllipseFillFragmentShaderSource(),b,"<hardellipse>"],[a.GetHardEllipseOutlineFragmentShaderSource(),b,"<hardellipseoutline>"],[a.GetSmoothEllipseFillFragmentShaderSource(),
b,"<smoothellipse>"],[a.GetSmoothEllipseOutlineFragmentShaderSource(),b,"<smoothellipseoutline>"],[a.GetSmoothLineFillFragmentShaderSource(),b,"<smoothline>"],[k,l,"<tilemap>"],[n,p,"<tilerandomization>"]];a=await Promise.all(a.map(r=>this.CreateShaderProgram({src:r[0],vertexSrc:r[1],name:r[2]})));this._spTextureFill=a[0];this._spDeviceTransformTextureFill=a[1];this._spPoints=a[2];this._spColorFill=a[3];this._spLinearGradientFill=a[4];this._spPenumbraFill=a[5];this._spHardEllipseFill=a[6];this._spHardEllipseOutline=
a[7];this._spSmoothEllipseFill=a[8];this._spSmoothEllipseOutline=a[9];this._spSmoothLineFill=a[10];this._spTilemapFill=a[11];this._spTileRandomization=a[12];this.SetTextureFillMode()}async CreateShaderProgram(a){a=await C3$jscomp$57.Gfx.WebGLShaderProgram.Create(this,a);this._AddShaderProgram(a);return a}ResetLastProgram(){this._lastProgram=null}SetSize(a,b,d){if(this._width!==a||this._height!==b||d){this.EndBatch();d=this._gl;var c=this._batchState;this._width=a;this._height=b;this._SetViewport(0,
0,a,b);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,a/b);this.SetProjectionMatrix(this._bbProjectionMatrix);this._spDeviceTransformTextureFill&&(d.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram()),this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP),this._lastProgram=this._spDeviceTransformTextureFill,this._batchState.currentShader=this._spDeviceTransformTextureFill);d.bindTexture(d.TEXTURE_2D,null);d.activeTexture(d.TEXTURE1);d.bindTexture(d.TEXTURE_2D,
null);d.activeTexture(d.TEXTURE0);this._lastTexture1=this._lastTexture0=null;this._usesDepthBuffer&&this._isAutoSizeDepthBuffer&&this._SetDepthBufferSize(this._width,this._height);this._currentRenderTarget&&this._currentRenderTarget._Resize(this._width,this._height);d.bindFramebuffer(d.FRAMEBUFFER,null);this._currentRenderTarget=null;c.currentFramebuffer=null;c.currentFramebufferNoDepth=null}}_SetDepthBufferSize(a,b){const d=this._gl;this._depthBuffer&&this._depthBufferWidth===a&&this._depthBufferHeight===
b||(this._canSampleDepth?(this._depthBuffer&&d.deleteTexture(this._depthBuffer),this._depthBuffer=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this._depthBuffer),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),2<=this.GetWebGLVersionNumber()?d.texImage2D(d.TEXTURE_2D,0,d.DEPTH24_STENCIL8,a,b,0,d.DEPTH_STENCIL,
d.UNSIGNED_INT_24_8,null):this._depthTextureExt&&d.texImage2D(d.TEXTURE_2D,0,d.DEPTH_STENCIL,a,b,0,d.DEPTH_STENCIL,this._depthTextureExt.UNSIGNED_INT_24_8_WEBGL,null),d.bindTexture(d.TEXTURE_2D,null)):(this._depthBuffer&&d.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,this._depthBuffer),d.renderbufferStorage(d.RENDERBUFFER,2<=this._version?d.DEPTH24_STENCIL8:d.DEPTH_STENCIL,a,b),d.bindRenderbuffer(d.RENDERBUFFER,null)),this._depthBufferWidth=
a,this._depthBufferHeight=b)}SetFixedSizeDepthBuffer(a,b){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!1,this._SetDepthBufferSize(a,b))}SetAutoSizeDepthBuffer(){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!0,this._SetDepthBufferSize(this._width,this._height))}_SetViewport(a,b,d,c){const e=this._viewport;if(e[0]!==a||e[1]!==b||e[2]!==d||e[3]!==c)this.PushBatch().InitSetViewport(a,b,d,c),vec4$jscomp$4.set(e,a,b,d,c),this._topOfBatch=0}SetFovY(a){super.SetFovY(a);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,
this._width/this._height)}SetNearZ(a){super.SetNearZ(a);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetFarZ(a){super.SetFarZ(a);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetProjectionMatrix(a){mat4$jscomp$7.exactEquals(this._matP,a)||(this.PushBatch().InitSetProjection(a),mat4$jscomp$7.copy(this._matP,a),this._topOfBatch=0,this._didChangeTransform=!0)}SetDefaultRenderTargetProjectionState(){let a,b;var d=this._currentRenderTarget;
null===d?(a=this._bbProjectionMatrix,b=this.GetWidth(),d=this.GetHeight()):(a=d.GetProjectionMatrix(),b=d.GetWidth(),d=d.GetHeight());this.SetProjectionMatrix(a);this._SetViewport(0,0,b,d)}SetModelViewMatrix(a){mat4$jscomp$7.exactEquals(this._matMV,a)||(this.PushBatch().InitSetModelView(a),mat4$jscomp$7.copy(this._matMV,a),this._topOfBatch=0,this._didChangeTransform=!0)}ResetDidChangeTransformFlag(){this._didChangeTransform=!1}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){const a=
this._batch;this._batchPtr===a.length&&a.push(new C3$jscomp$57.Gfx.WebGLBatchJob(this._batchState));return a[this._batchPtr++]}EndBatch(){0===this._batchPtr||this.IsContextLost()||(this._WriteBuffers(),this._ExecuteBatch(),this._topOfBatch=this._pointPtr=this._texPtr=this._vertexPtr=this._batchPtr=0)}_WriteBuffers(){const a=this._gl;0<this._pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this._pointBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr)));0<this._vertexPtr&&(a.bindBuffer(a.ARRAY_BUFFER,
this._vertexBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr)),a.bindBuffer(a.ARRAY_BUFFER,this._texcoordBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr)))}_ExecuteBatch(){const a=this._batch;for(let b=0,d=this._batchPtr;b<d;++b)a[b].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(a,b,d,c){const e=this._lastColor;e.equalsRgba(a,b,d,c)||(e.setRgba(a,b,d,c),this.PushBatch().InitSetColor(e),this._topOfBatch=0,this._currentStateGroup=
null)}SetOpacity(a){const b=this._lastColor;b.getA()!==a&&(b.setA(a),this.PushBatch().InitSetColor(b),this._topOfBatch=0,this._currentStateGroup=null)}SetColor(a){const b=this._lastColor;b.equals(a)||(b.set(a),this.PushBatch().InitSetColor(b),this._topOfBatch=0,this._currentStateGroup=null)}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(a){a!==this._lastTexture0&&(this.PushBatch().InitSetTexture(a),this._lastTexture0=a,this._topOfBatch=0)}_ResetLastTexture(){this._lastTexture0=
null}SetBlendMode(a){a=this._GetBlendByIndex(a);this._SetBlend(a[0],a[1])}SetNamedBlendMode(a){a=this.GetNamedBlend(a);this._SetBlend(a.srcBlend,a.destBlend)}_SetBlend(a,b){if(a!==this._lastSrcBlend||b!==this._lastDestBlend)this.PushBatch().InitSetBlend(a,b),this._lastSrcBlend=a,this._lastDestBlend=b,this._topOfBatch=0,this._currentStateGroup=null}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,
this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(a){this.Rect2(a.getLeft(),a.getTop(),a.getRight(),a.getBottom())}Rect2(a,b,d,c){this.Quad2(a,b,d,b,d,c,a,c)}_ExtendQuadBatch(){let a=this._vertexPtr;a>=this._lastVertexPtr&&(this.EndBatch(),a=0);1===this._topOfBatch?this._batch[this._batchPtr-1]._indexCount+=6:(this.PushBatch().InitQuad(a,6),this._topOfBatch=1)}_WriteQuadToVertexBuffer(a){a.writeToTypedArray3D(this._vertexData,
this._vertexPtr,this._baseZ+this._currentZ);this._vertexPtr+=12}Quad(a){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(a);defaultTexCoordsQuad$jscomp$1.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad2(a,b,d,c,e,g,k,l){this._ExtendQuadBatch();const n=this._vertexData;let p=this._vertexPtr;const r=this._baseZ+this._currentZ;n[p++]=a;n[p++]=b;n[p++]=r;n[p++]=d;n[p++]=c;n[p++]=r;n[p++]=e;n[p++]=g;n[p++]=r;n[p++]=k;n[p++]=l;n[p++]=r;this._vertexPtr=p;defaultTexCoordsQuad$jscomp$1.writeToTypedArray(this._texcoordData,
this._texPtr);this._texPtr+=8}Quad3(a,b){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(a);b.writeAsQuadToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad4(a,b){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(a);b.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad3D(a,b,d,c,e,g,k,l,n,p,r,w,z){this._ExtendQuadBatch();const B=this._vertexData;let C=this._vertexPtr;const E=this._baseZ+this._currentZ;B[C++]=a;B[C++]=b;B[C++]=E+d;B[C++]=c;B[C++]=e;B[C++]=
E+g;B[C++]=k;B[C++]=l;B[C++]=E+n;B[C++]=p;B[C++]=r;B[C++]=E+w;this._vertexPtr=C;z.writeAsQuadToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad3D2(a,b,d,c,e,g,k,l,n,p,r,w,z){this._ExtendQuadBatch();const B=this._vertexData;let C=this._vertexPtr;const E=this._baseZ+this._currentZ;B[C++]=a;B[C++]=b;B[C++]=E+d;B[C++]=c;B[C++]=e;B[C++]=E+g;B[C++]=k;B[C++]=l;B[C++]=E+n;B[C++]=p;B[C++]=r;B[C++]=E+w;this._vertexPtr=C;z.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}DrawMesh(a,
b,d){const c=this._vertexData,e=this._texcoordData;if(0!==d.length%3)throw Error("invalid index buffer length");for(let n=0,p=d.length;n<p;){var g=d[n++],k=d[n++],l=d[n++];const r=3*g,w=3*k,z=3*l;g*=2;k*=2;l*=2;this._ExtendQuadBatch();let B=this._vertexPtr,C=this._texPtr;c[B++]=a[r+0];c[B++]=a[r+1];c[B++]=a[r+2];c[B++]=a[w+0];c[B++]=a[w+1];c[B++]=a[w+2];c[B++]=a[z+0];c[B++]=a[z+1];c[B++]=a[z+2];c[B++]=a[z+0];c[B++]=a[z+1];c[B++]=a[z+2];e[C++]=b[g+0];e[C++]=b[g+1];e[C++]=b[k+0];e[C++]=b[k+1];e[C++]=
b[l+0];e[C++]=b[l+1];e[C++]=b[l+0];e[C++]=b[l+1];this._vertexPtr=B;this._texPtr=C}}FullscreenQuad(a,b){this.SetCurrentZ(0);mat4$jscomp$7.copy(tmpProjection,this._matP);mat4$jscomp$7.copy(tmpModelView,this._matMV);this.SetDefaultRenderTargetProjectionState();const [d,c]=this.GetRenderTargetSize(this._currentRenderTarget);var e=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(c),0,0,0,c);this.SetModelViewMatrix(e);if("crop"===a&&this._currentRenderTarget&&b){a=this._width/2;e=this._height/
2;const l=b.GetWidth();b=b.GetHeight();var g=this._currentRenderTarget.GetWidth(),k=this._currentRenderTarget.GetHeight();g=Math.min(g,l);const n=Math.min(k,b),p=Math.max(b-k,0);k=Math.max(k-b,0);tmpRect$jscomp$1.set(-a,e-k,-a+g,e-n-k);tmpQuad$jscomp$1.setFromRect(tmpRect$jscomp$1);tmpRect$jscomp$1.set(0,p,g,n+p);tmpRect$jscomp$1.divide(l,b);this.Quad3(tmpQuad$jscomp$1,tmpRect$jscomp$1)}else a=d/2,e=c/2,this.Rect2(-a,e,a,-e);this.SetProjectionMatrix(tmpProjection);this.SetModelViewMatrix(tmpModelView)}StartRenderingPoints(a){this._lastPointTexCoords.equals(a)||
(this._lastPointTexCoords.copy(a),this.PushBatch().InitSetPointTexCoords(a),this._topOfBatch=0)}FinishRenderingPoints(){}Point(a,b,d,c){this._pointPtr>=LAST_POINT&&this.EndBatch();let e=this._pointPtr;var g=this._baseZ+this._currentZ;2===this._topOfBatch&&this._lastPointZ===g?this._batch[this._batchPtr-1]._indexCount++:(this.PushBatch().InitPoints(e,g),this._topOfBatch=2,this._lastPointZ=g);g=this._pointData;g[e++]=a;g[e++]=b;g[e++]=d;g[e++]=c;this._pointPtr=e}SetProgram(a){this._lastProgram!==a&&
(this.PushBatch().InitSetProgram(a),this._lastProgram=a,this._topOfBatch=0,this._currentStateGroup=null)}GetProgram(){return this._lastProgram}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(a){this.PushBatch().InitSetGradientColor(a);this._topOfBatch=0}SetEllipseParams(a,b,d=1){this.PushBatch().InitSetEllipseParams(a,b,d);this._topOfBatch=0}SetTilemapInfo(a,b,d,c,e,g,k){if(this._lastProgram!==this._spTilemapFill)throw Error("must set tilemap fill mode first");
this.PushBatch().InitSetTilemapInfo(a,b,d,c,e,g,k);this._topOfBatch=0}SetTileRandomizationInfo(a,b,d,c,e,g,k){if(this._lastProgram!==this._spTileRandomization)throw Error("must set tile randomization mode first");this.PushBatch().InitSetTileRandomizationInfo(a,b,d,c,e,g,k);this._topOfBatch=0}SetProgramParameters(a,b,d,c,e,g,k,l,n,p,r){const w=this._lastProgram;r%=10800;if(w._hasAnyOptionalUniforms&&!w.AreOptionalUniformsAlreadySetInBatch(b,d,c,e,g,k,l,n,p,r)){var z=this.PushBatch();z.InitSetProgramParameters();
w.SetOptionalUniformsInBatch(b,d,c,e,g,k,l,n,p,r);var B=z._mat4param;B[0]=g;B[1]=k;b.writeToTypedArray(B,2);B[6]=n;B[7]=p;d.writeToTypedArray(B,12);b=z._colorParam;e.writeToTypedArray(b,0);e=b[1];b[1]=b[3];b[3]=e;c.writeToTypedArray(z._srcOriginRect,0);z._startIndex=r;z._indexCount=l;w._uSamplerBack.IsUsed()?z._texParam=a?a.GetTexture():null:z._texParam=null;this._topOfBatch=0}}SetProgramCustomParameters(a){const b=this._lastProgram;if(0!==a.length&&!b.AreCustomParametersAlreadySetInBatch(a)){var d=
this.PushBatch();d.InitSetProgramCustomParameters();b.SetCustomParametersInBatch(a);C3$jscomp$57.shallowAssignArray(d._shaderParams,a);this._topOfBatch=0}}ClearRgba(a,b,d,c){this.PushBatch().InitClearSurface2(a,b,d,c);this._topOfBatch=0}Clear(a){this.PushBatch().InitClearSurface(a);this._topOfBatch=0}Start(){}Finish(){super.Finish();this._gl.flush()}ClearDepth(){this._usesDepthBuffer&&this._currentRenderTarget&&this._currentRenderTarget.HasDepthBuffer()&&(this.PushBatch().InitClearDepth(this._isDepthEnabled),
this._topOfBatch=0)}SetDepthEnabled(a){a=!!a;this._isDepthEnabled!==a&&this._usesDepthBuffer&&(this._isDepthEnabled=a,this.PushBatch().InitSetDepthEnabled(a),this._topOfBatch=0)}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(a){a=!!a;if(this._canSampleDepth&&this._isDepthSamplingEnabled!==a){if(a&&this.IsDepthEnabled())throw Error("depth still enabled");this._isDepthSamplingEnabled=a;this.PushBatch().InitSetDepthSamplingEnabled(a);
this._topOfBatch=0}}SetScissorRect(a,b,d,c,e=0){a=Math.floor(a);b=Math.floor(b);d=Math.floor(d);c=Math.floor(c);this._lastScissorRect.equalsWH(a,b,d,c)||(this._lastScissorRect.setWH(a,b,d,c),b=(e||this.GetRenderTargetSize(this.GetRenderTarget())[1])-b-c,this.PushBatch().InitSetScissor(!0,a,b,d,c),this._topOfBatch=0)}RemoveScissorRect(){-1!==this._lastScissorRect.getRight()&&(this._lastScissorRect.set(0,0,-1,-1),this.PushBatch().InitSetScissor(!1,0,0,0,0),this._topOfBatch=0)}CheckForQueryResults(){for(const a of this._allQueryResultBuffers)a.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||
this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost();C3$jscomp$57.Gfx.WebGLRendererTexture.OnContextLost();C3$jscomp$57.Gfx.WebGLRenderTarget.OnContextLost();C3$jscomp$57.Gfx.RendererText.OnContextLost();for(const a of this._allQueryResultBuffers)a.Clear();this._extensions=[];this._textureLodExt=this._stdDerivativesExt=this._fragDepthExt=this._depthTextureExt=this._anisotropicExt=this._parallelShaderCompileExt=this._timerExt=null;this._maxAnisotropy=
0;this._unmaskedRenderer=this._unmaskedVendor="(unavailable)";this._depthBuffer=this._spDeviceTransformTextureFill=this._lastProgram=null;for(const a of this._stateGroups.values())a.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=!0;await this.InitState();this._isInitialisingAfterContextRestored=!1;for(const a of this._stateGroups.values())a.OnContextRestored(this);this.SetSize(this._width,this._height,!0)}CreateStaticTexture(a,b){if(this.IsContextLost())throw Error("context lost");
this.EndBatch();const d=C3$jscomp$57.New(C3$jscomp$57.Gfx.WebGLRendererTexture,this);d._CreateStatic(a,b);return d}async CreateStaticTextureAsync(a,b){if(this.IsContextLost())throw Error("context lost");b=Object.assign({},b);if(C3$jscomp$57.Supports.ImageBitmapOptions){let d=await createImageBitmap(a,{premultiplyAlpha:"premultiply"});const c=b.wrapX&&"clamp-to-edge"!==b.wrapX||b.wrapY&&"clamp-to-edge"!==b.wrapY,e=C3$jscomp$57.isPOT(d.width)&&C3$jscomp$57.isPOT(d.height);this.SupportsNPOTTextures()||
e||!c?b.premultiplyAlpha=!1:C3$jscomp$57.Supports.ImageBitmapOptionsResize?(d=await createImageBitmap(a,{premultiplyAlpha:"premultiply",resizeWidth:C3$jscomp$57.nextHighestPowerOfTwo(d.width),resizeHeight:C3$jscomp$57.nextHighestPowerOfTwo(d.height)}),b.premultiplyAlpha=!1):d=await createImageBitmap(a,{premultiplyAlpha:"none"});return await C3$jscomp$57.Asyncify(()=>this.CreateStaticTexture(d,b))}if(a instanceof Blob){if("undefined"===typeof Image)throw Error("texture upload variant not supported in worker");
a=await C3$jscomp$57.BlobToImage(a)}return await C3$jscomp$57.Asyncify(()=>this.CreateStaticTexture(a,b))}CreateDynamicTexture(a,b,d){this.EndBatch();const c=C3$jscomp$57.New(C3$jscomp$57.Gfx.WebGLRendererTexture,this);c._CreateDynamic(a,b,d);return c}UpdateTexture(a,b,d){this.EndBatch();b._Update(a,d)}DeleteTexture(a){a&&(a.SubtractReference(),0<a.GetReferenceCount()||(this.EndBatch(),a===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),a===this._lastTexture1&&
(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),a._Delete()))}CreateRenderTarget(a){let b=this._width,d=this._height,c=!0;a&&("number"===typeof a.width&&(b=Math.floor(a.width),c=!1),"number"===typeof a.height&&(d=Math.floor(a.height),c=!1));if(0>=b||0>=d)throw Error("invalid size");this.EndBatch();const e=C3$jscomp$57.New(C3$jscomp$57.Gfx.WebGLRenderTarget,this);e._Create(b,d,Object.assign({isDefaultSize:c},
a));this._currentRenderTarget=null;this._batchState.currentFramebuffer=null;this._batchState.currentFramebufferNoDepth=null;return e}SetRenderTarget(a,b=!0){a!==this._currentRenderTarget&&(a&&a.IsDefaultSize()&&a._Resize(this._width,this._height),this.PushBatch().InitSetRenderTarget(a),this._currentRenderTarget=a,this._topOfBatch=0,b&&this.SetDefaultRenderTargetProjectionState())}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(a){return a?[a.GetWidth(),a.GetHeight()]:[this._width,
this._height]}CopyRenderTarget(a,b="stretch"){2>this._version||this._currentRenderTarget&&0<this._currentRenderTarget.GetMultisampling()?(this.SetCopyBlend(),this.ResetColor(),this.DrawRenderTarget(a,b)):(this.PushBatch().InitBlitFramebuffer(a,this._currentRenderTarget,b),this._topOfBatch=0)}DrawRenderTarget(a,b="stretch"){a=a.GetTexture();if(!a)throw Error("not a texture-backed render target");this.SetTexture(a);this.FullscreenQuad(b,a)}InvalidateRenderTarget(a){2>this._version||(this.PushBatch().InitInvalidateFramebuffer(a._GetFramebuffer()),
this._topOfBatch=0)}DeleteRenderTarget(a){this.SetRenderTarget(null);this.EndBatch();const b=a.GetTexture();b===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null);b===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null);a._Delete()}async ReadBackRenderTargetToImageData(a,b,d){this.EndBatch();const c=this._currentRenderTarget;if(a){var e=
a.GetWidth();var g=a.GetHeight();var k=a._GetFramebuffer()}else e=this.GetWidth(),g=this.GetHeight(),k=null;let l=a=0;var n=e,p=g;d&&(a=C3$jscomp$57.clamp(Math.floor(d.getLeft()),0,e-1),l=C3$jscomp$57.clamp(Math.floor(d.getTop()),0,g-1),n=d.width(),n=0===n?e-a:C3$jscomp$57.clamp(Math.floor(n),0,e-a),p=d.height(),p=0===p?g-l:C3$jscomp$57.clamp(Math.floor(p),0,g-l),l=g-(l+p));const r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,k);g=()=>{r.bindFramebuffer(r.FRAMEBUFFER,null);this._currentRenderTarget=null;
this._batchState.currentFramebuffer=null;this._batchState.currentFramebufferNoDepth=null;this.SetRenderTarget(c)};if(!b&&2<=this.GetWebGLVersionNumber()){r.bindFramebuffer(r.READ_FRAMEBUFFER,k);k=r.createBuffer();d=n*p*4;e=r.PIXEL_PACK_BUFFER;r.bindBuffer(e,k);r.bufferData(e,d,r.STREAM_READ);r.readPixels(a,l,n,p,r.RGBA,r.UNSIGNED_BYTE,0);r.bindFramebuffer(r.READ_FRAMEBUFFER,null);r.bindBuffer(e,null);g();const w=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);await this._WaitForObjectReady(()=>r.getSyncParameter(w,
r.SYNC_STATUS)===r.SIGNALED);r.deleteSync(w);b=new ImageData(n,p);r.bindBuffer(e,k);r.getBufferSubData(e,0,new Uint8Array(b.data.buffer),0,d);r.bindBuffer(e,null);r.deleteBuffer(k)}else b=new ImageData(n,p),r.readPixels(a,l,n,p,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(b.data.buffer)),g();return b}CoplanarStartStencilPass(){this.SetDepthEnabled(!0);this.PushBatch().InitCoplanarStartStencilPass();this._topOfBatch=0;this._coplanarMode=1}CoplanarStartColorPass(){this.SetDepthEnabled(!1);this.PushBatch().InitCoplanarStartColorPass();
this._topOfBatch=0;this._coplanarMode=2}IsCoplanarColorPass(){return 2===this._coplanarMode}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(!0);this.PushBatch().InitCoplanarRestore();this._coplanarMode=this._topOfBatch=0}StartQuery(a){this.SupportsGPUProfiling()&&(this.PushBatch().InitStartQuery(a),this._topOfBatch=0)}EndQuery(a){this.SupportsGPUProfiling()&&(this.PushBatch().InitEndQuery(a),this._topOfBatch=0)}_WaitForObjectReady(a){const b=new Promise(d=>pendingPolls.add({resolve:d,checkFunc:a}));
-1===pollRafId&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls));return b}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs.alpha?4:3)}GetEstimatedRenderBufferMemoryUsage(){let a=0;for(const b of C3$jscomp$57.Gfx.WebGLRenderTarget.allRenderTargets())b.GetTexture()||(a+=b.GetEstimatedMemoryUsage());return a}GetEstimatedTextureMemoryUsage(){let a=0;for(const b of C3$jscomp$57.Gfx.WebGLRendererTexture.allTextures())a+=b.GetEstimatedMemoryUsage();return a}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+
this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return 2<=this.GetWebGLVersionNumber()}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){return 0!==this._highpPrecision}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetWebGLExtensionsAnalyticsString(){if(2<=this.GetWebGLVersionNumber())return"webgl2";
const a=[];this._fragDepthExt&&a.push("EXT_frag_depth");this._stdDerivativesExt&&a.push("OES_standard_derivatives");this._textureLodExt&&a.push("EXT_shader_texture_lod");return 0<a.length?"webgl1:"+a.join(","):"webgl1:none"}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(a){this._allQueryResultBuffers.add(a)}_RemoveQueryResultBuffer(a){this._allQueryResultBuffers.delete(a)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(a){this._InitBlendModeData([["normal",
a.ONE,a.ONE_MINUS_SRC_ALPHA],["additive",a.ONE,a.ONE],["xor",a.ONE,a.ONE_MINUS_SRC_ALPHA],["copy",a.ONE,a.ZERO],["destination-over",a.ONE_MINUS_DST_ALPHA,a.ONE],["source-in",a.DST_ALPHA,a.ZERO],["destination-in",a.ZERO,a.SRC_ALPHA],["source-out",a.ONE_MINUS_DST_ALPHA,a.ZERO],["destination-out",a.ZERO,a.ONE_MINUS_SRC_ALPHA],["source-atop",a.DST_ALPHA,a.ONE_MINUS_SRC_ALPHA],["destination-atop",a.ONE_MINUS_DST_ALPHA,a.SRC_ALPHA]])}CreateWebGLText(){return this.CreateRendererText()}};"use strict";
const DEFAULT_CTOR_OPTS={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};
self.C3.Gfx.EffectChainManager=class{constructor(a){a=Object.assign({},DEFAULT_CTOR_OPTS,a);this._cbGetDrawSize=a.getDrawSize;this._cbGetRenderTarget=a.getRenderTarget;this._cbReleaseRenderTarget=a.releaseRenderTarget;this._cbGetTime=a.getTime;this._cbRedraw=a.redraw;this._webgpuBackTexture=null;this._allEffectChains=new Set}_AddEffectChain(a){this._allEffectChains.add(a)}_RemoveEffectChain(a){this._allEffectChains.delete(a)}OnContextLost(){this._webgpuBackTexture=null;for(const a of this._allEffectChains)a.OnContextLost()}GetDrawSize(a){return this._cbGetDrawSize?
this._cbGetDrawSize(a):[a.GetWidth(),a.GetHeight()]}GetRenderTarget(a){return this._cbGetRenderTarget(a)}ReleaseRenderTarget(a,b){this._cbReleaseRenderTarget(a,b)}GetTime(){return this._cbGetTime()}Redraw(a){this._cbRedraw(a)}_GetWebGPUBackTexture(a,b,d){b=Math.floor(b);d=Math.floor(d);!this._webgpuBackTexture||this._webgpuBackTexture.GetWidth()===b&&this._webgpuBackTexture.GetHeight()===d||(a.DeleteTexture(this._webgpuBackTexture),this._webgpuBackTexture=null);null===this._webgpuBackTexture&&(this._webgpuBackTexture=
a.CreateStaticTexture(null,{width:b,height:d,sampling:"nearest",mipMap:!1}));return this._webgpuBackTexture}};"use strict";
const C3$jscomp$59=self.C3,mat4$jscomp$8=self.glMatrix.mat4,tempRect=C3$jscomp$59.New(C3$jscomp$59.Rect),tempRect2=C3$jscomp$59.New(C3$jscomp$59.Rect),tempRect3=C3$jscomp$59.New(C3$jscomp$59.Rect),tempRect4=C3$jscomp$59.New(C3$jscomp$59.Rect),tempMat4a=mat4$jscomp$8.create(),tempMat4b$jscomp$1=mat4$jscomp$8.create(),DEFAULT_CTOR_OPTS$jscomp$1={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:!1},DEFAULT_BUILDSTEPS_OPTS={indexMap:null,forcePreDraw:!1,forcePostDraw:!1,
is3D:!1,isSourceTextureRotated:!1,isRotatedOrNegativeSizeInstance:!1,useFullSurface:!1};
C3$jscomp$59.Gfx.EffectChain=class{constructor(a,b){b=Object.assign({},DEFAULT_CTOR_OPTS$jscomp$1,b);this._manager=a;this._cbDrawContent=b.drawContent;this._cbGetSourceTextureInfo=b.getSourceTextureInfo;this._cbGetShaderParameters=b.getShaderParameters;this._cbDrawContentHook=null;this._shaderProgramList=[];this._shaderProgramIndices=[];this._steps=[];this._needsRebuild=!1;this._blendMode=0;this._isSourceTextureRotated=this._useFullSurface=this._canUseFastPath=this._coplanarColorPassAtStart=this._depthEnabledAtStart=
this._didChangeTransform=this._useCopyTextureBackgroundSampling=this._isAnyIsSrcTexRotated=this._isAnyShaderCrossSampling=this._isAnyShaderBackgroundBlending=this._isAnyShaderDepthSampling=this._isAnyShaderAnimated=!1;this._numTempSurfacesRequired=0;this._renderTargets=[null,null,null];this._invalidateRenderTargets=!!b.invalidateRenderTargets;this._drawHeight=this._drawWidth=this._boxExtendVertical=this._boxExtendHorizontal=0;this._contextObject=this._contentObject=null;this._layoutRect=C3$jscomp$59.New(C3$jscomp$59.Rect);
this._drawSurfaceRect=C3$jscomp$59.New(C3$jscomp$59.Rect);this._rcTexOriginal=C3$jscomp$59.New(C3$jscomp$59.Rect);this._rcTexBounce=C3$jscomp$59.New(C3$jscomp$59.Rect);this._rcTexDest=C3$jscomp$59.New(C3$jscomp$59.Rect);this._layerScale=this._devicePixelRatio=1;this._time=this._layerAngle=0;this._backTex=this._destRenderTarget=null;this._compositOffY=this._compositOffX=0;this._updateOwnProjection=!1;this._projectionMatrix=mat4$jscomp$8.create();this._modelViewMatrix=mat4$jscomp$8.create();this._manager._AddEffectChain(this)}Release(){this._manager._RemoveEffectChain(this);
C3$jscomp$59.clearArray(this._steps);C3$jscomp$59.clearArray(this._shaderProgramList);C3$jscomp$59.clearArray(this._shaderProgramIndices);this._cbGetShaderParameters=this._cbGetSourceTextureInfo=this._cbDrawContent=this._contextObject=this._contentObject=null}OnContextLost(){this._needsRebuild=!0;C3$jscomp$59.clearArray(this._steps);C3$jscomp$59.clearArray(this._shaderProgramList);C3$jscomp$59.clearArray(this._shaderProgramIndices)}NeedsRebuild(){return this._needsRebuild}BuildSteps(a,b){b=Object.assign({},
DEFAULT_BUILDSTEPS_OPTS,b);C3$jscomp$59.clearArray(this._steps);this._boxExtendVertical=this._boxExtendHorizontal=0;this._useCopyTextureBackgroundSampling=this._isAnyIsSrcTexRotated=this._isAnyShaderCrossSampling=this._isAnyShaderBackgroundBlending=this._isAnyShaderDepthSampling=this._isAnyShaderAnimated=!1;this._numTempSurfacesRequired=0;this._isSourceTextureRotated=!!b.isSourceTextureRotated;this._useFullSurface=!!b.useFullSurface;this._needsRebuild=!1;C3$jscomp$59.shallowAssignArray(this._shaderProgramList,
a);if(0!==a.length){if(b.indexMap){if(b.indexMap.length!==a.length)throw Error("incorrect indexMap length");C3$jscomp$59.shallowAssignArray(this._shaderProgramIndices,b.indexMap)}else{C3$jscomp$59.clearArray(this._shaderProgramIndices);for(let e=0,g=a.length;e<g;++e)this._shaderProgramIndices.push(e)}for(var d of a)this._boxExtendHorizontal+=d.GetBoxExtendHorizontal(),this._boxExtendVertical+=d.GetBoxExtendVertical(),d.IsAnimated()&&(this._isAnyShaderAnimated=!0),d.UsesDepth()&&(this._isAnyShaderDepthSampling=
!0),d.BlendsBackground()&&(this._isAnyShaderBackgroundBlending=!0),d.UsesCrossSampling()&&(this._isAnyShaderCrossSampling=!0),d.UsesIsSrcTexRotated()&&(this._isAnyIsSrcTexRotated=!0);this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(a[0].GetRenderer());d=this._ShouldPreDraw(a[0],b);b=this._ShouldPostDraw(a.at(-1),b);if(1!==a.length||d||b){this._canUseFastPath=!1;var c=0;d&&(this._numTempSurfacesRequired=1,this._steps.push(C3$jscomp$59.New(C3$jscomp$59.Gfx.EffectChain.Step.PreDraw,
this,-1,1)),c=1);for(let e=0,g=a.length;e<g;++e)0!==e||d?(a=1===c?2:1,e!==g-1||b||(a=0),this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,a),this._steps.push(C3$jscomp$59.New(C3$jscomp$59.Gfx.EffectChain.Step.Bounce,this,c,a,e)),c=a):(this._numTempSurfacesRequired=1,this._steps.push(C3$jscomp$59.New(C3$jscomp$59.Gfx.EffectChain.Step.FirstBounce,this,-1,1,e)),c=1);b&&this._steps.push(C3$jscomp$59.New(C3$jscomp$59.Gfx.EffectChain.Step.PostDraw,this,c,0))}else this._canUseFastPath=
!0}}_ShouldPreDraw(a,b){return b.forcePreDraw||a.MustPreDraw()||b.is3D&&!a.Supports3DDirectRendering()||a.UsesDepth()&&!this._useFullSurface||0!==this._boxExtendHorizontal||0!==this._boxExtendVertical?!0:a.GetRenderer().IsWebGL()?a.BlendsBackground()&&(b.isRotatedOrNegativeSizeInstance||b.isSourceTextureRotated)||a.UsesAnySrcRectOrPixelSize()&&b.isSourceTextureRotated:a.BlendsBackground()&&!this._useCopyTextureBackgroundSampling&&b.isRotatedOrNegativeSizeInstance}_ShouldPostDraw(a,b){return b.forcePostDraw?
!0:a.GetRenderer().IsWebGL()?a.BlendsBackground()||a.UsesCrossSampling():(a.BlendsBackground()||a.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling()}_ShouldUseCopyTextureBackgroundSampling(a){return a.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling}Render(a,b,d){a.IsWebGPU()&&null===b&&(b=a.GetBackbufferRenderTarget());this._destRenderTarget=b;this._contentObject=d.contentObject||null;this._contextObject=d.contextObject||null;this._blendMode=d.blendMode||
0;this._devicePixelRatio=d.devicePixelRatio||1;this._layerScale=d.layerScale||1;this._layerAngle=d.layerAngle||0;this._time="number"===typeof d.time?d.time:this._manager.GetTime();this._didChangeTransform=!1;a.ResetDidChangeTransformFlag();this._isAnyShaderAnimated&&this._Redraw();let c=!1;this._UseCopyTextureBackgroundSampling()&&(this._CalculateDrawSizeAndRectangles(a,d),c=!0,this._backTex=this._manager._GetWebGPUBackTexture(a,this._drawWidth,this._drawHeight),tempRect.copy(this._drawSurfaceRect),
tempRect.roundOuter(),a.IsWebGPU()&&a._MaybeDoPendingClearRenderPass(this._destRenderTarget),a.CopyTextureToTexture(this._destRenderTarget.GetTexture(),this._backTex,tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height()));if(this._canUseFastPath)this._Render_FastPath(a,d);else if(c||this._CalculateDrawSizeAndRectangles(a,d),0!==this._rcTexOriginal.width()||0!==this._rcTexOriginal.height()){a.SetAlphaBlend();a.ResetColor();a.SetBaseZ(0);a.SetCurrentZ(0);this._cbDrawContentHook=d.drawContentHook||
null;this._compositOffX=d.compositOffX||0;this._compositOffY=d.compositOffY||0;this._updateOwnProjection=!!d.updateOwnProjection;this._OnBeforeStartEffectChain(a);this._renderTargets[0]=b;this._renderTargets[1]=1<=this._numTempSurfacesRequired?this._GetRenderTarget():null;this._renderTargets[2]=2===this._numTempSurfacesRequired?this._GetRenderTarget():null;for(const e of this._steps)b=this._GetRenderTargetForId(e.GetSrcTargetId()),d=this._GetRenderTargetForId(e.GetDestTargetId()),a.IsWebGPU()?e.Run_WebGPU(a,
b,d):e.Run_WebGL(a,b,d);a.SetTexture(null);this._renderTargets[1]&&this._ReleaseRenderTarget(this._renderTargets[1]);this._renderTargets[2]&&this._ReleaseRenderTarget(this._renderTargets[2]);this._renderTargets.fill(null);this._OnAfterEndEffectChain(a);this._cbDrawContentHook=this._contextObject=this._contentObject=this._backTex=this._destRenderTarget=null}}_CalculateDrawSizeAndRectangles(a,b){const [d,c]=this._manager.GetDrawSize(a);this._SetDrawSize(a,d,c);this._CalculateRectangles(b)}_SetDrawSize(a,
b,d){if(0>=b||0>=d)throw Error("invalid draw size");this._drawWidth===b&&this._drawHeight===d||this._CalculateDeviceTransformMatrices(a,b,d,0,0,this._projectionMatrix,this._modelViewMatrix);this._drawWidth=b;this._drawHeight=d}_CalculateDeviceTransformMatrices(a,b,d,c,e,g,k){c=b/2+c;e=d/2+e;a.CalculatePerspectiveMatrix(g,b/d);a=a.CalculateLookAtModelView2(c,e,a.GetDefaultCameraZ(d),c,e,0,d);mat4$jscomp$8.copy(k,a)}_CalculateRectangles(a){this._layoutRect.copy(a.layoutRect);a.drawSurfaceRect?this._drawSurfaceRect.copy(a.drawSurfaceRect):
this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight);this._rcTexOriginal.copy(this._drawSurfaceRect);this._rcTexOriginal.divide(this._drawWidth,this._drawHeight);a=this._layerScale*this._devicePixelRatio;this._drawSurfaceRect.inflate(this._boxExtendHorizontal*a,this._boxExtendVertical*a);this._rcTexDest.copy(this._drawSurfaceRect);this._rcTexDest.divide(this._drawWidth,this._drawHeight);this._drawSurfaceRect.clampBoth(0,0,this._drawWidth,this._drawHeight);this._rcTexBounce.copy(this._drawSurfaceRect);
this._rcTexBounce.divide(this._drawWidth,this._drawHeight)}_OnBeforeStartEffectChain(a){this._depthEnabledAtStart=a.IsDepthEnabled();this._coplanarColorPassAtStart=a.IsCoplanarColorPass();if(this._useFullSurface)a.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&a.SetDepthSamplingEnabled(!0);else{tempRect.copy(this._drawSurfaceRect);if(a.IsWebGL()){const b=this._layerScale*this._devicePixelRatio;tempRect.inflate(Math.max(this._boxExtendHorizontal,1)*b,Math.max(this._boxExtendVertical,1)*b);tempRect.roundOuter();
tempRect.clamp(0,0,this._drawWidth,this._drawHeight)}else tempRect.roundOuter();a.SetScissorRect(tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height(),this._drawHeight)}}_OnAfterEffectChainDrawContent(a){a.ResetColor();this._useFullSurface||(this._coplanarColorPassAtStart&&a.CoplanarRestoreStandardRendering(),a.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&a.SetDepthSamplingEnabled(!0));a.IsWebGPU()&&a.SetNormalizedCoordsProgramVariant(!0)}_OnAfterEndEffectChain(a){a.SetDepthSamplingEnabled(!1);
this._coplanarColorPassAtStart&&a.CoplanarStartColorPass();a.SetDepthEnabled(this._depthEnabledAtStart);this._useFullSurface||a.RemoveScissorRect();a.IsWebGPU()&&a.SetNormalizedCoordsProgramVariant(!1);this._didChangeTransform=a.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(a){return 0>a?null:this._renderTargets[a]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(a){this._manager.ReleaseRenderTarget(a,
this)}_GetShaderProgramAt(a){return this._shaderProgramList[a]}_DrawContent(a){this._cbDrawContentHook?this._cbDrawContentHook(this,a,()=>this._cbDrawContent(a,this)):this._cbDrawContent(a,this);this._canUseFastPath||this._OnAfterEffectChainDrawContent(a)}_IsRenderTargetSameSizeAndOffset(a){if(this._useFullSurface)return!0;if(0!==this._compositOffX||0!==this._compositOffY)return!1;const [b,d]=a.GetRenderTargetSize(a.GetRenderTarget());return b!==this._drawWidth||d!==this._drawHeight?!1:!0}_SetDeviceTransform(a,
b){let d=this._projectionMatrix,c=this._modelViewMatrix;if(b&&!this._IsRenderTargetSameSizeAndOffset(a)){d=tempMat4a;c=tempMat4b$jscomp$1;const [e,g]=a.GetRenderTargetSize(a.GetRenderTarget());this._CalculateDeviceTransformMatrices(a,e,g,this._compositOffX,this._compositOffY,d,c);this._useFullSurface||a.RemoveScissorRect()}a.SetProjectionMatrix(d);a.SetModelViewMatrix(c)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(a,b){return this._cbGetShaderParameters(this._shaderProgramIndices[a],
b)}_SetProgramParameters(a,b){let d=this._rcTexDest,c=this._rcTexBounce,e=this._rcTexOriginal;a.IsWebGL()&&(tempRect2.copy(d),tempRect2.flipAround(1),d=tempRect2,tempRect3.copy(c),tempRect3.flipAround(1),c=tempRect3,tempRect4.copy(e),tempRect4.flipAround(1),e=tempRect4);this._DoSetProgramParameters(a,b,c,e,d,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(a,b){let d=this._rcTexBounce,c=this._rcTexOriginal,e=1/this._drawWidth,g=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let {srcTexRect:l,
srcWidth:n,srcHeight:p}=this._cbGetSourceTextureInfo(this._contentObject);l||(tempRect.set(0,0,0,0),l=tempRect);n||(n=this._drawWidth);p||(p=this._drawHeight);c=d=l;e=1/n;g=1/p}else a.IsWebGL()&&(tempRect3.copy(d),tempRect3.flipAround(1),d=tempRect3,tempRect4.copy(c),tempRect4.flipAround(1),c=tempRect4);let k=this._rcTexDest;a.IsWebGL()&&(k=tempRect2,k.copy(this._rcTexDest),k.flipAround(1));this._DoSetProgramParameters(a,b,d,c,k,e,g);a.IsWebGPU()&&this._isAnyIsSrcTexRotated&&a.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_GetBackTex(a){return this._isAnyShaderBackgroundBlending?
a.IsWebGPU()?this._UseCopyTextureBackgroundSampling()?this._backTex:this._destRenderTarget.GetTexture():this._destRenderTarget:null}_DoSetProgramParameters(a,b,d,c,e,g,k){a.SetProgramParameters(this._GetBackTex(a),e,d,c,this._layoutRect,g,k,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time);a.SetProgramCustomParameters(this._GetShaderParameters(b,a))}_Render_FastPath(a,b){var d=this._shaderProgramList[0];const c=a.IsDepthEnabled(),e=d.UsesDepth();e&&(a.SetDepthEnabled(!1),a.SetDepthSamplingEnabled(!0),
this._rcTexDest.set(0,0,1,1),this._rcTexOriginal.set(0,0,1,1));a.SetProgram(d);a.SetBlendMode(this._blendMode);a.SetRenderTarget(this._destRenderTarget);let g;this._rcTexOriginal.set(0,0,1,1);if(d.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){const {srcTexRect:k,srcWidth:l,srcHeight:n}=this._cbGetSourceTextureInfo(this._contentObject);k&&this._rcTexOriginal.copy(k);d=Number.isFinite(l)?1/l:0;g=Number.isFinite(n)?1/n:0}else{const [k,l]=this._manager.GetDrawSize(a);d=1/k;g=1/l}b.layoutRect?
this._layoutRect.copy(b.layoutRect):this._layoutRect.set(0,0,0,0);a.SetProgramParameters(this._GetBackTex(a),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,d,g,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time);a.SetProgramCustomParameters(this._GetShaderParameters(0,a));a.IsWebGPU()&&this._isAnyIsSrcTexRotated&&a.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated);a.SetBaseZ(0);this._DrawContent(a);e&&(a.SetDepthSamplingEnabled(!1),a.SetDepthEnabled(c))}_UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling}_UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling}IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending}CanSkipCalculatingDrawSurfaceRect(){return!this._canUseFastPath||
this._UseCopyTextureBackgroundSampling()?!1:!0}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(a,
b,d){}};"use strict";self.C3.Gfx.EffectChain.Step=class{constructor(a,b,d,c=-1){this._effectChain=a;this._srcTargetId=b;this._destTargetId=d;this._index=c}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(a,b,d){}Run_WebGPU(a,b,d){}};"use strict";const C3$jscomp$61=self.C3;
C3$jscomp$61.Gfx.EffectChain.Step.PreDraw=class extends C3$jscomp$61.Gfx.EffectChain.Step{constructor(a,b,d,c){super(a,b,d,c)}Run_WebGL(a,b,d){b=this.GetEffectChain();a.SetAlphaBlend();a.SetTextureFillMode();a.SetRenderTarget(d,b._UpdateOwnProjection());a.ClearRgba(0,0,0,0);b._DrawContent(a);b._ClampRcTexDest()}Run_WebGPU(a,b,d){b=this.GetEffectChain();a.SetAlphaBlend();a.SetTextureFillMode();a.SetRenderTarget(d,!1);a.ClearRgba(0,0,0,0);b._DrawContent(a);b._ClampRcTexDest()}};"use strict";
const C3$jscomp$62=self.C3,tempRect$jscomp$1=C3$jscomp$62.New(C3$jscomp$62.Rect),tempQuad$jscomp$1=C3$jscomp$62.New(C3$jscomp$62.Quad);
C3$jscomp$62.Gfx.EffectChain.Step.PostDraw=class extends C3$jscomp$62.Gfx.EffectChain.Step{constructor(a,b,d,c){super(a,b,d,c)}Run_WebGL(a,b,d){const c=this.GetEffectChain();a.SetTextureFillMode();a.SetRenderTarget(d);c._SetDeviceTransform(a,!0);a.SetBlendMode(c._GetBlendMode());a.SetTexture(b.GetTexture());tempQuad$jscomp$1.setFromRect(c._GetDrawSurfaceRect());tempRect$jscomp$1.copy(c._GetRcTexBounce());tempRect$jscomp$1.flipAround(1);a.Quad3(tempQuad$jscomp$1,tempRect$jscomp$1);c._ShouldInvalidateRenderTargets()&&
a.InvalidateRenderTarget(b)}Run_WebGPU(a,b,d){const c=this.GetEffectChain();a.SetTextureFillMode();a.SetRenderTarget(d,!1);c._IsRenderTargetSameSizeAndOffset(a)?tempQuad$jscomp$1.setFromRect(c._GetRcTexBounce()):(a.SetNormalizedCoordsProgramVariant(!1),c._SetDeviceTransform(a,!0),tempQuad$jscomp$1.setFromRect(c._GetDrawSurfaceRect()));a.SetBackTexture(null);a.SetBlendMode(c._GetBlendMode());a.SetTexture(b.GetTexture());c.UseFullSurface()?a.FullscreenQuad():a.Quad3(tempQuad$jscomp$1,c._GetRcTexBounce())}};
"use strict";const C3$jscomp$63=self.C3;
C3$jscomp$63.Gfx.EffectChain.Step.FirstBounce=class extends C3$jscomp$63.Gfx.EffectChain.Step{constructor(a,b,d,c){super(a,b,d,c)}Run_WebGL(a,b,d){b=this.GetEffectChain();a.SetRenderTarget(d,b._UpdateOwnProjection());a.ClearRgba(0,0,0,0);a.SetCopyBlend();a.SetProgram(this.GetShaderProgram());b._SetFirstBounceProgramParameters(a,this.GetIndex());b._DrawContent(a);b._ClampRcTexDest()}Run_WebGPU(a,b,d){b=this.GetEffectChain();a.SetRenderTarget(d,!1);a.ClearRgba(0,0,0,0);a.SetCopyBlend();a.SetProgram(this.GetShaderProgram());
b._SetFirstBounceProgramParameters(a,this.GetIndex());b._DrawContent(a);b._ClampRcTexDest()}};"use strict";const C3$jscomp$64=self.C3,tempRect$jscomp$2=C3$jscomp$64.New(C3$jscomp$64.Rect),tempQuad$jscomp$2=C3$jscomp$64.New(C3$jscomp$64.Quad);
C3$jscomp$64.Gfx.EffectChain.Step.Bounce=class extends C3$jscomp$64.Gfx.EffectChain.Step{constructor(a,b,d,c){super(a,b,d,c)}Run_WebGL(a,b,d){const c=this.GetEffectChain();a.SetRenderTarget(d);(d=0===this.GetDestTargetId())?a.SetBlendMode(c._GetBlendMode()):(a.ClearRgba(0,0,0,0),a.SetCopyBlend());a.SetProgram(this.GetShaderProgram());c._SetProgramParameters(a,this.GetIndex());a.SetTexture(b.GetTexture());c._SetDeviceTransform(a,d);tempQuad$jscomp$2.setFromRect(c._GetDrawSurfaceRect());tempRect$jscomp$2.copy(c._GetRcTexBounce());
tempRect$jscomp$2.flipAround(1);a.Quad3(tempQuad$jscomp$2,tempRect$jscomp$2);c._ShouldInvalidateRenderTargets()&&a.InvalidateRenderTarget(b)}Run_WebGPU(a,b,d){const c=this.GetEffectChain();a.SetRenderTarget(d,!1);0===this.GetDestTargetId()?(a.SetBlendMode(c._GetBlendMode()),a.SetBackTexture(null),c._IsRenderTargetSameSizeAndOffset(a)?tempQuad$jscomp$2.setFromRect(c._GetRcTexBounce()):(a.SetNormalizedCoordsProgramVariant(!1),c._SetDeviceTransform(a,!0),tempQuad$jscomp$2.setFromRect(c._GetDrawSurfaceRect()))):
(a.ClearRgba(0,0,0,0),a.SetCopyBlend(),tempQuad$jscomp$2.setFromRect(c._GetRcTexBounce()));a.SetProgram(this.GetShaderProgram());c._SetProgramParameters(a,this.GetIndex());a.SetTexture(b.GetTexture());c.UseFullSurface()?a.FullscreenQuad():a.Quad3(tempQuad$jscomp$2,c._GetRcTexBounce())}};"use strict";const C3$jscomp$65=self.C3,C3X$jscomp$1=self.C3X;let runtime$jscomp$1=null;const keysDownByKey=new Set;function SortZOrderList(a,b){const d=a[0]-b[0];return 0!==d?d:a[1]-b[1]}
const tempZOrderList=[],tempInstances=[];let didWarnInAlertPolyfill=!1,didWarnFpsDeprecated=!1;const VALID_FRAMERATE_MODES=new Set(["vsync","unlimited-tick","unlimited-frame"]);
self.IRuntime=class{constructor(a){runtime$jscomp$1=a;Object.defineProperties(this,{assets:{value:runtime$jscomp$1.GetAssetManager().GetIAssetManager(),writable:!1},collisions:{value:runtime$jscomp$1.GetCollisionEngine().GetICollisionEngine(),writable:!1},objects:{value:{},writable:!1},globalVars:{value:{},writable:!1},projectName:{value:runtime$jscomp$1.GetProjectName(),writable:!1},projectVersion:{value:runtime$jscomp$1.GetProjectVersion(),writable:!1},storage:{value:new self.IStorage(runtime$jscomp$1),
writable:!1},isInWorker:{value:runtime$jscomp$1.IsInWorker(),writable:!1},viewportWidth:{value:runtime$jscomp$1.GetOriginalViewportWidth(),writable:!1},viewportHeight:{value:runtime$jscomp$1.GetOriginalViewportHeight(),writable:!1},sampling:{value:runtime$jscomp$1.GetSampling(),writable:!1},isPixelRoundingEnabled:{value:runtime$jscomp$1.IsPixelRoundingEnabled(),writable:!1}});runtime$jscomp$1.UserScriptDispatcher().addEventListener("keydown",b=>{keysDownByKey.has(b.key)?b.stopPropagation():keysDownByKey.add(b.key)});
runtime$jscomp$1.UserScriptDispatcher().addEventListener("keyup",b=>keysDownByKey.delete(b.key));runtime$jscomp$1.Dispatcher().addEventListener("window-blur",()=>keysDownByKey.clear());runtime$jscomp$1.IsInWorker()&&(self.alert=b=>{didWarnInAlertPolyfill||(didWarnInAlertPolyfill=!0,console.warn("[Construct] alert() was called from a Web Worker, because the project 'Use worker' setting is enabled. This method is not normally available in a Web Worker. Construct has implemented the alert for you, but note that other features may be missing in worker mode. You may wish to disable 'Use worker', or use a more convenient function like console.log(). For more information please refer to the scripting section of the manual."));
return this.alert(b)})}_InitObjects(a){Object.defineProperties(this.objects,a)}_InitGlobalVars(a){Object.defineProperties(this.globalVars,a)}addEventListener(a,b){runtime$jscomp$1.UserScriptDispatcher().addEventListener(a,b)}removeEventListener(a,b){runtime$jscomp$1.UserScriptDispatcher().removeEventListener(a,b)}callFunction(a,...b){C3X$jscomp$1.RequireString(a);const d=runtime$jscomp$1.GetEventSheetManager(),c=d.GetFunctionBlockByName(a);if(!c)throw Error(`cannot find function name '${a}'`);if(!c.IsEnabled())return c.GetDefaultReturnValue();
if(b.length<c.GetFunctionParameterCount())throw Error(`not enough function parameters passed for '${a}' (${b.length} passed, ${c.GetFunctionParameterCount()} expected)`);a=c.GetEventBlock();let e=a.GetSolModifiersIncludingParents();const g=d.GetCurrentEvent();if(g){e=e.slice(0);const k=new Set(e);for(const l of g.GetSolModifiersIncludingParents())k.has(l)||(e.push(l),k.add(l));for(const l of d.GetDynamicSolModifiersSet())k.has(l)||(e.push(l),k.add(l))}return a.RunAsExpressionFunctionCall(e,c.IsCopyPicked(),
c.GetReturnType(),c.GetDefaultReturnValue(),...b)}setReturnValue(a){const b=runtime$jscomp$1.GetEventStack().GetCurrentExpFuncStackFrame();if(!b)throw Error("not in a function which returns a value");switch(b.GetFunctionReturnType()){case 1:"number"===typeof a&&b.SetFunctionReturnValue(a);break;case 2:"string"===typeof a&&b.SetFunctionReturnValue(a);break;case 3:"number"!==typeof a&&"string"!==typeof a||b.SetFunctionReturnValue(a)}}getViewportSize(){return[runtime$jscomp$1.GetOriginalViewportWidth(),
runtime$jscomp$1.GetOriginalViewportHeight()]}get dt(){return runtime$jscomp$1.GetDt()}get dtRaw(){return runtime$jscomp$1.GetDtRaw()}get gameTime(){return runtime$jscomp$1.GetGameTime()}get wallTime(){return runtime$jscomp$1.GetWallTime()}get timeScale(){return runtime$jscomp$1.GetTimeScale()}set timeScale(a){C3X$jscomp$1.RequireFiniteNumber(a);runtime$jscomp$1.SetTimeScale(a)}get fps(){didWarnFpsDeprecated||(console.warn("IRuntime.fps is deprecated. Use IRuntime.framesPerSecond instead."),didWarnFpsDeprecated=
!0);return runtime$jscomp$1.GetFramesPerSecond()}get framesPerSecond(){return runtime$jscomp$1.GetFramesPerSecond()}get ticksPerSecond(){return runtime$jscomp$1.GetTicksPerSecond()}get cpuUtilisation(){return runtime$jscomp$1.GetMainThreadTime()}get gpuUtilisation(){return runtime$jscomp$1.GetGPUUtilisation()}get framerateMode(){return runtime$jscomp$1.GetFramerateMode()}set framerateMode(a){if(!VALID_FRAMERATE_MODES.has(a))throw Error("invalid framerate mode");runtime$jscomp$1._SetFramerateMode(a)}get minDt(){return runtime$jscomp$1.GetMinDt()}set minDt(a){C3X$jscomp$1.RequireFiniteNumber(a);
runtime$jscomp$1.SetMinDt(a)}get maxDt(){return runtime$jscomp$1.GetMaxDt()}set maxDt(a){runtime$jscomp$1.SetMaxDt(a)}random(){return runtime$jscomp$1.Random()}get layout(){const a=runtime$jscomp$1.GetMainRunningLayout();if(!a)throw Error("no layout is running - make sure a layout is loaded before accessing");return a.GetILayout()}getLayout(a){const b=runtime$jscomp$1.GetLayoutManager();if("number"===typeof a||"string"===typeof a)a=b.GetLayout(a);else throw new TypeError("expected string or number");
if(!a)throw Error("invalid layout");return a.GetILayout()}getAllLayouts(){return runtime$jscomp$1.GetLayoutManager().GetAllLayouts().map(a=>a.GetILayout())}goToLayout(a){const b=runtime$jscomp$1.GetLayoutManager();if("number"===typeof a||"string"===typeof a)a=b.GetLayout(a);else throw new TypeError("expected string or number");if(!a)throw Error("invalid layout");b.IsPendingChangeMainLayout()||b.ChangeMainLayout(a)}get keyboard(){const a=runtime$jscomp$1._GetCommonScriptInterfaces().keyboard;if(!a)throw Error("runtime.keyboard used but Keyboard object missing - add it to your project first");
return a}get mouse(){const a=runtime$jscomp$1._GetCommonScriptInterfaces().mouse;if(!a)throw Error("runtime.mouse used but Mouse object missing - add it to your project first");return a}get touch(){const a=runtime$jscomp$1._GetCommonScriptInterfaces().touch;if(!a)throw Error("runtime.touch used but Touch object missing - add it to your project first");return a}get timelineController(){const a=runtime$jscomp$1._GetCommonScriptInterfaces().timelineController;if(!a)throw Error("runtime.timelineController used but Timeline Controller object missing - add it to your project first");
return a}get platformInfo(){const a=runtime$jscomp$1._GetCommonScriptInterfaces().platformInfo;if(!a)throw Error("runtime.platformInfo used but Platform Info object missing - add it to your project first");return a}invokeDownload(a,b){C3X$jscomp$1.RequireString(a);C3X$jscomp$1.RequireString(b);runtime$jscomp$1.InvokeDownload(a,b)}getInstanceByUid(a){C3X$jscomp$1.RequireFiniteNumber(a);return(a=runtime$jscomp$1.GetInstanceByUID(a))?a.GetInterfaceClass():null}sortZOrder(a,b){C3X$jscomp$1.RequireFunction(b);
const d=runtime$jscomp$1.GetCurrentLayout();for(var c of a){a=runtime$jscomp$1._UnwrapIWorldInstance(c);var e=a.GetWorldInfo();tempZOrderList.push([e.GetLayer().GetIndex(),e.GetZIndex()]);tempInstances.push(a)}if(0!==tempZOrderList.length){tempZOrderList.sort(SortZOrderList);tempInstances.sort((g,k)=>b(g.GetInterfaceClass(),k.GetInterfaceClass()));c=!1;for(let g=0,k=tempZOrderList.length;g<k;++g){a=tempInstances[g];e=d.GetLayerByIndex(tempZOrderList[g][0]);const l=tempZOrderList[g][1],n=e._GetInstances();
n[l]!==a&&(n[l]=a,a.GetWorldInfo()._SetLayer(e,!0),e.SetZIndicesChanged(a),c=!0)}c&&runtime$jscomp$1.UpdateRender();C3$jscomp$65.clearArray(tempZOrderList);C3$jscomp$65.clearArray(tempInstances)}}async createWorker(a,b){var d=new MessageChannel;const c=d.port1;d=d.port2;await runtime$jscomp$1.PostComponentMessageToDOMAsync("runtime","script-create-worker",{url:a,opts:b,port2:d},[d]);return c}alert(a){return runtime$jscomp$1.PostComponentMessageToDOMAsync("runtime","alert",{message:a+(runtime$jscomp$1.IsInWorker()?
" [via Web Worker]":"")})}getHTMLLayer(a){C3X$jscomp$1.RequireFiniteNumber(a);return runtime$jscomp$1._GetHTMLLayerWrapElement(a)}addLoadPromise(a){runtime$jscomp$1.AddLoadPromise(a)}};"use strict";const C3$jscomp$66=self.C3;let assetManager=null;
self.IAssetManager=class{constructor(a){assetManager=a;Object.defineProperties(this,{isWebMOpusSupported:{value:assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:!1}})}loadImageAsset(a){a=self.IImageInfo._Unwrap(a);if(!a)throw Error("invalid IImageInfo");a.LoadAsset(assetManager.GetRuntime())}fetchText(a){return assetManager.FetchText(a)}fetchJson(a){return assetManager.FetchJson(a)}fetchBlob(a){return assetManager.FetchBlob(a)}fetchArrayBuffer(a){return assetManager.FetchArrayBuffer(a)}getProjectFileUrl(a){return assetManager.GetProjectFileUrl(a)}getMediaFileUrl(a){"flat"===
assetManager.GetFileStructure()&&C3$jscomp$66.IsRelativeURL(a)&&(a=a.toLowerCase());return assetManager.GetMediaFileUrl(a)}get mediaFolder(){return assetManager.GetMediaSubfolder()}async decodeWebMOpus(a,b){if(this.isWebMOpusSupported)throw Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");b=await assetManager.GetRuntime()._WasmDecodeWebMOpus(b);b=new Float32Array(b);a=a.createBuffer(1,b.length,48E3);a.getChannelData(0).set(b);return a}loadScripts(...a){return assetManager.LoadScripts(...a)}compileWebAssembly(a){return assetManager.CompileWebAssembly(a)}loadStyleSheet(a){return assetManager.LoadStyleSheet(a)}};
"use strict";const C3$jscomp$67=self.C3,C3X$jscomp$3=self.C3X;let collisionEngine=null;
self.ICollisionEngine=class{constructor(a){collisionEngine=a;Object.defineProperties(this,{runtime:{value:collisionEngine.GetRuntime(),writable:!1}})}testOverlap(a,b){const d=collisionEngine.GetRuntime();a=d._UnwrapIWorldInstance(a);b=d._UnwrapIWorldInstance(b);return collisionEngine.TestOverlap(a,b)}testOverlapAny(a,b){const d=collisionEngine.GetRuntime();a=d._UnwrapIWorldInstance(a);for(const c of b)if(b=d._UnwrapIWorldInstance(c),collisionEngine.TestOverlap(a,b))return c;return null}testOverlapSolid(a){a=
collisionEngine.GetRuntime()._UnwrapIWorldInstance(a);return(a=collisionEngine.TestOverlapSolid(a))?a.GetInterfaceClass():null}setCollisionCellSize(a,b){C3X$jscomp$3.RequireFiniteNumber(a);C3X$jscomp$3.RequireFiniteNumber(b);a=Math.floor(a);b=Math.floor(b);if(0>=a||0>=b)throw Error("invalid cell size");collisionEngine.SetCollisionCellSize(a,b)}getCollisionCellSize(){return collisionEngine.GetCollisionCellSize()}getCollisionCandidates(a,b){const d=collisionEngine.GetRuntime();a=Array.isArray(a)?a.map(e=>
d._UnwrapIObjectClass(e)):[d._UnwrapIObjectClass(a)];b=C3$jscomp$67.Rect.FromObject(b);const c=[];collisionEngine.GetObjectClassesCollisionCandidates(null,a,b,c);return c.map(e=>e.GetInterfaceClass())}};"use strict";const C3X$jscomp$4=self.C3X;
self.IStorage=class{constructor(a){this._storage=a._GetProjectStorage()}getItem(a){C3X$jscomp$4.RequireString(a);return this._storage.getItem(a)}setItem(a,b){C3X$jscomp$4.RequireString(a);return this._storage.setItem(a,b)}removeItem(a){C3X$jscomp$4.RequireString(a);return this._storage.removeItem(a)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}};"use strict";const C3$jscomp$69=self.C3,internalApiToken$jscomp$1=C3$jscomp$69._GetInternalAPIToken();
self.IPlugin=class{constructor(){const a=C3$jscomp$69.AddonManager._GetInitObject2(internalApiToken$jscomp$1);Object.defineProperties(this,{runtime:{value:a.GetRuntime().GetIRuntime(),writable:!1},isSingleGlobal:{value:a.IsSingleGlobal(),writable:!1},isWorldType:{value:a.IsWorldType(),writable:!1},isHTMLElementType:{value:a.IsHTMLElementType(),writable:!1},isRotatable:{value:a.IsRotatable(),writable:!1},hasEffects:{value:a.HasEffects(),writable:!1},is3d:{value:a.Is3D(),writable:!1},supportsHierarchies:{value:a.SupportsSceneGraph(),
writable:!1},supportsMesh:{value:a.SupportsMesh(),writable:!1}})}};"use strict";const C3$jscomp$70=self.C3,C3X$jscomp$6=self.C3X,map$jscomp$2=new WeakMap,internalApiToken$jscomp$2=C3$jscomp$70._GetInternalAPIToken();
self.IObjectClass=class{constructor(){const a=C3$jscomp$70.AddonManager._GetInitObject2(internalApiToken$jscomp$2);map$jscomp$2.set(this,a);Object.defineProperties(this,{name:{value:a.GetName(),writable:!1},runtime:{value:a.GetRuntime().GetIRuntime(),writable:!1},plugin:{value:a.GetPlugin().GetIPlugin(),writable:!1}});a.GetRuntime()._MapScriptInterface(this,a)}addEventListener(a,b){C3X$jscomp$6.RequireString(a);C3X$jscomp$6.RequireFunction(b);map$jscomp$2.get(this).UserScriptDispatcher().addEventListener(a,
b)}removeEventListener(a,b){C3X$jscomp$6.RequireString(a);C3X$jscomp$6.RequireFunction(b);map$jscomp$2.get(this).UserScriptDispatcher().removeEventListener(a,b)}getAllInstances(){return[...this.instances()]}getFirstInstance(){return C3$jscomp$70.first(this.instances())}getPickedInstances(){return[...this.pickedInstances()]}getFirstPickedInstance(){return C3$jscomp$70.first(this.pickedInstances())}*instances(){for(const a of map$jscomp$2.get(this).instancesIncludingPendingCreate())yield a.GetInterfaceClass()}*pickedInstances(){for(const a of map$jscomp$2.get(this).GetCurrentSol().GetInstances())yield a.GetInterfaceClass()}setInstanceClass(a){C3X$jscomp$6.RequireFunction(a);
if(0<map$jscomp$2.get(this).GetInstanceCount())throw Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");map$jscomp$2.get(this)._SetUserScriptInstanceClass(a)}createInstance(a,b,d,c,e){C3X$jscomp$6.RequireNumber(b);C3X$jscomp$6.RequireNumber(d);if("number"!==typeof a&&"string"!==typeof a)throw new TypeError("invalid layer parameter");const g=map$jscomp$2.get(this),k=g.GetRuntime();a=k.GetMainRunningLayout().GetLayer(a);if(!a)throw Error("invalid layer");
b=k.CreateInstance(g,a,b,d,c,e);c&&a.SortAndAddInstancesByZIndex(b);c=k.GetEventSheetManager();c.BlockFlushingInstances(!0);b._TriggerOnCreatedOnSelfAndRelated();c.BlockFlushingInstances(!1);c.IsInEventEngine()||k.GetLayoutManager().IsEndingLayout()||k.FlushPendingInstances();return b.GetInterfaceClass()}};"use strict";const C3X$jscomp$7=self.C3X,map$jscomp$3=new WeakMap,VALID_WHERE_STRINGS=["above","below","top-sublayer","bottom-sublayer"];
self.ILayout=class{constructor(a){map$jscomp$3.set(this,a);const b=[],d=a.GetEffectList(),c=d.GetAllEffectTypes().length;for(let e=0;e<c;++e)b.push(new self.IEffectInstance(d,e));Object.defineProperties(this,{name:{value:a.GetName(),writable:!1},index:{value:a.GetIndex(),writable:!1},effects:{value:b,writable:!1}})}addEventListener(a,b){C3X$jscomp$7.RequireString(a);C3X$jscomp$7.RequireFunction(b);map$jscomp$3.get(this).UserScriptDispatcher().addEventListener(a,b)}removeEventListener(a,b){C3X$jscomp$7.RequireString(a);
C3X$jscomp$7.RequireFunction(b);map$jscomp$3.get(this).UserScriptDispatcher().removeEventListener(a,b)}get width(){return map$jscomp$3.get(this).GetWidth()}set width(a){C3X$jscomp$7.RequireFiniteNumber(a);map$jscomp$3.get(this).SetWidth(a)}get height(){return map$jscomp$3.get(this).GetHeight()}set height(a){C3X$jscomp$7.RequireFiniteNumber(a);map$jscomp$3.get(this).SetHeight(a)}setSize(a,b){C3X$jscomp$7.RequireFiniteNumber(a);C3X$jscomp$7.RequireFiniteNumber(b);const d=map$jscomp$3.get(this);d.SetWidth(a);
d.SetHeight(b)}getSize(){const a=map$jscomp$3.get(this);return[a.GetWidth(),a.GetHeight()]}set scale(a){C3X$jscomp$7.RequireFiniteNumber(a);map$jscomp$3.get(this).SetScale(a)}get scale(){return map$jscomp$3.get(this).GetScale()}set angle(a){C3X$jscomp$7.RequireFiniteNumber(a);map$jscomp$3.get(this).SetAngle(a)}get angle(){return map$jscomp$3.get(this).GetAngle()}set scrollX(a){C3X$jscomp$7.RequireNumber(a);map$jscomp$3.get(this).SetScrollX(a)}get scrollX(){return map$jscomp$3.get(this).GetScrollX()}set scrollY(a){C3X$jscomp$7.RequireNumber(a);
map$jscomp$3.get(this).SetScrollY(a)}get scrollY(){return map$jscomp$3.get(this).GetScrollY()}scrollTo(a,b){C3X$jscomp$7.RequireNumber(a);C3X$jscomp$7.RequireNumber(b);const d=map$jscomp$3.get(this);d.SetScrollX(a);d.SetScrollY(b)}getScrollPosition(){const a=map$jscomp$3.get(this);return[a.GetScrollX(),a.GetScrollY()]}getLayer(a){const b=map$jscomp$3.get(this);if("number"===typeof a||"string"===typeof a)a=b.GetLayer(a);else throw new TypeError("expected string or number");return a?a.GetILayer():null}getAllLayers(){return map$jscomp$3.get(this).GetLayers().map(a=>
a.GetILayer())}*allLayers(){for(const a of map$jscomp$3.get(this).allLayers())yield a.GetILayer()}addLayer(a,b,d){const c=map$jscomp$3.get(this),e=self.ILayer;C3X$jscomp$7.RequireString(a);C3X$jscomp$7.RequireOptionalInstanceOf(b,e);b=b?c.GetRuntime()._UnwrapScriptInterface(b):null;d=VALID_WHERE_STRINGS.indexOf(d);if(0>d)throw Error("invalid location");c.AddLayer(a,b,d)}moveLayer(a,b,d){const c=map$jscomp$3.get(this),e=c.GetRuntime(),g=self.ILayer;C3X$jscomp$7.RequireInstanceOf(a,g);a=e._UnwrapScriptInterface(a);
if(!a)throw Error("invalid layer");C3X$jscomp$7.RequireOptionalInstanceOf(b,g);b=b?e._UnwrapScriptInterface(b):null;d=VALID_WHERE_STRINGS.indexOf(d);if(0>d)throw Error("invalid location");c.MoveLayer(a,b,d)}removeLayer(a){const b=map$jscomp$3.get(this);C3X$jscomp$7.RequireInstanceOf(a,self.ILayer);a=b.GetRuntime()._UnwrapScriptInterface(a);if(!a)throw Error("invalid layer");const d=a.GetRuntime();b.RemoveLayer(a);d.GetEventSheetManager().IsInEventEngine()||d.FlushPendingInstances()}removeAllDynamicLayers(){const a=
map$jscomp$3.get(this),b=a.GetRuntime();a.RemoveAllDynamicLayers();b.GetEventSheetManager().IsInEventEngine()||b.FlushPendingInstances()}setVanishingPoint(a,b){C3X$jscomp$7.RequireFiniteNumber(a);C3X$jscomp$7.RequireFiniteNumber(b);map$jscomp$3.get(this).SetVanishingPointXY(a,b)}getVanishingPoint(){return map$jscomp$3.get(this)._GetVanishingPoint()}set projection(a){C3X$jscomp$7.RequireString(a);const b=map$jscomp$3.get(this);if("perspective"===a)b.SetPerspectiveProjection();else if("orthographic"===
a)b.SetOrthographicProjection();else throw Error("invalid projection");}get projection(){return map$jscomp$3.get(this).IsOrthographicProjection()?"orthographic":"perspective"}};"use strict";
const C3$jscomp$72=self.C3,C3X$jscomp$8=self.C3X,map$jscomp$4=new WeakMap,BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(a=>[a[1],a[0]])),tempColor$jscomp$1=C3$jscomp$72.New(C3$jscomp$72.Color);
self.ILayer=class{constructor(a){map$jscomp$4.set(this,a);const b=[],d=a.GetEffectList(),c=d.GetAllEffectTypes().length;for(let e=0;e<c;++e)b.push(new self.IEffectInstance(d,e));Object.defineProperties(this,{name:{value:a.GetName(),writable:!1},layout:{value:a.GetLayout().GetILayout(),writable:!1},effects:{value:b,writable:!1}});a.GetRuntime()._MapScriptInterface(this,a)}get parentLayer(){const a=map$jscomp$4.get(this).GetParentLayer();return a?a.GetILayer():null}*parentLayers(){for(const a of map$jscomp$4.get(this).parentLayers())yield a.GetILayer()}*subLayers(){for(const a of map$jscomp$4.get(this).GetSubLayers())yield a.GetILayer()}*allSubLayers(){for(const a of map$jscomp$4.get(this).GetSubLayers())for(const b of a.selfAndAllSubLayers())yield b.GetILayer()}get index(){return map$jscomp$4.get(this).GetIndex()}get isVisible(){return map$jscomp$4.get(this)._IsVisibleFlagSet()}set isVisible(a){map$jscomp$4.get(this).SetVisible(a)}get isSelfAndParentsVisible(){return map$jscomp$4.get(this).IsVisible()}get isInteractive(){return map$jscomp$4.get(this).IsInteractive()}set isInteractive(a){map$jscomp$4.get(this).SetInteractive(a)}get isHTMLElementsLayer(){return map$jscomp$4.get(this).IsHTMLElementsLayer()}set isHTMLElementsLayer(a){map$jscomp$4.get(this).SetIsHTMLElementsLayer(!!a)}get isSelfAndParentsInteractive(){return map$jscomp$4.get(this).IsSelfAndParentsInteractive()}get opacity(){return map$jscomp$4.get(this).GetOpacity()}set opacity(a){a=
C3$jscomp$72.clamp(+a,0,1);isNaN(a)||map$jscomp$4.get(this).SetOpacity(a)}set scale(a){C3X$jscomp$8.RequireFiniteNumber(a);map$jscomp$4.get(this).SetOwnScale(a)}get scale(){return map$jscomp$4.get(this).GetOwnScale()}set scaleRate(a){C3X$jscomp$8.RequireFiniteNumber(a);map$jscomp$4.get(this).SetScaleRate(a)}get scaleRate(){return map$jscomp$4.get(this).GetScaleRate()}set angle(a){C3X$jscomp$8.RequireFiniteNumber(a);map$jscomp$4.get(this).SetAngle(a)}get angle(){return map$jscomp$4.get(this).GetOwnAngle()}set parallaxX(a){C3X$jscomp$8.RequireFiniteNumber(a);
map$jscomp$4.get(this).SetParallaxX(a)}get parallaxX(){return map$jscomp$4.get(this).GetParallaxX()}set parallaxY(a){C3X$jscomp$8.RequireFiniteNumber(a);map$jscomp$4.get(this).SetParallaxY(a)}get parallaxY(){return map$jscomp$4.get(this).GetParallaxY()}set zElevation(a){C3X$jscomp$8.RequireFiniteNumber(a);map$jscomp$4.get(this).SetZElevation(a)}get zElevation(){return map$jscomp$4.get(this).GetZElevation()}set isTransparent(a){map$jscomp$4.get(this).SetTransparent(a)}get isTransparent(){return map$jscomp$4.get(this).IsTransparent()}set isForceOwnTexture(a){map$jscomp$4.get(this).SetForceOwnTexture(a)}get isForceOwnTexture(){return map$jscomp$4.get(this).IsForceOwnTexture()}set blendMode(a){C3X$jscomp$8.RequireString(a);
a=BLEND_MODE_TO_INDEX.get(a);if("number"!==typeof a)throw Error("invalid blend mode");map$jscomp$4.get(this).SetBlendMode(a)}get blendMode(){return INDEX_TO_BLEND_MODE.get(map$jscomp$4.get(this).GetBlendMode())}set backgroundColor(a){C3X$jscomp$8.RequireArray(a);if(3>a.length)throw Error("expected 3 elements");tempColor$jscomp$1.setRgb(a[0],a[1],a[2]);a=map$jscomp$4.get(this);const b=a.GetBackgroundColor();b.equalsIgnoringAlpha(tempColor$jscomp$1)||(b.copyRgb(tempColor$jscomp$1),a.GetRuntime().UpdateRender())}get backgroundColor(){const a=
map$jscomp$4.get(this).GetBackgroundColor();return[a.getR(),a.getG(),a.getB()]}set scrollX(a){C3X$jscomp$8.RequireNumber(a);const b=map$jscomp$4.get(this);b.SetOwnScrollPositionEnabled(!0);b.SetScrollX(a)}get scrollX(){return map$jscomp$4.get(this).GetScrollX()}set scrollY(a){C3X$jscomp$8.RequireNumber(a);const b=map$jscomp$4.get(this);b.SetOwnScrollPositionEnabled(!0);b.SetScrollY(a)}get scrollY(){return map$jscomp$4.get(this).GetScrollY()}scrollTo(a,b){C3X$jscomp$8.RequireNumber(a);C3X$jscomp$8.RequireNumber(b);
const d=map$jscomp$4.get(this);d.SetOwnScrollPositionEnabled(!0);d.SetScrollX(a);d.SetScrollY(b)}getScrollPosition(){const a=map$jscomp$4.get(this);return[a.GetScrollX(),a.GetScrollY()]}restoreScrollPosition(){map$jscomp$4.get(this).SetOwnScrollPositionEnabled(!1)}getViewport(){return map$jscomp$4.get(this).GetViewport().toDOMRect()}cssPxToLayer(a,b,d=0){C3X$jscomp$8.RequireNumber(a);C3X$jscomp$8.RequireNumber(b);C3X$jscomp$8.RequireNumber(d);const c=map$jscomp$4.get(this),e=c.GetRuntime();return c.CanvasCssToLayer(a-
e.GetCanvasClientX(),b-e.GetCanvasClientY(),d)}layerToCssPx(a,b,d=0){C3X$jscomp$8.RequireNumber(a);C3X$jscomp$8.RequireNumber(b);C3X$jscomp$8.RequireNumber(d);const c=map$jscomp$4.get(this),e=c.GetRuntime(),[g,k]=c.LayerToCanvasCss(a,b,d);return[g+e.GetCanvasClientX(),k+e.GetCanvasClientY()]}drawSurfaceToLayer(a,b,d=0){C3X$jscomp$8.RequireNumber(a);C3X$jscomp$8.RequireNumber(b);C3X$jscomp$8.RequireNumber(d);return map$jscomp$4.get(this).DrawSurfaceToLayer(a,b,d)}layerToDrawSurface(a,b,d=0){C3X$jscomp$8.RequireNumber(a);
C3X$jscomp$8.RequireNumber(b);C3X$jscomp$8.RequireNumber(d);return map$jscomp$4.get(this).LayerToDrawSurface(a,b,d)}get renderScale(){return map$jscomp$4.get(this).GetRenderScale()}};"use strict";const C3$jscomp$73=self.C3,C3X$jscomp$9=self.C3X,map$jscomp$5=new WeakMap,dispatchers=new WeakMap,internalApiToken$jscomp$3=C3$jscomp$73._GetInternalAPIToken();
function GetDispatcher(a){let b=dispatchers.get(a);if(b)return b;b=C3$jscomp$73.New(C3$jscomp$73.Event.Dispatcher);dispatchers.set(a,b);return b}
self.IInstance=class{constructor(){const a=C3$jscomp$73.AddonManager._GetInitObject2(internalApiToken$jscomp$3);map$jscomp$5.set(this,a);const b={runtime:{value:a.GetRuntime().GetIRuntime(),writable:!1},objectType:{value:a.GetObjectClass().GetIObjectClass(),writable:!1},plugin:{value:a.GetPlugin().GetIPlugin(),writable:!1},uid:{value:a.GetUID(),writable:!1}};a._GetInstVarsScriptDescriptor(b);a._GetBehaviorsScriptDescriptor(b);Object.defineProperties(this,b);a.GetRuntime()._MapScriptInterface(this,
a)}static _GetInitInst(){return C3$jscomp$73.AddonManager._GetInitObject()}_release(){const a=dispatchers.get(this);a&&(a.Release(),dispatchers.delete(this));map$jscomp$5.delete(this)}addEventListener(a,b,d){C3X$jscomp$9.RequireString(a);C3X$jscomp$9.RequireFunction(b);GetDispatcher(this).addEventListener(a,b,d)}removeEventListener(a,b,d){C3X$jscomp$9.RequireString(a);C3X$jscomp$9.RequireFunction(b);GetDispatcher(this).removeEventListener(a,b,d)}dispatchEvent(a){GetDispatcher(this).dispatchEvent(a)}destroy(){const a=
map$jscomp$5.get(this),b=a.GetRuntime();b.DestroyInstance(a);b.GetEventSheetManager().IsInEventEngine()||b.GetLayoutManager().IsEndingLayout()||b.GetEventSheetManager().IsFlushingBlocked()||b.FlushPendingInstances()}getOtherContainerInstances(){const a=map$jscomp$5.get(this).GetSiblings();return a?a.map(b=>b.GetInterfaceClass()):[]}*otherContainerInstances(){const a=map$jscomp$5.get(this);if(a.IsInContainer())for(const b of a.siblings())yield b.GetInterfaceClass()}get templateName(){return map$jscomp$5.get(this).GetTemplateName()}set timeScale(a){C3X$jscomp$9.RequireFiniteNumber(a);
map$jscomp$5.get(this).SetTimeScale(a)}get timeScale(){return map$jscomp$5.get(this).GetActiveTimeScale()}restoreTimeScale(){map$jscomp$5.get(this).RestoreTimeScale()}get dt(){const a=map$jscomp$5.get(this);return a.GetRuntime().GetDt(a)}};"use strict";const C3$jscomp$74=self.C3,C3X$jscomp$10=self.C3X,map$jscomp$6=new WeakMap,internalApiToken$jscomp$4=C3$jscomp$74._GetInternalAPIToken();
self.ISDKInstanceBase=class extends self.IInstance{constructor(a){super();map$jscomp$6.set(this,C3$jscomp$74.AddonManager._GetInitObject2(internalApiToken$jscomp$4));this._p_isTicking=!1;this._p_tickFunc=null;this._p_isTicking2=!1;this._p_tickFunc2=null;this._p_domComponentId=a?.domComponentId;this._p_wrapperComponentId=a?.wrapperComponentId}_release(){super._release();map$jscomp$6.delete(this)}_getInitProperties(){return C3$jscomp$74.AddonManager._GetInitProperties()}_trigger(a){const b=map$jscomp$6.get(this);
b.GetRuntime().Trigger(a,b)}_addDOMMessageHandler(a,b){C3X$jscomp$10.RequireString(a);C3X$jscomp$10.RequireFunction(b);if(!this._p_domComponentId)throw Error("no DOM component id set");map$jscomp$6.get(this).GetRuntime().AddDOMComponentMessageHandler(this._p_domComponentId,a,b)}_addDOMMessageHandlers(a){C3X$jscomp$10.RequireArray(a);for(const [b,d]of a)this._addDOMMessageHandler(b,d)}_postToDOM(a,b){C3X$jscomp$10.RequireString(a);if(!this._p_domComponentId)throw Error("no DOM component id set");map$jscomp$6.get(this).GetRuntime().PostComponentMessageToDOM(this._p_domComponentId,
a,b)}_postToDOMAsync(a,b){C3X$jscomp$10.RequireString(a);if(!this._p_domComponentId)throw Error("no DOM component id set");return map$jscomp$6.get(this).GetRuntime().PostComponentMessageToDOMAsync(this._p_domComponentId,a,b)}_postToDOMMaybeSync(a,b){if(map$jscomp$6.get(this).GetRuntime().IsInWorker())this._postToDOM(a,b);else return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._p_domComponentId,handler:a,data:b,responseId:null})}_setTicking(a){a=!!a;if(this._p_isTicking!==
a){this._p_isTicking=a;var b=map$jscomp$6.get(this).GetRuntime();a?(this._p_tickFunc||(this._p_tickFunc=()=>this._tick()),b.Dispatcher().addEventListener("tick",this._p_tickFunc)):b.Dispatcher().removeEventListener("tick",this._p_tickFunc)}}_isTicking(){return this._p_isTicking}_tick(){}_setTicking2(a){a=!!a;if(this._p_isTicking2!==a){this._p_isTicking2=a;var b=map$jscomp$6.get(this).GetRuntime();a?(this._p_tickFunc2||(this._p_tickFunc2=()=>this._tick2()),b.Dispatcher().addEventListener("tick2",this._p_tickFunc2)):
b.Dispatcher().removeEventListener("tick2",this._p_tickFunc2)}}_isTicking2(){return this._p_isTicking2}_tick2(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(a){}_isWrapperExtensionAvailable(){if(!this._p_wrapperComponentId)throw Error("no wrapper component id set");return map$jscomp$6.get(this).GetRuntime().HasWrapperComponentId(this._p_wrapperComponentId)}_addWrapperExtensionMessageHandler(a,b){C3X$jscomp$10.RequireString(a);C3X$jscomp$10.RequireFunction(b);if(!this._p_wrapperComponentId)throw Error("no wrapper component id set");
map$jscomp$6.get(this).GetRuntime().AddWrapperExtensionMessageHandler(this._p_wrapperComponentId,a,b)}_addWrapperMessageHandlers(a){C3X$jscomp$10.RequireArray(a);for(const [b,d]of a)this._addWrapperExtensionMessageHandler(b,d)}_sendWrapperExtensionMessage(a,b){C3X$jscomp$10.RequireString(a);C3X$jscomp$10.RequireOptionalArray(b);if(!this._p_wrapperComponentId)throw Error("no wrapper component id set");map$jscomp$6.get(this).GetRuntime().SendWrapperExtensionMessage(this._p_wrapperComponentId,a,b)}_sendWrapperExtensionMessageAsync(a,
b){C3X$jscomp$10.RequireString(a);C3X$jscomp$10.RequireOptionalArray(b);if(!this._p_wrapperComponentId)throw Error("no wrapper component id set");return map$jscomp$6.get(this).GetRuntime().SendWrapperExtensionMessageAsync(this._p_wrapperComponentId,a,b)}};"use strict";
const C3$jscomp$75=self.C3,C3X$jscomp$11=self.C3X,ILayer$jscomp$4=self.ILayer,map$jscomp$7=new WeakMap,internalApiToken$jscomp$5=C3$jscomp$75._GetInternalAPIToken(),BLEND_MODE_TO_INDEX$jscomp$1=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE$jscomp$1=new Map([...BLEND_MODE_TO_INDEX$jscomp$1.entries()].map(a=>[a[1],a[0]])),tempColor$jscomp$2=
C3$jscomp$75.New(C3$jscomp$75.Color);
function MakeIWorldInstanceClass(a){return class b extends a{constructor(d){super(d);var c=C3$jscomp$75.AddonManager._GetInitObject2(internalApiToken$jscomp$5);map$jscomp$7.set(this,c);d=[];var e=c.GetWorldInfo();if(c=e.GetInstanceEffectList()){e=e.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let g=0;g<e;++g)d.push(new self.IEffectInstance(c,g))}Object.defineProperties(this,{effects:{value:d,writable:!1}})}get layout(){return map$jscomp$7.get(this).GetWorldInfo().GetLayout().GetILayout()}get layer(){return map$jscomp$7.get(this).GetWorldInfo().GetLayer().GetILayer()}get x(){return map$jscomp$7.get(this).GetWorldInfo().GetX()}set x(d){d=+d;
const c=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||c.GetX()===d||(c.SetX(d),c.SetBboxChanged())}get y(){return map$jscomp$7.get(this).GetWorldInfo().GetY()}set y(d){d=+d;const c=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||c.GetY()===d||(c.SetY(d),c.SetBboxChanged())}setPosition(d,c){d=+d;c=+c;const e=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||isNaN(c)||e.GetX()===d&&e.GetY()===c||(e.SetXY(d,c),e.SetBboxChanged())}getPosition(){const d=map$jscomp$7.get(this).GetWorldInfo();return[d.GetX(),
d.GetY()]}offsetPosition(d,c){d=+d;c=+c;if(!(isNaN(d)||isNaN(c)||0===d&&0===c)){var e=map$jscomp$7.get(this).GetWorldInfo();e.OffsetXY(d,c);e.SetBboxChanged()}}get zElevation(){return map$jscomp$7.get(this).GetWorldInfo().GetZElevation()}set zElevation(d){d=+d;const c=map$jscomp$7.get(this),e=c.GetWorldInfo();isNaN(d)||e.GetZElevation()===d||(e.SetZElevation(d),c.GetRuntime().UpdateRender())}get totalZElevation(){return map$jscomp$7.get(this).GetWorldInfo().GetTotalZElevation()}get width(){return map$jscomp$7.get(this).GetWorldInfo().GetWidth()}set width(d){d=
+d;const c=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||c.GetWidth()===d||(c.SetWidth(d),c.SetBboxChanged())}get height(){return map$jscomp$7.get(this).GetWorldInfo().GetHeight()}set height(d){d=+d;const c=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||c.GetHeight()===d||(c.SetHeight(d),c.SetBboxChanged())}setSize(d,c){d=+d;c=+c;const e=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||isNaN(c)||e.GetWidth()===d&&e.GetHeight()===c||(e.SetSize(d,c),e.SetBboxChanged())}getSize(){const d=map$jscomp$7.get(this).GetWorldInfo();
return[d.GetWidth(),d.GetHeight()]}get angle(){return map$jscomp$7.get(this).GetWorldInfo().GetAngle()}set angle(d){d=C3$jscomp$75.clampAngle(+d);const c=map$jscomp$7.get(this).GetWorldInfo();isNaN(d)||c.GetAngle()===d||(c.SetAngle(d),c.SetBboxChanged())}get angleDegrees(){return C3$jscomp$75.toDegrees(this.angle)}set angleDegrees(d){this.angle=C3$jscomp$75.toRadians(d)}getBoundingBox(){return map$jscomp$7.get(this).GetWorldInfo().GetBoundingBox().toDOMRect()}getBoundingQuad(){return map$jscomp$7.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad()}isOnScreen(){return map$jscomp$7.get(this).GetWorldInfo().IsInViewport2()}get isVisible(){return map$jscomp$7.get(this).GetWorldInfo().IsVisible()}set isVisible(d){d=
!!d;const c=map$jscomp$7.get(this),e=c.GetWorldInfo();e.IsVisible()!==d&&(e.SetVisible(d),c.GetRuntime().UpdateRender())}get opacity(){return map$jscomp$7.get(this).GetWorldInfo().GetOpacity()}set opacity(d){d=C3$jscomp$75.clamp(+d,0,1);const c=map$jscomp$7.get(this),e=c.GetWorldInfo();isNaN(d)||e.GetOpacity()===d||(e.SetOpacity(d),c.GetRuntime().UpdateRender())}set colorRgb(d){C3X$jscomp$11.RequireArray(d);if(3>d.length)throw Error("expected 3 elements");tempColor$jscomp$2.setRgb(d[0],d[1],d[2]);
d=map$jscomp$7.get(this);const c=d.GetWorldInfo();c.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor$jscomp$2)||(c.SetUnpremultipliedColor(tempColor$jscomp$2),d.GetRuntime().UpdateRender())}get colorRgb(){const d=map$jscomp$7.get(this).GetWorldInfo().GetUnpremultipliedColor();return[d.getR(),d.getG(),d.getB()]}set blendMode(d){C3X$jscomp$11.RequireString(d);d=BLEND_MODE_TO_INDEX$jscomp$1.get(d);if("number"!==typeof d)throw Error("invalid blend mode");const c=map$jscomp$7.get(this);c.GetWorldInfo().SetBlendMode(d);
c.GetRuntime().UpdateRender()}get blendMode(){return INDEX_TO_BLEND_MODE$jscomp$1.get(map$jscomp$7.get(this).GetWorldInfo().GetBlendMode())}moveToTop(){map$jscomp$7.get(this).GetWorldInfo().ZOrderMoveToTop()}moveToBottom(){map$jscomp$7.get(this).GetWorldInfo().ZOrderMoveToBottom()}moveToLayer(d){C3X$jscomp$11.RequireInstanceOf(d,ILayer$jscomp$4);const c=map$jscomp$7.get(this);d=c.GetRuntime()._UnwrapScriptInterface(d);if(!d)throw Error("invalid layer");c.GetWorldInfo().ZOrderMoveToLayer(d)}moveAdjacentToInstance(d,
c){C3X$jscomp$11.RequireInstanceOf(d,b);map$jscomp$7.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(map$jscomp$7.get(d),c)}get zIndex(){return map$jscomp$7.get(this).GetWorldInfo().GetZIndex()}get isCollisionEnabled(){return map$jscomp$7.get(this).GetWorldInfo().IsCollisionEnabled()}set isCollisionEnabled(d){map$jscomp$7.get(this).GetWorldInfo().SetCollisionEnabled(!!d)}containsPoint(d,c){C3X$jscomp$11.RequireNumber(d);C3X$jscomp$11.RequireNumber(c);return map$jscomp$7.get(this).GetWorldInfo().ContainsPoint(+d,
+c)}testOverlap(d){C3X$jscomp$11.RequireInstanceOf(d,b);const c=map$jscomp$7.get(this);d=map$jscomp$7.get(d);return c.GetRuntime().GetCollisionEngine().TestOverlap(c,d)}testOverlapSolid(){var d=map$jscomp$7.get(this);return(d=d.GetRuntime().GetCollisionEngine().TestOverlapSolid(d))?d.GetInterfaceClass():null}getParent(){const d=map$jscomp$7.get(this).GetParent();return d?d.GetInterfaceClass():null}getTopParent(){const d=map$jscomp$7.get(this).GetTopParent();return d?d.GetInterfaceClass():null}*parents(){for(const d of map$jscomp$7.get(this).parents())yield d.GetInterfaceClass()}getChildCount(){return map$jscomp$7.get(this).GetChildCount()}getChildAt(d){return(d=
map$jscomp$7.get(this).GetChildAt(d))?d.GetInterfaceClass():null}*children(){for(const d of map$jscomp$7.get(this).children())yield d.GetInterfaceClass()}*allChildren(){for(const d of map$jscomp$7.get(this).allChildren())yield d.GetInterfaceClass()}addChild(d,c){C3X$jscomp$11.RequireInstanceOf(d,b);C3X$jscomp$11.RequireOptionalObject(c);c||(c={});const e=map$jscomp$7.get(this);d=map$jscomp$7.get(d);e.AddChild(d,c)}removeChild(d){C3X$jscomp$11.RequireInstanceOf(d,b);const c=map$jscomp$7.get(this);
d=map$jscomp$7.get(d);c.RemoveChild(d)}removeFromParent(){const d=map$jscomp$7.get(this);d.HasParent()&&d.GetParent().RemoveChild(d)}createMesh(d,c){C3X$jscomp$11.RequireFiniteNumber(d);C3X$jscomp$11.RequireFiniteNumber(c);map$jscomp$7.get(this).GetWorldInfo().CreateMesh(d,c)}releaseMesh(){const d=map$jscomp$7.get(this).GetWorldInfo();d.ReleaseMesh();d.SetBboxChanged()}setMeshPoint(d,c,e){C3X$jscomp$11.RequireFiniteNumber(d);C3X$jscomp$11.RequireFiniteNumber(c);C3X$jscomp$11.RequireObject(e);const g=
map$jscomp$7.get(this).GetWorldInfo();g.SetMeshPoint(d,c,e)&&g.SetBboxChanged()}getMeshSize(){var d=map$jscomp$7.get(this).GetWorldInfo();if(!d.HasMesh())return[0,0];d=d.GetSourceMesh();return[d.GetHSize(),d.GetVSize()]}}}self.IWorldInstance=MakeIWorldInstanceClass(self.IInstance);self.IWorldInstanceSDKBase=MakeIWorldInstanceClass(self.ISDKInstanceBase);"use strict";const C3X$jscomp$12=self.C3X,map$jscomp$8=new WeakMap;
self.IDOMInstance=class extends self.IWorldInstance{constructor(){super();map$jscomp$8.set(this,self.IInstance._GetInitInst())}getElement(){return map$jscomp$8.get(this).GetSdkInstance()._GetElementInDOMMode()}focus(){map$jscomp$8.get(this).GetSdkInstance().FocusElement()}blur(){map$jscomp$8.get(this).GetSdkInstance().BlurElement()}setCssStyle(a,b){C3X$jscomp$12.RequireString(a);map$jscomp$8.get(this).GetSdkInstance().SetElementCSSStyle(a,b)}};"use strict";
const C3$jscomp$77=self.C3,C3X$jscomp$13=self.C3X,map$jscomp$9=new WeakMap,dispatchers$jscomp$1=new WeakMap,internalApiToken$jscomp$6=C3$jscomp$77._GetInternalAPIToken();function GetDispatcher$jscomp$1(a){let b=dispatchers$jscomp$1.get(a);if(b)return b;b=C3$jscomp$77.New(C3$jscomp$77.Event.Dispatcher);dispatchers$jscomp$1.set(a,b);return b}
self.IBehaviorInstance=class{constructor(){const a=C3$jscomp$77.AddonManager._GetInitObject2(internalApiToken$jscomp$6);map$jscomp$9.set(this,a);const b={runtime:{value:a.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:a.GetBehavior().GetIBehavior(),writable:!1},behaviorType:{value:a.GetBehaviorType().GetIBehaviorType(),writable:!1}};Object.defineProperties(this,b);a.GetRuntime()._MapScriptInterface(this,a)}static _GetInitInst(){return C3$jscomp$77.AddonManager._GetInitObject()}get instance(){return map$jscomp$9.get(this).GetObjectInstance().GetInterfaceClass()}_release(){const a=
dispatchers$jscomp$1.get(this);a&&(a.Release(),dispatchers$jscomp$1.delete(this));map$jscomp$9.delete(this)}addEventListener(a,b,d){C3X$jscomp$13.RequireString(a);C3X$jscomp$13.RequireFunction(b);GetDispatcher$jscomp$1(this).addEventListener(a,b,d)}removeEventListener(a,b,d){C3X$jscomp$13.RequireString(a);C3X$jscomp$13.RequireFunction(b);GetDispatcher$jscomp$1(this).removeEventListener(a,b,d)}dispatchEvent(a){GetDispatcher$jscomp$1(this).dispatchEvent(a)}};"use strict";
const C3$jscomp$78=self.C3,internalApiToken$jscomp$7=C3$jscomp$78._GetInternalAPIToken();self.IBehaviorType=class{constructor(){var a=C3$jscomp$78.AddonManager._GetInitObject2(internalApiToken$jscomp$7);a={runtime:{value:a.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:a.GetBehavior().GetIBehavior(),writable:!1},name:{value:a.GetName(),writable:!1}};Object.defineProperties(this,a)}};"use strict";const C3$jscomp$79=self.C3,map$jscomp$10=new WeakMap,internalApiToken$jscomp$8=C3$jscomp$79._GetInternalAPIToken();
self.IBehavior=class{constructor(){var a=C3$jscomp$79.AddonManager._GetInitObject2(internalApiToken$jscomp$8);map$jscomp$10.set(this,a);a={runtime:{value:a.GetRuntime().GetIRuntime(),writable:!1}};Object.defineProperties(this,a)}getAllInstances(){return map$jscomp$10.get(this).GetInstances().map(a=>a.GetInterfaceClass())}static getByConstructor(a){return a?(a=C3$jscomp$79.AddonManager.GetBehaviorByConstructorFunction(a))?a.GetIBehavior():null:null}};"use strict";
const C3$jscomp$80=self.C3,C3X$jscomp$16=self.C3X,map$jscomp$11=new WeakMap,tempColor$jscomp$3=C3$jscomp$80.New(C3$jscomp$80.Color);
self.IEffectInstance=class{constructor(a,b){map$jscomp$11.set(this,a);Object.defineProperties(this,{index:{value:b,writable:!1}})}get name(){return map$jscomp$11.get(this).GetAllEffectTypes()[this.index].GetName()}get isActive(){return map$jscomp$11.get(this).IsEffectIndexActive(this.index)}set isActive(a){a=!!a;const b=map$jscomp$11.get(this);b.IsEffectIndexActive(this.index)!==a&&(b.SetEffectIndexActive(this.index,a),b.UpdateActiveEffects(),b.GetRuntime().UpdateRender())}setParameter(a,b){C3X$jscomp$16.RequireFiniteNumber(a);
a=Math.floor(+a);const d=map$jscomp$11.get(this),c=d.GetEffectParameter(this.index,a);if(null===c)throw new RangeError("invalid index");if(c instanceof C3$jscomp$80.Color){if(!Array.isArray(b)||3>b.length)throw new TypeError("expected array with 3 elements");tempColor$jscomp$3.setRgb(b[0],b[1],b[2]);b=tempColor$jscomp$3}else if("number"!==typeof b)throw new TypeError("expected number");d.SetEffectParameter(this.index,a,b)&&d.IsEffectIndexActive(this.index)&&d.GetRuntime().UpdateRender()}getParameter(a){C3X$jscomp$16.RequireFiniteNumber(a);
a=Math.floor(+a);a=map$jscomp$11.get(this).GetEffectParameter(this.index,a);if(null===a)throw new RangeError("invalid index");return a instanceof C3$jscomp$80.Color?[a.getR(),a.getG(),a.getB()]:a}};"use strict";const map$jscomp$12=new WeakMap;
self.IAnimation=class{constructor(a){map$jscomp$12.set(this,a);Object.defineProperties(this,{name:{value:a.GetName(),writable:!1}})}get speed(){return map$jscomp$12.get(this).GetSpeed()}get isLooping(){return map$jscomp$12.get(this).IsLooping()}get repeatCount(){return map$jscomp$12.get(this).GetRepeatCount()}get repeatTo(){return map$jscomp$12.get(this).GetRepeatTo()}get isPingPong(){return map$jscomp$12.get(this).IsPingPong()}get frameCount(){return map$jscomp$12.get(this).GetFrameCount()}getFrames(){return map$jscomp$12.get(this).GetFrames().map(a=>a.GetIAnimationFrame())}*frames(){for(const a of map$jscomp$12.get(this).GetFrames())yield a.GetIAnimationFrame()}};
"use strict";const map$jscomp$13=new WeakMap;self.IImageInfo=class{constructor(a){map$jscomp$13.set(this,a)}static _Unwrap(a){return map$jscomp$13.get(a)}get width(){return map$jscomp$13.get(this).GetWidth()}get height(){return map$jscomp$13.get(this).GetHeight()}getSize(){const a=map$jscomp$13.get(this);return[a.GetWidth(),a.GetHeight()]}getTexture(a){return a.getTextureForImageInfo(this)}getTexRect(){return map$jscomp$13.get(this).GetTexRect().toDOMRect()}};"use strict";
const C3X$jscomp$19=self.C3X,map$jscomp$14=new WeakMap;
self.IAnimationFrame=class extends self.IImageInfo{constructor(a){super(a.GetImageInfo());map$jscomp$14.set(this,a);Object.defineProperties(this,{duration:{value:a.GetDuration(),writable:!1},originX:{value:a.GetOriginX(),writable:!1},originY:{value:a.GetOriginY(),writable:!1}})}getOrigin(){const a=map$jscomp$14.get(this);return[a.GetOriginX(),a.GetOriginY()]}getImagePointCount(){return map$jscomp$14.get(this).GetImagePointCount()}getImagePointX(a){return this.getImagePoint(a)[0]}getImagePointY(a){return this.getImagePoint(a)[1]}getImagePoint(a){const b=map$jscomp$14.get(this);
if("number"===typeof a)a=b.GetImagePointByIndex(Math.floor(a));else if("string"===typeof a)a=b.GetImagePointByName(a);else throw new TypeError("expected string or number");return a?[a.GetX(),a.GetY()]:this.getOrigin()}getPolyPointCount(){const a=map$jscomp$14.get(this).GetCollisionPoly();return a?a.pointCount():0}getPolyPointX(a){return this.getPolyPoint(a)[0]}getPolyPointY(a){return this.getPolyPoint(a)[1]}getPolyPoint(a){C3X$jscomp$19.RequireFiniteNumber(a);a=Math.floor(a);var b=map$jscomp$14.get(this).GetCollisionPoly();
if(!b||0>a||a>=b.pointCount())return[0,0];b=b.pointsArr();return[b[2*a],b[2*a+1]]}get tag(){return map$jscomp$14.get(this).GetTag()}};"use strict";const C3X$jscomp$20=self.C3X,map$jscomp$15=new WeakMap;function GetTimelineState(a){a=map$jscomp$15.get(a);if(a.IsReleased())throw Error("timeline/tween was released and is no longer valid");return a}
self.ITimelineStateBase=class{constructor(a){map$jscomp$15.set(this,a);a.GetRuntime()._MapScriptInterface(this,a)}pause(){GetTimelineState(this).Stop()}resume(){GetTimelineState(this).Resume()}stop(){GetTimelineState(this).Reset()}hasTags(a){return GetTimelineState(this).HasTags(a)}set time(a){C3X$jscomp$20.RequireFiniteNumber(a);GetTimelineState(this).SetTime(a)}get time(){return GetTimelineState(this).GetTime()}set totalTime(a){C3X$jscomp$20.RequireFiniteNumber(a);GetTimelineState(this).SetTotalTime(a)}get totalTime(){return GetTimelineState(this).GetTotalTime()}set isLooping(a){GetTimelineState(this).SetLoop(!!a)}get isLooping(){return GetTimelineState(this).GetLoop()}set isPingPong(a){GetTimelineState(this).SetPingPong(!!a)}get isPingPong(){return GetTimelineState(this).GetPingPong()}set playbackRate(a){C3X$jscomp$20.RequireFiniteNumber(a);
GetTimelineState(this).SetPlaybackRate(a)}get playbackRate(){return GetTimelineState(this).GetPlaybackRate()}get progress(){const a=GetTimelineState(this);return a.GetTime()/a.GetTotalTime()}get tags(){return GetTimelineState(this).GetTags()}get finished(){return GetTimelineState(this).GetPlayPromise()}get isPlaying(){return GetTimelineState(this).IsPlaying()}get isPaused(){return GetTimelineState(this).IsPaused()}get isReleased(){return map$jscomp$15.get(this).IsReleased()}};"use strict";
const map$jscomp$16=new WeakMap;self.ITimelineState=class extends self.ITimelineStateBase{constructor(a){super(a);map$jscomp$16.set(this,a);a={name:{value:a.GetName(),writable:!1}};Object.defineProperties(this,a)}};"use strict";const C3X$jscomp$22=self.C3X,map$jscomp$17=new WeakMap,behInstMap=new WeakMap;let easeToIndexFunc$jscomp$1=null;function GetTweenState(a){a=map$jscomp$17.get(a);if(a.IsReleased())throw Error("tween was released and is no longer valid");return a}
self.ITweenState=class extends self.ITimelineStateBase{constructor(a,b,d){super(a);easeToIndexFunc$jscomp$1||(easeToIndexFunc$jscomp$1=d.easeToIndexFunc);map$jscomp$17.set(this,a);b&&behInstMap.set(this,b)}stop(){const a=GetTweenState(this);behInstMap.get(this).ReleaseTween(a)}setEase(a){C3X$jscomp$22.RequireString(a);a=self.Ease.GetEaseFromIndex(easeToIndexFunc$jscomp$1(a));GetTweenState(this).SetEase(a)}get instance(){const a=GetTweenState(this).GetInstance();return a?a.GetInterfaceClass():null}get isDestroyOnComplete(){return GetTweenState(this).GetDestroyInstanceOnComplete()}set isDestroyOnComplete(a){GetTweenState(this).SetDestroyInstanceOnComplete(!!a)}get value(){const a=
GetTweenState(this);if("value"!==a.GetId())throw Error("not a value tween");return a.GetPropertyTrack("value").GetSourceAdapterValue()}};"use strict";self.ISDKPluginBase=class extends self.IPlugin{constructor(){super()}};"use strict";const C3$jscomp$88=self.C3,C3X$jscomp$24=self.C3X,map$jscomp$18=new WeakMap,internalApiToken$jscomp$9=C3$jscomp$88._GetInternalAPIToken();
self.ISDKDOMPluginBase=class extends self.ISDKPluginBase{constructor(a){super();map$jscomp$18.set(this,C3$jscomp$88.AddonManager._GetInitObject2(internalApiToken$jscomp$9));if(!a?.domComponentId)throw Error("no DOM component ID specified");this._p_domComponentId=a.domComponentId;this._p_nextElementId=0;this._p_instMap=new Map;this._addElementMessageHandler("elem-focused",b=>b._onElemFocused());this._addElementMessageHandler("elem-blurred",b=>{b&&b._onElemBlurred()})}_addElement(a){const b=this._p_nextElementId++;
this._p_instMap.set(b,a);return b}_removeElement(a){this._p_instMap.delete(a)}_addElementMessageHandler(a,b){map$jscomp$18.get(this).GetRuntime().AddDOMComponentMessageHandler(this._p_domComponentId,a,d=>{const c=this._p_instMap.get(d.elementId);b(c,d)})}_addElementMessageHandlers(a){C3X$jscomp$24.RequireArray(a);for(const [b,d]of a)this._addElementMessageHandlers(b,d)}};"use strict";const C3$jscomp$89=self.C3,map$jscomp$19=new WeakMap,internalApiToken$jscomp$10=C3$jscomp$89._GetInternalAPIToken();
self.ISDKObjectTypeBase=class extends self.IObjectClass{constructor(){super();const a=C3$jscomp$89.AddonManager._GetInitObject2(internalApiToken$jscomp$10);map$jscomp$19.set(this,a)}_onCreate(){}getImageInfo(){return map$jscomp$19.get(this).GetImageInfo().GetIImageInfo()}_loadTextures(a){}_releaseTextures(a){}_onDynamicTextureLoadComplete(){}_preloadTexturesWithInstances(a){}};"use strict";const C3$jscomp$90=self.C3,map$jscomp$20=new WeakMap,internalApiToken$jscomp$11=C3$jscomp$90._GetInternalAPIToken();
self.ISDKWorldInstanceBase=class extends self.IWorldInstanceSDKBase{constructor(a){super(a);map$jscomp$20.set(this,C3$jscomp$90.AddonManager._GetInitObject2(internalApiToken$jscomp$11));this._p_renderercontextrestored_handler=this._p_renderercontextlost_handler=null}_release(){super._release();if(this._p_renderercontextlost_handler){const a=map$jscomp$20.get(this).GetRuntime().Dispatcher();a.removeEventListener("renderercontextlost",this._p_renderercontextlost_handler);a.removeEventListener("renderercontextrestored",
this._p_renderercontextrestored_handler);this._p_renderercontextrestored_handler=this._p_renderercontextlost_handler=null}map$jscomp$20.delete(this)}_handleRendererContextLoss(){if(!this._p_renderercontextlost_handler){this._p_renderercontextlost_handler=()=>this._onRendererContextLost();this._p_renderercontextrestored_handler=()=>this._onRendererContextRestored();var a=map$jscomp$20.get(this).GetRuntime().Dispatcher();a.addEventListener("renderercontextlost",this._p_renderercontextlost_handler);
a.addEventListener("renderercontextrestored",this._p_renderercontextrestored_handler)}}_onRendererContextLost(){}_onRendererContextRestored(){}_draw(a){}};"use strict";const C3$jscomp$91=self.C3,tempRect$jscomp$3=C3$jscomp$91.New(C3$jscomp$91.Rect),map$jscomp$21=new WeakMap,internalApiToken$jscomp$12=C3$jscomp$91._GetInternalAPIToken();
self.ISDKDOMInstanceBase=class extends self.ISDKWorldInstanceBase{constructor(a){if(!a?.domComponentId)throw Error("no DOM component ID specified");super(a);a=C3$jscomp$91.AddonManager._GetInitObject2(internalApiToken$jscomp$12);map$jscomp$21.set(this,a);this._p_elementId=this.plugin._addElement(this);this._p_isElementShowing=!0;this._p_autoFontSize=this._p_elemHasFocus=!1;this._p_autoFontSizeOffset=-.2;this._p_lastRect=C3$jscomp$91.New(C3$jscomp$91.Rect,0,0,-1,-1);a=a.GetRuntime().GetCanvasManager();
this._p_lastWindowWidth=a.GetLastWidth();this._p_lastWindowHeight=a.GetLastHeight();this._p_lastHTMLZIndex=this._p_lastHTMLIndex=-1;this._p_isPendingUpdateState=!1;this._setTicking(!0)}_release(){super._release();this.plugin._removeElement(this._p_elementId);this._postToDOMElement("destroy");this._p_elementId=-1;map$jscomp$21.delete(this)}_getElementInDOMMode(){if(map$jscomp$21.get(this).GetRuntime().IsInWorker())throw Error("not valid in worker mode");return this._postToDOMElementMaybeSync("get-element")}_postToDOMElement(a,
b){b||(b={});b.elementId=this._p_elementId;this._postToDOM(a,b)}_postToDOMElementMaybeSync(a,b){b||(b={});b.elementId=this._p_elementId;return this._postToDOMMaybeSync(a,b)}_postToDOMElementAsync(a,b){b||(b={});b.elementId=this._p_elementId;return this._postToDOMAsync(a,b)}_createElement(a){a||(a={});const b=map$jscomp$21.get(this).GetWorldInfo();a.elementId=this._p_elementId;a.isVisible=b.IsVisible();a.htmlIndex=b.GetLayer().GetHTMLIndex();a.htmlZIndex=b.GetHTMLZIndex();Object.assign(a,this._getElementState());
this._p_isElementShowing=!!a.isVisible;this._postToDOMMaybeSync("create",a);this._updatePosition(!0)}setElementVisible(a){a=!!a;this._p_isElementShowing!==a&&(this._p_isElementShowing=a,this._postToDOMElement("set-visible",{isVisible:a}))}_tick(){this._updatePosition(!1)}_shouldPreserveElement(){const a=map$jscomp$21.get(this).GetRuntime().GetCanvasManager().GetFullscreenMode();return"Android"===C3$jscomp$91.Platform.OS&&("scale-inner"===a||"scale-outer"===a||"crop"===a)}_updatePosition(a){var b=
map$jscomp$21.get(this);if(!b.IsDestroyed()){var d=b.GetWorldInfo(),c=d.GetLayer(),e=d.GetBoundingBox(),[g,k]=c.LayerToCanvasCss(e.getLeft(),e.getTop()),[l,n]=c.LayerToCanvasCss(e.getRight(),e.getBottom());e=b.GetRuntime().GetCanvasManager();b=e.GetCssWidth();var p=e.GetCssHeight();d.IsVisible()&&c.IsVisible()?!this._shouldPreserveElement()&&(0>=l||0>=n||g>=b||k>=p)?this.setElementVisible(!1):(tempRect$jscomp$3.set(g,k,l,n),b=e.GetLastWidth(),p=e.GetLastHeight(),e=c.GetHTMLIndex(),d=d.GetHTMLZIndex(),
!a&&tempRect$jscomp$3.equals(this._p_lastRect)&&this._p_lastWindowWidth===b&&this._p_lastWindowHeight===p&&this._p_lastHTMLIndex===e&&this._p_lastHTMLZIndex===d?this.setElementVisible(!0):(this._p_lastRect.copy(tempRect$jscomp$3),this._p_lastWindowWidth=b,this._p_lastWindowHeight=p,this._p_lastHTMLIndex=e,this._p_lastHTMLZIndex=d,this.setElementVisible(!0),a=null,this._p_autoFontSize&&(a=c.GetDisplayScale()+this._p_autoFontSizeOffset),this._postToDOMElement("update-position",{left:Math.round(this._p_lastRect.getLeft()),
top:Math.round(this._p_lastRect.getTop()),width:Math.round(this._p_lastRect.width()),height:Math.round(this._p_lastRect.height()),htmlIndex:e,htmlZIndex:d,fontSize:a}))):this.setElementVisible(!1)}}focusElement(){this._postToDOMElementMaybeSync("focus",{focus:!0})}blurElement(){this._postToDOMElementMaybeSync("focus",{focus:!1})}_onElemFocused(){this._p_elemHasFocus=!0}_onElemBlurred(){this._p_elemHasFocus=!1}isElementFocused(){return this._p_elemHasFocus}setElementCSSStyle(a,b){this.postToDOMElement("set-css-style",
{prop:C3$jscomp$91.CSSToCamelCase(a),val:b})}setElementAttribute(a,b){this.postToDOMElement("set-attribute",{name:a,val:b})}removeElementAttribute(a){this.postToDOMElement("remove-attribute",{name:a})}_updateElementState(){this._p_isPendingUpdateState||(this._p_isPendingUpdateState=!0,Promise.resolve().then(()=>{this._p_isPendingUpdateState=!1;this._postToDOMElement("update-state",this._getElementState())}))}_getElementState(){}_getElementId(){return this._p_elementId}};"use strict";
self.ISDKBehaviorBase=class extends self.IBehavior{constructor(){super()}};"use strict";self.ISDKBehaviorTypeBase=class extends globalThis.IBehaviorType{constructor(){super()}_onCreate(){}};"use strict";const C3$jscomp$94=self.C3,map$jscomp$22=new WeakMap,internalApiToken$jscomp$13=C3$jscomp$94._GetInternalAPIToken();
self.ISDKBehaviorInstanceBase=class extends self.IBehaviorInstance{constructor(){super();map$jscomp$22.set(this,C3$jscomp$94.AddonManager._GetInitObject2(internalApiToken$jscomp$13));this._p_isPostTicking=this._p_isTicking2=this._p_isTicking=!1}_release(){super._release();this._setTicking(!1);this._setTicking2(!1);this._setPostTicking(!1);map$jscomp$22.delete(this)}_getInitProperties(){return C3$jscomp$94.AddonManager._GetInitProperties()}_postCreate(){}_trigger(a){const b=map$jscomp$22.get(this);
b.GetRuntime().Trigger(a,b.GetObjectInstance(),b.GetBehaviorType())}_setTicking(a){a=!!a;if(this._p_isTicking!==a){this._p_isTicking=a;var b=map$jscomp$22.get(this).GetRuntime();a?b._AddBehInstToTick(this):b._RemoveBehInstToTick(this)}}_isTicking(){return this._p_isTicking}_tick(){}_setTicking2(a){a=!!a;if(this._p_isTicking2!==a){this._p_isTicking2=a;var b=map$jscomp$22.get(this).GetRuntime();a?b._AddBehInstToTick2(this):b._RemoveBehInstToTick2(this)}}_isTicking2(){return this._p_isTicking2}_tick2(){}_setPostTicking(a){a=
!!a;if(this._p_isPostTicking!==a){this._p_isPostTicking=a;var b=map$jscomp$22.get(this).GetRuntime();a?b._AddBehInstToPostTick(this):b._RemoveBehInstToPostTick(this)}}_isPostTicking(){return this._p_isPostTicking}_postTick(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(a){}};"use strict";const C3$jscomp$95=self.C3,C3X$jscomp$31=self.C3X;let renderer$jscomp$57=null,runtime$jscomp$29=null;
self.IRenderer=class{constructor(a,b){runtime$jscomp$29=a;renderer$jscomp$57=b}setAlphaBlendMode(){renderer$jscomp$57.SetAlphaBlend()}setBlendMode(a){renderer$jscomp$57.SetNamedBlendMode(a)}setColorFillMode(){renderer$jscomp$57.SetColorFillMode()}setTextureFillMode(){renderer$jscomp$57.SetTextureFillMode()}setSmoothLineFillMode(){renderer$jscomp$57.SetSmoothLineFillMode()}setColor(a){renderer$jscomp$57.SetColorRgba(a[0],a[1],a[2],a[3])}setColorRgba(a,b,d,c){renderer$jscomp$57.SetColorRgba(a,b,d,c)}resetColor(){renderer$jscomp$57.ResetColor()}setOpacity(a){renderer$jscomp$57.SetOpacity(a)}setCurrentZ(a){renderer$jscomp$57.SetCurrentZ(a)}getCurrentZ(){renderer$jscomp$57.GetCurrentZ()}rect(a){renderer$jscomp$57.Rect2(a.left,
a.top,a.right,a.bottom)}rect2(a,b,d,c){renderer$jscomp$57.Rect2(a,b,d,c)}quad(a){renderer$jscomp$57.Quad(C3$jscomp$95.Quad.fromDOMQuad(a))}quad2(a,b,d,c,e,g,k,l){renderer$jscomp$57.Quad2(a,b,d,c,e,g,k,l)}quad3(a,b){renderer$jscomp$57.Quad3(C3$jscomp$95.Quad.fromDOMQuad(a),C3$jscomp$95.Rect.fromDOMRect(b))}quad4(a,b){renderer$jscomp$57.Quad4(C3$jscomp$95.Quad.fromDOMQuad(a),C3$jscomp$95.Quad.fromDOMQuad(b))}quad3D(a,b,d,c,e,g,k,l,n,p,r,w,z){renderer$jscomp$57.Quad3D(a,b,d,c,e,g,k,l,n,p,r,w,C3$jscomp$95.Rect.fromDOMRect(z))}quad3D2(a,
b,d,c,e,g,k,l,n,p,r,w,z){renderer$jscomp$57.Quad3D2(a,b,d,c,e,g,k,l,n,p,r,w,C3$jscomp$95.Quad.fromDOMQuad(z))}drawMesh(a,b,d){renderer$jscomp$57.DrawMesh(a,b,d)}convexPoly(a){renderer$jscomp$57.ConvexPoly(a)}line(a,b,d,c){renderer$jscomp$57.Line(a,b,d,c)}texturedLine(a,b,d,c,e,g){renderer$jscomp$57.TexturedLine(a,b,d,c,e,g)}lineRect(a,b,d,c){renderer$jscomp$57.LineRect(a,b,d,c)}lineRect2(a){renderer$jscomp$57.LineRect2(C3$jscomp$95.Rect.fromDOMRect(a))}lineQuad(a){renderer$jscomp$57.LineQuad(C3$jscomp$95.Quad.fromDOMQuad(a))}pushLineWidth(a){renderer$jscomp$57.PushLineWidth(a)}popLineWidth(){renderer$jscomp$57.PopLineWidth()}pushLineCap(a){renderer$jscomp$57.PushLineCap(a)}popLineCap(){renderer$jscomp$57.PopLineCap()}setTexture(a){C3X$jscomp$31.RequireOptionalInstanceOf(a,
self.ITexture);a=a?runtime$jscomp$29._UnwrapScriptInterface(a):null;renderer$jscomp$57.SetTexture(a)}loadTextureForImageInfo(a,b){a=self.IImageInfo._Unwrap(a);if(!a)throw Error("invalid IImageInfo");return a.LoadStaticTexture(renderer$jscomp$57,{wrapX:b?.wrapX??"clamp-to-edge",wrapY:b?.wrapY??"clamp-to-edge",sampling:b?.sampling??"trilinear",mipMap:b?.mipMap??!0})}releaseTextureForImageInfo(a){a=self.IImageInfo._Unwrap(a);if(!a)throw Error("invalid IImageInfo");a.ReleaseTexture()}getTextureForImageInfo(a){a=
self.IImageInfo._Unwrap(a);if(!a)throw Error("invalid IImageInfo");a=a.GetTexture();return self.ITexture.GetInterface(runtime$jscomp$29,a)}createDynamicTexture(a,b,d){C3X$jscomp$31.RequireFiniteNumber(a);C3X$jscomp$31.RequireFiniteNumber(b);a=renderer$jscomp$57.CreateDynamicTexture(a,b,{wrapX:d?.wrapX??"clamp-to-edge",wrapY:d?.wrapY??"clamp-to-edge",sampling:d?.sampling??"trilinear",mipMap:d?.mipMap??!0});return self.ITexture.GetInterface(runtime$jscomp$29,a)}updateTexture(a,b,d){C3X$jscomp$31.RequireInstanceOf(b,
self.ITexture);b=runtime$jscomp$29._UnwrapScriptInterface(b);renderer$jscomp$57.UpdateTexture(a,b,{premultiplyAlpha:d?.premultiplyAlpha??!0})}deleteTexture(a){C3X$jscomp$31.RequireInstanceOf(a,self.ITexture);a=runtime$jscomp$29._UnwrapScriptInterface(a);renderer$jscomp$57.DeleteTexture(a)}createRendererText(){const a=renderer$jscomp$57.CreateRendererText();return new self.IRendererText(runtime$jscomp$29,a)}setDeviceTransform(){runtime$jscomp$29.GetCanvasManager().SetDeviceTransform(renderer$jscomp$57)}setLayerTransform(a){C3X$jscomp$31.RequireInstanceOf(a,
globalThis.ILayer);runtime$jscomp$29._UnwrapScriptInterface(a)._SetTransform(renderer$jscomp$57)}};"use strict";const map$jscomp$23=new WeakMap,reverseMap=new WeakMap;
self.ITexture=class{constructor(a,b){map$jscomp$23.set(this,{runtime:a,texture:b});reverseMap.set(b,this);a._MapScriptInterface(this,b);Object.defineProperties(this,{width:{value:b.GetWidth(),writable:!1},height:{value:b.GetHeight(),writable:!1}})}static GetInterface(a,b){if(!b)return null;const d=reverseMap.get(b);return d?d:new self.ITexture(a,b)}};"use strict";const C3X$jscomp$33=self.C3X,map$jscomp$24=new WeakMap;function getActual(a){return map$jscomp$24.get(a).rendererText}
self.IRendererText=class{constructor(a,b){map$jscomp$24.set(this,{runtime:a,rendererText:b});a._MapScriptInterface(this,b)}release(){getActual(this).Release()}set fontFace(a){C3X$jscomp$33.RequireString(a);getActual(this).SetFontName(a)}get fontFace(){return getActual(this).GetFontName()}set sizePt(a){C3X$jscomp$33.RequireFiniteNumber(a);getActual(this).SetFontSize(a)}get sizePt(){return getActual(this).GetFontSize()}set lineHeight(a){C3X$jscomp$33.RequireFiniteNumber(a);getActual(this).SetLineHeight(a)}get lineHeight(){return getActual(this).GetLineHeight()}set isBold(a){getActual(this).SetBold(a)}get isBold(){return getActual(this).IsBold()}set isItalic(a){getActual(this).SetItalic(a)}get isItalic(){return getActual(this).IsItalic()}setColor(a){C3X$jscomp$33.RequireArray(a);
this.setColorRgb(a[0],a[1],a[2])}setColorRgb(a,b,d){getActual(this).SetColorRgb(a,b,d)}setCssColor(a){C3X$jscomp$33.RequireString(a);getActual(this).SetColor(a)}set horizontalAlign(a){getActual(this).SetHorizontalAlignment(a)}get horizontalAlign(){return getActual(this).GetHorizontalAlignment()}set verticalAlign(a){getActual(this).SetVerticalAlignment(a)}get verticalAlign(){return getActual(this).GetVerticalAlignment()}set wordWrapMode(a){getActual(this).SetWordWrapMode(a)}get wordWrapMode(){return getActual(this).GetWordWrapMode()}set textDirection(a){getActual(this).SetTextDirection(a)}get textDirection(){return getActual(this).GetTextDirection()}set text(a){C3X$jscomp$33.RequireString(a);
getActual(this).SetText(a)}get text(){return getActual(this).GetText()}setSize(a,b,d){C3X$jscomp$33.RequireFiniteNumber(a);C3X$jscomp$33.RequireFiniteNumber(b);C3X$jscomp$33.RequireFiniteNumber(d);getActual(this).SetSize(a,b,d)}getTexture(){const {runtime:a,rendererText:b}=map$jscomp$24.get(this),d=b.GetTexture();return self.ITexture.GetInterface(a,d)}getTexRect(){return getActual(this).GetTexRect().toDOMRect()}setTextureUpdateCallback(a){C3X$jscomp$33.RequireFunction(a);getActual(this).ontextureupdate=
a}releaseTexture(){getActual(this).ReleaseTexture()}get textWidth(){return getActual(this).GetTextWidth()}get textHeight(){return getActual(this).GetTextHeight()}};"use strict";const C3$jscomp$98=self.C3,VALID_LOAD_POLICIES=new Set(["local","remote"]),EXT_TO_TYPE=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);
function GetTypeFromFileExtension(a){if(!a)return"";a=a.split(".");if(2>a.length)return"";a=a.at(-1).toLowerCase();return EXT_TO_TYPE.get(a)||""}function AddScript(a){return new Promise((b,d)=>{const c=document.createElement("script");c.onload=b;c.onerror=d;c.async=!1;c.type="module";c.src=a;document.head.appendChild(c)})}
C3$jscomp$98.AssetManager=class extends C3$jscomp$98.DefendedBase{constructor(a,b){super();var d=b.exportType;this._runtime=a;this._fileStructure="folders";this._localUrlBlobs=new Map;this._localBlobUrlCache=new Map;this._localBlobSWUrls=new Map;this._isCordova="cordova"===d;this._isiOSCordova=!!b.isiOSCordova;this._isFileProtocol=!!b.isFileProtocol;this._swClientId=b.swClientId;this._supportedAudioFormats=b.supportedAudioFormats||{};this._audioFiles=new Map;this._preloadSounds=!1;this._iconsSubfolder=
this._fontsSubfolder=this._mediaSubfolder="";this._defaultLoadPolicy="html5"===d||"scirra-arcade"===d||"instant-games"===d?"remote":"local";this._assetsByUrl=new Map;this._webFonts=[];this._loadPromises=[];this._hasFinishedInitialLoad=!1;this._lastLoadProgress=this._assetSizeLoaded=this._totalAssetSizeToLoad=0;this._hasHadErrorLoading=!1;this._loadingRateLimiter=C3$jscomp$98.New(C3$jscomp$98.RateLimiter,()=>this._FireLoadingProgressEvent(),50);this._localPromiseThrottle=C3$jscomp$98.New(C3$jscomp$98.PromiseThrottle,
Math.max(C3$jscomp$98.hardwareConcurrency,8));this._remotePromiseThrottle=C3$jscomp$98.New(C3$jscomp$98.PromiseThrottle,20);if(a=b.previewImageBlobs){(d=b.previewProjectFileBlobs)&&Object.assign(a,d);(d=b.projectData)&&(a["data.json"]=d);for(const [c,e]of Object.entries(a))this._localUrlBlobs.set(c,e)}if(b=b.previewProjectFileSWUrls)for(const [c,e]of Object.entries(b))this._localBlobSWUrls.set(c,e);this._iAssetManager=new self.IAssetManager(this)}Release(){this._localUrlBlobs.clear();for(const a of this._localBlobUrlCache.values())a.startsWith("blob:")&&
URL.revokeObjectURL(a);this._localBlobUrlCache.clear();for(const a of this._assetsByUrl.values())a.Release();this._assetsByUrl.clear();C3$jscomp$98.clearArray(this._loadPromises);this._runtime=null}GetRuntime(){return this._runtime}_SetFileStructure(a){this._fileStructure=a;if("flat"===a){a=new Map;for(const [b,d]of this._localUrlBlobs.entries())a.set(b.toLowerCase(),d);this._localUrlBlobs=a}}GetFileStructure(){return this._fileStructure}_SetMediaSubfolder(a){this._mediaSubfolder=a}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(a){this._fontsSubfolder=
a}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(a){this._iconsSubfolder=a}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}_HasLocalUrlBlob(a){"flat"===this._fileStructure&&(a=a.toLowerCase());return this._localUrlBlobs.has(a)}_GetLocalUrlBlob(a){"flat"===this._fileStructure&&(a=a.toLowerCase());return this._localUrlBlobs.get(a)||null}GetLocalUrlAsBlobUrl(a){"flat"===this._fileStructure&&(a=a.toLowerCase());if(!this._HasLocalUrlBlob(a))return a;
var b=this._localBlobUrlCache.get(a);b||(b=this._GetLocalUrlBlob(a),b=URL.createObjectURL(b),this._localBlobUrlCache.set(a,b));return b}FetchBlob(a,b){b=b||this._defaultLoadPolicy;const d=this._GetLocalUrlBlob(a);return d?Promise.resolve(d):C3$jscomp$98.IsRelativeURL(a)?("flat"===this._fileStructure&&(a=a.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlob(a):"local"===b?this._localPromiseThrottle.Add(()=>C3$jscomp$98.FetchBlob(a)):this._remotePromiseThrottle.Add(()=>
C3$jscomp$98.FetchBlob(a))):C3$jscomp$98.FetchBlob(a)}FetchArrayBuffer(a){const b=this._GetLocalUrlBlob(a);return b?C3$jscomp$98.BlobToArrayBuffer(b):C3$jscomp$98.IsRelativeURL(a)?("flat"===this._fileStructure&&(a=a.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsArrayBuffer(a):"local"===this._defaultLoadPolicy?this._localPromiseThrottle.Add(()=>C3$jscomp$98.FetchArrayBuffer(a)):this._remotePromiseThrottle.Add(()=>C3$jscomp$98.FetchArrayBuffer(a))):C3$jscomp$98.FetchArrayBuffer(a)}FetchText(a){const b=
this._GetLocalUrlBlob(a);return b?C3$jscomp$98.BlobToString(b):C3$jscomp$98.IsRelativeURL(a)?("flat"===this._fileStructure&&(a=a.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsText(a):"local"===this._defaultLoadPolicy?this._localPromiseThrottle.Add(()=>C3$jscomp$98.FetchText(a)):this._remotePromiseThrottle.Add(()=>C3$jscomp$98.FetchText(a))):C3$jscomp$98.FetchText(a)}async FetchJson(a){a=await this.FetchText(a);return JSON.parse(a)}_CordovaFetchLocalFileAs(a,b){"flat"===
this._fileStructure&&(a=a.toLowerCase());return this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{filename:a,as:b})}CordovaFetchLocalFileAsText(a){return this._CordovaFetchLocalFileAs(a,"text")}async CordovaFetchLocalFileAsBlob(a){const b=await this._CordovaFetchLocalFileAs(a,"buffer");a=GetTypeFromFileExtension(a);return new Blob([b],{type:a})}async CordovaFetchLocalFileAsBlobURL(a){"flat"===this._fileStructure&&(a=a.toLowerCase());var b=this._localBlobUrlCache.get(a);
if(b)return b;b=await this.CordovaFetchLocalFileAsBlob(a);b=URL.createObjectURL(b);this._localBlobUrlCache.set(a,b);return b}CordovaFetchLocalFileAsArrayBuffer(a){return this._CordovaFetchLocalFileAs(a,"buffer")}GetMediaFileUrl(a){"flat"===this._fileStructure&&(a=a.toLowerCase());a=this._mediaSubfolder+a;return this._HasLocalUrlBlob(a)?this.GetLocalUrlAsBlobUrl(a):a}GetProjectFileUrl(a){if(C3$jscomp$98.IsAbsoluteURL(a))return Promise.resolve(a);if(this._HasLocalUrlBlob(a))return Promise.resolve(this.GetLocalUrlAsBlobUrl(a));
if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlobURL(a);"flat"===this._fileStructure&&(a=a.toLowerCase());return Promise.resolve(a)}GetProjectFileIframeUrl(a){if(C3$jscomp$98.IsAbsoluteURL(a))return Promise.resolve(a);var b=a.indexOf("?"),d=-1===b?"":a.substr(b);b=-1===b?a:a.substr(0,b);if(this._HasLocalUrlBlob(b))return a=this._localBlobSWUrls.get(b)||this.GetLocalUrlAsBlobUrl(b),!a.startsWith("blob:")&&this._swClientId&&(a=new URL(a),d=new URLSearchParams(d),d.set("__c3_client_id",
this._swClientId),a.search=d.toString(),a=a.toString()),Promise.resolve(a);if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlobURL(b);"flat"===this._fileStructure&&(a=a.toLowerCase());return Promise.resolve(a)}LoadProjectFileUrl(a){return this.GetProjectFileUrl(a)}LoadImage(a){if(a.loadPolicy&&!VALID_LOAD_POLICIES.has(a.loadPolicy))throw Error("invalid load policy");let b=this._assetsByUrl.get(a.url);if(b)return b;b=C3$jscomp$98.New(C3$jscomp$98.ImageAsset,this,{url:a.url,
size:a.size||0,loadPolicy:a.loadPolicy||this._defaultLoadPolicy});this._assetsByUrl.set(b.GetURL(),b);this._hasFinishedInitialLoad||(this._totalAssetSizeToLoad+=b.GetSize(),this._loadPromises.push(b.Load().then(()=>this._AddLoadedSize(b.GetSize()))));return b}_ReleaseAsset(a){this._assetsByUrl.delete(a.GetURL())}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises),this._lastLoadProgress=1}catch(a){console.error("Error loading: ",a),this._hasHadErrorLoading=!0,this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=
!0}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(a){this._assetSizeLoaded+=a;this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){const a=C3$jscomp$98.New(C3$jscomp$98.Event,"loadingprogress");this._lastLoadProgress=C3$jscomp$98.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1);a.progress=this._lastLoadProgress;this._runtime.Dispatcher().dispatchEvent(a)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(a){C3$jscomp$98.shallowAssignArray(this._webFonts,
a);this._webFonts.length&&this._loadPromises.push(this._LoadWebFonts())}async _LoadWebFonts(){const a=[],b=[];for(const [d,c,e]of this._webFonts)this._totalAssetSizeToLoad+=e,a.push(this._LoadWebFont(d,c,b).then(()=>this._AddLoadedSize(e)));await Promise.all(a);this._runtime.IsInWorker()&&0<b.length&&await this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{webfonts:b})}async _LoadWebFont(a,b,d){try{const c=await this.GetProjectFileUrl(b);"Gecko"===C3$jscomp$98.Platform.BrowserEngine&&
(a=`'${a}'`);const e=new FontFace(a,`url('${c}')`);this._runtime.IsInWorker()?self.fonts.add(e):document.fonts.add(e);await e.load();this._runtime.IsInWorker()&&d.push({name:a,url:c})}catch(c){console.warn(`[C3 runtime] Failed to load web font '${a}': `,c)}}IsAudioFormatSupported(a){return!!this._supportedAudioFormats[a]}_SetAudioFiles(a,b){this._preloadSounds=!!b;for(const [d,c,e]of a)this._audioFiles.set(d,{fileName:d,formats:c.map(g=>({type:g[0],fileExtension:g[1],fullName:d+g[1],fileSize:g[2]})),
isMusic:e})}GetPreferredAudioFile(a){"flat"===this._fileStructure&&(a=a.toLowerCase());a=this._audioFiles.get(a);if(!a)return null;let b=null;for(const d of a.formats)if(b||"audio/webm; codecs=opus"!==d.type||(b=d),this.IsAudioFormatSupported(d.type))return d;return b}GetProjectAudioFileUrl(a){return(a=this.GetPreferredAudioFile(a))?{url:this.GetMediaFileUrl(a.fullName),type:a.type}:null}GetAudioToPreload(){if(this._preloadSounds){const a=[];for(const b of this._audioFiles.values()){if(b.isMusic)continue;
const d=this.GetPreferredAudioFile(b.fileName);d&&a.push({originalUrl:b.fileName,url:this.GetMediaFileUrl(d.fullName),type:d.type,fileSize:d.fileSize})}return a}return[]}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...a){const b=await Promise.all(a.map(d=>this.GetProjectFileUrl(d)));this._runtime.IsInWorker()?1===a.length?(a=a[0],await self.c3_import((C3$jscomp$98.IsRelativeURL(a)?"./":"")+a)):(a=a.map(d=>`import "${C3$jscomp$98.IsRelativeURL(d)?"./":""}${d}";`).join("\n"),a=URL.createObjectURL(new Blob([a],
{type:"application/javascript"})),await self.c3_import(a)):await Promise.all(b.map(d=>AddScript(d)))}async CompileWebAssembly(a){if(WebAssembly.compileStreaming)return a=await this.GetProjectFileUrl(a),await WebAssembly.compileStreaming(fetch(a));a=await C3$jscomp$98.FetchArrayBuffer(a);return await WebAssembly.compile(a)}async LoadStyleSheet(a){a=await this.GetProjectFileUrl(a);return await this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{url:a})}};"use strict";
const C3$jscomp$99=self.C3;
C3$jscomp$99.Asset=class extends C3$jscomp$99.DefendedBase{constructor(a,b){super();this._assetManager=a;this._runtime=a.GetRuntime();this._url=b.url||"";this._size=b.size;this._loadPolicy=b.loadPolicy;this._blob=b.blob||null;this._isLoaded=!!this._blob;this._loadPromise=null}Release(){this._blob=this._runtime=this._assetManager=this._loadPromise=null}GetURL(){return this._url}GetSize(){return this._size}Load(){return"local"===this._loadPolicy||this._blob?(this._isLoaded=!0,Promise.resolve()):this._loadPromise?
this._loadPromise:this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then(a=>{this._isLoaded=!0;this._loadPromise=null;return this._blob=a}).catch(a=>{console.error("Error loading resource: ",a);this._loadPromise=null})}IsLoaded(){return this._isLoaded}GetBlob(){return this._blob?Promise.resolve(this._blob):this._loadPromise?this._loadPromise:this._assetManager.FetchBlob(this._url,this._loadPolicy)}};"use strict";
const C3$jscomp$100=self.C3,promiseThrottle=new C3$jscomp$100.PromiseThrottle,allImageAssets=new Set;
C3$jscomp$100.ImageAsset=class extends C3$jscomp$100.Asset{constructor(a,b){super(a,b);this._webglTexture=this._texturePromise=null;this._refCount=0;this._imageHeight=this._imageWidth=-1;allImageAssets.add(this)}Release(){if(0!==this._refCount)throw Error("released image asset which still has texture references");this._assetManager._ReleaseAsset(this);this._texturePromise=null;allImageAssets.delete(this);super.Release()}static OnRendererContextLost(){for(const a of allImageAssets)a._texturePromise=
null,a._webglTexture=null,a._refCount=0}LoadStaticTexture(a,b){b=b||{};this._refCount++;if(this._webglTexture)return Promise.resolve(this._webglTexture);if(this._texturePromise)return this._texturePromise;b.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy();return this._texturePromise=this._DoLoadStaticTexture(a,b)}async _DoLoadStaticTexture(a,b){try{const d=await this.GetBlob();return 0===this._refCount?null:await promiseThrottle.Add(async()=>{const c=await a.CreateStaticTextureAsync(d,
b);this._texturePromise=null;if(0===this._refCount)return a.DeleteTexture(c),null;this._webglTexture=c;this._imageWidth=c.GetWidth();this._imageHeight=c.GetHeight();return this._webglTexture})}catch(d){throw console.error("Failed to load texture: ",d),d;}}ReleaseTexture(){if(0>=this._refCount)throw Error("texture released too many times");this._refCount--;0===this._refCount&&this._webglTexture&&(this._webglTexture.GetRenderer().DeleteTexture(this._webglTexture),this._webglTexture=null)}GetRefCount(){return this._refCount}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){const a=
await this.GetBlob();return C3$jscomp$100.Supports.ImageBitmap?await createImageBitmap(a):await C3$jscomp$100.BlobToImage(a)}};"use strict";const C3$jscomp$101=self.C3;function SortByInstLastCachedZIndex(a,b){return a.GetWorldInfo()._GetLastCachedZIndex()-b.GetWorldInfo()._GetLastCachedZIndex()}
C3$jscomp$101.RenderCell=class extends C3$jscomp$101.DefendedBase{constructor(a,b,d){super();this._grid=a;this._x=b;this._y=d;this._instances=[];this._isSorted=!0;this._pendingRemoval=new Set;this._isAnyPendingRemoval=!1}Release(){C3$jscomp$101.clearArray(this._instances);this._pendingRemoval.clear();this._grid=null}Reset(){C3$jscomp$101.clearArray(this._instances);this._isSorted=!0;this._pendingRemoval.clear();this._isAnyPendingRemoval=!1}SetChanged(){this._isSorted=!1}IsEmpty(){if(!this._instances.length)return!0;
if(this._instances.length>this._pendingRemoval.size)return!1;this._FlushPending();return!0}Insert(a){this._pendingRemoval.has(a)?(this._pendingRemoval.delete(a),0===this._pendingRemoval.size&&(this._isAnyPendingRemoval=!1)):(this._instances.push(a),this._isSorted=1===this._instances.length)}Remove(a){this._pendingRemoval.add(a);this._isAnyPendingRemoval=!0;50<=this._pendingRemoval.size&&this._FlushPending()}_FlushPending(){this._isAnyPendingRemoval&&(this._instances.length===this._pendingRemoval.size?
this.Reset():(C3$jscomp$101.arrayRemoveAllInSet(this._instances,this._pendingRemoval),this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1))}_EnsureSorted(){this._isSorted||(this._instances.sort(SortByInstLastCachedZIndex),this._isSorted=!0)}Dump(a){this._FlushPending();this._EnsureSorted();this._instances.length&&a.push(this._instances)}};"use strict";const C3$jscomp$102=self.C3;
C3$jscomp$102.RenderGrid=class extends C3$jscomp$102.DefendedBase{constructor(a,b){super();this._cellWidth=a;this._cellHeight=b;this._cells=C3$jscomp$102.New(C3$jscomp$102.PairMap)}Release(){this._cells.Release();this._cells=null}GetCell(a,b,d){let c=this._cells.Get(a,b);return c?c:d?(c=C3$jscomp$102.New(C3$jscomp$102.RenderCell,this,a,b),this._cells.Set(a,b,c),c):null}XToCell(a){return Math.floor(a/this._cellWidth)}YToCell(a){return Math.floor(a/this._cellHeight)}Update(a,b,d){if(b)for(let c=b.getLeft(),
e=b.getRight();c<=e;++c)for(let g=b.getTop(),k=b.getBottom();g<=k;++g){if(d&&d.containsPoint(c,g))continue;const l=this.GetCell(c,g,!1);l&&(l.Remove(a),l.IsEmpty()&&this._cells.Delete(c,g))}if(d)for(let c=d.getLeft(),e=d.getRight();c<=e;++c)for(let g=d.getTop(),k=d.getBottom();g<=k;++g)b&&b.containsPoint(c,g)||this.GetCell(c,g,!0).Insert(a)}QueryRange(a,b){let d=this.XToCell(a.getLeft());const c=this.YToCell(a.getTop()),e=this.XToCell(a.getRight());for(a=this.YToCell(a.getBottom());d<=e;++d)for(let g=
c;g<=a;++g){const k=this.GetCell(d,g,!1);k&&k.Dump(b)}}MarkRangeChanged(a){let b=a.getLeft();const d=a.getTop(),c=a.getRight();for(a=a.getBottom();b<=c;++b)for(let e=d;e<=a;++e){const g=this.GetCell(b,e,!1);g&&g.SetChanged()}}};"use strict";const C3$jscomp$103=self.C3,tmpRect$jscomp$2=new C3$jscomp$103.Rect,tmpQuad$jscomp$2=new C3$jscomp$103.Quad,renderCellArr=[];new C3$jscomp$103.Rect;new C3$jscomp$103.Rect;
const glMatrix$jscomp$8=self.glMatrix,vec3$jscomp$6=glMatrix$jscomp$8.vec3,vec4$jscomp$5=glMatrix$jscomp$8.vec4,mat4$jscomp$9=glMatrix$jscomp$8.mat4,tempMat4$jscomp$4=mat4$jscomp$9.create(),tempVec3=vec3$jscomp$6.create(),tempVec4$jscomp$1=vec4$jscomp$5.create(),camVector=vec3$jscomp$6.create(),lookVector=vec3$jscomp$6.create(),upVector=vec3$jscomp$6.create(),tempVec2=C3$jscomp$103.New(C3$jscomp$103.Vector2);C3$jscomp$103.New(C3$jscomp$103.Rect);
function SortByInstLastCachedZIndex$jscomp$1(a,b){return a.GetWorldInfo()._GetLastCachedZIndex()-b.GetWorldInfo()._GetLastCachedZIndex()}function SortByInstZElevation(a,b){return a.GetWorldInfo().GetZElevation()-b.GetWorldInfo().GetZElevation()}
const tempInstanceList1=[],tempInstanceList2=[],tempInstancesByCameraDist=[],DEFAULT_LAYER_OPTIONS={name:"",sid:-1,isDynamic:!1,isVisible:!0,isInteractive:!0,isHTMLElementsLayer:!1,backgroundColor:[1,1,1,1],isTransparent:!0,parallax:[1,1],opacity:1,isForceOwnTexture:!1,renderAs3d:!1,useCameraDistanceDrawOrder:!1,useRenderCells:!1,scaleRate:1,blendMode:0,zElevation:0,initialInstancesData:[],effectListData:[],subLayersData:[]};
C3$jscomp$103.Layer=class extends C3$jscomp$103.DefendedBase{constructor(a,b,d){super();d=Object.assign({},DEFAULT_LAYER_OPTIONS,d);this._layout=a;this._runtime=a.GetRuntime();this._parentLayer=b;this._name=d.name;this._index=-1;this._isHTMLElementsLayer=!!d.isHTMLElementsLayer;this._htmlIndex=-1;this._sid=d.sid;this._isDynamic=!!d.isDynamic;this._isVisible=!!d.isVisible;this._isInteractive=!!d.isInteractive;this._backgroundColor=C3$jscomp$103.New(C3$jscomp$103.Color);this._backgroundColor.setFromJSON(d.backgroundColor);
this._isTransparent=!!d.isTransparent;this._parallaxX=d.parallax[0];this._parallaxY=d.parallax[1];this._color=C3$jscomp$103.New(C3$jscomp$103.Color,1,1,1,d.opacity);this._premultipliedColor=C3$jscomp$103.New(C3$jscomp$103.Color);this._isForceOwnTexture=!!d.isForceOwnTexture;this._renderAs3d=!!d.renderAs3d;this._useCameraDistanceDrawOrder=!!d.useCameraDistanceDrawOrder;this._useRenderCells=!!d.useRenderCells;this._scaleRate=d.scaleRate;this._blendMode=d.blendMode;this._curRenderTarget=null;this._scale=
1;this._zElevation=d.zElevation;this._scrollY=this._scrollX=this._angle=0;this._hasOwnScrollPosition=!1;this._viewport=C3$jscomp$103.New(C3$jscomp$103.Rect);this._viewportZ0=C3$jscomp$103.New(C3$jscomp$103.Rect);this._viewport3D=C3$jscomp$103.New(C3$jscomp$103.Rect);this._isViewportChanged=!0;this._projectionMatrix=mat4$jscomp$9.create();this._isProjectionMatrixChanged=!0;this._modelViewMatrix=mat4$jscomp$9.create();this._isMVMatrixChanged=!0;this._viewFrustum=C3$jscomp$103.New(C3$jscomp$103.Gfx.ViewFrustum);
this._isViewFrustumChanged=!0;this._startupInitialInstances=[];this._initialInstancesData=d.initialInstancesData;this._initialInstances=[];this._createdGlobalUids=[];this._initialUIDsToInstanceData=new Map;this._instances=[];this._anyInstanceZElevated=this._htmlZIndicesUpToDate=this._zIndicesUpToDate=!1;const c=this._runtime.GetCanvasManager();this._effectList=C3$jscomp$103.New(C3$jscomp$103.EffectList,this,d.effectListData);this._effectChain=C3$jscomp$103.New(C3$jscomp$103.Gfx.EffectChain,c.GetEffectChainManager(),
{drawContent:(e,g)=>{g=g.GetContentObject();const k=g.GetRenderTarget();e.SetColor(g.GetPremultipliedColor());e.DrawRenderTarget(k);e.InvalidateRenderTarget(k);c.ReleaseAdditionalRenderTarget(k)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)});this._wasDefaultColor=this._needsRebuildEffectChainSteps=!0;this._renderGrid=null;this._lastRenderList=[];this._isRenderListUpToDate=!1;this._lastRenderCells=C3$jscomp$103.New(C3$jscomp$103.Rect,0,0,-1,-1);this._curRenderCells=
C3$jscomp$103.New(C3$jscomp$103.Rect,0,0,-1,-1);this._iLayer=new self.ILayer(this);this._UpdatePremultipliedColor();this.UsesRenderCells()&&(this._renderGrid=C3$jscomp$103.New(C3$jscomp$103.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight()));this._subLayers=d.subLayersData.map(e=>C3$jscomp$103.Layer.CreateFromExportData(this._layout,this,e))}_InitInitialInstances(){for(const a of this._initialInstancesData){const b=this._runtime.GetObjectClassByIndex(a[1]);
this._layout._AddInitialObjectClass(b);b.GetDefaultInstanceData()||(b.SetDefaultInstanceData(a),b._SetDefaultLayerIndex(this._index));this._initialInstances.push(a);this._initialUIDsToInstanceData.set(a[2],a)}C3$jscomp$103.shallowAssignArray(this._startupInitialInstances,this._initialInstances);this._initialInstancesData=null}static CreateFromExportData(a,b,d){return C3$jscomp$103.New(C3$jscomp$103.Layer,a,b,{name:d[0],sid:d[2],isVisible:d[3],isInteractive:d[13],isHTMLElementsLayer:d[19],backgroundColor:d[4].map(c=>
c/255),isTransparent:d[5],parallax:[d[6],d[7]],opacity:d[8],isForceOwnTexture:d[9],renderAs3d:d[17],useCameraDistanceDrawOrder:d[18],useRenderCells:d[10],scaleRate:d[11],blendMode:d[12],zElevation:d[16],initialInstancesData:d[14],effectListData:d[15],subLayersData:d[20]})}Release(){for(const a of this._subLayers)a.Release();C3$jscomp$103.clearArray(this._subLayers);for(const a of this._instances)this._runtime.DestroyInstance(a);C3$jscomp$103.clearArray(this._instances);this._effectList.Release();
this._effectList=null;this._effectChain.Release();this._runtime=this._layout=this._parentLayer=this._iLayer=this._effectChain=null}GetInitialInstanceData(a){return this._initialUIDsToInstanceData.get(a)}CreateInitialInstances(a){const b=this._layout.IsFirstVisit();let d=0;const c=this._initialInstances;for(let g=0,k=c.length;g<k;++g){var e=c[g];const l=this._runtime.GetObjectClassByIndex(e[1]);let n=!0;if(!l.HasPersistBehavior()||b)e=this._runtime.CreateInstanceFromData(e,this,!0),a.push(e),l.IsGlobal()&&
(n=!1,this._createdGlobalUids.push(e.GetUID()));n&&(c[d]=c[g],++d)}C3$jscomp$103.truncateArray(c,d);this._runtime.FlushPendingInstances();this.SetZIndicesChanged()}_AddInstance(a,b){if(!a.GetPlugin().IsWorldType())throw Error("instance is not of world type");const d=a.GetWorldInfo();if(d.GetLayer()!==this)throw Error("instance added to wrong layer");this._instances.push(a);0!==d.GetZElevation()&&(this._anyInstanceZElevated=!0);b&&this.UsesRenderCells()&&a.GetWorldInfo().SetBboxChanged();this.SetZIndicesChanged(a)}_MaybeAddInstance(a){this._instances.includes(a)||
(this._instances.push(a),0!==a.GetWorldInfo().GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(a))}_PrependInstance(a,b){const d=a.GetWorldInfo();if(d.GetLayer()!==this)throw Error("instance added to wrong layer");this._instances.unshift(a);0!==d.GetZElevation()&&(this._anyInstanceZElevated=!0);this.SetZIndicesChanged(a);b&&this.UsesRenderCells()&&a.GetWorldInfo().SetBboxChanged()}_RemoveInstance(a,b){const d=this._instances.indexOf(a);0>d||(b&&this.UsesRenderCells()&&a.GetWorldInfo()._RemoveFromRenderCells(),
this._instances.splice(d,1),this.SetZIndicesChanged(a),this._MaybeResetAnyInstanceZElevatedFlag())}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=!0}_MaybeResetAnyInstanceZElevatedFlag(){0===this._instances.length&&(this._anyInstanceZElevated=!1)}_SortInstancesByLastCachedZIndex(a){if(a){a=new Set;for(var b of this._instances){var d=b.GetWorldInfo()._GetLastCachedZIndex();0<=d&&a.add(d)}b=-1;for(const c of this._instances)if(d=c.GetWorldInfo(),!(0<=d._GetLastCachedZIndex())){for(++b;a.has(b);)++b;
d._SetZIndex(b)}}this._instances.sort(SortByInstLastCachedZIndex$jscomp$1)}_Start(){}_End(){for(const a of this._instances)a.GetObjectClass().IsGlobal()||this._runtime.DestroyInstance(a);this._runtime.FlushPendingInstances();C3$jscomp$103.clearArray(this._instances);this._anyInstanceZElevated=!1;this.SetZIndicesChanged()}RecreateInitialObjects(a,b,d,c,e){const g=this._runtime.GetEventSheetManager(),k=this._runtime.GetAllObjectClasses(),l=a.IsFamily(),n=[];for(const w of this._initialInstances){var p=
w[0];if(b.containsPoint(p[0],p[1])){p=k[w[1]];if(p!==a)if(l){if(!a.FamilyHasMember(p))continue}else continue;p=this;var r=this._runtime.GetCurrentLayout();this.GetLayout()!==r&&((p=r.GetLayerByName(this.GetName()))||(p=r.GetLayerByIndex(this.GetIndex())));r=this._runtime.CreateInstanceFromData(w,p,!1,void 0,void 0,!1,e);p.SortAndAddInstancesByZIndex(r);p=r.GetWorldInfo();p.OffsetXY(d,c);p.SetBboxChanged();g.BlockFlushingInstances(!0);r._TriggerOnCreatedOnSelfAndRelated();g.BlockFlushingInstances(!1);
n.push(r)}}return n}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(a){this._index=a}GetIndex(){return this._index}_SetHTMLIndex(a){this._htmlIndex=a}GetHTMLIndex(){return this._htmlIndex}IsHTMLElementsLayer(){return this._isHTMLElementsLayer}SetIsHTMLElementsLayer(a){a=!!a;this._isHTMLElementsLayer!==a&&(this._isHTMLElementsLayer=a,this._layout._ReindexAndUpdateAllLayers(),this._runtime.UpdateRender())}_GetSiblingIndex(){const a=
this.GetParentLayer();return a?a.GetSubLayers().indexOf(this):this.GetLayout()._GetRootLayers().indexOf(this)}GetSID(){return this._sid}GetRuntime(){return this._runtime}IsDynamic(){return this._isDynamic}HasAnyDynamicParentLayer(){for(const a of this.parentLayers())if(a.IsDynamic())return!0;return!1}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain}_MaybeRebuildEffectChainSteps(){const a=
this.HasDefaultColor();if(this._needsRebuildEffectChainSteps||a!==this._wasDefaultColor||this._effectChain.NeedsRebuild()){var b=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(b.map(d=>d.GetShaderProgram()),{indexMap:b.map(d=>d.GetIndex()),forcePreDraw:!a,useFullSurface:!0});this._needsRebuildEffectChainSteps=!1;this._wasDefaultColor=a}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects();this._needsRebuildEffectChainSteps=!0}UsesRenderCells(){return this._useRenderCells&&
!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=!1}IsVisible(){for(const a of this.selfAndParentLayers())if(!a._IsVisibleFlagSet())return!1;return!0}_IsVisibleFlagSet(){return this._isVisible}SetVisible(a){a=!!a;this._isVisible!==a&&(this._isVisible=a,this._runtime.UpdateRender())}SetInteractive(a){this._isInteractive=!!a}IsInteractive(){return this._isInteractive}IsSelfAndParentsInteractive(){for(const a of this.selfAndParentLayers())if(!a.IsInteractive())return!1;
return!0}SetOwnScrollPositionEnabled(a){a=!!a;if(this._hasOwnScrollPosition!==a){if(this._hasOwnScrollPosition=a)a=this.GetLayout(),this._scrollX=a.GetScrollX(),this._scrollY=a.GetScrollY();this._SetMVMatrixChanged();this._runtime.UpdateRender()}}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(a){var b=this.GetLayout();const d=b.GetScrollLeftBound();b=b.GetScrollRightBound();a>b&&(a=b);a<d&&(a=d);this._scrollX!==a&&(this._scrollX=a,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),
this._runtime.UpdateRender()))}SetScrollY(a){var b=this.GetLayout();const d=b.GetScrollTopBound();b=b.GetScrollBottomBound();a>b&&(a=b);a<d&&(a=d);this._scrollY!==a&&(this._scrollY=a,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}GetScrollX(){return this.IsOwnScrollPositionEnabled()?this._scrollX:this.GetLayout().GetScrollX()}GetScrollY(){return this.IsOwnScrollPositionEnabled()?this._scrollY:this.GetLayout().GetScrollY()}GetViewport(){this._MaybeUpdateViewport();
return this._viewport}_GetViewportZ0(){this._MaybeUpdateViewport();return this._viewportZ0}GetViewport3D(){this._MaybeUpdateViewport();return this._viewport3D}_GetVanishingPoint(){const a=this.GetLayout();return[a.GetVanishingPointX(),a.GetVanishingPointY()]}GetDefaultCameraZ(a){return this._runtime.GetDefaultCameraZ(a)}GetViewportForZ(a,b){var d=this._GetViewportZ0();if(0===a)b.copy(d);else{let k=d.midX(),l=d.midY();var c=this.Get2DScaleFactorToZ(a);const n=d.width()/c;d=d.height()/c;const [p,r]=
this._GetVanishingPoint();if(.5!==p||.5!==r){const w=this.GetCameraZ();var e=this._runtime,g=this.GetDefaultCameraZ()/w;c=(p-.5)*e.GetViewportWidth()/g;e=(r-.5)*e.GetViewportHeight()/g;g=this.GetAngle();0!==g&&(tempVec2.set(c,e),tempVec2.rotate(g),c=tempVec2.getX(),e=tempVec2.getY());a=C3$jscomp$103.unlerp(w,0,a);k+=C3$jscomp$103.lerp(c,0,a);l+=C3$jscomp$103.lerp(e,0,a)}b.set(k-n/2,l-d/2,k+n/2,l+d/2)}}GetOpacity(){return this._color.getA()}SetOpacity(a){a=C3$jscomp$103.clamp(a,0,1);this._color.getA()!==
a&&(this._color.setA(a),this._UpdatePremultipliedColor(),this._runtime.UpdateRender())}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color);this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(a){this._scaleRate!==a&&(this._scaleRate=a,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(a,
b){if(this._parallaxX!==a||this._parallaxY!==b)if(this._parallaxX=a,this._parallaxY=b,this._SetMVMatrixChanged(),this._runtime.UpdateRender(),1!==this._parallaxX||1!==this._parallaxY)for(const d of this._instances)d.GetObjectClass()._SetAnyInstanceParallaxed(!0)}SetParallaxX(a){this.SetParallax(a,this.GetParallaxY())}SetParallaxY(a){this.SetParallax(this.GetParallaxX(),a)}SetZElevation(a){this._zElevation!==a&&(this._zElevation=a,this._runtime.UpdateRender())}GetZElevation(){return this._zElevation}SetAngle(a){a=
C3$jscomp$103.clampAngle(a);this._angle!==a&&(this._angle=a,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetAngle(){return C3$jscomp$103.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return 0<this._instances.length}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){return this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder?(C3$jscomp$103.shallowAssignArray(tempInstancesByCameraDist,this._GetInstances()),tempInstancesByCameraDist.sort((a,
b)=>this._SortInstancesByCameraDistance(a,b)),tempInstancesByCameraDist):this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(a){C3$jscomp$103.appendArray(a,this._GetInstancesInDrawOrder());for(const b of this._subLayers)b.IsVisible()&&0<b.GetOpacity()&&b._AppendAllInstancesIncludingSubLayersInDrawOrder(a)}_SortInstancesByCameraDistance(a,b){var d=this.GetLayout().Get3DCameraPosition(),c=d[0],e=d[1];d=d[2];var g=a.GetWorldInfo();const k=b.GetWorldInfo();b=g.GetX()-c;a=g.GetY()-e;
g=g.GetZElevation()-d;c=k.GetX()-c;e=k.GetY()-e;d=k.GetZElevation()-d;return c*c+e*e+d*d-(b*b+a*a+g*g)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(a){a=!!a;this._isTransparent!==a&&(this._isTransparent=a,this._runtime.UpdateRender())}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(a){a=!!a;this._isForceOwnTexture!==a&&(this._isForceOwnTexture=a,this._runtime.UpdateRender())}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||
!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return!1;for(const a of this._subLayers)if(!a.SelfAndAllSubLayersHave3DCamera())return!1;return!0}SetBlendMode(a){this._blendMode!==a&&(this._blendMode=a,this._runtime.UpdateRender())}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}_SetParentLayer(a){this._parentLayer=
a}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return 0<this._subLayers.length}_AddSubLayer(a,b=!0){b?this._subLayers.push(a):this._subLayers.unshift(a)}_InsertSubLayer(a,b,d){b=this._subLayers.indexOf(b);if(-1===b)throw Error("cannot find layer to insert by");d&&++b;this._subLayers.splice(b,0,a)}_RemoveSubLayer(a){a=this._subLayers.indexOf(a);if(-1===a)throw Error("cannot find layer to remove");this._subLayers.splice(a,1)}HasAnyVisibleSubLayer(){for(const a of this._subLayers)if(a.ShouldDraw())return!0;
return!1}*selfAndAllSubLayers(){for(const a of this._subLayers)yield*a.selfAndAllSubLayers();yield this}*parentLayers(){let a=this.GetParentLayer();for(;a;)yield a,a=a.GetParentLayer()}*selfAndParentLayers(){yield this;yield*this.parentLayers()}HasParentLayer(a){for(const b of this.parentLayers())if(b===a)return!0;return!1}IsTransformCompatibleWith(a){return this===a||this._parallaxX===a._parallaxX&&this._parallaxY===a._parallaxY&&this._scale===a._scale&&this._scaleRate===a._scaleRate&&this._angle===
a._angle&&this.GetScrollX()===a.GetScrollX()&&this.GetScrollY()===a.GetScrollY()}SaveTransform(){return{parallaxX:this.GetParallaxX(),parallaxY:this.GetParallaxY(),scale:this.GetOwnScale(),scaleRate:this.GetScaleRate(),angle:this.GetOwnAngle(),hasOwnScroll:this.IsOwnScrollPositionEnabled(),scrollX:this.GetScrollX(),scrollY:this.GetScrollY()}}RestoreTransform(a){this.SetParallax(a.parallaxX,a.parallaxY);this.SetOwnScale(a.scale);this.SetScaleRate(a.scaleRate);this.SetAngle(a.angle);this.SetOwnScrollPositionEnabled(a.hasOwnScroll);
this.SetScrollX(a.scrollX);this.SetScrollY(a.scrollY);this._MaybeUpdateViewport()}_RemoveAllInstancesInSet(a){0!==a.size&&0<C3$jscomp$103.arrayRemoveAllInSet(this._instances,a)&&(this._MaybeResetAnyInstanceZElevatedFlag(),this.SetZIndicesChanged())}SetZIndicesChanged(a){this._isRenderListUpToDate=this._zIndicesUpToDate=!1;if(!a||a.GetObjectClass().GetPlugin().IsHTMLElementType())this._htmlZIndicesUpToDate=!1}_UpdateZIndices(){if(!this._zIndicesUpToDate){this._instances.sort(SortByInstZElevation);
if(this.UsesRenderCells())for(let a=0,b=this._instances.length;a<b;++a){const d=this._instances[a].GetWorldInfo();d._SetZIndex(a);this._renderGrid.MarkRangeChanged(d.GetRenderCellRange())}else for(let a=0,b=this._instances.length;a<b;++a)this._instances[a].GetWorldInfo()._SetZIndex(a);this._zIndicesUpToDate=!0}}_UpdateHTMLZIndices(){if(!this._htmlZIndicesUpToDate){var a=this._layout.GetRootLayersForHTMLLayer(this.GetHTMLIndex()).map(d=>[...d.selfAndAllSubLayers()]).flat(),b=0;for(const d of a){for(const c of d._GetInstances())c.GetObjectClass().GetPlugin().IsHTMLElementType()&&
c.GetWorldInfo()._SetHTMLZIndex(b++);d._SetHTMLZIndicesUpToDate()}}}_SetHTMLZIndicesUpToDate(){this._htmlZIndicesUpToDate=!0}MoveInstanceAdjacent(a,b,d){var c=a.GetWorldInfo();b=b.GetWorldInfo();if(c.GetLayer()!==this||b.GetLayer()!==this)throw Error("can't arrange Z order unless both objects on this layer");c=c.GetZIndex();b=b.GetZIndex();if(c===b+(d?1:-1))return!1;C3$jscomp$103.arrayRemove(this._instances,c);c<b&&b--;d&&b++;b===this._instances.length?this._instances.push(a):this._instances.splice(b,
0,a);this.SetZIndicesChanged(a);return!0}_MergeSortedZArrays(a,b){const d=[];let c=0,e=0,g=a.length,k=b.length;for(;c<g&&e<k;){const l=a[c],n=b[e];l.GetWorldInfo()._GetLastCachedZIndex()<n.GetWorldInfo()._GetLastCachedZIndex()?(d.push(l),++c):(d.push(n),++e)}for(;c<g;++c)d.push(a[c]);for(;e<k;++e)d.push(b[e]);return d}_MergeAllSortedZArrays_pass(a){const b=[],d=a.length;for(let c=0;c<d-1;c+=2)b.push(this._MergeSortedZArrays(a[c],a[c+1]));1===d%2&&b.push(a[d-1]);return b}_MergeAllSortedZArrays(a){for(;1<
a.length;)a=this._MergeAllSortedZArrays_pass(a);return a[0]}_GetRenderCellInstancesToDraw(){this._UpdateZIndices();C3$jscomp$103.clearArray(renderCellArr);this._renderGrid.QueryRange(this.GetViewport(),renderCellArr);return renderCellArr.length?1===renderCellArr.length?renderCellArr[0]:this._MergeAllSortedZArrays(renderCellArr):[]}ShouldDraw(){return this.IsVisible()&&0<this.GetOpacity()&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return!0;
for(const a of this._subLayers)if(a._DrawsAnyContentInSelfOrSubLayers())return!0;return!1}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||0!==this.GetBlendMode()||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return!0;for(const a of this._subLayers)if(a.SelfOrAnySubLayerUsesOwnTexture())return!0;return!1}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(a){if(this._layout.IsOrthographicProjection())return 1;
const b=this.GetCameraZ();return b/(b-a)}GetCameraZ(a){return this.GetDefaultCameraZ(a)/this.GetNormalScale()}_SetMVMatrixChanged(){this._isViewportChanged=this._isViewFrustumChanged=this._isMVMatrixChanged=!0}_GetModelViewMatrix(a){this._isMVMatrixChanged&&(this._CalculateModelViewMatrix(a,this._modelViewMatrix,0,0,null),this._isMVMatrixChanged=!1);return this._modelViewMatrix}GetCameraPosition(){if(this.Has3DCamera()){const a=this.GetLayout().Get3DCameraPosition();return[a[0],a[1],a[2]]}return this._Get2DCameraPosition()}_Get2DCameraPosition(a=
0,b=0,d=0){var c=this._runtime,e=this.GetLayout(),g=c.GetParallaxXOrigin(),k=c.GetParallaxYOrigin();g=(this.GetScrollX()-g)*this._parallaxX+g;k=(this.GetScrollY()-k)*this._parallaxY+k;c.IsPixelRoundingEnabled()&&(g=Math.round(g),k=Math.round(k));a=g+a;b=k+b;e=e.IsOrthographicProjection()?this.GetDefaultCameraZ(d):this.GetCameraZ(d);const [l,n]=this._GetVanishingPoint();if(.5!==l||.5!==n)k=this.GetDefaultCameraZ(d)/e,d=(l-.5)*c.GetViewportWidth()/k,c=(n-.5)*c.GetViewportHeight()/k,k=this.GetAngle(),
0!==k&&(tempVec2.set(d,c),tempVec2.rotate(k),d=tempVec2.getX(),c=tempVec2.getY()),a+=d,b+=c;return[a,b,e]}_CalculateModelViewMatrix(a,b,d,c,e){const g=this._runtime;var k=this.GetLayout();if(this.Has3DCamera()){vec3$jscomp$6.copy(camVector,k.Get3DCameraPosition());vec3$jscomp$6.copy(lookVector,k.Get3DCameraLookAt());vec3$jscomp$6.copy(upVector,k.Get3DCameraUpVector());d=g.GetParallaxXOrigin();c=g.GetParallaxYOrigin();k=lookVector[0]-camVector[0];const l=lookVector[1]-camVector[1],n=lookVector[2]-
camVector[2];camVector[0]=(camVector[0]-d)*this._parallaxX+d;camVector[1]=(camVector[1]-c)*this._parallaxY+c;camVector[2]*=Math.max(this._parallaxX,this._parallaxY);lookVector[0]=camVector[0]+k;lookVector[1]=camVector[1]+l;lookVector[2]=camVector[2]+n}else{const [l,n,p]=this._Get2DCameraPosition(d,c,e);vec3$jscomp$6.set(camVector,l,n,p);vec3$jscomp$6.set(lookVector,l,n,p-100);d=this.GetAngle();0===d?vec3$jscomp$6.set(upVector,0,1,0):vec3$jscomp$6.set(upVector,Math.sin(d),Math.cos(d),0)}a.CalculateLookAtModelView(b,
camVector,lookVector,upVector,e||g.GetViewportHeight())}_SetProjectionMatrixChanged(){this._isViewportChanged=this._isViewFrustumChanged=this._isProjectionMatrixChanged=!0}_GetProjectionMatrix(a){this._isProjectionMatrixChanged&&(this._CalculateProjectionMatrix(a),this._isProjectionMatrixChanged=!1);return this._projectionMatrix}_CalculateProjectionMatrix(a){var b=this._runtime.GetCanvasManager();const [d,c]=this._GetVanishingPoint();if(this._layout.IsOrthographicProjection())a.CalculateOrthographicMatrix(this._projectionMatrix,
b.GetDrawWidth(),b.GetDrawHeight());else if(.5===d&&.5===c)mat4$jscomp$9.copy(this._projectionMatrix,b.GetDefaultProjectionMatrix());else{const e=b.GetDrawWidth();b=b.GetDrawHeight();a.CalculatePerspectiveMatrix(this._projectionMatrix,e/b,d,c)}}_SetTransform(a,b=!0,d=0,c=0,e=0){b&&a.SetProjectionMatrix(this._GetProjectionMatrix(a));0===d&&0===c&&0===e?b=this._GetModelViewMatrix(a):(this._CalculateModelViewMatrix(a,tempMat4$jscomp$4,d,c,e),b=tempMat4$jscomp$4);a.SetModelViewMatrix(b)}PrepareForDraw(a){this._SetTransform(a);
a.SetBaseZ(this.GetZElevation())}_MaybeStartWebGLProfiling(a){let b=null;if(a.IsWebGL()&&this._runtime.IsGPUProfiling()){const d=this._runtime.GetCanvasManager().GetLayerTimingsBuffer(this);d&&(b=d.AddTimeElapsedQuery(),a.StartQuery(b))}return b}_MaybeStartWebGPUProfiling(a){if(a.IsWebGPU()&&this._runtime.IsGPUProfiling()){const b=2*(this.GetIndex()+1);a.StartMeasuringRenderPassTime(b,b+1)}}Draw(a,b,d){var c=this._runtime.GetCanvasManager();const e=this.UsesOwnTexture();var g=null;const k=this._MaybeStartWebGLProfiling(a);
this._MaybeStartWebGPUProfiling(a);e?(g={sampling:this._runtime.GetSampling(),isSampled:!0,canReadPixels:a.IsWebGPU()?this._runtime.UsesAnyBackgroundBlending():!1},"low"===c.GetCurrentFullscreenScalingQuality()&&(g.width=c.GetDrawWidth(),g.height=c.GetDrawHeight()),this._curRenderTarget=g=this._runtime.GetAdditionalRenderTarget(g),a.SetRenderTarget(g),this.IsTransparent()&&a.ClearRgba(0,0,0,0)):(this._curRenderTarget=b,a.SetRenderTarget(b));this.IsTransparent()||a.Clear(this._backgroundColor);this._layout._DrawLayerList(a,
this._curRenderTarget,this._subLayers,e&&this.IsTransparent());this._MaybeStartWebGPUProfiling(a);this._SetTransform(a);a.SetBaseZ(this.GetZElevation());a.SetDepthEnabled(this.RendersIn3DMode());this.GetNormalScale()>Number.EPSILON&&(this._UpdateZIndices(),c=this.UsesRenderCells()&&0===this.GetZElevation()&&!this._anyInstanceZElevated,this.Has3DCamera()?this._DrawInstances_3DCamera(a):c?this._DrawInstances_RenderCells(a):this._DrawInstances(a,this._GetInstancesInDrawOrder()));a.SetBaseZ(0);a.SetCurrentZ(0);
e&&(a.SetDepthEnabled(!1),this._DrawLayerOwnTextureToRenderTarget(a,g,b,d));k&&a.EndQuery(k);this._curRenderTarget=null}_DrawInstances(a,b){const d=this.GetViewport(),c=this._curRenderTarget,e=this.GetLayout().IsOrthographicProjection(),g=this.GetLayout().HasVanishingPointOutsideViewport();let k=null;for(let l=0,n=b.length;l<n;++l){const p=b[l];if(p===k)continue;k=p;const r=p.GetWorldInfo();r.IsVisible()&&r.IsInViewport(d,g,e)&&this._DrawInstanceMaybeWithEffects(p,r,a,c)}}_DrawInstances_3DCamera(a){const b=
this._curRenderTarget,d=this._GetViewFrustum(),c=this._GetInstancesInDrawOrder();for(let l=0,n=c.length;l<n;){var e=c[l],g=e.GetWorldInfo();if(!g.IsVisible()||!g.IsInViewport3D(d)){++l;continue}(!e.RendersToOwnZPlane()||0<g.GetDepth())&&tempInstanceList2.push(e);var k=e.GetWorldInfo().GetTotalZElevation();tempInstanceList1.push(e);let p=l+1;for(;p<n;++p){const r=c[p],w=r.GetWorldInfo();if(w.IsVisible()&&w.IsInViewport3D(d)){if(w.GetTotalZElevation()!==k)break;r.RendersToOwnZPlane()?(0<w.GetDepth()&&
tempInstanceList2.push(r),tempInstanceList1.push(r)):tempInstanceList2.push(r)}}if(1!==tempInstanceList1.length||tempInstanceList1[0].MustMitigateZFighting()){this._DrawCoplanarInstances_3DCamera(a,tempInstanceList1);for(let r=0,w=tempInstanceList2.length;r<w;++r)e=tempInstanceList2[r],g=e.GetWorldInfo(),g._SetDrawNonBackFacesOnly(!0),this._DrawInstanceMaybeWithEffects(e,g,a,b),g._SetDrawNonBackFacesOnly(!1)}else{this._DrawInstanceMaybeWithEffects(e,g,a,b);for(let r=0,w=tempInstanceList2.length;r<
w;++r)g=tempInstanceList2[r],g!==e&&(k=g.GetWorldInfo(),k.GetLayer()._DrawInstanceMaybeWithEffects(g,k,a,b))}l=p;C3$jscomp$103.clearArray(tempInstanceList1);C3$jscomp$103.clearArray(tempInstanceList2)}}_DrawCoplanarInstances_3DCamera(a,b){const d=this._curRenderTarget;a.CoplanarStartStencilPass();for(let g=0,k=b.length;g<k;++g){var c=b[g],e=c.GetWorldInfo();e._SetDrawBackFaceOnly(!0);this._DrawInstance(c,e,a)}a.CoplanarStartColorPass();for(let g=0,k=b.length;g<k;++g)c=b[g],e=c.GetWorldInfo(),this._DrawInstanceMaybeWithEffects(c,
e,a,d),e._SetDrawBackFaceOnly(!1);a.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(a){var b=this._renderGrid;const d=this._curRenderCells,c=this._lastRenderCells,e=this.GetViewport();d.set(b.XToCell(e.getLeft()),b.YToCell(e.getTop()),b.XToCell(e.getRight()),b.YToCell(e.getBottom()));this._isRenderListUpToDate&&d.equals(c)?b=this._lastRenderList:(b=this._GetRenderCellInstancesToDraw(),this._isRenderListUpToDate=!0,c.copy(d));this._DrawInstances(a,b);b!==this._lastRenderList&&C3$jscomp$103.shallowAssignArray(this._lastRenderList,
b)}_DrawInstanceMaybeWithEffects(a,b,d,c){b.HasAnyActiveEffect()?this._DrawInstanceWithEffectsAndRestore(a,b,d,c):this._DrawInstance(a,b,d)}_DrawInstance(a,b,d){b=b.GetRendererStateGroup();d.GetCurrentStateGroup()!==b&&b.Apply();a.Draw(d)}_DrawInstanceWithEffectsAndRestore(a,b,d,c){this._DrawInstanceWithEffects(a,b,d,c,null)&&this._SetTransform(d)}_DrawInstanceWithEffects(a,b,d,c,e){const g=b.GetInstanceEffectList().GetEffectChain();g.Render(d,c,{contentObject:a,blendMode:b.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),
time:a.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:b.GetBoundingBox(),drawSurfaceRect:g.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(b),drawContentHook:e&&e.drawContentHook,compositOffX:e&&e.compositOffX,compositOffY:e&&e.compositOffY,updateOwnProjection:e&&e.updateOwnProjection});d.SetBaseZ(this.GetZElevation());return g.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(a,b,
d,c){const e=this._effectList.GetActiveEffectTypes(),g=this._runtime;0===e.length?(a.SetRenderTarget(d),a.SetTextureFillMode(),c&&0===this._blendMode&&this.HasDefaultColor()?a.CopyRenderTarget(b):(a.SetBlendMode(this._blendMode),a.SetColor(this._premultipliedColor),a.DrawRenderTarget(b)),a.InvalidateRenderTarget(b),g.ReleaseAdditionalRenderTarget(b)):this.GetEffectChain().Render(a,d,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:g.GetEffectDevicePixelRatioParam(),layerScale:g.GetEffectLayerScaleParam()*
this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:!0})}GetOwnScale(){return this._scale}SetOwnScale(a){this._scale!==a&&(this._scale=a,this._layout.BoundScrolling(),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*this._layout.GetScale()-
1)*this._scaleRate+1}_MaybeUpdateViewport(){if(this._isViewportChanged){this._isViewportChanged=!1;var a=this._runtime.GetParallaxXOrigin(),b=this._runtime.GetParallaxYOrigin(),d=(this.GetScrollX()-a)*this._parallaxX+a,c=(this.GetScrollY()-b)*this._parallaxY+b;a=this.GetNormalScale();b=this._runtime.GetViewportWidth()/a;a=this._runtime.GetViewportHeight()/a;d-=b/2;var e=c-a/2;this._runtime.IsPixelRoundingEnabled()&&(d=Math.round(d),e=Math.round(e));c=this._viewportZ0;c.set(d,e,d+b,e+a);b=this.GetAngle();
0!==b&&(tmpRect$jscomp$2.copy(c),tmpRect$jscomp$2.offset(-c.midX(),-c.midY()),tmpQuad$jscomp$2.setFromRotatedRect(tmpRect$jscomp$2,b),tmpQuad$jscomp$2.getBoundingBox(tmpRect$jscomp$2),tmpRect$jscomp$2.offset(c.midX(),c.midY()),c.copy(tmpRect$jscomp$2));b=this._zElevation;this.GetViewportForZ(b,this._viewport);this.Has3DCamera()?this.CalculateViewport3D(b,this._viewport3D):this._viewport3D.copy(this._viewport)}}CalculateViewport3D(a,b){var d=this._runtime.GetCanvasManager(),c=d.GetCssWidth();d=d.GetCssHeight();
const [e,g]=this.CanvasCssToLayer(0,0,a),[k,l]=this.CanvasCssToLayer(c,0,a),[n,p]=this.CanvasCssToLayer(c,d,a),[r,w]=this.CanvasCssToLayer(0,d,a);a=Math.min(e,k,n,r);c=Math.min(g,l,p,w);d=Math.max(e,k,n,r);let z=Math.max(g,l,p,w);isFinite(a)||(a=-Infinity);isFinite(c)||(c=-Infinity);isFinite(d)||(d=Infinity);isFinite(z)||(z=Infinity);b.set(a,c,d,z)}CanvasCssToLayer(a,b,d=0){return this._CanvasToLayer(a,b,d,this.GetDisplayScale())}DrawSurfaceToLayer(a,b,d=0){return this._CanvasToLayer(a,b,d,this.GetRenderScale()*
this.GetDevicePixelRatio())}_CanvasToLayer(a,b,d,c){var e=this._runtime,g=e.GetRenderer();const k=this.GetNormalScale(),l=e.GetViewportWidth()/k;e=e.GetViewportHeight()/k;vec4$jscomp$5.set(tempVec4$jscomp$1,0,0,l,e);a/=c;b=tempVec4$jscomp$1[3]-b/c;c=this._GetProjectionMatrix(g);g=this._GetModelViewMatrix(g);return C3$jscomp$103.Gfx.UnprojectScreenToWorldZ(a,b,d,g,c,tempVec4$jscomp$1,tempVec3)?[tempVec3[0],tempVec3[1]]:[NaN,NaN]}CanvasCssToLayer_DefaultTransform(a,b){const d=this._scale,c=this._scaleRate,
e=this._parallaxX,g=this._parallaxY,k=this._angle;this._parallaxY=this._parallaxX=this._scaleRate=this._scale=1;this._angle=0;this._SetMVMatrixChanged();a=this.CanvasCssToLayer(a,b);this._scale=d;this._scaleRate=c;this._parallaxX=e;this._parallaxY=g;this._angle=k;this._SetMVMatrixChanged();return a}LayerToCanvasCss(a,b,d=0){return this._LayerToCanvas(a,b,d,this.GetDisplayScale())}LayerToDrawSurface(a,b,d=0){return this._LayerToCanvas(a,b,d,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(a,
b,d,c){var e=this._runtime,g=e.GetRenderer();const k=this.GetNormalScale();var l=e.GetViewportWidth()/k;e=e.GetViewportHeight()/k;vec4$jscomp$5.set(tempVec4$jscomp$1,0,0,l,e);l=this._GetProjectionMatrix(g);g=this._GetModelViewMatrix(g);return C3$jscomp$103.Gfx.Project(a,b,d,g,l,tempVec4$jscomp$1,tempVec3)?[tempVec3[0]*c,(tempVec4$jscomp$1[3]-tempVec3[1])*c]:[NaN,NaN]}_GetLayerToDrawSurfaceScale(a,b){a*=this.GetRenderScale()*this.GetDevicePixelRatio();0!==b&&(a*=this.Get2DScaleFactorToZ(b));return a}_InstanceBoxToDrawSurface(a){var b=
a.GetBoundingBox(),d=a.GetTotalZElevation();a=a.GetDepth();const c=d+a,e=b.getLeft(),g=b.getTop(),k=b.getRight();b=b.getBottom();if(this.Has3DCamera()){if(this._IsPointBehindNearPlane(e,g,d)||this._IsPointBehindNearPlane(k,g,d)||this._IsPointBehindNearPlane(k,b,d)||this._IsPointBehindNearPlane(e,b,d)||0<a&&(this._IsPointBehindNearPlane(e,g,c)||this._IsPointBehindNearPlane(k,g,c)||this._IsPointBehindNearPlane(k,b,c)||this._IsPointBehindNearPlane(e,b,c)))return null}else if(c>=this.GetCameraZ())return null;
let [l,n]=this.LayerToDrawSurface(e,g,d),[p,r]=this.LayerToDrawSurface(k,b,d);if(0!==this.GetAngle()||0<a||this.Has3DCamera()){const [w,z]=this.LayerToDrawSurface(k,g,d),[B,C]=this.LayerToDrawSurface(e,b,d);if(0<a){const [E,F]=this.LayerToDrawSurface(e,g,c),[I,K]=this.LayerToDrawSurface(k,g,c),[O,V]=this.LayerToDrawSurface(k,b,c),[W,ca]=this.LayerToDrawSurface(e,b,c);d=Math.min(l,p,w,B,E,I,O,W);p=Math.max(l,p,w,B,E,I,O,W);l=d;d=Math.min(n,r,z,C,F,K,V,ca);r=Math.max(n,r,z,C,F,K,V,ca);n=d}else d=Math.min(l,
p,w,B),p=Math.max(l,p,w,B),l=d,d=Math.min(n,r,z,C),r=Math.max(n,r,z,C),n=d}tmpRect$jscomp$2.set(l,n,p,r);return tmpRect$jscomp$2}_GetViewFrustum(){this._isViewFrustumChanged&&(this._UpdateViewFrustum(),this._isViewFrustumChanged=!1);return this._viewFrustum}_UpdateViewFrustum(){var a=this._runtime.GetRenderer();const b=this._GetProjectionMatrix(a);a=this._GetModelViewMatrix(a);this._viewFrustum.CalculatePlanes(a,b)}_IsPointBehindNearPlane(a,b,d){return this._GetViewFrustum().IsBehindNearPlane(a,b,
d)}_SaveToJson(){return{d:this.IsDynamic(),s:this.GetOwnScale(),a:this.GetOwnAngle(),v:this._IsVisibleFlagSet(),i:this.IsInteractive(),html:this.IsHTMLElementsLayer(),bc:this._backgroundColor.toJSON(),t:this.IsTransparent(),sx:this._scrollX,sy:this._scrollY,hosp:this._hasOwnScrollPosition,px:this.GetParallaxX(),py:this.GetParallaxY(),c:this._color.toJSON(),sr:this.GetScaleRate(),fx:this._effectList.SaveToJson(),cg:this._createdGlobalUids}}_LoadFromJson(a){this._isDynamic=!!a.d;this._scale=a.s;this._angle=
a.a;this._isVisible=!!a.v;this._isInteractive=a.hasOwnProperty("i")?a.i:!0;this._isHTMLElementsLayer=!!a.html;this._backgroundColor.setFromJSON(a.bc);this._isTransparent=!!a.t;a.hasOwnProperty("sx")&&(this._scrollX=a.sx);a.hasOwnProperty("sy")&&(this._scrollY=a.sy);a.hasOwnProperty("hosp")&&(this._hasOwnScrollPosition=!!a.hosp);this._parallaxX=a.px;this._parallaxY=a.py;this._color.setFromJSON(a.c);this._UpdatePremultipliedColor();this._scaleRate=a.sr;C3$jscomp$103.shallowAssignArray(this._createdGlobalUids,
a.cg);C3$jscomp$103.shallowAssignArray(this._initialInstances,this._startupInitialInstances);const b=new Set(this._createdGlobalUids);let d=0;for(let c=0,e=this._initialInstances.length;c<e;++c)b.has(this._initialInstances[c][2])||(this._initialInstances[d]=this._initialInstances[c],++d);C3$jscomp$103.truncateArray(this._initialInstances,d);this._effectList.LoadFromJson(a.fx);this._needsRebuildEffectChainSteps=!0}_LoadFromJsonAfterInstances(){this._SortInstancesByLastCachedZIndex(!1);this.SetZIndicesChanged();
this._SetMVMatrixChanged();this._SetProjectionMatrixChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(a,b=!1){if(this._instances.includes(a))b&&this._instances.sort((e,g)=>{e=e.GetWorldInfo().GetSceneGraphZIndex();g=g.GetWorldInfo().GetSceneGraphZIndex();return e-g});else if(a.HasChildren()){var d=[...a.allChildren()];d.push(a);d.sort((e,g)=>{e=e.GetWorldInfo().GetSceneGraphZIndex();g=g.GetWorldInfo().GetSceneGraphZIndex();return e-g});for(var c of d)if(c.IsInContainer())for(const e of c.siblings())d.includes(e)||
(a=[...e.allChildren()],a.push(e),a.sort((g,k)=>{g=g.GetWorldInfo().GetSceneGraphZIndex();k=k.GetWorldInfo().GetSceneGraphZIndex();return g-k}),a&&a.length&&d.splice(d.length,0,...a));for(const e of d)e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0)}else if(a.GetPlugin().IsWorldType()&&this._AddInstance(a,!0),a.IsInContainer())for(d of a.siblings())if(c=[...d.allChildren()],c.push(d),c.sort((e,g)=>{e=e.GetWorldInfo().GetSceneGraphZIndex();g=g.GetWorldInfo().GetSceneGraphZIndex();return e-g}),
c&&c.length)for(const e of c)e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0)}};"use strict";const C3$jscomp$104=self.C3,C3Debugger=self.C3Debugger;C3$jscomp$104.New(C3$jscomp$104.Rect);C3$jscomp$104.New(C3$jscomp$104.Rect);const tempLayoutRect=C3$jscomp$104.New(C3$jscomp$104.Rect),tempColor$jscomp$4=C3$jscomp$104.New(C3$jscomp$104.Color),vec3$jscomp$7=self.glMatrix.vec3,tempRender3dList=[],tempInstanceList1$jscomp$1=[],tempInstanceList2$jscomp$1=[],tempInstanceList3=[];
function vec3EqualsXYZ(a,b,d,c){return a[0]===Math.fround(b)&&a[1]===Math.fround(d)&&a[2]===Math.fround(c)}let lastLayerPreparedForDrawing=null;function MaybePrepareLayerDraw(a,b){lastLayerPreparedForDrawing!==a&&(a.PrepareForDraw(b),lastLayerPreparedForDrawing=a)}
C3$jscomp$104.Layout=class extends C3$jscomp$104.DefendedBase{constructor(a,b,d){super();this._layoutManager=a;this._runtime=a.GetRuntime();this._name=d[0];this._originalWidth=d[1];this._originalHeight=d[2];this._width=d[1];this._height=d[2];this._isUnboundedScrolling=!!d[3];this._isOrthographicProjection=!!d[4];this._vanishingPointX=d[5];this._vanishingPointY=d[6];this._eventSheetName=d[7];this._eventSheet=null;this._sid=d[8];this._index=b;this._scrollY=this._scrollX=0;this._scale=1;this._angle=
0;this._initialObjectClasses=new Set;this._textureLoadedTypes=new Set;this._textureLoadPendingPromises=new Set;this._createdInstances=[];this._createdPersistedInstances=[];this._createdPersistedInstancesToDataMap=new Map;this._createdPersistedIndexToInstanceMap=new Map;this._initialNonWorld=[];this._is3dCameraEnabled=!1;this._cam3dposition=vec3$jscomp$7.create();this._cam3dlook=vec3$jscomp$7.create();this._cam3dup=vec3$jscomp$7.create();this._rootLayers=[];this._allLayersFlat=[];this._layersByName=
new Map;this._layersBySid=new Map;this._pendingSetHTMLLayerCount=-1;const c=this._runtime.GetCanvasManager();this._effectList=C3$jscomp$104.New(C3$jscomp$104.EffectList,this,d[11]);this._effectChain=C3$jscomp$104.New(C3$jscomp$104.Gfx.EffectChain,c.GetEffectChainManager(),{drawContent:(e,g)=>{g=g.GetContentObject().GetRenderTarget();e.ResetColor();e.DrawRenderTarget(g);e.InvalidateRenderTarget(g);c.ReleaseAdditionalRenderTarget(g)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)});
this._needsRebuildEffectChainSteps=!0;this._wasFullScreenQualityLow=!1;this._curRenderTarget=null;this._persistData={};this._persistedIntances=new Map;this._isFirstVisit=!0;this._iLayout=new self.ILayout(this);this._userScriptDispatcher=C3$jscomp$104.New(C3$jscomp$104.Event.Dispatcher);for(const e of d[9])this._rootLayers.push(C3$jscomp$104.Layer.CreateFromExportData(this,null,e));this._ReindexLayers();for(const e of this.allLayers())e._InitInitialInstances();for(const e of d[10]){a=this._runtime.GetObjectClassByIndex(e[1]);
if(!a)throw Error("missing nonworld object class");a.GetDefaultInstanceData()||a.SetDefaultInstanceData(e);this._initialNonWorld.push(e);this._AddInitialObjectClass(a)}}Release(){for(const a of this._allLayersFlat)a.Release();C3$jscomp$104.clearArray(this._allLayersFlat);this._textureLoadPendingPromises.clear();this._runtime=this._layoutManager=this._eventSheet=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){this._MaybeRebuildEffectChainSteps();
return this._effectChain}_MaybeRebuildEffectChainSteps(){const a="low"===this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality();if(this._needsRebuildEffectChainSteps||this._wasFullScreenQualityLow!==a||this._effectChain.NeedsRebuild()){var b=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(b.map(d=>d.GetShaderProgram()),{indexMap:b.map(d=>d.GetIndex()),forcePostDraw:a,useFullSurface:!0});this._needsRebuildEffectChainSteps=!1;this._wasFullScreenQualityLow=a}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects();
this._needsRebuildEffectChainSteps=!0}GetMinLayerScale(){let a=this._allLayersFlat[0].GetNormalScale();for(let b=1,d=this._allLayersFlat.length;b<d;++b){const c=this._allLayersFlat[b];if(0!==c.GetParallaxX()||0!==c.GetParallaxY())a=Math.min(a,c.GetNormalScale())}return a}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){return this.IsUnboundedScrolling()?
-Infinity:this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){return this.IsUnboundedScrolling()?Infinity:this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){return this.IsUnboundedScrolling()?-Infinity:this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){return this.IsUnboundedScrolling()?Infinity:this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(a){const b=this.GetScrollLeftBound(),d=this.GetScrollRightBound();a>d&&(a=d);a<b&&(a=b);this._scrollX!==
a&&(this._scrollX=a,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollX(){return this._scrollX}SetScrollY(a){const b=this.GetScrollTopBound(),d=this.GetScrollBottomBound();a>d&&(a=d);a<b&&(a=b);this._scrollY!==a&&(this._scrollY=a,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX());this.SetScrollY(this.GetScrollY());for(const a of this._allLayersFlat)a.IsOwnScrollPositionEnabled()&&
(a.SetScrollX(a.GetScrollX()),a.SetScrollY(a.GetScrollY()))}SetVanishingPointXY(a,b){if(this._vanishingPointX!==a||this._vanishingPointY!==b)this._vanishingPointX=a,this._vanishingPointY=b,this.IsPerspectiveProjection()&&(this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetVanishingPointX(){return this.IsOrthographicProjection()?.5:this._vanishingPointX}GetVanishingPointY(){return this.IsOrthographicProjection()?.5:this._vanishingPointY}HasVanishingPointOutsideViewport(){const a=
this.GetVanishingPointX(),b=this.GetVanishingPointY();return 0>a||1<a||0>b||1<b}SetPerspectiveProjection(){this._isOrthographicProjection&&(this._isOrthographicProjection=!1,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}SetOrthographicProjection(){this._isOrthographicProjection||(this._isOrthographicProjection=!0,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(a){a=
!!a;this._is3dCameraEnabled!==a&&(this._is3dCameraEnabled=a,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(a,b,d,c,e,g,k,l,n){vec3EqualsXYZ(this._cam3dposition,a,b,d)&&vec3EqualsXYZ(this._cam3dlook,c,e,g)&&vec3EqualsXYZ(this._cam3dup,k,l,n)||(vec3$jscomp$7.set(this._cam3dposition,a,b,d),vec3$jscomp$7.set(this._cam3dlook,c,e,g),vec3$jscomp$7.set(this._cam3dup,k,l,n),this.Set3DCameraChanged())}Set3DCameraChanged(){this._SetAllLayersMVChanged();
this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(a){this._scale!==a&&(this._scale=a,this._SetAllLayersMVChanged(),this.BoundScrolling(),this._runtime.UpdateRender())}SetAngle(a){a=C3$jscomp$104.clampAngle(a);this._angle!==a&&(this._angle=a,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(a){!isFinite(a)||
1>a||(this._width=a)}GetHeight(){return this._height}SetHeight(a){!isFinite(a)||1>a||(this._height=a)}GetEventSheet(){return this._eventSheet}_GetRootLayers(){return this._rootLayers}*allLayers(){for(const a of this._rootLayers)yield*a.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(a){return"number"===typeof a?this.GetLayerByIndex(a):this.GetLayerByName(a.toString())}GetLayerByIndex(a){a=C3$jscomp$104.clamp(Math.floor(a),0,this._allLayersFlat.length-
1);return this._allLayersFlat[a]}GetLayerByName(a){return this._layersByName.get(a.toLowerCase())||null}HasLayerByName(a){return!!this.GetLayerByName(a)}GetLayerBySID(a){return this._layersBySid.get(a)||null}_SetAllLayersProjectionChanged(){for(const a of this._allLayersFlat)a._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(const a of this._allLayersFlat)a._SetMVMatrixChanged()}AddLayer(a,b,d){if(this.HasLayerByName(a))throw Error(`layer name '${a}' already in use`);if(!b&&2>d)throw Error("invalid insert position");
const c=2<=d?b:b.GetParentLayer();a=C3$jscomp$104.New(C3$jscomp$104.Layer,this,c,{name:a,sid:Math.floor(1E15*Math.random()),isDynamic:!0});this._InsertLayer(a,b,d);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}MoveLayer(a,b,d){if(!b&&2>d)throw Error("invalid insert position");a===b&&2>d||(this._RemoveLayer(a),this._InsertLayer(a,b,d),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers())}RemoveLayer(a){if(this._RemoveLayer(a)){const b=this._runtime.GetEventSheetManager();
b.BlockFlushingInstances(!0);a.Release();b.BlockFlushingInstances(!1);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}}RemoveAllDynamicLayers(){const a=new Set;for(var b of this.allLayers())b.IsDynamic()&&!b.HasAnyDynamicParentLayer()&&a.add(b);if(0!==a.size){b=this._runtime.GetEventSheetManager();b.BlockFlushingInstances(!0);for(const d of a)this._RemoveLayer(d),d.Release();b.BlockFlushingInstances(!1);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}}_InsertLayer(a,
b,d){if(2<=d)if(b){if(b===a||b.HasParentLayer(a))throw Error(`cannot move layer '${a.GetName()}' to sub-layer of itself`);b._AddSubLayer(a,2===d);a._SetParentLayer(b)}else 2===d?this._rootLayers.push(a):this._rootLayers.unshift(a),a._SetParentLayer(null);else{const c=b.GetParentLayer();if(c){if(b.HasParentLayer(a))throw Error(`cannot move layer '${a.GetName()}' to sub-layer of itself`);c._InsertSubLayer(a,b,0===d);a._SetParentLayer(c)}else{b=this._rootLayers.indexOf(b);if(-1===b)throw Error("cannot find layer to insert by");
0===d&&++b;this._rootLayers.splice(b,0,a);a._SetParentLayer(null)}}}_RemoveLayer(a){const b=a.GetParentLayer();if(b)return b._RemoveSubLayer(a),!0;if(1<this._rootLayers.length){a=this._rootLayers.indexOf(a);if(-1===a)throw Error("cannot find layer to remove");this._rootLayers.splice(a,1);return!0}return!1}_ReindexLayers(){this._allLayersFlat=[...this.allLayers()];this._layersByName.clear();this._layersBySid.clear();for(let a=0,b=this._allLayersFlat.length;a<b;++a){const d=this._allLayersFlat[a];d._SetIndex(a);
this._layersByName.set(d.GetName().toLowerCase(),d);this._layersBySid.set(d.GetSID(),d)}}_ReindexHTMLLayers(){let a=0;for(const b of this._rootLayers){for(const d of b.selfAndAllSubLayers())d._SetHTMLIndex(a);b.IsHTMLElementsLayer()&&a++}}GetHTMLLayerCount(){return this._rootLayers.at(-1).GetHTMLIndex()+1}async _ReindexAndUpdateAllLayers(){this._ReindexLayers();this._ReindexHTMLLayers();this._pendingSetHTMLLayerCount=this.GetHTMLLayerCount()}_GetPendingSetHTMLLayerCount(){return this._pendingSetHTMLLayerCount}_ResetPendingHTMLLayerCount(){this._pendingSetHTMLLayerCount=
-1}GetRootLayersForHTMLLayer(a){const b=[];for(const d of this._rootLayers){const c=d.GetHTMLIndex();if(c===a)b.push(d);else if(c>a)break}return b}SaveTransform(){return{scrollX:this.GetScrollX(),scrollY:this.GetScrollY(),scale:this.GetScale(),angle:this.GetAngle(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY()}}RestoreTransform(a){this.SetScrollX(a.scrollX);this.SetScrollY(a.scrollY);this.SetScale(a.scale);this.SetAngle(a.angle);this.SetVanishingPointXY(a.vpX,a.vpY)}GetLayoutBackgroundColor(){let a=
this._rootLayers.filter(b=>b.ShouldDraw())[0];for(;a;){if(!a.IsTransparent())return tempColor$jscomp$4.copyRgb(a.GetBackgroundColor()),tempColor$jscomp$4.setA(1),tempColor$jscomp$4;if(a.UsesOwnTexture())return tempColor$jscomp$4.setRgba(0,0,0,0),tempColor$jscomp$4;a=a.GetSubLayers().filter(b=>b.ShouldDraw())[0]}tempColor$jscomp$4.setRgba(0,0,0,0);return tempColor$jscomp$4}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(a){if(a.IsInContainer())for(const b of a.GetContainer().GetObjectTypes())this._initialObjectClasses.add(b);
else this._initialObjectClasses.add(a)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(a,b){if(a===this||!b)return Promise.resolve();a&&(C3$jscomp$104.CopySet(this._textureLoadedTypes,a._textureLoadedTypes),a._textureLoadedTypes.clear());a=[];for(const d of this._initialObjectClasses)this._textureLoadedTypes.has(d)||(a.push(d.LoadTextures(b)),this._textureLoadedTypes.add(d));return Promise.all(a)}async MaybeLoadTexturesFor(a){if(a.IsFamily())throw Error("cannot load textures for family");
var b=this._runtime.GetRenderer();!b||b.IsContextLost()||this._textureLoadedTypes.has(a)||(this._textureLoadedTypes.add(a),b=a.LoadTextures(b),this._AddPendingTextureLoadPromise(b),await b,a.OnDynamicTextureLoadComplete(),this._runtime.UpdateRender())}_AddPendingTextureLoadPromise(a){this._textureLoadPendingPromises.add(a);a.then(()=>this._textureLoadPendingPromises.delete(a)).catch(()=>this._textureLoadPendingPromises.delete(a))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(a){if(a.IsFamily()||
0<a.GetInstanceCount())throw Error("cannot unload textures");const b=this._runtime.GetRenderer();b&&this._textureLoadedTypes.has(a)&&(this._textureLoadedTypes.delete(a),a.ReleaseTextures(b))}_Unload(a,b){if(a!==this&&b)for(const d of this._textureLoadedTypes)d.IsGlobal()||a._initialObjectClasses.has(d)||(d.ReleaseTextures(),this._textureLoadedTypes.delete(d))}_OnRendererContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(a){const b=this._runtime,d=this._layoutManager,c=b.GetEventSheetManager();
this._eventSheetName&&(this._eventSheet=c.GetEventSheetByName(this._eventSheetName),this._eventSheet._UpdateDeepIncludes());d._SetMainRunningLayout(this);this._width=this._originalWidth;this._height=this._originalHeight;this._scrollX=b.GetOriginalViewportWidth()/2;this._scrollY=b.GetOriginalViewportHeight()/2;this.BoundScrolling();this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._ReindexHTMLLayers();await this._runtime.GetCanvasManager().SetHTMLLayerCount(this.GetHTMLLayerCount(),
!0);this._MoveGlobalObjectsToThisLayout(a);this._runtime.SetUsingCreatePromises(!0);this._CreateInitialInstances();this._isFirstVisit||this._CreatePersistedInstances();this._CreateAndLinkContainerInstances(this._createdInstances);this._CreateAndLinkContainerInstances(this._createdPersistedInstances);this._CreateInitialNonWorldInstances();d.ClearPendingChangeLayout();b.FlushPendingInstances();this._runtime.SetUsingCreatePromises(!1);var e=this._runtime.GetCreatePromises();await Promise.all(e);C3$jscomp$104.clearArray(e);
if(!b.IsLoadingState()){for(const g of this._createdInstances)g.SetupInitialSceneGraphConnections();for(const g of this._createdPersistedInstances)g.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);for(const [g,k]of Object.entries(this._persistData))(e=this._runtime.GetObjectClassBySID(parseInt(g,10)))&&!e.IsFamily()&&e.HasPersistBehavior()&&C3$jscomp$104.clearArray(k);for(const g of this._createdInstances)g._TriggerOnCreated();
for(const g of this._createdPersistedInstances)g._TriggerOnCreated()}C3$jscomp$104.clearArray(this._createdInstances);C3$jscomp$104.clearArray(this._createdPersistedInstances);this._createdPersistedInstancesToDataMap.clear();this._createdPersistedIndexToInstanceMap.clear();await Promise.all([...this._initialObjectClasses].map(g=>g.PreloadTexturesWithInstances(this._runtime.GetRenderer())));a&&(b.Dispatcher().dispatchEvent(new C3$jscomp$104.Event("beforefirstlayoutstart")),await b.DispatchUserScriptEventAsyncWait(new C3$jscomp$104.Event("beforeprojectstart")));
await this.DispatchRuntimeUserScriptEventAsyncWait(new C3$jscomp$104.Event("beforeanylayoutstart"));b.Dispatcher().dispatchEvent(new C3$jscomp$104.Event("beforelayoutstart"));await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$104.Event("beforelayoutstart"));b.IsLoadingState()||await b.TriggerAsync(C3$jscomp$104.Plugins.System.Cnds.OnLayoutStart,null,null);b.Dispatcher().dispatchEvent(new C3$jscomp$104.Event("afterlayoutstart"));await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$104.Event("afterlayoutstart"));
await this.DispatchRuntimeUserScriptEventAsyncWait(new C3$jscomp$104.Event("afteranylayoutstart"));a&&(b.Dispatcher().dispatchEvent(new C3$jscomp$104.Event("afterfirstlayoutstart")),await b.DispatchUserScriptEventAsyncWait(new C3$jscomp$104.Event("afterprojectstart")));c._RunQueuedTriggers(d);await this.WaitForPendingTextureLoadsToComplete();this._isFirstVisit=!1}_MoveGlobalObjectsToThisLayout(a){for(const d of this._runtime.GetAllObjectClasses())if(!d.IsFamily()&&d.IsWorldType())for(const c of d.GetInstances()){const e=
c.GetWorldInfo();var b=e.GetLayer();b=C3$jscomp$104.clamp(b.GetIndex(),0,this._allLayersFlat.length-1);b=this._allLayersFlat[b];e._SetLayer(b,!0);b._MaybeAddInstance(c)}if(!a)for(const d of this._allLayersFlat)d._SortInstancesByLastCachedZIndex(!1)}_CreateInitialInstances(){for(const a of this._allLayersFlat)a.CreateInitialInstances(this._createdInstances),a._Start()}_CreatePersistedInstances(){let a=!1;for(const [d,c]of Object.entries(this._persistData)){const e=this._runtime.GetObjectClassBySID(parseInt(d,
10));if(e&&!e.IsFamily()&&e.HasPersistBehavior())for(const g of c){var b=null;if(e.IsWorldType()&&(b=g.hasOwnProperty("instJson")?this.GetLayerBySID(g.instJson.w.l):this.GetLayerBySID(g.w.l),!b))continue;b=this._runtime.CreateInstanceFromData(e,b,!1,0,0,!0);g.hasOwnProperty("instJson")?b.LoadFromJson(g.instJson):b.LoadFromJson(g);a=!0;this._createdPersistedInstances.push(b);g.hasOwnProperty("instJson")&&(this._createdPersistedInstancesToDataMap.set(b,g),this._createdPersistedIndexToInstanceMap.set(g.index,
b))}}for(const d of this._allLayersFlat)d._SortInstancesByLastCachedZIndex(!0),d.SetZIndicesChanged();a&&(this._runtime.FlushPendingInstances(),this._runtime._RefreshUidMap())}_CreateAndLinkContainerInstances(a){for(const d of a){if(!d.IsInContainer())continue;const c=d.GetWorldInfo(),e=d.GetIID();for(const g of d.GetObjectClass().GetContainer().objectTypes())if(g!==d.GetObjectClass()){var b=g.GetInstances();b.length>e?d._AddSibling(b[e]):(b=c?this._runtime.CreateInstanceFromData(g,c.GetLayer(),!0,
c.GetX(),c.GetY(),!0):this._runtime.CreateInstanceFromData(g,null,!0,0,0,!0),this._runtime.FlushPendingInstances(),g._UpdateIIDs(),d._AddSibling(b),a.push(b))}}}_CreateInitialNonWorldInstances(){for(const a of this._initialNonWorld)this._runtime.GetObjectClassByIndex(a[1]).IsInContainer()||this._runtime.CreateInstanceFromData(a,null,!0)}_CreateGlobalNonWorlds(){const a=[],b=this._initialNonWorld;let d=0;for(let c=0,e=b.length;c<e;++c){const g=b[c],k=this._runtime.GetObjectClassByIndex(g[1]);k.IsGlobal()?
k.IsInContainer()&&k.GetContainer().HasAnyWorldType()||a.push(this._runtime.CreateInstanceFromData(g,null,!0)):(b[d]=g,++d)}C3$jscomp$104.truncateArray(b,d);this._runtime.FlushPendingInstances();this._CreateAndLinkContainerInstances(a)}RecreateInitialObjects(a,b,d,c,e,g){if(d)return d.RecreateInitialObjects(a,b,c,e,g);d=[];for(const k of this._allLayersFlat)d.push(k.RecreateInitialObjects(a,b,c,e,g));return d.flat()}async _StopRunning(){const a=this._layoutManager;this._runtime.IsLoadingState()||
(await this.DispatchRuntimeUserScriptEventAsyncWait(new C3$jscomp$104.Event("beforeanylayoutend")),await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$104.Event("beforelayoutend")),await this._runtime.TriggerAsync(C3$jscomp$104.Plugins.System.Cnds.OnLayoutEnd,null,null),await this.DispatchUserScriptEventAsyncWait(new C3$jscomp$104.Event("afterlayoutend")),await this.DispatchRuntimeUserScriptEventAsyncWait(new C3$jscomp$104.Event("afteranylayoutend")));a.SetIsEndingLayout(!0);this._runtime.GetEventSheetManager().ClearAllScheduledWaits();
this._isFirstVisit||this._SavePersistData();for(const b of this._allLayersFlat)b._End();for(const b of this._runtime.GetAllObjectClasses())if(!(b.IsGlobal()||b.IsWorldType()||b.GetPlugin().IsSingleGlobal()||b.IsFamily())){for(const d of b.GetInstances())this._runtime.DestroyInstance(d);this._runtime.FlushPendingInstances()}a.SetIsEndingLayout(!1);a.GetMainRunningLayout()===this&&a._SetMainRunningLayout(null)}_SaveInstanceToPersist(a,b){var d=a.GetObjectClass().GetSID().toString();this._persistData.hasOwnProperty(d)||
(this._persistData[d]=[]);d=this._persistData[d];b={index:b,instJson:a.SaveToJson(),sceneGraphJson:{children:[]}};d.push(b);this._persistedIntances.set(a,b)}_SaveSceneGraphInfoToPersist(a){const b=this._persistedIntances.get(a);for(const d of a.GetChildren())(a=this._persistedIntances.get(d))&&b.sceneGraphJson.children.push({index:a.index,flags:C3$jscomp$104.SceneGraphInfo._GetFlagsNumber(d.GetWorldInfo())})}_SavePersistData(){this._persistedIntances.clear();var a=0;for(const b of this._allLayersFlat){b._UpdateZIndices();
for(const d of b._GetInstances()){const c=d.GetObjectClass();!c.IsGlobal()&&c.HasPersistBehavior()&&(this._SaveInstanceToPersist(d,a),a++)}}for(const b of this._allLayersFlat)for(const d of b._GetInstances())a=d.GetObjectClass(),!a.IsGlobal()&&a.HasPersistBehavior()&&this._SaveSceneGraphInfoToPersist(d);this._persistedIntances.clear()}ResetPersistData(){this._persistData={};this._isFirstVisit=!0}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){const a=this._runtime,b=a.GetRenderer().IsWebGL();
return"low"===a.GetCanvasManager().GetCurrentFullscreenScalingQuality()||b&&a.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect()||b&&a.Uses3DFeatures()}_MaybeStartDrawToOwnTexture(a){const b=this._runtime.GetCanvasManager();this.UsesOwnTexture()?(a.SetRenderTarget(null),a.ClearRgba(0,0,0,0),a={sampling:this._runtime.GetSampling(),isSampled:a.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:a.IsWebGPU()?this._runtime.UsesAnyBackgroundBlending():
!1},"low"===b.GetCurrentFullscreenScalingQuality()&&(a.width=b.GetDrawWidth(),a.height=b.GetDrawHeight()),this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(a)):this._curRenderTarget=null}_MaybeCopyOwnTextureToBackbuffer(a){this._runtime._NeedsHTMLLayerCompositing(a)&&(a.SetDepthEnabled(!1),a.SetRenderTarget(null),a.SetTextureFillMode(),a.CopyRenderTarget(this._curRenderTarget))}_MaybeEndDrawToOwnTexture(a){this.UsesOwnTexture()&&(a.SetDepthEnabled(!1),this._DrawLayoutOwnTextureToRenderTarget(a,
this._curRenderTarget))}DrawMain(a){a.SetRenderTarget(this._curRenderTarget);a.Clear(this.GetLayoutBackgroundColor());this._runtime.Uses3DFeatures()&&a.ClearDepth();const b=this.GetRootLayersForHTMLLayer(0);this._DrawLayerList(a,this._curRenderTarget,b,!0);a.IsWebGPU()&&a.StartMeasuringRenderPassTime(0,1);this._MaybeEndDrawToOwnTexture(a);this._curRenderTarget=null}DrawForHTMLLayerIndex(a,b){let d=null;this._runtime._NeedsHTMLLayerCompositing(a)&&(d=this._curRenderTarget);a.SetRenderTarget(d);a.ClearRgba(0,
0,0,0);this._runtime.Uses3DFeatures()&&a.ClearDepth();const c=this.GetRootLayersForHTMLLayer(b);this._DrawLayerList(a,d,c,!0);this._MaybeCopyOwnTextureToBackbuffer(a);a.EndBatch();this._runtime.GetCanvasManager().BlitMainCanvasToHTMLLayerCanvas(b)}_DrawLayerList(a,b,d,c){d=d.filter(e=>e.ShouldDraw());for(let e=0,g=d.length;e<g;){const k=d[e];if(k.SelfAndAllSubLayersHave3DCamera()&&!k.SelfOrAnySubLayerUsesOwnTexture()){tempRender3dList.push(k);for(let l=e+1;l<g;++l){const n=d[l];if(n.SelfAndAllSubLayersHave3DCamera()&&
!n.SelfOrAnySubLayerUsesOwnTexture())tempRender3dList.push(d[l]);else break}if(2<=tempRender3dList.length||1===tempRender3dList.length&&tempRender3dList[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(a,b,tempRender3dList);e+=tempRender3dList.length;C3$jscomp$104.clearArray(tempRender3dList);continue}C3$jscomp$104.clearArray(tempRender3dList)}k.Draw(a,b,c&&0===e);++e}}_DrawLayoutOwnTextureToRenderTarget(a,b){const d=this._effectList.GetActiveEffectTypes(),c=this._runtime;0===d.length?(a.SetRenderTarget(null),
a.SetTextureFillMode(),a.CopyRenderTarget(b),a.InvalidateRenderTarget(b),c.ReleaseAdditionalRenderTarget(b)):(tempLayoutRect.set(0,0,c.GetViewportWidth(),c.GetViewportHeight()),this.GetEffectChain().Render(a,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:tempLayoutRect,drawSurfaceRect:null,invalidateRenderTargets:!0}))}_Draw3DLayers(a,b,d){d[0].IsTransparent()||
(tempColor$jscomp$4.copyRgb(d[0].GetBackgroundColor()),tempColor$jscomp$4.setA(1),a.Clear(tempColor$jscomp$4));this._runtime.GetCanvasManager();a.SetDepthEnabled(!0);for(var c of d)c._UpdateZIndices(),c._AppendAllInstancesIncludingSubLayersInDrawOrder(tempInstanceList1$jscomp$1);c=d[0];d=c._MaybeStartWebGLProfiling(a);c._MaybeStartWebGPUProfiling(a);for(let n=0,p=tempInstanceList1$jscomp$1.length;n<p;){var e=tempInstanceList1$jscomp$1[n],g=e.GetWorldInfo(),k=g.GetLayer();if(g.IsVisible()&&g.IsInViewport3D(k._GetViewFrustum())){(!e.RendersToOwnZPlane()||
0<g.GetDepth())&&tempInstanceList3.push(e);var l=e.GetWorldInfo().GetTotalZElevation();tempInstanceList2$jscomp$1.push(e);for(c=n+1;c<p;++c){const r=tempInstanceList1$jscomp$1[c],w=r.GetWorldInfo();if(w.IsVisible()&&w.IsInViewport3D(w.GetLayer()._GetViewFrustum())){if(w.GetTotalZElevation()!==l)break;r.RendersToOwnZPlane()?(0<w.GetDepth()&&tempInstanceList3.push(r),tempInstanceList2$jscomp$1.push(r)):tempInstanceList3.push(r)}}if(1!==tempInstanceList2$jscomp$1.length||tempInstanceList2$jscomp$1[0].MustMitigateZFighting()){this._Draw3DLayersCoplanarInstances(a,
b,tempInstanceList2$jscomp$1);for(let r=0,w=tempInstanceList3.length;r<w;++r)e=tempInstanceList3[r],g=e.GetWorldInfo(),k=g.GetLayer(),g._SetDrawNonBackFacesOnly(!0),MaybePrepareLayerDraw(k,a),k._DrawInstanceMaybeWithEffects(e,g,a,b),g._SetDrawNonBackFacesOnly(!1)}else{MaybePrepareLayerDraw(k,a);k._DrawInstanceMaybeWithEffects(e,g,a,b);for(let r=0,w=tempInstanceList3.length;r<w;++r)g=tempInstanceList3[r],g!==e&&(k=g.GetWorldInfo(),l=k.GetLayer(),MaybePrepareLayerDraw(l,a),l._DrawInstanceMaybeWithEffects(g,
k,a,b))}n=c;C3$jscomp$104.clearArray(tempInstanceList2$jscomp$1);C3$jscomp$104.clearArray(tempInstanceList3)}else++n}d&&a.EndQuery(d);C3$jscomp$104.clearArray(tempInstanceList1$jscomp$1);lastLayerPreparedForDrawing=null}_Draw3DLayersCoplanarInstances(a,b,d){a.CoplanarStartStencilPass();for(let k=0,l=d.length;k<l;++k){var c=d[k],e=c.GetWorldInfo(),g=e.GetLayer();e._SetDrawBackFaceOnly(!0);MaybePrepareLayerDraw(g,a);g._DrawInstance(c,e,a)}a.CoplanarStartColorPass();for(let k=0,l=d.length;k<l;++k)c=
d[k],e=c.GetWorldInfo(),g=e.GetLayer(),MaybePrepareLayerDraw(g,a),g._DrawInstanceMaybeWithEffects(c,e,a,b),e._SetDrawBackFaceOnly(!1);a.CoplanarRestoreStandardRendering()}_SaveToJson(){const a={sx:this.GetScrollX(),sy:this.GetScrollY(),s:this.GetScale(),a:this.GetAngle(),w:this.GetWidth(),h:this.GetHeight(),ortho:this.IsOrthographicProjection(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY(),fv:this._isFirstVisit,persist:this._persistData,fx:this._effectList.SaveToJson(),layers:{},dynamicLayers:[]};
for(const b of this._allLayersFlat)if(b.IsDynamic()){const d=b.GetParentLayer();a.dynamicLayers.push({sid:b.GetSID(),name:b.GetName(),parentSid:d?d.GetSID():null,siblingIndex:b._GetSiblingIndex(),data:b._SaveToJson()})}else a.layers[b.GetSID().toString()]=b._SaveToJson();return a}_LoadFromJson(a){this._scrollX=a.sx;this._scrollY=a.sy;this._scale=a.s;this._angle=a.a;this._width=a.w;this._height=a.h;this._isOrthographicProjection=!!a.ortho;a.hasOwnProperty("vpX")&&(this._vanishingPointX=a.vpX);a.hasOwnProperty("vpY")&&
(this._vanishingPointY=a.vpY);this._isFirstVisit=!!a.fv;this._persistData=a.persist;this._effectList.LoadFromJson(a.fx);this._needsRebuildEffectChainSteps=!0;for(const [l,n]of Object.entries(a.layers)){var b=parseInt(l,10);(b=this.GetLayerBySID(b))&&b._LoadFromJson(n)}if(a.hasOwnProperty("dynamicLayers")){this.RemoveAllDynamicLayers();this._runtime.FlushPendingInstances();b=new Map;a=a.dynamicLayers;for(var d=a.length-1;0<=d;--d){var c=a[d],e=c.sid,g=c.name,k=c.parentSid;const l=c.siblingIndex;c=
c.data;this._ReindexLayers();if(this.HasLayerByName(g)||this.GetLayerBySID(e))continue;let n;if(null===k)n=null,k=this._rootLayers;else{n=this.GetLayerBySID(k);if(!n)continue;k=n.GetSubLayers()}e=C3$jscomp$104.New(C3$jscomp$104.Layer,this,n,{name:g,sid:e,isDynamic:!0});k.push(e);g=b.get(k);g||(g=[],b.set(k,g));g.push({layer:e,siblingIndex:l});e._LoadFromJson(c)}for(const [l,n]of b){n.sort((p,r)=>p.siblingIndex-r.siblingIndex);for(const p of n)b=p.layer,a=p.siblingIndex,d=l.indexOf(b),l.splice(d,1),
l.splice(a,0,b)}}this._ReindexAndUpdateAllLayers();this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(a){a.layout=this.GetILayout();var b=this._runtime;(b=b.IsDebug()&&!b.GetEventSheetManager().IsInEventEngine())&&C3Debugger.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(a);b&&C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(a){a.layout=
this.GetILayout();return this._userScriptDispatcher.dispatchEventAndWaitAsync(a)}DispatchRuntimeUserScriptEventAsyncWait(a){a.layout=this.GetILayout();return this._runtime.DispatchUserScriptEventAsyncWait(a)}_LogLayerTree(){this._LogLayerList(this._rootLayers)}_LogLayerList(a,b=0){a=a.slice(0);a.reverse();for(const d of a)console.log(`${"\t".repeat(b)}- ${d.GetName()}`),this._LogLayerList(d.GetSubLayers(),b+1)}};"use strict";const C3$jscomp$105=self.C3;
C3$jscomp$105.LayoutManager=class extends C3$jscomp$105.DefendedBase{constructor(a){super();this._runtime=a;this._allLayouts=[];this._layoutsByName=new Map;this._layoutsBySid=new Map;this._mainRunningLayout=null;this._runningSubLayouts=[];this._firstLayout=null;this._isEndingLayout=0;this._pendingChangeLayout=null}Release(){this._pendingChangeLayout=this._firstLayout=this._mainRunningLayout=this._runtime=null;C3$jscomp$105.clearArray(this._allLayouts);this._layoutsByName.clear();this._layoutsBySid.clear();
C3$jscomp$105.clearArray(this._runningSubLayouts)}Create(a){a=C3$jscomp$105.New(C3$jscomp$105.Layout,this,this._allLayouts.length,a);this._allLayouts.push(a);this._layoutsByName.set(a.GetName().toLowerCase(),a);this._layoutsBySid.set(a.GetSID(),a)}GetRuntime(){return this._runtime}SetFirstLayout(a){this._firstLayout=a}GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw Error("no first layout");}GetLayoutByName(a){return this._layoutsByName.get(a.toLowerCase())||
null}GetLayoutBySID(a){return this._layoutsBySid.get(a)||null}GetLayoutByIndex(a){a=C3$jscomp$105.clamp(Math.floor(a),0,this._allLayouts.length-1);return this._allLayouts[a]}GetLayout(a){return"number"===typeof a?this.GetLayoutByIndex(a):this.GetLayoutByName(a.toString())}GetAllLayouts(){return this._allLayouts}_SetMainRunningLayout(a){this._mainRunningLayout=a}GetMainRunningLayout(){return this._mainRunningLayout}_AddRunningSubLayout(a){if(this._runningSubLayouts.includes(a))throw Error("layout already running");
this._runningSubLayouts.push(a)}_RemoveRunningSubLayout(a){a=this._runningSubLayouts.indexOf(a);if(-1===a)throw Error("layout not running");this._runningSubLayouts.splice(a,1)}*runningLayouts(){this._mainRunningLayout&&(yield this._mainRunningLayout);this._runningSubLayouts.length&&(yield*this._runningSubLayouts)}IsLayoutRunning(a){return this._mainRunningLayout===a||this._runningSubLayouts.includes(a)}SetIsEndingLayout(a){if(a)this._isEndingLayout++;else{if(0>=this._isEndingLayout)throw Error("already unset");
this._isEndingLayout--}}IsEndingLayout(){return 0<this._isEndingLayout}ChangeMainLayout(a){this._pendingChangeLayout=a}ClearPendingChangeLayout(){this._pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this._pendingChangeLayout}GetPendingChangeMainLayout(){return this._pendingChangeLayout}SetAllLayerProjectionChanged(){const a=this.GetMainRunningLayout();a&&a._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){const a=this.GetMainRunningLayout();a&&a._SetAllLayersMVChanged()}};"use strict";
const C3$jscomp$106=self.C3,NAMES_REGEXP=RegExp("<(.+?)>","g");
C3$jscomp$106.TimelineManager=class extends C3$jscomp$106.DefendedBase{constructor(a){super();this._runtime=a;this._timelineDataManager=C3$jscomp$106.New(C3$jscomp$106.TimelineDataManager);this._pluginInstance=null;this._timelines=[];this._timelinesByName=new Map;this._objectClassToTimelineMap=new Map;this._timelinesCreatedByTemplate=new Map;this._scheduledTimelines=[];this._playingTimelines=[];this._markedForRemovalTimelines=[];this._isTickingTimelines=this._changingLayout=this._hasRuntimeListeners=
!1;this._tickFunc=()=>this._OnTick();this._tick2Func=()=>this._OnTick2();this._beforeLayoutChange=()=>this._OnBeforeChangeLayout();this._layoutChange=()=>this._OnAfterChangeLayout();this._instanceDestroy=b=>this._OnInstanceDestroy(b.instance);this._beforeLoad=b=>this._OnBeforeLoad();this._afterLoad=b=>this._OnAfterLoad();this._afterLayoutStart=b=>this._OnAfterLayoutStart();this._destroyedWhileLoadingState=[];this._renderChange=0}Release(){this.RemoveRuntimeListeners();this._afterLoad=this._instanceDestroy=
this._layoutChange=this._beforeLayoutChange=this._tick2Func=this._tickFunc=null;for(const a of this._timelines)a.Stop(),a.Release();C3$jscomp$106.clearArray(this._timelines);this._timelines=null;this._timelineDataManager.Release();this._timelineDataManager=null;C3$jscomp$106.clearArray(this._scheduledTimelines);this._scheduledTimelines=null;C3$jscomp$106.clearArray(this._playingTimelines);this._playingTimelines=null;C3$jscomp$106.clearArray(this._markedForRemovalTimelines);this._markedForRemovalTimelines=
null;this._timelinesByName.clear();this._timelinesByName=null;this._objectClassToTimelineMap.clear();this._objectClassToTimelineMap=null;this._timelinesCreatedByTemplate.clear();this._timelinesCreatedByTemplate=null;C3$jscomp$106.clearArray(this._destroyedWhileLoadingState);this._runtime=this._destroyedWhileLoadingState=null}AddRuntimeListeners(){const a=this._runtime.Dispatcher();a.addEventListener("pretick",this._tickFunc);a.addEventListener("tick2",this._tick2Func);a.addEventListener("beforelayoutchange",
this._beforeLayoutChange);a.addEventListener("layoutchange",this._layoutChange);a.addEventListener("instancedestroy",this._instanceDestroy);a.addEventListener("beforeload",this._beforeLoad);a.addEventListener("afterload",this._afterLoad);a.addEventListener("afterlayoutstart",this._afterLayoutStart)}RemoveRuntimeListeners(){const a=this._runtime.Dispatcher();a.removeEventListener("pretick",this._tickFunc);a.removeEventListener("tick2",this._tick2Func);a.removeEventListener("beforelayoutchange",this._beforeLayoutChange);
a.removeEventListener("layoutchange",this._layoutChange);a.removeEventListener("instancedestroy",this._instanceDestroy);a.removeEventListener("beforeload",this._beforeLoad);a.removeEventListener("afterload",this._afterLoad);a.removeEventListener("afterlayoutstart",this._afterLayoutStart)}Create(a){this._timelineDataManager.Add(a);a=C3$jscomp$106.TimelineState.CreateInitial(a,this);this.Add(a);this.SetTimelineObjectClassesToMap(a);this._timelinesCreatedByTemplate.set(a.GetName(),0)}CreateFromTemplate(a){var b=
this.GetTimelineDataManager();a=a.GetTemplateName();b=b.Get(a);b=C3$jscomp$106.TimelineState.CreateFromTemplate(`${a}:${this._timelinesCreatedByTemplate.get(a)}`,b,this);this._IncreaseTemplateTimelinesCount(a);this.Add(b);return b}_IncreaseTemplateTimelinesCount(a){this._timelinesCreatedByTemplate.set(a,this._timelinesCreatedByTemplate.get(a)+1)}_SetCreatedTemplateTimelinesCount(){for(const a of this._timelines){if(a.IsTemplate())continue;const b=a.GetTemplateName();this._IncreaseTemplateTimelinesCount(b)}}_ClearCreatedTemplateTimelinesCount(){for(const a of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(a,
0)}Add(a){this._timelines.push(a);this._timelinesByName.set(a.GetName().toLowerCase(),a)}Remove(a){a.Removed();a.IsTemplate()||(C3$jscomp$106.arrayFindRemove(this._timelines,a),C3$jscomp$106.arrayFindRemove(this._scheduledTimelines,a),C3$jscomp$106.arrayFindRemove(this._playingTimelines,a),C3$jscomp$106.arrayFindRemove(this._markedForRemovalTimelines,a),this._timelinesByName.delete(a.GetName().toLowerCase()),this.RemoveTimelineFromObjectClassMap(a),a.IsReleased()||a.Release())}Trigger(a){this._runtime.Trigger(a,
this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(a){this._pluginInstance=a}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(const a of this._timelines)yield a}*GetPlayingTimelines(){for(const a of this._playingTimelines)yield a}SetTimelineObjectClassToMap(a,b){this._objectClassToTimelineMap.has(a)||this._objectClassToTimelineMap.set(a,new Set);this._objectClassToTimelineMap.get(a).add(b)}SetTimelineObjectClassesToMap(a){for(const b of a.GetObjectClasses())this.SetTimelineObjectClassToMap(b,
a)}RemoveTimelineFromObjectClassMap(a){for(const [b,d]of this._objectClassToTimelineMap.entries())d.has(a)&&(d.delete(a),0===d.size&&this._objectClassToTimelineMap.delete(b))}GetTimelinesForObjectClass(a){if(this._objectClassToTimelineMap.has(a))return this._objectClassToTimelineMap.get(a)}GetTimelineOfTemplateForInstances(a,b){if(b)for(const d of this._timelines)if(b.every(c=>d.HasTrackInstance(c.instance,c.trackId))&&d.GetName().includes(a.GetName()))return d}GetTimelineByName(a){return this._timelinesByName.get(a.toLowerCase())||
null}GetScheduledOrPlayingTimelineByName(a){for(const b of this._scheduledTimelines)if(b.GetName()===a)return b;for(const b of this._playingTimelines)if(b.GetName()===a)return b;return null}*GetTimelinesByName(a){if(NAMES_REGEXP.test(a)){NAMES_REGEXP.lastIndex=0;let d;var b=new Set;do if(d=NAMES_REGEXP.exec(a)){const c=d[1].split(",");for(const e of c)b.add(e)}while(d);for(const c of b.values())(a=this.GetTimelineByName(c))&&(yield a);b.clear()}else(b=this.GetTimelineByName(a))&&(yield b)}*GetTimelinesByTags(a){for(const b of this._timelines)b.HasTags(a)&&
(yield b)}AddScheduledTimeline(a){this._scheduledTimelines.includes(a)||this._scheduledTimelines.push(a);this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(a){C3$jscomp$106.arrayFindRemove(this._playingTimelines,a);this._MaybeDisableRuntimeListeners()}ScheduleTimeline(a){this._playingTimelines.includes(a)?(a.SetPlaying(!0),a.SetScheduled(!1),a.SetMarkedForRemoval(!1)):(a.SetPlaying(!1),a.SetScheduled(!0),a.SetMarkedForRemoval(!1),this._scheduledTimelines.includes(a)||this._scheduledTimelines.push(a));
this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(a){a.SetPlaying(!1);a.SetScheduled(!1);a.ResolvePlayPromise();C3$jscomp$106.arrayFindRemove(this._scheduledTimelines,a);this._MaybeDisableRuntimeListeners()}CompleteTimeline(a){a.SetPlaying(!1);a.SetScheduled(!1);this._playingTimelines.includes(a)&&(a.SetMarkedForRemoval(!0),this._markedForRemovalTimelines.push(a),C3$jscomp$106.arrayFindRemove(this._playingTimelines,a))}CompleteTimelineBeforeChangeOfLayout(a){a.SetPlaying(!1);a.SetScheduled(!1);
a.SetMarkedForRemoval(!1);a.SetPlaybackRate(1);C3$jscomp$106.arrayFindRemove(this._playingTimelines,a)}CompleteTimelineAndResolve(a){this.CompleteTimeline(a);a.ResolvePlayPromise()}_OnTick(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){for(this._isTickingTimelines=!0;this._scheduledTimelines.length;){var a=this._scheduledTimelines.pop();a.SetInitialState();0!==a.GetRenderChange()&&(this._renderChange=1);this._playingTimelines.push(a)}a=this._runtime._GetDtFast();
var b=this._runtime.GetDt1(),d=this._runtime.GetTimeScale();for(let c=this._playingTimelines.length-1;0<=c;c--){const e=this._playingTimelines[c];e&&e.Tick(a,d,b)}this._isTickingTimelines=!1;0!==this._renderChange&&this.GetRuntime().UpdateRender()}}_OnTick2(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){var a;for(let b=0,d=this._markedForRemovalTimelines.length;b<d;b++){const c=this._markedForRemovalTimelines[b];a||(a=new Set);c.Removed();this._MaybeExecuteTimelineFinishTriggers(c);
a.add(c)}if(a){C3$jscomp$106.arrayRemoveAllInSet(this._markedForRemovalTimelines,a);this._renderChange=0;for(let b=0,d=this._playingTimelines.length;b<d;b++)if(0!==this._playingTimelines[b].GetRenderChange()){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}}_MaybeExecuteTimelineFinishTriggers(a){a.IsReleased()||a.HasValidTracks()&&a.IsComplete()&&a.InitialStateSet()&&a.FinishTriggers()}_MaybeEnableRuntimeListeners(){this._hasRuntimeListeners||(this._hasRuntimeListeners=!0)}_MaybeDisableRuntimeListeners(){this._markedForRemovalTimelines.length||
this._playingTimelines.length||this._scheduledTimelines.length||this._isTickingTimelines||(this._hasRuntimeListeners=!1)}_OnBeforeChangeLayout(){for(this._changingLayout=!0;this._scheduledTimelines.length;)this.DeScheduleTimeline(this._scheduledTimelines.pop());const a=new Set;for(const b of this._playingTimelines)b._OnBeforeChangeLayout()&&(b.Removed(),a.add(b));C3$jscomp$106.arrayRemoveAllInSet(this._playingTimelines,a);a.clear();for(const b of this._markedForRemovalTimelines)b._OnBeforeChangeLayout()&&
(b.Removed(),a.add(b));C3$jscomp$106.arrayRemoveAllInSet(this._markedForRemovalTimelines,a);this._MaybeDisableRuntimeListeners();for(const b of this._timelines)b.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=!1}_OnInstanceDestroy(a){var b=a.GetObjectClass();if(b=this.GetTimelinesForObjectClass(b))if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(a);else for(const d of b)d.IsTemplate()||(d.IsReleased()?this.Remove(d):d.HasValidTracks()||(this._MaybeExecuteTimelineFinishTriggers(d),
this.Remove(d)))}_OnBeforeLoad(){for(const a of this._scheduledTimelines.map(b=>b))this._MaybeExecuteTimelineFinishTriggers(a),this.Remove(a);for(const a of this._playingTimelines.map(b=>b))this._MaybeExecuteTimelineFinishTriggers(a),this.Remove(a)}_OnAfterLoad(){for(const a of this._destroyedWhileLoadingState)this._OnInstanceDestroy(a);C3$jscomp$106.clearArray(this._destroyedWhileLoadingState);for(const a of this._timelines)a._OnAfterLoad()}_OnAfterLayoutStart(){const a=this._runtime.GetLayoutManager().GetMainRunningLayout();
if(a)for(const b of this._timelines){const d=b.GetStartOnLayout();d&&a.GetName()===d&&this.ScheduleTimeline(b)}}_SaveToJson(){return{timelinesJson:this._SaveTimelinesToJson(),scheduledTimelinesJson:this._SaveScheduledTimelinesToJson(),playingTimelinesJson:this._SavePlayingTimelinesToJson(),markedForRemovalTimelinesJson:this._SaveMarkedForRemovalTimelinesToJson(),hasRuntimeListeners:this._hasRuntimeListeners,changingLayout:this._changingLayout,isTickingTimelines:this._isTickingTimelines}}_LoadFromJson(a){a&&
(this._ClearCreatedTemplateTimelinesCount(),this._LoadTimelinesFromJson(a.timelinesJson),this._LoadScheduledTimelinesFromJson(a.scheduledTimelinesJson),this._LoadPlayingTimelinesFromJson(a.playingTimelinesJson),this._LoadMarkedForRemovalTimelinesFromJson(a.markedForRemovalTimelinesJson),this._hasRuntimeListeners=!a.hasRuntimeListeners,this._changingLayout=!!a.changingLayout,this._isTickingTimelines=!!a.isTickingTimelines,this._SetCreatedTemplateTimelinesCount(),this._MaybeEnableRuntimeListeners(),
this._MaybeDisableRuntimeListeners())}_SaveTimelinesToJson(){return this._timelines.map(a=>a._SaveToJson())}_LoadTimelinesFromJson(a){for(const b of a){a=this.GetTimelineByName(b.name);if(!a){a=this._GetTemplateNameFromJson(b);if(!a)continue;a=this.GetTimelineByName(a);a=this.CreateFromTemplate(a)}a._LoadFromJson(b);a.HasTracks()||this.Remove(a)}}_GetTemplateNameFromJson(a){return(a=a.name.split(":"))&&2===a.length?a[0]:null}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(a){this._LoadTimelines(a,
this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(a){this._LoadTimelines(a,this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(a){this._LoadTimelines(a,this._markedForRemovalTimelines)}_IsTimelineInJson(a,b){if(!b)return!1;for(const d of b)if(d===a.GetName())return!0;return!1}_SaveTimelines(a){return a.map(b=>
b.GetName())}_LoadTimelines(a,b){var d=new Set;for(const c of b)this._IsTimelineInJson(c,a)||d.add(c);C3$jscomp$106.arrayRemoveAllInSet(b,d);if(a){d=c=>e=>e.GetName()===c;for(const c of a)(a=this.GetTimelineByName(c))&&(b.find(d(c))||b.push(a))}}};"use strict";const C3$jscomp$107=self.C3,TANGENT_RESULT=[0,0],MAP_RESULT=[0,0],PROJECTION_RESULT=[0,0,0,0,0];
C3$jscomp$107.TimelineInfo=class{constructor(a,b){this._initialized=!1;this._timeline=a;this._segments=[];if(b=b?this._timeline.GetTrackById(b):C3$jscomp$107.first(this._timeline.GetTracks()))if(a=b.GetPropertyTrack("offsetX"),b=b.GetPropertyTrack("offsetY"),a&&b){this._xTrack=a;this._yTrack=b;a=a.GetPropertyKeyframeDataItemArrayIncludingDisabled();b=b.GetPropertyKeyframeDataItemArrayIncludingDisabled();for(let d=1,c=Math.min(a.length,b.length);d<c;++d){const e=a[d];e.GetNext();const g=e.GetPrevious(),
k=b[d];k.GetNext();const l=k.GetPrevious();g&&"cubic-bezier"===g.GetPathMode()&&l&&"cubic-bezier"===l.GetPathMode()?this._segments.push(C3$jscomp$107.New(C3$jscomp$107.TimelineCubicBezierSegmentInfo,g,l,e,k,this._segments.length)):(g&&"line"===g.GetPathMode()&&l&&l.GetPathMode(),this._segments.push(C3$jscomp$107.New(C3$jscomp$107.TimelineLineSegmentInfo,e,k,this._segments.length)))}this._initialized=!0}}Release(){for(const a of this._segments)a.Release();C3$jscomp$107.clearArray(this._segments);this._yTrack=
this._xTrack=this._timeline=this._segments=null}WasInitialized(){return this._initialized}segments(){return this._segments}SetOrigin(a){const b="relative"===this._xTrack.GetResultMode()?a.GetX():0;a="relative"===this._yTrack.GetResultMode()?a.GetY():0;for(const d of this._segments)d.SetOrigin(b,a)}Project(a,b,d){d&&d.tRange&&(C3$jscomp$107.IsFiniteNumber(d.tRange[0])||(d.tRange[0]=0),C3$jscomp$107.IsFiniteNumber(d.tRange[1])||(d.tRange[1]=1));const c=[];for(const e of this._segments)if("cubic-bezier"===
e.GetType()){const g=e.Project(a,b,d?d.tRange:null);g[4]=e.GetIndex();c.push(JSON.parse(JSON.stringify(g)))}c.sort((e,g)=>e[3]-g[3]);return c[0]}Tangent(a,b){return this._segments[b].Tangent(a)}TangentAngle(a,b,d,c){return this._segments[c].TangentAngle(a,b,d)}};
C3$jscomp$107.TimelineCubicBezierSegmentInfo=class{constructor(a,b,d,c,e){this._index=e;e=a.GetAddOn("cubic-bezier");const g=d.GetAddOn("cubic-bezier"),k=b.GetAddOn("cubic-bezier"),l=c.GetAddOn("cubic-bezier");this._aX=a.GetValueWithResultMode();this._aY=b.GetValueWithResultMode();this._bX=a.GetValueWithResultMode()+e.GetStartAnchor();this._bY=b.GetValueWithResultMode()+k.GetStartAnchor();this._cX=d.GetValueWithResultMode()+g.GetEndAnchor();this._cY=c.GetValueWithResultMode()+l.GetEndAnchor();this._dX=
d.GetValueWithResultMode();this._dY=c.GetValueWithResultMode();this._initialized=!1;this._len=100;this._arcLengths=Array(this._len+1);this._length=this._arcLengths[0]=0;this._lut=[];this._CalculateLength()}Release(){C3$jscomp$107.clearArray(this._arcLengths);this._arcLengths=null;C3$jscomp$107.clearArray(this._lut);this._lut=null}GetType(){return"cubic-bezier"}GetIndex(){return this._index}GetStepCount(){return Math.floor(this._length/30)}GetStepIncrement(){return 1/this.GetStepCount()}SetOrigin(a,
b){this._originX=a;this._originY=b;this._arcLengths=Array(this._len+1);this._arcLengths[0]=0;this._CalculateLength()}Map(a){if(!this._initialized)return NaN;a=this._Map(a);MAP_RESULT[0]=this._X(a);MAP_RESULT[1]=this._Y(a);return MAP_RESULT}Project(a,b,d){const c=this._GenerateLUT(100);d=this._FindClosestFromLUT(a,b,c,d);a=this._RefineProjection(a,b,c,d);PROJECTION_RESULT[0]=a.x;PROJECTION_RESULT[1]=a.y;PROJECTION_RESULT[2]=a.t;PROJECTION_RESULT[3]=a.distance;return PROJECTION_RESULT}Tangent(a){var b=
1-a,d=b*b;b=2*b*a;const c=a*a;a=3*d*(this._bX+this._originX-(this._aX+this._originX))+3*b*(this._cX+this._originX-(this._bX+this._originX))+3*c*(this._dX+this._originX-(this._cX+this._originX));d=3*d*(this._bY+this._originY-(this._aY+this._originY))+3*b*(this._cY+this._originY-(this._bY+this._originY))+3*c*(this._dY+this._originY-(this._cY+this._originY));b=Math.hypot(a,d);TANGENT_RESULT[0]=a/b;TANGENT_RESULT[1]=d/b;return TANGENT_RESULT}TangentAngle(a,b,d){d=this.Tangent(d);return C3$jscomp$107.angleTo(a,
b,a+d[0],b+d[1])}_Map(a){if(this._initialized){a*=this._arcLengths[this._len];for(var b=0,d=this._len,c=0;b<d;)c=b+((d-b)/2|0),this._arcLengths[c]<a?b=c+1:d=c;this._arcLengths[c]>a&&c--;b=this._arcLengths[c];return b===a?c/this._len:(c+(a-b)/(this._arcLengths[c+1]-b))/this._len}}_X(a){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(a,this._aX+this._originX,this._bX+this._originX,this._cX+this._originX,this._dX+this._originX):NaN}_Y(a){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(a,
this._aY+this._originY,this._bY+this._originY,this._cY+this._originY,this._dY+this._originY):NaN}_GenerateLUT(a){a=a||100;if(this._lut.length===a)return this._lut;this._lut=[];a++;for(let b=0;b<a;b++){const d=b/(a-1),c=this._X(d),e=this._Y(d);this._lut.push({x:c,y:e,t:d,distance:0})}return this._lut}_FindClosestFromLUT(a,b,d,c=null,e=Number.MAX_SAFE_INTEGER){let g=0;d.forEach((k,l)=>{k.t=l/(d.length-1);k.distance=C3$jscomp$107.distanceTo(a,b,k.x,k.y);c&&C3$jscomp$107.IsArray(c)&&C3$jscomp$107.IsFiniteNumber(c[0])&&
C3$jscomp$107.IsFiniteNumber(c[1])?k.t>=c[0]&&k.t<=c[1]&&k.distance<e&&(e=k.distance,g=l):k.distance<e&&(e=k.distance,g=l)});return g}_RefineProjection(a,b,d,c,e=0,g=1){let k=d[c],l=1,n=Number.MAX_SAFE_INTEGER;do{var p=0===c?0:c-1;let r=c===d.length-1?d.length-1:c+1,w=d[p].t,z=[],B=(d[r].t-w)/4;if(.001>B)break;z.push(d[p]);for(p=1;3>=p;p++){const C=w+p*B,E=this._X(C),F=this._Y(C),I=Math.abs(C3$jscomp$107.distanceTo(E,F,a,b)-e);I<n&&(n=I,k={x:E,y:F,t:C,distance:I},c=p);z.push({x:E,y:F,t:C,distance:I})}z.push(d[r]);
d=z}while(25>l++);e&&n>g&&(k=null);return k}_CalculateLength(){this._initialized=!0;let a=this._X(0),b=this._Y(0),d=0;for(let c=1;c<=this._len;c++){const e=this._X(.01*c),g=this._Y(.01*c);d+=Math.hypot(a-e,b-g);this._arcLengths[c]=d;a=e;b=g}this._length=d}};
C3$jscomp$107.TimelineLineSegmentInfo=class{constructor(a,b,d){this._index=d;this._targetX=a.GetValueWithResultMode();this._targetY=b.GetValueWithResultMode();this._originY=this._originX=0}Release(){}GetType(){return"line"}GetIndex(){return this._index}SetOrigin(a,b){this._originX=a;this._originY=b}GetX(){return this._targetX+this._originX}GetY(){return this._targetY+this._originY}};"use strict";const C3$jscomp$108=self.C3;
C3$jscomp$108.TimelineState=class extends C3$jscomp$108.DefendedBase{constructor(a,b,d){super();this._runtime=d.GetRuntime();this._timelineManager=d;this._timelineDataItem=b;this._name=a;this._tracks=[];this._tracksLength=0;this._beforeAndAfterTracks=null;this._beforeAndAfterTracksLength=0;this.CreateTrackStates();this._playResolve=this._playPromise=null;this._overshoot=this._playheadTime=0;this._playbackRate=1;this._pingPongState=0;this._currentRepeatCount=1;this._initialStateSet=this._isScheduled=
this._isPlaying=!1;this._complete=!0;this._markedForRemoval=this._released=!1;this._completedTick=-1;this._firstTick=this._finishedTriggers=this._isTemplate=this._implicitPause=!1;this._lastDelta=NaN;this._tags=[""];this._stringTags="";this._tagsChanged=!1;this._hasNestedContent=this._renderChange=0;this._iTimelineState=null}static CreateInitial(a,b){var d=b.GetTimelineDataManager();const c=d.GetNameId();d=d.Get(a[c]);a=C3$jscomp$108.New(C3$jscomp$108.TimelineState,a[c],d,b);a.SetIsTemplate(!0);return a}static CreateFromTemplate(a,
b,d){return C3$jscomp$108.New(C3$jscomp$108.TimelineState,a,b,d)}Release(){if(!this.IsReleased()){var a=this._runtime.Dispatcher();this._timelineManager.DeScheduleTimeline(this);this._timelineManager.CompleteTimelineAndResolve(this);for(const b of this._tracks)b.Release();C3$jscomp$108.clearArray(this._tracks);this._timelineDataItem=this._timelineManager=this._runtime=this._tracks=null;this._released=!0;this._playResolve=this._playPromise=null;this.FireReleaseEvent(a)}}FireReleaseEvent(a){const b=
C3$jscomp$108.New(C3$jscomp$108.Event,"timelinestatereleased");b.timelineState=this;a.dispatchEvent(b)}GetType(){return 0}CreateTrackStates(){for(const a of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=this._tracks.push(C3$jscomp$108.TrackState.Create(this,a))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(a,b,d,c){if(this._hasNestedContent){var e;for(let k=0;k<this._tracks.length;k++){var g=
this._tracks[k];a===g.GetInstance()&&(g=g.GetPropertyTrack(d))&&b.constructor===g.GetSourceAdapter().constructor&&g.GetResultMode()===c.GetResultMode()&&(e||(e=[]),e.push(g))}return e}}HasTracks(){return!!this._tracks.length}GetTrackById(a){for(const b of this._tracks)if(C3$jscomp$108.equalsNoCase(b.GetId(),a))return b;return null}GetTrackByName(a){for(const b of this._tracks)if(!b.IsInstanceTrack()&&C3$jscomp$108.equalsNoCase(b.GetName(),a))return b;return null}SetName(a){this._name=a}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(a){this._timelineDataItem.SetTotalTime(a)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(a){this._timelineDataItem.SetStep(a)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(a){this._timelineDataItem.SetInterpolationMode(a)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(a){this._timelineDataItem.GetResultMode(a)}SetEase(a){for(const b of this.GetTracks())b.SetEase(a)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(a){return this._timelineDataItem.SetLoop(a)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(a){return this._timelineDataItem.SetPingPong(a)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetRepeatCount(a){return this._timelineDataItem.SetRepeatCount(a)}SetPlaybackRate(a){return this._playbackRate=
a}GetPlaybackRate(){return this._playbackRate}GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout()}GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph()}GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale()}GetPingPongState(){return this._pingPongState}IsForwardPlayBack(){return this.IsPlaying()?0<this._playbackRate:!0}GetPlayPromise(){return this._playPromise?this._playPromise:this._playPromise=new Promise(a=>{this._playResolve=
a})}ResolvePlayPromise(){this._playPromise&&(this._playResolve(),this._playResolve=this._playPromise=null)}SetTags(a){this._tags=C3$jscomp$108.TimelineState._GetTagArray(a);this._tagsChanged=!0}GetTags(){return this._tags}GetStringTags(){this._tagsChanged&&(this._stringTags=this._tags.join(" "));this._tagsChanged=!1;return this._stringTags}HasTags(a){return this._tags&&this._tags.length?(a=C3$jscomp$108.TimelineState._GetTagArray(a))&&a.length?a.every(C3$jscomp$108.TimelineState._HasTag,this):!1:
!1}OnStarted(){C3$jscomp$108.Plugins.Timeline&&this.constructor===C3$jscomp$108.TimelineState&&(C3$jscomp$108.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimelineStarted),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimelineStartedByName),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimelineStartedByTags),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnAnyTimelineStarted),
C3$jscomp$108.Plugins.Timeline.Cnds.PopTriggerTimeline())}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){this._finishedTriggers||(this._finishedTriggers=!0,C3$jscomp$108.Plugins.Timeline&&this.constructor===C3$jscomp$108.TimelineState&&(C3$jscomp$108.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimelineFinished),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimelineFinishedByName),
this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimelineFinishedByTags),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnAnyTimelineFinished),C3$jscomp$108.Plugins.Timeline.Cnds.PopTriggerTimeline()))}SetPlaying(a){this._isPlaying=a}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(a=!1){return this.IsCompletedTick()||this.IsScheduled()&&!a?!0:this._isPlaying}_IsPlaying(){return this.IsPlaying(!0)}IsPaused(){return this._IsPaused()}_IsPaused(){return this.IsReleased()||
this.IsScheduled()||this._IsPlaying()||this.IsComplete()?!1:!0}SetScheduled(a){this._isScheduled=a}IsScheduled(){return this._isScheduled}SetComplete(a){this._complete=a;a=this.GetTime();if(0>=a||a>=this.GetTotalTime())this._complete=!0}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(a){this._markedForRemoval=a}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(a){this._implicitPause=a}IsImplicitPause(){return this._implicitPause}SetIsTemplate(a){this._isTemplate=
!!a}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(a){const b=this.GetTime();this._SetTime(a);this.SetComplete(!1);this.IsComplete()||this.SetImplicitPause(!0);if(this._IsPlaying()||this.IsScheduled()||!this._initialStateSet)this._IsPlaying()||this.IsScheduled()||this._initialStateSet?this._IsPlaying()?this.Stop():this.IsScheduled()&&(this._timelineManager.DeScheduleTimeline(this),this.SetInitialStateFromSetTime()):this.SetInitialStateFromSetTime();
this._SetUpdateStateBefore();this._Interpolate(this.GetTime(),!1,!0,!0,b);this._SetUpdateStateAfter();this._renderChange&&this.GetRuntime().UpdateRender();this._OnSetTime()}_SetTime(a){C3$jscomp$108.IsFiniteNumber(a)||(a=this.GetTotalTime());0>a?this._playheadTime=0:a>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=a}_SetTimeAndReset(a){C3$jscomp$108.IsFiniteNumber(a)||(a=this.GetTotalTime());0>a?this._playheadTime=0:a>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():
this._playheadTime=a;for(const b of this._tracks)b.SetResetState()}_OnSetTime(){C3$jscomp$108.Plugins.Timeline&&this.constructor===C3$jscomp$108.TimelineState&&(C3$jscomp$108.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimeSet),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimeSetByName),this._timelineManager.Trigger(C3$jscomp$108.Plugins.Timeline.Cnds.OnTimeSetByTags),C3$jscomp$108.Plugins.Timeline.Cnds.PopTriggerTimeline())}_CanResume(){if(!this.GetLoop())if(this.GetPingPong()&&
1===this._pingPongState)if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else{if(0>=this.GetTime())return!1}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(0>=this.GetTime())return!1;return!0}Resume(){this.IsReleased()||this._CanResume()&&this.Play(!0)}Play(a=!1){return this.IsReleased()||this.IsScheduled()?!1:this._IsPlaying()&&this.IsCompletedTick()?this._SchedulePlayingTimeline():this._IsPlaying()||
!this.IsComplete()&&!a&&!this.IsImplicitPause()?!1:this._ScheduleStoppedTimeline()}_SchedulePlayingTimeline(){this.SetImplicitPause(!1);this._timelineManager.RemovePlayingTimeline(this);this._timelineManager.ScheduleTimeline(this);this.GetPlayPromise();return!0}_ScheduleStoppedTimeline(){this.SetImplicitPause(!1);this._timelineManager.ScheduleTimeline(this);this.GetPlayPromise();return!0}Stop(a=!1){this.IsReleased()||(this.SetComplete(a),this._timelineManager.CompleteTimeline(this),this.IsComplete()&&
this.ResolvePlayPromise())}Reset(a=!0,b=!1){if(!this.IsReleased()){if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(!this.IsComplete()){this.Stop(!0);this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime());var d=this.GetTime();this._SetUpdateStateBefore();b?this._InterpolateBeforeChangeLayout(d):this._Interpolate(d,!1,!1,!0);a&&this._OnSetTime();this._SetUpdateStateAfter();this._renderChange&&a&&this.GetRuntime().UpdateRender()}}}ResetBeforeChangeLayout(){this.Reset(!1,
!0)}_InterpolateBeforeChangeLayout(a){this._Interpolate(a,!1,!1,!0,NaN,!1,!0)}_OnBeforeChangeLayout(){if(this.IsReleased())return!0;if(!this.GetRuntime().IsLoadingState()&&this.HasValidGlobalTracks())return!1;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this);this.GetRuntime().IsLoadingState()||this.ResetBeforeChangeLayout();return!0}SetInitialStateFromSetTime(){this.SetInitialState(!0)}SetInitialState(a){if(!this.IsMarkedForRemoval()){if(a){this._finishedTriggers=!1;this._firstTick=
this._initialStateSet=!0;this._SetUpdateStateBefore();for(const b of this._tracks)b.SetInitialState()}else if(this.SetPlaying(!0),this.SetScheduled(!1),this.OnStarted(),this.IsComplete()){this._completedTick=-1;0!==this._pingPongState&&(this._playbackRate=Math.abs(this._playbackRate));this._pingPongState=0;this._currentRepeatCount=1;this._finishedTriggers=this._complete=!1;this._firstTick=this._initialStateSet=!0;this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime());this._SetUpdateStateBefore();
for(const b of this._tracks)b.SetInitialState()}else{this._firstTick=!0;this._finishedTriggers=!1;this._SetUpdateStateBefore();for(const b of this._tracks)b.SetResumeState()}this._SetUpdateStateAfter()}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(const a of this._tracks)a.IsNested()&&(this._hasNestedContent=1)}_SetUpdateStateAfter(){this._renderChange=0;for(const a of this._tracks)a._SetUpdateState(),0===this._renderChange&&1===a.GetRenderChange()&&
(this._renderChange=1),this._beforeAndAfterTracks||1!==a.GetNeedsBeforeAndAfter()||(this._beforeAndAfterTracks||(this._beforeAndAfterTracks=[]),this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(a))}Tick(a,b,d){if(this.GetUseSystemTimescale()){if(0===a&&0===this._lastDelta)return;this._lastDelta=a;a=d}else{if(0===d&&0===this._lastDelta)return;a=this._lastDelta=d;b=1}d=this._playheadTime+this._overshoot;b=d+a*b*this._playbackRate;a=this._timelineDataItem._totalTime;0>b?(this._playheadTime=
0,this._overshoot=-b):b>=a?(this._playheadTime=a,this._overshoot=this._playheadTime-b):(this._playheadTime=b,this._overshoot=0);var c=!1;b=!1;var e=this.GetLoop(),g=this.GetPingPong();e||g?e&&!g?0<this._playbackRate?this._playheadTime>=a&&(this._SetTimeAndReset(0),b=!0):0>=this._playheadTime&&(this._SetTimeAndReset(a),b=!0):!e&&g?0<this._playbackRate?this._playheadTime>=a&&(this._SetTime(a),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?
(this._currentRepeatCount++,this._pingPongState=0):c=!0:0===this._pingPongState&&(this._pingPongState=1)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):c=!0:0===this._pingPongState&&(this._pingPongState=1)):e&&g&&(0<this._playbackRate?this._playheadTime>=a&&(this._SetTime(a),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,this._pingPongState++,
C3$jscomp$108.wrap(this._pingPongState,0,2)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,this._pingPongState++,C3$jscomp$108.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=a&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),b=!0):(this._SetTime(a),c=!0)):0>=this._playheadTime&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(a),
b=!0):(this._SetTime(0),c=!0));e=this._tracksLength;if(c){for(c=0;c<e;c++)this._tracks[c].SetEndState();this.Stop(!0);this.OnCompleted()}else{g=this._beforeAndAfterTracksLength;for(c=0;c<g;c++)this._beforeAndAfterTracks[c].BeforeInterpolate();if(1===this._hasNestedContent)for(c=0;c<e;c++){const k=this._tracks[c],l=k.GetStartOffset(),n=d-l;0>this._playheadTime-l&&0<n?(this._playheadTime=0>l?0:l>=a?a:l,k.Interpolate(l,!0,!1,b,this._firstTick,!1)):k.Interpolate(this._playheadTime,!0,!1,b,this._firstTick,
!1)}else for(c=0;c<e;c++)this._tracks[c].Interpolate(this._playheadTime,!0,!1,b,this._firstTick,!1);for(c=0;c<g;c++)this._beforeAndAfterTracks[c].AfterInterpolate();this._firstTick&&(this._firstTick=!1)}}_Interpolate(a,b=!1,d=!1,c=!1,e=NaN,g=!1,k=!1){for(var l of this._tracks)l.BeforeInterpolate();for(const n of this._tracks){l=a;if("number"===typeof e&&!isNaN(e)){const p=this.GetTime()-n.GetStartOffset(),r=e-n.GetStartOffset();0>p&&0<r&&(l=n.GetStartOffset(),this._SetTime(l))}n.Interpolate(l,b,d,
c,this._firstTick,k)}for(const n of this._tracks)n.AfterInterpolate();this._firstTick&&g&&(this._firstTick=!1)}AddTrack(){var a=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();a=C3$jscomp$108.TrackState.Create(this,a);this._tracksLength=this._tracks.push(a);return a}Removed(){if(!this.IsReleased())for(const a of this._tracks)a.TimelineRemoved()}CleanCaches(){for(const a of this._tracks)a.CleanCaches()}ClearTrackInstances(){for(const a of this._tracks)a.ClearInstance()}SetTrackInstance(a,
b,d){if(b)if("number"===typeof d&&0<=d){if(a=this._tracks[d])a.SetInstance(b),this._timelineManager.SetTimelineObjectClassToMap(b.GetObjectClass(),this)}else for(const c of this._tracks)if(c.IsInstanceTrack()){if(a){if(c.GetId()!==a)continue}else if(c.HasInstance())continue;c.SetInstance(b);this._timelineManager.SetTimelineObjectClassToMap(b.GetObjectClass(),this);break}}HasTrackInstance(a,b){for(const d of this._tracks)if(d.IsInstanceTrack())if(b){if(b===d.GetId()&&a===d.GetInstance())return!0}else if(a===
d.GetInstance())return!0;return!1}HasValidTracks(){return this._tracks.some(a=>a.IsInstanceTrack()?a.CanInstanceBeValid():!0)}HasValidGlobalTracks(){return this._tracks.some(a=>a.IsInstanceTrack()?a.CanInstanceBeValid()?(a=a.GetObjectClass())?a.IsGlobal():!1:!1:!1)}GetPropertyTrack(a){for(const b of this.GetTracks())for(const d of b.GetPropertyTracks())if(d.GetPropertyName()===a)return d}GetTrackFromInstance(a){for(const b of this._tracks)if(a===b.GetInstance())return b;return null}GetKeyframeWithTags(a){a=
a?a.split(" "):[];a=[...(new Set(a.map(b=>b.toLowerCase().trim()))).values()];for(const b of this.GetTracks())for(const d of b.GetKeyframeDataItems())if(a.every(c=>d.HasTag(c)))return d}GetObjectClasses(){const a=[];for(const b of this.GetTracks())a.push(b.GetObjectClass());return a.filter(b=>b)}_OnAfterLoad(){for(const a of this.GetTracks())a._OnAfterLoad()}_SaveToJson(){return{tracksJson:this._SaveTracksToJson(),name:this._name,playheadTime:this.GetTime(),playbackRate:this._playbackRate,pingPongState:this._pingPongState,
currentRepeatCount:this._currentRepeatCount,isPlaying:this._isPlaying,isScheduled:this._isScheduled,initialStateSet:this._initialStateSet,finishedTriggers:this._finishedTriggers,complete:this._complete,released:this._released,markedForRemoval:this._markedForRemoval,completedTick:this._completedTick,implicitPause:this._implicitPause,isTemplate:this._isTemplate,tags:this._tags.join(" "),stringTags:this._stringTags,tagsChanged:this._tagsChanged,firstTick:this._firstTick}}_LoadFromJson(a){a&&(this._LoadTracksFromJson(a.tracksJson),
this._name=a.name,this._playheadTime=a.playheadTime,this._playbackRate=a.playbackRate,this._pingPongState=a.pingPongState,this._currentRepeatCount=a.currentRepeatCount,this._isPlaying=!!a.isPlaying,this._isScheduled=!!a.isScheduled,this._initialStateSet=!!a.initialStateSet,this._finishedTriggers=a.hasOwnProperty("finishedTriggers")?!!a.finishedTriggers:!1,this._complete=!!a.complete,this._released=!!a.released,this._markedForRemoval=!!a.markedForRemoval,this._completedTick=a.completedTick,this._implicitPause=
!!a.implicitPause,this._isTemplate=!!a.isTemplate,this._tags=a.tags.split(" "),this._stringTags=a.stringTags,this._tagsChanged=!!a.tagsChanged,this._firstTick=!!a.firstTick)}_SaveTracksToJson(){return this._tracks.map(a=>a._SaveToJson())}_LoadTracksFromJson(a){this.ClearTrackInstances();a.forEach((b,d)=>{this._tracks[d]._LoadFromJson(b)});this._tracks.filter(b=>b.CanInstanceBeValid())}static _HasTag(a){const b=this.GetTags();return""===a?1===b.length&&""===b[0]:b.map(d=>d.toLowerCase()).includes(a.toLowerCase())}static _GetTagArray(a){if(C3$jscomp$108.IsArray(a))return a.slice(0);
if(C3$jscomp$108.IsString(a))return a.split(" ");throw Error("invalid tags");}GetITimelineState(){this._iTimelineState||(this._iTimelineState=C3$jscomp$108.New(self.ITimelineState,this));return this._iTimelineState}};"use strict";const C3$jscomp$109=self.C3;
C3$jscomp$109.TrackState=class extends C3$jscomp$109.DefendedBase{constructor(a,b){super();this._timeline=a;this._trackDataItem=b;this._trackData=b.GetTrackData();this._objectClassIndex=this._instanceUid=NaN;this._worldInfo=this._instance=null;this._isNested=0<b.GetStartOffset();this._endStateOfNestedSet=this._initialStateOfNestedSet=!1;this._instanceUidToLoad=NaN;this._lastKeyframeDataItem=null;this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();this._propertyTracks=
[];this.CreatePropertyTrackStates();this._needsBeforeAndAfter=this._renderChange=this._worldInfoChange=0}static Create(a,b){return C3$jscomp$109.New(C3$jscomp$109.TrackState,a,b)}Release(){this._keyframeDataItems=null;for(const a of this._propertyTracks)a.Release();C3$jscomp$109.clearArray(this._propertyTracks);this._lastKeyframeDataItem=this._trackDataItem=this._worldInfo=this._instance=this._timeline=this._propertyTracks=null}CreatePropertyTrackStates(){for(const a of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C3$jscomp$109.PropertyTrackState.Create(this,
a))}TimelineRemoved(){for(const a of this._propertyTracks)a.TimelineRemoved()}CleanCaches(){for(const a of this._propertyTracks)a.CleanCaches();this._worldInfo=this._instance=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){return this._keyframeDataItems?this._keyframeDataItems:this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(a){for(let b=
0;b<this._propertyTracks.length;b++){const d=this._propertyTracks[b];if(d.GetPropertyName()===a)return d}}MaybeGetInstance(){this._instance||this.GetInstance()}IsInstanceValid(){return this._instance?!this._instance.IsDestroyed():!1}CanInstanceBeValid(){if(!this.IsInstanceTrack())return!1;var a=this.GetInstanceUID();return(a=this.GetRuntime().GetInstanceByUID(a))?!a.IsDestroyed():!1}GetObjectClass(){if(this.IsInstanceTrack()){var a=this.GetObjectClassIndex();if(-1!==a)return this.GetRuntime().GetObjectClassByIndex(a)}}GetTrackIndexInTimeline(){return this._timeline.GetTracks().indexOf(this)}ClearInstance(){this._instance=
null;this._instanceUid=NaN;this._worldInfo=null;this._objectClassIndex=NaN}HasInstance(){return!!this._instance}GetInstance(){if(this._instance&&this.IsInstanceValid())return this._instance;const a=this.GetInstanceUID();return this._instance=this.GetRuntime().GetInstanceByUID(a)}SetInstance(a){if(this._instance!==a){this.CleanCaches();this._instance=a;this._objectClassIndex=a.GetObjectClass().GetIndex();this._instanceUid=a.GetUID();this._worldInfo=a.GetWorldInfo();for(const g of this.propertyTrackItems()){const k=
g.sourceAdapter;switch(g.propertyTrack.GetSourceAdapterId()){case "instance-variable":k.GetEditorIndex();var b=a.GetObjectClass(),d=b.GetInstanceVariableIndexByName(g.name),c=b.GetInstanceVariableName(d);b=b.GetInstanceVariableType(d);c===g.name&&b===g.type&&k.UpdateInstanceVariableIndex(d);break;case "behavior":var e=g.behaviorType;d=this.GetObjectClass();c=a.GetObjectClass();b=k.GetBehaviorType(c);e&&b&&(e=e.GetName(),d.GetBehaviorIndexByName(e),c.GetBehaviorIndexByName(e),k.GetEditorIndex(),k.UpdateBehaviorTypeSid(b.GetSID()))}}}}*propertyTrackItems(){for(const d of this._propertyTracks){var a=
d.GetSourceAdapter(),b=this.GetObjectClass();const c={propertyTrack:d,sourceAdapter:a};switch(d.GetSourceAdapterId()){case "world-instance":c.property=d.GetPropertyName();break;case "instance-variable":a=a.GetEditorIndex();c.name=b.GetInstanceVariableName(a);c.type=b.GetInstanceVariableType(a);break;case "effect":b=b.GetEffectList();a=a.GetEffectType(b);c.effectType=a;break;case "behavior":a=a.GetBehaviorType(b);c.behaviorType=a;break;case "plugin":c.plugin=b.GetPlugin()}yield c}}GetWorldInfo(){if(this._worldInfo&&
this.IsInstanceValid())return this._worldInfo;const a=this.GetInstance();a&&(this._worldInfo=a.GetWorldInfo());return this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){return isNaN(this._instanceUid)?this._trackDataItem.GetInstanceUID():this._instanceUid}SetInstanceUID(a){this._trackDataItem.SetInstanceUID(a)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(a){this._trackDataItem.SetInterpolationMode(a)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(a){this._trackDataItem.SetLocalTotalTime(a)}SetResultMode(a){this._trackDataItem.SetResultMode(a)}SetEase(a){for(const b of this.GetKeyframeDataItems())b.SetEase(a);
for(const b of this.GetPropertyTracks())b.SetEase(a)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(a){this._trackDataItem.SetEnable(a)}GetObjectClassIndex(){return isNaN(this._objectClassIndex)?this._trackDataItem.GetObjectClassIndex():this._objectClassIndex}SetObjectClassIndex(a){this._trackDataItem.SetObjectClassIndex(a)}SetOriginalWidth(a){this._trackDataItem.SetOriginalWidth(a)}GetOriginalWidth(){const a=this.GetInstance();return a&&a.GetSdkInstance().IsOriginalSizeKnown()?a.GetSdkInstance().GetOriginalWidth():
this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(a){this._trackDataItem.SetOriginalHeight(a)}GetOriginalHeight(){const a=this.GetInstance();return a&&a.GetSdkInstance().IsOriginalSizeKnown()?a.GetSdkInstance().GetOriginalHeight():this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return 0===this.GetType()}IsValueTrack(){return 1===this.GetType()}IsAudioTrack(){return 2===this.GetType()}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetResetState(){for(const a of this._propertyTracks)a.SetResetState()}SetInitialState(){this.MaybeGetInstance();
if(this.IsInstanceValid()||!this.IsInstanceTrack()){var a=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const b of this._propertyTracks)b.SetInitialState(a),0===this._worldInfoChange&&1===b.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===b.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;this._propertyTracks.some(b=>b.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1);this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(a);
this._endStateOfNestedSet=this._initialStateOfNestedSet=!1;this.Interpolate(a);this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(a))}}SetResumeState(){this.MaybeGetInstance();if(this.IsInstanceValid()||!this.IsInstanceTrack()){this._timeline.IsForwardPlayBack();var a=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(a);for(const b of this._propertyTracks)b.SetResumeState(a)}}SetEndState(){if(!(this.GetTimeline().IsComplete()||(this.MaybeGetInstance(),
!this.IsInstanceValid()&&this.IsInstanceTrack()||this._isNested))){const a=this._timeline.GetTime(),b=this.GetStartOffset()+this.GetLocalTotalTime();a>=b?this.Interpolate(this.GetLocalTotalTime(),!0,!1,!0,!1,!1,!0):0>=a&&this.Interpolate(0,!0,!1,!0,!1,!1,!0)}}_SetUpdateState(){for(let a=0,b=this._propertyTracks.length;a<b;a++){const d=this._propertyTracks[a];d._SetUpdateState();0===this._worldInfoChange&&1===d.GetWorldInfoChange()&&(this._worldInfoChange=1);0===this._renderChange&&1===d.GetRenderChange()&&
(this._renderChange=1)}}BeforeInterpolate(){const a=this._propertyTracks.length;for(let b=0;b<a;b++)this._propertyTracks[b].BeforeInterpolate()}Interpolate(a,b=!1,d=!1,c=!1,e=!1,g=!1,k=!1){this._instance||this.GetInstance();const l=this._instance&&!this._instance.IsDestroyed(),n=0===this._trackDataItem._type;if(!(!l&&n||g&&n&&this.GetObjectClass().IsGlobal()||(a-=this.GetStartOffset(),0>a))){this.MaybeSetInitialStateOfNestedTrack(a,b);this.MaybeTriggerKeyframeReachedConditions(a,b,e);for(let p=0,
r=this._propertyTracks.length;p<r;p++)this._propertyTracks[p].Interpolate(a,d,c,k);this.MaybeSetEndStateOfNestedTrack(a,b);0!==this._worldInfoChange&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){const a=this._propertyTracks.length;for(let b=0;b<a;b++)this._propertyTracks[b].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(a,b){if(b&&this._isNested&&!this._initialStateOfNestedSet){if(this.GetTimeline().IsForwardPlayBack()){if(0>
a)return}else if(a>this.GetLocalTotalTime())return;for(const d of this._propertyTracks)d.SetInitialState();this._initialStateOfNestedSet=!0}}MaybeSetEndStateOfNestedTrack(a,b){if(b&&this._isNested&&!this._endStateOfNestedSet)if(this.GetTimeline().IsForwardPlayBack()){if(a>=this.GetLocalTotalTime()){for(const d of this._propertyTracks)d.Interpolate(this.GetLocalTotalTime(),!1,!0);this._endStateOfNestedSet=!0}}else if(0>=a){for(const d of this._propertyTracks)d.Interpolate(0,!1,!0);this._endStateOfNestedSet=
!0}}MaybeTriggerKeyframeReachedConditions(a,b,d){if(!d&&b&&C3$jscomp$109.Plugins.Timeline){b=this.GetTimeline();d=this._lastKeyframeDataItem.GetNext();var c=this._lastKeyframeDataItem.GetTime(),e=d?d.GetTime():b.GetTotalTime();if(a<=c||a>=e)this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(a,this._trackDataItem),b.IsForwardPlayBack()?d&&this.OnKeyframeReached(this._lastKeyframeDataItem):(a=this._lastKeyframeDataItem.GetNext())&&this.OnKeyframeReached(a)}}_GetLastKeyFrameBeforeTime(a){const b=
this._trackData.GetKeyFrameDataItemAtTime(a,this._trackDataItem);return b?b:this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(a,this._trackDataItem)}OnKeyframeReached(a){if(C3$jscomp$109.Plugins.Timeline){var b=this.GetTimeline(),d=b.GetTimelineManager();C3$jscomp$109.Plugins.Timeline.Cnds.PushTriggerTimeline(b);C3$jscomp$109.Plugins.Timeline.Cnds.PushTriggerKeyframe(a);d.Trigger(C3$jscomp$109.Plugins.Timeline.Cnds.OnAnyKeyframeReached);d.Trigger(C3$jscomp$109.Plugins.Timeline.Cnds.OnKeyframeReached);
C3$jscomp$109.Plugins.Timeline.Cnds.PopTriggerTimeline(b);C3$jscomp$109.Plugins.Timeline.Cnds.PopTriggerKeyframe(a)}}AddKeyframe(){return this._trackDataItem.GetKeyframeData().AddEmptyKeyframeDataItem()}AddPropertyTrack(){var a=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem();a=C3$jscomp$109.PropertyTrackState.Create(this,a);this._propertyTracks.push(a);return a}DeleteKeyframes(a){this._trackDataItem.GetKeyframeData().DeleteKeyframeDataItems(a)}DeletePropertyKeyframes(a){for(const b of this._propertyTracks)b.DeletePropertyKeyframes(a)}SaveState(){for(const a of this._propertyTracks)a.SaveState()}CompareInitialStateWithCurrent(){this.MaybeGetInstance();
if(this.IsInstanceValid()||!this.IsInstanceTrack())for(const a of this._propertyTracks)a.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){this.MaybeGetInstance();if(this.IsInstanceValid()||!this.IsInstanceTrack()){var a=!1;for(const b of this._propertyTracks){const d=b.CompareSaveStateWithCurrent();!a&&d&&(a=!0)}a&&(a=this.AddKeyframe(),a.SetTime(this.GetTimeline().GetTime()),a.SetEase("noease"),a.SetEnable(!0),a.SetTags(""))}}_OnAfterLoad(){isNaN(this._instanceUidToLoad)||this._LoadInstanceFromJson(this._instanceUidToLoad);
this._instanceUidToLoad=NaN}_SaveToJson(){var a=this.GetInstance();a=a?a.GetUID():this.GetInstanceUID();return{propertyTracksJson:this._SavePropertyTracksToJson(),lastKeyframeDataItemJson:this._SaveLastKeyframeDataItemToJson(),initialStateOfNestedSet:this._initialStateOfNestedSet,endStateOfNestedSet:this._endStateOfNestedSet,instanceUid:a}}_LoadFromJson(a){if(a){this._LoadPropertyTracksFromJson(a.propertyTracksJson);this._LoadLastKeyframeDataItemFromJson(a.lastKeyframeDataItemJson);this._instanceUidToLoad=
a.instanceUid;this._initialStateOfNestedSet=!1;a.hasOwnProperty.initialStateOfNestedSet&&(this._initialStateOfNestedSet=a.initialStateOfNestedSet);this._endStateOfNestedSet=!1;a.hasOwnProperty.endStateOfNestedSet&&(this._endStateOfNestedSet=a.endStateOfNestedSet);for(const b of this._propertyTracks)0===this._worldInfoChange&&1===b.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===b.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;this._propertyTracks.some(b=>
b.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1)}}_SaveLastKeyframeDataItemToJson(){return this._trackDataItem.GetKeyframeData().GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map(a=>a._SaveToJson())}_LoadPropertyTracksFromJson(a){a.forEach((b,d)=>{this._propertyTracks[d]._LoadFromJson(b)})}_LoadInstanceFromJson(a){C3$jscomp$109.IsFiniteNumber(a)&&(a=this.GetRuntime().GetInstanceByUID(a))&&this.GetTimeline().SetTrackInstance(this._trackDataItem.GetId(),
a,this.GetTrackIndexInTimeline())}_LoadLastKeyframeDataItemFromJson(a){this._lastKeyframeDataItem=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemFromIndex(a)}};"use strict";const C3$jscomp$110=self.C3;
C3$jscomp$110.PropertyTrackState=class extends C3$jscomp$110.DefendedBase{constructor(a,b){super();this._track=a;this._propertyTrackDataItem=b;this._propertyTrackData=b.GetPropertyTrackData();this._needsBeforeAndAfter=this._renderChange=this._worldInfoChange=0;this._sourceAdapter=this.GetSourceAdapter();this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();this._absoluteValueObject=this._lastPropertyKeyframeDataItem=null}static Create(a,
b){return C3$jscomp$110.New(C3$jscomp$110.PropertyTrackState,a,b)}Release(){this._track=null;this._sourceAdapter&&(this._sourceAdapter.Release(),this._sourceAdapter=null);this._propertyTrackData=this._propertyTrackDataItem=this._propertyKeyframeDataItems=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(a){this._absoluteValueObject=
a}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(this._sourceAdapter)return this._sourceAdapter;let a;switch(this._propertyTrackDataItem.GetSourceAdapterId()){case "behavior":a=new C3$jscomp$110.PropertyTrackState.BehaviorSourceAdapter(this);
break;case "effect":a=new C3$jscomp$110.PropertyTrackState.EffectSourceAdapter(this);this._renderChange=1;break;case "instance-variable":a=new C3$jscomp$110.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case "plugin":a=new C3$jscomp$110.PropertyTrackState.PluginSourceAdapter(this);this._renderChange=1;break;case "world-instance":a=new C3$jscomp$110.PropertyTrackState.PropertySourceAdapter(this);this._worldInfoChange=this._renderChange=1;break;case "value":a=new C3$jscomp$110.PropertyTrackState.ValueSourceAdapter(this);
break;case "audio":a=new C3$jscomp$110.PropertyTrackState.AudioSourceAdapter(this)}return this._sourceAdapter=a}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(a){this._propertyTrackDataItem.SetSourceAdapterId(a)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(a){this._propertyTrackDataItem.SetSourceAdapterArguments(a)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(a){this._propertyTrackDataItem.SetProperty(a)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(a){this._propertyTrackDataItem.SetType(a)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(a){this._propertyTrackDataItem.SetMin(a)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(a){this._propertyTrackDataItem.SetMax(a)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(a){this._propertyTrackDataItem.SetEnable(a)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(a){this._propertyTrackDataItem.SetInterpolationMode(a)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(a){this._propertyTrackDataItem.SetResultMode(a)}SetEase(a){for(const b of this.GetPropertyKeyframeDataItems())b.SetEase(a)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){return this._propertyKeyframeDataItems?
this._propertyKeyframeDataItems:this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArrayIncludingDisabled()}GetPropertyKeyFrameDataItemAtTime(a){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(a,this._propertyTrackDataItem)}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,
this._propertyTrackDataItem)}GetPropertyKeyframeDataItemPairForTime(a){let b=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(a,this._propertyTrackDataItem);b?a=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(a,this._propertyTrackDataItem):(b=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem),a=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(a,this._propertyTrackDataItem));return{start:b,end:a}}*GetPropertyKeyframeValues(){for(const a of this.GetPropertyKeyframeDataItems())yield a.GetValueWithResultMode()}*GetPropertyKeyframeTimes(){for(const a of this.GetPropertyKeyframeDataItems())yield a.GetTime()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetResetState(){this.GetSourceAdapter().SetResetState()}SetInitialState(a){this.GetSourceAdapter().SetInitialState();
this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(a);this._SetUpdateState()}SetResumeState(a){this.GetSourceAdapter().SetResumeState();this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(a)}_SetUpdateState(){var a=this.GetTrack();this._needsBeforeAndAfter=0;if(a.IsInstanceTrack()){var b=this.GetTimeline();a=a.GetInstance();const d=this.GetSourceAdapter(),c=this.GetPropertyName();d.MayNeedBeforeAndAfterInterpolate()?(b=b.GetSimilarPropertyTracks(a,d,
c,this))&&b.length&&(this._needsBeforeAndAfter=1):this._needsBeforeAndAfter=0}}_GetLastPropertyKeyFrameBeforeTime(a){const b=this.GetTimeline(),d=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(a,this._propertyTrackDataItem);return d?d:b.IsForwardPlayBack()?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem):this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(a,this._propertyTrackDataItem)}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(a,
b=!1,d=!1,c=!1){let e,g=!1;if(b)var k=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){var l=this.GetTimeline();const n=this._lastPropertyKeyframeDataItem.GetNext();k=this._lastPropertyKeyframeDataItem.GetTime();l=n?n.GetTime():l.GetTotalTime();if(a<=k||a>=l)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem),g=!0}else this._lastPropertyKeyframeDataItem=
this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem),g=!0;k=this._lastPropertyKeyframeDataItem}k&&(e=k.GetNext());this._sourceAdapter.Interpolate(a,k,e,b,d,c,g)}GetInterpolatedValue(a){if(this._lastPropertyKeyframeDataItem){var b=this.GetTimeline();const c=this._lastPropertyKeyframeDataItem.GetNext();var d=this._lastPropertyKeyframeDataItem.GetTime();b=c?c.GetTime():b.GetTotalTime();if(a<=d||a>=b)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,
this._propertyTrackDataItem)}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem);d=this._lastPropertyKeyframeDataItem;b=d.GetNext();return this._sourceAdapter.GetInterpolatedValue(a,d,b)}GetInterpolatedValueFast(a,b,d){return this._sourceAdapter.GetInterpolatedValue(a,b,d)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(a,b){const d=b.GetPropertyTrackDataItem();
return b._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,d)}static GetEndPropertyKeyframeForTime(a,b){const d=b.GetPropertyTrackDataItem();return b._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(a,d)}AddPropertyKeyframe(){const a=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();this._lastPropertyKeyframeDataItem=null;return a}DeletePropertyKeyframes(a){this._lastPropertyKeyframeDataItem=null;this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(a)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){if(this.GetSourceAdapter().CompareInitialStateWithCurrent()){const a=
this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem),b=this.GetSourceAdapter().GetCurrentState();a.SetAbsoluteValue(b)}}CompareSaveStateWithCurrent(){const a=this.GetSourceAdapter().CompareSaveStateWithCurrent();a&&this.AddPropertyKeyframeAtCurrentTime();this.GetSourceAdapter().ClearSaveState();return a}AddPropertyKeyframeAtCurrentTime(){const a=this.GetTimeline().GetTime(),b=this.GetSourceAdapter(),d=C3$jscomp$110.PropertyTrackState.GetStartPropertyKeyframeForTime(a,
this),c=this.AddPropertyKeyframe();c.SetType(d.GetType());c.SetTime(a);c.SetEase(d.GetEase());c.SetEnable(!0);c.SetValue(b.GetValueAtTime());c.SetAbsoluteValue(b.GetCurrentState())}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(a){a&&this.GetSourceAdapter()._LoadFromJson(a.sourceAdapterJson)}};"use strict";const NS=self.C3.PropertyTrackState;
NS.PropertySourceAdapter=class{constructor(a){this._propertyTrack=a;this._propertyAdapter=null;this.GetPropertyAdapter()}Release(){this._propertyAdapter&&(this._propertyAdapter.Release(),this._propertyAdapter=null);this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){this._propertyAdapter&&this._propertyAdapter.TimelineRemoved()}CleanCaches(){this._propertyAdapter&&
this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){return this._propertyAdapter?this._propertyAdapter:this._propertyAdapter=this._CreatePropertyAdapter()}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetResetState(){this.GetPropertyAdapter().SetResetState()}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(a,b,d,c,e,g,k){let l;
switch(this._propertyTrack.GetPropertyKeyframeType()){case "numeric":l=NS.NumericTypeAdapter.Interpolate(a,b,d,this._propertyTrack);break;case "angle":l=NS.AngleTypeAdapter.Interpolate(a,b,d,this._propertyTrack);break;case "boolean":l=NS.BooleanTypeAdapter.Interpolate(a,b,d,this._propertyTrack);break;case "color":l=NS.ColorTypeAdapter.Interpolate(a,b,d,this._propertyTrack);break;case "text":l=NS.TextTypeAdapter.Interpolate(a,b,d,this._propertyTrack)}this._propertyAdapter.ChangeProperty(a,l,b,d,c,
e,g,k)}GetInterpolatedValue(a,b,d){switch(this._propertyTrack.GetPropertyKeyframeType()){case "numeric":return NS.NumericTypeAdapter.Interpolate(a,b,d,this._propertyTrack);case "angle":return NS.AngleTypeAdapter.Interpolate(a,b,d,this._propertyTrack);case "boolean":return NS.BooleanTypeAdapter.Interpolate(a,b,d,this._propertyTrack);case "color":return NS.ColorTypeAdapter.Interpolate(a,b,d,this._propertyTrack);case "text":return NS.TextTypeAdapter.Interpolate(a,b,d,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){const a=
this._propertyTrack,b=a.GetTrack().GetTimeline().GetTime(),d=NS.GetStartPropertyKeyframeForTime(b,a),c=d.GetNext();switch(a.GetPropertyKeyframeType()){case "numeric":return NS.NumericTypeAdapter.Interpolate(b,d,c,a);case "angle":return NS.AngleTypeAdapter.Interpolate(b,d,c,a);case "boolean":return NS.BooleanTypeAdapter.Interpolate(b,d,c,a);case "color":return NS.ColorTypeAdapter.Interpolate(b,d,c,a);case "text":return NS.TextTypeAdapter.Interpolate(b,d,c,a)}}_CreatePropertyAdapter(){const a=this._propertyTrack;
switch(a.CanHavePropertyKeyframes()?a.GetPropertyKeyframeType():""){case "combo":case "boolean":case "text":case "string":return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);case "numeric":case "number":case "angle":return"combo"===this._propertyTrack.GetPropertyType()?new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this):new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this);case "color":case "offsetColor":return new NS.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);
default:return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}_SaveToJson(){return{propertyAdapterJson:this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(a){a&&this.GetPropertyAdapter()._LoadFromJson(a.propertyAdapterJson)}};"use strict";const C3$jscomp$112=self.C3;
class InstanceVariableSourceAdapter extends C3$jscomp$112.PropertyTrackState.PropertySourceAdapter{constructor(a){super(a);this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]}GetIndex(){return this._updatedIndex?this._updatedIndex:super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(a){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]!==a&&(this._updatedIndex=
a)}Interpolate(a,b,d,c,e,g,k){this.GetPropertyAdapter().CanChange(b.GetValue())&&super.Interpolate(a,b,d,c,e,g,k)}GetInterpolatedValue(a,b,d){if(this.GetPropertyAdapter().CanChange(b.GetValue()))return super.GetInterpolatedValue(a,b,d)}_SaveToJson(){return Object.assign(super._SaveToJson(),{index:this._updatedIndex})}_LoadFromJson(a){a&&(super._LoadFromJson(a),this._updatedIndex=a.index)}}C3$jscomp$112.PropertyTrackState.InstanceVariableSourceAdapter=InstanceVariableSourceAdapter;"use strict";
const C3$jscomp$113=self.C3;
class BehaviorSourceAdapter extends C3$jscomp$113.PropertyTrackState.PropertySourceAdapter{constructor(a){super(a);this._sid=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[1]}GetTarget(){var a=this._propertyTrack.GetPropertyTrackDataItem(),b=this._propertyTrack.GetTrack();a=this._sid?this._sid:a.GetSourceAdapterArguments()[0];b=b.GetInstance();a=b.GetBehaviorIndexBySID(a);return b.GetBehaviorInstances()[a].GetSdkInstance()}GetBehaviorType(a){const b=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[2];
return a.GetBehaviorTypeByName(b)}UpdateBehaviorTypeSid(a){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]!==a&&(this._sid=a)}Interpolate(a,b,d,c,e,g,k){const l=this._propertyTrack.GetTrack().GetInstance();this.GetBehaviorType(l.GetObjectClass())&&super.Interpolate(a,b,d,c,e,g,k)}GetInterpolatedValue(a,b,d){const c=this._propertyTrack.GetTrack().GetInstance();if(this.GetBehaviorType(c.GetObjectClass()))return super.GetInterpolatedValue(a,b,d)}_SaveToJson(){return Object.assign(super._SaveToJson(),
{sid:this._sid})}_LoadFromJson(a){a&&(super._LoadFromJson(a),this._sid=a.sid)}}C3$jscomp$113.PropertyTrackState.BehaviorSourceAdapter=BehaviorSourceAdapter;"use strict";const C3$jscomp$114=self.C3;
class EffectSourceAdapter extends C3$jscomp$114.PropertyTrackState.PropertySourceAdapter{constructor(a){super(a)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[1]}GetTarget(){const a=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList();var b=a.GetEffectList();b=this.GetEffectType(b).GetIndex();return a.IsEffectIndexActive(b)?a.GetEffectParametersForIndex(b):null}GetEffectType(a){const b=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0];
return a.GetEffectTypeByName(b)}Interpolate(a,b,d,c,e,g,k){this._IsEffectActive()&&super.Interpolate(a,b,d,c,e,g,k)}GetInterpolatedValue(a,b,d){if(this._IsEffectActive())return super.GetInterpolatedValue(a,b,d)}_IsEffectActive(){const a=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList();var b=a.GetEffectList();if(b=this.GetEffectType(b))return b=b.GetIndex(),a.IsEffectIndexActive(b)}}C3$jscomp$114.PropertyTrackState.EffectSourceAdapter=EffectSourceAdapter;"use strict";
const C3$jscomp$115=self.C3;
class PluginSourceAdapter extends C3$jscomp$115.PropertyTrackState.PropertySourceAdapter{constructor(a){super(a)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(a,b,d,c,e,g,k){var l=this._propertyTrack.GetTrack();const n=l.GetObjectClass().GetPlugin();l=l.GetInstance().GetObjectClass().GetPlugin();n===l&&super.Interpolate(a,b,d,c,e,g,k)}GetInterpolatedValue(a,
b,d){var c=this._propertyTrack.GetTrack();const e=c.GetObjectClass().GetPlugin();c=c.GetInstance().GetObjectClass().GetPlugin();if(e===c)return super.GetInterpolatedValue(a,b,d)}GetOptionalCallbacks(){const a=this._propertyTrack.GetTrack().GetObjectClass().GetPlugin();if(C3$jscomp$115.Plugins.Sprite&&a instanceof C3$jscomp$115.Plugins.Sprite&&("initial-frame"===this._propertyTrack.GetPropertyName()||"initial-animation"===this._propertyTrack.GetPropertyName()))switch(this._propertyTrack.GetResultMode()){case "relative":return null;
case "absolute":return null}}}C3$jscomp$115.PropertyTrackState.PluginSourceAdapter=PluginSourceAdapter;"use strict";const C3$jscomp$116=self.C3;
class ValueSourceAdapter extends C3$jscomp$116.PropertyTrackState.PropertySourceAdapter{constructor(a){super(a);this._value=0;this._init=!1}MayNeedBeforeAndAfterInterpolate(){return!1}SetInitialState(){const a=this._propertyTrack.GetPropertyTrackData();let b=this._propertyTrack.GetPropertyTrackDataItem();b=a.GetFirstPropertyKeyframeDataItem(b);this._value=b.GetValueWithResultMode()}SetResumeState(){}GetValue(){this._init||this._propertyTrack.Interpolate(0);return this._value}Interpolate(a,b,d,c,e,
g,k){this._value=C3$jscomp$116.PropertyTrackState.NumericTypeAdapter.Interpolate(a,b,d,this._propertyTrack);this._init=!0}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return!1}CompareSaveStateWithCurrent(){return!1}_SaveToJson(){return{value:this._value,init:this._init}}_LoadFromJson(a){a&&(this._value=a.value,this._init=a.hasOwnProperty("init")?a.init:!0)}}C3$jscomp$116.PropertyTrackState.ValueSourceAdapter=ValueSourceAdapter;"use strict";
const C3$jscomp$117=self.C3;
class AudioSourceAdapter extends C3$jscomp$117.PropertyTrackState.PropertySourceAdapter{constructor(a){super(a);this._audioPlaybackStarted=!1;this._expressions=this._actions=this._sdkInstance=null;this._timeline=this._propertyTrack.GetTimeline();this._track=this._propertyTrack.GetTrack();this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs();this._fileArgs=this._sourceAdapterArgs[0];this._startOffsetTime=this._sourceAdapterArgs[1];this._audioTag=this._sourceAdapterArgs[3]?this._sourceAdapterArgs[3]:
Math.random().toString(36).slice(2);this._volume=this._pauseVolume=this._pauseTime=NaN;this._audioSource=null;this._Initialize()}Release(){super.Release();this._audioSource=this._fileArgs=this._sourceAdapterArgs=this._track=this._timeline=this._expressions=this._actions=this._sdkInstance=null}_Initialize(){if(self.C3.Plugins.Audio){var a=this._propertyTrack.GetRuntime().GetSingleGlobalObjectClassByCtor(self.C3.Plugins.Audio);a&&(this._sdkInstance=a.GetSingleGlobalInstance().GetSdkInstance());this._actions=
self.C3.Plugins.Audio.Acts;this._expressions=self.C3.Plugins.Audio.Exps}}_MaybeSetAudioSource(){if(!this._audioSource){var a=this._propertyTrack.GetTrack().GetPropertyTrack("audioSource");a&&(this._audioSource=a.GetSourceAdapter())}}_GetPauseVolume(){const a=this._propertyTrack.GetTrack().GetPropertyTrack("volume");return a?a.GetSourceAdapter()._pauseVolume:this._pauseVolume}TimelineRemoved(){super.TimelineRemoved();this._audioPlaybackStarted=!1;this._sdkInstance&&(this._expressions&&(this._pauseTime=
this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag),this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)),this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag))}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(a){this._volume=a}SetInitialState(){super.SetInitialState();this._pauseTime=NaN;this._audioPlaybackStarted=!1}SetResumeState(){super.SetResumeState();const a=this._propertyTrack.GetTimeline().GetTime();
this._pauseTime=a-this._startOffsetTime;switch(this._propertyTrack.GetPropertyName()){case "volume":this._pauseVolume=this._propertyTrack.GetInterpolatedValue(a)}this._audioPlaybackStarted=!1}Interpolate(a,b,d,c,e,g,k){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case "audioSource":if(!this._timeline.IsForwardPlayBack())break;if(c){this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag);break}if(a<this._startOffsetTime){this._audioPlaybackStarted=!1;break}b=
this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag);d=this._timeline.GetPlaybackRate();d!==b&&this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,d);if(this._audioPlaybackStarted)break;if(!this._propertyTrack.GetTimeline().IsPlaying())break;this._audioPlaybackStarted=!0;isNaN(this._pauseTime)?(b=self.performance.now(),d=a-this._startOffsetTime,"suspended"===this._sdkInstance.GetAudioContextState()?this._audioPlaybackStarted=!1:(a=self.performance.now(),a=d+(a-b)/
1E3,this._actions&&(b=this.GetVolume(),isNaN(b)?(this.SetVolume(0),b=0):this.SetVolume(b),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,b,this._audioTag,a)))):(a=this._pauseTime,this._pauseTime=NaN,b=this._GetPauseVolume(),this._pauseVolume=NaN,"suspended"===this._sdkInstance.GetAudioContextState()?this._audioPlaybackStarted=!1:this._actions&&(this.SetVolume(b),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,b,this._audioTag,a)));break;case "volume":this._MaybeSetAudioSource(),
super.Interpolate(a,b,d,c,e,g,k)}}GetInterpolatedValue(a,b,d){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case "volume":return this._MaybeSetAudioSource(),super.GetInterpolatedValue(a,b,d)}}Getter(a,b){return this._audioSource?this._audioSource.GetVolume():0}Setter(a,b,d,c){this._audioSource&&this._audioSource.SetVolume(this.Getter()+b);this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(a,
b,d){this._audioSource&&this._audioSource.SetVolume(b);this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return!0}_SaveToJson(){return{audioPlaybackStarted:this._audioPlaybackStarted,audioTag:this._audioTag,pauseTime:this._pauseTime,pauseVolume:this._pauseVolume,volume:this._volume}}_LoadFromJson(a){a&&(this._audioPlaybackStarted=a.audioPlaybackStarted,this._audioTag=a.audioTag,this._pauseTime=
a.pauseTime,this._pauseVolume=a.pauseVolume,this._volume=a.volume,this._Initialize())}}C3$jscomp$117.PropertyTrackState.AudioSourceAdapter=AudioSourceAdapter;"use strict";
self.C3.PropertyTrackState.PropertyInterpolationAdapter=class{constructor(a){this._sourceAdapter=a;this._propertyTrack=a.GetPropertyTrack();this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo();this._property=this._propertyTrack.GetPropertyName();this._firstAbsoluteUpdate=!1;this._target=this._saveState=null}Release(){this._target=this._saveState=this._worldInfo=this._propertyTrack=this._sourceAdapter=null}MayNeedBeforeAndAfterInterpolate(){return!1}TimelineRemoved(){}CleanCaches(){this._target=
this._saveState=this._worldInfo=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){return this._worldInfo?this._worldInfo:this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo()}SetFirstAbsoluteUpdate(a){this._firstAbsoluteUpdate=!!a}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetResetState(){}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(a){return typeof this._Getter()===
typeof a}BeforeChangeProperty(){}ChangeProperty(a,b,d,c,e,g,k,l){}AfterChangeProperty(){}_FirstKeyframeGetter(){return this._PickTimelinePlaybackMode(()=>{const a=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(a)},()=>{const a=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(a)}).GetAbsoluteValue()}_CurrentKeyframeGetter(){const a=this._propertyTrack.GetTimeline().GetTime()-
this._propertyTrack.GetTrack().GetStartOffset();return this._PickTimelinePlaybackMode(()=>{const b=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,b)},()=>{const b=this._propertyTrack.GetPropertyTrackDataItem(),d=this._propertyTrack.GetPropertyTrackData(),c=d.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(a,b);return c?c:d.GetLastPropertyKeyframeDataItem(b)}).GetAbsoluteValue()}_PickTimelinePlaybackMode(a,
b){return this._propertyTrack.GetTimeline().IsForwardPlayBack()?a():b()}_PickResultMode(a,b){return"relative"===this._propertyTrack.GetResultMode()?a():b()}_PickFirstAbsoluteUpdate(a,b){return this.GetFirstAbsoluteUpdate()?(this.SetFirstAbsoluteUpdate(!1),a()):b()}_GetAbsoluteInitialValue(a){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){return this._target?this._target:this._target=this._sourceAdapter.GetTarget()}_PickSource(a,b,d,c,e,g){switch(this._propertyTrack.GetSourceAdapterId()){case "behavior":return a();
case "effect":return b();case "instance-variable":return d();case "plugin":return c();case "world-instance":return e();case "audio":return g()}}_SaveToJson(){return{firstAbsoluteUpdate:this._firstAbsoluteUpdate,saveState:this._saveState}}_LoadFromJson(a){a&&(this._firstAbsoluteUpdate=a.firstAbsoluteUpdate,this._saveState=a.saveState)}_GetPropertyKeyframeStubs(a,b=!1){const d=[];for(const c of a){a=c.GetTrack().GetStartOffset();for(const e of c.GetPropertyKeyframeDataItems())b&&0===e.GetTime()?d.push({time:a+
e.GetTime(),value:e.GetAbsoluteValue()}):b||d.push({time:a+e.GetTime(),value:e.GetAbsoluteValue()})}return d.sort((c,e)=>c.time-e.time)}_GetLastPropertyKeyframeStub(a,b,d){return this._GetPropertyKeyframeStubLowerThanPlayhead(b,d)}_GetPropertyKeyframeStubLowerThanPlayhead(a,b){for(let d=b.length-1;0<=d;d--)if(b[d].time<=a)return b[d];return null}};"use strict";const C3$jscomp$119=self.C3,TMP_COLORS_MAP=new Map,TMP_COLOR=[0,0,0];
class ColorInterpolationAdapter extends C3$jscomp$119.PropertyTrackState.PropertyInterpolationAdapter{constructor(a){super(a)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){const a=this._propertyTrack.GetSourceAdapterId(),b=this._GetTarget(),d=this._GetIndex();switch(a){case "behavior":return this._ToColorArray(b.GetPropertyValueByIndex(d));case "effect":return this._ToColorArray(b[d]);case "plugin":return this._ToColorArray(b.GetPropertyValueByIndex(d));case "world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){const a=
this._FirstKeyframeGetter();return!this._CompareColors(a,this._Getter())}CompareSaveStateWithCurrent(){return C3$jscomp$119.IsNullOrUndefined(this._saveState)?!1:!this._CompareColors(this._saveState,this._Getter())}_CompareColors(a,b){a=this._GetColorFromArray(a);b=this._GetColorFromArray(b);return a.equalsIgnoringAlpha(b)}_FirstKeyframeGetter(){const a=super._FirstKeyframeGetter();return this._GetColorFromArray(a)}_CurrentKeyframeGetter(){const a=super._CurrentKeyframeGetter();return this._GetColorFromArray(a)}_GetAbsoluteInitialValue(a){}_ToColorArray(a){return C3$jscomp$119.IsInstanceOf(a,
C3$jscomp$119.Color)?a.toArray().slice(0,3):a.slice(0,3)}_GetColorFromArray(a){return C3$jscomp$119.IsInstanceOf(a,C3$jscomp$119.Color)?a:new C3$jscomp$119.Color(a[0],a[1],a[2],1)}CanChange(a){return!0}MayNeedBeforeAndAfterInterpolate(){return!0}BeforeChangeProperty(){var a=this._propertyTrack.GetTimeline(),b=this._propertyTrack.GetInstance();const d=this._propertyTrack.GetSourceAdapter();(a=a.GetSimilarPropertyTracks(b,d,this._property,this._propertyTrack))&&1<a.length&&(TMP_COLORS_MAP.has(b)||TMP_COLORS_MAP.set(b,
new Map),b=TMP_COLORS_MAP.get(b),a=this._propertyTrack.GetSourceAdapterId(),b.has(a)||b.set(a,new Map),b=b.get(a),b.has(this._property)||b.set(this._property,{used:!1,color:new C3$jscomp$119.Color(0,0,0,1)}))}_GetTmpColor(a,b,d){a=TMP_COLORS_MAP.get(a).get(b).get(d);a.used=!0;return a.color}ChangeProperty(a,b,d,c,e,g,k,l){e=this._propertyTrack.GetTimeline();c=this._propertyTrack.GetTrack();a=this._propertyTrack.GetInstance();g=this._propertyTrack.GetSourceAdapter();d=this._propertyTrack.GetSourceAdapterId();
if((g=e.GetSimilarPropertyTracks(a,g,this._property,this._propertyTrack))&&1<g.length){if(g=this._GetPropertyKeyframeStubs(g,!0),e=this._GetLastPropertyKeyframeStub(e,e.GetTime(),g))c=c.GetStartOffset(),g=e.time-c,0===g?this._GetTmpColor(a,d,this._property).addRgb(b[0],b[1],b[2]):0>g||(e=b[0],c=b[1],b=b[2],g=this._propertyTrack.Interpolate(g,!1,!0),e=C3$jscomp$119.Color.DiffChannel(e,g[0]),c=C3$jscomp$119.Color.DiffChannel(c,g[1]),b=C3$jscomp$119.Color.DiffChannel(b,g[2]),this._GetTmpColor(a,d,this._property).addRgb(e,
c,b))}else this._Setter(b[0],b[1],b[2])}AfterChangeProperty(){const a=this._propertyTrack.GetInstance();if(TMP_COLORS_MAP.has(a)){var b=TMP_COLORS_MAP.get(a),d=this._propertyTrack.GetSourceAdapterId();if(b.has(d)){var c=b.get(d);if(c.has(this._property)){var e=c.get(this._property),g=e.color;e.used&&this._Setter(g.getR(),g.getG(),g.getB());0===c.size&&b.delete(d);0===b.size&&TMP_COLORS_MAP.delete(a)}}}}_Getter(){const a=this._propertyTrack.GetSourceAdapterId(),b=this._GetTarget(),d=this._GetIndex();
switch(a){case "behavior":return this._GetColorFromArray(b.GetPropertyValueByIndex(d));case "effect":return b[d].clone();case "plugin":return this._GetColorFromArray(b.GetPropertyValueByIndex(d));case "world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(a,b,d){const c=this._propertyTrack.GetSourceAdapterId(),e=this._GetTarget(),g=this._GetIndex();switch(c){case "behavior":TMP_COLOR[0]=a;TMP_COLOR[1]=b;TMP_COLOR[2]=d;e.SetPropertyValueByIndex(g,TMP_COLOR);break;case "effect":e[g].setRgb(a,
b,d);break;case "plugin":TMP_COLOR[0]=a;TMP_COLOR[1]=b;TMP_COLOR[2]=d;e.SetPropertyValueByIndex(g,TMP_COLOR);break;case "world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(a,b,d)}}_SaveToJson(){}_LoadFromJson(a){}}C3$jscomp$119.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=ColorInterpolationAdapter;"use strict";const C3$jscomp$120=self.C3,NS$jscomp$1=C3$jscomp$120.PropertyTrackState;
class NoInterpolationAdapter extends C3$jscomp$120.PropertyTrackState.PropertyInterpolationAdapter{constructor(a){super(a)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return C3$jscomp$120.IsNullOrUndefined(this._saveState)?!1:this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return!1}ChangeProperty(a,
b,d,c,e,g,k,l){d=this._propertyTrack;g=d.GetTrack();c=d.GetSourceAdapterId();e=d.GetTimeline();k=g.GetInstance();l=d.GetSourceAdapter();(k=e.GetSimilarPropertyTracks(k,l,this._property,d))&&1<k.length&&(k=this._GetPropertyKeyframeStubs(k),a+=g.GetStartOffset(),a=this._GetLastPropertyKeyframeStub(e,a,k))&&(b=a.value);switch(d.GetPropertyKeyframeType()){case "numeric":if(!NS$jscomp$1.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),b,c))return;break;case "angle":if(!NS$jscomp$1.AngleTypeAdapter.WillChange(this._GetIndex(),
this._GetTarget(),b,c))return;break;case "boolean":if(!NS$jscomp$1.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),b,c))return;break;case "color":if(!NS$jscomp$1.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),b,c))return;break;case "text":if(!NS$jscomp$1.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),b,c))return}this._Setter(b)}_Getter(){const a=this._propertyTrack.GetSourceAdapterId(),b=this._GetTarget(),d=this._GetIndex();switch(a){case "behavior":return b.GetPropertyValueByIndex(d);
case "effect":return b[d];case "instance-variable":return b.GetInstanceVariableValue(d);case "plugin":return b.GetPropertyValueByIndex(d)}}_Setter(a){const b=this._propertyTrack.GetSourceAdapterId(),d=this._GetTarget(),c=this._GetIndex();switch(b){case "behavior":d.SetPropertyValueByIndex(c,a);break;case "effect":d[c]=a;break;case "instance-variable":d.SetInstanceVariableValue(c,a);break;case "plugin":d.SetPropertyValueByIndex(c,a)}}}
C3$jscomp$120.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=NoInterpolationAdapter;"use strict";const C3$jscomp$121=self.C3,INSTANCE_FUNC_MAP=new Map,add$jscomp$1=(a,b,d,c,e,g=!1,k=null,l=null)=>{INSTANCE_FUNC_MAP.set(a,{setter:b,absolute_setter:d,getter:c,round:e,fRound:g,init:k,reset:l})};add$jscomp$1("offsetX",(a,b,d,c)=>{"relative"===c._propertyTrack.GetResultMode()?a.OffsetX(b,d.GetTimeline().GetTransformWithSceneGraph()):a.OffsetX(b)},(a,b)=>a.SetX(b),a=>a.GetX(),!0);
add$jscomp$1("offsetY",(a,b,d,c)=>{"relative"===c._propertyTrack.GetResultMode()?a.OffsetY(b,d.GetTimeline().GetTransformWithSceneGraph()):a.OffsetY(b)},(a,b)=>a.SetY(b),a=>a.GetY(),!0);
add$jscomp$1("offsetWidth",(a,b,d,c,e)=>{if(0!==b){var g="relative"===c._propertyTrack.GetResultMode(),k=1===c._typeAdapter.GetType();if((g||k)&&a.HasParent()&&a.GetTransformWithParentWidth()){if(isNaN(c._absoluteToFactor)){g=[];for(var l=a.GetParent();l;)g.push(l),l=l.GetParent();g.reverse();l=(w,z)=>{if(z=z.GetTimeline().GetTrackFromInstance(w.GetInstance()))return z.GetOriginalWidth();z=w.GetInstance().GetSdkInstance();return z.IsOriginalSizeKnown()?z.GetOriginalWidth():w._GetSceneGraphInfo()._GetStartWidth()};
const r=(w,z,B,C=0)=>{w=z.GetTimeline().GetTrackFromInstance(w.GetInstance());if(!w)return C;B=w.GetPropertyTrack(B);if(!B)return C;B=B.GetPropertyTrackDataItem().GetPropertyKeyframeData();return B?(B=B.GetLastPropertyKeyframeDataItem())?B.GetValue():C:C};if(k)var n=g[g.length-1].GetWidth();else{k=g[0];n=k._GetSceneGraphInfo()._GetStartWidth();var p=k._GetSceneGraphInfo().GetStartScaleX();n*=p;n+=r(k,d,"offsetWidth");n+=l(k,d)*r(k,d,"offsetScaleX");for(p=1;p<g.length;p++){k=g[p];const w=k._GetSceneGraphInfo().GetStartScaleX();
n*=w;n+=r(k,d,"offsetWidth");n+=l(k,d)*r(k,d,"offsetScaleX")}}c._absoluteToFactor=0===n?Number.EPSILON:n}e||a.OffsetWidth(b/c._absoluteToFactor,!0)}else a.OffsetWidth(b)}},(a,b)=>a.SetWidth(b),a=>a.GetWidth(),!0);
add$jscomp$1("offsetHeight",(a,b,d,c,e)=>{if(0!==b){var g="relative"===c._propertyTrack.GetResultMode(),k=1===c._typeAdapter.GetType();if((g||k)&&a.HasParent()&&a.GetTransformWithParentHeight()){if(isNaN(c._absoluteToFactor)){g=[];for(var l=a.GetParent();l;)g.push(l),l=l.GetParent();g.reverse();l=(w,z)=>{if(z=z.GetTimeline().GetTrackFromInstance(w.GetInstance()))return z.GetOriginalHeight();z=w.GetInstance().GetSdkInstance();return z.IsOriginalSizeKnown()?z.GetOriginalHeight():w._GetSceneGraphInfo()._GetStartHeight()};
const r=(w,z,B,C=0)=>{w=z.GetTimeline().GetTrackFromInstance(w.GetInstance());if(!w)return C;B=w.GetPropertyTrack(B);if(!B)return C;B=B.GetPropertyTrackDataItem().GetPropertyKeyframeData();return B?(B=B.GetLastPropertyKeyframeDataItem())?B.GetValue():C:C};if(k)var n=g[g.length-1].GetHeight();else{k=g[0];n=k._GetSceneGraphInfo()._GetStartHeight();var p=k._GetSceneGraphInfo().GetStartScaleY();n*=p;n+=r(k,d,"offsetHeight");n+=l(k,d)*r(k,d,"offsetScaleY");for(p=1;p<g.length;p++){k=g[p];const w=k._GetSceneGraphInfo().GetStartScaleY();
n*=w;n+=r(k,d);n+=l(k,d)*r(k,d,"offsetScaleY")}}c._absoluteToFactor=0===n?Number.EPSILON:n}e||a.OffsetHeight(b/c._absoluteToFactor,!0)}else a.OffsetHeight(b)}},(a,b)=>a.SetHeight(b),a=>a.GetHeight(),!0);add$jscomp$1("offsetAngle",(a,b,d,c,e)=>{a.OffsetAngle(b)},(a,b)=>a.SetAngle(b),a=>a.GetAngle(),!1,!0);
add$jscomp$1("offsetOpacity",(a,b,d,c,e)=>{b/=c._opacityFactor?c._opacityFactor:1;d=a.GetOpacity()+b;0===c._clampAccumulator?(1<d?c._clampAccumulator+=d-1:0>d&&(c._clampAccumulator+=d),a.OffsetOpacity(b)):(a=a.GetOpacity()+b,0<b&&0<c._clampAccumulator?1<a&&(c._clampAccumulator+=a-1):0<b&&0>c._clampAccumulator?(c._clampAccumulator+=b,0<c._clampAccumulator&&(c._clampAccumulator=0)):0>b&&0<c._clampAccumulator?(c._clampAccumulator+=b,0>c._clampAccumulator&&(c._clampAccumulator=0)):0>b&&0>c._clampAccumulator&&
0>a&&(c._clampAccumulator+=a))},(a,b)=>{a.SetOpacity(b)},a=>a.GetOpacity(),!1,!0,(a,b,d)=>{a._clampAccumulator=0;switch(a._propertyTrack.GetResultMode()){case "relative":a._propertyTrack.GetPropertyTrackData();var c=a._propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),e=a.GetWorldInfo().GetOpacity(),g=e;for(var k of c)g=k.GetTime(),g=a._propertyTrack.GetInterpolatedValue(g),g=e+g,g=C3$jscomp$121.clamp(g,0,1);a._totalForewardOpacityDelta=e-g;a._totalForewardOpacityDelta=
Math.round(100*(a._totalForewardOpacityDelta+Number.EPSILON))/100;g=e;for(e=c.length-1;0<=e;e--)k=c[e].GetTime(),k=a._propertyTrack.GetInterpolatedValue(k),g-=k,g=C3$jscomp$121.clamp(g,0,1);a._totalBackwardOpacityDelta=g;a._totalBackwardOpacityDelta=Math.round(100*(a._totalBackwardOpacityDelta+Number.EPSILON))/100}c="relative"===a._propertyTrack.GetResultMode();g=1===a._typeAdapter.GetType();if((c||g)&&b.HasParent()&&b.GetTransformWithParentOpacity()){c=[];for(b=b.GetParent();b;)c.push(b),b=b.GetParent();
c.reverse();b=(l,n,p)=>{l=n.GetTimeline().GetTrackFromInstance(l.GetInstance());if(!l)return 0;p=l.GetPropertyTrack(p);if(!p)return 0;p=p.GetPropertyTrackDataItem().GetPropertyKeyframeData();return p?(p=p.GetLastPropertyKeyframeDataItem())?p.GetValue():0:0};g=c[0]._GetSceneGraphInfo().GetStartOpacity();g+=b(c[0],d,"offsetOpacity");for(e=1;e<c.length;e++)g+=b(c[e],d,"offsetOpacity");a._opacityFactor=0===g?1:g}},a=>{switch(a._propertyTrack.GetResultMode()){case "relative":a._clampAccumulator=0;const b=
a.GetWorldInfo();let d=b.GetOpacity();d=Math.round(100*(d+Number.EPSILON))/100;a._propertyTrack.GetTimeline().IsForwardPlayBack()?(b.SetOpacity(d+a._totalForewardOpacityDelta),a._lastValue=0):(b.SetOpacity(d-a._totalBackwardOpacityDelta),a._lastValue=a.GetSourceAdapter().GetValueAtTime())}});add$jscomp$1("offsetOriginX",(a,b)=>a.OffsetOriginX(b),(a,b)=>a.SetOriginX(b),a=>a.GetOriginX(),!1);add$jscomp$1("offsetOriginY",(a,b)=>a.OffsetOriginY(b),(a,b)=>a.SetOriginY(b),a=>a.GetOriginY(),!1);
add$jscomp$1("offsetZElevation",(a,b)=>a.OffsetZElevation(b),(a,b)=>a.SetZElevation(b),a=>a.GetZElevation(),!0);
add$jscomp$1("offsetScaleX",(a,b,d,c)=>{if(0!==b){var e=0>a.GetWidth()?-1:1;"relative"===c._propertyTrack.GetResultMode()&&a.HasParent()&&a.GetTransformWithParentWidth()?(b*=d.GetOriginalWidth()*e,isNaN(c._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetWidth").setter(a,1,d,c,!0),a.OffsetWidth(b/c._absoluteToFactor,!0)):a.OffsetWidth(d.GetOriginalWidth()*e*b)}},(a,b,d)=>{a.SetWidth(d.GetOriginalWidth()*b)},(a,b)=>{const d=0>a.GetWidth()?-1:1;if(a.GetTransformWithParentWidth()){var c=a.GetParent(),
e=b.GetTimeline().GetTrackFromInstance(c.GetInstance());e?c=c.GetWidth()/e.GetOriginalWidth():(e=c.GetInstance().GetSdkInstance(),c=e.IsOriginalSizeKnown()?c.GetWidth()/e.GetOriginalWidth():1);return a.GetWidth()*d/(b.GetOriginalWidth()*c)}return a.GetWidth()*d/b.GetOriginalWidth()},!1);
add$jscomp$1("offsetScaleY",(a,b,d,c)=>{if(0!==b){var e=0>a.GetHeight()?-1:1;"relative"===c._propertyTrack.GetResultMode()&&a.HasParent()&&a.GetTransformWithParentHeight()?(b*=d.GetOriginalHeight()*e,isNaN(c._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetHeight").setter(a,1,d,c,!0),a.OffsetHeight(b/c._absoluteToFactor,!0)):a.OffsetHeight(d.GetOriginalHeight()*e*b)}},(a,b,d)=>{a.SetHeight(d.GetOriginalHeight()*b)},(a,b)=>{const d=0>a.GetHeight()?-1:1;if(a.GetTransformWithParentHeight()){var c=a.GetParent(),
e=b.GetTimeline().GetTrackFromInstance(c.GetInstance());e?c=c.GetHeight()/e.GetOriginalHeight():(e=c.GetInstance().GetSdkInstance(),c=e.IsOriginalSizeKnown()?c.GetHeight()/e.GetOriginalHeight():1);return a.GetHeight()*d/(b.GetOriginalHeight()*c)}return a.GetHeight()*d/b.GetOriginalHeight()},!1);
class NumericInterpolationAdapter extends C3$jscomp$121.PropertyTrackState.PropertyInterpolationAdapter{constructor(a){super(a);this._totalBackwardOpacityDelta=this._totalForewardOpacityDelta=this._clampAccumulator=this._lastValue=0;this._absoluteToFactor=this._opacityFactor=NaN;this._angleReflectMirrorAndFlip=this._angleReflectMirrorOrFlip=void 0;this._source_adapter_absolute_setter=this._source_adapter_setter=this._source_adapter_getter=this._init_action=this._reset_action=this._instance_absolute_setter=
this._instance_setter=this._instance_getter=null;this._fRound=this._round=!1;C3$jscomp$121.IsInstanceOf(this._propertyTrack.GetTimeline(),C3$jscomp$121.TweenState)?this._typeAdapter=new C3$jscomp$121.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this):this._typeAdapter=new C3$jscomp$121.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);const b=this._propertyTrack.GetPropertyName();switch(this._propertyTrack.GetSourceAdapterId()){case "world-instance":a=
INSTANCE_FUNC_MAP.get(b);this._instance_getter=a.getter;this._instance_setter=a.setter;this._instance_absolute_setter=a.absolute_setter;this._round=a.round;this._fRound=a.fRound;this._init_action=a.init;this._reset_action=a.reset;break;case "audio":this._source_adapter_getter=a.Getter,this._source_adapter_setter=a.Setter,this._source_adapter_absolute_setter=a.AbsoluteSetter,this._round=!!a.DoesRounding(),this._fRound=!1}}Release(){this._source_adapter_absolute_setter=this._source_adapter_setter=this._source_adapter_getter=
this._init_action=this._reset_action=this._instance_absolute_setter=this._instance_setter=this._instance_getter=this._typeAdapter=null;super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(a){this._lastValue=a}SetResetState(){this._reset_action&&this._reset_action(this)}SetInitialState(){var a=this._typeAdapter.SetInitialState();"number"===typeof a&&(this._lastValue=a);if(this._init_action){a=
this.GetWorldInfo();const b=this._propertyTrack.GetTrack();this._init_action(this,a,b)}}SetResumeState(){const a=this._typeAdapter.SetResumeState();"number"===typeof a&&(this._lastValue=a)}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return C3$jscomp$121.IsNullOrUndefined(this._saveState)?!1:this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(a,
b,d,c,e,g,k,l){return this._typeAdapter.ChangeProperty(a,b,d,c,e,g,k,l)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){const a=this._GetTarget(),b=this._GetIndex(),d=this.GetWorldInfo(),c=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case "behavior":return a.GetPropertyValueByIndex(b);case "effect":return a[b];case "instance-variable":return a.GetInstanceVariableValue(b);case "plugin":return a.GetPropertyValueByIndex(b);case "world-instance":return this._instance_getter(d,
c);case "audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),d,c)}}_Setter(a,b,d){b=this._GetTarget();d=this._GetIndex();const c=this.GetWorldInfo(),e=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case "behavior":b.OffsetPropertyValueByIndex(d,a);break;case "effect":b[d]+=a;break;case "instance-variable":b.SetInstanceVariableOffset(d,a);break;case "plugin":b.OffsetPropertyValueByIndex(d,a,this.GetSourceAdapter().GetOptionalCallbacks());break;case "world-instance":this._instance_setter(c,
a,e,this);break;case "audio":this._source_adapter_setter.call(this.GetSourceAdapter(),c,a,e,this)}}_SetterAbsolute(a,b,d){var c=this._propertyTrack.GetInterpolationMode();c="default"===c?"continuous":c;if("discrete"!==c||b){if("discrete"===c&&d&&(b=this._propertyTrack.GetTimeline().GetTime(),!this._propertyTrack.GetPropertyKeyFrameDataItemAtTime(b)))return;b=this._GetTarget();d=this._GetIndex();c=this.GetWorldInfo();var e=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case "behavior":b.SetPropertyValueByIndex(d,
a);break;case "effect":b[d]=a;break;case "instance-variable":b.SetInstanceVariableValue(d,a);break;case "plugin":b.SetPropertyValueByIndex(d,a,this.GetSourceAdapter().GetOptionalCallbacks());break;case "world-instance":this._instance_absolute_setter(c,a,e);break;case "audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),c,a,e)}}}_MaybeEnsureValue(a,b,d,c,e,g,k,l){this._typeAdapter._MaybeEnsureValue(a,b,d,c,e,g,k,l)}_AddDelta(a,b,d,c,e){switch(this._propertyTrack.GetPropertyType()){case "angle":a=
C3$jscomp$121.toDegrees(a)}c=(a.toString().split(".")[1]||"").length;a=this._Getter();if(0===c)if(this._round)c=Math.round(a);else if(this._fRound)switch(this._propertyTrack.GetPropertyType()){case "angle":c=C3$jscomp$121.toRadians(Math.round(C3$jscomp$121.toDegrees(a)));break;default:c=Number(C3$jscomp$121.toFixed(a,2))}else c=a;else c=this._round?Number(C3$jscomp$121.toFixed(a,c)):a;this._Setter(c-a,b,d);switch(this._propertyTrack.GetPropertyName()){case "offsetWidth":case "offsetScaleX":b=this.GetWorldInfo();
d=b.GetWidth();a=Number(C3$jscomp$121.toFixed(d,2));b.OffsetWidth(a-d);break;case "offsetHeight":case "offsetScaleY":b=this.GetWorldInfo(),d=b.GetHeight(),a=Number(C3$jscomp$121.toFixed(d,2)),b.OffsetHeight(a-d)}}_SaveToJson(){return Object.assign(super._SaveToJson(),{v:this._lastValue,a:this._clampAccumulator,fod:this._totalForewardOpacityDelta,bod:this._totalBackwardOpacityDelta,of:this._opacityFactor,sf:this._absoluteToFactor,armorf:this._angleReflectMirrorOrFlip,armandf:this._angleReflectMirrorAndFlip})}_LoadFromJson(a){a&&
(super._LoadFromJson(a),this._lastValue=a.v,this._clampAccumulator=a.a,this._totalForewardOpacityDelta=C3$jscomp$121.IsFiniteNumber(a.fod)?a.fod:0,this._totalBackwardOpacityDelta=C3$jscomp$121.IsFiniteNumber(a.bod)?a.bod:0,this._opacityFactor=C3$jscomp$121.IsFiniteNumber(a.of)?a.of:NaN,this._absoluteToFactor=C3$jscomp$121.IsFiniteNumber(a.sf)?a.sf:NaN,this._angleReflectMirrorOrFlip=C3$jscomp$121.IsFiniteNumber(a.armorf)?a.armorf:void 0,this._angleReflectMirrorAndFlip=C3$jscomp$121.IsFiniteNumber(a.armandf)?
a.armandf:void 0)}}C3$jscomp$121.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=NumericInterpolationAdapter;"use strict";
class AbsoluteValueObject{constructor(a){this._used=!1;this._value=0;this._endState=this._propertyKeyframeReached=!1;this._propertyTracks=a;for(let b=0,d=this._propertyTracks.length;b<d;b++)this._propertyTracks[b].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=!0}GetUsed(){return this._used}SetValue(a){this._value=a}GetValue(){return this._value}SetPropertyKeyframeReached(a){this._propertyKeyframeReached=a}GetPropertyKeyframeReached(){return this._propertyKeyframeReached}SetEndState(a){this._endState=
a}GetEndState(){return this._endState}Reset(){this._used=!1;this._value=0;this._endState=this._propertyKeyframeReached=!1}}
class NumericInterpolationAdapterForTimeline{constructor(a){this._numericInterpolationAdapter=a}Release(){this._numericInterpolationAdapter=null}GetType(){return 0}SetInitialState(){const a=this._numericInterpolationAdapter;this._numericInterpolationAdapter.GetPropertyTrack();return a._PickResultMode(()=>a._PickTimelinePlaybackMode(()=>0,()=>a.GetSourceAdapter().GetValueAtTime()),()=>{})}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){switch(this._numericInterpolationAdapter.GetPropertyTrack().GetResultMode()){case "relative":return!1;
case "absolute":return!0}}BeforeChangeProperty(){var a=this._numericInterpolationAdapter.GetPropertyTrack();const b=a.GetPropertyName();switch(a.GetResultMode()){case "absolute":if(a.HasAbsoluteValueObject())a.GetAbsoluteValueObject().Reset();else{const d=a.GetTimeline(),c=a.GetInstance(),e=a.GetSourceAdapter();(a=d.GetSimilarPropertyTracks(c,e,b,a))&&1<a.length&&new AbsoluteValueObject(a)}}}ChangeProperty(a,b,d,c,e,g,k,l){var n=this._numericInterpolationAdapter,p=this._numericInterpolationAdapter.GetPropertyTrack();
switch(p.GetResultMode()){case "relative":k=n.GetLastValue();n._Setter(b-k,d,c);g&&this._MaybeEnsureValue(a,d,c,e,k,b);n.SetLastValue(b);break;case "absolute":if(c=p.GetTimeline(),d=p.GetTrack(),p.GetInstance(),p.GetSourceAdapter(),p.HasAbsoluteValueObject()){if(a=p.GetAbsoluteValueObject(),e=a.GetPropertyTracks(),e=n._GetPropertyKeyframeStubs(e,!0),n=n._GetLastPropertyKeyframeStub(c,c.GetTime(),e))d=d.GetStartOffset(),n=n.time-d,0===n?(a.SetEndState(k),a.SetPropertyKeyframeReached(l),a.SetUsed(),
a.SetValue(a.GetValue()+b)):0>n||(p=p.GetInterpolatedValue(n),a.SetEndState(k),a.SetPropertyKeyframeReached(l),a.SetUsed(),a.SetValue(a.GetValue()+(b-p)))}else n._SetterAbsolute(b,l,k)}}AfterChangeProperty(){const a=this._numericInterpolationAdapter;var b=this._numericInterpolationAdapter.GetPropertyTrack();switch(b.GetResultMode()){case "absolute":b.HasAbsoluteValueObject()&&(b=b.GetAbsoluteValueObject(),b.GetUsed()&&a._SetterAbsolute(b.GetValue(),b.GetPropertyKeyframeReached(),b.GetEndState()))}}_MaybeEnsureValue(a,
b,d,c,e,g){const k=this._numericInterpolationAdapter;c||(b&&a===b.GetTime()?k._AddDelta(b.GetValueWithResultMode(),b,d):d&&a===d.GetTime()?k._AddDelta(d.GetValueWithResultMode(),b,d):0===g-e&&k._AddDelta(b.GetValueWithResultMode(),b,d))}}self.C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=NumericInterpolationAdapterForTimeline;"use strict";
class NumericInterpolationAdapterForTween{constructor(a){this._numericInterpolationAdapter=a}Release(){this._numericInterpolationAdapter=null}GetType(){return 1}SetInitialState(){const a=this._numericInterpolationAdapter;a.SetFirstAbsoluteUpdate(!0);return this._GetAbsoluteInitialValue(a._FirstKeyframeGetter())}SetResumeState(){const a=this._numericInterpolationAdapter;if(a._FirstKeyframeGetter()!==a._CurrentKeyframeGetter())return a.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(a._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return!1}BeforeChangeProperty(){}ChangeProperty(a,
b,d,c,e,g,k,l){l=this._numericInterpolationAdapter;const n=l.GetLastValue();switch(l.GetPropertyTrack().GetResultMode()){case "relative":l._Setter(b-n,d,c);g&&this._MaybeEnsureValue(a,d,c,e,n,b,!1,k);break;case "absolute":l.GetFirstAbsoluteUpdate()?(l.SetFirstAbsoluteUpdate(!1),l._Setter(n,d,c)):0===a&&0===l.GetPropertyTrack().GetTimeline().GetTotalTime()?l._SetterAbsolute(b,!0,!1):(l._Setter(b-n,d,c),g&&this._MaybeEnsureValue(a,d,c,e,n,b,this._ForceEndValue(),k))}l.SetLastValue(b)}AfterChangeProperty(){}_GetAbsoluteInitialValue(a){return a-
this._numericInterpolationAdapter.GetCurrentState()}_ForceEndValue(){var a=this._numericInterpolationAdapter;const b=a.GetWorldInfo().GetInstance();a=a.GetPropertyTrack().GetRuntime().GetTimelineManager();let d=0;for(const c of a.GetPlayingTimelines())0===c.GetType()?c.HasTrackInstance(b)&&d++:1===c.GetType()&&c.GetInstance()===b&&d++;return 1>=d}_MaybeEnsureValue(a,b,d,c,e,g,k,l){const n=this._numericInterpolationAdapter;c?b&&a===b.GetTime()?n._AddDelta(b.GetValueWithResultMode(),b,d,k,l):d&&a===
d.GetTime()?n._AddDelta(d.GetValueWithResultMode(),b,d,k,l):d||n._AddDelta(b.GetValueWithResultMode(),b,d,k,l):b&&a===b.GetTime()?n._AddDelta(b.GetValueWithResultMode(),b,d,k,l):d&&a===d.GetTime()?n._AddDelta(d.GetValueWithResultMode(),b,d,k,l):0===g-e&&n._AddDelta(b.GetValueWithResultMode(),b,d,k,l)}}self.C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=NumericInterpolationAdapterForTween;"use strict";const C3$jscomp$124=self.C3,Ease$jscomp$1=self.Ease;
C3$jscomp$124.PropertyTrackState.NumericTypeAdapter=class{constructor(){}static WillChange(a,b,d,c){let e;switch(c){case "behavior":e=b.GetPropertyValueByIndex(a);break;case "effect":e=b[a];break;case "instance-variable":e=b.GetInstanceVariableValue(a);break;case "plugin":e=b.GetPropertyValueByIndex(a)}return e===d?!1:!0}static Interpolate(a,b,d,c){if(!d){var e=c.GetPropertyTrackDataItem();e=c.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e);return e.GetValueWithResultMode()}let g=c.GetInterpolationMode();
"default"===g&&(g="continuous");"combo"===c.GetPropertyType()&&(g="discrete");if("discrete"===g)return b.GetValueWithResultMode();if("continuous"===g||"step"===g){const l=c.GetTimeline().GetStep();"step"===g&&0!==l&&(e=1/l,a=Math.floor(a*e)/e);e=b.GetValueWithResultMode();const n=d.GetValueWithResultMode(),p=b.GetAddOn("cubic-bezier"),r=d.GetAddOn("cubic-bezier");var k=p&&p.GetStartEnable()&&r&&r.GetEndEnable();if(!k&&e===n)return e;const w=b.GetTime();d=d.GetTime();"step"===g&&0!==l&&(a=C3$jscomp$124.clamp(a,
w,d));a=C3$jscomp$124.normalize(a,w,d);b=b.GetEase();k?(k=d-w,b=Ease$jscomp$1.GetRuntimeEase(b)(k*a,0,1,k),b=Ease$jscomp$1.GetRuntimeEase("cubicbezier")(b,e,e+p.GetStartAnchor(),n+r.GetEndAnchor(),n)):b=Ease$jscomp$1.GetRuntimeEase(b)((d-w)*a,e,n-e,d-w);return"integer"===c.GetPropertyType()?Math.floor(b):b}}};"use strict";const C3$jscomp$125=self.C3;
C3$jscomp$125.PropertyTrackState.AngleTypeAdapter=class{constructor(){}static WillChange(a,b,d,c){let e;switch(c){case "behavior":e=b.GetPropertyValueByIndex(a);break;case "effect":e=b[a];break;case "instance-variable":e=b.GetInstanceVariableValue(a);break;case "plugin":e=b.GetPropertyValueByIndex(a)}return e===d?!1:!0}static Interpolate(a,b,d,c){if(!d)return b=c.GetPropertyTrackDataItem(),b=c.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(b),b.GetValueWithResultMode();var e=c.GetInterpolationMode();
"default"===e&&(e="continuous");"combo"===c.GetPropertyType()&&(e="discrete");if("discrete"===e)return b.GetValueWithResultMode();if("continuous"===e||"step"===e){var g=c.GetTimeline().GetStep();"step"===e&&0!==g&&(c=1/g,a=Math.floor(a*c)/c);const k=b.GetTime(),l=d.GetTime();c=b.GetValueWithResultMode();d=d.GetValueWithResultMode();"step"===e&&0!==g&&(a=C3$jscomp$125.clamp(a,k,l));if(e=b.GetAddOn("angle")){g=e.GetRevolutions();if(c===d&&0===g)return c;a=C3$jscomp$125.normalize(a,k,l);b=self.Ease.GetRuntimeEase(b.GetEase())(a,
0,1,1);switch(e.GetDirection()){case "closest":return C3$jscomp$125.angleLerp(c,d,b,g);case "clockwise":return C3$jscomp$125.angleLerpClockwise(c,d,b,g);case "anti-clockwise":return C3$jscomp$125.angleLerpAntiClockwise(c,d,b,g)}}else{if(c===d)return c;a=C3$jscomp$125.normalize(a,k,l);b=self.Ease.GetRuntimeEase(b.GetEase());return C3$jscomp$125.angleLerp(c,d,b(a,0,1,1))}}}};"use strict";
self.C3.PropertyTrackState.BooleanTypeAdapter=class{constructor(){}static WillChange(a,b,d,c){let e;switch(c){case "behavior":e=b.GetPropertyValueByIndex(a);break;case "effect":e=b[a];break;case "instance-variable":e=b.GetInstanceVariableValue(a);break;case "plugin":e=b.GetPropertyValueByIndex(a)}return!!e===!!d?!1:!0}static Interpolate(a,b,d,c){return d?b.GetValueWithResultMode()?1:0:(a=c.GetPropertyTrackDataItem(),a=c.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(a),a.GetValueWithResultMode()?
1:0)}};"use strict";const C3$jscomp$127=self.C3,TEMP_COLOR_ARRAY=[0,0,0],TEMP_COLOR_ARRAY_2=[0,0,0],TEMP_COLOR_ARRAY_3=[0,0,0];
C3$jscomp$127.PropertyTrackState.ColorTypeAdapter=class{constructor(){}static WillChange(a,b,d,c){let e;switch(c){case "behavior":e=b.GetPropertyValueByIndex(a);break;case "effect":e=b[a];break;case "instance-variable":e=b.GetInstanceVariableValue(a);break;case "plugin":e=b.GetPropertyValueByIndex(a)}Array.isArray(d)?(TEMP_COLOR_ARRAY[0]=d[0],TEMP_COLOR_ARRAY[1]=d[1],TEMP_COLOR_ARRAY[2]=d[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(d),TEMP_COLOR_ARRAY[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),
TEMP_COLOR_ARRAY[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB()));Array.isArray(e)?(TEMP_COLOR_ARRAY_2[0]=e[0],TEMP_COLOR_ARRAY_2[1]=e[1],TEMP_COLOR_ARRAY_2[2]=e[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(e),TEMP_COLOR_ARRAY_2[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY_2[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY_2[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB()));return TEMP_COLOR_ARRAY[0]!==TEMP_COLOR_ARRAY_2[0]||
TEMP_COLOR_ARRAY[1]!==TEMP_COLOR_ARRAY_2[1]||TEMP_COLOR_ARRAY[2]!==TEMP_COLOR_ARRAY_2[2]?!0:!1}static Interpolate(a,b,d,c){if(!d){var e=c.GetPropertyTrackDataItem();e=c.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e);c=e.GetValueWithResultMode();TEMP_COLOR_ARRAY[0]=c[0];TEMP_COLOR_ARRAY[1]=c[1];TEMP_COLOR_ARRAY[2]=c[2];return TEMP_COLOR_ARRAY}var g=c.GetInterpolationMode();"default"===g&&(g="continuous");if("discrete"===g)return c=b.GetValueWithResultMode(),TEMP_COLOR_ARRAY[0]=c[0],TEMP_COLOR_ARRAY[1]=
c[1],TEMP_COLOR_ARRAY[2]=c[2],TEMP_COLOR_ARRAY;if("continuous"===g||"step"===g){var k=c.GetTimeline().GetStep();"step"===g&&0!==k&&(c=1/k,a=Math.floor(a*c)/c);c=b.GetTime();e=d.GetTime();var l=b.GetValueWithResultMode();d=d.GetValueWithResultMode();"step"===g&&0!==k&&(a=C3$jscomp$127.clamp(a,c,e));a=C3$jscomp$127.normalize(a,c,e);var n=b.GetEase();b=l[0];g=l[1];l=l[2];k=d[0];const p=d[1];d=d[2];n=self.Ease.GetRuntimeEase(n);c=e-c;e=c*a;TEMP_COLOR_ARRAY[0]=b===k?b:n(e,b,k-b,c);TEMP_COLOR_ARRAY[1]=
g===p?g:n(e,g,p-g,c);TEMP_COLOR_ARRAY[2]=l===d?l:n(e,l,d-l,c);return TEMP_COLOR_ARRAY}}};"use strict";
self.C3.PropertyTrackState.TextTypeAdapter=class{constructor(){}static WillChange(a,b,d,c){let e;switch(c){case "behavior":e=b.GetPropertyValueByIndex(a);break;case "effect":e=b[a];break;case "instance-variable":e=b.GetInstanceVariableValue(a);break;case "plugin":e=b.GetPropertyValueByIndex(a)}return e===d?!1:!0}static Interpolate(a,b,d,c){return d?b.GetValueWithResultMode():(a=c.GetPropertyTrackDataItem(),a=c.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(a),a.GetValueWithResultMode())}};
"use strict";const C3$jscomp$129=self.C3;
C3$jscomp$129.TimelineDataManager=class{constructor(){this._timelineDataItems=new Map}Release(){for(const a of this._timelineDataItems.values())a.Release();this._timelineDataItems.clear();this._timelineDataItems=null}Add(a){a=new C3$jscomp$129.TimelineDataItem(a);const b=a.GetName();this._timelineDataItems.set(b,a)}Get(a){return this._timelineDataItems.get(a)}GetNameId(){return 0}static _CreateDataItems(a,b,d,c){if(b)for(const e of b)C3$jscomp$129.TimelineDataManager._CreateDataItem("create",e,a,
d,c)}static _CreateDataItemsIncludingDisabled(a,b,d,c){if(b)for(const e of b)C3$jscomp$129.TimelineDataManager._CreateDataItem("create-including-disabled",e,a,d,c)}static _LoadDataItemsFromJson(a,b,d,c){a.length?b.forEach((e,g)=>{a[g]._LoadFromJson(e)}):b.forEach(e=>{C3$jscomp$129.TimelineDataManager._CreateDataItem("load",e,a,d,c)})}static _CreateDataItem(a,b,d,c,e){let g;if("function"===typeof c)switch(a){case "load":g=new c(null,e);break;case "create":g=new c(b,e);break;case "create-including-disabled":g=
new c(b,e)}else if("object"===typeof c)switch(c=c.map.get(b[c.prop]),a){case "load":g=new c(null,e);break;case "create":g=new c(b,e);break;case "create-including-disabled":g=new c(b,e)}switch(a){case "load":g._LoadFromJson(b);d.push(g);break;case "create":if("function"===typeof g.GetEnable&&!g.GetEnable())return g.Release();d.push(g);break;case "create-including-disabled":d.push(g)}}};"use strict";const C3$jscomp$130=self.C3;
C3$jscomp$130.TimelineDataItem=class{constructor(a){this._name="";this._totalTime=NaN;this._step=0;this._resultMode=this._interpolationMode="default";this._pingPong=this._loop=!1;this._repeatCount=1;this._trackData=null;this._startOnLayout="";this._transformWithSceneGraph=!1;this._useSystemTimescale=!0;a&&(this._name=a[0],this._totalTime=a[1],this._step=a[2],this._interpolationMode=a[3],this._resultMode=a[4],this._loop=!!a[6],this._pingPong=!!a[7],this._repeatCount=a[8],this._startOnLayout=a[9],this._transformWithSceneGraph=
!!a[10],this._useSystemTimescale=!!a[11],this._trackData=new C3$jscomp$130.TrackData(a[5],this))}Release(){this._trackData.Release();this._trackData=null}GetTrackData(){this._trackData||(this._trackData=new C3$jscomp$130.TrackData(null,this));return this._trackData}GetName(){return this._name}SetName(a){this._name=a}GetTotalTime(){return this._totalTime}SetTotalTime(a){this._totalTime=a}GetStep(){return this._step}SetStep(a){this._step=a}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(a){this._interpolationMode=
a}GetResultMode(){return this._resultMode}SetResultMode(a){this._resultMode=a}GetLoop(){return this._loop}SetLoop(a){this._loop=a}GetPingPong(){return this._pingPong}SetPingPong(a){this._pingPong=a}GetRepeatCount(){return this._repeatCount}SetRepeatCount(a){this._repeatCount=a}GetStartOnLayout(){return this._startOnLayout}GetTransformWithSceneGraph(){return this._transformWithSceneGraph}GetUseSystemTimescale(){return this._useSystemTimescale}_SaveToJson(){return{trackDataJson:this._trackData._SaveToJson(),
name:this._name,totalTime:this._totalTime,step:this._step,interpolationMode:this._interpolationMode,resultMode:this._resultMode,loop:this._loop,pingPong:this._pingPong,repeatCount:this._repeatCount,startOnLayout:this._startOnLayout,transformWithSceneGraph:!!this._transformWithSceneGraph,useSystemTimescale:this._useSystemTimescale}}_LoadFromJson(a){a&&(this.GetTrackData()._LoadFromJson(a.trackDataJson),this._name=a.name,this._totalTime=a.totalTime,this._step=a.step,this._interpolationMode=a.interpolationMode,
this._resultMode=a.resultMode,this._loop=a.loop,this._pingPong=a.pingPong,this._repeatCount=a.repeatCount,this._startOnLayout=a.startOnLayout,this._transformWithSceneGraph=!!a.transformWithSceneGraph,this._useSystemTimescale=!!a.useSystemTimescale)}};"use strict";const C3$jscomp$131=self.C3;
class TrackDataItem{constructor(a,b){this._trackData=b;this._additionalInstanceData=this._instanceData=null;this._objectClassIndex=this._instanceUid=NaN;this._resultMode=this._interpolationMode="default";this._enabled=!1;this._propertyTrackData=this._keyframeData=null;this._id="";this._nestedData=null;this._startOffset=0;this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime();this._type=0;this._name="";a&&(a[0]&&(this._instanceData=a[0],this._instanceUid=a[0][2],this._objectClassIndex=
a[0][1]),this._interpolationMode=a[1],this._resultMode=a[2],this._enabled=!!a[3],a[6]&&(this._id=a[6]),a[7]&&(this._nestedData=a[7],this._startOffset=a[7][0],this._localTotalTime=a[7][1]),a[8]&&(this._additionalInstanceData=a[8]),a[8]&&(this._additionalInstanceData=a[8]),a[9]&&(this._type=a[9]),a[10]&&(this._name=a[10]),this._keyframeData=new C3$jscomp$131.KeyframeData(a[4],this),this._propertyTrackData=new C3$jscomp$131.PropertyTrackData(a[5],this))}Release(){this._trackData=this._instanceData=null;
this._keyframeData&&(this._keyframeData.Release(),this._keyframeData=null);this._propertyTrackData&&(this._propertyTrackData.Release(),this._propertyTrackData=null);this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){this._keyframeData||(this._keyframeData=new C3$jscomp$131.KeyframeData(null,this));return this._keyframeData}GetPropertyTrackData(){this._propertyTrackData||(this._propertyTrackData=new C3$jscomp$131.PropertyTrackData(null,this));return this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(a){this._objectClassIndex=
a}GetInstanceUID(){return this._instanceUid}SetInstanceUID(a){this._instanceUid=a}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(a){this._interpolationMode=a}GetResultMode(){return this._resultMode}SetResultMode(a){this._resultMode=a}GetEnable(){return this._enabled}SetEnable(a){this._enabled=!!a}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(a){this._localTotalTime=a}GetOriginalWidth(){return this._additionalInstanceData[0]}SetOriginalWidth(a){this._additionalInstanceData||
(this._additionalInstanceData=[]);this._additionalInstanceData[0]=a}GetOriginalHeight(){this._additionalInstanceData||(this._additionalInstanceData=[]);return this._additionalInstanceData[1]}SetOriginalHeight(a){this._additionalInstanceData||(this._additionalInstanceData=[]);this._additionalInstanceData[1]=a}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{keyframeDataJson:this._keyframeData._SaveToJson(),propertyTrackDataJson:this._propertyTrackData._SaveToJson(),instanceData:this._instanceData,
additionalInstanceData:this._additionalInstanceData,instanceUid:this._instanceUid,objectClassIndex:this._objectClassIndex,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,id:this._id,nestedData:this._nestedData,type:this._type,name:this._name}}_LoadFromJson(a){a&&(this._instanceData=a.instanceData,this._instanceUid=a.instanceUid,this._objectClassIndex=a.objectClassIndex,this._interpolationMode=a.interpolationMode,this._resultMode=a.resultMode,this._enabled=
a.enabled,this._id=a.id,this._type=a.type?a.type:0,this._name=a.name?a.name:"",this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),a.nestedData&&(this._nestedData=a.nestedData,this._startOffset=this._nestedData[0],this._localTotalTime=this._nestedData[1]),a.additionalInstanceData&&(this._additionalInstanceData=a.additionalInstanceData),this.GetKeyframeData()._LoadFromJson(a.keyframeDataJson),this.GetPropertyTrackData()._LoadFromJson(a.propertyTrackDataJson))}}
C3$jscomp$131.TrackData=class{constructor(a,b){this._timelineDataItem=b;this._trackDataItems=[];C3$jscomp$131.TimelineDataManager._CreateDataItems(this._trackDataItems,a,TrackDataItem,this)}Release(){this._timelineDataItem=null;for(const a of this._trackDataItems)a.Release();C3$jscomp$131.clearArray(this._trackDataItems);this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){const a=new TrackDataItem(null,this);this._trackDataItems.push(a);return a}GetFirstKeyframeDataItem(a){return a.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(a){return a.GetKeyframeData().GetKeyframeDataItemArray().at(-1)}GetKeyFrameDataItemAtTime(a,
b){b=b.GetKeyframeData().GetKeyframeDataItemArray();const d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetTime()===a)return e}}GetFirstKeyFrameDataItemHigherThan(a,b){b=b.GetKeyframeData().GetKeyframeDataItemArray();const d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetTime()>a)return e}}GetFirstKeyFrameDataItemHigherOrEqualThan(a,b){b=b.GetKeyframeData().GetKeyframeDataItemArray();const d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetTime()>=a)return e}}GetFirstKeyFrameDataItemLowerOrEqualThan(a,
b){b=b.GetKeyframeData().GetKeyframeDataItemArray();for(let d=b.length-1;0<=d;d--){const c=b[d];if(c.GetTime()<=a)return c}}*trackDataItems(){for(const a of this._trackDataItems)yield a}_SaveToJson(){return{trackDataItemsJson:this._trackDataItems.map(a=>a._SaveToJson())}}_LoadFromJson(a){a&&C3$jscomp$131.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,a.trackDataItemsJson,TrackDataItem,this)}};"use strict";const C3$jscomp$132=self.C3;
class PropertyTrackDataItem{constructor(a,b){this._propertyTrackData=b;this._sourceAdapterId="";this._type=this._property=this._sourceAdapterArguments=null;this._max=this._min=NaN;this._resultMode=this._interpolationMode="default";this._enabled=!1;this._propertyKeyframeData=null;this._canHavePropertyKeyframes=!0;a&&(this._sourceAdapterId=a[0][0],this._sourceAdapterArguments=a[0].slice(1),this._property=a[1],this._type=a[2],this._min=a[3],this._max=a[4],this._interpolationMode=a[5],this._resultMode=
a[6],this._enabled=!!a[7],this._propertyKeyframeData=new C3$jscomp$132.PropertyKeyframeData(a[8],this),this._canHavePropertyKeyframes=a[9])}Release(){this._propertyKeyframeData.Release();this._sourceAdapterArguments=this._propertyTrackData=this._propertyKeyframeData=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){this._propertyKeyframeData||(this._propertyKeyframeData=new C3$jscomp$132.PropertyKeyframeData(null,this));return this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(a){this._sourceAdapterId=
a}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(a){this._sourceAdapterArguments=a}GetProperty(){return this._property}SetProperty(a){this._property=a}GetType(){return this._type}SetType(a){this._type=a}GetMin(){return this._min}SetMin(a){this._min=a}GetMax(){return this._max}SetMax(a){this._max=a}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(a){this._interpolationMode=a}GetResultMode(){return this._resultMode}SetResultMode(a){this._resultMode=
a}GetEnable(){return this._enabled}SetEnable(a){this._enabled=!!a}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{propertyKeyframeDataJson:this._propertyKeyframeData._SaveToJson(),sourceAdapterId:this._sourceAdapterId,sourceAdapterArguments:this._sourceAdapterArguments,property:this._property,type:this._type,min:this._min,max:this._max,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,canHavePropertyKeyframes:this._canHavePropertyKeyframes}}_LoadFromJson(a){a&&
(this._sourceAdapterId=a.sourceAdapterId,this._sourceAdapterArguments=a.sourceAdapterArguments,this._property=a.property,this._type=a.type,this._min=a.min,this._max=a.max,this._interpolationMode=a.interpolationMode,this._resultMode=a.resultMode,this._enabled=a.enabled,this._canHavePropertyKeyframes=a.canHavePropertyKeyframes,this.GetPropertyKeyframeData()._LoadFromJson(a.propertyKeyframeDataJson))}}
C3$jscomp$132.PropertyTrackData=class{constructor(a,b){this._trackDataItem=b;this._propertyTrackDataItems=[];C3$jscomp$132.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,a,PropertyTrackDataItem,this)}Release(){this._trackDataItem=null;for(const a of this._propertyTrackDataItems)a.Release();C3$jscomp$132.clearArray(this._propertyTrackDataItems);this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){const a=new PropertyTrackDataItem(null,
this);this._propertyTrackDataItems.push(a);return a}GetFirstPropertyKeyframeDataItem(a){return a.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(a){return a.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray().at(-1)}GetPropertyKeyFrameDataItemAtTime(a,b){b=b.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();const d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetTime()===a)return e}}GetFirstPropertyKeyFrameDataItemHigherThan(a,
b){b=b.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();const d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetTime()>a)return e}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(a,b){b=b.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();const d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetTime()>=a)return e}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,b){b=b.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();for(let d=b.length-1;0<=d;d--){const c=
b[d];if(c.GetTime()<=a)return c}}*propertyTrackDataItems(){for(const a of this._propertyTrackDataItems)yield a}_SaveToJson(){return{propertyTrackDataItemsJson:this._propertyTrackDataItems.map(a=>a._SaveToJson())}}_LoadFromJson(a){a&&C3$jscomp$132.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,a.propertyTrackDataItemsJson,PropertyTrackDataItem,this)}};"use strict";const C3$jscomp$133=self.C3;
class KeyframeDataItem{constructor(a,b){this._keyframeData=b;this._time=-1;this._ease="noease";this._enable=!1;this._lowerTags=this._tags=null;a&&(this._time=a[0],this._ease=a[1],this._enable=!!a[2],this._tags=(a=a[3])?a.split(" "):[],this._lowerTags=new Set(this._tags.map(d=>d.toLowerCase())),this._next=null)}Release(){this._keyframeData=null;C3$jscomp$133.clearArray(this._tags);this._tags=null;this._lowerTags.clear();this._next=this._lowerTags=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(a){this._next=
a}GetTime(){return this._time}SetTime(a){this._time=a;this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(a){this._ease=a}GetEnable(){return this._enable}SetEnable(a){this._enable=!!a}GetTags(){return this._tags}SetTags(a){this._tags=a?a.split(" "):[];this._lowerTags=new Set(this._tags.map(b=>b.toLowerCase()))}GetLowerTags(){return this._lowerTags}HasTag(a){return this._lowerTags.has(a.toLowerCase())}_SaveToJson(){return{time:this._time,ease:this._ease,enable:this._enable,
tags:this._tags}}_LoadFromJson(a){a&&(this._time=a.time,this._ease=a.ease,this._enable=a.enable,this._tags=a.tags,this._lowerTags=new Set(this._tags.map(b=>b.toLowerCase())))}}
C3$jscomp$133.KeyframeData=class{constructor(a,b){this._trackDataItem=b;this._keyframeDataItems=[];C3$jscomp$133.TimelineDataManager._CreateDataItems(this._keyframeDataItems,a,KeyframeDataItem,this);this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(const a of this._keyframeDataItems)a.Release();C3$jscomp$133.clearArray(this._keyframeDataItems);this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort((a,b)=>a.GetTime()-b.GetTime());for(let a=0;a<this._keyframeDataItems.length;a++)this._keyframeDataItems[a].SetNext(this._keyframeDataItems[a+
1])}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){const a=new KeyframeDataItem(null,this);this._keyframeDataItems.push(a);this._LinkKeyframeDataItems();return a}DeleteKeyframeDataItems(a){for(const b of this._keyframeDataItems){if(!a(b))continue;const d=this._keyframeDataItems.indexOf(b);-1!==d&&(b.Release(),this._keyframeDataItems.splice(d,1))}this.SortKeyframeDataItems();
this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort((a,b)=>a.GetTime()-b.GetTime())}GetKeyframeDataItemIndex(a){return this._keyframeDataItems.indexOf(a)}GetKeyframeDataItemFromIndex(a){return this._keyframeDataItems[a]}*keyframeDataItems(){for(const a of this._keyframeDataItems)yield a}*keyframeDataItemsReverse(){for(let a=this._keyframeDataItems.length-1;0<=a;a--)yield this._keyframeDataItems[a]}_SaveToJson(){return{keyframeDataItemsJson:this._keyframeDataItems.map(a=>
a._SaveToJson())}}_LoadFromJson(a){a&&(C3$jscomp$133.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,a.keyframeDataItemsJson,KeyframeDataItem,this),this._LinkKeyframeDataItems())}};"use strict";const C3$jscomp$134=self.C3;
class PropertyKeyframeDataItem{constructor(a,b){this._propertyKeyframeData=b;this._aValue=this._value=null;this._type="";this._time=NaN;this._ease="noease";this._enable=!1;this._addonData=null;this._addonInstance=void 0;this._pathMode="line";a&&(this._value=a[0][0],this._aValue=a[0][1],this._type=a[0][2],this._time=a[1],this._ease=a[2],this._enable=!!a[3],this._pathMode=a[5],this._addonData=null,a[4]&&(this._addonData=new C3$jscomp$134.AddonData(a[4],this)),this._prev=this._next=null)}Release(){this._propertyKeyframeData=
null;this._addonData&&(this._addonData.Release(),this._addonData=null);this._prev=this._next=null}GetAddonData(){return this._addonData}SetNext(a){this._next=a}GetNext(){return this._next}SetPrevious(a){this._prev=a}GetPrevious(){return this._prev}GetValue(){return this._value}SetValue(a){"color"===this._type&&C3$jscomp$134.IsFiniteNumber(a)?(this._value[0]=C3$jscomp$134.GetRValue(a),this._value[1]=C3$jscomp$134.GetGValue(a),this._value[2]=C3$jscomp$134.GetBValue(a)):this._value=a}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(a){"color"===
this._type&&C3$jscomp$134.IsFiniteNumber(a)?(this._aValue[0]=C3$jscomp$134.GetRValue(a),this._aValue[1]=C3$jscomp$134.GetGValue(a),this._aValue[2]=C3$jscomp$134.GetBValue(a)):this._aValue=a}GetValueWithResultMode(){const a=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();if("relative"===a)return this.GetValue();if("absolute"===a)return this.GetAbsoluteValue()}GetType(){return this._type}SetType(a){this._type=a}GetTime(){return this._time}SetTime(a){this._time=a;this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(a){this._ease=
a}GetEnable(){return this._enable}SetEnable(a){this._enable=!!a}GetPathMode(){return this._pathMode}GetAddOn(a){if(this._addonData){if(this._addonInstance||null===this._addonInstance)return this._addonInstance;var b=this._addonData.GetAddDataItemArray();if(!b)return this._addonInstance=null;var d=b.length;for(let c=0;c<d;c++){const e=b[c];if(e.GetId()===a)return this._addonInstance=e}return this._addonInstance=null}}_SaveToJson(){const a=this._addonData;return{addonDataJson:a?a._SaveToJson():a,value:this._value,
aValue:this._aValue,type:this._type,time:this._time,ease:this._ease,enable:this._enable}}_LoadFromJson(a){a&&(a.addonDataJson&&this._addonData._SetFromJson(a.addonDataJson),this._value=a.value,this._aValue=a.aValue,this._type=a.type,this._time=a.time,this._ease=a.ease,this._enable=a.enable)}}
C3$jscomp$134.PropertyKeyframeData=class{constructor(a,b){this._propertyTrackDataItem=b;this._propertyKeyframeDataItems=[];this._propertyKeyframeDataItemsIncludingDisabled=[];C3$jscomp$134.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,a,PropertyKeyframeDataItem,this);C3$jscomp$134.TimelineDataManager._CreateDataItemsIncludingDisabled(this._propertyKeyframeDataItemsIncludingDisabled,a,PropertyKeyframeDataItem,this);this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=
null;for(const a of this._propertyKeyframeDataItems)a.Release();C3$jscomp$134.clearArray(this._propertyKeyframeDataItems);this._propertyKeyframeDataItems=null;for(const a of this._propertyKeyframeDataItemsIncludingDisabled)a.Release();C3$jscomp$134.clearArray(this._propertyKeyframeDataItemsIncludingDisabled);this._propertyKeyframeDataItemsIncludingDisabled=null}_LinkPropertyKeyframeDataItems(){let a=this._propertyKeyframeDataItems;a.sort((c,e)=>c.GetTime()-e.GetTime());for(var b=0;b<a.length;b++){var d=
a[b];b+1<a.length&&d.SetNext(a[b+1]);0<=b-1&&d.SetPrevious(a[b-1])}a=this._propertyKeyframeDataItemsIncludingDisabled;a.sort((c,e)=>c.GetTime()-e.GetTime());for(b=0;b<a.length;b++)d=a[b],b+1<a.length&&d.SetNext(a[b+1]),0<=b-1&&d.SetPrevious(a[b-1])}AddEmptyPropertyKeyframeDataItem(){const a=new PropertyKeyframeDataItem(null,this);this._propertyKeyframeDataItems.push(a);this._LinkPropertyKeyframeDataItems();return a}DeletePropertyKeyframeDataItems(a){for(const b of this._propertyKeyframeDataItems){if(!a(b))continue;
const d=this._propertyKeyframeDataItems.indexOf(b);-1!==d&&(b.Release(),this._propertyKeyframeDataItems.splice(d,1))}this.SortPropertyKeyFrameDataItems();this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort((a,b)=>a.GetTime()-b.GetTime())}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-
1]}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyKeyframeDataItemsIncludingDisabled}*propertyKeyframeDataItems(){for(const a of this._propertyKeyframeDataItems)yield a}*propertyKeyframeDataItemsReverse(){for(let a=this._propertyKeyframeDataItems.length-1;0<=a;a--)yield this._propertyKeyframeDataItems[a]}_SaveToJson(){const a=this._propertyKeyframeDataItemsIncludingDisabled;return{propertyKeyframeDataItemsJson:this._propertyKeyframeDataItems.map(b=>
b._SaveToJson()),propertyKeyframeDataItemsIncludingDisabledJson:a.map(b=>b._SaveToJson())}}_LoadFromJson(a){a&&(C3$jscomp$134.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,a.propertyKeyframeDataItemsJson,PropertyKeyframeDataItem,this),C3$jscomp$134.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItemsIncludingDisabled,a.propertyKeyframeDataItemsIncludingDisabledJson,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems())}};"use strict";
const C3$jscomp$135=self.C3;class AddonDataItem{constructor(a,b){this._addonData=b;this._id=a[0];this._data=a[1]}Release(){this._data=this._addonData=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{id:this._id,data:this._data}}_LoadFromJson(a){a&&(this._id=a.id,this._data=a.data)}}
class AddonDataCubicBezierItem extends AddonDataItem{constructor(a,b){super(a,b);this._startAnchor=this._data[0];this._startEnable=!!this._data[1];this._endAnchor=this._data[2];this._endEnable=!!this._data[3]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{startAnchor:this._startAnchor,startEnable:!!this._startEnable,
endAnchor:this._endAnchor,endEnable:!!this._endEnable})}_LoadFromJson(a){a&&(super._LoadFromJson(a),this._startAnchor=a.startAnchor,this._startEnable=!!a.startEnable,this._endAnchor=a.endAnchor,this._endEnable=!!a.endEnable)}}
class AddonDataAngleItem extends AddonDataItem{constructor(a,b){super(a,b);this._direction=this._data[0];this._revolutions=this._data[1]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{direction:this._direction,revolutions:this._revolutions})}_LoadFromJson(a){a&&(super._LoadFromJson(a),this._direction=a.direction,this._revolutions=a.revolutions)}}
C3$jscomp$135.AddonData=class{constructor(a,b){this._propertyKeyframeDataItem=b;this._addonDataItems=[];C3$jscomp$135.TimelineDataManager._CreateDataItems(this._addonDataItems,a,{prop:0,map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}Release(){this._propertyKeyframeDataItem=null;for(const a of this._addonDataItems)a.Release();C3$jscomp$135.clearArray(this._addonDataItems);this._addonDataItems=null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(const a of this._addonDataItems)yield a}_SaveToJson(){return{addonDataItemsJson:this._addonDataItems.map(a=>
a._SaveToJson())}}_LoadFromJson(a){a&&C3$jscomp$135.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,a.addonDataItemsJson,{prop:"id",map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}};"use strict";const C3$jscomp$136=self.C3;let createdTweens=0;
C3$jscomp$136.TweenState=class extends C3$jscomp$136.TimelineState{constructor(a,b){super(`tween-${createdTweens++}`,a,b);this._id="";this._destroyInstanceOnComplete=!1;this._initialValueMode="start-value";this._iTweenState=this._track=this._on_started_callbacks=this._on_completed_callbacks=this._instance=null}FireReleaseEvent(a){const b=C3$jscomp$136.New(C3$jscomp$136.Event,"tweenstatereleased");b.tweenState=this;a.dispatchEvent(b)}GetType(){return 1}CreateTrackStates(){for(const a of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(C3$jscomp$136.TweenTrackState.Create(this,
a));this._track=this._tracks[0]}AddTrack(){var a=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();a=C3$jscomp$136.TweenTrackState.Create(this,a);this._tracks.push(a);this._CacheTrack();return a}_CacheTrack(){this._track=this._tracks[0]}GetPropertyTrack(a){return this._track.GetPropertyTracks()[0]}SetPropertyType(a){this._propertyType=a}GetInstance(){var a=this.GetTracks();if(a&&a.length&&(this._track=a=a[0])){var b=a.GetInstance();return a.IsInstanceValid()?b:void 0}}AddStartedCallback(a){this._on_started_callbacks||
(this._on_started_callbacks=[]);this._on_started_callbacks.push(a)}AddCompletedCallback(a){this._on_completed_callbacks||(this._on_completed_callbacks=[]);this._on_completed_callbacks.push(a)}RemoveStartedCallback(a){this._on_started_callbacks&&(a=this._on_started_callbacks.indexOf(a),-1!==a&&this._on_started_callbacks.splice(a,1))}RemoveCompletedCallback(a){this._on_completed_callbacks&&(a=this._on_completed_callbacks.indexOf(a),-1!==a&&this._on_completed_callbacks.splice(a,1))}SetStartValue(a,b){for(const c of this._tracks)for(const e of c._propertyTracks){if(e.GetPropertyName()!==
b)continue;var d=e.GetPropertyTrackData();const g=e.GetPropertyTrackDataItem();d=d.GetFirstPropertyKeyframeDataItem(g);d.SetValue(a);d.SetAbsoluteValue(a)}}_GetPropertyTrackState(a){for(const b of this._tracks)for(const d of b._propertyTracks)if(d.GetPropertyName()===a)return d}BeforeSetEndValues(a){for(const c of a)a=this._GetPropertyTrackState(c),this.SetStartValue(a.GetCurrentState(),c);if(this.IsForwardPlayBack()){var b=this.GetTotalTime()-this.GetTime();this.SetTotalTime(b);for(var d of this._tracks)d.SetLocalTotalTime(b);
this._SetTime(0)}else{d=this.GetTime();this.SetTotalTime(d);for(b of this._tracks)b.SetLocalTotalTime(d);this._SetTime(d)}this.SetInitialStateFromSetTime()}SetEndValue(a,b){var d=this._GetPropertyTrackState(b);b=d.GetPropertyTrackData();d=d.GetPropertyTrackDataItem();b=b.GetLastPropertyKeyframeDataItem(d);b.SetTime(this.GetTotalTime());b.SetValue(a);b.SetAbsoluteValue(a)}SetId(a){this._id=a}GetId(){return this._id}SetInitialValueMode(a){this._initialValueMode=a}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(a){this._destroyInstanceOnComplete=
a}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(const a of this._on_started_callbacks)a(this);if(!this.IsComplete())for(const a of this._tracks)a.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(!this._finishedTriggers&&(this._finishedTriggers=!0,this._on_completed_callbacks))for(const a of this._on_completed_callbacks)a(this)}SetTime(a){this._DeleteIntermediateKeyframes();
super.SetTime(a)}_SetTimeAndReset(a){C3$jscomp$136.IsFiniteNumber(a)||(a=this.GetTotalTime());0>a?this._playheadTime=0:a>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=a;this._track.SetResetState()}SetInitialState(a){if(!this.InitialStateSet()&&"current-state"===this.GetInitialValueMode())for(const b of this._tracks)b.CompareInitialStateWithCurrent();super.SetInitialState(a)}Stop(a=!1){super.Stop(a);if(!this.IsComplete())for(const b of this._tracks)b.SaveState()}Reset(a=
!0,b=!1){this._DeleteIntermediateKeyframes();super.Reset(a,b)}_DeleteIntermediateKeyframes(){for(const a of this._tracks){const b=d=>{d=d.GetTime();const c=this.GetTotalTime();return 0!==d&&d!==c};a.DeleteKeyframes(b);a.DeletePropertyKeyframes(b)}}_OnBeforeChangeLayout(){if(this.IsReleased())return!0;const a=this.GetInstance();if(a&&a.GetObjectClass().IsGlobal())return!1;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this);this.ResetBeforeChangeLayout();return!0}Tick(a,b,d){this._instance||
(this._instance=this.GetInstance());if(!this._instance||this._instance.IsDestroyed())this.Stop(!0),this.OnCompleted();else if(b=this._instance.GetTimeScale(),-1!==b&&(a=d*b),0!==a||0!==this._lastDelta){this._lastDelta=a;d=this._playheadTime+this._overshoot+a*this._playbackRate;a=this._timelineDataItem._totalTime;0>d?(this._playheadTime=0,this._overshoot=-d):d>=a?(this._playheadTime=a,this._overshoot=this._playheadTime-d):(this._playheadTime=d,this._overshoot=0);b=d=!1;var c=this.GetLoop(),e=this.GetPingPong();
c||e?c&&!e?0<this._playbackRate?this._playheadTime>=a&&(this._SetTimeAndReset(0),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),b=!0):0>=this._playheadTime&&(this._SetTimeAndReset(a),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),b=!0):!c&&e?0<this._playbackRate?this._playheadTime>=a&&(this._SetTime(a),this.SetPlaybackRate(-1*
this.GetPlaybackRate()),b=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=0):(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),
this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong),d=!0):0===this._pingPongState&&(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=1)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),
this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=0):(d=!0,this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong)):0===this._pingPongState&&(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong),
this._pingPongState=1)):c&&e&&(0<this._playbackRate?this._playheadTime>=a&&(this._SetTime(a),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,0===this._pingPongState&&(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong)),1===this._pingPongState&&(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),
this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState++,this._pingPongState=C3$jscomp$136.wrap(this._pingPongState,0,2)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),b=!0,0===this._pingPongState&&(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong)),1===this._pingPongState&&(this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),
this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState++,this._pingPongState=C3$jscomp$136.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=a&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),
this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),b=!0):(this._SetTime(a),d=!0)):0>=this._playheadTime&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(a),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C3$jscomp$136.Behaviors.Tween.Cnds.OnTweensLoop),b=!0):(this._SetTime(0),d=!0));d?(this._track.SetEndState(),this.Stop(!0),this.OnCompleted()):(this._track.Interpolate(this._playheadTime,!0,
!1,b,this._firstTick,!1),this._firstTick&&(this._firstTick=!1))}}_TweenTrigger(a){const b=this.GetInstance(),d=b.GetBehaviorSdkInstanceFromCtor(C3$jscomp$136.Behaviors.Tween);d.PushTriggerTween(this);this._runtime.Trigger(a,b,d.GetBehaviorType());d.PopTriggerTween()}_SaveToJson(){const a=super._SaveToJson(),b=this.GetTimelineDataItem();return Object.assign(a,{tweenDataItemJson:b._SaveToJson(),id:this._id,destroyInstanceOnComplete:this._destroyInstanceOnComplete,initialValueMode:this._initialValueMode})}_LoadFromJson(a){a&&
(this.GetTimelineDataItem()._LoadFromJson(a.tweenDataItemJson),super._LoadFromJson(a),this._id=a.id,this._destroyInstanceOnComplete=a.destroyInstanceOnComplete,this._initialValueMode=a.initialValueMode,this._CacheTrack())}static IsPlaying(a){return a.IsPlaying()}static IsPaused(a){return a.IsPaused()}static IsPing(a){return a.GetPingPong()?0===a.GetPingPongState():!1}static IsPong(a){return a.GetPingPong()?1===a.GetPingPongState():!1}static Build(a){var b=a.runtime.GetTimelineManager(),d=new C3$jscomp$136.TimelineDataItem;
if(a.json){d._LoadFromJson(a.json.tweenDataItemJson);var c=new C3$jscomp$136.TweenState(d,b);c._LoadFromJson(a.json);return c}b=new C3$jscomp$136.TweenState(d,b);C3$jscomp$136.IsArray(a.propertyTracksConfig)||(a.propertyTracksConfig=[a.propertyTracksConfig]);b.SetId(a.id);b.SetTags(a.tags);b.SetInitialValueMode(a.initialValueMode);b.SetDestroyInstanceOnComplete(a.releaseOnComplete);b.SetLoop(a.loop);b.SetPingPong(a.pingPong);b.SetTotalTime(a.time);b.SetStep(0);b.SetInterpolationMode("default");b.SetResultMode(a.propertyTracksConfig[0].resultMode);
b.SetRepeatCount(a.repeatCount);d=b.AddTrack();d.SetInstanceUID(a.instance.GetUID());d.SetInterpolationMode("default");d.SetResultMode(a.propertyTracksConfig[0].resultMode);d.SetEnable(!0);d.SetObjectClassIndex(a.instance.GetObjectClass().GetIndex());var e=a.instance.GetSdkInstance(),g=e.IsOriginalSizeKnown()?e.GetOriginalWidth():a.instance.GetWorldInfo().GetWidth();e=e.IsOriginalSizeKnown()?e.GetOriginalHeight():a.instance.GetWorldInfo().GetHeight();d.SetOriginalWidth(g);d.SetOriginalHeight(e);g=
d.AddKeyframe();g.SetTime(0);g.SetEase("noease");g.SetEnable(!0);g.SetTags("");g=d.AddKeyframe();g.SetTime(a.time);g.SetEase("noease");g.SetEnable(!0);g.SetTags("");for(c of a.propertyTracksConfig)g=d.AddPropertyTrack(),g.SetSourceAdapterId(c.sourceId),g.SetSourceAdapterArgs(c.sourceArgs),g.SetPropertyName(c.property),g.SetPropertyType(c.type),g.SetMin(NaN),g.SetMax(NaN),g.SetInterpolationMode("default"),g.SetResultMode(c.resultMode),g.SetEnable(!0),e=g.AddPropertyKeyframe(),e.SetType(c.valueType),
e.SetTime(0),e.SetEase(c.ease),e.SetEnable(!0),e.SetValue(c.startValue),e.SetAbsoluteValue(c.startValue),e=g.AddPropertyKeyframe(),e.SetType(c.valueType),e.SetTime(a.time),e.SetEase(c.ease),e.SetEnable(!0),e.SetValue(c.endValue),e.SetAbsoluteValue(c.endValue),g.GetSourceAdapter();return b}static SetInstanceUID(a,b){if(!isNaN(b))for(const d of a.GetTracks())d.SetInstanceUID(b)}GetITweenState(a,b){this._iTweenState||(this._iTweenState=C3$jscomp$136.New(self.ITweenState,this,a,b));return this._iTweenState}};
"use strict";const C3$jscomp$137=self.C3;
C3$jscomp$137.TweenTrackState=class extends C3$jscomp$137.TrackState{constructor(a,b){super(a,b);this._secondPropertyTrack=this._firstPropertyTrack=null}static Create(a,b){return C3$jscomp$137.New(C3$jscomp$137.TweenTrackState,a,b)}_CachePropertyTracks(){1===this._propertyTracks.length?this._firstPropertyTrack=this._propertyTracks[0]:(this._firstPropertyTrack=this._propertyTracks[0],this._secondPropertyTrack=this._propertyTracks[1])}CreatePropertyTrackStates(){for(const a of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C3$jscomp$137.TweenPropertyTrackState.Create(this,a));
this._CachePropertyTracks()}AddPropertyTrack(){var a=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem();a=C3$jscomp$137.TweenPropertyTrackState.Create(this,a);this._propertyTracks.push(a);this._CachePropertyTracks();return a}SetInitialState(){this.MaybeGetInstance();if(this.IsInstanceValid()||!this.IsInstanceTrack()){var a=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const b of this._propertyTracks)b.SetInitialState(a),0===this._worldInfoChange&&1===
b.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===b.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;this._propertyTracks.some(b=>b.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1);this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(a);this._endStateOfNestedSet=this._initialStateOfNestedSet=!1;this.Interpolate(a)}}BeforeInterpolate(){}Interpolate(a,b,d=!1,c=!1,e,g=!1,k=!1){this._instance||this.GetInstance();if(this._instance){if(this._instance.IsDestroyed()||
g&&this.GetObjectClass().IsGlobal())return!1;this._secondPropertyTrack?(this._firstPropertyTrack.Interpolate(a,d,c,k),this._secondPropertyTrack.Interpolate(a,d,c,k)):this._firstPropertyTrack.Interpolate(a,d,c,k);0!==this._firstPropertyTrack.GetWorldInfoChange()&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){}_LoadFromJson(a){super._LoadFromJson(a);this._CachePropertyTracks()}};"use strict";
const C3$jscomp$138=self.C3;
C3$jscomp$138.TweenPropertyTrackState=class extends C3$jscomp$138.PropertyTrackState{constructor(a,b){super(a,b);this._basic=!1}static Create(a,b){return C3$jscomp$138.New(C3$jscomp$138.TweenPropertyTrackState,a,b)}Interpolate(a,b=!1,d=!1,c=!1){if(this._basic){var e=this._propertyKeyframeDataItems[0];var g=this._propertyKeyframeDataItems[1]}else{if(b)e=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){g=this.GetTimeline();
const k=this._lastPropertyKeyframeDataItem.GetNext();e=this._lastPropertyKeyframeDataItem.GetTime();g=k?k.GetTime():g.GetTotalTime();if(a<=e||a>=g)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem)}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(a,this._propertyTrackDataItem);e=this._lastPropertyKeyframeDataItem}g=e.GetNext()}this._sourceAdapter.Interpolate(a,
e,g,b,d,c)}AddPropertyKeyframe(){const a=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();this._lastPropertyKeyframeDataItem=null;this._basic=2>=this.GetPropertyKeyframeDataItems().length;return a}DeletePropertyKeyframes(a){this._lastPropertyKeyframeDataItem=null;this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(a);this._basic=2>=this.GetPropertyKeyframeDataItems().length}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson(),
basic:this._basic}}_LoadFromJson(a){a&&(this.GetSourceAdapter()._LoadFromJson(a.sourceAdapterJson),this._basic=a.basic)}};"use strict";const C3$jscomp$139=self.C3,Ease$jscomp$2=self.Ease;
C3$jscomp$139.Transition=class extends C3$jscomp$139.DefendedBase{constructor(a,b=!0){super();this._name=a[0];this._linear=a[2];this._transitionKeyframes=[];for(var d of a[1])a=C3$jscomp$139.TransitionKeyframe.Create(this,d),this._transitionKeyframes.push(a);for(d=0;d<this._transitionKeyframes.length;d++){a=this._transitionKeyframes[d];const c=this._transitionKeyframes[d-1];a.SetNext(this._transitionKeyframes[d+1]);a.SetPrevious(c)}this._precalculatedSamples=new Map;this._transitionKeyframeCache=
new Map;this._PreCalcSamples();b&&Ease$jscomp$2.AddCustomEase(this._name,(c,e,g,k)=>this.Interpolate(c,e,g,k),null,{transition:this})}static Create(a){return C3$jscomp$139.New(C3$jscomp$139.Transition,a)}Release(){for(const a of this._transitionKeyframes)a.Release();C3$jscomp$139.clearArray(this._transitionKeyframes);this._transitionKeyframes=null;this._precalculatedSamples.clear();this._precalculatedSamples=null;this._transitionKeyframeCache.clear();this._transitionKeyframeCache=null}MakeLinear(a){this._linear=
!!a}GetTransitionKeyFrameAt(a){const b=this._transitionKeyframeCache.get(a);if(b)return b;for(const d of this._transitionKeyframes)if(d.GetValueX()===a)return this._transitionKeyframeCache.set(a,d),d}GetFirstTransitionKeyFrameLowerOrEqualThan(a){for(let d=this._transitionKeyframes.length-1;0<=d;d--){var b=this._transitionKeyframes[d];const c=b.GetValueX();if(c<=a){if(c<a)return b;if(c===a){for(;b;){a=b.GetPrevious();if(!a)break;if(a.GetValueX()!==b.GetValueX())break;b=a}return b}}}}Interpolate(a,
b,d,c){var e=a/c;if(this._linear){var g=this.GetTransitionKeyFrameAt(0);e=this.GetTransitionKeyFrameAt(1);g=b+(b+d)*g.GetValueY();b=(b+d)*e.GetValueY()-g;return 0===c?g+b:Ease$jscomp$2.NoEase(a,g,b,c)}0===c&&(e=1);a=this.GetFirstTransitionKeyFrameLowerOrEqualThan(e);c=a.GetNext();c||(c=a.GetPrevious(),g=a,a=c,c=g);g=c.GetValueX()-a.GetValueX();e=C3$jscomp$139.mapToRange(e,a.GetValueX(),c.GetValueX(),0,g);if(a.IsSegmentLinear()||0===g)return a=b+(b+d)*a.GetValueY(),b=(b+d)*c.GetValueY()-a,0===g?1===
e?a+b:a:Ease$jscomp$2.NoEase(e,a,b,g);g=a.GetValueX();const k=a.GetValueY(),l=a.GetValueX()+a.GetStartAnchorX(),n=a.GetValueY()+a.GetStartAnchorY(),p=c.GetValueX()+c.GetEndAnchorX(),r=c.GetValueY()+c.GetEndAnchorY(),w=c.GetValueX();c=c.GetValueY();e=Ease$jscomp$2.GetRuntimeEase("spline")(e,g,k,l,n,p,r,w,c,this._precalculatedSamples.get(a));e+=a.GetValueY();return(1-e)*b+e*(b+d)}_PreCalcSamples(){this._precalculatedSamples.clear();for(let d=0;d<this._transitionKeyframes.length-1;d++){var a=this._transitionKeyframes[d];
if(!a.GetStartEnable())continue;var b=this._transitionKeyframes[d+1];if(!b.GetEndEnable())continue;const c=a.GetValueX(),e=a.GetValueX()+a.GetStartAnchorX(),g=b.GetValueX()+b.GetEndAnchorX();b=b.GetValueX();this._precalculatedSamples.set(a,Ease$jscomp$2.GetBezierSamples(c,e,g,b))}}};"use strict";const C3$jscomp$140=self.C3;
C3$jscomp$140.TransitionKeyframe=class extends C3$jscomp$140.DefendedBase{constructor(a,b){super();this._transition=a;this._valueX=b[0];this._valueY=b[1];this._startAnchorX=b[2];this._startAnchorY=b[3];this._endAnchorX=b[4];this._endAnchorY=b[5];this._startEnable=b[6];this._endEnable=b[7];this._segmentMode=b[8];this._prev=this._next=null}Release(){this._transition=null}static Create(a,b){return C3$jscomp$140.New(C3$jscomp$140.TransitionKeyframe,a,b)}SetNext(a){this._next=a}GetNext(){return this._next}SetPrevious(a){this._prev=
a}GetPrevious(){return this._prev}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}IsSegmentLinear(){return"linear"===this._segmentMode}IsSegmentCubic(){return"cubic"===this._segmentMode}};"use strict";const C3$jscomp$141=self.C3;
C3$jscomp$141.TransitionManager=class extends C3$jscomp$141.DefendedBase{constructor(a){super();this._runtime=a;this._transitions=[]}Release(){for(const a of this._transitions)a.Release();C3$jscomp$141.clearArray(this._transitions);this._transitions=null}Create(a){this._transitions.push(C3$jscomp$141.Transition.Create(a))}};"use strict";const C3$jscomp$142=self.C3;
C3$jscomp$142.TemplateManager=class extends C3$jscomp$142.DefendedBase{constructor(a){super();this._runtime=a;this._instanceToTemplateNameMap=this._templateDataMap=null;this._instanceDestroy=b=>this._OnInstanceDestroy(b.instance)}Release(){this.RemoveRuntimeListeners();if(this._templateDataMap){for(const a of this._templateDataMap.values())a.clear();this._templateDataMap.clear()}this._runtime=this._templateDataMap=null}Create(a){this._templateDataMap||(this._templateDataMap=new Map);if(a){var b=a[0][16][0],
d=a[1];this._templateDataMap.has(d)||this._templateDataMap.set(d,new Map);this._templateDataMap.get(d).set(b,a)}}AddRuntimeListeners(){const a=this._runtime.Dispatcher();a&&a.addEventListener("instancedestroy",this._instanceDestroy)}RemoveRuntimeListeners(){const a=this._runtime.Dispatcher();a&&a.removeEventListener("instancedestroy",this._instanceDestroy)}HasTemplates(){return this._templateDataMap?0!==this._templateDataMap.size:!1}GetTemplateData(a,b){a=a instanceof C3$jscomp$142.ObjectClass?a.GetIndex():
a;if(this._templateDataMap.has(a)&&(b=this._templateDataMap.get(a).get(b)))return JSON.parse(JSON.stringify(b))}MapInstanceToTemplateName(a,b){this._instanceToTemplateNameMap||(this._instanceToTemplateNameMap=new WeakMap);this._instanceToTemplateNameMap.has(a)||this._instanceToTemplateNameMap.set(a,b)}GetInstanceTemplateName(a){return this._instanceToTemplateNameMap?(a=this._instanceToTemplateNameMap.get(a))?a:"":""}_OnInstanceDestroy(a){this._instanceToTemplateNameMap&&this._instanceToTemplateNameMap.has(a)&&
this._instanceToTemplateNameMap.delete(a)}};"use strict";const C3$jscomp$143=self.C3;C3$jscomp$143.FlowchartManager=class{constructor(a){this._runtime=a;this._flowchartDataManager=new C3$jscomp$143.FlowchartDataManager}Release(){this._flowchartDataManager.Release();this._runtime=this._flowchartDataManager=null}GetRuntime(){return this._runtime}Create(a){this._flowchartDataManager.Add(a)}GetFlowchartDataItemByName(a){return this._flowchartDataManager.Get(a)}HasFlowcharts(){return this._flowchartDataManager.HasFlowcharts()}};
"use strict";const C3$jscomp$144=self.C3;
C3$jscomp$144.FlowchartState=class{constructor(a,b,d,c,e,g,k){this._runtime=e.GetRuntime();this._flowchartManager=e;this._flowchartName=a;this._startNodeTag=d;this._flowchartDataItem=c;this._tag=b;this._pluginInstance=g;this._pluginUID=k?k:g.GetInstance().GetUID();this._SetStartFlowchartNode();this._currentFlowchartNodeId=this._startFlowchartNode.GetFlowchartId();this._previousFlowchartNodeIds=[];this._previousFlowchartState=null;this._previousFlowchartStateStartNodeId=NaN;this._rootFlowchartState=
this._currentReferenceFlowchartState=this._referenceFlowchartStates=null;this._previousFlowchartStateTag="";this._referenceFlowchartStatesJson=null;this._rootFlowchartStateTag=this._currentReferenceFlowchartStateTag="";this._triggerCount=0;this._released=this._markForRelease=!1}Release(){this._released||(C3$jscomp$144.clearArray(this._previousFlowchartNodeIds),this._previousFlowchartState=this._pluginInstance=this._flowchartDataItem=this._flowchartManager=this._runtime=this._previousFlowchartNodeIds=
null,this._previousFlowchartStateStartNodeId=NaN,this._referenceFlowchartStates&&this._referenceFlowchartStates.clear(),this._rootFlowchartState=this._currentReferenceFlowchartState=this._referenceFlowchartStates=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._rootFlowchartStateTag=this._currentReferenceFlowchartStateTag="",this._released=!0)}WasReleased(){return this._released}GetFlowchartManager(){return this._flowchartManager}GetRuntime(){return this._runtime}GetName(){return this._flowchartName}GetFlowchartDataItem(){return this._flowchartDataItem}GetTag(){return this._tag}GetPluginInstance(){this._pluginInstance||
(this._pluginInstance=this._runtime.GetInstanceByUID(this._pluginUID).GetSdkInstance());return this._pluginInstance}GetCurrentNode(){return this.GetFlowchartElementById(this._currentFlowchartNodeId)}GetCurrentNodeTag(){const a=this.GetCurrentNode();return a?a.GetTag():""}GetCurrentNodeParent(a){var b=this.GetCurrentNode();if(C3$jscomp$144.IsFiniteNumber(a)){var d=b.GetParentFlowchartIds();d=d?d[a]:void 0;if(C3$jscomp$144.IsFiniteNumber(d))return this.GetFlowchartElementById(d)}if("string"===typeof a)for(const c of b.GetParentFlowchartIds())if(b=
this.GetFlowchartElementById(c),b.GetTag()===a)return this.GetFlowchartElementById(b.GetFlowchartId())}GetCurrentNodeParentTag(a){return(a=this.GetCurrentNodeParent(a))?a.GetTag():""}GetCurrentNodeParentIndex(a){a=this.GetCurrentNodeParent(a);if(!a)return-1;const b=a.GetParentFlowchartIds();return b?b.indexOf(a.GetFlowchartId()):-1}GetFlowchartElementById(a){return this._flowchartDataItem.GetFlowchartElementById(a)}Reset(){this._GetRootFlowchartState()._Reset(!0)}_Reset(a){if(this._GetReferenceFlowchartStates()){for(const [,
b]of this._GetReferenceFlowchartStates().entries())b._Reset(!1);this._GetReferenceFlowchartStates().clear()}this._currentReferenceFlowchartState=this._previousFlowchartStateStartNode=this._previousFlowchartState=this._referenceFlowchartStates=null;this._previousFlowchartStateTag="";this._referenceFlowchartStatesJson=null;this._rootFlowchartStateTag=this._currentReferenceFlowchartStateTag="";this._previousFlowchartNodeIds=[];a?(this._flowchartManager.SetCurrentFlowchartState(this),a=this._startFlowchartNode.GetFlowchartId(),
a!==this._currentFlowchartNodeId&&this._GotoFlowchartNode(a)):this._currentFlowchartNodeId=this._startFlowchartNode.GetFlowchartId()}GetCurrentNodeOutputCount(){return this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId).GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemCount()}GetCurrentNodeOutputNameAt(a){return(a=this._GetFlowchartNodeOutputAt(a))?a.GetName():""}GetCurrentNodeOutputValueAt(a){let b;C3$jscomp$144.IsFiniteNumber(a)&&(b=this._GetFlowchartNodeOutputAt(a));
"string"===typeof a&&(b=this._GetFlowchartNodeOutputByName(a));"number"!==typeof a&&"string"!==typeof a&&console.warn("[Flowcharts] unexpected argument type in GetCurrentNodeOutputValueAt expression");return b?b.GetValue():""}GotoNextFlowchartNode(a){let b;C3$jscomp$144.IsFiniteNumber(a)&&(b=this._GetFlowchartNodeOutputAt(a));"string"===typeof a&&(b=this._GetFlowchartNodeOutputByName(a));a=b.GetConnectedFlowchartNodeFlowchartId();C3$jscomp$144.IsFiniteNumber(a)&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),
this._GotoFlowchartNode(a))}GotoAnyFlowchartNode(a){if(a=this._flowchartDataItem.GetFlowchartNodeByTag(a))if(a=this._flowchartDataItem.GetFlowchartElementById(a.GetFlowchartId()))this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(a.GetFlowchartId())}GotoPreviousFlowchartNode(){const a=this._previousFlowchartNodeIds.pop();C3$jscomp$144.IsFiniteNumber(a)?this._GotoFlowchartNode(a):this._GetPreviousFlowchartState()&&(this._flowchartManager.SetCurrentFlowchartState(this._GetPreviousFlowchartState(),
!0,!1,!1),this._GetPreviousFlowchartState()._GotoFlowchartNode(this._GetPreviousFlowchartStateStartNodeId()),this._GetRootFlowchartState()._SetCurrentReferenceFlowchart(this._GetPreviousFlowchartState()))}GotoParentFlowchartNode(a){this.GetCurrentNode().GetFlowchartId();if(a=this.GetCurrentNodeParent(a))this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(a.GetFlowchartId())}HasOutput(a){if(C3$jscomp$144.IsFiniteNumber(a))return!!this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId).GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems()[a];
if("string"===typeof a){const b=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId).GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();for(let d=0;d<b.length;d++)if(b[d].GetName()===a)return!0}return!1}MarkForRelease(){this._markForRelease=!0}IsInTriggerState(){return 0<this._triggerCount}PushIsTriggerState(){this._triggerCount++}PopIsTriggerState(){this._triggerCount--;0===this._triggerCount&&this._markForRelease&&this._flowchartManager.RemoveFlowchartState(this)}_GotoFlowchartNode(a){var b=
this._currentFlowchartNodeId,d=this.GetPluginInstance().GetInstance();this.PushIsTriggerState();this._flowchartManager.PushFlowchartState(this);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChange,d);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChange,d);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChangeInFlowchart,d);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChangeInFlowchart,
d);this._currentFlowchartNodeId=a;this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnAnyNodeChange,d);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnTaggedNodeChange,d);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnAnyNodeChangeInFlowchart,d);this._runtime.Trigger(C3$jscomp$144.Plugins.Flowchart.Cnds.OnTaggedNodeChangeInFlowchart,d);this._flowchartManager.PopFlowchartState();this.PopIsTriggerState();a=this.GetFlowchartElementById(this._currentFlowchartNodeId);
if("reference"===a.GetType())if(d=a.GetReferenceFlowchartName(),this._HasReferenceFlowchartState(a))this._previousFlowchartNodeIds.pop(),a=this._GetReferenceFlowchartState(a),this._flowchartManager.SetCurrentFlowchartState(a,!0,!0,!1),a._SetPreviousFlowchart(this,b),this._GetRootFlowchartState()._SetCurrentReferenceFlowchart(a);else{const e=a.GetReferenceFlowchartStartNodeTag();if(d){this._previousFlowchartNodeIds.pop();let g=a.GetReferenceFlowchartTag();if(g)for(var c=this._flowchartManager.GetFlowchartState(g);c;)g=
C3$jscomp$144.IncrementNumberAtEndOf(g),c=this._flowchartManager.GetFlowchartState(g);else for(g=`${d}-ref`,c=this._flowchartManager.GetFlowchartState(g);c;)g=C3$jscomp$144.IncrementNumberAtEndOf(g),c=this._flowchartManager.GetFlowchartState(g);d=this._flowchartManager.AddFlowchartState(d,e,g,this._pluginInstance,!0);d._SetPreviousFlowchart(this,b);this._SetReferenceFlowchartState(a,d);b=this._GetRootFlowchartState();d._SetRootFlowchartState(b);b._SetCurrentReferenceFlowchart(d)}}}_GetFlowchartNodeOutputAt(a){var b=
this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);if(!b)return null;b=b.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();return b?(a=b[a])?a:null:null}_GetFlowchartNodeOutputByName(a){const b=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return b?(a=b.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemByName(a))?a:null:null}_SetStartFlowchartNode(a){"number"===typeof a?((a=this.GetFlowchartElementById(a))||(a=this._flowchartDataItem.GetFlowchartStartNode()),
this._startFlowchartNode=a):((a=this._flowchartDataItem.GetFlowchartNodeByTag(this._startNodeTag))||(a=this._flowchartDataItem.GetFlowchartStartNode()),this._startFlowchartNode=a)}_SaveToJson(){return this._markForRelease?null:{flowchartName:this._flowchartName,flowchartTag:this._tag,startNodeTag:this._startNodeTag,currentNodeId:this._currentFlowchartNodeId,previousNodeIds:this._previousFlowchartNodeIds,pluginUID:this._pluginInstance.GetInstance().GetUID(),reference:{previousFlowchartTag:this._GetPreviousFlowchartState()?
this._GetPreviousFlowchartState().GetTag():"",previousStartNodeId:C3$jscomp$144.IsFiniteNumber(this._GetPreviousFlowchartStateStartNodeId())?this._GetPreviousFlowchartStateStartNodeId():NaN,referencesJson:this._GetFlowchartReferencesJson(),currentReferenceFlowchartTag:this.GetCurrentReferenceFlowchart()?this.GetCurrentReferenceFlowchart().GetTag():"",rootFlowchartTag:this._GetRootFlowchartState()?this._GetRootFlowchartState().GetTag():""}}}_GetFlowchartReferencesJson(){if(!this._HasReferenceFlowchartStates())return null;
const a=[];for(const [b,d]of this._GetReferenceFlowchartStates().entries())a.push({flowchartElementId:b.GetFlowchartId(),flowchartStateTag:d.GetTag()});return a.length?a:null}_LoadFromJson(a){a&&(this._flowchartName=a.flowchartName,this._tag=a.flowchartTag,this._startNodeTag=a.startNodeTag,this._currentFlowchartNodeId=a.currentNodeId,this._previousFlowchartNodeIds=a.previousNodeIds,this._pluginUID=a.pluginUID,a.hasOwnProperty("reference")&&(a=a.reference,this._previousFlowchartStateTag=a.previousFlowchartTag,
this._previousFlowchartStateStartNodeId=a.previousStartNodeId,this._referenceFlowchartStatesJson=a.referencesJson,this._currentReferenceFlowchartStateTag=a.currentReferenceFlowchartTag,this._rootFlowchartStateTag=a.rootFlowchartTag),this._SetStartFlowchartNode())}_GetPreviousFlowchartState(){"string"===typeof this._previousFlowchartStateTag&&this._previousFlowchartStateTag&&(this._previousFlowchartState=this._flowchartManager.GetFlowchartState(this._previousFlowchartStateTag),this._previousFlowchartStateTag=
"");return this._previousFlowchartState}_GetPreviousFlowchartStateStartNodeId(){return this._previousFlowchartStateStartNodeId}_SetPreviousFlowchart(a,b){this._previousFlowchartState=a;this._previousFlowchartStateStartNodeId=b}GetCurrentReferenceFlowchart(){"string"===typeof this._currentReferenceFlowchartStateTag&&this._currentReferenceFlowchartStateTag&&(this._currentReferenceFlowchartState=this._flowchartManager.GetFlowchartState(this._currentReferenceFlowchartStateTag),this._currentReferenceFlowchartStateTag=
"");return this._currentReferenceFlowchartState}_SetCurrentReferenceFlowchart(a){this._currentReferenceFlowchartState=a;this._currentReferenceFlowchartState===this&&(this._currentReferenceFlowchartState=null)}_GetRootFlowchartState(){"string"===typeof this._rootFlowchartStateTag&&this._rootFlowchartStateTag&&(this._rootFlowchartState=this._flowchartManager.GetFlowchartState(this._rootFlowchartStateTag),this._rootFlowchartStateTag="");return this._rootFlowchartState?this._rootFlowchartState:this}_SetRootFlowchartState(a){this._rootFlowchartState=
a}_HasReferenceFlowchartStates(){this._RebuildReferenceFlowchartStates();return!!this._referenceFlowchartStates}_HasReferenceFlowchartState(a){this._RebuildReferenceFlowchartStates();return this._referenceFlowchartStates&&this._referenceFlowchartStates.has(a)}_RebuildReferenceFlowchartStates(){if(this._referenceFlowchartStatesJson){this._referenceFlowchartStates&&this._referenceFlowchartStates.clear();this._referenceFlowchartStates||(this._referenceFlowchartStates=new Map);for(const a of this._referenceFlowchartStatesJson){const b=
this._flowchartManager.GetFlowchartState(a.flowchartStateTag),d=b.GetFlowchartElementById(a.flowchartElementId);this._referenceFlowchartStates.set(d,b)}this._referenceFlowchartStatesJson=null}}_GetReferenceFlowchartStates(){this._RebuildReferenceFlowchartStates();return this._referenceFlowchartStates}_GetReferenceFlowchartState(a){this._RebuildReferenceFlowchartStates();return this._referenceFlowchartStates.get(a)}_SetReferenceFlowchartState(a,b){this._referenceFlowchartStates||(this._referenceFlowchartStates=
new Map);this._referenceFlowchartStates.set(a,b)}};"use strict";const C3$jscomp$145=self.C3;
C3$jscomp$145.FlowchartStateManager=class{constructor(a){this._runtime=a;this._flowchartStates=new Map;this._currentFlowchartState=null;this._flowchartStateStack=[]}Release(){C3$jscomp$145.clearArray(this._flowchartStateStack);this._flowchartStateStack=null;this._flowchartStates.clear();this._runtime=this._currentFlowchartState=this._flowchartStates=null}GetRuntime(){return this._runtime}AddFlowchartState(a,b,d,c,e,g){const k=this._runtime.GetFlowchartManager().GetFlowchartDataItemByName(a);if(k)if(this._flowchartStates.has(d))console.warn(`[Flowcharts] there already is a flowchart with the tag '${d}'`);
else return a=new C3$jscomp$145.FlowchartState(a,d,b,k,this,c,g),this._flowchartStates.set(d,a),e&&this.SetCurrentFlowchartState(a,!0),a;else console.warn(`[Flowcharts] no flowchart found with name '${a}'`)}RemoveFlowchartState(a){a.MarkForRelease();if(!a.IsInTriggerState()){var b=a.GetTag();this._flowchartStates.delete(b);a.Release();this._currentFlowchartState===a&&(this._currentFlowchartState=null)}}ResetFlowchartState(a){a.Reset()}GetFlowchartState(a){return this._flowchartStates.get(a)}PushFlowchartState(a){this._flowchartStateStack.push(a)}PopFlowchartState(){this._flowchartStateStack.pop()}SetCurrentFlowchartState(a,
b=!1,d=!1,c=!0){c&&(a=(c=a.GetCurrentReferenceFlowchart())?c:a);a!==this._currentFlowchartState&&(this._TriggerBeforeFlowchartChange(),this._TriggerAfterFlowchartChange(a,b,d))}GetCurrentFlowchartState(a){return"string"===typeof a?this.GetFlowchartState(a):this._flowchartStateStack.length?this._flowchartStateStack[this._flowchartStateStack.length-1]:this._currentFlowchartState}_TriggerBeforeFlowchartChange(){if(this._currentFlowchartState&&!this._currentFlowchartState.WasReleased()){var a=this._currentFlowchartState.GetPluginInstance().GetInstance();
this._currentFlowchartState.PushIsTriggerState();this.PushFlowchartState(this._currentFlowchartState);this._runtime.Trigger(C3$jscomp$145.Plugins.Flowchart.Cnds.OnBeforeFlowchartChange,a);this.PopFlowchartState();this._currentFlowchartState.PopIsTriggerState()}}_TriggerAfterFlowchartChange(a,b=!1,d=!1){(this._currentFlowchartState=a)&&!this._currentFlowchartState.WasReleased()&&(a=this._currentFlowchartState.GetPluginInstance().GetInstance(),this._currentFlowchartState.PushIsTriggerState(),this.PushFlowchartState(this._currentFlowchartState),
this._runtime.Trigger(C3$jscomp$145.Plugins.Flowchart.Cnds.OnFlowchartChange,a),!0!==d&&"number"!==typeof d||this._currentFlowchartState._SetStartFlowchartNode(d),b&&(this._runtime.Trigger(C3$jscomp$145.Plugins.Flowchart.Cnds.OnAnyNodeChange,a),this._runtime.Trigger(C3$jscomp$145.Plugins.Flowchart.Cnds.OnTaggedNodeChange,a)),this.PopFlowchartState(),this._currentFlowchartState.PopIsTriggerState())}_SaveToJson(){return{flowchartJsonObjects:[...this._flowchartStates.values()].map(a=>a._SaveToJson()),
currentFlowchartTag:this._currentFlowchartState?this._currentFlowchartState.GetTag():null}}_LoadFromJson(a){if(a){var b=new Map;for(const c of a.flowchartJsonObjects){var d=c.flowchartTag;if(this._flowchartStates.has(d)){const e=this._flowchartStates.get(d);e._LoadFromJson(c);b.set(d,e)}else d=this.AddFlowchartState(c.flowchartName,c.startNodeTag,c.flowchartTag,null,!1,c.pluginUID),d._LoadFromJson(c),b.set(c.flowchartTag,d)}for(const [c,e]of this._flowchartStates.entries())b.has(c)||e.Release();this._flowchartStates.clear();
this._flowchartStates=b;(a=this._flowchartStates.get(a.currentFlowchartTag))&&this.SetCurrentFlowchartState(a,!0)}}};"use strict";const C3$jscomp$146=self.C3;
C3$jscomp$146.FlowchartDataManager=class{constructor(){this._flowchartDataItems=new Map}Release(){for(const a of this._flowchartDataItems.values())a.Release();this._flowchartDataItems.clear();this._flowchartDataItems=null}Add(a){a=new C3$jscomp$146.FlowchartDataItem(a);const b=a.GetName();this._flowchartDataItems.set(b,a)}Get(a){return this._flowchartDataItems.get(a)}HasFlowcharts(){return!!this._flowchartDataItems.size}static CreateDataItems(a,b,d,c){if(b)for(const e of b)b=new d(e,c),a.push(b)}};
"use strict";const C3$jscomp$147=self.C3;C3$jscomp$147.FlowchartDataItem=class{constructor(a){this._name=a[0];this._flowchartNodeData=new C3$jscomp$147.FlowchartNodeData(a[1],this)}Release(){this._flowchartNodeData.Release();this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartElementById(a){return this._flowchartNodeData.GetFlowchartElementById(a)}GetFlowchartNodeByTag(a){return this._flowchartNodeData.GetFlowchartNodeByTag(a)}GetFlowchartStartNode(){return this._flowchartNodeData.GetFlowchartStartNode()}GetName(){return this._name}};
"use strict";const C3$jscomp$148=self.C3;
class FlowchartNodeDataItem{constructor(a,b){this._flowchartNodeData=b;this._type=a[7];this._flowchartId=a[0];this._tag=a[1];this._parentFlowchartIds=a[2];this._childrenFlowchartIds=this._parentOutputFlowchartIds=null;"dictionary"===this._type&&(this._parentOutputFlowchartIds=a[3],this._childrenFlowchartIds=a[4]);this._isStart=a[6];this._referenceFlowchartTag=this._referenceFlowchartStartNodeTag=this._referenceFlowchartName=null;"reference"===this._type&&(this._referenceFlowchartName=a[8],this._referenceFlowchartStartNodeTag=
a[9],this._referenceFlowchartTag=a[10]);this._flowchartNodeOutputData=new C3$jscomp$148.FlowchartNodeOutputData(a[5],this)}Release(){this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetTag(){return this._tag}GetIsStart(){return this._isStart}GetParentFlowchartIds(){return this._parentFlowchartIds}GetParentOutputFlowchartIds(){return this._parentOutputFlowchartIds}GetChildrenFlowchartIds(){return this._childrenFlowchartIds}GetType(){return this._type}GetReferenceFlowchartName(){return this._referenceFlowchartName}GetReferenceFlowchartStartNodeTag(){return this._referenceFlowchartStartNodeTag}GetReferenceFlowchartTag(){return this._referenceFlowchartTag}}
C3$jscomp$148.FlowchartNodeData=class{constructor(a,b){this._flowchartDataItem=b;this._flowchartNodeItems=[];this._flowchartNodeItemsIdMap=new Map;this._flowchartNodeItemsTagMap=new Map;this._flowchartNodeStartItem=null;C3$jscomp$148.FlowchartDataManager.CreateDataItems(this._flowchartNodeItems,a,FlowchartNodeDataItem,this);for(const d of this._flowchartNodeItems){a=d.GetFlowchartId();b=d.GetTag();const c=d.GetIsStart();this._flowchartNodeItemsIdMap.set(a,d);b&&this._flowchartNodeItemsTagMap.set(b,
d);c&&(this._flowchartNodeStartItem=d);a=d.GetFlowchartNodeOutputData();for(const e of a.flowchartNodeOutputDataItems())a=e.GetFlowchartId(),this._flowchartNodeItemsIdMap.set(a,e)}}Release(){this._flowchartDataItem=null;for(const a of this._flowchartNodeItems)a.Release();C3$jscomp$148.clearArray(this._flowchartNodeItems);this._flowchartNodeItems=null}GetFlowchartDataItem(){return this._flowchartDataItem}GetFlowchartElementById(a){return this._flowchartNodeItemsIdMap.get(a)}GetFlowchartNodeByTag(a){return this._flowchartNodeItemsTagMap.get(a)}GetFlowchartStartNode(){return this._flowchartNodeStartItem}*flowchartNodeDataItems(){for(const a of this._flowchartNodeItems)yield a}};
"use strict";const C3$jscomp$149=self.C3;
class FlowchartNodeDataOutputItem{constructor(a,b){this._flowchartNodeOutputData=b;this._flowchartId=a[0];this._name=a[1];this._value=a[2];this._connectedFlowchartNodeFlowchartId=a[3]}Release(){this._flowchartNodeOutputData=null}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetName(){return this._name}GetValue(){return this._value}GetConnectedFlowchartNodeFlowchartId(){return this._connectedFlowchartNodeFlowchartId}}
C3$jscomp$149.FlowchartNodeOutputData=class{constructor(a,b){this._flowchartDataNodeItem=b;this._flowchartNodeOutputItems=[];this._flowchartNodeOutputItemsNameMap=new Map;C3$jscomp$149.FlowchartDataManager.CreateDataItems(this._flowchartNodeOutputItems,a,FlowchartNodeDataOutputItem,this);for(const d of this._flowchartNodeOutputItems)this._flowchartNodeOutputItemsNameMap.set(d.GetName(),d)}Release(){this._flowchartDataNodeItem=null;for(const a of this._flowchartNodeOutputItems)a.Release();C3$jscomp$149.clearArray(this._flowchartNodeOutputItems);
this._flowchartNodeOutputItems=null}GetFlowchartNodeDataItem(){return this._flowchartDataNodeItem}GetFlowchartNodeOutputDataItemCount(){return this._flowchartNodeOutputItems.length}GetFlowchartNodeOutputDataItems(){return this._flowchartNodeOutputItems}GetFlowchartNodeOutputDataItemByName(a){return this._flowchartNodeOutputItemsNameMap.get(a)}*flowchartNodeOutputDataItems(){for(const a of this._flowchartNodeOutputItems)yield a}};"use strict";const C3$jscomp$150=self.C3;
C3$jscomp$150.SolStack=class extends C3$jscomp$150.DefendedBase{constructor(a){super();this._objectClass=a;this._stack=[];this._stack.push(C3$jscomp$150.New(C3$jscomp$150.Sol,this));this._index=0;this._current=this._stack[0]}Release(){for(const a of this._stack)a.Release();C3$jscomp$150.clearArray(this._stack);this._objectClass=this._current=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}GetOneBelowCurrentSol(){return this._stack[this._index-1]}Clear(){this.GetCurrentSol().Clear()}PushClean(){var a=
this._stack,b=++this._index;b===a.length?(b=C3$jscomp$150.New(C3$jscomp$150.Sol,this),a.push(b),this._current=b):(a=a[b],a.Reset(),this._current=a)}PushCopy(){const a=this._stack,b=++this._index;b===a.length&&a.push(C3$jscomp$150.New(C3$jscomp$150.Sol,this));const d=a[b];d.Copy(a[b-1]);this._current=d}Pop(){this._current=this._stack[--this._index]}RemoveInstances(a){const b=this._stack;for(let d=0,c=b.length;d<c;++d)b[d].RemoveInstances(a)}};"use strict";const C3$jscomp$151=self.C3;
C3$jscomp$151.Sol=class extends C3$jscomp$151.DefendedBase{constructor(a){super();this._stack=a;this._objectClass=this._stack.GetObjectClass();this._eventStack=this._objectClass.GetRuntime().GetEventStack();this._selectAll=!0;this._instances=[];this._elseInstances=[]}Release(){this.ClearArrays();this._eventStack=this._objectClass=this._stack=null}ClearArrays(){C3$jscomp$151.clearArray(this._instances);C3$jscomp$151.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){return this._selectAll?
!!this._objectClass.GetInstanceCount():!!this._instances.length}GetInstances(){return this._selectAll?this._objectClass.GetInstances():this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){const a=this.GetInstances();return a.length?a:this._elseInstances}Reset(){this._selectAll=!0;C3$jscomp$151.clearArray(this._elseInstances)}Clear(){this._selectAll=!0}Copy(a){a.IsSelectAll()?this.Reset():(this._selectAll=!1,
C3$jscomp$151.shallowAssignArray(this._instances,a._instances),C3$jscomp$151.clearArray(this._elseInstances))}_PushInstance(a){this._instances.push(a)}_PushElseInstance(a){this._elseInstances.push(a)}_SetSelectAll(a){this._selectAll=!!a}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(a){this._selectAll=!1;C3$jscomp$151.clearArray(this._instances);this._instances.push(a)}SetArrayPicked(a){this._selectAll=!1;C3$jscomp$151.shallowAssignArray(this._instances,
a)}SetSetPicked(a){this._selectAll=!1;C3$jscomp$151.clearArray(this._instances);for(const b of a)this._instances.push(b)}AddElseInstances(a,b){for(const d of b)a.has(d)||this._elseInstances.push(d)}TransferElseInstancesToOwn(a){for(const b of a)this._instances.push(b);C3$jscomp$151.arrayRemoveAllInSet(this._elseInstances,a)}ClearElseInstances(){C3$jscomp$151.clearArray(this._elseInstances)}PickOne(a){a&&(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()?(this.IsSelectAll()&&(C3$jscomp$151.clearArray(this._instances),
C3$jscomp$151.shallowAssignArray(this._elseInstances,a.GetObjectClass().GetInstances()),this._selectAll=!1),a=this._elseInstances.indexOf(a),-1!==a&&(this._instances.push(this._elseInstances[a]),this._elseInstances.splice(a,1))):this.SetSinglePicked(a))}RemoveInstances(a){C3$jscomp$151.arrayRemoveAllInSet(this._instances,a);C3$jscomp$151.arrayRemoveAllInSet(this._elseInstances,a)}};"use strict";const C3$jscomp$152=self.C3;
C3$jscomp$152.EventStack=class extends C3$jscomp$152.DefendedBase{constructor(a){super();this._eventSheetManager=a;this._runtime=this._eventSheetManager.GetRuntime();this._stack=[];this._stack.push(C3$jscomp$152.New(C3$jscomp$152.EventStackFrame,this,null));this._index=0;this._expFuncStack=[]}Release(){for(const a of this._stack)a.Release();C3$jscomp$152.clearArray(this._stack);C3$jscomp$152.clearArray(this._expFuncStack);this._runtime=this._eventSheetManager=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}GetAllStackFrames(){return this._stack}GetCurrentStackFrameIndex(){return this._index}Push(a){var b=
this._stack;const d=++this._index;if(d===b.length)return a=C3$jscomp$152.New(C3$jscomp$152.EventStackFrame,this,a),b.push(a),a;b=b[d];b.Reset(a);return b}Pop(){--this._index}PushExpFunc(a){this._expFuncStack.push(a)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){const a=this._expFuncStack;return 0===a.length?null:a.at(-1)}};"use strict";const C3$jscomp$153=self.C3;
C3$jscomp$153.EventStackFrame=class extends C3$jscomp$153.DefendedBase{constructor(a,b){super();this._stack=a;this._runtime=this._stack.GetRuntime();this._currentEvent=b;this._actIndex=this._cndIndex=0;this._elseBranchRan=this._lastEventTrue=!1;this._expressionObjectClass=null;this._functionReturnValue=this._functionReturnType=0;this._dynamicSolModifiers=null}Release(){this.Reset(null);this._runtime=this._stack=null}Reset(a){this._currentEvent=a;this._actIndex=this._cndIndex=0;this._elseBranchRan=
this._lastEventTrue=!1;this._dynamicSolModifiers=null}_Restore(a,b){this._currentEvent=a;this._cndIndex=0;this._actIndex=b}ResetQuick(){this._actIndex=this._cndIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(a){this._currentEvent=a}GetConditionIndex(){return this._cndIndex}SetConditionIndex(a){this._cndIndex=a}GetActionIndex(){return this._actIndex}SetActionIndex(a){this._actIndex=a}SetLastEventTrue(a){this._lastEventTrue=!!a}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(a){this._elseBranchRan=
!!a}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(a){this._expressionObjectClass=a}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(a,b){this._functionReturnType=a;this._functionReturnValue=b}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(a){this._functionReturnValue=a}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){const a=this._currentEvent;return a.IsSolWriterAfterCnds()?
!0:this._cndIndex<a.GetConditionCount()-1?!!a.GetSolModifiers().length:!1}SetDynamicSolModifiers(a){this._dynamicSolModifiers=a}GetDynamicSolModifiers(){return this._dynamicSolModifiers}};"use strict";const C3$jscomp$154=self.C3;
C3$jscomp$154.LocalVarStack=class extends C3$jscomp$154.DefendedBase{constructor(a){super();this._eventSheetManager=a;this._runtime=this._eventSheetManager.GetRuntime();this._stack=[];this._index=-1;this._current=null;this._initialValues=[]}Release(){C3$jscomp$154.clearArray(this._stack);this._runtime=this._eventSheetManager=null}_SetInitialValues(a){this._initialValues=a;a=this._initialValues.slice(0);this._stack.push(a);this._index=0;this._current=a}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){const a=
++this._index,b=this._stack;a===b.length?b.push(this._initialValues.slice(0)):C3$jscomp$154.shallowAssignArray(b[a],this._initialValues);this._current=b[a]}Pop(){this._current=this._stack[--this._index]}};"use strict";const C3$jscomp$155=self.C3;
C3$jscomp$155.LoopStack=class extends C3$jscomp$155.DefendedBase{constructor(a){super();this._eventSheetManager=a;this._runtime=this._eventSheetManager.GetRuntime();this._stack=[];this._index=-1}Release(){C3$jscomp$155.clearArray(this._stack);this._runtime=this._eventSheetManager=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return 0<=this._index}GetCurrent(){return this._stack[this._index]}Push(){++this._index;if(this._index===this._stack.length){var a=
C3$jscomp$155.New(C3$jscomp$155.Loop,this);this._stack.push(a);return a}a=this._stack[this._index];a.Reset();return a}Pop(){--this._index}FindByName(a){const b=this._stack;for(let d=this._index;0<=d;--d){const c=b[d];if(c.GetName()===a)return c}return null}_GetStack(){return this._stack.slice(0,this._index+1)}};"use strict";const C3$jscomp$156=self.C3;
C3$jscomp$156.Loop=class extends C3$jscomp$156.DefendedBase{constructor(a){super();this._loopStack=a;this._name="";this._index=0;this._isStopped=!1;this._end=NaN}Reset(){this._name="";this._index=0;this._isStopped=!1;this._end=NaN}SetName(a){this._name=a}GetName(){return this._name}SetIndex(a){this._index=a}GetIndex(){return this._index}Stop(){this._isStopped=!0}IsStopped(){return this._isStopped}SetEnd(a){this._end=a}GetEnd(){return this._end}};"use strict";const C3$jscomp$157=self.C3;
C3$jscomp$157.ArrayStack=class extends C3$jscomp$157.DefendedBase{constructor(){super();this._stack=[];this._index=-1}Release(){C3$jscomp$157.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){++this._index;if(this._index===this._stack.length){const a=[];this._stack.push(a);return a}return this._stack[this._index]}Pop(){--this._index}};"use strict";const C3$jscomp$158=self.C3;function SortSolArray(a,b){return a.GetIndex()-b.GetIndex()}
function IsSolArrayIdentical(a,b){for(let d=0,c=a.length;d<c;++d)if(a[d]!==b[d])return!1;return!0}
C3$jscomp$158.EventSheetManager=class extends C3$jscomp$158.DefendedBase{constructor(a){super();this._runtime=a;this._allSheets=[];this._sheetsByName=new Map;this._allGroups=[];this._groupsByName=new Map;this._blocksBySid=new Map;this._cndsBySid=new Map;this._actsBySid=new Map;this._allUniqueSolModifiers=new Map;this._eventVarsBySid=new Map;this._nextLocalVarIndex=0;this._allGlobalVars=[];this._allLocalVars=[];this._localVarInitialValues=[];this._functionBlocksByName=new Map;this._customActionBlocksMap=
new Map;this._eventStack=C3$jscomp$158.New(C3$jscomp$158.EventStack,this);this._localVarStack=C3$jscomp$158.New(C3$jscomp$158.LocalVarStack,this);this._loopStack=C3$jscomp$158.New(C3$jscomp$158.LoopStack,this);this._triggersToPostInit=[];this._queuedTriggers=[];this._queuedDebugTriggers=[];this._blockFlushingDepth=this._executingTriggerDepth=this._runningEventsDepth=0;this._scheduledWaits=[];this._asyncActionPromises=[];self.c3_callFunction=(b,d)=>this._InvokeFunctionFromJS(b,d)}Release(){this.ClearAllScheduledWaits();
this._eventStack.Release();this._eventStack=null;this._localVarStack.Release();this._localVarStack=null;C3$jscomp$158.clearArray(this._queuedTriggers);C3$jscomp$158.clearArray(this._queuedDebugTriggers);this._runtime=null;C3$jscomp$158.clearArray(this._allSheets);this._sheetsByName.clear()}Create(a){a=C3$jscomp$158.New(C3$jscomp$158.EventSheet,this,a);this._allSheets.push(a);this._sheetsByName.set(a.GetName().toLowerCase(),a)}_AddTriggerToPostInit(a){this._triggersToPostInit.push(a)}_PostInit(){for(const a of this._customActionBlocksMap.values())a._CheckOverrideState();
for(const a of this._functionBlocksByName.values())a._PostInit();for(const a of this._customActionBlocksMap.values())a._PostInit();for(const a of this._allSheets)a._PostInit();for(const a of this._allSheets)a._UpdateDeepIncludes();for(const a of this._triggersToPostInit)a._PostInit(!1);C3$jscomp$158.clearArray(this._triggersToPostInit);this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(a){return this._sheetsByName.get(a.toLowerCase())||
null}_RegisterGroup(a){this._allGroups.push(a);this._groupsByName.set(a.GetGroupName(),a)}_RegisterEventBlock(a){this._blocksBySid.set(a.GetSID(),a)}_RegisterCondition(a){this._cndsBySid.set(a.GetSID(),a)}_RegisterAction(a){this._actsBySid.set(a.GetSID(),a)}_RegisterFunctionBlock(a){switch(a.GetFunctionType()){case 0:this._functionBlocksByName.set(a.GetFunctionName().toLowerCase(),a);break;case 1:this._customActionBlocksMap.set(a.GetFunctionName().toLowerCase(),a)}}_RegisterEventVariable(a){this._eventVarsBySid.set(a.GetSID(),
a);a.IsGlobal()?this._allGlobalVars.push(a):this._allLocalVars.push(a)}_DeduplicateSolModifierList(a){2<=a.length&&a.sort(SortSolArray);let b=this._allUniqueSolModifiers.get(a.length);b||(b=[],this._allUniqueSolModifiers.set(a.length,b));for(let d=0,c=b.length;d<c;++d){const e=b[d];if(IsSolArrayIdentical(a,e))return e}b.push(a);return a}_GetNextLocalVarIndex(a){this._localVarInitialValues.push(a.GetInitialValue());return this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){const a=
this.GetCurrentEventStackFrame();return a.GetCurrentEvent().GetConditionAt(a.GetConditionIndex())}GetCurrentAction(){const a=this.GetCurrentEventStackFrame();return a.GetCurrentEvent().GetActionAt(a.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(a){const b=[];for(a=a.GetScopeParent();a;)C3$jscomp$158.appendArray(b,a._GetAllLocalVariablesInScope()),a=a.GetScopeParent();return b}_GetLocalVariablesScriptInterface(a){const b=
{};for(const d of this.GetAllLocalVariablesInScope(a))b[d.GetJsPropName()]=d._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,b)}GetEventVariableBySID(a){return this._eventVarsBySid.get(a)||null}GetEventBlockBySID(a){return this._blocksBySid.get(a)||null}GetConditionBySID(a){return this._cndsBySid.get(a)||null}GetActionBySID(a){return this._actsBySid.get(a)||null}GetFunctionBlockByName(a){return this._functionBlocksByName.get(a.toLowerCase())||null}GetCustomActionBlockByName(a,
b){let d=this._customActionBlocksMap.get((a.GetName()+"."+b).toLowerCase());if(d)return d;if(!a.IsFamily())for(const c of a.GetFamilies())if(d=this._customActionBlocksMap.get((c.GetName()+"."+b).toLowerCase()))return d;return null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(a){for(const b of this._allGlobalVars)b.ResetToInitialValue();if(a)for(const b of this._allLocalVars)b.IsStatic()&&b.ResetToInitialValue()}GetEventGroupByName(a){return this._groupsByName.get(a.toLowerCase())||
null}GetEventGroupBySID(a){return(a=this._blocksBySid.get(a))&&a.IsGroup()?a:null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(const a of this._allGroups)a.ResetInitialActivation()}_ResetAllHasRunFlags(){for(const a of this._allSheets)a._ResetHasRunFlag()}RunEvents(a){this._ResetAllHasRunFlags();this._runningEventsDepth++;for(const b of a.runningLayouts())if(a=b.GetEventSheet())this._runtime.PushCurrentLayout(b),a.Run(),this._runtime.PopCurrentLayout();this._runningEventsDepth--}async DebugRunEvents(a){this._ResetAllHasRunFlags();
this._runningEventsDepth++;for(const b of this._DebugRunEventsGen(a))await this._runtime.DebugBreak(b);this._runningEventsDepth--}*_DebugRunEventsGen(a){for(const b of a.runningLayouts())if(a=b.GetEventSheet())this._runtime.PushCurrentLayout(b),yield*a.DebugRun(),this._runtime.PopCurrentLayout()}_Trigger(a,b,d,c){let e=!1;if(!a.GetMainRunningLayout())return this.QueueTrigger(b,d,c);this._executingTriggerDepth++;for(const g of a.runningLayouts())if(a=g.GetEventSheet()){this._runtime.PushCurrentLayout(g);
for(const k of a.deepIncludes()){const l=k._Trigger(b,d,c);e=e||l}a=a._Trigger(b,d,c);e=e||a;this._runtime.PopCurrentLayout()}this._executingTriggerDepth--;return e}*_DebugTrigger(a,b,d,c){let e=!1;if(!a.GetMainRunningLayout())return this.QueueTrigger(b,d,c);this._executingTriggerDepth++;for(const g of a.runningLayouts())if(a=g.GetEventSheet()){this._runtime.PushCurrentLayout(g);for(const k of a.deepIncludes()){const l=yield*k._DebugTrigger(b,d,c);e=e||l}a=yield*a._DebugTrigger(b,d,c);e=e||a;this._runtime.PopCurrentLayout()}this._executingTriggerDepth--;
return e}QueueTrigger(a,b,d){this._queuedTriggers.push([a,b,d]);return!1}QueueDebugTrigger(a,b,d){let c=null;const e=new Promise(g=>c=g);this._queuedDebugTriggers.push([a,b,d,c]);return e}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw Error("should not be in breakpoint");const a=this._runtime.GetLayoutManager();for(;this._queuedDebugTriggers.length;){const [b,d,c,e]=this._queuedDebugTriggers.shift(),g=yield*this._DebugTrigger(a,b,d,c);e(g)}}async RunQueuedDebugTriggersAsync(){for(const a of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(a)}_FastTrigger(a,
b,d,c){let e=!1;var g=a.GetMainRunningLayout();if(a=g.GetEventSheet()){this._executingTriggerDepth++;this._runtime.PushCurrentLayout(g);g=a.deepIncludes();for(let k=0,l=g.length;k<l;++k){const n=g[k]._FastTrigger(b,d,c);e=e||n}b=a._FastTrigger(b,d,c);e=e||b;this._runtime.PopCurrentLayout();this._executingTriggerDepth--;return e}}*_DebugFastTrigger(a,b,d,c){let e=!1;var g=a.GetMainRunningLayout();if(a=g.GetEventSheet()){this._executingTriggerDepth++;this._runtime.PushCurrentLayout(g);g=a.deepIncludes();
for(let k=0,l=g.length;k<l;++k){const n=yield*g[k]._DebugFastTrigger(b,d,c);e=e||n}b=yield*a._DebugFastTrigger(b,d,c);e=e||b;this._runtime.PopCurrentLayout();this._executingTriggerDepth--;return e}}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return 0<this.GetTriggerDepth()}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return 0<this._runningEventsDepth}IsInEventEngine(){return this.IsRunningEvents()||
this.IsInTrigger()}_RunQueuedTriggers(a){for(const [b,d,c]of this._queuedTriggers)this._Trigger(a,b,d,c);C3$jscomp$158.clearArray(this._queuedTriggers)}BlockFlushingInstances(a){a?this._blockFlushingDepth++:this._blockFlushingDepth--}IsFlushingBlocked(){return 0<this._blockFlushingDepth}ClearSol(a){for(let b=0,d=a.length;b<d;++b)a[b].GetSolStack().Clear()}PushCleanSol(a){for(let b=0,d=a.length;b<d;++b)a[b].GetSolStack().PushClean()}PushCopySol(a){for(let b=0,d=a.length;b<d;++b)a[b].GetSolStack().PushCopy()}PopSol(a){for(let b=
0,d=a.length;b<d;++b)a[b].GetSolStack().Pop()}GetDynamicSolModifiersSet(a){const b=new Set,d=this._eventStack.GetAllStackFrames(),c=this._eventStack.GetCurrentStackFrameIndex();for(let e=0;e<=c;++e){const g=d[e].GetDynamicSolModifiers();if(g)for(const k of g)a&&a.has(k)||b.add(k)}return b}PushCleanSolDynamic(a){a=new Set([...a]);a=this.GetDynamicSolModifiersSet(a);if(0<a.size){for(const b of a)b.GetSolStack().PushClean();return[...a]}return null}AddScheduledWait(){const a=C3$jscomp$158.New(C3$jscomp$158.ScheduledWait,
this);this._scheduledWaits.push(a);return a}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(this._scheduledWaits.length){var a=this.GetCurrentEventStackFrame(),b=!1;this._runningEventsDepth++;for(let d=0,c=this._scheduledWaits.length;d<c;++d){const e=this._scheduledWaits[d];e._ShouldRun()&&e._Run(a);e.ShouldRelease()&&(b=!0)}b&&(this._FilterScheduledWaitsToRelease(),a.Reset(null));this._runningEventsDepth--}}async DebugRunScheduledWaits(){if(this._scheduledWaits.length){var a=
this.GetCurrentEventStackFrame(),b=!1;this._runningEventsDepth++;for(let d=0,c=this._scheduledWaits.length;d<c;++d){const e=this._scheduledWaits[d];e._ShouldRun()&&await e._DebugRun(a);e.ShouldRelease()&&(b=!0)}b&&(this._FilterScheduledWaitsToRelease(),a.Reset(null));this._runningEventsDepth--}}_FilterScheduledWaitsToRelease(){const a=C3$jscomp$158.arrayFilterOut(this._scheduledWaits,b=>b.ShouldRelease());for(const b of a)b.Release()}ClearAllScheduledWaits(){for(const a of this._scheduledWaits)a.Release();
C3$jscomp$158.clearArray(this._scheduledWaits)}RemoveInstancesFromScheduledWaits(a){for(const b of this._scheduledWaits)b.RemoveInstances(a)}AddAsyncActionPromise(a){this._asyncActionPromises.push(a)}ClearAsyncActionPromises(){C3$jscomp$158.clearArray(this._asyncActionPromises)}GetPromiseForAllAsyncActions(){const a=Promise.all(this._asyncActionPromises);this._asyncActionPromises=[];return a}_SaveToJson(){return{groups:this._SaveGroupsToJson(),cnds:this._SaveCndsToJson(),acts:this._SaveActsToJson(),
vars:this._SaveVarsToJson(),waits:this._SaveScheduledWaitsToJson()}}_LoadFromJson(a){this._LoadGroupsFromJson(a.groups);this._LoadCndsFromJson(a.cnds);this._LoadActsFromJson(a.acts);this._LoadVarsFromJson(a.vars);this._LoadScheduledWaitsFromJson(a.waits)}_SaveGroupsToJson(){const a={};for(const b of this.GetAllGroups())a[b.GetSID().toString()]=b.IsGroupActive();return a}_LoadGroupsFromJson(a){for(const [b,d]of Object.entries(a))a=parseInt(b,10),(a=this.GetEventGroupBySID(a))&&a.SetGroupActive(d)}_SaveCndsToJson(){const a=
{};for(const [b,d]of this._cndsBySid){const c=d._SaveToJson();c&&(a[b.toString()]=c)}return a}_LoadCndsFromJson(a){const b=new Map;for(const [d,c]of Object.entries(a))b.set(parseInt(d,10),c);for(const [d,c]of this._cndsBySid)c._LoadFromJson(b.get(d)||null)}_SaveActsToJson(){const a={};for(const [b,d]of this._actsBySid){const c=d._SaveToJson();c&&(a[b.toString()]=c)}return a}_LoadActsFromJson(a){const b=new Map;for(const [d,c]of Object.entries(a))b.set(parseInt(d,10),c);for(const [d,c]of this._actsBySid)c._LoadFromJson(b.get(d)||
null)}_SaveVarsToJson(){const a={};for(const [b,d]of this._eventVarsBySid)d.IsConstant()||!d.IsGlobal()&&!d.IsStatic()||(a[b.toString()]=d.GetValue());return a}_LoadVarsFromJson(a){for(const [b,d]of Object.entries(a))a=parseInt(b,10),(a=this.GetEventVariableBySID(a))&&a.SetValue(d)}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter(a=>!a.IsPromise()).map(a=>a._SaveToJson())}_LoadScheduledWaitsFromJson(a){this.ClearAllScheduledWaits();for(const b of a)(a=C3$jscomp$158.ScheduledWait._CreateFromJson(this,
b))&&this._scheduledWaits.push(a)}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map(a=>a.GetEventSheet()).filter(a=>a).map(a=>a._GetPerfRecord())}FindFirstFunctionBlockParent(a){for(;a;)if(a=a.GetScopeParent(),a instanceof C3$jscomp$158.FunctionBlock)return a;return null}_InvokeFunctionFromJS(a,b){Array.isArray(b)||(b=[]);a=this.GetFunctionBlockByName(a.toLowerCase());if(!a)return null;if(!a.IsEnabled())return a.GetDefaultReturnValue();var d=a.GetFunctionParameters();
if(b.length<d.length){b=b.slice(0);do b.push(d[b.length].GetInitialValue());while(b.length<d.length)}d=a.GetEventBlock();return d.RunAsExpressionFunctionCall(d.GetSolModifiersIncludingParents(),!1,a.GetReturnType(),a.GetDefaultReturnValue(),...b)}};"use strict";const C3$jscomp$159=self.C3;
C3$jscomp$159.EventSheet=class extends C3$jscomp$159.DefendedBase{constructor(a,b){super();this._eventSheetManager=a;this._runtime=a.GetRuntime();this._name=b[0];this._events=[];this._triggers=new Map;this._fastTriggers=new Map;this._eventsByDisplayNumber=new Map;this._hasRun=!1;this._shallowIncludes=[];this._deepIncludes=[];this._alreadyIncludedSheets=new Set;for(const d of b[1])this._CreateEvent(d,null,this._events);this._perfRecord=this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,
children:[]}:null}Release(){this._runtime=this._eventSheetManager=null}_CreateEvent(a,b,d){switch(a[0]){case 0:case 3:this._CreateEventBlock(a,b,d);break;case 1:this._CreateEventVariable(a,b,d);break;case 2:this._CreateInclude(a,b,d);break;case 4:this._CreateFunctionBlock(a,b);break;case 5:this._CreateScriptBlock(a,b,d);break;case 6:this._CreateCustomACEBlock(a,b);break;default:throw Error("invalid event type");}}_CreateEventBlock(a,b,d){a=C3$jscomp$159.EventBlock.Create(this,b,a);if(a.IsOrBlock()){d.push(a);
d=a.GetConditions();for(let c=0,e=d.length;c<e;++c)d[c].IsTrigger()&&this._InitTrigger(a,c)}else a.IsTrigger()?this._InitTrigger(a,0):d.push(a)}_CreateFunctionBlock(a,b){a=C3$jscomp$159.FunctionBlock.CreateFunctionBlock(this,b,a);this._eventSheetManager._RegisterFunctionBlock(a)}_CreateCustomACEBlock(a,b){a=C3$jscomp$159.FunctionBlock.CreateCustomACEBlock(this,b,a);this._eventSheetManager._RegisterFunctionBlock(a)}_CreateEventVariable(a,b,d){a=C3$jscomp$159.EventVariable.Create(this,b,a);d.push(a)}_CreateInclude(a,
b,d){a=C3$jscomp$159.EventInclude.Create(this,b,a);d.push(a)}_CreateScriptBlock(a,b,d){a=C3$jscomp$159.EventScript.Create(this,b,a);d.push(a)}_InitTrigger(a,b){a.IsOrBlock()||this._eventSheetManager._AddTriggerToPostInit(a);var d=a.GetConditionAt(b),c=d._GetFunc(),e=d.GetObjectClass();if(d.IsFastTrigger()){var g=this._fastTriggers.get(e);g||(g=new Map,this._fastTriggers.set(e,g));d=d.GetFastTriggerValue().toLowerCase();e=g.get(c);e||(e=new Map,g.set(c,e));c=e.get(d);c||(c=[],e.set(d,c));c.push([a,
b])}else g=this._triggers.get(e),g||(g={methodMap:new Map,behaviors:new Map},this._triggers.set(e,g)),(e=d.GetBehaviorType())?(d=g.behaviors.get(e),d||(d=new Map,g.behaviors.set(e,d))):d=g.methodMap,g=d.get(c),g||(g=[],d.set(c,g)),g.push([a,b])}_PostInit(){const a=this._events;for(let b=0,d=a.length;b<d;++b){const c=b<d-1&&a[b+1]instanceof C3$jscomp$159.EventBlock&&a[b+1].IsElseBlock();a[b]._PostInit(c)}}_AddShallowInclude(a){this._shallowIncludes.push(a)}_UpdateDeepIncludes(){C3$jscomp$159.clearArray(this._deepIncludes);
this._AddDeepIncludes(this);this._alreadyIncludedSheets.clear()}_AddDeepIncludes(a){const b=a._deepIncludes,d=a._alreadyIncludedSheets;for(const c of this._shallowIncludes){const e=c.GetIncludeSheet();c.IsActive()&&a!==e&&!d.has(e)&&(d.add(e),e._AddDeepIncludes(a),b.push(e))}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(a,b){this._eventsByDisplayNumber.set(b,
a)}_GetEventByDisplayNumber(a){return this._eventsByDisplayNumber.get(a)||null}_ResetHasRunFlag(){this._hasRun=!1}Run(){if(!this._hasRun){var a=this._runtime,b=a.IsCPUProfiling(),d=b?performance.now():0;this._hasRun=!0;var c=this.GetEventSheetManager(),e=c.GetCurrentEventStackFrame();for(const g of this._events)g.Run(e),c.ClearSol(g.GetSolModifiers()),c.ClearAsyncActionPromises(),a.FlushPendingInstances();e.Reset(null);b&&(this._perfRecord.totalTimeCounter+=performance.now()-d)}}*DebugRun(){if(!this._hasRun){this._hasRun=
!0;var a=this._runtime,b=this.GetEventSheetManager(),d=b.GetCurrentEventStackFrame();for(const c of this._events)yield*c.DebugRun(d),b.ClearSol(c.GetSolModifiers()),b.ClearAsyncActionPromises(),a.FlushPendingInstances();d.Reset(null)}}_Trigger(a,b,d){if(b){const c=b.GetObjectClass();this._TriggerForClass(a,b,c,d);for(const e of c.GetFamilies())this._TriggerForClass(a,b,e,d)}else return this._TriggerForClass(a,b,null,null)}_TriggerForClass(a,b,d,c){d=this._triggers.get(d);if(!d)return!1;c=c?d.behaviors.get(c):
d.methodMap;if(!c)return!1;c=c.get(a);if(!c)return!1;a=!1;for(const [e,g]of c)c=this._ExecuteTrigger(b,e,g),a=a||c;return a}*_DebugTrigger(a,b,d){if(b){const c=b.GetObjectClass();yield*this._DebugTriggerForClass(a,b,c,d);for(const e of c.GetFamilies())yield*this._DebugTriggerForClass(a,b,e,d)}else return yield*this._DebugTriggerForClass(a,b,null,null)}*_DebugTriggerForClass(a,b,d,c){d=this._triggers.get(d);if(!d)return!1;c=c?d.behaviors.get(c):d.methodMap;if(!c)return!1;c=c.get(a);if(!c)return!1;
a=!1;for(const [e,g]of c)c=e.DebugCanRunFast()?this._ExecuteTrigger(b,e,g):yield*this._DebugExecuteTrigger(b,e,g),a=a||c;return a}_FastTrigger(a,b,d){b=b.GetObjectClass();b=this._fastTriggers.get(b);if(!b)return!1;a=b.get(a);if(!a)return!1;d=a.get(d);if(!d)return!1;a=!1;for(let c=0,e=d.length;c<e;++c)b=d[c],b=this._ExecuteTrigger(null,b[0],b[1]),a=a||b;return a}*_DebugFastTrigger(a,b,d){b=b.GetObjectClass();b=this._fastTriggers.get(b);if(!b)return!1;a=b.get(a);if(!a)return!1;d=a.get(d);if(!d)return!1;
a=!1;for(let e=0,g=d.length;e<g;++e){var c=d[e];b=c[0];c=c[1];b=b.DebugCanRunFast()?this._ExecuteTrigger(null,b,c):yield*this._DebugExecuteTrigger(null,b,c);a=a||b}return a}_ExecuteTrigger(a,b,d){const c=this._runtime,e=this._eventSheetManager,g=e.GetCurrentEvent(),k=e.GetEventStack(),l=e.GetTriggerDepth();let n=!1;g&&e.PushCleanSol(g.GetSolModifiersIncludingParents());e.PushCleanSol(b.GetSolModifiersIncludingParents());const p=1<l;p&&e.GetLocalVarStack().Push();const r=k.Push(b);a&&(b.GetConditions()[d].GetObjectClass().GetCurrentSol().SetSinglePicked(a),
a.IsInContainer()&&a.SetSiblingsSinglePicked());a=!0;if(b.GetParent()){const w=b.GetTriggerParents();for(let z=0,B=w.length;z<B;++z)if(!w[z].RunPreTrigger(r)){a=!1;break}}a&&(b.IsOrBlock()?b.RunOrBlockTrigger(r,d):b.Run(r),n=r.GetLastEventTrue());k.Pop();p&&e.GetLocalVarStack().Pop();e.PopSol(b.GetSolModifiersIncludingParents());g&&e.PopSol(g.GetSolModifiersIncludingParents());g||1!==l||(e.ClearAsyncActionPromises(),e.IsFlushingBlocked()||c.FlushPendingInstances());return n}*_DebugExecuteTrigger(a,
b,d){const c=this._runtime,e=this._eventSheetManager,g=e.GetCurrentEvent(),k=e.GetEventStack(),l=e.GetTriggerDepth();let n=!1;g&&e.PushCleanSol(g.GetSolModifiersIncludingParents());e.PushCleanSol(b.GetSolModifiersIncludingParents());const p=1<l;p&&e.GetLocalVarStack().Push();const r=k.Push(b);a&&(b.GetConditions()[d].GetObjectClass().GetCurrentSol().SetSinglePicked(a),a.IsInContainer()&&a.SetSiblingsSinglePicked());a=!0;if(b.GetParent()){const w=b.GetTriggerParents();for(let z=0,B=w.length;z<B;++z)if(!(yield*w[z].DebugRunPreTrigger(r))){a=
!1;break}}a&&(b.IsOrBlock()?yield*b.DebugRunOrBlockTrigger(r,d):yield*b.DebugRun(r),n=r.GetLastEventTrue());k.Pop();p&&e.GetLocalVarStack().Pop();e.PopSol(b.GetSolModifiersIncludingParents());g&&e.PopSol(g.GetSolModifiersIncludingParents());g||1!==l||(e.ClearAsyncActionPromises(),e.IsFlushingBlocked()||c.FlushPendingInstances());return n}_GetPerfRecord(){return this._perfRecord}};"use strict";const C3$jscomp$160=self.C3,EMPTY_ARRAY=[];function NoActions(a,b){return!0}
function*DebugNoActions(a,b){return!0}
C3$jscomp$160.EventBlock=class extends C3$jscomp$160.DefendedBase{constructor(a,b,d){super();this._eventSheet=a;this._runtime=a.GetRuntime();this._parent=b;this._scopeParent=null;this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._solModifiers=[];this._solModifiersIncludingParents=[];this._hasElseBlock=this._isTopLevelGroup=this._isSolWriterAfterCnds=this._hasGotSolModifiersIncludingParents=!1;this._isOrBlock=!!d[2];this._isElseBlock=!1;this._triggerParents=null;this._conditions=
[];this._actions=[];this._subEvents=[];this._RunActions=NoActions;this._DebugRunActions=DebugNoActions;this._isInitiallyActive=this._isGroup=!1;this._groupName="";this._isGroupActive=!1;this._perfRecord=this._containedIncludes=null;this._sid=d[4];this._displayNumber=d[5];this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber);this._debugData=this._runtime.IsDebug()?{isBreakpoint:d[3][0],isBreakable:d[3][1],canRunAllConditionsFast:!1,canRunAllActionsFast:!1,canRunAllSubEventsFast:!1,
canRunSelfFast:!1}:null;this.GetEventSheetManager()._RegisterEventBlock(this);3===d[0]&&this._InitGroup(d[1]);a=0;for(var c of d[6])b=C3$jscomp$160.Condition.Create(this,c,a++),this._conditions.push(b),this._AddSolModifier(b.GetObjectClass());a=0;for(const e of d[7])c=C3$jscomp$160.Action.Create(this,e,a++),this._actions.push(c);if(9===d.length){d=d[8];for(const e of d)this._eventSheet._CreateEvent(e,this,this._subEvents)}this._conditions.length&&(this._isElseBlock=null===this._conditions[0].GetObjectClass()&&
this._conditions[0]._GetFunc()===C3$jscomp$160.Plugins.System.Cnds.Else);0===this._conditions.length&&(this._conditions=EMPTY_ARRAY);0===this._actions.length&&(this._actions=EMPTY_ARRAY);0===this._subEvents.length&&(this._subEvents=EMPTY_ARRAY)}static Create(a,b,d){return C3$jscomp$160.New(C3$jscomp$160.EventBlock,a,b,d)}_InitGroup(a){this._isGroup=!0;this._isGroupActive=this._isInitiallyActive=!!a[0];this._groupName=a[1].toLowerCase();this._containedIncludes=[];this.GetEventSheetManager()._RegisterGroup(this);
this._runtime.IsDebug()&&(this._perfRecord={type:"group",name:a[1],totalTimeCounter:0,children:[]})}_AddContainedInclude(a){this._containedIncludes.push(a)}_AddContainerSolModifierToList(a,b){for(const d of a.GetContainer().objectTypes())b.includes(d)||b.push(d)}_AddSolModifierToList(a,b){if(a)if(b.includes(a)||b.push(a),a.IsFamily())for(const d of a.GetFamilyMembers())d.IsInContainer()&&this._AddContainerSolModifierToList(d,b);else a.IsInContainer()&&this._AddContainerSolModifierToList(a,b)}_AddSolModifier(a){this._AddSolModifierToList(a,
this._solModifiers)}_AddParentSolModifier(a){this._AddSolModifierToList(a,this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(a){this._hasElseBlock=!!a;this._IdentifyTopLevelGroup();this._IdentifyTriggerParents();for(const d of this._conditions)d._PostInit();if(0<this._actions.length){a=!1;for(var b of this._actions)b._PostInit(),b.HasReturnType()&&(a=!0);a?(this._RunActions=this._RunActions_ReturnValue,this._DebugRunActions=this._DebugRunActions_ReturnValue):
(this._RunActions=this._RunActions_Fast,this._DebugRunActions=this._DebugRunActions_Fast)}b=this._subEvents;for(let d=0,c=b.length;d<c;++d)a=d<c-1&&b[d+1]instanceof C3$jscomp$160.EventBlock&&b[d+1].IsElseBlock(),b[d]._PostInit(a);this._debugData&&this._UpdateCanRunFast();this._perfRecord&&this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let a=this.GetParent();for(;a;){if(a.IsGroup())return a;a=a.GetParent()}return this._eventSheet}_UpdateCanRunFast(){const a=
this._debugData;a.canRunAllConditionsFast=this._conditions.every(b=>b.DebugCanRunFast());a.canRunAllActionsFast=this._actions.every(b=>b.DebugCanRunFast());a.canRunAllSubEventsFast=this._subEvents.every(b=>b.DebugCanRunFast());a.canRunSelfFast=a.canRunAllConditionsFast&&a.canRunAllActionsFast&&a.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let a=this;do a._UpdateCanRunFast(),a=a.GetParent();while(a)}_IdentifyTopLevelGroup(){if(this.IsGroup()){var a=this.GetParent();for(this._isTopLevelGroup=
!0;a;){if(!a.IsGroup()){this._isTopLevelGroup=!1;break}a=a.GetParent()}}}_IdentifySolModifiersIncludingParents(){var a=this._runtime.GetAllObjectClasses();if(this._solModifiers===a)this._solModifiersIncludingParents=a;else{this._solModifiersIncludingParents=C3$jscomp$160.cloneArray(this._solModifiers);for(a=this.GetParent();a;){for(var b of a._solModifiers)this._AddParentSolModifier(b);a=a.GetParent()}b=this.GetEventSheetManager();this._solModifiers=b._DeduplicateSolModifierList(this._solModifiers);
this._solModifiersIncludingParents=b._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(this.HasAnyTriggeredCondition()){this._triggerParents=[];for(var a=this.GetParent();a;)this._triggerParents.push(a),a=a.GetParent();this._triggerParents.reverse()}}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=!0;this._parent&&this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){this._hasGotSolModifiersIncludingParents||
(this._hasGotSolModifiersIncludingParents=!0,this._IdentifySolModifiersIncludingParents());return this._solModifiersIncludingParents}HasSolModifier(a){return this._solModifiers.includes(a)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(a){this._scopeParent=a}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&
this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(a){this._debugData.isBreakpoint=!!a;this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(a){a=
!!a;if(!this._isGroup)throw Error("not a group");if(this._isGroupActive!==a){this._isGroupActive=a;for(const b of this._containedIncludes)b.UpdateActive();this._containedIncludes.length&&(a=this._runtime.GetCurrentLayout().GetEventSheet())&&a._UpdateDeepIncludes()}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof C3$jscomp$160.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||
this._conditions.some(a=>a.IsTrigger())}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(a){a=Math.floor(a);if(0>a||a>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[a]}GetConditionByDebugIndex(a){return this.GetConditionAt(a)}IsFirstConditionOfType(a){let b=a.GetIndex();if(0===b)return!0;--b;for(a=a.IsSystemOrSingleGlobalCondition()?a.GetFirstObjectParameterObjectClass():a.GetObjectClass();0<=
b;--b){const d=this._conditions[b];if(a===d.GetObjectClass()||d.IsSystemOrSingleGlobalCondition()&&d.GetFirstObjectParameterObjectClass()===a)return!1}return!0}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(a){a=Math.floor(a);if(0>a||a>=this._actions.length)throw new RangeError("invalid action index");return this._actions[a]}GetActionByDebugIndex(a){a=Math.floor(a);const b=this._actions.find(d=>d.GetDebugIndex()===a);if(!b)throw new RangeError("invalid action debug index");
return b}_HasActionIndex(a){a=Math.floor(a);return 0<=a&&a<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter(a=>a instanceof C3$jscomp$160.EventVariable)}RunPreTrigger(a){a.SetCurrentEvent(this);const b=this._conditions;let d=0===b.length;for(let c=0,e=b.length;c<e;++c){const g=b[c];a.SetConditionIndex(c);if(g.IsLooping())throw Error("trigger cannot be used as sub-event to a loop");if(g.Run())d=!0;else if(!this._isOrBlock)return!1}return this._isOrBlock?
d:!0}RunOrBlockTrigger(a,b){a.SetCurrentEvent(this);a.SetConditionIndex(b);this._conditions[b].Run()&&(this._RunActions(a,0)&&this._RunSubEvents(a),a.SetLastEventTrue(!0))}*DebugRunPreTrigger(a){a.SetCurrentEvent(this);const b=this._conditions;let d=0===b.length;for(let c=0,e=b.length;c<e;++c){const g=b[c];a.SetConditionIndex(c);if(g.IsLooping())throw Error("trigger cannot be used as sub-event to a loop");if(g.DebugCanRunFast()?g.Run():yield*g.DebugRun())d=!0;else if(!this._isOrBlock)return!1}return this._isOrBlock?
d:!0}*DebugRunOrBlockTrigger(a,b){a.SetCurrentEvent(this);a.SetConditionIndex(b);b=this._conditions[b];if(b.DebugCanRunFast()?b.Run():yield*b.DebugRun())(this.DebugCanRunActionsFast()?this._RunActions(a,0):yield*this._DebugRunActions(a,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),a.SetLastEventTrue(!0)}Run(a){a.SetCurrentEvent(this);this._isElseBlock||a.SetElseBranchRan(!1);this._isOrBlock?this._RunOrBlock(a):this._RunAndBlock(a)}*DebugRun(a){if(this.IsDebugBreakpoint()||
this._runtime.DebugBreakNext())yield this;a.SetCurrentEvent(this);this._isElseBlock||a.SetElseBranchRan(!1);this._isOrBlock?yield*this._DebugRunOrBlock(a):yield*this._DebugRunAndBlock(a)}_RunOrBlock(a){const b=this._conditions;let d=0===b.length;for(let e=0,g=b.length;e<g;++e){var c=b[e];c.IsTrigger()||(a.SetConditionIndex(e),c=c.Run(),d=d||c)}a.SetLastEventTrue(d);d&&(this._RunActions(a,0)&&this._RunSubEvents(a),this._hasElseBlock&&a.SetElseBranchRan(!0))}*_DebugRunOrBlock(a){const b=this._conditions;
let d=0===b.length;for(let e=0,g=b.length;e<g;++e){var c=b[e];c.IsTrigger()||(a.SetConditionIndex(e),c=c.DebugCanRunFast()?c.Run():yield*c.DebugRun(),d=d||c)}a.SetLastEventTrue(d);d&&((this.DebugCanRunActionsFast()?this._RunActions(a,0):yield*this._DebugRunActions(a,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),this._hasElseBlock&&a.SetElseBranchRan(!0))}_RunAndBlock(a){const b=this._conditions;for(let d=0,c=b.length;d<c;++d){const e=b[d];a.SetConditionIndex(d);
if(!e.Run()){a.SetLastEventTrue(!1);return}}a.SetLastEventTrue(!0);this._RunActions(a,0)&&this._RunSubEvents(a);a.GetLastEventTrue()&&this._hasElseBlock&&a.SetElseBranchRan(!0)}*_DebugRunAndBlock(a){const b=this._conditions;for(let d=0,c=b.length;d<c;++d){const e=b[d];a.SetConditionIndex(d);if(e.DebugCanRunFast()?!e.Run():!(yield*e.DebugRun())){a.SetLastEventTrue(!1);return}}a.SetLastEventTrue(!0);(this.DebugCanRunActionsFast()?this._RunActions(a,0):yield*this._DebugRunActions(a,0))&&(this.DebugCanRunSubEventsFast()?
this._RunSubEvents():yield*this._DebugRunSubEvents());a.GetLastEventTrue()&&this._hasElseBlock&&a.SetElseBranchRan(!0)}_RunActions_Fast(a,b){const d=this._actions;for(let c=b,e=d.length;c<e;++c)b=d[c],a.SetActionIndex(c),b.Run();return!0}*_DebugRunActions_Fast(a,b){const d=this._actions;for(let c=b,e=d.length;c<e;++c)b=d[c],a.SetActionIndex(c),b.DebugCanRunFast()?b.Run():yield*b.DebugRun();return!0}_RunActions_ReturnValue(a,b){const d=this.GetEventSheetManager(),c=this._actions;for(let e=b,g=c.length;e<
g;++e){b=c[e];a.SetActionIndex(e);const k=b.Run();if(b.CanBailOut()&&!0===k)return!1;b.IsAsync()&&k instanceof Promise&&d.AddAsyncActionPromise(k)}return!0}*_DebugRunActions_ReturnValue(a,b){const d=this.GetEventSheetManager(),c=this._actions;for(let e=b,g=c.length;e<g;++e){b=c[e];a.SetActionIndex(e);let k;k=b.DebugCanRunFast()?b.Run():yield*b.DebugRun();if(b.CanBailOut()&&!0===k)return!1;b.IsAsync()&&k instanceof Promise&&d.AddAsyncActionPromise(k)}return!0}_ResumeActionsAndSubEvents(a){this._RunActions(a,
a.GetActionIndex())&&this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(a){if(yield*this._DebugRunActions(a,a.GetActionIndex()))yield*this._DebugRunSubEvents()}_RunSubEvents(){if(this._subEvents.length){var a=this.IsGroup()&&this._runtime.IsCPUProfiling(),b=a?performance.now():0,d=this._eventStack,c=d.Push(this);this._isSolWriterAfterCnds?this._RunSubEvents_SolWriterAfterCnds(c):this._RunSubEvents_Fast(c);d.Pop();a&&(this._perfRecord.totalTimeCounter+=performance.now()-b)}}_RunSubEvents_SolWriterAfterCnds(a){const b=
this._isGroup,d=this._isTopLevelGroup,c=this.GetEventSheetManager(),e=this._subEvents;for(let g=0,k=e.length,l=k-1;g<k;++g){const n=e[g],p=n.GetSolModifiers(),r=!d||!b&&g<l;r&&c.PushCopySol(p);n.Run(a);r?c.PopSol(p):c.ClearSol(p)}}_RunSubEvents_Fast(a){const b=this._subEvents;for(let d=0,c=b.length;d<c;++d)b[d].Run(a)}*_DebugRunSubEvents(){if(this._subEvents.length){var a=this._eventStack,b=a.Push(this);this._isSolWriterAfterCnds?yield*this._DebugRunSubEvents_SolWriterAfterCnds(b):yield*this._DebugRunSubEvents_Fast(b);
a.Pop()}}*_DebugRunSubEvents_SolWriterAfterCnds(a){const b=this._isGroup,d=this._isTopLevelGroup,c=this.GetEventSheetManager(),e=this._subEvents;for(let g=0,k=e.length,l=k-1;g<k;++g){const n=e[g],p=n.GetSolModifiers(),r=!d||!b&&g<l;r&&c.PushCopySol(p);yield*n.DebugRun(a);r?c.PopSol(p):c.ClearSol(p)}}*_DebugRunSubEvents_Fast(a){const b=this._subEvents;for(let d=0,c=b.length;d<c;++d)yield*b[d].DebugRun(a)}Retrigger(a,b){b.ResetQuick();const d=this._conditions;if(!this.IsOrBlock())for(let c=a.GetConditionIndex()+
1,e=d.length;c<e;++c)if(a=d[c],b.SetConditionIndex(c),!a.Run())return!1;this._RunActions(b,0)&&this._RunSubEvents(b);return!0}*DebugRetrigger(a,b){b.ResetQuick();const d=this._conditions;if(!this.IsOrBlock())for(let c=a.GetConditionIndex()+1,e=d.length;c<e;++c)if(a=d[c],b.SetConditionIndex(c),a.DebugCanRunFast()?!a.Run():!(yield*a.DebugRun()))return!1;(this.DebugCanRunActionsFast()?this._RunActions(b,0):yield*this._DebugRunActions(b,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents());
return!0}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(a){if(this.GetParent()){const b=this.GetTriggerParents();for(let d=0,c=b.length;d<c;++d)if(!b[d].RunPreTrigger(a))return!1}return!0}*_DebugCheckParentsOKToRun(a){if(this.GetParent()){const b=
this.GetTriggerParents();for(let d=0,c=b.length;d<c;++d)if(!(yield*b[d].DebugRunPreTrigger(a)))return!1}return!0}_EvaluateFunctionCallParameters(a,b,d){0<b.length?d?(b=b.map(c=>c.Get(0)),a.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(b)):this._scopeParent.EvaluateFunctionParameters(b):d&&a.GetLocalVarStack().Push()}RunAsFunctionCall(a,b,d,c){let e,g;const k=0<a.length;let l=null;const n=this._eventStack,p=this._runtime.GetEventSheetManager(),r=1<p._IncTriggerDepth();this._EvaluateFunctionCallParameters(p,
b,r);k&&(d?p.PushCopySol(a):p.PushCleanSol(a));if(null!==c){if(c.copyFromObjectClass){b=d?c.copyFromObjectClass.GetCurrentSol():c.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol();const w=c.copyToObjectClass.GetCurrentSol();w.SetArrayPicked(b.GetInstances());w.ClearElseInstances();d||c.copyToObjectClass.ApplySolToContainer()}else c.pickObjectClass&&(b=c.pickObjectClass.GetCurrentSol(),b.SetArrayPicked(c.pickInstances),b.ClearElseInstances());c.pushCleanSolDynamic&&(l=p.PushCleanSolDynamic(a))}c=
n.Push(this);d&&c.SetDynamicSolModifiers(a);this._CheckParentsOKToRun(c)&&(c.SetCurrentEvent(this),(d=this._scopeParent.IsAsync())&&([g,e]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(c),d&&this._scopeParent.MaybeFinishAsyncFunctionCall(g));n.Pop();r&&p.GetLocalVarStack().Pop();null!==l&&p.PopSol(l);k&&p.PopSol(a);p._DecTriggerDepth();return e}*DebugRunAsFunctionCall(a,b,d,c){let e,g;if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;const k=0<a.length;let l=null;
const n=this._eventStack,p=this._runtime.GetEventSheetManager(),r=1<p._IncTriggerDepth();this._EvaluateFunctionCallParameters(p,b,r);k&&(d?p.PushCopySol(a):p.PushCleanSol(a));if(null!==c){if(c.copyFromObjectClass){b=d?c.copyFromObjectClass.GetCurrentSol():c.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol();const w=c.copyToObjectClass.GetCurrentSol();w.SetArrayPicked(b.GetInstances());w.ClearElseInstances();d||c.copyToObjectClass.ApplySolToContainer()}else c.pickObjectClass&&(b=c.pickObjectClass.GetCurrentSol(),
b.SetArrayPicked(c.pickInstances),b.ClearElseInstances());c.pushCleanSolDynamic&&(l=p.PushCleanSolDynamic(a))}c=n.Push(this);d&&c.SetDynamicSolModifiers(a);if(yield*this._DebugCheckParentsOKToRun(c))c.SetCurrentEvent(this),(d=this._scopeParent.IsAsync())&&([g,e]=this._scopeParent.StartAsyncFunctionCall()),yield*this._DebugRunAndBlock(c),d&&this._scopeParent.MaybeFinishAsyncFunctionCall(g);n.Pop();r&&p.GetLocalVarStack().Pop();null!==l&&p.PopSol(l);k&&p.PopSol(a);p._DecTriggerDepth();return e}RunAsMappedFunctionCall(a,
b){const d=this.GetSolModifiersIncludingParents(),c=0<d.length,e=this._eventStack,g=this._runtime.GetEventSheetManager(),k=1<g._IncTriggerDepth();k&&g.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(a);c&&(b?g.PushCopySol(d):g.PushCleanSol(d));a=e.Push(this);this._CheckParentsOKToRun(a)&&(a.SetCurrentEvent(this),this._RunAndBlock(a));e.Pop();k&&g.GetLocalVarStack().Pop();c&&g.PopSol(d);g._DecTriggerDepth()}*DebugRunAsMappedFunctionCall(a,b){if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;
const d=this.GetSolModifiersIncludingParents(),c=0<d.length,e=this._eventStack,g=this._runtime.GetEventSheetManager(),k=1<g._IncTriggerDepth();k&&g.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(a);c&&(b?g.PushCopySol(d):g.PushCleanSol(d));a=e.Push(this);if(yield*this._DebugCheckParentsOKToRun(a))a.SetCurrentEvent(this),yield*this._DebugRunAndBlock(a);e.Pop();k&&g.GetLocalVarStack().Pop();c&&g.PopSol(d);g._DecTriggerDepth()}RunAsExpressionFunctionCall(a,b,d,c,...e){let g,k;const l=
0<a.length,n=this._runtime,p=this._eventStack,r=n.GetEventSheetManager(),w=1<r._IncTriggerDepth();w&&r.GetLocalVarStack().Push();0<e.length&&this._scopeParent.SetFunctionParameters(e);l&&(b?r.PushCopySol(a):r.PushCleanSol(a));b=p.Push(this);b.InitCallFunctionExpression(d,c);p.PushExpFunc(b);n.SetDebuggingEnabled(!1);this._CheckParentsOKToRun(b)&&(b.SetCurrentEvent(this),(d=this._scopeParent.IsAsync())&&([k,g]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(b),d&&this._scopeParent.MaybeFinishAsyncFunctionCall(k));
n.SetDebuggingEnabled(!0);p.Pop();p.PopExpFunc();w&&r.GetLocalVarStack().Pop();l&&r.PopSol(a);r._DecTriggerDepth();return g||b.GetFunctionReturnValue()}};"use strict";const C3$jscomp$161=self.C3,EMPTY_SOL_MODIFIERS=[];let hadUserScriptException=!1;
C3$jscomp$161.EventScript=class extends C3$jscomp$161.DefendedBase{constructor(a,b,d){super();const c=a.GetRuntime(),e=a.GetEventSheetManager();this._eventSheet=a;this._eventSheetManager=e;this._runtime=a.GetRuntime();this._parent=b;this._func=c.GetObjectReference(d[1]);this._displayNumber=d[2];this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber);this._debugData=c.IsDebug()?{isBreakpoint:d[3][0],isBreakable:d[3][1]}:null}static Create(a,b,d){return C3$jscomp$161.New(C3$jscomp$161.EventScript,
a,b,d)}_PostInit(){const a=this._func,b=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=a.bind(null,this._runtime.GetIRuntime(),b)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(a){this._debugData.isBreakpoint=
!!a}IsElseBlock(){return!1}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetSolModifiersIncludingParents(){return this._parent?this._parent.GetSolModifiersIncludingParents():EMPTY_SOL_MODIFIERS}Run(a){a.SetCurrentEvent(this);this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(a){console.error(`Unhandled exception running script %c${this.GetEventSheet().GetName()}, event ${this.GetDisplayNumber()}:`,"font-size: 1.2em; font-weight: bold;",
a),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),hadUserScriptException||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),hadUserScriptException=!0)}}*DebugRun(a){a.SetCurrentEvent(this);if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;this.Run(a)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()}static HadUserScriptException(){return hadUserScriptException}static SetHadUserScriptException(){hadUserScriptException=
!0}};"use strict";const C3$jscomp$162=self.C3;
C3$jscomp$162.FunctionBlock=class extends C3$jscomp$162.DefendedBase{constructor(a,b,d){super();this._eventSheet=a;this._runtime=a.GetRuntime();this._parent=b;this._functionType=0;this._functionName="";this._returnType=0;this._functionParameters=[];this._isEnabled=!0;this._aceName="";this._objectClass=null;this._hasOverrides=!1;this._innerLocalVariables=[];this._isAsync=this._isCopyPicked=!1;this._nextAsyncId=0;this._currentAsyncId=-1;this._asyncMap=new Map;this._eventBlock=C3$jscomp$162.EventBlock.Create(a,
b,d);this._eventBlock._SetScopeParent(this)}InitFunctionBlock(a){this._functionType=0;this._functionName=a[0];this._returnType=a[1];this._functionParameters=a[2].map(b=>C3$jscomp$162.EventVariable.Create(this._eventSheet,this,b));this._isEnabled=a[3];this._isAsync=a[4];this._isCopyPicked=a[5]}InitCustomACEBlock(a){this._functionType=1;this._aceName=a[1];this._objectClass=this._runtime.GetObjectClassByIndex(a[2]);this._eventBlock._AddSolModifier(this._objectClass);this._functionName=this._objectClass.GetName()+
"."+this._aceName;this._returnType=a[3];this._functionParameters=a[4].map(b=>C3$jscomp$162.EventVariable.Create(this._eventSheet,this,b));this._isEnabled=a[5];this._isAsync=a[6];this._isCopyPicked=a[7];this._objectClass.AddCustomAction(this)}static CreateFunctionBlock(a,b,d){a=C3$jscomp$162.New(C3$jscomp$162.FunctionBlock,a,b,d);a.InitFunctionBlock(d[1]);return a}static CreateCustomACEBlock(a,b,d){a=C3$jscomp$162.New(C3$jscomp$162.FunctionBlock,a,b,d);a.InitCustomACEBlock(d[1]);return a}_CheckOverrideState(){if(this._objectClass&&
this._objectClass.IsFamily())for(const a of this._objectClass.GetFamilyMembers())if(a.HasOwnCustomActionByName(this._aceName)){this._hasOverrides=!0;break}}_PostInit(){for(const a of this._functionParameters)a._PostInit();this._eventBlock._PostInit(!1)}GetFunctionType(){return this._functionType}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(a){this._innerLocalVariables.push(a)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(a){const b=
this._functionParameters;for(let d=0,c=b.length;d<c;++d)b[d].SetValue(a[d].Get(0))}SetFunctionParameters(a){const b=this._functionParameters;for(let d=0,c=b.length;d<c;++d)b[d].SetValue(a[d])}CaptureFunctionParameters(){return this._functionParameters.map(a=>a.GetValue())}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetACEName(){return this._aceName}HasCustomACEOverrides(){return this._hasOverrides}GetReturnType(){return this._returnType}GetObjectClass(){return this._objectClass}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;
case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsCopyPicked(){return this._isCopyPicked}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){const a=this._nextAsyncId++;this._currentAsyncId=a;let b;const d=new Promise(c=>b=c);this._asyncMap.set(a,{resolve:b,pauseCount:0});return[a,d]}MaybeFinishAsyncFunctionCall(a){const b=this._asyncMap.get(a);0===b.pauseCount&&(b.resolve(),this._asyncMap.delete(a));this._currentAsyncId=-1}PauseCurrentAsyncFunction(){this._asyncMap.get(this._currentAsyncId).pauseCount++;
return this._currentAsyncId}ResumeAsyncFunction(a){this._currentAsyncId=a;this._asyncMap.get(a).pauseCount--}RunAsFamilyCustomActionWithOverrides(a,b){var d=new Map,c=[];for(const e of this._objectClass.GetCurrentSol().GetInstances()){const g=e.GetObjectClass();if(g.HasOwnCustomActionByName(this._aceName)){const k=d.get(g);Array.isArray(k)?k.push(e):d.set(g,[e])}else c.push(e)}0<c.length&&this._eventBlock.RunAsFunctionCall(a,b,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:c});
if(0<d.size)for(const [e,g]of d)d=e.GetOwnCustomActionByName(this._aceName).GetEventBlock(),c=[...(new Set([...a,...d.GetSolModifiers()]))],d.RunAsFunctionCall(c,b,this._isCopyPicked,{pickObjectClass:e,pickInstances:g})}*DebugRunAsFamilyCustomActionWithOverrides(a,b){var d=new Map,c=[];for(const e of this._objectClass.GetCurrentSol().GetInstances()){const g=e.GetObjectClass();if(g.HasOwnCustomActionByName(this._aceName)){const k=d.get(g);Array.isArray(k)?k.push(e):d.set(g,[e])}else c.push(e)}0<c.length&&
(yield*this._eventBlock.DebugRunAsFunctionCall(a,b,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:c}));if(0<d.size)for(const [e,g]of d)d=e.GetOwnCustomActionByName(this._aceName).GetEventBlock(),c=[...(new Set([...a,...d.GetSolModifiers()]))],yield*d.DebugRunAsFunctionCall(c,b,this._isCopyPicked,{pickObjectClass:e,pickInstances:g})}};"use strict";const C3$jscomp$163=self.C3,EMPTY_SOL_MODIFIERS$jscomp$1=[];
C3$jscomp$163.EventVariable=class extends C3$jscomp$163.DefendedBase{constructor(a,b,d){super();const c=a.GetEventSheetManager();this._eventSheet=a;this._eventSheetManager=c;this._runtime=a.GetRuntime();this._parent=b;this._localVarStack=c.GetLocalVarStack();this._name=d[1];this._type=d[2];this._initialValue=d[3];this._isStatic=!!d[4];this._isConstant=!!d[5];this._isFunctionParameter=b instanceof C3$jscomp$163.FunctionBlock;this._sid=d[6];this._jsPropName=this._runtime.GetJsPropName(d[8]);this._scriptSetter=
e=>this.SetValue(e);this._scriptGetter=()=>this.GetValue();this._hasSingleValue=!this._parent||this._isStatic||this._isConstant;this._value=this._initialValue;this._localIndex=-1;this.IsBoolean()&&(this._value=this._value?1:0);!this.IsLocal()||this.IsStatic()||this.IsConstant()||(this._localIndex=c._GetNextLocalVarIndex(this));c._RegisterEventVariable(this)}static Create(a,b,d){return C3$jscomp$163.New(C3$jscomp$163.EventVariable,a,b,d)}_PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&
!this.IsFunctionParameter()){const a=this._eventSheetManager.FindFirstFunctionBlockParent(this);a&&a._RegisterLocalVariable(this)}}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return 0===this._type}IsString(){return 1===
this._type}IsBoolean(){return 2===this._type}IsElseBlock(){return!1}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return EMPTY_SOL_MODIFIERS$jscomp$1}Run(a){!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return!0}*DebugRun(a){this.Run(a)}SetValue(a){this.IsNumber()?"number"!==typeof a&&(a=parseFloat(a)):this.IsString()?"string"!==typeof a&&(a=a.toString()):this.IsBoolean()&&(a=a?1:0);this._hasSingleValue?
this._value=a:this._localVarStack.GetCurrent()[this._localIndex]=a}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let a=this.GetValue();this.IsBoolean()&&(a=!!a);return a}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:!1,enumerable:!0,get:this._scriptGetter,set:this._scriptSetter}}};"use strict";const C3$jscomp$164=self.C3,EMPTY_SOL_MODIFIERS$jscomp$2=[];
C3$jscomp$164.EventInclude=class extends C3$jscomp$164.DefendedBase{constructor(a,b,d){super();const c=a.GetEventSheetManager();this._eventSheet=a;this._eventSheetManager=c;this._runtime=a.GetRuntime();this._parent=b;this._includeSheet=null;this._includeSheetName=d[1];this._isActive=!0}static Create(a,b,d){return C3$jscomp$164.New(C3$jscomp$164.EventInclude,a,b,d)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName);this._eventSheet._AddShallowInclude(this);
let a=this.GetParent();for(;a;)a instanceof C3$jscomp$164.EventBlock&&a.IsGroup()&&a._AddContainedInclude(this),a=a.GetParent();this.UpdateActive();this._runtime.IsDebug()&&this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return EMPTY_SOL_MODIFIERS$jscomp$2}GetIncludeSheet(){return this._includeSheet}Run(a){a=!!this.GetParent();const b=this._runtime.GetAllObjectClasses();a&&this._eventSheetManager.PushCleanSol(b);
this._includeSheet.Run();a&&this._eventSheetManager.PopSol(b)}*DebugRun(a){a=!!this.GetParent();const b=this._runtime.GetAllObjectClasses();a&&this._eventSheetManager.PushCleanSol(b);yield*this._includeSheet.DebugRun();a&&this._eventSheetManager.PopSol(b)}DebugCanRunFast(){return!1}IsActive(){return this._isActive}UpdateActive(){let a=this.GetParent();for(;a;){if(a instanceof C3$jscomp$164.EventBlock&&a.IsGroup()&&!a.IsGroupActive()){this._isActive=!1;return}a=a.GetParent()}this._isActive=!0}};"use strict";
const C3$jscomp$165=self.C3;C3$jscomp$165.ExpNode=class extends C3$jscomp$165.DefendedBase{constructor(a){super();this._owner=a;this._runtime=a.GetRuntime()}_PostInit(){}static CreateNode(a,b){return C3$jscomp$165.New([BehaviorExpressionNode,ObjectExpressionNode,InstVarExpressionNode,EventVarExpNode,SystemExpressionExpNode,CallFunctionExpressionExpNode][b[0]],a,b)}};
class SystemExpressionExpNode extends C3$jscomp$165.ExpNode{constructor(a,b){super(a);this._systemPlugin=this._runtime.GetSystemPlugin();this._func=this._runtime.GetObjectReference(b[1]);this._func!==C3$jscomp$165.Plugins.System.Exps.random&&this._func!==C3$jscomp$165.Plugins.System.Exps.choose||this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}
class CallFunctionExpressionExpNode extends C3$jscomp$165.ExpNode{constructor(a,b){super(a);this._functionBlock=null;this._functionName=b[1];this._owner.SetVariesPerInstance()}_PostInit(){const a=this._runtime.GetEventSheetManager();this._functionBlock=a.GetFunctionBlockByName(this._functionName);this._functionName=null;const b=this._owner.GetEventBlock(),d=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...(new Set([...b.GetSolModifiersIncludingParents(),...d.GetSolModifiersIncludingParents()]))];
this._combinedSolModifiers=a._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){const a=this._functionBlock;if(a.IsEnabled()){const d=a.GetEventBlock();return C3$jscomp$165.EventBlock.prototype.RunAsExpressionFunctionCall.bind(d,this._combinedSolModifiers,a.IsCopyPicked(),a.GetReturnType(),a.GetDefaultReturnValue())}const b=a.GetDefaultReturnValue();return()=>b}}function WrapIndex(a,b){if(a>=b)return a%b;0>a&&(a<=-b&&(a%=b),0>a&&(a+=b));return a}
class ObjectExpressionNode extends C3$jscomp$165.ExpNode{constructor(a,b){super(a);this._objectClass=this._runtime.GetObjectClassByIndex(b[1]);this._func=this._runtime.GetObjectReference(b[2]);this._returnsString=!!b[3];this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...a){const b=
this._objectClass,d=b.GetCurrentSol().GetExpressionInstances();var c=d.length;if(0===c)return this._returnsString?"":0;c=WrapIndex(this._owner.GetSolIndex(),c);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(b);return this._func.apply(d[c].GetSdkInstance(),a)}ExpObject_InstExpr(a,...b){const d=this._objectClass,c=d.GetInstances(),e=c.length;if(0===e)return this._returnsString?"":0;a=WrapIndex(a,e);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(d);return this._func.apply(c[a].GetSdkInstance(),
b)}}
class InstVarExpressionNode extends C3$jscomp$165.ExpNode{constructor(a,b){super(a);this._objectClass=this._runtime.GetObjectClassByIndex(b[1]);this._varIndex=b[3];this._returnsString=!!b[2];this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){const a=this._objectClass.GetCurrentSol().GetExpressionInstances();var b=a.length;if(0===b)return this._returnsString?"":0;b=WrapIndex(this._owner.GetSolIndex(),b);return a[b]._GetInstanceVariableValueUnchecked(this._varIndex)}ExpInstVar_Family(){var a=this._objectClass,
b=a.GetCurrentSol().GetExpressionInstances(),d=b.length;if(0===d)return this._returnsString?"":0;d=WrapIndex(this._owner.GetSolIndex(),d);b=b[d];a=b.GetObjectClass().GetFamilyInstanceVariableOffset(a.GetFamilyIndex());return b._GetInstanceVariableValueUnchecked(this._varIndex+a)}ExpInstVar_InstExpr(a){const b=this._objectClass;var d=b.GetInstances();const c=d.length;if(0===c)return this._returnsString?"":0;a=WrapIndex(a,c);d=d[a];a=0;b.IsFamily()&&(a=d.GetObjectClass().GetFamilyInstanceVariableOffset(b.GetFamilyIndex()));
return d._GetInstanceVariableValueUnchecked(this._varIndex+a)}}
class BehaviorExpressionNode extends C3$jscomp$165.ExpNode{constructor(a,b){super(a);this._objectClass=this._runtime.GetObjectClassByIndex(b[1]);this._behaviorType=this._objectClass.GetBehaviorTypeByName(b[2]);this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(b[2]);this._func=this._runtime.GetObjectReference(b[3]);this._returnsString=!!b[4];this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...a){const b=this._objectClass;
var d=b.GetCurrentSol().GetExpressionInstances(),c=d.length;if(0===c)return this._returnsString?"":0;c=WrapIndex(this._owner.GetSolIndex(),c);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(b);d=d[c];c=0;b.IsFamily()&&(c=d.GetObjectClass().GetFamilyBehaviorOffset(b.GetFamilyIndex()));return this._func.apply(d.GetBehaviorInstances()[this._behaviorIndex+c].GetSdkInstance(),a)}ExpBehavior_InstExpr(a,...b){const d=this._objectClass;var c=d.GetInstances();const e=c.length;if(0===e)return this._returnsString?
"":0;a=WrapIndex(a,e);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(d);c=c[a];a=0;d.IsFamily()&&(a=c.GetObjectClass().GetFamilyBehaviorOffset(d.GetFamilyIndex()));return this._func.apply(c.GetBehaviorInstances()[this._behaviorIndex+a].GetSdkInstance(),b)}}
class EventVarExpNode extends C3$jscomp$165.ExpNode{constructor(a,b){super(a);this._eventVar=null;this._eventVarSid=b[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}}"use strict";const C3$jscomp$166=self.C3;
C3$jscomp$166.Parameter=class extends C3$jscomp$166.DefendedBase{constructor(a,b,d){super();this._owner=a;this._index=d;this._type=b;this.Get=null;this._isConstant=this._variesPerInstance=!1}static Create(a,b,d){const c=b[0];return C3$jscomp$166.New([ExpressionParameter,StringExpressionParameter,FileParameter,ComboParameter,ObjectParameter,LayerExpressionParameter,LayoutParameter,ExpressionParameter,ComboParameter,ComboParameter,InstVarParameter,EventVarParameter,FileParameter,VariadicParameter,StringExpressionParameter,
TimelineParameter,BooleanParameter,FunctionParameter,EaseParameter,TilemapBrushParameter,TemplateExpressionParameter,FlowchartParameter][c],a,c,d,b)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=!0}_MaybeVaryFor(a){this._variesPerInstance||!a||a.GetPlugin().IsSingleGlobal()||(this._variesPerInstance=!0)}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}IsObjectParameter(){return 4===
this._type}};function GetExpressionFunc(a){a=self.C3_ExpressionFuncs[a];if(!a)throw Error("invalid expression number");return a}
class ExpressionParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._solIndex=0;a=c[1];this._expressionNumber=a[0];this._numberedNodes=[];this._expressionFunc=null;for(let e=1,g=a.length;e<g;++e)this._numberedNodes.push(C3$jscomp$166.ExpNode.CreateNode(this,a[e]));this._numberedNodes.length?this.Get=this.GetExpression:(this.Get=GetExpressionFunc(this._expressionNumber),this._isConstant=!0)}_GetNode(a){if(0>a||a>=this._numberedNodes.length)throw new RangeError("invalid numbered node");
return this._numberedNodes[a]}_PostInit(){for(var a of this._numberedNodes)a._PostInit();a=GetExpressionFunc(this._expressionNumber);this._expressionFunc=this._numberedNodes.length?a(this):a}GetSolIndex(){return this._solIndex}GetExpression(a){this._solIndex=a;return this._expressionFunc()}}
class StringExpressionParameter extends ExpressionParameter{constructor(a,b,d,c){super(a,b,d,c);this.Get=this.GetStringExpression;14===b&&(this.GetEventBlock().SetAllSolModifiers(),this._owner instanceof C3$jscomp$166.Action&&this.GetEventBlock().SetSolWriterAfterCnds())}GetStringExpression(a){this._solIndex=a;a=this._expressionFunc();return"string"===typeof a?a:""}_GetFastTriggerValue(){return GetExpressionFunc(this._expressionNumber)()}}
class LayerExpressionParameter extends ExpressionParameter{constructor(a,b,d,c){super(a,b,d,c);2<=a.GetImplementationSdkVersion()?this.Get=this.GetILayer:this.Get=this.GetLayer;this._isConstant=!1}GetLayer(a){this._solIndex=a;a=this._expressionFunc();return this.GetRuntime().GetCurrentLayout().GetLayer(a)}GetILayer(a){return(a=this.GetLayer())?a.GetILayer():null}}
class ComboParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._combo=c[1];this.Get=this.GetCombo;this._isConstant=!0}GetCombo(){return this._combo}}class BooleanParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._bool=c[1];this.Get=this.GetBoolean;this._isConstant=!0}GetBoolean(){return this._bool}}
class ObjectParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._objectClass=this.GetRuntime().GetObjectClassByIndex(c[1]);2<=a.GetImplementationSdkVersion()?this.Get=this.GetIObjectClass:this.Get=this.GetObjectClass;a=this.GetEventBlock();a._AddSolModifier(this._objectClass);this._owner instanceof C3$jscomp$166.Action?a.SetSolWriterAfterCnds():a.GetParent()&&a.GetParent().SetSolWriterAfterCnds();this._isConstant=!0}GetObjectClass(){return this._objectClass}GetIObjectClass(){return this._objectClass?
this._objectClass.GetIObjectClass():null}}class LayoutParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(c[1]);2<=a.GetImplementationSdkVersion()?this.Get=this.GetILayout:this.Get=this.GetLayout;this._isConstant=!0}GetLayout(){return this._layout}GetILayout(){return this._layout?this._layout.GetILayout():null}}
class TimelineParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(c[1]);2<=a.GetImplementationSdkVersion()?this.Get=this.GetITimelineState:this.Get=this.GetTimeline;this._isConstant=!0}GetTimeline(){return this._timeline}GetITimelineState(){return this._timeline?this._timeline.GetITimelineState():null}}
class FileParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._fileInfo=c[1];this.Get=this.GetFile;this._isConstant=!0}GetFile(){return this._fileInfo}}
class InstVarParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._instVarIndex=c[1];a=this._owner.GetObjectClass();this._owner instanceof C3$jscomp$166.Condition&&this._owner.IsStatic()?(this.Get=this.GetInstanceVariable,this._isConstant=!0):a&&a.IsFamily()?(this.Get=this.GetFamilyInstanceVariable,this.SetVariesPerInstance()):(this.Get=this.GetInstanceVariable,this._isConstant=!0)}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(a){a=a||0;const b=
this._owner.GetObjectClass();var d=b.GetCurrentSol();const c=d.GetInstances();if(c.length)a=c[a%c.length].GetObjectClass();else if(d.HasAnyElseInstances())d=d.GetElseInstances(),a=d[a%d.length].GetObjectClass();else if(0<b.GetInstanceCount())d=b.GetInstances(),a=d[a%d.length].GetObjectClass();else return 0;return this._instVarIndex+a.GetFamilyInstanceVariableOffset(b.GetFamilyIndex())}}
class EventVarParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._eventVarSid=c[1];this._eventVar=null;2<=a.GetImplementationSdkVersion()?this.Get=this.GetIEventVariable:this.Get=this.GetEventVariable;this._isConstant=!0}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}GetIEventVariable(){return null}}
class FunctionParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._functionBlockName=c[1];this._functionBlock=null;2<=a.GetImplementationSdkVersion()?this.Get=this.GetIFunction:this.Get=this.GetFunction;this._isConstant=!0}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName);this._functionBlockName=null}GetFunction(){return this._functionBlock}GetIFunction(){return null}}
class VariadicParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._subParams=[];this._variadicRet=[];this._isConstant=!0;for(let e=1,g=c.length;e<g;++e)a=C3$jscomp$166.Parameter.Create(this._owner,c[e],0),this._subParams.push(a),this._variadicRet.push(0),a.IsConstant()||(this._isConstant=!1);this.Get=this.GetVariadic}_PostInit(){for(const a of this._subParams)a._PostInit()}GetVariadic(){const a=this._subParams,b=this._variadicRet;for(let d=0,c=a.length;d<c;++d)b[d]=a[d].Get(0);
return b}}class EaseParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._easeIndex=c[1];this.Get=this.GetEase;this._isConstant=!0}GetEase(){return this._easeIndex}}class TilemapBrushParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._brushIndex=c[1];this.Get=this.GetTilemapBrush;this._isConstant=!0}GetTilemapBrush(){return this._brushIndex}}
class TemplateExpressionParameter extends ExpressionParameter{constructor(a,b,d,c){super(a,b,d,c);this.Get=this.GetTemplateName;this._isConstant=!1}GetTemplateName(){return this._expressionFunc()}}class FlowchartParameter extends C3$jscomp$166.Parameter{constructor(a,b,d,c){super(a,b,d);this._flowchartDataItem=this.GetRuntime().GetFlowchartManager().GetFlowchartDataItemByName(c[1]);this.Get=this.GetFlowchartName;this._isConstant=!0}GetFlowchartName(){return this._flowchartDataItem.GetName()}}"use strict";
const C3$jscomp$167=self.C3;function EvalParams(a,b){for(let d=0,c=a.length;d<c;++d)b[d]=a[d].Get(0)}const EMPTY_PARAMS_ARRAY=[],noop$jscomp$1=function(){};
C3$jscomp$167.Condition=class extends C3$jscomp$167.DefendedBase{constructor(a,b,d){super();this._eventBlock=a;this._runtime=a.GetRuntime();this._index=d;this._func=this._runtime.GetObjectReference(b[1]);this._isTrigger=0<b[3];this._isFastTrigger=2===b[3];this._isLooping=!!b[4];this._isInverted=!!b[5];this._isStatic=!!b[6];this._sid=b[7];this._isInOrBlock=this._eventBlock.IsOrBlock();this._behaviorType=this._objectClass=null;this._behaviorIndex=-1;this._systemPlugin=null;this.DebugRun=this.Run=noop$jscomp$1;
this._parameters=[];this._results=[];this._anyParamVariesPerInstance=!1;this._unsavedData=this._savedData=null;this._debugData=this._runtime.IsDebug()?{isBreakpoint:b[8][0],canDebug:b[8][1]}:null;-1===b[0]?this._systemPlugin=this._runtime.GetSystemPlugin():(this._objectClass=this._runtime.GetObjectClassByIndex(b[0]),b[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(b[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(b[2])),this._eventBlock.GetParent()&&this._eventBlock.GetParent().SetSolWriterAfterCnds());
if(10===b.length){a=b[9];for(let c of a)this._parameters.push(C3$jscomp$167.Parameter.Create(this,c,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._results=this._parameters=EMPTY_PARAMS_ARRAY);this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(a,b,d){return C3$jscomp$167.New(C3$jscomp$167.Condition,a,b,d)}_PostInit(){for(const a of this._parameters)a._PostInit(),a.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);this._isFastTrigger?
(this.Run=this._RunFastTrigger,this.DebugRun=this._DebugRunFastTrigger):this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this._isStatic?(this.Run=this._RunStatic,this.DebugRun=this._DebugRunStatic):(this.Run=this._RunObject,this.DebugRun=this._DebugRunObject)}_SetSystemRunMethod(){this._SetRunMethodForBoundFunc(this._systemPlugin,this._systemPlugin,
this._RunSystem)}_SetSingleGlobalRunMethod(){const a=this._objectClass.GetPlugin(),b=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(a,b,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(a,b,d){const c=this._func,e=this._isInverted,g=this._parameters;if(0===g.length){const k=a._GetBoundACEMethod(c,b);this.Run=e?function(){return C3$jscomp$167.xor(k(),e)}:k}else if(1===g.length){const k=g[0];if(!e&&k.IsConstant())this.Run=a._GetBoundACEMethod_1param(c,b,k.Get(0));
else{const l=a._GetBoundACEMethod(c,b);this.Run=function(){return C3$jscomp$167.xor(l(k.Get(0)),e)}}}else if(2===g.length){const k=g[0],l=g[1];if(!e&&k.IsConstant()&&l.IsConstant())this.Run=a._GetBoundACEMethod_2params(c,b,k.Get(0),l.Get(0));else{const n=a._GetBoundACEMethod(c,b);this.Run=function(){return C3$jscomp$167.xor(n(k.Get(0),l.Get(0)),e)}}}else if(3===g.length){const k=g[0],l=g[1],n=g[2];if(!e&&k.IsConstant()&&l.IsConstant()&&n.IsConstant())this.Run=a._GetBoundACEMethod_3params(c,b,k.Get(0),
l.Get(0),n.Get(0));else{const p=a._GetBoundACEMethod(c,b);this.Run=function(){return C3$jscomp$167.xor(p(k.Get(0),l.Get(0),n.Get(0)),e)}}}else this.Run=d}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetImplementationAddon(){return this._behaviorType?this._behaviorType.GetBehavior():this._objectClass?this._objectClass.GetPlugin():null}GetImplementationSdkVersion(){const a=this.GetImplementationAddon();return a?
a.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsStatic(){return this._isStatic}IsBreakpoint(){return this._debugData.isBreakpoint}IsSystemCondition(){return!!this._systemPlugin}IsSystemOrSingleGlobalCondition(){return this.IsSystemCondition()||
this._objectClass.GetPlugin().IsSingleGlobal()}GetFirstObjectParameterObjectClass(){for(const a of this._parameters)if(a.IsObjectParameter())return a.GetObjectClass();return null}_SetBreakpoint(a){this._debugData.isBreakpoint=!!a;this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){this._savedData||(this._savedData=new Map);
return this._savedData}GetUnsavedDataMap(){this._unsavedData||(this._unsavedData=new Map);return this._unsavedData}_RunSystem(){const a=this._results;EvalParams(this._parameters,a);return C3$jscomp$167.xor(this._func.apply(this._systemPlugin,a),this._isInverted)}*_DebugRunSystem(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){var a=this._results;EvalParams(this._parameters,a);a=this._func.apply(this._systemPlugin,a);C3$jscomp$167.IsIterator(a)&&
(a=yield*a);return C3$jscomp$167.xor(a,this._isInverted)}return this.Run()}_RunSingleGlobal(){const a=this._results;EvalParams(this._parameters,a);const b=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return C3$jscomp$167.xor(this._func.apply(b,a),this._isInverted)}*_DebugRunSingleGlobal(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){var a=this._results;EvalParams(this._parameters,a);const b=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();
a=this._func.apply(b,a);C3$jscomp$167.IsIterator(a)&&(a=yield*a);return C3$jscomp$167.xor(a,this._isInverted)}return this.Run()}_RunFastTrigger(){return!0}*_DebugRunFastTrigger(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;return!0}_GetStaticConditionThis(){if(this._behaviorType){if(2<=this._behaviorType.GetBehavior().GetSdkVersion())throw Error("not yet implemented");return this._behaviorType}return 2<=this._objectClass.GetPlugin().GetSdkVersion()?this._objectClass.GetIObjectClass():
this._objectClass}_RunStatic(){var a=this._results;EvalParams(this._parameters,a);a=this._func.apply(this._GetStaticConditionThis(),a);this._objectClass.ApplySolToContainer();return a}*_DebugRunStatic(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){var a=this._results;EvalParams(this._parameters,a);a=this._func.apply(this._GetStaticConditionThis(),a);C3$jscomp$167.IsIterator(a)&&(a=yield*a);this._objectClass.ApplySolToContainer();return a}return this.Run()}_RunObject(){const a=
this._parameters,b=this._results,d=this._objectClass.GetCurrentSol();for(let c=0,e=a.length;c<e;++c){const g=a[c];g.VariesPerInstance()||(b[c]=g.Get(0))}return d.IsSelectAll()?this._RunObject_FirstFilter(d):this._RunObject_NextFilter(d)}*_DebugRunObject(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;return this._RunObject()}_EvaluateVaryingParameters(a){const b=this._parameters,d=this._results;for(let c=0,e=b.length;c<e;++c){const g=b[c];g.VariesPerInstance()&&(d[c]=g.Get(a))}}_RunObject_FirstFilter(a){const b=
this._objectClass,d=b.IsFamily(),c=b.GetFamilyIndex(),e=this._behaviorIndex,g=0<=e,k=b.GetInstances(),l=this._anyParamVariesPerInstance,n=this._results,p=this._func,r=this._isInverted,w=this._isInOrBlock&&!this._isTrigger;a.ClearArrays();for(let B=0,C=k.length;B<C;++B){const E=k[B];l&&this._EvaluateVaryingParameters(B);var z=void 0;g?(z=d?E.GetObjectClass().GetFamilyBehaviorOffset(c):0,z=p.apply(E.GetBehaviorInstances()[e+z].GetSdkInstance(),n)):z=p.apply(E.GetSdkInstance(),n);C3$jscomp$167.xor(z,
r)?a._PushInstance(E):w&&a._PushElseInstance(E)}b.FinishCondition(!0);a._SetSelectAll(!1);b.ApplySolToContainer();return a.HasAnyInstances()}_RunObject_NextFilter(a){const b=this._objectClass;var d=b.IsFamily();const c=b.GetFamilyIndex(),e=b.IsInContainer(),g=this._behaviorIndex,k=0<=g,l=this._anyParamVariesPerInstance,n=this._results,p=this._func,r=this._isInverted,w=this._isInOrBlock&&!this._isTrigger,z=a._GetOwnInstances(),B=a._GetOwnElseInstances(),C=w&&!this._eventBlock.IsFirstConditionOfType(this),
E=C?B:z;let F=0,I=!1;for(let O=0,V=E.length;O<V;++O){const W=E[O];l&&this._EvaluateVaryingParameters(O);var K=void 0;k?(K=d?W.GetObjectClass().GetFamilyBehaviorOffset(c):0,K=p.apply(W.GetBehaviorInstances()[g+K].GetSdkInstance(),n)):K=p.apply(W.GetSdkInstance(),n);C3$jscomp$167.xor(K,r)?(I=!0,C?(z.push(W),e&&W._PushSiblingsToSolInstances()):(E[F]=W,e&&W._SetSiblingsToSolInstancesIndex(F),++F)):C?(E[F]=W,e&&W._SetSiblingsToSolElseInstancesIndex(F),++F):w&&(B.push(W),e&&W._PushSiblingsToSolElseInstances())}C3$jscomp$167.truncateArray(E,
F);e&&b._TruncateContainerSols(C,F);d=I;C&&!I&&(I=this._OrBlockCheckInstances(z));b.FinishCondition(d||w);return w?I:a.HasAnyInstances()}_OrBlockCheckInstances(a){var b=this._objectClass;const d=b.IsFamily();b=b.GetFamilyIndex();const c=this._anyParamVariesPerInstance,e=this._behaviorIndex,g=0<=e,k=this._results,l=this._func,n=this._isInverted;for(let r=0,w=a.length;r<w;++r){var p=a[r];c&&this._EvaluateVaryingParameters(r);if(g){const z=d?p.GetObjectClass().GetFamilyBehaviorOffset(b):0;p=l.apply(p.GetBehaviorInstances()[e+
z].GetSdkInstance(),k)}else p=l.apply(p.GetSdkInstance(),k);if(C3$jscomp$167.xor(p,n))return!0}return!1}ReevaluateParameter(a,b){return this._parameters[a].Get(b)}GetFastTriggerValue(){const a=this._parameters;if(!a.length)throw Error("no parameters");return a[0]._GetFastTriggerValue()}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;const a={};for(const [b,d]of this._savedData.entries()){let c=d;"collmemory"===b&&(c=[...d.entries()].map(e=>[e[0].GetUID(),e[1].GetUID(),e[2]]));
a[b]=c}return{ex:a}}_LoadFromJson(a){this._savedData&&(this._savedData.clear(),this._savedData=null);if(a){var b=this._runtime,d=a.ex;if(d){a=this.GetSavedDataMap();a.clear();for(const [c,e]of Object.entries(d))d=e,"collmemory"===c&&(d=C3$jscomp$167.New(C3$jscomp$167.PairMap,e.map(g=>[b.GetInstanceByUID(g[0]),b.GetInstanceByUID(g[1]),g[2]]).filter(g=>g[0]&&g[1]))),a.set(c,d)}}}};"use strict";const C3$jscomp$168=self.C3;
function EvalParams$jscomp$1(a,b){for(let d=0,c=a.length;d<c;++d)b[d]=a[d].Get(0)}const EMPTY_PARAMS_ARRAY$jscomp$1=[],noop$jscomp$2=function(){},noopGenerator=function*(){};
C3$jscomp$168.Action=class extends C3$jscomp$168.DefendedBase{constructor(a,b,d){super();this._eventBlock=a;this._runtime=a=a.GetRuntime();this._index=d;this._sid=4<=b.length?b[3]:-1;this._actionType=5<=b.length?b[4]&255:0;this._flags=5<=b.length?b[4]>>8:0;this._behaviorType=this._objectClass=this._func=null;this._behaviorIndex=-1;this._systemPlugin=null;this._callFunctionName="";this._callEventBlock=this._callCustomAceObjectClass=null;this.DebugRun=this.Run=noop$jscomp$2;this._parameters=[];this._results=
[];this._anyParamVariesPerInstance=!1;this._unsavedData=this._savedData=null;const c=(d=-3===b[0])?b[2]:b[5];this._debugData=a.IsDebug()||d?{isBreakpoint:c[0],canDebug:c[1],index:c[2]}:null;-1===b[0]?(this._systemPlugin=a.GetSystemPlugin(),this._func=a.GetObjectReference(b[1])):-2===b[0]?this._callFunctionName=b[1]:d?(this._func=a.GetObjectReference(b[1]),this.Run=this.RunUserScript,this.DebugRun=this.DebugRunUserScript,this._flags|=8):(this._objectClass=a.GetObjectClassByIndex(b[0]),this._flags&
4?(this._callFunctionName=b[1],this._callCustomAceObjectClass=a.GetObjectClassByIndex(b[2])):(b[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(b[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(b[2])),this._func=a.GetObjectReference(b[1])));if(7===b.length){b=b[6];for(const e of b)this._parameters.push(C3$jscomp$168.Parameter.Create(this,e,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._results=this._parameters=EMPTY_PARAMS_ARRAY$jscomp$1);
this.CanPickAnyObjectClass()&&(this._eventBlock.SetAllSolModifiers(),this._eventBlock.SetSolWriterAfterCnds());this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(a,b,d){return C3$jscomp$168.New(C3$jscomp$168.Action,a,b,d)}_PostInit(){for(var a of this._parameters)a._PostInit(),a.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);if(this._systemPlugin)this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem;else if(this._callFunctionName)this._flags&4?this._SetCallCustomActionRunMethod():
this._SetCallFunctionRunMethod(),this._callFunctionName="",this._callCustomAceObjectClass=null;else if(this.Run===this.RunUserScript){a=this._func;const b=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=a.bind(null,this._runtime.GetIRuntime(),b)}else this._behaviorType?this.IsAsync()?(this.Run=this._RunBehavior_Async,this.DebugRun=this._DebugRunBehavior_Async):(this.Run=this._RunBehavior,this.DebugRun=this._DebugRunBehavior):this._objectClass.GetPlugin().IsSingleGlobal()?
(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this.IsStatic()?(this.Run=this._RunObject_Static,this.DebugRun=this._DebugRunObject_Static):this.IsAsync()?(this.Run=this._RunObject_Async,this.DebugRun=this._DebugRunObject_Async):this.CallBeforeAfterHooks()?(this.Run=this._RunObject_BeforeAfterHooks,this.DebugRun=this._DebugRunObject_BeforeAfterHooks):this._parameters.length?this._parameters.every(b=>b.VariesPerInstance())?(this.Run=this._RunObject_AllParamsVary,this.DebugRun=
this._DebugRunObject_AllParamsVary):this._anyParamVariesPerInstance?(this.Run=this._RunObject_SomeParamsVary,this.DebugRun=this._DebugRunObject_SomeParamsVary):this._parameters.every(b=>b.IsConstant())?(EvalParams$jscomp$1(this._parameters,this._results),this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst):(this.Run=this._RunObject_ParamsDontVary,this.DebugRun=this._DebugRunObject_ParamsDontVary):(this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst)}_SetSystemRunMethod(){this._SetRunMethodForBoundFunc(this._systemPlugin,
this._systemPlugin,this._RunSystem)}_SetSingleGlobalRunMethod(){const a=this._objectClass.GetPlugin(),b=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(a,b,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){const a=this._eventBlock.GetEventSheetManager(),b=a.GetFunctionBlockByName(this._callFunctionName);if(b.IsEnabled()){const d=0!==(this._flags&2);this._callEventBlock=b.GetEventBlock();let c=[...(new Set([...this._eventBlock.GetSolModifiersIncludingParents(),
...this._callEventBlock.GetSolModifiersIncludingParents()]))];c=a._DeduplicateSolModifierList(c);const e=!b.IsCopyPicked()&&this._HasCopyPickedParent()?{pushCleanSolDynamic:!0}:null;this.Run=C3$jscomp$168.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,c,this._parameters,d,e);if(this._runtime.IsDebug()){const g=this;this.DebugRun=function*(){if(g.IsBreakpoint()||g._runtime.DebugBreakNext())yield g;return yield*g._callEventBlock.DebugRunAsFunctionCall(c,g._parameters,d,e)}}else this.DebugRun=
noopGenerator}else this.Run=noop$jscomp$2,this.DebugRun=noopGenerator}_SetCallCustomActionRunMethod(){var a=this._eventBlock.GetEventSheetManager();const b=a.GetCustomActionBlockByName(this._callCustomAceObjectClass,this._callFunctionName);if(b.IsEnabled()){const d=0!==(this._flags&2);this._callEventBlock=b.GetEventBlock();let c=[...(new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents(),this._objectClass,b.GetObjectClass()]))];c=a._DeduplicateSolModifierList(c);
a=!this._objectClass.IsFamily()&&!b.GetObjectClass().IsFamily();const e=!this._objectClass.IsFamily()&&b.GetObjectClass().IsFamily(),g=this._objectClass.IsFamily();let k=null;!b.IsCopyPicked()&&this._HasCopyPickedParent()&&(k=k||{},k.pushCleanSolDynamic=!0);if(e||!d)k=k||{},k.copyFromObjectClass=this._objectClass,k.copyToObjectClass=b.GetObjectClass();a||e||g&&!b.HasCustomACEOverrides()?this.Run=C3$jscomp$168.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,c,this._parameters,d,k):
g&&(this.Run=C3$jscomp$168.FunctionBlock.prototype.RunAsFamilyCustomActionWithOverrides.bind(b,c,this._parameters));if(this._runtime.IsDebug()){const l=this;a||e||g&&!b.HasCustomACEOverrides()?this.DebugRun=function*(){if(l.IsBreakpoint()||l._runtime.DebugBreakNext())yield l;return yield*l._callEventBlock.DebugRunAsFunctionCall(c,l._parameters,d,k)}:g&&(this.DebugRun=function*(){if(l.IsBreakpoint()||l._runtime.DebugBreakNext())yield l;return yield*b.DebugRunAsFamilyCustomActionWithOverrides(c,l._parameters)})}else this.DebugRun=
noopGenerator}else this.Run=noop$jscomp$2,this.DebugRun=noopGenerator}_SetRunMethodForBoundFunc(a,b,d){const c=this._func,e=this._parameters;if(0===e.length)this.Run=a._GetBoundACEMethod(c,b);else if(1===e.length){const g=e[0];if(g.IsConstant())this.Run=a._GetBoundACEMethod_1param(c,b,g.Get(0));else{const k=a._GetBoundACEMethod(c,b);this.Run=function(){return k(g.Get(0))}}}else if(2===e.length){const g=e[0],k=e[1];if(g.IsConstant()&&k.IsConstant())this.Run=a._GetBoundACEMethod_2params(c,b,g.Get(0),
k.Get(0));else{const l=a._GetBoundACEMethod(c,b);this.Run=function(){return l(g.Get(0),k.Get(0))}}}else if(3===e.length){const g=e[0],k=e[1],l=e[2];if(g.IsConstant()&&k.IsConstant()&&l.IsConstant())this.Run=a._GetBoundACEMethod_3params(c,b,g.Get(0),k.Get(0),l.Get(0));else{const n=a._GetBoundACEMethod(c,b);this.Run=function(){return n(g.Get(0),k.Get(0),l.Get(0))}}}else this.Run=d}GetSID(){return this._sid}IsAsync(){return 0!==(this._flags&8)}CanBailOut(){return 1===this._actionType}CallBeforeAfterHooks(){return 2===
this._actionType}IsStatic(){return 3===this._actionType}CanPickAnyObjectClass(){return 0!==(this._flags&1)}HasReturnType(){return this.IsAsync()||this.CanBailOut()}GetObjectClass(){return this._objectClass}GetImplementationAddon(){return this._behaviorType?this._behaviorType.GetBehavior():this._objectClass?this._objectClass.GetPlugin():null}GetImplementationSdkVersion(){const a=this.GetImplementationAddon();return a?a.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}_HasCopyPickedParent(){let a=
this._eventBlock;do{if(a instanceof C3$jscomp$168.FunctionBlock&&a.IsCopyPicked())return!0;a=a.GetScopeParent()}while(a);return!1}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(a){this._debugData.isBreakpoint=!!a;this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&
!this._DebugReturnsGenerator()}GetSavedDataMap(){this._savedData||(this._savedData=new Map);return this._savedData}GetUnsavedDataMap(){this._unsavedData||(this._unsavedData=new Map);return this._unsavedData}_RunSystem(){const a=this._results;EvalParams$jscomp$1(this._parameters,a);return this._func.apply(this._systemPlugin,a)}*_DebugRunSystem(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const a=this._results;EvalParams$jscomp$1(this._parameters,
a);return yield*this._func.apply(this._systemPlugin,a)}return this.Run()}_RunSingleGlobal(){const a=this._results;EvalParams$jscomp$1(this._parameters,a);return this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),a)}*_DebugRunSingleGlobal(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const a=this._results;EvalParams$jscomp$1(this._parameters,a);return yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),
a)}return this.Run()}_RunObject_ParamsConst(){const a=this._results,b=this._objectClass.GetCurrentSol().GetInstances();for(let d=0,c=b.length;d<c;++d)this._func.apply(b[d].GetSdkInstance(),a)}*_DebugRunObject_ParamsConst(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const a=this._results,b=this._objectClass.GetCurrentSol().GetInstances();for(let d=0,c=b.length;d<c;++d)yield*this._func.apply(b[d].GetSdkInstance(),a)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){const a=
this._results;EvalParams$jscomp$1(this._parameters,a);const b=this._objectClass.GetCurrentSol().GetInstances();for(let d=0,c=b.length;d<c;++d)this._func.apply(b[d].GetSdkInstance(),a)}*_DebugRunObject_ParamsDontVary(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const a=this._results;EvalParams$jscomp$1(this._parameters,a);const b=this._objectClass.GetCurrentSol().GetInstances();for(let d=0,c=b.length;d<c;++d)yield*this._func.apply(b[d].GetSdkInstance(),
a)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){const a=this._parameters,b=this._results,d=this._func,c=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,g=c.length;e<g;++e){const k=c[e];for(let l=0,n=a.length;l<n;++l)b[l]=a[l].Get(e);d.apply(k.GetSdkInstance(),b)}}*_DebugRunObject_AllParamsVary(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const a=this._parameters,b=this._results,d=this._func,c=this._objectClass.GetCurrentSol().GetInstances();
for(let e=0,g=c.length;e<g;++e){const k=c[e];for(let l=0,n=a.length;l<n;++l)b[l]=a[l].Get(e);yield*d.apply(k.GetSdkInstance(),b)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){const a=this._parameters,b=this._results,d=this._func,c=this._objectClass.GetCurrentSol().GetInstances();for(let g=0,k=a.length;g<k;++g){var e=a[g];e.VariesPerInstance()||(b[g]=e.Get(0))}for(let g=0,k=c.length;g<k;++g){e=c[g];for(let l=0,n=a.length;l<n;++l){const p=a[l];p.VariesPerInstance()&&(b[l]=p.Get(g))}d.apply(e.GetSdkInstance(),
b)}}*_DebugRunObject_SomeParamsVary(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const b=this._parameters,d=this._results,c=this._func,e=this._objectClass.GetCurrentSol().GetInstances();for(let g=0,k=b.length;g<k;++g){var a=b[g];a.VariesPerInstance()||(d[g]=a.Get(0))}for(let g=0,k=e.length;g<k;++g){a=e[g];for(let l=0,n=b.length;l<n;++l){const p=b[l];p.VariesPerInstance()&&(d[l]=p.Get(g))}yield*c.apply(a.GetSdkInstance(),d)}}else this._RunObject_SomeParamsVary()}_RunObject_BeforeAfterHooks(){const a=
this._parameters,b=this._results,d=this._func;var c=this._objectClass;const e=c.GetSdkType();c=c.GetCurrentSol().GetInstances();e.BeforeRunAction(d);for(let g=0,k=c.length;g<k;++g){const l=c[g];for(let n=0,p=a.length;n<p;++n)b[n]=a[n].Get(g);d.apply(l.GetSdkInstance(),b)}e.AfterRunAction(d)}*_DebugRunObject_BeforeAfterHooks(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const b=this._parameters,d=this._results,c=this._func;var a=this._objectClass;
const e=a.GetSdkType();a=a.GetCurrentSol().GetInstances();e.BeforeRunAction(c);for(let g=0,k=a.length;g<k;++g){const l=a[g];for(let n=0,p=b.length;n<p;++n)d[n]=b[n].Get(g);yield*c.apply(l.GetSdkInstance(),d)}e.AfterRunAction(c)}else this._RunObject_BeforeAfterHooks()}_RunObject_Static(){const a=this._results;EvalParams$jscomp$1(this._parameters,a);return this._func.apply(this._behaviorType||this._objectClass,a)}*_DebugRunObject_Static(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;
if(this._DebugReturnsGenerator()){var a=this._results;EvalParams$jscomp$1(this._parameters,a);a=this._func.apply(this._behaviorType||this._objectClass,a);C3$jscomp$168.IsIterator(a)&&(a=yield*a);return a}return this._RunObject_Static()}_RunBehavior(){var a=this._objectClass;const b=a.IsFamily(),d=a.GetFamilyIndex(),c=this._parameters,e=this._anyParamVariesPerInstance,g=this._results,k=this._func,l=this._behaviorIndex;a=a.GetCurrentSol().GetInstances();for(let r=0,w=c.length;r<w;++r){var n=c[r];n.VariesPerInstance()||
(g[r]=n.Get(0))}for(let r=0,w=a.length;r<w;++r){n=a[r];if(e)for(let z=0,B=c.length;z<B;++z){var p=c[z];p.VariesPerInstance()&&(g[z]=p.Get(r))}p=b?n.GetObjectClass().GetFamilyBehaviorOffset(d):0;k.apply(n.GetBehaviorInstances()[l+p].GetSdkInstance(),g)}}*_DebugRunBehavior(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){var a=this._objectClass;const c=a.IsFamily(),e=a.GetFamilyIndex(),g=this._parameters,k=this._anyParamVariesPerInstance,l=this._results,
n=this._func,p=this._behaviorIndex;a=a.GetCurrentSol().GetInstances();for(let r=0,w=g.length;r<w;++r){var b=g[r];b.VariesPerInstance()||(l[r]=b.Get(0))}for(let r=0,w=a.length;r<w;++r){b=a[r];if(k)for(let z=0,B=g.length;z<B;++z){var d=g[z];d.VariesPerInstance()&&(l[z]=d.Get(r))}d=c?b.GetObjectClass().GetFamilyBehaviorOffset(e):0;yield*n.apply(b.GetBehaviorInstances()[p+d].GetSdkInstance(),l)}}else this._RunBehavior()}_RunObject_Async(){const a=this._parameters,b=this._results,d=this._func,c=this._objectClass.GetCurrentSol().GetInstances(),
e=[];for(let g=0,k=c.length;g<k;++g){const l=c[g];for(let n=0,p=a.length;n<p;++n)b[n]=a[n].Get(g);e.push(d.apply(l.GetSdkInstance(),b))}return Promise.all(e)}*_DebugRunObject_Async(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const a=this._parameters,b=this._results,d=this._func,c=this._objectClass.GetCurrentSol().GetInstances(),e=[];for(let g=0,k=c.length;g<k;++g){const l=c[g];for(let n=0,p=a.length;n<p;++n)b[n]=a[n].Get(g);e.push(yield*d.apply(l.GetSdkInstance(),
b))}return Promise.all(e)}return this._RunObject_Async()}_RunBehavior_Async(){var a=this._objectClass;const b=a.IsFamily(),d=a.GetFamilyIndex(),c=this._parameters,e=this._results,g=this._func,k=this._behaviorIndex;a=a.GetCurrentSol().GetInstances();const l=[];for(let n=0,p=a.length;n<p;++n){const r=a[n];for(let z=0,B=c.length;z<B;++z)e[z]=c[z].Get(n);const w=b?r.GetObjectClass().GetFamilyBehaviorOffset(d):0;l.push(g.apply(r.GetBehaviorInstances()[k+w].GetSdkInstance(),e))}return Promise.all(l)}*_DebugRunBehavior_Async(){if(this.IsBreakpoint()||
this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){var a=this._objectClass;const b=a.IsFamily(),d=a.GetFamilyIndex(),c=this._parameters,e=this._results,g=this._func,k=this._behaviorIndex;a=a.GetCurrentSol().GetInstances();const l=[];for(let n=0,p=a.length;n<p;++n){const r=a[n];for(let z=0,B=c.length;z<B;++z)e[z]=c[z].Get(n);const w=b?r.GetObjectClass().GetFamilyBehaviorOffset(d):0;l.push(yield*g.apply(r.GetBehaviorInstances()[k+w].GetSdkInstance(),e))}return Promise.all(l)}return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(a){console.error(`Unhandled exception running script %c${this._eventBlock.GetEventSheet().GetName()}, event ${this._eventBlock.GetDisplayNumber()}, action ${this.GetDebugIndex()+
1}:`,"font-size: 1.2em; font-weight: bold;",a),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),C3$jscomp$168.EventScript.HadUserScriptException()||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),C3$jscomp$168.EventScript.SetHadUserScriptException())}}*DebugRunUserScript(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;return this.RunUserScript()}_SaveToJson(){return this._savedData&&
this._savedData.size?{ex:C3$jscomp$168.ToSuperJSON(this._savedData)}:null}_LoadFromJson(a){this._savedData&&(this._savedData.clear(),this._savedData=null);a&&(a=a.ex)&&(this._savedData=C3$jscomp$168.FromSuperJSON(a))}};"use strict";const C3$jscomp$169=self.C3,tempColor$jscomp$5=new C3$jscomp$169.Color;let runtime$jscomp$66=null;C3$jscomp$169.CommonACES_SetRuntime=function(a){runtime$jscomp$66=a};
function GetInst(a){return a instanceof self.IInstance?runtime$jscomp$66._UnwrapScriptInterface(a):a.GetInstance()}function GetWorldInfo(a){return GetInst(a).GetWorldInfo()}function CompareX(a,b){return C3$jscomp$169.compare(GetWorldInfo(this).GetX(),a,b)}function CompareY(a,b){return C3$jscomp$169.compare(GetWorldInfo(this).GetY(),a,b)}function IsOnScreen(){return GetWorldInfo(this).IsInViewport2()}
function IsOutsideLayout(){var a=GetWorldInfo(this);const b=a.GetLayout();a=a.GetBoundingBox();return 0>a.getRight()||0>a.getBottom()||a.getLeft()>b.GetWidth()||a.getTop()>b.GetHeight()}
function PickDistance(a,b,d){const c=this.GetCurrentSol(),e=c.GetInstances();if(!e.length)return!1;let g=e[0];var k=g.GetWorldInfo();let l=g,n=C3$jscomp$169.distanceSquared(k.GetX(),k.GetY(),b,d);for(let p=1,r=e.length;p<r;++p)if(g=e[p],k=g.GetWorldInfo(),k=C3$jscomp$169.distanceSquared(k.GetX(),k.GetY(),b,d),0===a&&k<n||1===a&&k>n)n=k,l=g;c.PickOne(l);return!0}function SetX(a){const b=GetWorldInfo(this);b.GetX()!==a&&(b.SetX(a),b.SetBboxChanged())}
function SetY(a){const b=GetWorldInfo(this);b.GetY()!==a&&(b.SetY(a),b.SetBboxChanged())}function SetPos(a,b){const d=GetWorldInfo(this);d.EqualsXY(a,b)||(d.SetXY(a,b),d.SetBboxChanged())}function SetPosToObject(a,b){if(a){var d=GetInst(this);if(a=a.GetPairedInstance(d)){var [c,e]=a.GetImagePoint(b);b=d.GetWorldInfo();if(b.GetX()!==c||b.GetY()!==e)b.SetXY(c,e),b.SetBboxChanged()}}}
function MoveForward(a){if(0!==a){var b=GetWorldInfo(this);b.OffsetXY(b.GetCosAngle()*a,b.GetSinAngle()*a);b.SetBboxChanged()}}function MoveAtAngle(a,b){if(0!==b){var d=GetWorldInfo(this);a=C3$jscomp$169.toRadians(a);d.OffsetXY(Math.cos(a)*b,Math.sin(a)*b);d.SetBboxChanged()}}function GetX(){return GetWorldInfo(this).GetX()}function GetY(){return GetWorldInfo(this).GetY()}function GetDt(){const a=GetInst(this);return a.GetRuntime().GetDt(a)}
function CompareWidth(a,b){return C3$jscomp$169.compare(GetWorldInfo(this).GetWidth(),a,b)}function CompareHeight(a,b){return C3$jscomp$169.compare(GetWorldInfo(this).GetHeight(),a,b)}function SetWidth(a){const b=GetWorldInfo(this);b.GetWidth()!==a&&(b.SetWidth(a),b.SetBboxChanged())}function SetHeight(a){const b=GetWorldInfo(this);b.GetHeight()!==a&&(b.SetHeight(a),b.SetBboxChanged())}
function SetSize(a,b){const d=GetWorldInfo(this);if(d.GetWidth()!==a||d.GetHeight()!==b)d.SetSize(a,b),d.SetBboxChanged()}function GetWidth(){return GetWorldInfo(this).GetWidth()}function GetHeight(){return GetWorldInfo(this).GetHeight()}function GetBboxLeft(){return GetWorldInfo(this).GetBoundingBox().getLeft()}function GetBboxTop(){return GetWorldInfo(this).GetBoundingBox().getTop()}function GetBboxRight(){return GetWorldInfo(this).GetBoundingBox().getRight()}
function GetBboxBottom(){return GetWorldInfo(this).GetBoundingBox().getBottom()}function GetBboxMidX(){const a=GetWorldInfo(this).GetBoundingBox();return(a.getLeft()+a.getRight())/2}function GetBboxMidY(){const a=GetWorldInfo(this).GetBoundingBox();return(a.getTop()+a.getBottom())/2}function IsAngleWithin(a,b){return C3$jscomp$169.angleDiff(GetWorldInfo(this).GetAngle(),C3$jscomp$169.toRadians(b))<=C3$jscomp$169.toRadians(a)}
function IsAngleClockwiseFrom(a){return C3$jscomp$169.angleClockwise(GetWorldInfo(this).GetAngle(),C3$jscomp$169.toRadians(a))}function IsBetweenAngles(a,b){a=C3$jscomp$169.toRadians(a);b=C3$jscomp$169.toRadians(b);const d=GetWorldInfo(this).GetAngle();return C3$jscomp$169.angleClockwise(b,a)?C3$jscomp$169.angleClockwise(d,a)&&!C3$jscomp$169.angleClockwise(d,b):!(!C3$jscomp$169.angleClockwise(d,a)&&C3$jscomp$169.angleClockwise(d,b))}
function SetAngle(a){const b=GetWorldInfo(this);a=C3$jscomp$169.clampAngle(C3$jscomp$169.toRadians(a));isNaN(a)||b.GetAngle()===a||(b.SetAngle(a),b.SetBboxChanged())}function RotateClockwise(a){if(!isNaN(a)&&0!==a){var b=GetWorldInfo(this);b.SetAngle(b.GetAngle()+C3$jscomp$169.toRadians(a));b.SetBboxChanged()}}function RotateCounterclockwise(a){if(!isNaN(a)&&0!==a){var b=GetWorldInfo(this);b.SetAngle(b.GetAngle()-C3$jscomp$169.toRadians(a));b.SetBboxChanged()}}
function RotateTowardAngle(a,b){const d=GetWorldInfo(this),c=d.GetAngle();a=C3$jscomp$169.angleRotate(c,C3$jscomp$169.toRadians(b),C3$jscomp$169.toRadians(a));isNaN(a)||c===a||(d.SetAngle(a),d.SetBboxChanged())}function RotateTowardPosition(a,b,d){const c=GetWorldInfo(this),e=c.GetAngle();b-=c.GetX();d-=c.GetY();a=C3$jscomp$169.angleRotate(e,Math.atan2(d,b),C3$jscomp$169.toRadians(a));isNaN(a)||e===a||(c.SetAngle(a),c.SetBboxChanged())}
function SetTowardPosition(a,b){const d=GetWorldInfo(this),c=d.GetAngle();a-=d.GetX();b-=d.GetY();b=Math.atan2(b,a);isNaN(b)||c===b||(d.SetAngle(b),d.SetBboxChanged())}function GetAngle(){return C3$jscomp$169.toDegrees(GetWorldInfo(this).GetAngle())}function CompareOpacity(a,b){return C3$jscomp$169.compare(C3$jscomp$169.roundToDp(100*GetWorldInfo(this).GetOpacity(),6),a,b)}function IsVisible(){return GetWorldInfo(this).IsVisible()}
function SetVisible(a){const b=GetInst(this),d=b.GetWorldInfo();a=2===a?!d.IsVisible():0!==a;d.IsVisible()!==a&&(d.SetVisible(a),b.GetRuntime().UpdateRender())}function SetOpacity(a){a=C3$jscomp$169.clamp(a/100,0,1);const b=GetInst(this),d=b.GetWorldInfo();if(d.GetTransformWithParentOpacity()){if(d._GetSceneGraphInfo().GetOwnOpacity()===a)return}else if(d.GetOpacity()===a)return;d.SetOpacity(a);b.GetRuntime().UpdateRender()}
function SetDefaultColor(a){tempColor$jscomp$5.setFromRgbValue(a);a=GetInst(this);const b=a.GetWorldInfo();b.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor$jscomp$5)||(b.SetUnpremultipliedColor(tempColor$jscomp$5),a.GetRuntime().UpdateRender())}function GetColor(){const a=GetWorldInfo(this).GetUnpremultipliedColor();return C3$jscomp$169.PackRGBAEx(a.getR(),a.getG(),a.getB(),a.getA())}function GetOpacity(){return C3$jscomp$169.roundToDp(100*GetWorldInfo(this).GetOpacity(),6)}
function IsOnLayer(a){return a?GetWorldInfo(this).GetLayer()===a:!1}function PickTopBottom(a){const b=this.GetCurrentSol(),d=b.GetInstances();if(!d.length)return!1;let c=d[0];for(let e=1,g=d.length;e<g;++e){const k=d[e],l=k.GetWorldInfo(),n=c.GetWorldInfo(),p=l.GetLayer().GetIndex(),r=n.GetLayer().GetIndex();if(0===a){if(p>r||p===r&&l.GetZIndex()>n.GetZIndex())c=k}else if(p<r||p===r&&l.GetZIndex()<n.GetZIndex())c=k}b.PickOne(c);return!0}
function CompareZElevation(a,b,d){const c=GetWorldInfo(this);a=0===a?c.GetZElevation():c.GetTotalZElevation();return C3$jscomp$169.compare(a,b,d)}function MoveToTop(){GetWorldInfo(this).ZOrderMoveToTop()}function MoveToBottom(){GetWorldInfo(this).ZOrderMoveToBottom()}function MoveToLayer(a){a&&GetWorldInfo(this).ZOrderMoveToLayer(a)}function ZMoveToObject(a,b){a=0===a;if(b){var d=GetInst(this);(b=b.GetFirstPicked(d))&&d.GetWorldInfo().ZOrderMoveAdjacentToInstance(b,a)}}
function SetZElevation(a){const b=GetInst(this),d=b.GetWorldInfo();d.GetZElevation()!==a&&(d.SetZElevation(a),b.GetRuntime().UpdateRender())}function LayerNumber(){return GetWorldInfo(this).GetLayer().GetIndex()}function LayerName(){return GetWorldInfo(this).GetLayer().GetName()}function ZIndex(){return GetWorldInfo(this).GetZIndex()}function ZElevation(){return GetWorldInfo(this).GetZElevation()}function TotalZElevation(){return GetWorldInfo(this).GetTotalZElevation()}
function IsEffectEnabled(a){const b=GetInst(this);if(a=b.GetObjectClass().GetEffectList().GetEffectTypeByName(a))return a=a.GetIndex(),b.GetWorldInfo().GetInstanceEffectList().IsEffectIndexActive(a)}
function SetEffectEnabled(a,b){const d=GetInst(this);if(b=d.GetObjectClass().GetEffectList().GetEffectTypeByName(b)){b=b.GetIndex();a=1===a;var c=d.GetWorldInfo().GetInstanceEffectList();c.IsEffectIndexActive(b)!==a&&(c.SetEffectIndexActive(b,a),c.UpdateActiveEffects(),d.GetRuntime().UpdateRender())}}
function SetEffectParam(a,b,d){const c=GetInst(this);if(a=c.GetObjectClass().GetEffectList().GetEffectTypeByName(a)){b=Math.floor(b);var e=a.GetShaderProgram().GetParameterType(b);e&&("color"===e?(tempColor$jscomp$5.setFromRgbValue(d),d=tempColor$jscomp$5):"percent"===e&&(d/=100),a=a.GetIndex(),e=c.GetWorldInfo().GetInstanceEffectList(),e.SetEffectParameter(a,b,d)&&e.IsEffectIndexActive(a)&&c.GetRuntime().UpdateRender())}}
const tempRect$jscomp$5=C3$jscomp$169.New(C3$jscomp$169.Rect),tempCandidates1=[],tempCandidates2=[];let needsCollisionFinish=!1,rPickType=null,rPickFromElseInstances=!1;const rToPick=new Set;function CollMemory_Add(a,b,d,c){const e=b.GetUID(),g=d.GetUID();e<g?a.Set(b,d,c):a.Set(d,b,c)}function CollMemory_Remove(a,b,d){const c=b.GetUID(),e=d.GetUID();c<e?a.Delete(b,d):a.Delete(d,b)}function CollMemory_RemoveInstance(a,b){a.DeleteEither(b)}
function CollMemory_Get(a,b,d){const c=b.GetUID(),e=d.GetUID();return c<e?a.Get(b,d):a.Get(d,b)}
function DoOverlapCondition(a,b,d,c){if(!b)return!1;const e=0!==d||0!==c,g=a.GetWorldInfo(),k=a.GetRuntime(),l=k.GetCollisionEngine();var n=k.GetCurrentCondition();const p=n.GetEventBlock().IsOrBlock();var r=n.GetObjectClass();n=n.IsInverted();const w=b.GetCurrentSol();r=r!==b;rPickType=b;needsCollisionFinish=r&&!n;rPickFromElseInstances=!1;let z=0,B=0,C=!1;w.IsSelectAll()?(tempRect$jscomp$5.copy(g.GetBoundingBox()),tempRect$jscomp$5.offset(d,c),l.GetCollisionCandidates(g.GetLayer(),b,tempRect$jscomp$5,
tempCandidates2),b=tempCandidates2):p?k.IsCurrentConditionFirst()&&!w._GetOwnElseInstances().length&&w._GetOwnInstances().length?b=w._GetOwnInstances():(b=w._GetOwnElseInstances(),rPickFromElseInstances=!0):b=w._GetOwnInstances();e&&(z=g.GetX(),B=g.GetY(),g.OffsetXY(d,c),g.SetBboxChanged());for(const E of b)if(l.TestOverlap(a,E)){C=!0;if(n)break;r&&rToPick.add(E)}e&&(g.SetXY(z,B),g.SetBboxChanged());C3$jscomp$169.clearArray(tempCandidates2);return C}
function FinishCollisionConditionPicking(a){a=a.GetRuntime().GetCurrentEvent().IsOrBlock();const b=rPickType.GetCurrentSol(),d=b._GetOwnInstances(),c=b._GetOwnElseInstances();b.IsSelectAll()?(b.SetSetPicked(rToPick),a&&(C3$jscomp$169.clearArray(c),b.AddElseInstances(rToPick,rPickType.GetInstances()))):a?rPickFromElseInstances?b.TransferElseInstancesToOwn(rToPick):(b.AddElseInstances(rToPick,d),b.SetSetPicked(rToPick)):b.SetSetPicked(rToPick);rPickType.ApplySolToContainer()}
function FinishCollisionCondition(a,b){needsCollisionFinish&&(b&&FinishCollisionConditionPicking(a),rToPick.clear(),rPickType=null,needsCollisionFinish=!1)}
function OnCollision(a){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,a);if(!a)return!1;var b=this._runtime;const d=b.GetCollisionEngine(),c=b.GetEventSheetManager(),e=c.GetEventStack();var g=c.GetCurrentCondition();const k=g.GetObjectClass();var l=g.GetSavedDataMap(),n=g.GetUnsavedDataMap();g=e.GetCurrentStackFrame();const p=b.GetTickCount(),r=p-1,w=g.GetCurrentEvent(),z=e.Push(w);let B=l.get("collmemory");B||(B=C3$jscomp$169.New(C3$jscomp$169.PairMap),l.set("collmemory",B));n.get("collisionCreatedDestroyCallback")||
(n.set("collisionCreatedDestroyCallback",!0),b.Dispatcher().addEventListener("instancedestroy",I=>CollMemory_RemoveInstance(B,I.instance)));l=k.GetCurrentSol();b=a.GetCurrentSol();l=l.GetInstances();n=null;for(let I=0;I<l.length;++I){const K=l[I];b.IsSelectAll()?(d.GetCollisionCandidates(K.GetWorldInfo().GetLayer(),a,K.GetWorldInfo().GetBoundingBox(),tempCandidates1),n=tempCandidates1,d.AddRegisteredCollisionCandidates(K,a,n)):n=b.GetInstances();for(let O=0;O<n.length;++O){const V=n[O];if(d.TestOverlap(K,
V)||d.CheckRegisteredCollision(K,V)){var C=CollMemory_Get(B,K,V),E=!1,F=-2;"number"===typeof C&&(E=!0,F=C);C=!E||F<r;CollMemory_Add(B,K,V,p);C&&(C=w.GetSolModifiers(),c.PushCopySol(C),F=k.GetCurrentSol(),E=a.GetCurrentSol(),F._SetSelectAll(!1),E._SetSelectAll(!1),k===a?(E=F._GetOwnInstances(),C3$jscomp$169.clearArray(E),E.push(K),E.push(V),k.ApplySolToContainer()):(F=F._GetOwnInstances(),E=E._GetOwnInstances(),C3$jscomp$169.clearArray(F),C3$jscomp$169.clearArray(E),F.push(K),E.push(V),k.ApplySolToContainer(),
a.ApplySolToContainer()),w.Retrigger(g,z),c.PopSol(C))}else CollMemory_Remove(B,K,V)}C3$jscomp$169.clearArray(tempCandidates1)}e.Pop();return!1}
function*DebugOnCollision(a){if(!a)return!1;var b=this._runtime;const d=b.GetCollisionEngine(),c=b.GetEventSheetManager(),e=c.GetEventStack();var g=c.GetCurrentCondition();const k=g.GetObjectClass();var l=g.GetSavedDataMap(),n=g.GetUnsavedDataMap();g=e.GetCurrentStackFrame();const p=b.GetTickCount(),r=p-1,w=g.GetCurrentEvent(),z=e.Push(w);let B=l.get("collmemory");B||(B=C3$jscomp$169.New(C3$jscomp$169.PairMap),l.set("collmemory",B));n.get("collisionCreatedDestroyCallback")||(n.set("collisionCreatedDestroyCallback",
!0),b.Dispatcher().addEventListener("instancedestroy",I=>CollMemory_RemoveInstance(B,I.instance)));l=k.GetCurrentSol();b=a.GetCurrentSol();l=l.GetInstances();n=null;for(let I=0;I<l.length;++I){const K=l[I];b.IsSelectAll()?(d.GetCollisionCandidates(K.GetWorldInfo().GetLayer(),a,K.GetWorldInfo().GetBoundingBox(),tempCandidates1),n=tempCandidates1,d.AddRegisteredCollisionCandidates(K,a,n)):n=b.GetInstances();for(let O=0;O<n.length;++O){const V=n[O];if(d.TestOverlap(K,V)||d.CheckRegisteredCollision(K,
V)){var C=CollMemory_Get(B,K,V),E=!1,F=-2;"number"===typeof C&&(E=!0,F=C);C=!E||F<r;CollMemory_Add(B,K,V,p);C&&(C=w.GetSolModifiers(),c.PushCopySol(C),F=k.GetCurrentSol(),E=a.GetCurrentSol(),F._SetSelectAll(!1),E._SetSelectAll(!1),k===a?(E=F._GetOwnInstances(),C3$jscomp$169.clearArray(E),E.push(K),E.push(V),k.ApplySolToContainer()):(F=F._GetOwnInstances(),E=E._GetOwnInstances(),C3$jscomp$169.clearArray(F),C3$jscomp$169.clearArray(E),F.push(K),E.push(V),k.ApplySolToContainer(),a.ApplySolToContainer()),
yield*w.DebugRetrigger(g,z),c.PopSol(C))}else CollMemory_Remove(B,K,V)}C3$jscomp$169.clearArray(tempCandidates1)}e.Pop();return!1}function IsOverlapping(a){return DoOverlapCondition(GetInst(this),a,0,0)}function IsOverlappingOffset(a,b,d){return DoOverlapCondition(GetInst(this),a,b,d)}function HasParent(){return GetWorldInfo(this).HasParent()}function HasChildren(){return GetWorldInfo(this).HasChildren()}
function PickParent(a,b){const d=this.GetCurrentSol().GetInstances();if(0===d.length)return!1;const c=a.GetCurrentSol();var e=c.GetInstances();if(c.IsSelectAll()){var g=[...this._runtime.instancesPendingCreateForObjectClass(a)];0<g.length&&(e=e.concat(g))}if(0===e.length)return!1;e=new Set(e);g=new Set;for(let l=0,n=d.length;l<n;++l){var k=d[l];if(1===b)for(const p of k.parents())p.BelongsToObjectClass(a)&&e.has(p)&&g.add(p);else{if(0===b){if(k=k.GetParent(),null===k)continue}else k=k.GetTopParent();
k.BelongsToObjectClass(a)&&e.has(k)&&g.add(k)}}if(0===g.size)return!1;c.SetSetPicked(g);a.ApplySolToContainer();return!0}
function PickChildren(a,b){const d=this.GetCurrentSol().GetInstances();if(0===d.length)return!1;const c=a.GetCurrentSol();var e=c.GetInstances();if(c.IsSelectAll()){var g=[...this._runtime.instancesPendingCreateForObjectClass(a)];0<g.length&&(e=e.concat(g))}if(0===e.length)return!1;e=new Set(e);g=new Set;for(let k=0,l=d.length;k<l;++k){const n=d[k];2===b&&!n.HasChildren()&&n.BelongsToObjectClass(a)&&e.has(n)&&g.add(n);for(const p of 0===b?n.children():n.allChildren())2===b&&p.HasChildren()||p.BelongsToObjectClass(a)&&
e.has(p)&&g.add(p)}if(0===g.size)return!1;c.SetSetPicked(g);a.ApplySolToContainer();return!0}
function PickNthChild(a,b){const d=this.GetCurrentSol().GetInstances();if(0===d.length)return!1;const c=a.GetCurrentSol();var e=c.GetInstances();if(c.IsSelectAll()){var g=[...this._runtime.instancesPendingCreateForObjectClass(a)];0<g.length&&(e=e.concat(g))}if(0===e.length)return!1;e=new Set(e);g=[];for(let k=0,l=d.length;k<l;++k){const n=d[k].GetChildAt(b);null!==n&&n.BelongsToObjectClass(a)&&e.has(n)&&g.push(n)}if(0===g.length)return!1;c.SetArrayPicked(g);a.ApplySolToContainer();return!0}
function CompareChildCount(a,b,d){const c=GetInst(this);switch(a){default:return C3$jscomp$169.compare(c.GetChildCount(),b,d);case 1:return C3$jscomp$169.compare(c.GetAllChildCount(),b,d)}}
function AddChild(a,b,d,c,e,g,k,l,n,p){const r=GetInst(this),w=r.GetRuntime().GetCurrentAction().GetObjectClass();for(const z of a.allCorrespondingInstances(r,w)){if(!z.GetPlugin().SupportsSceneGraph())break;r.AddChild(z,{transformX:b,transformY:d,transformWidth:c,transformHeight:e,transformAngle:g,transformOpacity:k,transformZElevation:l,transformVisibility:n,destroyWithParent:p})}}
function RemoveChild(a){const b=GetInst(this),d=b.GetRuntime().GetCurrentAction().GetObjectClass();for(const c of a.allCorrespondingInstances(b,d))b.RemoveChild(c)}function RemoveFromParent(){const a=GetInst(this);a.HasParent()&&a.GetParent().RemoveChild(a)}function ChildCount(){return GetInst(this).GetChildCount()}function AllChildCount(){return GetInst(this).GetAllChildCount()}
function SetMeshSize(a,b){a=Math.floor(a);b=Math.floor(b);const d=GetWorldInfo(this);2>a||2>b||!isFinite(a)||!isFinite(b)?(d.ReleaseMesh(),d.SetBboxChanged()):d.CreateMesh(a,b)}function SetMeshPoint(a,b,d,c,e,g,k,l){const n=GetWorldInfo(this);n.SetMeshPoint(a,b,{mode:0===d?"absolute":"relative",x:c,y:e,zElevation:g,u:k,v:l})&&n.SetBboxChanged()}function MeshColumns(){const a=GetWorldInfo(this);return a.HasMesh()?a.GetSourceMesh().GetHSize():0}
function MeshRows(){const a=GetWorldInfo(this);return a.HasMesh()?a.GetSourceMesh().GetVSize():0}function SetElementVisible(a){const b=GetWorldInfo(this);a=2===a?!b.IsVisible():0!==a;b.IsVisible()!==a&&b.SetVisible(a)}function SetElementCSSStyle(a,b){this instanceof self.IInstance?this.setElementCSSStyle(a,b):this.SetElementCSSStyle(a,b)}function SetElementAttribute(a,b){this instanceof self.IInstance?this.setElementAttribute(a,""+b):this.SetElementAttribute(a,""+b)}
function RemoveElementAttribute(a){this instanceof self.IInstance?this.removeElementAttribute(a):this.RemoveElementAttribute(a)}function SetElementFocus(){this instanceof self.IInstance?this.focusElement():this.FocusElement()}function SetElementBlur(){this instanceof self.IInstance?this.blurElement():this.BlurElement()}function IsElementFocused(){return this instanceof self.IInstance?this.isElementFocused():this.IsElementFocused()}
function SetElementEnabled(a){this instanceof self.IInstance?this._setEnabled(0!==a):this._SetEnabled(0!==a)}function IsElementEnabled(){return this instanceof self.IInstance?this._isEnabled():this._IsEnabled()}function CompareInstanceVar(a,b,d){return C3$jscomp$169.compare(GetInst(this).GetInstanceVariableValue(a),b,d)}function IsBoolInstanceVarSet(a){return!!GetInst(this).GetInstanceVariableValue(a)}function TemplateName(){return GetInst(this).GetTemplateName()}
function PickInstVarHiLow(a,b){const d=this.GetCurrentSol(),c=d.GetInstances();if(!c.length)return!1;const e=this.IsFamily();let g=null,k=0;for(let n=0,p=c.length;n<p;++n){const r=c[n];var l=e?r.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0;l=r.GetInstanceVariableValue(l+b);if(null===g||0===a&&l<k||1===a&&l>k)k=l,g=r}d.PickOne(g);return!0}function PickByUID(a){return this._runtime.GetCurrentCondition().IsInverted()?PickByUID_Inverted(this,a):PickByUID_Normal(this,a)}
function PickByUID_Normal(a,b){b=a.GetRuntime().GetInstanceByUID(b);if(!b)return!1;const d=a.GetCurrentSol();if(!d.IsSelectAll()&&!d._GetOwnInstances().includes(b))return!1;if(a.IsFamily()){if(b.GetObjectClass().BelongsToFamily(a))return d.PickOne(b),a.ApplySolToContainer(),!0}else if(b.GetObjectClass()===a)return d.PickOne(b),a.ApplySolToContainer(),!0;return!1}
function PickByUID_Inverted(a,b){const d=a.GetCurrentSol();if(d.IsSelectAll()){d._SetSelectAll(!1);d.ClearArrays();var c=a.GetInstances();for(let g=0,k=c.length;g<k;++g){var e=c[g];e.GetUID()===b?d._PushElseInstance(e):d._PushInstance(e)}a.ApplySolToContainer();return!!d._GetOwnInstances().length}c=d._GetOwnInstances();e=0;for(let g=0,k=c.length;g<k;++g){const l=c[g];c[e]=l;l.GetUID()===b?d._PushElseInstance(l):++e}C3$jscomp$169.truncateArray(c,e);a.ApplySolToContainer();return!!c.length}
function Destroy(){const a=GetInst(this);a.GetRuntime().DestroyInstance(a)}function OnCreated(){return!0}function OnDestroyed(){return!0}function SetInstanceVar(a,b){GetInst(this).SetInstanceVariableValue(a,b)}function AddInstanceVar(a,b){const d=GetInst(this),c=d.GetInstanceVariableValue(a);"number"===typeof c&&"number"!==typeof b?b=parseFloat(b):"string"===typeof c&&"string"!==typeof b&&(b=b.toString());d.SetInstanceVariableValue(a,c+b)}
function SubInstanceVar(a,b){const d=GetInst(this),c=d.GetInstanceVariableValue(a);"number"===typeof c&&("number"!==typeof b&&(b=parseFloat(b)),d.SetInstanceVariableValue(a,c-b))}function SetBoolInstanceVar(a,b){GetInst(this).SetInstanceVariableValue(a,b?1:0)}function ToggleBoolInstanceVar(a){const b=GetInst(this);b.SetInstanceVariableValue(a,0===b.GetInstanceVariableValue(a)?1:0)}
function LoadFromJsonString(a){let b;try{b=JSON.parse(a)}catch(d){console.error("Failed to load from JSON string: ",d);return}a=GetInst(this);a.GetRuntime().ClearIntancesNeedingAfterLoad();a._OnBeforeLoad("state");a.LoadFromJson(b,"state");a.GetRuntime().DoAfterLoad("state",{ignoreMissingInstances:!0})}function AsJSON(){return JSON.stringify(GetInst(this).SaveToJson("state"))}function ObjectTypeName(){return GetInst(this).GetObjectClass().GetName()}
function Count(){const a=GetInst(this).GetRuntime(),b=a.GetCurrentEventStackFrame().GetExpressionObjectClass();let d=b.GetInstanceCount();for(const c of a.instancesPendingCreateForObjectClass(b))++d;return d}function PickedCount(){return GetInst(this).GetRuntime().GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length}function GetIID(){return GetInst(this).GetIID()}function GetUID(){return GetInst(this).GetUID()}
C3$jscomp$169.AddCommonACEs=function(a,b){const d=a[1],c=a[4],e=a[5],g=a[6],k=a[7],l=a[8],n=a[10],p=a[11],r=a[12],w=a[13],z=a[14],B=a[15],C=a[16],E=b.Cnds,F=b.Acts,I=b.Exps;a[3]&&(E.CompareX=CompareX,E.CompareY=CompareY,E.IsOnScreen=IsOnScreen,E.IsOutsideLayout=IsOutsideLayout,E.PickDistance=PickDistance,F.SetX=SetX,F.SetY=SetY,F.SetPos=SetPos,F.SetPosToObject=SetPosToObject,F.MoveForward=MoveForward,F.MoveAtAngle=MoveAtAngle,I.X=GetX,I.Y=GetY,I.dt=GetDt);c&&(E.CompareWidth=CompareWidth,E.CompareHeight=
CompareHeight,F.SetWidth=SetWidth,F.SetHeight=SetHeight,F.SetSize=SetSize,I.Width=GetWidth,I.Height=GetHeight,I.BBoxLeft=GetBboxLeft,I.BBoxTop=GetBboxTop,I.BBoxRight=GetBboxRight,I.BBoxBottom=GetBboxBottom,I.BBoxMidX=GetBboxMidX,I.BBoxMidY=GetBboxMidY);e&&(E.AngleWithin=IsAngleWithin,E.IsClockwiseFrom=IsAngleClockwiseFrom,E.IsBetweenAngles=IsBetweenAngles,F.SetAngle=SetAngle,F.RotateClockwise=RotateClockwise,F.RotateCounterclockwise=RotateCounterclockwise,F.RotateTowardAngle=RotateTowardAngle,F.RotateTowardPosition=
RotateTowardPosition,F.SetTowardPosition=SetTowardPosition,I.Angle=GetAngle);g&&(E.IsVisible=IsVisible,E.CompareOpacity=CompareOpacity,F.SetVisible=SetVisible,F.SetOpacity=SetOpacity,F.SetDefaultColor=SetDefaultColor,I.Opacity=GetOpacity,I.ColorValue=GetColor);k&&(E.IsOnLayer=IsOnLayer,E.PickTopBottom=PickTopBottom,E.CompareZElevation=CompareZElevation,F.MoveToTop=MoveToTop,F.MoveToBottom=MoveToBottom,F.MoveToLayer=MoveToLayer,F.ZMoveToObject=ZMoveToObject,F.SetZElevation=SetZElevation,I.LayerNumber=
LayerNumber,I.LayerName=LayerName,I.ZIndex=ZIndex,I.ZElevation=ZElevation,I.TotalZElevation=TotalZElevation);l&&(E.IsEffectEnabled=IsEffectEnabled,F.SetEffectEnabled=SetEffectEnabled,F.SetEffectParam=SetEffectParam);w&&(E.HasParent=HasParent,E.HasChildren=HasChildren,E.PickParent=PickParent,E.PickChildren=PickChildren,E.PickNthChild=PickNthChild,E.CompareChildCount=CompareChildCount,F.AddChild=AddChild,F.RemoveChild=RemoveChild,F.RemoveFromParent=RemoveFromParent,I.ChildCount=ChildCount,I.AllChildCount=
AllChildCount);z&&(F.SetMeshSize=SetMeshSize,F.SetMeshPoint=SetMeshPoint,I.MeshColumns=MeshColumns,I.MeshRows=MeshRows);n&&(E.IsVisible=IsVisible,F.SetVisible=SetElementVisible,F.SetCSSStyle=SetElementCSSStyle,F.SetElemAttribute=SetElementAttribute,F.RemoveElemAttribute=RemoveElementAttribute);p&&(E.IsFocused=IsElementFocused,F.SetFocus=SetElementFocus,F.SetBlur=SetElementBlur);r&&(E.IsEnabled=IsElementEnabled,F.SetEnabled=SetElementEnabled);B&&(E.OnCollision=OnCollision,E.IsOverlapping=IsOverlapping,
E.IsOverlappingOffset=IsOverlappingOffset,b.FinishCollisionCondition=FinishCollisionCondition);d||(E.CompareInstanceVar=CompareInstanceVar,E.IsBoolInstanceVarSet=IsBoolInstanceVarSet,E.PickInstVarHiLow=PickInstVarHiLow,E.PickByUID=PickByUID,F.SetInstanceVar=SetInstanceVar,F.AddInstanceVar=AddInstanceVar,F.SubInstanceVar=SubInstanceVar,F.SetBoolInstanceVar=SetBoolInstanceVar,F.ToggleBoolInstanceVar=ToggleBoolInstanceVar,E.OnCreated=OnCreated,E.OnDestroyed=OnDestroyed,F.Destroy=Destroy,F.LoadFromJsonString||
(F.LoadFromJsonString=LoadFromJsonString),I.AsJSON||(I.AsJSON=AsJSON),I.Count=Count,I.PickedCount=PickedCount,I.IID=GetIID,I.UID=GetUID,I.ObjectTypeName=ObjectTypeName);C&&(I.TemplateName=TemplateName)};"use strict";const C3$jscomp$170=self.C3;
C3$jscomp$170.ScheduledWait=class extends C3$jscomp$170.DefendedBase{constructor(a){super();this._eventSheetManager=a;this._type="";this._time=-1;this._signalTag="";this._isSignalled=!1;this._event=null;this._actIndex=0;this._solModifiers=[];this._dynamicSolModifiers=null;this._sols=new Map;this._callingFunctionBlock=null;this._asyncId=-1;this._functionInnerLocalVars=this._functionParameters=null;this._shouldRelease=!1}Release(){this._type="";this._time=-1;this._signalTag="";this._functionInnerLocalVars=
this._functionParameters=this._callingFunctionBlock=this._event=null;this._asyncId=-1;C3$jscomp$170.clearArray(this._solModifiers);this._dynamicSolModifiers&&(this._dynamicSolModifiers.clear(),this._dynamicSolModifiers=null);for(const a of this._sols.values())a.Release();this._sols.clear()}_Init(){var a=this._eventSheetManager,b=a.GetRuntime().GetAllObjectClasses(),d=a.GetCurrentEventStackFrame();this._event=d.GetCurrentEvent();this._actIndex=d.GetActionIndex()+1;if(d=a.FindFirstFunctionBlockParent(this._event))this._callingFunctionBlock=
d,this._functionParameters=d.CaptureFunctionParameters(),this._functionInnerLocalVars=d._GetAllInnerLocalVariables().map(c=>c.GetValue()),d.IsAsync()&&(this._asyncId=d.PauseCurrentAsyncFunction());for(const c of b)if(b=c.GetCurrentSol(),!b.IsSelectAll()||this._event.HasSolModifier(c))this._solModifiers.push(c),this._sols.set(c,C3$jscomp$170.New(C3$jscomp$170.SolState,b));a=a.GetDynamicSolModifiersSet();this._dynamicSolModifiers=0<a.size?a:null}InitTimer(a){this._type="timer";this._Init();this._time=
this._eventSheetManager.GetRuntime().GetGameTime()+a}InitSignal(a){this._type="signal";this._Init();this._signalTag=a.toLowerCase()}InitPromise(a){this._type="promise";this._Init();a.then(()=>this.SetSignalled()).catch(b=>{console.warn("[C3 runtime] Promise rejected in 'Wait for previous actions to complete': ",b);this.SetSignalled()})}IsTimer(){return"timer"===this._type}IsSignal(){return"signal"===this._type}IsPromise(){return"promise"===this._type}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=
!0}_ShouldRun(){return this.IsTimer()?this._time<=this._eventSheetManager.GetRuntime().GetGameTime():this.IsSignalled()}_RestoreState(a){a._Restore(this._event,this._actIndex);for(const [b,d]of this._sols.entries()){const c=b.GetCurrentSol();d._Restore(c)}this._dynamicSolModifiers&&a.SetDynamicSolModifiers([...this._dynamicSolModifiers]);if(a=this._callingFunctionBlock)a.SetFunctionParameters(this._functionParameters),a._GetAllInnerLocalVariables().map((b,d)=>b.SetValue(this._functionInnerLocalVars[d])),
a.IsAsync()&&a.ResumeAsyncFunction(this._asyncId)}_Run(a){this._RestoreState(a);this._event._ResumeActionsAndSubEvents(a);this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId);this._eventSheetManager.ClearSol(this._solModifiers);this._shouldRelease=!0}async _DebugRun(a){this._RestoreState(a);for(const b of this._event._DebugResumeActionsAndSubEvents(a))await this._eventSheetManager.GetRuntime().DebugBreak(b);this._callingFunctionBlock&&
this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId);this._eventSheetManager.ClearSol(this._solModifiers);this._shouldRelease=!0}ShouldRelease(){return this._shouldRelease}RemoveInstances(a){for(const b of this._sols.values())b.RemoveInstances(a)}_SaveToJson(){const a={},b={t:this._time,st:this._signalTag,s:this._isSignalled,ev:this._event.GetSID(),sm:this._solModifiers.map(d=>d.GetSID()),dsm:this._dynamicSolModifiers?[...this._dynamicSolModifiers].map(d=>
d.GetSID()):null,sols:a};this._event._HasActionIndex(this._actIndex)&&(b.act=this._event.GetActionAt(this._actIndex).GetSID());for(const [d,c]of this._sols)a[d.GetSID().toString()]=c._SaveToJson();return b}static _CreateFromJson(a,b){const d=a.GetRuntime();var c=a.GetEventBlockBySID(b.ev);if(!c)return null;let e=0;if(b.hasOwnProperty("act")){var g=a.GetActionBySID(b.act);if(!g)return null;e=g.GetIndex()}g=C3$jscomp$170.New(C3$jscomp$170.ScheduledWait,a);g._time=b.t;g._type=-1===g._time?"signal":"timer";
g._signalTag=b.st;g._isSignalled=b.s;g._event=c;g._actIndex=e;for(var k of b.sm)(c=d.GetObjectClassBySID(k))&&g._solModifiers.push(c);if(Array.isArray(b.dsm))for(var l of b.dsm)if(k=d.GetObjectClassBySID(l))g._dynamicSolModifiers||(g._dynamicSolModifiers=new Set),g._dynamicSolModifiers.add(k);for(const [n,p]of Object.entries(b.sols))if(b=parseInt(n,10),b=d.GetObjectClassBySID(b))l=C3$jscomp$170.New(C3$jscomp$170.SolState,null),l._LoadFromJson(a,p),g._sols.set(b,l);return g}};"use strict";
const C3$jscomp$171=self.C3;
C3$jscomp$171.SolState=class extends C3$jscomp$171.DefendedBase{constructor(a){super();this._objectClass=null;this._isSelectAll=!0;this._instances=[];a&&(this._objectClass=a.GetObjectClass(),this._isSelectAll=a.IsSelectAll(),C3$jscomp$171.shallowAssignArray(this._instances,a._GetOwnInstances()))}Release(){this._objectClass=null;C3$jscomp$171.clearArray(this._instances)}_Restore(a){a._SetSelectAll(this._isSelectAll);C3$jscomp$171.shallowAssignArray(a._GetOwnInstances(),this._instances)}RemoveInstances(a){C3$jscomp$171.arrayRemoveAllInSet(this._instances,
a)}_SaveToJson(){return{sa:this._isSelectAll,insts:this._instances.map(a=>a.GetUID())}}_LoadFromJson(a,b){a=a.GetRuntime();this._isSelectAll=!!b.sa;C3$jscomp$171.clearArray(this._instances);for(const d of b.insts)(b=a.GetInstanceByUID(d))&&this._instances.push(b)}};"use strict";const C3$jscomp$172=self.C3;function GetNextParamMap(a,b){let d=a.get(b);d||(d=new Map,a.set(b,d));return d}
C3$jscomp$172.SDKPluginBase=class extends C3$jscomp$172.DefendedBase{constructor(a){super();this._runtime=a.runtime;this._isSingleGlobal=!!a.isSingleGlobal;this._isWorldType=!!a.isWorld;this._isRotatable=!!a.isRotatable;this._mustPredraw=!!a.mustPredraw;this._hasEffects=!!a.hasEffects;this._supportsSceneGraph=!!a.supportsSceneGraph;this._supportsMesh=!!a.supportsMesh;this._isHTMLElementType=!!a.isHTMLElementType;this._is3d=!!a.is3d;this._sdkVersion=a.sdkVersion;this._singleGlobalObjectClass=null;
this._boundACEMethodCache=new Map;this._boundACEMethodCache_1param=new Map;this._boundACEMethodCache_2params=new Map;this._boundACEMethodCache_3params=new Map;this._scriptInterfaceClass=a.scriptInterfaceClass;this._iPlugin=null}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetConstructor(){return 2<=this.GetSdkVersion()?this._iPlugin.constructor:this.constructor}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(a=!1){let b=this._scriptInterfaceClass;a&&"function"!==
typeof b&&2<=this.GetSdkVersion()&&(b=globalThis.ISDKPluginBase);return b}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsHTMLElementType(){return this._isHTMLElementType}Is3D(){return this._is3d}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(a,b){if(!b)throw Error("missing 'this' binding");
let d=this._boundACEMethodCache.get(a);if(d)return d;d=a.bind(b);this._boundACEMethodCache.set(a,d);return d}_GetBoundACEMethod_1param(a,b,d){if(!b)throw Error("missing 'this' binding");const c=GetNextParamMap(this._boundACEMethodCache_1param,a);let e=c.get(d);if(e)return e;e=a.bind(b,d);c.set(d,e);return e}_GetBoundACEMethod_2params(a,b,d,c){if(!b)throw Error("missing 'this' binding");var e=GetNextParamMap(this._boundACEMethodCache_2params,a);e=GetNextParamMap(e,d);let g=e.get(c);if(g)return g;g=
a.bind(b,d,c);e.set(c,g);return g}_GetBoundACEMethod_3params(a,b,d,c,e){if(!b)throw Error("missing 'this' binding");var g=GetNextParamMap(this._boundACEMethodCache_3params,a);g=GetNextParamMap(g,d);g=GetNextParamMap(g,c);let k=g.get(e);if(k)return k;k=a.bind(b,d,c,e);g.set(e,k);return k}_SetSingleGlobalObjectClass(a){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");this._singleGlobalObjectClass=a}GetSingleGlobalObjectClass(){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");
return this._singleGlobalObjectClass}GetSingleGlobalInstance(){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");return this._singleGlobalObjectClass.GetSingleGlobalInstance()}_InitScriptInterface(){const a=this.GetSdkVersion();C3$jscomp$172.AddonManager._PushInitObject(this,a);const b=this.GetScriptInterfaceClass(!0);if(b){if(this._iPlugin=new b,!(this._iPlugin instanceof self.IPlugin))throw new TypeError("plugin class must derive from IPlugin");}else this._iPlugin=new self.IPlugin;
C3$jscomp$172.AddonManager._PopInitObject(a)}GetIPlugin(){return this._iPlugin}};"use strict";const C3$jscomp$173=self.C3;
C3$jscomp$173.SDKDOMPluginBase=class extends C3$jscomp$173.SDKPluginBase{constructor(a,b){super(a);this._domComponentId=b;this._nextElementId=0;this._instMap=new Map;this.AddElementMessageHandler("elem-focused",d=>d._OnElemFocused());this.AddElementMessageHandler("elem-blurred",d=>{d&&d._OnElemBlurred()})}Release(){super.Release()}_AddElement(a){const b=this._nextElementId++;this._instMap.set(b,a);return b}_RemoveElement(a){this._instMap.delete(a)}AddElementMessageHandler(a,b){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,
a,d=>{const c=this._instMap.get(d.elementId);b(c,d)})}};"use strict";const C3$jscomp$174=self.C3;
C3$jscomp$174.SDKTypeBase=class extends C3$jscomp$174.DefendedBase{constructor(a){super();this._objectClass=a;this._runtime=a.GetRuntime();this._plugin=a.GetPlugin()}Release(){this._plugin=this._runtime=this._objectClass=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}OnCreate(){}FinishCondition(a){}BeforeRunAction(a){}AfterRunAction(a){}LoadTextures(a){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(a){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}DispatchScriptEvent(a,b,
d){a=C3$jscomp$174.New(C3$jscomp$174.Event,a,b);a.objectClass=this;d&&Object.assign(a,d);this.GetObjectClass().DispatchUserScriptEvent(a)}};"use strict";const C3$jscomp$175=self.C3;
C3$jscomp$175.SDKInstanceBase=class extends C3$jscomp$175.DefendedBase{constructor(a,b){super();this._inst=a;this._domComponentId=b;this._wrapperComponentId=null;this._runtime=a.GetRuntime();this._objectClass=this._inst.GetObjectClass();this._sdkType=this._objectClass.GetSdkType();this._tick2Func=this._tickFunc=null;this._isTicking2=this._isTicking=!1;this._disposables=null;this._wasReleased=!1}Release(){this._wasReleased=!0;this._StopTicking();this._StopTicking2();this._tick2Func=this._tickFunc=
null;this._disposables&&(this._disposables.Release(),this._disposables=null);this._sdkType=this._objectClass=this._runtime=this._inst=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(a){return this._runtime.Trigger(a,this._inst,null)}DebugTrigger(a){return this._runtime.DebugTrigger(a,
this._inst,null)}TriggerAsync(a){return this._runtime.TriggerAsync(a,this._inst,null)}FastTrigger(a,b){return this._runtime.FastTrigger(a,this._inst,b)}DebugFastTrigger(a,b){return this._runtime.DebugFastTrigger(a,this._inst,b)}ScheduleTriggers(a){return this._runtime.ScheduleTriggers(a)}AddDOMMessageHandler(a,b){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,a,b)}AddDOMMessageHandlers(a){for(const [b,d]of a)this.AddDOMMessageHandler(b,d)}PostToDOM(a,b){this._runtime.PostComponentMessageToDOM(this._domComponentId,
a,b)}PostToDOMAsync(a,b){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,a,b)}_PostToDOMMaybeSync(a,b){if(this._runtime.IsInWorker())this.PostToDOM(a,b);else return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._domComponentId,handler:a,data:b,responseId:null})}SetWrapperExtensionComponentId(a){if(!a)throw Error("cannot set empty component id");this._wrapperComponentId=a}IsWrapperExtensionAvailable(){if(!this._wrapperComponentId)throw Error("wrapper extension component id not set");
return this._runtime.HasWrapperComponentId(this._wrapperComponentId)}AddWrapperExtensionMessageHandler(a,b){if(!this._wrapperComponentId)throw Error("wrapper extension component id not set");this._runtime.AddWrapperExtensionMessageHandler(this._wrapperComponentId,a,b)}AddWrapperExtensionMessageHandlers(a){for(const [b,d]of a)this.AddWrapperExtensionMessageHandler(b,d)}SendWrapperExtensionMessage(a,b){if(!this._wrapperComponentId)throw Error("wrapper extension component id not set");this._runtime.SendWrapperExtensionMessage(this._wrapperComponentId,
a,b)}SendWrapperExtensionMessageAsync(a,b){if(!this._wrapperComponentId)throw Error("wrapper extension component id not set");return this._runtime.SendWrapperExtensionMessageAsync(this._wrapperComponentId,a,b)}Tick(){}Tick2(){}_StartTicking(){this._isTicking||(this._tickFunc||(this._tickFunc=()=>this.Tick()),this._runtime.Dispatcher().addEventListener("tick",this._tickFunc),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc),this._isTicking=
!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._tick2Func||(this._tick2Func=()=>this.Tick2()),this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(a){}GetPropertyValueByIndex(a){}SetPropertyValueByIndex(a,
b){}OffsetPropertyValueByIndex(a,b,d){if(0!==b){var c=this.GetPropertyValueByIndex(a);if("number"!==typeof c)throw Error("expected number");this.SetPropertyValueByIndex(a,c+b,d)}}SetPropertyColorOffsetValueByIndex(a,b,d,c){}CallAction(a,...b){a.call(this,...b)}CallExpression(a,...b){return a.call(this,...b)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(a,b,d){if(this._inst.HasScriptInterface()){var c=this.GetScriptInterface();a=C3$jscomp$175.New(C3$jscomp$175.Event,a,b);a.instance=c;d&&
Object.assign(a,d);c.dispatchEvent(a)}}MustPreDraw(){return!1}};"use strict";const C3$jscomp$176=self.C3;
C3$jscomp$176.SDKWorldInstanceBase=class extends C3$jscomp$176.SDKInstanceBase{constructor(a,b){super(a,b);this._worldInfo=a.GetWorldInfo();this._renderercontextrestored_handler=this._renderercontextlost_handler=null}Release(){if(this._renderercontextlost_handler){const a=this._runtime.Dispatcher();a.removeEventListener("renderercontextlost",this._renderercontextlost_handler);a.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler);this._renderercontextrestored_handler=
this._renderercontextlost_handler=null}this._worldInfo=null;super.Release()}HandleWebGLContextLoss(){this.HandleRendererContextLoss()}OnWebGLContextLost(){}OnWebGLContextRestored(){}HandleRendererContextLoss(){if(!this._renderercontextlost_handler){this._renderercontextlost_handler=()=>this.OnRendererContextLost();this._renderercontextrestored_handler=()=>this.OnRendererContextRestored();var a=this._runtime.Dispatcher();a.addEventListener("renderercontextlost",this._renderercontextlost_handler);a.addEventListener("renderercontextrestored",
this._renderercontextrestored_handler)}}OnRendererContextLost(){this.OnWebGLContextLost()}OnRendererContextRestored(){this.OnWebGLContextRestored()}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return!1}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw Error("original size not known");const a=this.GetCurrentImageInfo();if(a)return a.GetWidth()}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw Error("original size not known");const a=this.GetCurrentImageInfo();if(a)return a.GetHeight()}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){var a=
this.GetCurrentImageInfo();return a&&(a=a.GetTexture())?[a.GetWidth(),a.GetHeight()]:[100,100]}GetCurrentTexRect(){const a=this.GetCurrentImageInfo();return a?a.GetTexRect():null}GetCurrentTexQuad(){const a=this.GetCurrentImageInfo();return a?a.GetTexQuad():null}IsCurrentTexRotated(){const a=this.GetCurrentImageInfo();return a?a.IsRotated():!1}GetImagePoint(a){a=this._inst.GetWorldInfo();return[a.GetX(),a.GetY(),a.GetTotalZElevation()]}LoadTilemapData(a,b,d){}TestPointOverlapTile(a,b){}RendersToOwnZPlane(){return!0}};
"use strict";const C3$jscomp$177=self.C3,tempRect$jscomp$6=C3$jscomp$177.New(C3$jscomp$177.Rect);
C3$jscomp$177.SDKDOMInstanceBase=class extends C3$jscomp$177.SDKWorldInstanceBase{constructor(a,b){super(a,b);this._elementId=this.GetPlugin()._AddElement(this);this._isElementShowing=!0;this._autoFontSize=this._elemHasFocus=!1;this._autoFontSizeOffset=-.2;this._lastRect=C3$jscomp$177.New(C3$jscomp$177.Rect,0,0,-1,-1);a=this._runtime.GetCanvasManager();this._lastWindowWidth=a.GetLastWidth();this._lastWindowHeight=a.GetLastHeight();this._lastHTMLZIndex=this._lastHTMLIndex=-1;this._isPendingUpdateState=
!1;this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId);this.PostToDOMElement("destroy");this._elementId=-1;super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(a,b){b||(b={});b.elementId=this._elementId;this.PostToDOM(a,b)}_PostToDOMElementMaybeSync(a,b){b||(b={});b.elementId=this._elementId;return this._PostToDOMMaybeSync(a,b)}PostToDOMElementAsync(a,
b){b||(b={});b.elementId=this._elementId;return this.PostToDOMAsync(a,b)}CreateElement(a){a||(a={});const b=this.GetWorldInfo();a.elementId=this._elementId;a.isVisible=b.IsVisible();a.htmlIndex=b.GetLayer().GetHTMLIndex();a.htmlZIndex=b.GetHTMLZIndex();Object.assign(a,this.GetElementState());this._isElementShowing=!!a.isVisible;this._PostToDOMMaybeSync("create",a);this._UpdatePosition(!0)}SetElementVisible(a){a=!!a;this._isElementShowing!==a&&(this._isElementShowing=a,this.PostToDOMElement("set-visible",
{isVisible:a}))}Tick(){this._UpdatePosition(!1)}_ShouldPreserveElement(){const a=this._runtime.GetCanvasManager().GetFullscreenMode();return"Android"===C3$jscomp$177.Platform.OS&&("scale-inner"===a||"scale-outer"===a||"crop"===a)}_UpdatePosition(a){if(!this.GetInstance().IsDestroyed()){var b=this.GetWorldInfo(),d=b.GetLayer(),c=b.GetBoundingBox(),[e,g]=d.LayerToCanvasCss(c.getLeft(),c.getTop()),[k,l]=d.LayerToCanvasCss(c.getRight(),c.getBottom()),n=this._runtime.GetCanvasManager();c=n.GetCssWidth();
var p=n.GetCssHeight();b.IsVisible()&&d.IsVisible()?!this._ShouldPreserveElement()&&(0>=k||0>=l||e>=c||g>=p)?this.SetElementVisible(!1):(tempRect$jscomp$6.set(e,g,k,l),c=n.GetLastWidth(),p=n.GetLastHeight(),n=d.GetHTMLIndex(),b=b.GetHTMLZIndex(),!a&&tempRect$jscomp$6.equals(this._lastRect)&&this._lastWindowWidth===c&&this._lastWindowHeight===p&&this._lastHTMLIndex===n&&this._lastHTMLZIndex===b?this.SetElementVisible(!0):(this._lastRect.copy(tempRect$jscomp$6),this._lastWindowWidth=c,this._lastWindowHeight=
p,this._lastHTMLIndex=n,this._lastHTMLZIndex=b,this.SetElementVisible(!0),a=null,this._autoFontSize&&(a=d.GetDisplayScale()+this._autoFontSizeOffset),this.PostToDOMElement("update-position",{left:Math.round(this._lastRect.getLeft()),top:Math.round(this._lastRect.getTop()),width:Math.round(this._lastRect.width()),height:Math.round(this._lastRect.height()),htmlIndex:n,htmlZIndex:b,fontSize:a}))):this.SetElementVisible(!1)}}FocusElement(){this._PostToDOMElementMaybeSync("focus",{focus:!0})}BlurElement(){this._PostToDOMElementMaybeSync("focus",
{focus:!1})}_OnElemFocused(){this._elemHasFocus=!0}_OnElemBlurred(){this._elemHasFocus=!1}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(a,b){this.PostToDOMElement("set-css-style",{prop:C3$jscomp$177.CSSToCamelCase(a),val:b})}SetElementAttribute(a,b){this.PostToDOMElement("set-attribute",{name:a,val:b})}RemoveElementAttribute(a){this.PostToDOMElement("remove-attribute",{name:a})}UpdateElementState(){this._isPendingUpdateState||(this._isPendingUpdateState=!0,Promise.resolve().then(()=>
{this._isPendingUpdateState=!1;this.PostToDOMElement("update-state",this.GetElementState())}))}GetElementState(){}GetElementId(){return this._elementId}};"use strict";const C3$jscomp$178=self.C3,IBehavior$jscomp$1=self.IBehavior;
C3$jscomp$178.SDKBehaviorBase=class extends C3$jscomp$178.DefendedBase{constructor(a){super();this._runtime=a.runtime;this._myObjectClasses=C3$jscomp$178.New(C3$jscomp$178.ArraySet);this._myInstances=C3$jscomp$178.New(C3$jscomp$178.ArraySet);this._sdkVersion=a.sdkVersion;this._scriptInterfaceClass=a.scriptInterfaceClass;this._iBehavior=null}Release(){this._myInstances.Release();this._myObjectClasses.Release();this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(a=
!1){let b=this._scriptInterfaceClass;a&&"function"!==typeof b&&2<=this.GetSdkVersion()&&(b=globalThis.ISDKBehaviorBase);return b}_AddObjectClass(a){this._myObjectClasses.Add(a)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(a){this._myInstances.Add(a)}_RemoveInstance(a){this._myInstances.Delete(a)}GetInstances(){return this._myInstances.GetArray()}_InitScriptInterface(){const a=this.GetSdkVersion();C3$jscomp$178.AddonManager._PushInitObject(this,a);const b=this.GetScriptInterfaceClass(!0);
if(b){if(this._iBehavior=new b,!(this._iBehavior instanceof IBehavior$jscomp$1))throw new TypeError("behavior class must derive from IBehavior");}else this._iBehavior=new IBehavior$jscomp$1;C3$jscomp$178.AddonManager._PopInitObject(a)}GetIBehavior(){return this._iBehavior}};"use strict";const C3$jscomp$179=self.C3;
C3$jscomp$179.SDKBehaviorTypeBase=class extends C3$jscomp$179.DefendedBase{constructor(a){super();this._runtime=a.GetRuntime();this._behaviorType=a;this._objectClass=a.GetObjectClass();this._behavior=a.GetBehavior();this._behavior._AddObjectClass(this._objectClass)}Release(){this._behavior=this._objectClass=this._behaviorType=this._runtime=null}OnCreate(){}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}};
"use strict";const C3$jscomp$180=self.C3;
C3$jscomp$180.SDKBehaviorInstanceBase=class extends C3$jscomp$180.DefendedBase{constructor(a,b){super();this._behInst=a;this._domComponentId=b;this._inst=a.GetObjectInstance();this._runtime=a.GetRuntime();this._behaviorType=a.GetBehaviorType();this._sdkType=this._behaviorType.GetSdkType();this._isPostTicking=this._isTicking2=this._isTicking=!1;this._disposables=null}Release(){this._StopTicking();this._StopTicking2();this._StopPostTicking();this._disposables&&(this._disposables.Release(),this._disposables=
null);this._sdkType=this._behaviorType=this._runtime=this._inst=this._behInst=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(a){return this._runtime.Trigger(a,
this._inst,this._behaviorType)}DebugTrigger(a){return this._runtime.DebugTrigger(a,this._inst,this._behaviorType)}TriggerAsync(a){return this._runtime.TriggerAsync(a,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){this._isTicking||(this._runtime._AddBehInstToTick(this),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime._RemoveBehInstToTick(this),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._runtime._AddBehInstToTick2(this),
this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime._RemoveBehInstToTick2(this),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}_StartPostTicking(){this._isPostTicking||(this._runtime._AddBehInstToPostTick(this),this._isPostTicking=!0)}_StopPostTicking(){this._isPostTicking&&(this._runtime._RemoveBehInstToPostTick(this),this._isPostTicking=!1)}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(a,b){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,
a,b)}OnSpriteFrameChanged(a,b){}SaveToJson(){return null}LoadFromJson(a){}GetPropertyValueByIndex(a){}SetPropertyValueByIndex(a,b){}OffsetPropertyValueByIndex(a,b){if(0!==b){var d=this.GetPropertyValueByIndex(a);if("number"!==typeof d)throw Error("expected number");this.SetPropertyValueByIndex(a,d+b)}}SetPropertyColorOffsetValueByIndex(a,b,d,c){}CallAction(a,...b){a.call(this,...b)}CallExpression(a,...b){return a.call(this,...b)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(a,b,d){if(this._behInst.HasScriptInterface()){var c=
this.GetScriptInterface();a=C3$jscomp$180.New(C3$jscomp$180.Event,a,b);a.behaviorInstance=c;a.instance=c.instance;d&&Object.assign(a,d);c.dispatchEvent(a)}}};"use strict";const C3$jscomp$181=self.C3;C3$jscomp$181.Plugins={};C3$jscomp$181.Behaviors={};const internalApiToken$jscomp$14=C3$jscomp$181._GetInternalAPIToken();function ValidateInternalAPIToken(a){if(a!==internalApiToken$jscomp$14)throw Error("invalid internal API token");}
let initObjectStack=[],initObjectStack2=[],initPropertiesStack=[],originalPushInitObject=null,originalPopInitObject=null,originalGetInitObject=null,originalGetInitObject2=null;const pluginsByCtor=new Map,behaviorsByCtor=new Map;
C3$jscomp$181.AddonManager=class extends C3$jscomp$181.DefendedBase{constructor(a,b){super();this._runtime=a;this._allPlugins=[];this._systemPlugin=null;this._allBehaviors=[];this._delayCreateBehaviors=new Map;this._jumpthruBehavior=this._solidBehavior=null;this._wrapperComponentIds=new Set(b)}CreatePlugin(a){const b=a[19],d=this._runtime.GetObjectReference(a[0]);if(!d)throw Error("missing plugin");C3$jscomp$181.AddCommonACEs(a,d);a=C3$jscomp$181.New(2<=b?C3$jscomp$181.SDKPluginBase:d,{runtime:this._runtime,
isSingleGlobal:a[1],isWorld:a[2],isRotatable:a[5],hasEffects:a[8],mustPredraw:a[9],supportsSceneGraph:a[13],supportsMesh:a[14],isHTMLElementType:a[17],is3d:a[18],sdkVersion:b,scriptInterfaceClass:2<=b?d:null});a.OnCreate();this._allPlugins.push(a);pluginsByCtor.set(d,a)}CreateSystemPlugin(){this._systemPlugin=C3$jscomp$181.New(C3$jscomp$181.Plugins.System,{runtime:this._runtime,isSingleGlobal:!0});this._systemPlugin.OnCreate()}CreateBehavior(a){const b=a[1],d=this._runtime.GetObjectReference(a[0]);
if(!d)throw Error("missing behavior");this._delayCreateBehaviors.set(d,()=>{const c=C3$jscomp$181.New(2<=b?C3$jscomp$181.SDKBehaviorBase:d,{runtime:this._runtime,sdkVersion:b,scriptInterfaceClass:2<=b?d:null});c.OnCreate();this._allBehaviors.push(c);behaviorsByCtor.set(d,c);!this._solidBehavior&&C3$jscomp$181.Behaviors.solid&&c instanceof C3$jscomp$181.Behaviors.solid?this._solidBehavior=c:!this._jumpthruBehavior&&C3$jscomp$181.Behaviors.jumpthru&&c instanceof C3$jscomp$181.Behaviors.jumpthru&&(this._jumpthruBehavior=
c);c._InitScriptInterface()})}_DelayCreateBehavior(a){const b=this._delayCreateBehaviors.get(a);b&&(b(),this._delayCreateBehaviors.delete(a))}static _PushInitObject(a,b=1){if(C3$jscomp$181.AddonManager._PushInitObject!==originalPushInitObject)throw Error("invalid method");1===b&&initObjectStack.push(a);initObjectStack2.push(a)}static _PopInitObject(a=1){if(C3$jscomp$181.AddonManager._PopInitObject!==originalPopInitObject)throw Error("invalid method");1===a&&initObjectStack.pop();initObjectStack2.pop()}static _GetInitObject(){if(C3$jscomp$181.AddonManager._GetInitObject!==
originalGetInitObject)throw Error("invalid method");if(0===initObjectStack.length)throw Error("no init object set");return initObjectStack.at(-1)}static _GetInitObject2(a){if(C3$jscomp$181.AddonManager._GetInitObject2!==originalGetInitObject2)throw Error("invalid method");ValidateInternalAPIToken(a);if(0===initObjectStack2.length)throw Error("no init object set");return initObjectStack2.at(-1)}static _PushInitProperties(a){initPropertiesStack.push(a)}static _PopInitProperties(){initPropertiesStack.pop()}static _GetInitProperties(){if(0===
initPropertiesStack.length)throw Error("no init properties set");return initPropertiesStack.at(-1)}_InitAddonScriptInterfaces(){for(const a of this._allPlugins)a._InitScriptInterface()}static GetPluginByConstructorFunction(a){return pluginsByCtor.get(a)||null}static GetBehaviorByConstructorFunction(a){return behaviorsByCtor.get(a)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}HasWrapperComponentId(a){return this._wrapperComponentIds.has(a)}};
originalPushInitObject=C3$jscomp$181.AddonManager._PushInitObject;originalPopInitObject=C3$jscomp$181.AddonManager._PopInitObject;originalGetInitObject=C3$jscomp$181.AddonManager._GetInitObject;originalGetInitObject2=C3$jscomp$181.AddonManager._GetInitObject2;"use strict";const C3$jscomp$182=self.C3,allImageInfos=new Set;
C3$jscomp$182.ImageInfo=class extends C3$jscomp$182.DefendedBase{constructor(){super();this._generation=0;this._url="";this._height=this._width=this._offsetY=this._offsetX=this._size=0;this._hasMetaData=this._isRotated=!1;this._imageAsset=null;this._textureState="";this._rcTex=C3$jscomp$182.New(C3$jscomp$182.Rect);this._quadTex=C3$jscomp$182.New(C3$jscomp$182.Quad);this._blobUrl="";this._iImageInfo=new self.IImageInfo(this);allImageInfos.add(this)}Release(){this.ReleaseTexture();this._imageAsset&&
0===this._imageAsset.GetRefCount()&&this._imageAsset.Release();this._imageAsset=null;allImageInfos.delete(this);this.ReleaseBlobURL()}static OnRendererContextLost(){for(const a of allImageInfos)a._textureState="",a._rcTex.set(0,0,0,0),a._quadTex.setFromRect(a._rcTex)}LoadData(a){this._url=a[0];this._size=a[1];this._offsetX=a[2];this._offsetY=a[3];this._width=a[4];this._height=a[5];this._isRotated=a[6];this._hasMetaData=!0}LoadDynamicAsset(a,b){if(this._imageAsset)throw Error("already loaded asset");
this._url=b;const d={};C3$jscomp$182.IsAbsoluteURL(b)&&(d.loadPolicy="remote");this.LoadAsset(a,d);return this._imageAsset.Load()}LoadDynamicBlobAsset(a,b){if(this._imageAsset)throw Error("already loaded asset");this._url="";this._size=b.size;this._imageAsset=C3$jscomp$182.New(C3$jscomp$182.ImageAsset,a.GetAssetManager(),{blob:b,size:this._size,loadPolicy:"local"})}ReplaceWith(a){if(a===this)throw Error("cannot replace with self");this._generation++;this.ReleaseTexture();this._url=a._url;this._size=
a._size;this._offsetX=a._offsetX;this._offsetY=a._offsetY;this._width=a._width;this._height=a._height;this._isRotated=a._isRotated;this._hasMetaData=a._hasMetaData;this._imageAsset=a._imageAsset;this._textureState=a._textureState;this._rcTex=a._rcTex;this._quadTex=a._quadTex;this.ReleaseBlobURL()}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(a,
b){if(this._imageAsset)throw Error("already got asset");b=Object.assign({},b,{url:this.GetURL(),size:this.GetSize()});this._imageAsset=a.LoadImage(b)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(a,b){if(!this._imageAsset)throw Error("no asset");if(this._textureState)throw Error("already loaded texture");const d=this._generation;this._textureState="loading";a=await this._imageAsset.LoadStaticTexture(a,b);if(this._generation!==d)return null;if(!a)return this._textureState=
"",null;this._textureState="loaded";this._hasMetaData||(this._width=a.GetWidth(),this._height=a.GetHeight(),this._hasMetaData=!0);this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+(this._isRotated?this._height:this._width),this._offsetY+(this._isRotated?this._width:this._height));this._rcTex.divide(a.GetWidth(),a.GetHeight());this._quadTex.setFromRect(this._rcTex);this._isRotated&&this._quadTex.rotatePointsAnticlockwise();return a}ReleaseTexture(){this._textureState&&(this._imageAsset&&this._imageAsset.ReleaseTexture(),
this._textureState="",this._rcTex.set(0,0,0,0),this._quadTex.setFromRect(this._rcTex))}GetTexture(){return this._imageAsset&&"loaded"===this._textureState?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}GetIImageInfo(){return this._iImageInfo}GetImageAsset(){return this._imageAsset}async ExtractImageToCanvas(a){a||(a=await this._imageAsset.LoadToDrawable());const b=C3$jscomp$182.CreateCanvas(this._width,this._height),d=b.getContext("2d");this._isRotated?
(d.rotate(Math.PI/-2),d.translate(-this._height,0),d.drawImage(a,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width)):d.drawImage(a,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height);return b}async ExtractImageToBlobURL(a){if(this._blobUrl)return this._blobUrl;a=await this.ExtractImageToCanvas(a);a=await C3$jscomp$182.CanvasToBlob(a);return this._blobUrl=URL.createObjectURL(a)}ReleaseBlobURL(){this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),
this._blobUrl="")}};"use strict";const C3$jscomp$183=self.C3;
C3$jscomp$183.AnimationInfo=class extends C3$jscomp$183.DefendedBase{constructor(a){super();this._name=a[0];this._speed=a[1];this._isLooping=!!a[2];this._repeatCount=a[3];this._repeatTo=a[4];this._isPingPong=!!a[5];this._sid=a[6];this._frames=a[7].map(b=>C3$jscomp$183.New(C3$jscomp$183.AnimationFrameInfo,b));this._iAnimation=new self.IAnimation(this)}static CreateDynamic(a,b){b=C3$jscomp$183.New(C3$jscomp$183.AnimationInfo,[b,0,!1,0,0,!1,Math.floor(1E15*Math.random()),[]]);b._frames.push(C3$jscomp$183.AnimationFrameInfo.CreateDynamic(a));
return b}Release(){for(const a of this._frames)a.Release();C3$jscomp$183.clearArray(this._frames)}LoadAllAssets(a){for(const b of this._frames)b.GetImageInfo().LoadAsset(a)}LoadAllTextures(a,b){return Promise.all(this._frames.map(d=>d.GetImageInfo().LoadStaticTexture(a,b)))}ReleaseAllTextures(){for(const a of this._frames)a.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(a){a=
Math.floor(a);if(0>a||a>=this._frames.length)throw new RangeError("invalid frame");return this._frames[a]}InsertFrameAt(a,b){b=Math.floor(b);0>b?this._frames.unshift(a):b>=this._frames.length?this._frames.push(a):this._frames.splice(b,0,a)}RemoveFrameAt(a){a=Math.floor(a);if(0>a||a>=this._frames.length)throw new RangeError("invalid frame");this._frames[a].Release();this._frames.splice(a,1)}GetFrameIndexByTag(a){for(let b=0,d=this._frames.length;b<d;++b)if(C3$jscomp$183.equalsNoCase(this._frames[b].GetTag(),
a))return b;return-1}FrameTagOrIndexToIndex(a){if("string"===typeof a){const b=this.GetFrameIndexByTag(a);if(-1===b)throw Error(`cannot find animation frame with tag ${a}`);return b}return a}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}GetIAnimation(){return this._iAnimation}};"use strict";
const C3$jscomp$184=self.C3,EMPTY_IMAGE_BLOB=(()=>{const a=atob("iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAANQTFRFAAAAp3o92gAAAAF0Uk5TAEDm2GYAAAATSURBVBgZYxgFo2AUjIJRQFcAAAV4AAHcRQIbAAAAAElFTkSuQmCC"),b=new Uint8Array(a.length);for(let d=0,c=a.length;d<c;++d)b[d]=a.charCodeAt(d);return new Blob([b],{type:"image/png"})})();
C3$jscomp$184.AnimationFrameInfo=class extends C3$jscomp$184.DefendedBase{constructor(a){super();this._imageInfo=C3$jscomp$184.New(C3$jscomp$184.ImageInfo);this._imageInfo.LoadData(a);this._duration=a[7];this._origin=C3$jscomp$184.New(C3$jscomp$184.Vector2,a[8],a[9]);this._imagePoints=a[10].map(d=>C3$jscomp$184.New(C3$jscomp$184.ImagePoint,this,d));this._imagePointsByName=new Map;for(var b of this._imagePoints)this._imagePointsByName.set(b.GetName().toLowerCase(),b);this._collisionPoly=null;b=a[11];
6<=b.length&&(this._collisionPoly=C3$jscomp$184.New(C3$jscomp$184.CollisionPoly,b));this._tag=a[12]?a[12]:"";this._iAnimationFrame=new self.IAnimationFrame(this)}static CreateDynamic(a){const b=C3$jscomp$184.New(C3$jscomp$184.AnimationFrameInfo,["",0,0,0,100,100,!1,1,0,0,[],[],""]);b._imageInfo.LoadDynamicBlobAsset(a,EMPTY_IMAGE_BLOB);return b}Release(){this._collisionPoly&&(this._collisionPoly.Release(),this._collisionPoly=null);this._imageInfo.Release();this._imageInfo=null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(a){return this._imagePointsByName.get(a.toLowerCase())||
null}GetImagePointByIndex(a){a=Math.floor(a);return 0>a||a>=this._imagePoints.length?null:this._imagePoints[a]}GetImagePointCount(){return this._imagePoints.length}GetTag(){return this._tag}GetIAnimationFrame(){return this._iAnimationFrame}};"use strict";const C3$jscomp$185=self.C3;C3$jscomp$185.ImagePoint=class extends C3$jscomp$185.DefendedBase{constructor(a,b){super();this._afi=a;this._name=b[0];this._pos=C3$jscomp$185.New(C3$jscomp$185.Vector2,b[1],b[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}};
"use strict";const C3$jscomp$186=self.C3,C3Debugger$jscomp$1=self.C3Debugger,IObjectClass$jscomp$1=self.IObjectClass;
C3$jscomp$186.ObjectClass=class extends C3$jscomp$186.DefendedBase{constructor(a,b,d){super();var c=a.GetObjectReference(d[1]);this._runtime=a;this._plugin=C3$jscomp$186.AddonManager.GetPluginByConstructorFunction(c);this._sdkType=null;this._instSdkCtor=c.Instance;this._index=b;this._sid=d[11];this._name=d[0];this._jsPropName=this._runtime.GetJsPropName(d[14]);this._isGlobal=!!d[9];this._isFamily=!!d[2];this._isOnLoaderLayout=!!d[10];this._instVars=d[3].map(k=>({sid:k[0],type:k[1],name:k[2],jsPropName:a.GetJsPropName(k[3])}));
this._behaviorsCount=d[4];this._effectsCount=d[5];this._isWorldType=this._plugin.IsWorldType();this._dispatcher=C3$jscomp$186.New(C3$jscomp$186.Event.Dispatcher);this._effectList=null;const [e,g]=a.GetCollisionEngine().GetCollisionCellSize();this._collisionGrid=C3$jscomp$186.New(C3$jscomp$186.SparseGrid,e,g);this._anyCollisionCellChanged=!0;this._anyInstanceParallaxed=!1;this._familyMembersSet=this._familyMembers=null;this._familyIndex=-1;this._familyEffectMap=this._familyBehaviorMap=this._familyInstVarMap=
this._familiesSet=this._families=null;this._isInContainer=!1;this._container=null;this._behaviorTypes=d[8].map(k=>C3$jscomp$186.BehaviorType.Create(this,k));this._behaviorTypesIncludingInherited=[];this._behaviorsByName=new Map;this._behaviorNameToIndex=new Map;this._usedBehaviorCtors=new Set;this._customActionMap=new Map;this._solStack=C3$jscomp$186.New(C3$jscomp$186.SolStack,this);this._defaultInstanceData=null;this._defaultLayerIndex=0;this._isContained=!1;this._animationsBySid=this._animationsByName=
this._animations=this._imageInfo=this._container=null;this._textureRefCount=0;this._savedData=new Map;this._unsavedData=new Map;this._instances=[];this._iidsStale=!0;this._plugin.HasEffects()&&(this._effectList=C3$jscomp$186.New(C3$jscomp$186.EffectList,this,d[12]));d[6]&&(this._imageInfo=C3$jscomp$186.New(C3$jscomp$186.ImageInfo),this._imageInfo.LoadData(d[6]));if(d[7]){this._animations=d[7].map(k=>C3$jscomp$186.New(C3$jscomp$186.AnimationInfo,k));this._animationsByName=new Map;this._animationsBySid=
new Map;for(const k of this._animations)this._animationsByName.set(k.GetName().toLowerCase(),k),this._animationsBySid.set(k.GetSID(),k)}this._isFamily?(this._familyMembers=[],this._familyMembersSet=new Set,this._familyIndex=this._runtime._GetNextFamilyIndex()):(this._families=[],this._familiesSet=new Set,this._familyInstVarMap=[],this._familyBehaviorMap=[],this._familyEffectMap=[]);b=this._plugin.GetSdkVersion();if(2>b&&(this._sdkType=C3$jscomp$186.New(c.Type,this,d[15]),!(this._sdkType instanceof
C3$jscomp$186.SDKTypeBase)))throw Error("v1 sdk type must derive from SDKTypeBase");this._instanceUserScriptClass=this._iObjectClass=null;this._userScriptDispatcher=C3$jscomp$186.New(C3$jscomp$186.Event.Dispatcher);C3$jscomp$186.AddonManager._PushInitObject(this,b);2<=b?(c=c.Type,c||(c=globalThis.ISDKObjectTypeBase)):c=this._sdkType.GetScriptInterfaceClass();if(c){this._iObjectClass=new c(2>b?this:null);if(2>b&&!(this._iObjectClass instanceof IObjectClass$jscomp$1))throw new TypeError("script interface class must derive from IObjectClass");
if(2<=b&&!(this._iObjectClass instanceof globalThis.ISDKObjectTypeBase))throw new TypeError("script interface class must derive from ISDKObjectTypeBase");}else this._iObjectClass=new IObjectClass$jscomp$1;C3$jscomp$186.AddonManager._PopInitObject(b);d[13]&&(c=d[13])&&this._sdkType.LoadTilemapData(c[0],c[1],c[2]);this._runtime.UsesLoaderLayout()&&!this._isFamily&&!this._isOnLoaderLayout&&this._isWorldType||this.OnCreate();this._plugin.IsSingleGlobal()&&(this._plugin._SetSingleGlobalObjectClass(this),
this._CreateSingleGlobalInstance(d));this._loadInstancesJson=null}static Create(a,b,d){return C3$jscomp$186.New(C3$jscomp$186.ObjectClass,a,b,d)}Release(){this._dispatcher.Release();this._dispatcher=null;this._imageInfo&&(this._imageInfo.Release(),this._imageInfo=null);if(this._animations){for(const a of this._animations)a.Release();C3$jscomp$186.clearArray(this._animations);this._animationsByName.clear();this._animationsBySid.clear()}this._loadInstancesJson=null;this._solStack.Release();this._solStack=
null;this._savedData.clear();this._unsavedData.clear();this._runtime=this._container=null}_LoadFamily(a){for(let b=1,d=a.length;b<d;++b){const c=this._runtime.GetObjectClassByIndex(a[b]);this._familyMembers.push(c);this._familyMembersSet.add(c);c._families.push(this);c._familiesSet.add(this)}}_SetContainer(a){this._isInContainer=!0;this._container=a}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){var a=0;if(!this._isFamily)for(var b of this._families)for(var d of b.GetBehaviorTypes()){const g=
d.GetName().toLowerCase();this._behaviorsByName.set(g,d);this._behaviorNameToIndex.set(g,a);this._behaviorTypesIncludingInherited.push(d);++a}for(var c of this.GetBehaviorTypes())b=c.GetName().toLowerCase(),this._behaviorsByName.set(b,c),this._behaviorNameToIndex.set(b,a),this._behaviorTypesIncludingInherited.push(c),++a;for(var e of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(e.GetBehavior().constructor);if(!this._isFamily&&this._families.length){a=this._runtime.GetFamilyCount();
C3$jscomp$186.extendArray(this._familyInstVarMap,a,0);C3$jscomp$186.extendArray(this._familyBehaviorMap,a,0);C3$jscomp$186.extendArray(this._familyEffectMap,a,0);a=[];b=e=c=0;for(const g of this._families)if(d=g.GetFamilyIndex(),this._familyInstVarMap[d]=c,c+=g.GetInstanceVariablesCount(),this._familyBehaviorMap[d]=e,e+=g.GetBehaviorTypesCount(),this._familyEffectMap[d]=b,b+=g.GetEffectTypesCount(),(d=g.GetEffectList())&&this._effectList)for(const k of d.GetAllEffectTypes())a.push(k.Clone(this._effectList));
this._effectList&&this._effectList.PrependEffectTypes(a)}}_CreateSingleGlobalInstance(a){const b=this._runtime._GetNewUID(),d=C3$jscomp$186.New(C3$jscomp$186.Instance,{runtime:this._runtime,objectType:this,uid:b});d._CreateSdkInstance(a[16],[]);this._runtime._MapInstanceByUID(b,d);this._instances.push(d)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}Dispatcher(){return this._dispatcher}OnCreate(){this._isFamily||(this._sdkType?this._sdkType.OnCreate():this._iObjectClass._onCreate())}HasLoadedTextures(){return 0<
this._textureRefCount}async LoadTextures(a){this._isFamily||(this._textureRefCount++,1===this._textureRefCount&&(this._sdkType?await this._sdkType.LoadTextures(a):await this._iObjectClass._loadTextures(this._runtime.GetCanvasManager().GetIRenderer())))}ReleaseTextures(){if(!this._isFamily){this._textureRefCount--;if(0>this._textureRefCount)throw Error("released textures too many times");0===this._textureRefCount&&(this._sdkType?this._sdkType.ReleaseTextures():this._iObjectClass._releaseTextures(this._runtime.GetCanvasManager().GetIRenderer()))}}OnDynamicTextureLoadComplete(){if(this._isFamily)throw Error("not applicable to family");
this._sdkType?this._sdkType.OnDynamicTextureLoadComplete():this._iObjectClass._onDynamicTextureLoadComplete()}async PreloadTexturesWithInstances(a){this._isFamily||(this._sdkType?await this._sdkType.PreloadTexturesWithInstances(a):await this._iObjectClass._preloadTexturesWithInstances(this._runtime.GetCanvasManager().GetIRenderer()))}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(a){return a&&
this._usedBehaviorCtors.has(a)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map(a=>a.sid)}GetInstanceVariableIndexBySID(a){return this._instVars.findIndex(b=>b.sid===a)}GetInstanceVariableIndexByName(a){return this._instVars.findIndex(b=>b.name===a)}_GetAllInstanceVariableNames(){return this._instVars.map(a=>a.name)}_GetAllInstanceVariableJsPropNames(){return this._instVars.map(a=>a.jsPropName)}GetInstanceVariableType(a){a=Math.floor(a);
if(0>a||a>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[a].type}GetInstanceVariableName(a){a=Math.floor(a);if(0>a||a>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[a].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(a){return this._behaviorsByName.get(a.toLowerCase())||null}GetBehaviorIndexByName(a){a=
this._behaviorNameToIndex.get(a.toLowerCase());return"undefined"===typeof a?-1:a}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(a){this._defaultInstanceData=a}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(a){this._defaultLayerIndex=
a}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(a){return this._familiesSet.has(a)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(a){return this._familyMembersSet.has(a)}GetFamilyBehaviorOffset(a){return this._familyBehaviorMap[a]}GetFamilyInstanceVariableOffset(a){return this._familyInstVarMap[a]}AddCustomAction(a){this._customActionMap.set(a.GetACEName().toLowerCase(),
a)}HasOwnCustomActionByName(a){return!!this.GetOwnCustomActionByName(a)}GetOwnCustomActionByName(a){return(a=this._customActionMap.get(a.toLowerCase()))&&a.IsEnabled()?a:null}GetAllAnimations(){return this._animations}GetAnimationByName(a){if(!this._animations)throw Error("no animations");return this._animationsByName.get(a.toLowerCase())||null}GetAnimationBySID(a){if(!this._animations)throw Error("no animations");return this._animationsBySid.get(a)||null}AddAnimation(a){if(this.GetAnimationByName(a))throw Error(`animation name '${a}' already exists`);
a=C3$jscomp$186.AnimationInfo.CreateDynamic(this.GetRuntime(),a);this._animations.push(a);this._animationsByName.set(a.GetName().toLowerCase(),a);this._animationsBySid.set(a.GetSID(),a);return a}RemoveAnimation(a){const b=this.GetAnimationByName(a);if(!b)throw Error(`animation name '${a}' does not exist`);if(1===this._animations.length)throw Error("cannot remove last animation");a=this._animations.indexOf(b);this._animations.splice(a,1);this._animationsByName.delete(b.GetName().toLowerCase());this._animationsBySid.delete(b.GetSID());
b.Release()}GetFirstAnimation(){if(!this._animations)throw Error("no animations");return this._animations[0]}GetFirstAnimationFrame(){return this.GetFirstAnimation().GetFrameAt(0)}GetDefaultInstanceSize(){if(this._animations){const a=this.GetFirstAnimationFrame().GetImageInfo();return[a.GetWidth(),a.GetHeight()]}return this._imageInfo?[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()]:[100,100]}GetSingleGlobalInstance(){if(!this._plugin.IsSingleGlobal())throw Error("not a single-global plugin");
return this._instances[0]}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances;yield*this._runtime.instancesPendingCreateForObjectClass(this)}GetInstanceCount(){return this._instances.length}_AddInstance(a){this._instances.push(a)}_SetIIDsStale(){this._iidsStale=!0}_UpdateIIDs(){if(this._iidsStale&&!this._isFamily){var a=this._instances,b=0;for(let d=a.length;b<d;++b)a[b]._SetIID(b);a=this._runtime._GetInstancesPendingCreate();
for(const d of a)d.GetObjectClass()===this&&d._SetIID(b++);this._iidsStale=!1}}GetInstanceByIID(a){var b=this._instances;if(a<b.length)return b[a];a-=b.length;b=this._runtime._GetInstancesPendingCreate();for(const d of b)if(d.GetObjectClass()===this){if(0===a)return d;--a}return null}GetFirstPicked(a){if(a&&a.IsInContainer()&&a.GetObjectClass()!==this)for(const b of a.siblings())if(b.GetObjectClass()===this)return b;a=this.GetCurrentSol().GetInstances();return a.length?a[0]:null}GetPairedInstance(a){const b=
this.GetCurrentSol().GetInstances();return 0<b.length?b[a.GetIID()%b.length]:null}*allCorrespondingInstances(a,b){const d=this.GetCurrentSol().GetInstances();var c=d.length;const e=b.GetCurrentSol(),g=b.GetCurrentSol().GetInstances(),k=g.length;var l=a.GetIID();if(b.IsFamily()||!e.IsSelectAll())l=g.indexOf(a);a=Math.ceil(c/k);c%=k;0===c||l<c?(l*=a,c=a):(l=c*a+(l-c)*(a-1),c=a-1);for(let n=l,p=l+c;n<p;++n)yield d[n]}FinishCondition(a){this._sdkType?.FinishCondition(a)}ApplySolToContainer(){if(this._isInContainer&&
!this._isFamily){this._UpdateIIDs();var a=this.GetCurrentSol(),b=a._GetOwnInstances(),d=a.IsSelectAll(),c=this._runtime.GetCurrentEventStackFrame();c=c&&c.GetCurrentEvent()&&c.GetCurrentEvent().IsOrBlock();for(const k of this._container.objectTypes())if(k!==this){k._UpdateIIDs();var e=k.GetCurrentSol();e._SetSelectAll(d);if(!d){var g=e._GetOwnInstances();C3$jscomp$186.clearArray(g);for(const l of b)g.push(k.GetInstanceByIID(l.GetIID()));if(c){g=a._GetOwnElseInstances();e=e._GetOwnElseInstances();
C3$jscomp$186.clearArray(e);for(const l of g)e.push(k.GetInstanceByIID(l.GetIID()))}}}}}_TruncateContainerSols(a,b){for(const d of this.GetContainer().objectTypes()){const c=d.GetCurrentSol();a?C3$jscomp$186.truncateArray(c._GetOwnElseInstances(),b):C3$jscomp$186.truncateArray(c._GetOwnInstances(),b)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(a){this._anyCollisionCellChanged=!!a}_SetAnyInstanceParallaxed(a){this._anyInstanceParallaxed=!!a}IsAnyInstanceParallaxed(){return this._anyInstanceParallaxed}_UpdateAllCollisionCells(){if(this._anyCollisionCellChanged&&
this._isWorldType){for(const a of this._instances)a.GetWorldInfo()._UpdateCollisionCell();for(const a of this._runtime._GetInstancesPendingCreate())a.GetObjectClass()===this&&a.GetWorldInfo()._UpdateCollisionCell();this._anyCollisionCellChanged=!1}}GetSavedDataMap(){this._savedData||(this._savedData=new Map);return this._savedData}GetUnsavedDataMap(){this._unsavedData||(this._unsavedData=new Map);return this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$186.Behaviors.solid)}HasJumpthruBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$186.Behaviors.jumpthru)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$186.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(C3$jscomp$186.Behaviors.Persist)}_SaveToJson(){const a=
{instances:this._instances.map(b=>b.SaveToJson())};this._savedData&&this._savedData.size&&(a.ex=C3$jscomp$186.ToSuperJSON(this._savedData));return a}_LoadFromJson(a){this._savedData&&(this._savedData.clear(),this._savedData=null);var b=a.ex;b&&(this._savedData=C3$jscomp$186.FromSuperJSON(b));b=this._instances;a=a.instances;for(let d=0,c=Math.min(b.length,a.length);d<c;++d)b[d].LoadFromJson(a[d]);for(let d=a.length,c=b.length;d<c;++d)this._runtime.DestroyInstance(b[d]);for(let d=b.length,c=a.length;d<
c;++d){b=a[d];let e=null;if(this.IsWorldType()&&(e=this._runtime.GetMainRunningLayout().GetLayerBySID(b.w.l),!e))continue;this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,e,!1,0,0,!0).LoadFromJson(b)}this._loadInstancesJson=a;this._SetIIDsStale()}_GetLoadInstancesJson(){return this._loadInstancesJson}_ClearLoadInstancesJson(){this._loadInstancesJson=null}_SetupSceneGraphConnectionsOnChangeOfLayout(){for(let a=0,b=this._instances;a<b;++a)this._instances[a]._SetupSceneGraphConnectionsOnChangeOfLayout()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(a){this._instanceUserScriptClass=
a}DispatchUserScriptEvent(a){var b=this._runtime;(b=b.IsDebug()&&!b.GetEventSheetManager().IsInEventEngine())&&C3Debugger$jscomp$1.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(a);b&&C3Debugger$jscomp$1.AddScriptTime()}};"use strict";const C3$jscomp$187=self.C3;
C3$jscomp$187.Container=class extends C3$jscomp$187.DefendedBase{constructor(a,b){super();this._runtime=a;this._objectTypes=b;for(const d of this._objectTypes)d._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some(a=>a.IsWorldType())}};"use strict";
const C3$jscomp$188=self.C3,C3Debugger$jscomp$2=self.C3Debugger,originalAddonManager=C3$jscomp$188.AddonManager,EMPTY_ARRAY$jscomp$1=[];let nextPuid=0;const savedDataMaps=new WeakMap,unsavedDataMaps=new WeakMap,FLAG_DESTROYED=1,FLAG_TILEMAP=2,FLAG_MUST_PREDRAW=4,FLAG_SOLID_ENABLED=8,FLAG_JUMPTHRU_ENABLED=16,FLAG_MUST_MITIGATE_Z_FIGHTING=32,FLAG_IS_DRAWING_WITH_EFFECTS=64;
C3$jscomp$188.Instance=class extends C3$jscomp$188.DefendedBase{constructor(a){if(C3$jscomp$188.AddonManager!==originalAddonManager)throw Error("invalid addon manager");super();this._runtime=a.runtime;this._objectType=a.objectType;this._iScriptInterface=this._sdkInst=this._worldInfo=null;this._iid=0;this._uid=a.uid;this._puid=nextPuid++;this._flags=0;this._behaviorInstances=this._instVarValues=EMPTY_ARRAY$jscomp$1;var b=this._objectType.GetBehaviorTypesIncludingInherited();0<b.length&&(this._behaviorInstances=
b.map((d,c)=>C3$jscomp$188.New(C3$jscomp$188.BehaviorInstance,{runtime:this._runtime,behaviorType:d,instance:this,index:c})));this._siblings=this._objectType.IsInContainer()?[]:null;this._timeScale=-1;this._dispatcher=null;b=this.GetPlugin();b.MustPreDraw()&&(this._flags|=FLAG_MUST_PREDRAW);if(b.IsWorldType())if(this._worldInfo=C3$jscomp$188.New(C3$jscomp$188.WorldInfo,this,a.layer),a.worldData)this._worldInfo.Init(a.worldData);else{this._worldInfo.InitNoData();const [d,c]=this._objectType.GetDefaultInstanceSize();
this._worldInfo.SetSize(d,c);this.GetObjectClass().UsesEffects()&&this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters()}a.instVarData?this._LoadInstanceVariableData(a.instVarData):this._LoadDefaultInstanceVariables()}Release(){this._iScriptInterface&&(this._iScriptInterface._release(),this._iScriptInterface=null);if(0<this._behaviorInstances.length){for(var a of this._behaviorInstances)a.Release();C3$jscomp$188.clearArray(this._behaviorInstances)}this._sdkInst&&(this._sdkInst.Release(),
this._sdkInst=null);if(a=savedDataMaps.get(this))a.clear(),savedDataMaps.delete(this);if(a=unsavedDataMaps.get(this))a.clear(),unsavedDataMaps.delete(this);this._siblings&&C3$jscomp$188.clearArray(this._siblings);this._dispatcher&&(this._dispatcher.Release(),this._dispatcher=null);this._objectType=this._runtime=null;0<this._instVarValues.length&&C3$jscomp$188.clearArray(this._instVarValues);this._worldInfo&&(this._worldInfo.Release(),this._worldInfo=null)}_LoadInstanceVariableData(a){0<a.length&&
(this._instVarValues=[],C3$jscomp$188.shallowAssignArray(this._instVarValues,a))}_LoadDefaultInstanceVariables(){const a=this._objectType.GetInstanceVariablesCount();if(0!==a){this._instVarValues=[];var b=[0,0,""];for(let d=0;d<a;++d)this._instVarValues.push(b[this._objectType.GetInstanceVariableType(d)])}}_CreateSdkInstance(a,b){if(this._sdkInst)throw Error("already got sdk instance");for(let d=0,c=this._behaviorInstances.length;d<c;++d)this._behaviorInstances[d]._CreateSdkInstance(b?b[d]:null);
if(2>this.GetPlugin().GetSdkVersion()){this._sdkInst=C3$jscomp$188.New(this._objectType.GetInstanceSdkCtor(),this,a);if(!(this._sdkInst instanceof C3$jscomp$188.SDKInstanceBase))throw Error("sdk type must derive from SDKInstanceBase");!this.GetPlugin().IsWorldType()&&this._objectType._GetUserScriptInstanceClass()&&this.GetInterfaceClass()}else b=this.GetPlugin().GetScriptInterfaceClass(),this._InitUserScriptInterface(b.Instance,a)}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){const a=
this._timeScale;return-1===a?this.GetRuntime().GetTimeScale():a}SetTimeScale(a){a=+a;if(0>a||!isFinite(a))a=0;this._timeScale=a;this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!0)}RestoreTimeScale(){this._timeScale=-1;this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!1)}GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this)}Dispatcher(){this._dispatcher||(this._dispatcher=C3$jscomp$188.New(C3$jscomp$188.Event.Dispatcher));
return this._dispatcher}Draw(a){this._sdkInst?this._sdkInst.Draw(a):this._iScriptInterface._draw(this._runtime.GetCanvasManager().GetIRenderer())}OnCreate(a){this._sdkInst.OnCreate(a)}_SetHasTilemap(){this._flags|=FLAG_TILEMAP}HasTilemap(){return 0!==(this._flags&FLAG_TILEMAP)}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}IsDestroyed(){return 0!==(this._flags&FLAG_DESTROYED)}MustPreDraw(){return 0!==(this._flags&FLAG_MUST_PREDRAW)||this._sdkInst.MustPreDraw()}SetMustMitigateZFighting(){this._flags|=
FLAG_MUST_MITIGATE_Z_FIGHTING}MustMitigateZFighting(){return 0!==(this._flags&FLAG_MUST_MITIGATE_Z_FIGHTING)}_IsSolidEnabled(){return 0!==(this._flags&FLAG_SOLID_ENABLED)}_SetSolidEnabled(a){this._flags=a?this._flags|FLAG_SOLID_ENABLED:this._flags&~FLAG_SOLID_ENABLED}_IsJumpthruEnabled(){return 0!==(this._flags&FLAG_JUMPTHRU_ENABLED)}_SetJumpthruEnabled(a){this._flags=a?this._flags|FLAG_JUMPTHRU_ENABLED:this._flags&~FLAG_JUMPTHRU_ENABLED}_IsDrawingWithEffects(){return 0!==(this._flags&FLAG_IS_DRAWING_WITH_EFFECTS)}_SetIsDrawingWithEffects(a){this._flags=
a?this._flags|FLAG_IS_DRAWING_WITH_EFFECTS:this._flags&~FLAG_IS_DRAWING_WITH_EFFECTS}SetFlag(a,b){a<<=16;this._flags=b?this._flags|a:this._flags&~a}GetFlag(a){return 0!==(this._flags&a<<16)}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(a){return this._sdkInst.GetImagePoint(a)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(a){return a.IsFamily()?
a.FamilyHasMember(this.GetObjectClass()):this.GetObjectClass()===a}CollectInstancesToPick(a,b,d){const c=(e,g)=>{g=g||e.GetObjectClass();const k=a.get(g);k?k.add(e):a.set(g,new Set([e]))};c(this,b);if(this.IsInContainer())for(const e of this.siblings())c(e);if(d)for(const e of this.allChildren())c(e)}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw Error("object does not support scene graph");}HasParent(){return null!==this.GetParent()}GetParent(){var a=this.GetWorldInfo();
return a?(a=a.GetParent())?a.GetInstance():null:null}GetTopParent(){var a=this.GetWorldInfo();return a?(a=a.GetTopParent())?a.GetInstance():null:null}*parents(){const a=this.GetWorldInfo();if(a)for(const b of a.parents())yield b.GetInstance()}HasChild(a){if(!a)return!1;for(const b of this.children())if(b===a)return!0;return!1}HasChildren(){const a=this.GetWorldInfo();return a?a.HasChildren():!1}GetChildrenOfObjectClass(a){const b=this.GetWorldInfo();if(!b)return[];const d=a.GetName();return b.GetChildren().map(c=>
c.GetInstance()).filter(c=>c.GetObjectClass().GetName()===d)}GetChildren(){const a=this.GetWorldInfo();return a?a.GetChildren().map(b=>b.GetInstance()):[]}*children(){const a=this.GetWorldInfo();if(a)for(const b of a.children())yield b.GetInstance()}*allChildren(){const a=this.GetWorldInfo();if(a)for(const b of a.allChildren())yield b.GetInstance()}GetChildCount(){const a=this.GetWorldInfo();return a?a.GetChildCount():0}GetParentCount(){return[...this.parents()].length}GetAllChildCount(){const a=
this.GetWorldInfo();return a?a.GetAllChildCount():0}GetChildAt(a){const b=this.GetWorldInfo();return b?(a=b.GetChildAt(a))?a.GetInstance():null:null}GetIndexInParent(){const a=this.GetWorldInfo();if(!a)return NaN;const b=a.GetParent();return b?b.GetChildIndex(a):NaN}AddChild(a,b){this.VerifySupportsSceneGraph();a.VerifySupportsSceneGraph();this.GetWorldInfo().AddChild(a.GetWorldInfo(),b||{})}RemoveChild(a){const b=this.GetWorldInfo();b&&b.RemoveChild(a.GetWorldInfo())}GetDestroyWithParent(){const a=
this.GetWorldInfo();return a?a.GetDestroyWithParent():!1}SetupInitialSceneGraphConnections(){var a=this.GetWorldInfo();if(a&&(a=a.GetSceneGraphChildrenExportData()))for(const b of a)if(a=this._runtime.GetInstanceByUID(b[2])){const d=b[3];this.AddChild(a,{transformX:!!(d>>0&1),transformY:!!(d>>1&1),transformWidth:!!(d>>2&1),transformHeight:!!(d>>3&1),transformAngle:!!(d>>4&1),destroyWithParent:!!(d>>5&1),transformZElevation:!!(d>>6&1),transformOpacity:!!(d>>7&1),transformVisibility:!!(d>>8&1)})}}SetupPersistedSceneGraphConnections(a,
b){if(a=a.get(this))for(const d of a.sceneGraphJson.children){a=b.get(d.index);if(!a)continue;const c=d.flags;this.AddChild(a,{transformX:!!(c>>0&1),transformY:!!(c>>1&1),transformWidth:!!(c>>2&1),transformHeight:!!(c>>3&1),transformAngle:!!(c>>4&1),destroyWithParent:!!(c>>5&1),transformZElevation:!!(c>>6&1),transformOpacity:!!(c>>7&1),transformVisibility:!!(c>>8&1)})}}GetTemplateName(){const a=this._runtime.GetTemplateManager();return a?a.GetInstanceTemplateName(this):""}IsInContainer(){return null!==
this._siblings}_AddSibling(a){this._siblings.push(a)}GetSiblings(){return this._siblings}HasSibling(a){return!!this.GetSibling(a)}GetSibling(a){const b=this.siblings();if(null===b||0===b.length)return!1;for(const d of b)if(d.GetObjectClass()===a)return d;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(const a of this.siblings())a.GetObjectClass().GetCurrentSol().SetSinglePicked(a)}_PushSiblingsToSolInstances(){for(const a of this.siblings())a.GetObjectClass().GetCurrentSol()._PushInstance(a)}_SetSiblingsToSolInstancesIndex(a){for(const b of this.siblings())b.GetObjectClass().GetCurrentSol()._GetOwnInstances()[a]=
b}_PushSiblingsToSolElseInstances(){for(const a of this.siblings())a.GetObjectClass().GetCurrentSol()._PushElseInstance(a)}_SetSiblingsToSolElseInstancesIndex(a){for(const b of this.siblings())b.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[a]=b}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(a){this._iid=a}GetIID(){this._objectType._UpdateIIDs();return this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(a){if(!a)return null;
for(const b of this._behaviorInstances)if(b.GetBehavior()instanceof a)return b;return null}GetBehaviorSdkInstanceFromCtor(a){return a?(a=this.GetBehaviorInstanceFromCtor(a))?a.GetSdkInstance():null:null}GetBehaviorIndexBySID(a){const b=this._behaviorInstances;for(let d=0,c=b.length;d<c;++d)if(b[d].GetBehaviorType().GetSID()===a)return d;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(a){a|=
0;const b=this._instVarValues;if(0>a||a>=b.length)throw new RangeError("invalid instance variable");return b[a]}_GetInstanceVariableValueUnchecked(a){return this._instVarValues[a]}_GetInstanceVariableTypedValue(a){const b=this._instVarValues[a];return 0===this._objectType.GetInstanceVariableType(a)?!!b:b}SetInstanceVariableValue(a,b){a|=0;const d=this._instVarValues;if(0>a||a>=d.length)throw new RangeError("invalid instance variable");switch(this._objectType.GetInstanceVariableType(a)){case 0:d[a]=
b?1:0;break;case 1:d[a]="number"===typeof b?b:parseFloat(b);break;case 2:d[a]="string"===typeof b?b:b.toString();break;default:throw Error("unknown instance variable type");}}SetInstanceVariableOffset(a,b){if(0!==b){a|=0;var d=this._instVarValues;if(0>a||a>=d.length)throw new RangeError("invalid instance variable");var c=d[a];if("number"===typeof c)d[a]="number"===typeof b?d[a]+b:d[a]+parseFloat(b);else{if("boolean"===typeof c)throw Error("can not set offset of boolean variable");if("string"===typeof c)throw Error("can not set offset of string variable");
throw Error("unknown instance variable type");}}}GetSavedDataMap(){let a=savedDataMaps.get(this);if(a)return a;a=new Map;savedDataMaps.set(this,a);return a}GetUnsavedDataMap(){let a=unsavedDataMaps.get(this);if(a)return a;a=new Map;unsavedDataMaps.set(this,a);return a}_HasAnyCreateDestroyHandler(a){const b=this.GetObjectClass();if(b.UserScriptDispatcher().HasAnyHandlerFor(a))return!0;for(const d of b.GetFamilies())if(d.UserScriptDispatcher().HasAnyHandlerFor(a))return!0;return this._runtime.UserScriptDispatcher().HasAnyHandlerFor(a)?
!0:!1}_TriggerOnCreatedOnSelfAndRelated(){const a=new Set;a.add(this);const b=this.GetWorldInfo();if(b&&b.HasChildren())for(const d of this.allChildren())if(a.add(d),d.IsInContainer())for(const c of d.siblings())a.add(c);if(this.IsInContainer())for(const d of this.siblings())a.add(d);for(const d of a.values())d._TriggerOnCreated()}_TriggerOnCreated(){this._objectType._GetUserScriptInstanceClass()&&this.GetInterfaceClass();for(var a of this._behaviorInstances)a.PostCreate();if(this._HasAnyCreateDestroyHandler("instancecreate")){a=
this.GetObjectClass();const b=new C3$jscomp$188.Event("instancecreate");b.instance=this.GetInterfaceClass();a.DispatchUserScriptEvent(b);for(const d of a.GetFamilies())d.DispatchUserScriptEvent(b);this._runtime.DispatchUserScriptEvent(b)}this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(a){if(this._iScriptInterface){var b=new C3$jscomp$188.Event("destroy");
b.isEndingLayout=a;this.DispatchUserScriptEvent(b)}if(this._HasAnyCreateDestroyHandler("instancedestroy")){b=this.GetObjectClass();var d=new C3$jscomp$188.Event("instancedestroy");d.instance=this.GetInterfaceClass();d.isEndingLayout=a;b.DispatchUserScriptEvent(d);for(const c of b.GetFamilies())c.DispatchUserScriptEvent(d);this._runtime.DispatchUserScriptEvent(d)}}_GetDebuggerProperties(){return this._sdkInst?this._sdkInst.GetDebuggerProperties():this._iScriptInterface.getDebuggerProperties()}SaveToJson(a=
"full",b=null){const d={};"full"===a?d.uid=this.GetUID():d.c3=!0;if("visual-state"!==a){var c=savedDataMaps.get(this);c&&c.size&&(d.ex=C3$jscomp$188.ToSuperJSON(c));-1!==this.GetTimeScale()&&(d.mts=this.GetTimeScale());if(0<this._objectType.GetInstanceVariablesCount()){c={};var e=this._objectType.GetInstanceVariableSIDs();for(let g=0,k=this._instVarValues.length;g<k;++g)c[e[g].toString()]=this._instVarValues[g];d.ivs=c}if(this._behaviorInstances.length){c={};for(const g of this._behaviorInstances)(e=
g.SaveToJson(a))&&(c[g.GetBehaviorType().GetSID().toString()]=e);d.behs=c}}this._worldInfo&&(d.w=this._worldInfo._SaveToJson(a,b));(a=this._sdkInst?this._sdkInst.SaveToJson():this._iScriptInterface._saveToJson())&&(d.data=a);return d}_OnBeforeLoad(a="full"){this._worldInfo&&this._worldInfo._OnBeforeLoad(a)}_OnAfterLoad(a,b="full",d=null){this._worldInfo&&this._worldInfo._OnAfterLoad(a,b,d)}_OnAfterLoad2(a,b="full",d=null){this._worldInfo&&this._worldInfo._OnAfterLoad2(a,b,d)}_SetupSceneGraphConnectionsOnChangeOfLayout(){this.GetPlugin().IsWorldType()&&
this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout()}LoadFromJson(a,b="full"){if("full"===b)this._uid=a.uid;else if(!a.c3)return;if("visual-state"!==b){var d=savedDataMaps.get(this);d&&(d.clear(),savedDataMaps.delete(this));if(d=a.ex)d=C3$jscomp$188.FromSuperJSON(d),savedDataMaps.set(this,d);this._timeScale=a.hasOwnProperty("mts")?a.mts:-1;if(d=a.ivs)for(const [g,k]of Object.entries(d))if(d=parseInt(g,10),d=this._objectType.GetInstanceVariableIndexBySID(d),!(0>d||d>=this._instVarValues.length)){var c=
k;null===c&&(c=NaN);this._instVarValues[d]=c}}if(this.GetPlugin().IsWorldType()&&(d=a.w)){var e=d.l;this._worldInfo.GetLayer().GetSID()!==e&&(c=this._worldInfo.GetLayer(),(e=c.GetLayout().GetLayerBySID(e))?(this._worldInfo._SetLayer(e),c._RemoveInstance(this,!0),e._AddInstance(this,!0),e.SetZIndicesChanged(this),this._worldInfo.SetBboxChanged()):"full"===b&&this._runtime.DestroyInstance(this));this._worldInfo._LoadFromJson(d,b)}if("visual-state"!==b&&(d=a.behs))for(const [g,k]of Object.entries(d))d=
parseInt(g,10),d=this.GetBehaviorIndexBySID(d),0>d||d>=this._behaviorInstances.length||this._behaviorInstances[d].LoadFromJson(k,b);(a=a.data)&&(this._sdkInst?this._sdkInst.LoadFromJson(a,b):this._iScriptInterface._loadFromJson(a))}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}_InitUserScriptInterface(a,b){const d=this._worldInfo?a?self.ISDKWorldInstanceBase:self.IWorldInstance:a?self.ISDKInstanceBase:self.IInstance;
a=a||this._sdkInst.GetScriptInterfaceClass();const c=this._objectType._GetUserScriptInstanceClass(),e=c||a||d,g=this.GetPlugin().GetSdkVersion();C3$jscomp$188.AddonManager._PushInitObject(this,g);C3$jscomp$188.AddonManager._PushInitProperties(b);this._iScriptInterface=new e;C3$jscomp$188.AddonManager._PopInitProperties();C3$jscomp$188.AddonManager._PopInitObject(g);if(a&&!(this._iScriptInterface instanceof d))throw new TypeError(`script interface class '${a.name}' does not extend the right base class '${d.name}'`);
if(c&&!(this._iScriptInterface instanceof(a||d)))throw new TypeError(`setInstanceClass(): class '${c.name}' does not extend the right base class - check it extends the right class, e.g. globalThis.InstanceType.MyObjectName`);return this._iScriptInterface}_GetInstVarsScriptDescriptor(a){if(0!==this._instVarValues.length){var b={},d=this._objectType._GetAllInstanceVariableJsPropNames();for(let c=0,e=d.length;c<e;++c)b[d[c]]={configurable:!1,enumerable:!0,get:C3$jscomp$188.Instance.prototype._GetInstanceVariableTypedValue.bind(this,
c),set:C3$jscomp$188.Instance.prototype.SetInstanceVariableValue.bind(this,c)};b=Object.create(Object.prototype,b);a.instVars={value:b,writable:!1}}}_GetBehaviorsScriptDescriptor(a){var b=this._behaviorInstances;if(0!==b.length){var d={};for(const c of b)d[c.GetBehaviorType().GetJsPropName()]={value:c.GetScriptInterface(),writable:!1};b=Object.create(Object.prototype,d);a.behaviors={value:b,writable:!1}}}DispatchUserScriptEvent(a){if(this.HasScriptInterface()){var b=this.GetInterfaceClass();a.instance=
b;var d=this._runtime;(d=d.IsDebug()&&!d.GetEventSheetManager().IsInEventEngine())&&C3Debugger$jscomp$2.StartMeasuringScriptTime();b.dispatchEvent(a);d&&C3Debugger$jscomp$2.AddScriptTime()}}};"use strict";const C3$jscomp$189=self.C3;
C3$jscomp$189.SceneGraphInfo=class extends C3$jscomp$189.DefendedBase{constructor(a){super();this._owner=a;this._parent=null;this._children=[];this._startWidth=a.GetWidth();this._startHeight=a.GetHeight();this._startScaleY=this._startScaleX=1;this._parentStartAngle=0;this._ownOpacity=1;this._startOpacity=a.GetOpacity();this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=null;this._indexInParent=NaN}Release(){this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=this._parent=null;
this._indexInParent=NaN;C3$jscomp$189.clearArray(this._children)}SetParent(a){this._startOpacity=this._ownOpacity=this._owner.GetOpacity();this._parentStartAngle=(this._parent=a)?a.GetAngle():0}GetParent(){return this._parent}HasChildren(){return 0<this._children.length}GetChildren(){return this._children}_MaybeSortChildren(){this.HasChildren()&&1!==this._children.length&&(this._tmpSceneGraphChildrenIndexes?this._children.sort((a,b)=>{a=this._tmpSceneGraphChildrenIndexes.get(a.GetInstance());b=this._tmpSceneGraphChildrenIndexes.get(b.GetInstance());
return C3$jscomp$189.IsFiniteNumber(a)&&C3$jscomp$189.IsFiniteNumber(b)?a-b:0}):this._children.sort((a,b)=>{a=a._GetSceneGraphInfo()._GetIndexInParent();b=b._GetSceneGraphInfo()._GetIndexInParent();return C3$jscomp$189.IsFiniteNumber(a)&&C3$jscomp$189.IsFiniteNumber(b)?a-b:0}))}_GetIndexInParent(){return this._indexInParent}GetStartScaleX(){return this._startScaleX}SetStartScaleX(a){this._startScaleX=a}GetStartScaleY(){return this._startScaleY}SetStartScaleY(a){this._startScaleY=a}GetStartOpacity(){return this._startOpacity}GetOwnOpacity(){return this._ownOpacity}SetOwnOpacity(a){this._ownOpacity=
a}_GetStartWidth(){return 0===this._startWidth?Number.EPSILON:this._startWidth}_GetStartHeight(){return 0===this._startHeight?Number.EPSILON:this._startHeight}GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){var a=this._parent;let b=a.GetWidth(),d=a._GetSceneGraphInfo()._GetStartWidth();0===b&&(b=Number.EPSILON);return d===Number.EPSILON&&b===Number.EPSILON?1:d===Number.EPSILON&&b!==Number.EPSILON&&(a=a.GetInstance().GetSdkInstance(),a.IsOriginalSizeKnown())?1+b/a.GetOriginalWidth():
b/d}return 1}GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){var a=this._parent;let b=a.GetHeight(),d=a._GetSceneGraphInfo()._GetStartHeight();0===b&&(b=Number.EPSILON);return d===Number.EPSILON&&b===Number.EPSILON?1:d===Number.EPSILON&&b!==Number.EPSILON&&(a=a.GetInstance().GetSdkInstance(),a.IsOriginalSizeKnown())?1+b/a.GetOriginalHeight():b/d}return 1}GetParentStartAngle(){return this._parentStartAngle}_SaveToJsonProperties(){return{sw:this._startWidth,sh:this._startHeight,sx:this._startScaleX,
sy:this._startScaleY,psa:this._parentStartAngle,oo:this._ownOpacity,so:this._startOpacity,pi:this._owner.GetInstance().GetIndexInParent()}}_SaveToJson(a,b=null){const d=this._SaveToJsonProperties();return b&&b.selfOnly?Object.assign(d,{p:null,c:[]}):Object.assign(d,{p:this._GetParentJson(a),c:this._GetChildrenJson(a)})}_GetFlagsString(a){let b="";a.GetTransformWithParentX()&&(b+="x");a.GetTransformWithParentY()&&(b+="y");a.GetTransformWithParentWidth()&&(b+="w");a.GetTransformWithParentHeight()&&
(b+="h");a.GetTransformWithParentAngle()&&(b+="a");a.GetTransformWithParentZElevation()&&(b+="z");a.GetDestroyWithParent()&&(b+="d");a.GetTransformWithParentOpacity()&&(b+="o");a.GetTransformWithParentVisibility()&&(b+="v");return b}_GetParentJson(a){return this._parent&&this._parent.GetInstance()&&!this._parent.GetInstance().IsDestroyed()?this._GetInstanceJson(this._parent,this._owner,a):null}_GetChildrenJson(a){return this._children.map(b=>this._GetInstanceJson(b,b,a)).filter(b=>b)}_GetInstanceJson(a,
b,d){if((a=a.GetInstance())&&a.IsDestroyed())return null;const c={};c.uid=a.GetUID();c.f=this._GetFlagsString(b);c.offsets=b._SaveSceneGraphPropertiesToJson();c.data=C3$jscomp$189.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(a);c.oci=a.GetObjectClass().GetIndex();"state"===d?(c.inst=a.SaveToJson("full",{selfOnly:!0}),c.instIndex=NaN):(c.instIndex=a.GetObjectClass().GetInstances().indexOf(a),c.inst=null);return c}_LoadFromJson(a){this._startWidth=a.sw;this._startHeight=a.sh;this._startScaleX=
a.sx;this._startScaleY=a.sy;this._parentStartAngle=a.psa;this._ownOpacity=a.oo;this._startOpacity=a.so;this._indexInParent=C3$jscomp$189.IsFiniteNumber(a.pi)?a.pi:NaN}_SetTmpSceneGraphChildren(a,b){if(!a&&!b&&this._tmpSceneGraphChildren)for(const d of this._tmpSceneGraphChildren)d.IsDestroyed()||d.HasParent()||d.GetRuntime().DestroyInstance(d);this._tmpSceneGraphChildren=a;this._tmpSceneGraphChildrenIndexes=b}_OnAfterLoad(a,b){const d=this._owner,c=d.GetRuntime(),e=new Set;if(a.p&&!this._parent){var g=
c.GetInstanceByUID(a.p.uid);if(g){var k=g.GetWorldInfo();g.HasChild(this._owner.GetInstance())?this._parent=k:(g.AddChild(this._owner.GetInstance(),this._GetFlagsObj(a.p.f)),e.has(this._owner)||(this._owner._LoadSceneGraphPropertiesFromJson(a.p.offsets),this._LoadInstancePropertiesFromJson(this._owner.GetInstance(),a.p)),e.add(this._owner),g.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren())}else C3$jscomp$189.IsFiniteNumber(a.p.oci)&&(g=c.GetObjectClassByIndex(a.p.oci),c.GetSystemPlugin(),
g=c.CreateInstance(g,d.GetLayer(),0,0,!0))&&(k=this._GetInstanceData(a.p,c),g.LoadFromJson(k),g.GetWorldInfo().GetLayer().SortAndAddInstancesByZIndex(g),g.AddChild(d.GetInstance(),this._GetFlagsObj(a.p.f)),g.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren())}g=[];for(var l of a.c)(k=c.GetInstanceByUID(l.uid))&&g.push(k);l=0;for(const r of a.c){if(k=c.GetInstanceByUID(r.uid)){if(this._tmpSceneGraphChildren)if(this._tmpSceneGraphChildren.includes(k)){var n=k;if(n.GetObjectClass()!==k.GetObjectClass()){l++;
continue}if(n.IsDestroyed()){l++;continue}k=a.c[l];this._AddAndSetChildInstance(n.GetWorldInfo(),k,e,!0);l++;continue}else if(this._tmpSceneGraphChildren[l]){n=this._tmpSceneGraphChildren[l];if(n.GetObjectClass()!==k.GetObjectClass()){l++;continue}if(n.IsDestroyed()){l++;continue}k=a.c[l];this._AddAndSetChildInstance(n.GetWorldInfo(),k,e,!0);l++;continue}var p=k.GetObjectClass();n=this._GetInstancesOfObjectClassCount(g,p);p=d.GetInstance().GetChildrenOfObjectClass(p).length;if(n===p){if(k=d.GetInstance().GetChildAt(l))if(n=
k.GetWorldInfo())e.has(n)||(n._LoadSceneGraphPropertiesFromJson(r.offsets),this._LoadInstancePropertiesFromJson(k,r)),e.add(n);l++;continue}if(k.HasParent()){k=this._CreateNewChildInstance(r,b);this._AddAndSetChildInstance(k,r,e);l++;continue}this._AddAndSetChildInstance(k.GetWorldInfo(),r,e)}else if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[l]){k=this._tmpSceneGraphChildren[l];n=c.GetObjectClassByIndex(this._GetObjectClassIndex(r));if(k.GetObjectClass()!==n){l++;continue}if(k.IsDestroyed()){l++;
continue}n=a.c[l];this._AddAndSetChildInstance(k.GetWorldInfo(),n,e)}else k=this._CreateNewChildInstance(r,b),this._AddAndSetChildInstance(k,r,e);l++}}_GetFlagsObj(a){const b={};b.transformX=a.includes("x");b.transformY=a.includes("y");b.transformWidth=a.includes("w");b.transformHeight=a.includes("h");b.transformAngle=a.includes("a");b.transformZElevation=a.includes("z");b.destroyWithParent=a.includes("d");b.transformOpacity=a.includes("o");b.transformVisibility=a.includes("v");return b}_GetObjectClassIndex(a){return C3$jscomp$189.IsFiniteNumber(a.oci)?
a.oci:a[1]}_CreateNewChildInstance(a,b){if(C3$jscomp$189.IsFiniteNumber(a.oci)){var d=this._owner;b=d.GetRuntime();if(a.data)d=b.CreateInstanceFromData(a.data,d.GetLayer(),!1,0,0,!1,!0);else{const c=b.GetObjectClassByIndex(a.oci);d=b.CreateInstance(c,d.GetLayer(),0,0,!0)}if(d)return a=this._GetInstanceData(a,b),d.LoadFromJson(a),a=d.GetWorldInfo(),a.GetLayer().SortAndAddInstancesByZIndex(d,!0),a}}_AddAndSetChildInstance(a,b,d,c=!0){this._owner.AddChild(a,this._GetFlagsObj(b.f))&&c&&(d.has(a)||(a._LoadSceneGraphPropertiesFromJson(b.offsets),
this._LoadInstancePropertiesFromJson(a.GetInstance(),b)),d.add(a));this._MaybeSortChildren()}_LoadInstancePropertiesFromJson(a,b){if(b=this._GetInstanceData(b,this._owner.GetRuntime()))b=JSON.parse(JSON.stringify(b)),b.w=null,a.LoadFromJson(b)}_GetInstancesOfObjectClassCount(a,b){return a.filter(d=>d.GetObjectClass().GetName()===b.GetName()).length}_GetInstanceData(a,b){if(C3$jscomp$189.IsFiniteNumber(a.instIndex))return b.GetObjectClassByIndex(a.oci)._GetLoadInstancesJson()[a.instIndex];if(C3$jscomp$189.IsString(a.inst))return JSON.parse(a.inst);
if(a.inst)return a.inst}static GetSceneGraphInstanceDataFromInstance(a){let b=a.GetWorldInfo().GetLayer().GetInitialInstanceData(a.GetUID());if(!b)return null;b=JSON.parse(JSON.stringify(b));const d=[];for(const c of[...a.GetChildren()]){const e=c.GetWorldInfo();d.push([e.GetLayout().GetSID(),e.GetLayer().GetIndex(),c.GetUID(),C3$jscomp$189.SceneGraphInfo._GetFlagsNumber(e),c.GetObjectClass().IsInContainer()?1:0,e.GetZIndex(),C3$jscomp$189.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(c)])}C3$jscomp$189.IsArray(b[0][14])?
b[0][14][1]=d:(b[0][14]=[],b[0][14][0]=C3$jscomp$189.SceneGraphInfo._GetDefaultFlagsNumber(),b[0][14][1]=d,b[0][14][2]=a.GetWorldInfo().GetZIndex());return b}static _GetFlagsNumber(a){let b;b=0|Number(a.GetTransformWithParentVisibility())<<8;b|=Number(a.GetTransformWithParentOpacity())<<7;b|=Number(a.GetTransformWithParentZElevation())<<6;b|=Number(a.GetDestroyWithParent())<<5;b|=Number(a.GetTransformWithParentAngle())<<4;b|=Number(a.GetTransformWithParentHeight())<<3;b|=Number(a.GetTransformWithParentWidth())<<
2;b|=Number(a.GetTransformWithParentY())<<1;return b|=Number(a.GetTransformWithParentX())<<0}static _GetDefaultFlagsNumber(a){return 511}};"use strict";
const C3$jscomp$190=self.C3,tempRect$jscomp$7=C3$jscomp$190.New(C3$jscomp$190.Rect),tempQuad$jscomp$3=C3$jscomp$190.New(C3$jscomp$190.Quad),bboxChangeEvent=C3$jscomp$190.New(C3$jscomp$190.Event,"bboxchange",!1),tempColor$jscomp$6=C3$jscomp$190.New(C3$jscomp$190.Color,0,0,0,0),tempCollisionPoly=C3$jscomp$190.New(C3$jscomp$190.CollisionPoly),DEFAULT_COLOR=C3$jscomp$190.New(C3$jscomp$190.Color,1,1,1,1),DEFAULT_RENDER_CELLS=C3$jscomp$190.New(C3$jscomp$190.Rect,0,0,-1,-1),DEFAULT_COLLISION_CELLS=C3$jscomp$190.New(C3$jscomp$190.Rect,
0,0,-1,-1),VALID_SET_MESH_POINT_MODES=new Set(["absolute","relative"]),EMPTY_ARRAY$jscomp$2=[];let enableUpdateRendererStateGroup=!0;
const FLAG_IS_VISIBLE=1,FLAG_BBOX_CHANGED=2,FLAG_ENABLE_BBOX_CHANGED_EVENT=4,FLAG_COLLISION_ENABLED=8,FLAG_COLLISION_CELL_CHANGED=16,FLAG_SOLID_FILTER_INCLUSIVE=32,FLAG_HAS_ANY_ACTIVE_EFFECT=64,FLAG_IS_ROTATABLE=128,FLAG_DESTROYED$jscomp$1=256,FLAG_DESTROY_WITH_PARENT=512,FLAG_TRANSFORM_WITH_PARENT_X=1024,FLAG_TRANSFORM_WITH_PARENT_Y=2048,FLAG_TRANSFORM_WITH_PARENT_W=4096,FLAG_TRANSFORM_WITH_PARENT_H=8192,FLAG_TRANSFORM_WITH_PARENT_A=16384,FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION=32768,FLAG_TRANSFORM_WITH_PARENT_OPACITY=
4194304,FLAG_TRANSFORM_WITH_PARENT_VISIBILITY=8388608,MASK_ALL_SCENE_GRAPH_FLAGS=FLAG_DESTROY_WITH_PARENT|FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y|FLAG_TRANSFORM_WITH_PARENT_W|FLAG_TRANSFORM_WITH_PARENT_H|FLAG_TRANSFORM_WITH_PARENT_A|FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION|FLAG_TRANSFORM_WITH_PARENT_OPACITY|FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,FLAG_MESH_CHANGED=65536,FLAG_PHYSICS_BODY_CHANGED=131072,FLAG_SIN_COS_ANGLE_CHANGED=262144,FLAG_USE_POINTS_SHADER_PROGRAM=524288,FLAG_DRAW_BACK_FACE_ONLY=
1048576,FLAG_DRAW_NON_BACK_FACES_ONLY=2097152,FLAG_BLEND_MODE_MASK=2080374784,sceneGraphExportDataMap=new WeakMap,sceneGraphZIndexMap=new WeakMap;
C3$jscomp$190.WorldInfo=class extends C3$jscomp$190.DefendedBase{constructor(a,b){super();this._inst=a;this._objectClass=a.GetObjectClass();this._runtime=a.GetRuntime();this._layer=b;this._htmlZIndex=this._zIndex=-1;this._flags=FLAG_IS_VISIBLE|FLAG_BBOX_CHANGED|FLAG_COLLISION_ENABLED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED|FLAG_PHYSICS_BODY_CHANGED;this._objectClass.GetPlugin().IsRotatable()&&(this._flags|=FLAG_IS_ROTATABLE);this._oy=this._ox=this._cosA=this._sinA=this._a=this._depth=this._h=
this._w=this._zElevation=this._y=this._x=NaN;this._boundingBox=C3$jscomp$190.New(C3$jscomp$190.Rect);this._boundingQuad=C3$jscomp$190.New(C3$jscomp$190.Quad);this._collisionCells=DEFAULT_COLLISION_CELLS;this._renderCells=DEFAULT_RENDER_CELLS;this._solidFilterTags=this._transformedPolyInfo=this._sourceCollisionPoly=null;this._colorPremultiplied=this._color=DEFAULT_COLOR;this._instanceEffectList=this._stateGroup=null;this._inst.GetObjectClass().UsesEffects()&&(this._instanceEffectList=C3$jscomp$190.New(C3$jscomp$190.InstanceEffectList,
this._inst,this));this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=this._sceneGraphInfo=null;this._tmpHierarchyPosition=-1;this._meshInfo=null}_MarkDestroyed(){this._flags|=FLAG_DESTROYED$jscomp$1}Release(){this._stateGroup&&(this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup),this._stateGroup=null);this._sourceCollisionPoly=null;this._transformedPolyInfo&&(this._transformedPolyInfo.poly.Release(),this._transformedPolyInfo=null);this._solidFilterTags&&(this._solidFilterTags.clear(),
this._solidFilterTags=null);this.ReleaseMesh();this._instanceEffectList&&this._instanceEffectList.Release();this.HasParent()&&this.GetParent().RemoveChild(this);if(this.HasChildren()){const a=[...this.GetChildren()];for(const b of a)this.RemoveChild(b)}this._ReleaseSceneGraphInfo();this._ReleaseTmpSceneGraphInfo();sceneGraphExportDataMap.delete(this);sceneGraphZIndexMap.delete(this);this._layer=this._runtime=this._objectClass=this._inst=null}Init(a){enableUpdateRendererStateGroup=!1;this.SetXY(a[0],
a[1]);this.SetZElevation(a[2]);this.SetSize(a[3],a[4]);this._depth=0;this.IsRotatable()?this.SetAngle(a[6]):this._a=0;tempColor$jscomp$6.setFromJSON(a[7]);this._SetColor(tempColor$jscomp$6);this.SetOriginX(a[8]);this.SetOriginY(a[9]);this.SetBlendMode(a[10]);this._instanceEffectList&&this._instanceEffectList._LoadEffectParameters(a[12]);a[14]&&sceneGraphExportDataMap.set(this,{childrenData:a[14][1],zIndexData:a[14][2]});if(a[15]){var b=a[15];this.CreateMesh(b[0],b[1]);var d=this.GetSourceMesh();b=
b[2];for(let g=0,k=b.length;g<k;++g){var c=b[g];for(let l=0,n=c.length;l<n;++l){var e=c[l];const p=d.GetMeshPointAt(l,g);p.SetX(e[0]);p.SetY(e[1]);p.SetZElevation(e[2]);p.SetU(e[3]);p.SetV(e[4])}}}a[16]&&(d=a[16][0],a=a[16][1],b=!!a,c=!b,e=this._runtime.GetTemplateManager(),b&&e&&e.MapInstanceToTemplateName(this.GetInstance(),a),c&&e&&e.MapInstanceToTemplateName(this.GetInstance(),d));enableUpdateRendererStateGroup=!0;this._UpdateRendererStateGroup()}InitNoData(){this._sinA=this._a=this._depth=this._h=
this._w=this._zElevation=this._y=this._x=0;this._cosA=1;this._oy=this._ox=0;this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){return this.GetTransformWithParentAngle()?this._MaybeReflectAngleForMirrorFlip(this.GetParent()._GetAngleNoReflect()-this._sceneGraphInfo.GetParentStartAngle()):0}SetX(a){a=+a;if(this.GetTransformWithParentX()){const b=this._sceneGraphInfo;a-=this.GetX();const d=
-this._GetParentOffsetAngle();0===d?this._x+=a/b.GetParentScaleX():(this._x+=Math.cos(d)*a/b.GetParentScaleX(),this.GetTransformWithParentY()&&(this._y+=Math.sin(d)*a/b.GetParentScaleY()))}else this._x=a}OffsetX(a,b=!1){a=+a;b?this._x+=a:this.GetTransformWithParentX()?this.SetX(this.GetX()+a):this._x+=a}GetX(){if(this.GetTransformWithParentX()){let a=this._x;const b=this._sceneGraphInfo,d=this.GetParent(),c=this._GetParentOffsetAngle();0===c?a*=b.GetParentScaleX():(a=a*b.GetParentScaleX()*Math.cos(c),
this.GetTransformWithParentY()&&(a-=this._y*b.GetParentScaleY()*Math.sin(c)));return d.GetX()+a}return this._x}SetY(a){a=+a;if(this.GetTransformWithParentY()){const b=this._sceneGraphInfo;a-=this.GetY();const d=-this._GetParentOffsetAngle();0===d?this._y+=a/b.GetParentScaleY():(this.GetTransformWithParentX()&&(this._x-=Math.sin(d)*a/b.GetParentScaleX()),this._y+=Math.cos(d)*a/b.GetParentScaleY())}else this._y=a}OffsetY(a,b=!1){a=+a;b?this._y+=a:this.GetTransformWithParentY()?this.SetY(this.GetY()+
a):this._y+=a}GetY(){if(this.GetTransformWithParentY()){let a=this._y;const b=this._sceneGraphInfo,d=this.GetParent(),c=this._GetParentOffsetAngle();0===c?a*=b.GetParentScaleY():(a=a*b.GetParentScaleY()*Math.cos(c),this.GetTransformWithParentX()&&(a+=this._x*b.GetParentScaleX()*Math.sin(c)));return d.GetY()+a}return this._y}SetXY(a,b){a=+a;b=+b;if(this.GetTransformWithParentXOrY()){const c=this.GetTransformWithParentX(),e=this.GetTransformWithParentY(),g=this._sceneGraphInfo,k=a-this.GetX(),l=b-this.GetY();
var d=-this._GetParentOffsetAngle();if(0===d)this._x=c?this._x+k/g.GetParentScaleX():a,this._y=e?this._y+l/g.GetParentScaleY():b;else{const n=Math.sin(d);d=Math.cos(d);this._x=c?e?this._x+(d*k-n*l)/g.GetParentScaleX():this._x+d*k/g.GetParentScaleX():a;this._y=e?c?this._y+(n*k+d*l)/g.GetParentScaleY():this._y+d*l/g.GetParentScaleY():b}}else this._x=a,this._y=b}GetXY(){return[this.GetX(),this.GetY()]}OffsetXY(a,b){a=+a;b=+b;this.GetTransformWithParentXOrY()?this.SetXY(this.GetX()+a,this.GetY()+b):(this._x+=
a,this._y+=b)}EqualsXY(a,b){return this.GetX()===a&&this.GetY()===b}SetZElevation(a){a=+a;this.GetTransformWithParentZElevation()&&(a-=this.GetParent().GetZElevation());this._zElevation!==a&&(this._zElevation=a,this._UpdateZElevation(),a=this.GetLayer(),0!==this._zElevation&&a._SetAnyInstanceZElevated(),a.SetZIndicesChanged(this))}_UpdateZElevation(){this._UpdateRendererStateGroup();if(this.HasChildren()){const a=this.GetChildren();for(let b=0,d=a.length;b<d;b++){const c=a[b];c.GetTransformWithParentZElevation()&&
c._UpdateZElevation()}}}OffsetZElevation(a){this.SetZElevation(this.GetZElevation()+a)}GetZElevation(){return this.GetTransformWithParentZElevation()?this.GetParent().GetZElevation()+this._zElevation:this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}SetWidth(a){a=+a;if(this.GetTransformWithParentWidth()){const b=this.GetWidth();this._w=0===b?Number.EPSILON:a/b*this._w}else this._w=a;this._MarkSinCosAngleChanged()}OffsetWidth(a,b){a=+a;b?this._w+=a:this.GetTransformWithParentWidth()?
this.SetWidth(this.GetWidth()+a):this._w+=a;this._MarkSinCosAngleChanged()}GetWidth(){if(this.GetTransformWithParentWidth()){const a=this.GetParent(),b=a.GetWidth();return a._GetSceneGraphInfo()._GetStartWidth()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartWidth()+b)*this._w:b*this._w}return this._w}SetHeight(a){a=+a;if(this.GetTransformWithParentHeight()){const b=this.GetHeight();this._h=0===b?Number.EPSILON:a/b*this._h}else this._h=a;this._MarkSinCosAngleChanged()}OffsetHeight(a,b){a=+a;
b?this._h+=a:this.GetTransformWithParentHeight()?this.SetHeight(this.GetHeight()+a):this._h+=a;this._MarkSinCosAngleChanged()}GetHeight(){if(this.GetTransformWithParentHeight()){const a=this.GetParent(),b=a.GetHeight();return a._GetSceneGraphInfo()._GetStartHeight()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartHeight()+b)*this._h:b*this._h}return this._h}SetSize(a,b){a=+a;b=+b;if(this.GetTransformWithParentWidth()){const d=this.GetWidth();this._w=0===d?Number.EPSILON:a/d*this._w}else this._w=
a;this.GetTransformWithParentHeight()?(a=this.GetHeight(),this._h=0===a?Number.EPSILON:b/a*this._h):this._h=b;this._MarkSinCosAngleChanged()}GetSize(){return[this.GetWidth(),this.GetHeight()]}GetDepth(){return this._depth}SetDepth(a){if(0>a)throw new RangeError("invalid depth");this._depth=a}GetSceneGraphScale(){if(this.HasParent()){const a=this._sceneGraphInfo;return Math.min(a.GetParentScaleX(),a.GetParentScaleY())}return 1}IsRotatable(){return 0!==(this._flags&FLAG_IS_ROTATABLE)}SetAngle(a){a=
+a;this.IsRotatable()&&(this.GetTransformWithParentAngle()&&(a-=this.GetParent().GetAngle()),a=C3$jscomp$190.clampAngle(a),this._a!==a&&(this._a=a,this._MarkSinCosAngleChanged()))}OffsetAngle(a){a=+a;0!==a&&this.IsRotatable()&&(this._a=C3$jscomp$190.clampAngle(this._a+a),this._MarkSinCosAngleChanged())}_MarkSinCosAngleChanged(){this._flags|=FLAG_SIN_COS_ANGLE_CHANGED;if(this.HasChildren()){const a=this.GetChildren();for(let b=0,d=a.length;b<d;b++)a[b]._MarkSinCosAngleChanged()}}GetAngle(){return this.GetTransformWithParentAngle()&&
this.IsRotatable()?this._MaybeReflectAngleForMirrorFlip(C3$jscomp$190.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a)):this._a}_GetAngleNoReflect(){return this.GetTransformWithParentAngle()&&this.IsRotatable()?C3$jscomp$190.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a):this._a}_MaybeReflectAngleForMirrorFlip(a){this.GetTransformWithParentWidth()&&0>this.GetTopParent().GetWidth()&&(a=C3$jscomp$190.clampAngle(C3$jscomp$190.angleReflect(a,this.GetTopParent().GetAngle()+Math.PI)));
this.GetTransformWithParentHeight()&&0>this.GetTopParent().GetHeight()&&(a=C3$jscomp$190.angleReflect(a,this.GetTopParent().GetAngle()));return a}_NeedsReflectAngleForMirrorOrFlip(){const a=this.GetParent();return this.GetTransformWithParentWidth()&&0>a.GetWidth()||this.GetTransformWithParentHeight()&&0>a.GetHeight()?!0:!1}_NeedsReflectAngleForMirrorAndFlip(){const a=this.GetParent();return this.GetTransformWithParentWidth()&&0>a.GetWidth()&&this.GetTransformWithParentHeight()&&0>a.GetHeight()?!0:
!1}_MaybeUpdateSinCosAngle(){const a=this._flags;if(0!==(a&FLAG_SIN_COS_ANGLE_CHANGED)){var b=this.GetAngle();this._sinA=Math.sin(b);this._cosA=Math.cos(b);this._flags=a&~FLAG_SIN_COS_ANGLE_CHANGED}}GetSinAngle(){this._MaybeUpdateSinCosAngle();return this._sinA}GetCosAngle(){this._MaybeUpdateSinCosAngle();return this._cosA}SetOriginX(a){this._ox=+a}OffsetOriginX(a){this._ox+=+a}GetOriginX(){return this._ox}SetOriginY(a){this._oy=+a}OffsetOriginY(a){this._oy+=+a}GetOriginY(){return this._oy}_SetColor(a){this._color.equals(a)||
(this._color===DEFAULT_COLOR?(this._color=C3$jscomp$190.New(C3$jscomp$190.Color,a),this._colorPremultiplied=C3$jscomp$190.New(C3$jscomp$190.Color,a),this._colorPremultiplied.premultiply()):a.equalsRgba(1,1,1,1)?this._colorPremultiplied=this._color=DEFAULT_COLOR:(this._color.set(a),this._colorPremultiplied.set(a),this._colorPremultiplied.premultiply()),this._UpdateRendererStateGroup())}SetOpacity(a){a=C3$jscomp$190.clamp(+a,0,1);if(this.GetTransformWithParentOpacity()){if(this._GetSceneGraphInfo().GetOwnOpacity()===
a)return;this._GetSceneGraphInfo().SetOwnOpacity(a);a=this.GetOpacity()}else if(this._color.a===a)return;this._SetColorWithOpacity(a)}_SetOpacityOfChildren(){if(this.HasChildren()){var a=this.GetChildren();for(let b=0,d=a.length;b<d;b++){const c=a[b];c._SetColorWithOpacity(c.GetOpacity())}}}_SetColorWithOpacity(a){tempColor$jscomp$6.copyRgb(this._color);tempColor$jscomp$6.a=a;this._SetColor(tempColor$jscomp$6);this._SetOpacityOfChildren()}OffsetOpacity(a){this.GetTransformWithParentOpacity()?this.SetOpacity(this._GetSceneGraphInfo().GetOwnOpacity()+
a):this.SetOpacity(this.GetOpacity()+a)}GetOpacity(){return this.GetTransformWithParentOpacity()?this.GetParent().GetOpacity()*this._GetSceneGraphInfo().GetOwnOpacity():this._color.a}SetUnpremultipliedColor(a){this._color.equalsIgnoringAlpha(a)||(tempColor$jscomp$6.copyRgb(a),tempColor$jscomp$6.a=this.GetOpacity(),this._SetColor(tempColor$jscomp$6))}SetUnpremultipliedColorRGB(a,b,d){tempColor$jscomp$6.setRgb(a,b,d);this.SetUnpremultipliedColor(tempColor$jscomp$6)}OffsetUnpremultipliedColorRGB(a,b,
d){if(0!==a||0!==b||0!==d)tempColor$jscomp$6.copyRgb(this._color),tempColor$jscomp$6.r+=a,tempColor$jscomp$6.g+=b,tempColor$jscomp$6.b+=d,this.SetUnpremultipliedColor(tempColor$jscomp$6)}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return 0!==(this._flags&FLAG_DESTROY_WITH_PARENT)}SetDestroyWithParent(a){this._SetFlag(FLAG_DESTROY_WITH_PARENT,a)}GetTransformWithParentX(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_X)}SetTransformWithParentX(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_X,
a)}GetTransformWithParentY(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_Y)}GetTransformWithParentXOrY(){return 0!==(this._flags&(FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y))}SetTransformWithParentY(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Y,a)}GetTransformWithParentWidth(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_W)}SetTransformWithParentWidth(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_W,a)}GetTransformWithParentHeight(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_H)}SetTransformWithParentHeight(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_H,
a)}GetTransformWithParentAngle(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_A)}SetTransformWithParentAngle(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_A,a)}GetTransformWithParentZElevation(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION)}SetTransformWithParentZElevation(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,a)}GetTransformWithParentOpacity(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_OPACITY)}SetTransformWithParentOpacity(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_OPACITY,
a)}GetTransformWithParentVisibility(){return 0!==(this._flags&FLAG_TRANSFORM_WITH_PARENT_VISIBILITY)}SetTransformWithParentVisibility(a){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,a)}_ClearAllSceneGraphFlags(){this._flags&=~MASK_ALL_SCENE_GRAPH_FLAGS}AddChild(a,b){if(a===this||a.HasParent()||this._HasChildRecursive(a)||this._HasAnyParent(a))return!1;var d=a.GetX(),c=a.GetY(),e=a.GetWidth();const g=a.GetHeight(),k=a.GetAngle(),l=a.GetZElevation(),n=a.GetOpacity();a._SetParent(this);a.SetTransformWithParentX(b.transformX);
a.SetTransformWithParentY(b.transformY);a.SetTransformWithParentWidth(b.transformWidth);a.SetTransformWithParentHeight(b.transformHeight);a.SetTransformWithParentAngle(b.transformAngle);a.SetTransformWithParentZElevation(b.transformZElevation);a.SetTransformWithParentOpacity(b.transformOpacity);a.SetTransformWithParentVisibility(b.transformVisibility);a.SetDestroyWithParent(b.destroyWithParent);b.transformX&&(a._x=d-this.GetX(),b.transformWidth&&(d=this.GetWidth()/this._sceneGraphInfo._GetStartWidth(),
0!==d&&(a._x/=d)));b.transformY&&(a._y=c-this.GetY(),b.transformHeight&&(c=this.GetHeight()/this._sceneGraphInfo._GetStartHeight(),0!==c&&(a._y/=c)));b.transformWidth&&(c=this.GetWidth(),0===c||c===Number.EPSILON?(a._w=1,a._sceneGraphInfo.SetStartScaleX(1)):(a._w=e/this.GetWidth(),a._sceneGraphInfo.SetStartScaleX(a._w)));b.transformHeight&&(e=this.GetHeight(),0===e||e===Number.EPSILON?(a._h=1,a._sceneGraphInfo.SetStartScaleY(1)):(a._h=g/this.GetHeight(),a._sceneGraphInfo.SetStartScaleY(a._h)));b.transformAngle&&
(a._a=k-this.GetAngle());b.transformZElevation&&(a._zElevation=l-this.GetZElevation());b.transformOpacity&&a._sceneGraphInfo.SetOwnOpacity(n);b.transformVisibility&&a.SetVisible(this.IsVisible());this._AddChildToSceneGraphInfo(a);this.SetBboxChanged();this._SetOpacityOfChildren();return!0}RemoveChild(a){if(a.GetParent()===this){var b=a.GetX(),d=a.GetY(),c=a.GetWidth(),e=a.GetHeight(),g=a.GetAngle(),k=a.GetZElevation(),l=a.GetOpacity();a._SetParent(null);a._ClearAllSceneGraphFlags();a.SetXY(b,d);a.SetSize(c,
e);a.SetAngle(g);a.SetZElevation(k);a.SetOpacity(l);this._RemoveChildFromSceneGraphInfo(a);this.SetBboxChanged()}}GetTmpHierarchyPosition(){return this._tmpHierarchyPosition}_ResetAllSceneGraphState(){this._BuildTmpSceneGraphData();var a=[...this.children()];for(const b of a)this.RemoveChild(b);(a=this.GetParent())&&a.RemoveChild(this);this._ClearAllSceneGraphFlags()}_BuildTmpSceneGraphData(){this._SetTmpHierarchyPosition();if(!this._tmpSceneGraphChildren){var a=[...this.children()];a.length&&(this._tmpSceneGraphChildren=
[],this._tmpSceneGraphChildrenIndexes=new WeakMap);var b=0;for(const d of a)a=d.GetInstance(),this._tmpSceneGraphChildren.push(a),this._tmpSceneGraphChildrenIndexes.set(a,b),b++}(b=this.GetParent())&&b._BuildTmpSceneGraphData()}_SetTmpHierarchyPosition(){if(-1===this._tmpHierarchyPosition){var a=[...this.parents()];this._tmpHierarchyPosition=a.length;for(const b of a)b._SetTmpHierarchyPosition();a=[...this.children()];for(const b of a)b._SetTmpHierarchyPosition()}}_ReleaseTmpSceneGraphInfo(){this._tmpSceneGraphChildren&&
(this._tmpSceneGraphChildren.length=0);this._tmpSceneGraphChildrenIndexes=this._tmpSceneGraphChildren=null;const a=this.GetParent();a&&a._ReleaseTmpSceneGraphInfo();this._tmpHierarchyPosition=-1}HasParent(){return null!==this.GetParent()}GetParent(){const a=this._sceneGraphInfo;return null!==a?a.GetParent():null}GetTopParent(){let a=this;for(;a.HasParent();)a=a.GetParent();return a}*parents(){let a=this.GetParent();for(;a;)yield a,a=a.GetParent()}HasChild(a){return this.GetChildren().includes(a)}HasChildren(){const a=
this._sceneGraphInfo;return null!==a?a.HasChildren():!1}GetChildren(){const a=this._sceneGraphInfo;return null!==a?a.GetChildren():EMPTY_ARRAY$jscomp$2}children(){return this.GetChildren()}*allChildren(){for(const a of this.children())yield a,yield*a.allChildren()}GetChildCount(){return this.GetChildren().length}GetAllChildCount(){return[...this.allChildren()].length}GetChildAt(a){const b=this.GetChildren();a=Math.floor(+a);return 0>a||a>=b.length?null:b[a]}GetChildIndex(a){if(!a)return NaN;const b=
this.GetChildren();if(!b)return NaN;for(let d=0;d<b.length;d++)if(a===b[d])return d;return NaN}_CreateSceneGraphInfo(a){this._sceneGraphInfo||(this._sceneGraphInfo=C3$jscomp$190.New(C3$jscomp$190.SceneGraphInfo,this));a&&this._sceneGraphInfo.SetParent(a)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){this._sceneGraphInfo&&(this._sceneGraphInfo.Release(),this._sceneGraphInfo=null)}_SetParent(a){a?(a._CreateSceneGraphInfo(null),this._CreateSceneGraphInfo(a)):(this._sceneGraphInfo&&
this._sceneGraphInfo.SetParent(null),this.HasChildren()||this._ReleaseSceneGraphInfo())}_HasAnyParent(a){if(!this.HasParent())return!1;const b=this.GetParent();return b===a?!0:b._HasAnyParent(a)}_HasChildRecursive(a){if(this.HasChild(a))return!0;for(const b of this.GetChildren())if(b._HasChildRecursive(a))return!0;return!1}_AddChildToSceneGraphInfo(a){this._sceneGraphInfo.GetChildren().push(a)}_RemoveChildFromSceneGraphInfo(a){const b=this._sceneGraphInfo.GetChildren(),d=b.indexOf(a);-1!==d&&b.splice(d,
1);0!==b.length||this.HasParent()||this._ReleaseSceneGraphInfo();a.HasChildren()||a._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){const a=sceneGraphExportDataMap.get(this);return a?a.childrenData:null}GetSceneGraphZIndexExportData(){const a=sceneGraphExportDataMap.get(this);return a?a.zIndexData:NaN}GetSceneGraphZIndex(){const a=sceneGraphZIndexMap.get(this);return C3$jscomp$190.IsFiniteNumber(a)?a:NaN}SetSceneGraphZIndex(a){sceneGraphZIndexMap.set(this,a)}SetUsePointsShaderProgram(){this._SetFlag(FLAG_USE_POINTS_SHADER_PROGRAM,
!0);this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(enableUpdateRendererStateGroup){var a=this._runtime.GetRenderer();this._stateGroup&&a.ReleaseStateGroup(this._stateGroup);var b=0!==(this._flags&FLAG_USE_POINTS_SHADER_PROGRAM)?a.GetPointsRenderingProgram()||"<point>":a.GetTextureFillShaderProgram()||"<default>";this._stateGroup=a.AcquireStateGroup(b,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===
DEFAULT_COLOR}SetBlendMode(a){a|=0;if(0>a||31<a)throw new RangeError("invalid blend mode");this.GetBlendMode()!==a&&(this._flags=this._flags&~FLAG_BLEND_MODE_MASK|a<<26,this._UpdateRendererStateGroup())}GetBlendMode(){return(this._flags&FLAG_BLEND_MODE_MASK)>>26}_SetLayer(a,b){(b=b&&this._layer!==a)&&this._RemoveFromRenderCells();this._layer=a;b&&this._UpdateRenderCell();0!==this.GetZElevation()&&this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(a){this._zIndex=
a|0}GetZIndex(){this._layer._UpdateZIndices();return this._zIndex}_SetHTMLZIndex(a){this._htmlZIndex=a|0}GetHTMLZIndex(){this._layer._UpdateHTMLZIndices();return this._htmlZIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(a,b){this._flags=b?this._flags|a:this._flags&~a}IsVisible(){return 0!==(this._flags&FLAG_IS_VISIBLE)}SetVisible(a){this._SetFlag(FLAG_IS_VISIBLE,a);if(this.HasChildren())for(const b of this.GetChildren())b.GetTransformWithParentVisibility()&&b.SetVisible(a)}IsCollisionEnabled(){return 0!==
(this._flags&FLAG_COLLISION_ENABLED)}SetCollisionEnabled(a){a=!!a;this.IsCollisionEnabled()!==a&&(this._SetFlag(FLAG_COLLISION_ENABLED,a),a?this.SetBboxChanged():this._RemoveFromCollisionCells())}SetSolidCollisionFilter(a,b){this._SetFlag(FLAG_SOLID_FILTER_INCLUSIVE,a);this._solidFilterTags&&this._solidFilterTags.clear();if(b.trim()){this._solidFilterTags||(this._solidFilterTags=new Set);for(const d of b.split(" "))d&&this._solidFilterTags.add(d.toLowerCase())}else this._solidFilterTags=null}IsSolidCollisionAllowed(a){const b=
0!==(this._flags&FLAG_SOLID_FILTER_INCLUSIVE),d=this._solidFilterTags;if(!a||!d)return!b;for(const c of d)if(a.has(c))return b;return!b}SetBboxChanged(){this._flags=this._flags|FLAG_BBOX_CHANGED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED;this._objectClass._SetAnyCollisionCellChanged(!0);this._runtime.UpdateRender();this._layer.UsesRenderCells()&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateRenderCell());0!==(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)&&
this._inst.Dispatcher().dispatchEvent(bboxChangeEvent);if(null!==this._sceneGraphInfo){const a=this._sceneGraphInfo.GetChildren();for(let b=0,d=a.length;b<d;++b)a[b].SetBboxChanged()}}CalculateBbox(a,b,d){const c=this.GetX(),e=this.GetY(),g=this.GetWidth(),k=this.GetHeight(),l=this.GetAngle();a.setWH(c-this._ox*g,e-this._oy*k,g,k);d&&this.HasMesh()&&this._ExpandBboxForMesh(a);0===l?b.setFromRect(a):(a.offset(-c,-e),b.setFromRotatedRectPrecalc(a,this.GetSinAngle(),this.GetCosAngle()),b.offset(c,e),
b.getBoundingBox(a));a.normalize()}_UpdateBbox(){const a=this._flags;0!==(a&FLAG_BBOX_CHANGED)&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags=a&~FLAG_BBOX_CHANGED)}GetBoundingBox(){this._UpdateBbox();return this._boundingBox}GetBoundingQuad(){this._UpdateBbox();return this._boundingQuad}PixelRoundQuad(a){var b=this.GetX(),d=this.GetY();b=Math.round(b)-b;d=Math.round(d)-d;if(0===b&&0===d)return a;tempQuad$jscomp$3.copy(a);tempQuad$jscomp$3.offset(b,d);return tempQuad$jscomp$3}OverwriteBoundingBox(a){this._boundingBox.copy(a);
this._boundingQuad.setFromRect(this._boundingBox);this._flags&=~FLAG_BBOX_CHANGED;this._UpdateCollisionCell();this._UpdateRenderCell()}SetBboxChangeEventEnabled(a){this._SetFlag(FLAG_ENABLE_BBOX_CHANGED_EVENT,a)}IsBboxChangeEventEnabled(){return 0!==(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)}IsInViewport(a,b,d){return b&&0!==this.GetDepth()?this.IsInViewport3D(this.GetLayer()._GetViewFrustum()):0===this.GetZElevation()||d?a.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){const a=
this.GetLayer(),b=this.GetTotalZElevation();if(b>=a.GetCameraZ())return!1;a.GetViewportForZ(b,tempRect$jscomp$7);return tempRect$jscomp$7.intersectsRect(this.GetBoundingBox())}IsInViewport3D(a){var b=this.GetBoundingBox();const d=b.getLeft(),c=b.getRight(),e=b.getTop();b=b.getBottom();const g=this.GetTotalZElevation(),k=g+this.GetDepth();return a.ContainsAABB(d,e,g,c,b,k)}IsInViewport2(){const a=this.GetLayer();if(a.Has3DCamera())return this.IsInViewport3D(a._GetViewFrustum());const b=a.GetLayout();
return this.IsInViewport(a.GetViewport(),b.HasVanishingPointOutsideViewport(),b.IsOrthographicProjection())}_SetDrawBackFaceOnly(a){this._SetFlag(FLAG_DRAW_BACK_FACE_ONLY,a)}_SetDrawNonBackFacesOnly(a){this._SetFlag(FLAG_DRAW_NON_BACK_FACES_ONLY,a)}IsDrawBackFaceOnly(){return 0!==(this._flags&FLAG_DRAW_BACK_FACE_ONLY)}IsDrawNonBackFacesOnly(){return 0!==(this._flags&FLAG_DRAW_NON_BACK_FACES_ONLY)}SetSourceCollisionPoly(a){this._sourceCollisionPoly=a;this._DiscardTransformedCollisionPoly();this.HasMesh()&&
(this._meshInfo.meshPoly=null)}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return null!==this._sourceCollisionPoly||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(a,b,d){let c=0,e=1;0!==d&&(c=Math.sin(d),e=Math.cos(d));return this._GetCustomTransformedCollisionPolyPrecalc(a,b,d,c,e)}_GetCustomTransformedCollisionPolyPrecalc(a,
b,d,c,e){let g=this._transformedPolyInfo;null===g&&(this._transformedPolyInfo=g={poly:C3$jscomp$190.New(C3$jscomp$190.CollisionPoly),width:NaN,height:NaN,angle:NaN});const k=g.poly;if(g.width===a&&g.height===b&&g.angle===d)return k;const l=this._sourceCollisionPoly;if(this.HasMesh()){const n=this.GetOriginX(),p=this.GetOriginY(),r=this.GetSourceMesh();let w=this._meshInfo.meshPoly;w||(l?(tempCollisionPoly.copy(l),tempCollisionPoly.offset(n,p)):tempCollisionPoly.setDefaultPoints(),w=r.InsertPolyMeshVertices(tempCollisionPoly),
this._meshInfo.meshPoly=w);r.TransformCollisionPoly(w,k);k.offset(-n,-p);k.transformPrecalc(a,b,c,e)}else l?(k.copy(l),k.transformPrecalc(a,b,c,e)):k.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());g.width=a;g.height=b;g.angle=d;return k}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(!0);const a=this._transformedPolyInfo;null!==a&&(a.width=NaN)}CreateMesh(a,b){a=Math.floor(a);b=Math.floor(b);if(!this.GetInstance().GetPlugin().SupportsMesh())throw Error("object does not support mesh");
this.ReleaseMesh();this._meshInfo={sourceMesh:C3$jscomp$190.New(C3$jscomp$190.Gfx.Mesh,a,b),transformedMesh:C3$jscomp$190.New(C3$jscomp$190.Gfx.Mesh,a,b),meshPoly:null}}HasMesh(){return null!==this._meshInfo}GetSourceMesh(){if(!this.HasMesh())throw Error("no mesh");return this._meshInfo.sourceMesh}GetTransformedMesh(){if(!this.HasMesh())throw Error("no mesh");return this._meshInfo.transformedMesh}SetMeshChanged(a){this._SetFlag(FLAG_MESH_CHANGED,a)}IsMeshChanged(){return 0!==(this._flags&FLAG_MESH_CHANGED)}SetPhysicsBodyChanged(a){this._SetFlag(FLAG_PHYSICS_BODY_CHANGED,
a)}IsPhysicsBodyChanged(){return 0!==(this._flags&FLAG_PHYSICS_BODY_CHANGED)}_ExpandBboxForMesh(a){const b=this._meshInfo.sourceMesh,d=Math.min(b.GetMinX(),0),c=Math.min(b.GetMinY(),0),e=Math.max(b.GetMaxX(),1),g=Math.max(b.GetMaxY(),1),k=a.width(),l=a.height();a.offsetLeft(d*k);a.offsetTop(c*l);a.offsetRight((e-1)*k);a.offsetBottom((g-1)*l);this._depth=b.GetMaxZ()}ReleaseMesh(){this._meshInfo&&(this._meshInfo.sourceMesh.Release(),this._meshInfo.transformedMesh.Release(),this._meshInfo=null,this._DiscardTransformedCollisionPoly())}SetMeshPoint(a,
b,d){a=Math.floor(a);b=Math.floor(b);var c=d.mode||"absolute";if(!VALID_SET_MESH_POINT_MODES.has(c))throw Error("invalid mode");c="relative"===c;let e=d.x,g=d.y;const k=d.zElevation;let l="number"===typeof d.u?d.u:c?0:-1;d="number"===typeof d.v?d.v:c?0:-1;if(!this.HasMesh())return!1;const n=this.GetSourceMesh(),p=n.GetMeshPointAt(a,b);if(null===p)return!1;let r=!1;"number"===typeof k&&p.GetZElevation()!==k&&(p.SetZElevation(k),r=!0);c&&(e+=a/(n.GetHSize()-1),g+=b/(n.GetVSize()-1));-1!==l||c?(c&&(l+=
a/(n.GetHSize()-1)),l=C3$jscomp$190.clamp(l,0,1)):l=p.GetU();-1!==d||c?(c&&(d+=b/(n.GetVSize()-1)),d=C3$jscomp$190.clamp(d,0,1)):d=p.GetV();if(p.GetX()===e&&p.GetY()===g&&p.GetU()===l&&p.GetV()===d)return r;p.SetX(e);p.SetY(g);p.SetU(l);p.SetV(d);this._DiscardTransformedCollisionPoly();return!0}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(a,b){return this.GetBoundingBox().containsPoint(a,b)&&this.GetBoundingQuad().containsPoint(a,b)?this.HasTilemap()?this._inst.GetSdkInstance().TestPointOverlapTile(a,
b):this.HasOwnCollisionPoly()?this.GetTransformedCollisionPoly().containsPoint(a-this.GetX(),b-this.GetY()):!0:!1}_IsCollisionCellChanged(){return 0!==(this._flags&FLAG_COLLISION_CELL_CHANGED)}_UpdateCollisionCell(){if(this._IsCollisionCellChanged()&&this.IsCollisionEnabled()&&0===(this._flags&FLAG_DESTROYED$jscomp$1)){var a=this.GetBoundingBox(),b=this._objectClass._GetCollisionCellGrid(),d=this._collisionCells;tempRect$jscomp$7.set(b.XToCell(a.getLeft()),b.YToCell(a.getTop()),b.XToCell(a.getRight()),
b.YToCell(a.getBottom()));d.equals(tempRect$jscomp$7)||(a=this._inst,d===DEFAULT_COLLISION_CELLS?(b.Update(a,null,tempRect$jscomp$7),this._collisionCells=C3$jscomp$190.New(C3$jscomp$190.Rect,tempRect$jscomp$7)):(b.Update(a,d,tempRect$jscomp$7),d.copy(tempRect$jscomp$7)),this._flags&=~FLAG_COLLISION_CELL_CHANGED)}}_SetCollisionCellChanged(){this._flags|=FLAG_COLLISION_CELL_CHANGED}_RemoveFromCollisionCells(){const a=this._collisionCells;a!==DEFAULT_COLLISION_CELLS&&(this._objectClass._GetCollisionCellGrid().Update(this._inst,
a,null),this._collisionCells=DEFAULT_COLLISION_CELLS)}_UpdateRenderCell(){const a=this.GetLayer();if(a.UsesRenderCells()&&0===(this._flags&FLAG_DESTROYED$jscomp$1)){var b=a.GetRenderGrid(),d=this.GetBoundingBox(),c=this._renderCells;tempRect$jscomp$7.set(b.XToCell(d.getLeft()),b.YToCell(d.getTop()),b.XToCell(d.getRight()),b.YToCell(d.getBottom()));c.equals(tempRect$jscomp$7)||(d=this._inst,c===DEFAULT_RENDER_CELLS?(b.Update(d,null,tempRect$jscomp$7),this._renderCells=C3$jscomp$190.New(C3$jscomp$190.Rect,
tempRect$jscomp$7)):(b.Update(d,c,tempRect$jscomp$7),c.copy(tempRect$jscomp$7)),a.SetRenderListStale())}}_RemoveFromRenderCells(){const a=this._renderCells;a!==DEFAULT_RENDER_CELLS&&(this.GetLayer().GetRenderGrid().Update(this._inst,a,null),this._renderCells=DEFAULT_RENDER_CELLS)}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){const a=this._inst,b=this._layer,d=b._GetInstances();d.length&&d.at(-1)===a||(b._RemoveInstance(a,!1),b._AddInstance(a,!1),this._runtime.UpdateRender())}ZOrderMoveToBottom(){const a=
this._inst,b=this._layer,d=b._GetInstances();d.length&&d[0]===a||(b._RemoveInstance(a,!1),b._PrependInstance(a,!1),this._runtime.UpdateRender())}ZOrderMoveToLayer(a){const b=this._inst,d=this._layer;if(d.GetLayout()!==a.GetLayout())throw Error("layer from different layout");a!==d&&(d._RemoveInstance(b,!0),this._SetLayer(a),a._AddInstance(b,!0),this._runtime.UpdateRender())}ZOrderMoveAdjacentToInstance(a,b){const d=this._inst;let c=!1;const e=this._layer;if(a.GetUID()!==d.GetUID()){var g=a.GetWorldInfo();
if(!g)throw Error("expected world instance");g=g.GetLayer();e.GetIndex()!==g.GetIndex()&&(e._RemoveInstance(d,!0),this._SetLayer(g),g._AddInstance(d,!0),c=!0);a=g.MoveInstanceAdjacent(d,a,!!b);(c||a)&&this._runtime.UpdateRender()}}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(a){this._SetFlag(FLAG_HAS_ANY_ACTIVE_EFFECT,a)}HasAnyActiveEffect(){return 0!==(this._flags&FLAG_HAS_ANY_ACTIVE_EFFECT)}_SaveToJson(a,b=null){const d={x:this.GetX(),y:this.GetY(),w:this.GetWidth(),
h:this.GetHeight(),l:this.GetLayer().GetSID(),zi:this.GetZIndex()};0!==this.GetZElevation()&&(d.ze=this.GetZElevation());0!==this.GetAngle()&&(d.a=this._GetAngleNoReflect());this.HasDefaultColor()||(d.c=this._color.toJSON());.5!==this.GetOriginX()&&(d.oX=this.GetOriginX());.5!==this.GetOriginY()&&(d.oY=this.GetOriginY());0!==this.GetBlendMode()&&(d.bm=this.GetBlendMode());this.IsVisible()||(d.v=this.IsVisible());this.IsCollisionEnabled()||(d.ce=this.IsCollisionEnabled());this.IsBboxChangeEventEnabled()&&
(d.be=this.IsBboxChangeEventEnabled());this._instanceEffectList&&(d.fx=this._instanceEffectList._SaveToJson());const c=0!==(this._flags&FLAG_SOLID_FILTER_INCLUSIVE);c&&(d.sfi=c);this._solidFilterTags&&(d.sft=[...this._solidFilterTags].join(" "));this._sceneGraphInfo&&"visual-state"!==a&&(d.sgi=this._sceneGraphInfo._SaveToJson(a,b),sceneGraphExportDataMap.has(this)&&(d.sgcd=sceneGraphExportDataMap.get(this).childrenData,d.sgzid=sceneGraphExportDataMap.get(this).zIndexData));this.HasMesh()&&(d.mesh=
this.GetSourceMesh().SaveToJson());return d}_SaveSceneGraphPropertiesToJson(){return{x:this._x,y:this._y,z:this._zElevation,w:this._w,h:this._h,a:this._a,sgi:this._GetSceneGraphInfo()?this._GetSceneGraphInfo()._SaveToJsonProperties():null}}_LoadSceneGraphPropertiesFromJson(a){a&&(this._x=a.x,this._y=a.y,this._zElevation=a.z,this._w=a.w,this._h=a.h,this._a=a.a,a.sgi&&this._GetSceneGraphInfo()&&this._GetSceneGraphInfo()._LoadFromJson(a.sgi),this._MarkSinCosAngleChanged(),this.SetBboxChanged())}_SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo();
this._ResetAllSceneGraphState();this._CreateSceneGraphInfo(null);this._sceneGraphInfo&&this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes)}_OnBeforeLoad(a){"visual-state"!==a&&this._ResetAllSceneGraphState()}_OnAfterLoad(a,b="full",d=null){a.hasOwnProperty("sgi")&&"visual-state"!==b&&0===(this._flags&FLAG_DESTROYED$jscomp$1)&&this._sceneGraphInfo._OnAfterLoad(a.sgi,d)}_OnAfterLoad2(a,b="full",d){a.hasOwnProperty("sgi")&&"visual-state"!==b&&
0===(this._flags&FLAG_DESTROYED$jscomp$1)&&(this._sceneGraphInfo._SetTmpSceneGraphChildren(null,null),this._ReleaseTmpSceneGraphInfo(),this.SetBboxChanged())}_LoadFromJson(a,b){enableUpdateRendererStateGroup=!1;this.SetX(a.x);this.SetY(a.y);this.SetWidth(a.w);this.SetHeight(a.h);this._SetZIndex(a.zi);this.SetZElevation(a.hasOwnProperty("ze")?a.ze:0);this.SetAngle(a.hasOwnProperty("a")?a.a:0);a.hasOwnProperty("c")?tempColor$jscomp$6.setFromJSON(a.c):a.hasOwnProperty("o")?(tempColor$jscomp$6.copyRgb(this._color),
tempColor$jscomp$6.a=a.o):tempColor$jscomp$6.setRgba(1,1,1,1);this._SetColor(tempColor$jscomp$6);this.SetOriginX(a.hasOwnProperty("oX")?a.oX:.5);this.SetOriginY(a.hasOwnProperty("oY")?a.oY:.5);this.SetBlendMode(a.hasOwnProperty("bm")?a.bm:0);this.SetVisible(a.hasOwnProperty("v")?a.v:!0);this.SetCollisionEnabled(a.hasOwnProperty("ce")?a.ce:!0);this.SetBboxChangeEventEnabled(a.hasOwnProperty("be")?a.be:!1);this.SetSolidCollisionFilter(a.hasOwnProperty("sfi")?a.sfi:!1,a.hasOwnProperty("sft")?a.sft:"");
this._instanceEffectList&&a.hasOwnProperty("fx")&&this._instanceEffectList._LoadFromJson(a.fx);if(!a.hasOwnProperty("sgi")&&"visual-state"!==b&&this._tmpSceneGraphChildren)for(var d of this._tmpSceneGraphChildren)d.IsDestroyed()||this._runtime.DestroyInstance(d);a.hasOwnProperty("sgi")&&"visual-state"!==b&&(this._CreateSceneGraphInfo(null),d=this._sceneGraphInfo,d._LoadFromJson(a.sgi),d._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes),a.sgcd&&C3$jscomp$190.IsFiniteNumber(a.sgzid)&&
sceneGraphExportDataMap.set(this,{childrenData:a.sgcd,zIndexData:a.sgzid}));a.hasOwnProperty("mesh")?(d=a.mesh,this.CreateMesh(d.cols,d.rows),this.GetSourceMesh().LoadFromJson(d)):this.ReleaseMesh();this.SetBboxChanged();enableUpdateRendererStateGroup=!0;this._UpdateRendererStateGroup();"visual-state"!==b&&this._runtime.AddInstanceNeedingAfterLoad(this.GetInstance(),a)}};"use strict";const C3$jscomp$191=self.C3;
C3$jscomp$191.BehaviorType=class extends C3$jscomp$191.DefendedBase{constructor(a,b){super();const d=a.GetRuntime(),c=d.GetObjectReference(b[1]);d.GetAddonManager()._DelayCreateBehavior(c);this._runtime=d;this._objectClass=a;this._behavior=C3$jscomp$191.AddonManager.GetBehaviorByConstructorFunction(c);this._iBehaviorType=this._sdkType=null;this._instSdkCtor=c.Instance;this._sid=b[2];this._name=b[0];this._jsPropName=this._runtime.GetJsPropName(b[3]);a=this._behavior.GetSdkVersion();if(2>a&&(this._sdkType=
C3$jscomp$191.New(c.Type,this),!(this._sdkType instanceof C3$jscomp$191.SDKBehaviorTypeBase)))throw Error("v1 sdk type must derive from SDKBehaviorBase");C3$jscomp$191.AddonManager._PushInitObject(this,a);if(2<=a){if(this._iBehaviorType=new (c.Type??globalThis.ISDKBehaviorTypeBase),!(this._iBehaviorType instanceof globalThis.ISDKBehaviorTypeBase))throw Error("script interface class must derive from ISDKBehaviorTypeBase");}else this._iBehaviorType=new globalThis.IBehaviorType;C3$jscomp$191.AddonManager._PopInitObject(a);
this.OnCreate()}static Create(a,b){return C3$jscomp$191.New(C3$jscomp$191.BehaviorType,a,b)}Release(){this._behavior=this._runtime=null;this._sdkType&&(this._sdkType.Release(),this._sdkType=null);this._instSdkCtor=null}GetSdkType(){return this._sdkType}OnCreate(){this._sdkType?this._sdkType.OnCreate():this._iBehaviorType&&this._iBehaviorType._onCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetIBehaviorType(){return this._iBehaviorType}GetJsPropName(){return this._jsPropName}};
"use strict";const C3$jscomp$192=self.C3,IBehaviorInstance$jscomp$1=self.IBehaviorInstance;
C3$jscomp$192.BehaviorInstance=class extends C3$jscomp$192.DefendedBase{constructor(a){super();this._runtime=a.runtime;this._behaviorType=a.behaviorType;this._behavior=this._behaviorType.GetBehavior();this._inst=a.instance;this._index=a.index;this._iScriptInterface=this._sdkInst=null;this._behavior._AddInstance(this._inst)}Release(){this._iScriptInterface&&(this._iScriptInterface._release(),this._iScriptInterface=null);this._behavior._RemoveInstance(this._inst);this._sdkInst&&(this._sdkInst.Release(),
this._sdkInst=null);this._inst=this._behavior=this._behaviorType=this._runtime=null}_CreateSdkInstance(a){if(this._sdkInst)throw Error("already got sdk instance");if(2>this.GetBehavior().GetSdkVersion()){if(this._sdkInst=C3$jscomp$192.New(this._behaviorType.GetInstanceSdkCtor(),this,a),!(this._sdkInst instanceof C3$jscomp$192.SDKBehaviorInstanceBase))throw Error("v1 sdk type must derive from SDKBehaviorInstanceBase");}else{const b=this.GetBehavior().GetScriptInterfaceClass();this._InitScriptInterface(b.Instance,
a)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){this._sdkInst?this._sdkInst.PostCreate():this._iScriptInterface._postCreate()}OnSpriteFrameChanged(a,b){this._sdkInst&&this._sdkInst.OnSpriteFrameChanged(a,b)}_GetDebuggerProperties(){return this._sdkInst?this._sdkInst.GetDebuggerProperties():
this._iScriptInterface._getDebuggerProperties()}SaveToJson(a="full"){return this._sdkInst?this._sdkInst.SaveToJson(a):this._iScriptInterface._saveToJson(a)}LoadFromJson(a,b="full"){if(this._sdkInst)return this._sdkInst.LoadFromJson(a,b);this._iScriptInterface._loadFromJson(a,b)}static SortByTickSequence(a,b,d){var c=globalThis.ISDKBehaviorInstanceBase;b=b instanceof c?a._UnwrapScriptInterface(b):b.GetBehaviorInstance();a=d instanceof c?a._UnwrapScriptInterface(d):d.GetBehaviorInstance();c=b.GetObjectInstance();
d=a.GetObjectInstance();const e=c.GetObjectClass().GetIndex(),g=d.GetObjectClass().GetIndex();if(e!==g)return e-g;c=c.GetPUID();d=d.GetPUID();return c!==d?c-d:b._GetIndex()-a._GetIndex()}_InitScriptInterface(a,b){const d=(a=a??this._sdkInst.GetScriptInterfaceClass())||IBehaviorInstance$jscomp$1,c=this.GetBehavior().GetSdkVersion();C3$jscomp$192.AddonManager._PushInitObject(this,c);C3$jscomp$192.AddonManager._PushInitProperties(b);this._iScriptInterface=new d;C3$jscomp$192.AddonManager._PopInitProperties();
C3$jscomp$192.AddonManager._PopInitObject(c);if(a&&!(this._iScriptInterface instanceof IBehaviorInstance$jscomp$1))throw new TypeError(`script interface class '${a.name}' does not extend the right base class '${IBehaviorInstance$jscomp$1.name}'`);return this._iScriptInterface}GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}};"use strict";const C3$jscomp$193=self.C3;
C3$jscomp$193.EffectList=class extends C3$jscomp$193.DefendedBase{constructor(a,b){super();this._owner=a;this._allEffectTypes=[];this._activeEffectTypes=[];this._effectTypesByName=new Map;this._effectParams=[];this._effectParamBuffers=[];this._allInstanceEffectLists=new Set;this._preservesOpaqueness=!0;for(const d of b)a=C3$jscomp$193.New(C3$jscomp$193.EffectType,this,d,this._allEffectTypes.length),this._allEffectTypes.push(a),this._effectTypesByName.set(a.GetName().toLowerCase(),a),3<=d.length&&
this._effectParams.push(this._LoadSingleEffectParameters(a,d[2]));this.GetRuntime()._AddEffectList(this)}Release(){this.GetRuntime()._RemoveEffectList(this);for(const a of this._effectParamBuffers)a.Release();C3$jscomp$193.clearArray(this._effectParamBuffers);C3$jscomp$193.clearArray(this._allEffectTypes);C3$jscomp$193.clearArray(this._activeEffectTypes);this._effectTypesByName.clear();C3$jscomp$193.clearArray(this._effectParams);this._owner=null}_AddInstanceEffectList(a){this._allInstanceEffectLists.add(a)}_RemoveInstanceEffectList(a){this._allInstanceEffectLists.delete(a)}_InitRenderer(a){a.IsWebGPU()&&
(this._effectParamBuffers=this._allEffectTypes.map(b=>{b=b.GetShaderProgram();return 0<b.GetCustomParametersByteSize()?C3$jscomp$193.New(C3$jscomp$193.Gfx.WebGPUEffectCustomParamsBuffer,b):null}),this._UpdateAllEffectParamBuffers());for(const b of this._allInstanceEffectLists)b._InitRenderer(a)}PrependEffectTypes(a){if(a.length){this._allEffectTypes=a.concat(this._allEffectTypes);for(const b of a)this._effectTypesByName.set(b.GetName().toLowerCase(),b);for(let b=0,d=this._allEffectTypes.length;b<
d;++b)this._allEffectTypes[b]._SetIndex(b)}}_LoadSingleEffectParameters(a,b){a.SetActive(b[0]);a=b.slice(1);for(let d=0,c=a.length;d<c;++d)if(b=a[d],Array.isArray(b)){const e=C3$jscomp$193.New(C3$jscomp$193.Color);e.setFromJSON(b);a[d]=e}return a}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){C3$jscomp$193.clearArray(this._activeEffectTypes);let a=!0;for(const b of this._allEffectTypes)b.IsActive()&&(this._activeEffectTypes.push(b),b.GetShaderProgram().PreservesOpaqueness()||
(a=!1));this._preservesOpaqueness=a}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return 0<this._allEffectTypes.length}GetEffectTypeByName(a){return this._effectTypesByName.get(a.toLowerCase())||null}GetEffectTypeByIndex(a){a=Math.floor(+a);if(0>a||a>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[a]}IsEffectIndexActive(a){return this.GetEffectTypeByIndex(a).IsActive()}SetEffectIndexActive(a,b){this.GetEffectTypeByIndex(a).SetActive(b)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return 0<
this._activeEffectTypes.length}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(a){return this._effectParams[a]}_GetEffectChainShaderParametersForIndex(a){return a<this._effectParamBuffers.length?this._effectParamBuffers[a]:this._effectParams[a]}GetEffectParameter(a,b){if(0>a||a>=this._effectParams.length)return null;a=this._effectParams[a];return 0>b||b>=a.length?null:a[b]}SetEffectParameter(a,b,d){if(0>a||a>=this._effectParams.length)return!1;const c=this._effectParams[a];
if(0>b||b>=c.length)return!1;const e=c[b];if(e instanceof C3$jscomp$193.Color){if(e.equalsIgnoringAlpha(d))return!1;e.copyRgb(d)}else{if(e===d)return!1;c[b]=d}a<this._effectParamBuffers.length&&this._effectParamBuffers[a].SetParameterValue(b,d);return!0}_UpdateAllEffectParamBuffers(){const a=this._effectParams,b=this._effectParamBuffers;for(let d=0,c=Math.min(a.length,b.length);d<c;++d){const e=b[d],g=a[d];for(let k=0,l=g.length;k<l;++k)e.SetParameterValue(k,g[k])}}static SaveFxParamToJson(a){return a&&
a instanceof C3$jscomp$193.Color?{t:"color",v:a.toJSON()}:a}static LoadFxParamFromJson(a){if(null===a)return NaN;if("object"===typeof a){if("color"===a.t){const b=C3$jscomp$193.New(C3$jscomp$193.Color);b.setFromJSON(a.v);return b}throw Error("invalid effect parameter type");}return a}static SaveFxParamsToJson(a){return a.map(C3$jscomp$193.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(a){return a.map(C3$jscomp$193.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map(a=>
({name:a.GetName(),active:a.IsActive(),params:C3$jscomp$193.EffectList.SaveFxParamsToJson(this._effectParams[a.GetIndex()])}))}LoadFromJson(a){for(const b of a)if(a=this.GetEffectTypeByName(b.name))a.SetActive(b.active),this._effectParams[a.GetIndex()]=C3$jscomp$193.EffectList.LoadFxParamsFromJson(b.params);this.UpdateActiveEffects();this._UpdateAllEffectParamBuffers()}};"use strict";const C3$jscomp$194=self.C3;
C3$jscomp$194.EffectType=class extends C3$jscomp$194.DefendedBase{constructor(a,b,d){super();this._effectList=a;this._id=b[0];this._name=b[1];this._index=d;this._shaderProgram=null;this._isActive=!0}Release(){this._shaderProgram=this._effectList=null}Clone(a){a=C3$jscomp$194.New(C3$jscomp$194.EffectType,a,[this._id,this._name],-1);a._shaderProgram=this._shaderProgram;a._isActive=this._isActive;return a}_InitRenderer(a){a=a.GetShaderProgramByName(this._id);if(!a)throw Error("failed to find shader program '"+
this._id+"'");this._shaderProgram=a}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(a){this._index=a}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(a){this._isActive=!!a}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){const a=[];for(let b=0,d=this._shaderProgram.GetParameterCount();b<d;++b){const c=this._shaderProgram.GetParameterType(b);
if("float"===c||"percent"===c)a.push(0);else if("color"===c)a.push(C3$jscomp$194.New(C3$jscomp$194.Color,1,1,1,1));else throw new TypeError("unknown effect parameter type");}return a}};"use strict";const C3$jscomp$195=self.C3;
C3$jscomp$195.InstanceEffectList=class extends C3$jscomp$195.DefendedBase{constructor(a,b){super();this._inst=a;this._wi=b;this._effectList=a.GetObjectClass().GetEffectList();this._wasDefaultColor=this._needsRebuildSteps=!0;this._wasMustPreDraw=this._wasTexRotated=this._wasRotatedOrNegativeSize=this._was3D=!1;this._effectChain=C3$jscomp$195.New(C3$jscomp$195.Gfx.EffectChain,a.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(d,c)=>{c=c.GetContentObject();const e=c.GetWorldInfo();
d.SetColor(e.GetPremultipliedColor());d.SetCurrentZ(e.GetTotalZElevation());c.Draw(d);d.SetCurrentZ(0)},getSourceTextureInfo:d=>{const c=d.GetCurrentTexRect(),[e,g]=d.GetCurrentSurfaceSize();return{srcTexRect:c,srcWidth:e,srcHeight:g}},getShaderParameters:d=>this._GetEffectChainShaderParametersForIndex(d)});this._activeEffectFlags=[];this._activeEffectTypes=[];this._preservesOpaqueness=!0;this._effectParams=[];this._effectParamBuffers=[];this._InitRenderer(a.GetRuntime().GetRenderer());for(let d=
0,c=this._effectList.GetAllEffectTypes().length;d<c;++d)this._activeEffectFlags.push(!0);this.UpdateActiveEffects();this._effectList._AddInstanceEffectList(this)}Release(){this._effectList._RemoveInstanceEffectList(this);for(const a of this._effectParamBuffers)a&&a.Release();C3$jscomp$195.clearArray(this._effectParamBuffers);this._effectChain.Release();this._effectChain=null;C3$jscomp$195.clearArray(this._activeEffectFlags);C3$jscomp$195.clearArray(this._activeEffectTypes);C3$jscomp$195.clearArray(this._effectParams);
this._effectList=this._inst=null}_InitRenderer(a){a.IsWebGPU()&&(this._effectParamBuffers=this._effectList.GetAllEffectTypes().map(b=>{b=b.GetShaderProgram();return 0<b.GetCustomParametersByteSize()?C3$jscomp$195.New(C3$jscomp$195.Gfx.WebGPUEffectCustomParamsBuffer,b):null}))}_LoadEffectParameters(a){let b=0;for(const d of a)this._effectParams.push(this._LoadSingleEffectParameters(b,d)),++b;this._UpdateAllEffectParamBuffers();this.UpdateActiveEffects()}_LoadSingleEffectParameters(a,b){this._activeEffectFlags[a]=
b[0];a=b.slice(1);for(let d=0,c=a.length;d<c;++d)if(b=a[d],Array.isArray(b)){const e=C3$jscomp$195.New(C3$jscomp$195.Color);e.setFromJSON(b);a[d]=e}return a}LoadDefaultEffectParameters(){for(const a of this._effectList.GetAllEffectTypes())this._effectParams.push(a.GetDefaultParameterValues());this._UpdateAllEffectParamBuffers()}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){C3$jscomp$195.clearArray(this._activeEffectTypes);
const a=this._wi,b=this._effectList.GetAllEffectTypes(),d=this._activeEffectTypes,c=this._activeEffectFlags;let e=!0;for(let g=0,k=b.length;g<k;++g)if(c[g]){const l=b[g];d.push(l);l.GetShaderProgram().PreservesOpaqueness()||(e=!1)}this._preservesOpaqueness=e;a._SetHasAnyActiveEffect(!!d.length);this._needsRebuildSteps=!0}_MaybeRebuildEffectChainSteps(){var a=this._inst,b=this._wi;const d=b.HasDefaultColor(),c=a.GetPlugin().Is3D();b=0!==b.GetAngle()||0!==b.GetLayer().GetAngle()||0>b.GetWidth()||0>
b.GetHeight();const e=a.IsCurrentTexRotated();a=a.MustPreDraw();if(this._needsRebuildSteps||d!==this._wasDefaultColor||c!==this._was3D||b!==this._wasRotatedOrNegativeSize||e!==this._wasTexRotated||a!==this._wasMustPreDraw||this._effectChain.NeedsRebuild())this._effectChain.BuildSteps(this._activeEffectTypes.map(g=>g.GetShaderProgram()),{indexMap:this._activeEffectTypes.map(g=>g.GetIndex()),forcePreDraw:!d||a,is3D:c,isSourceTextureRotated:e,isRotatedOrNegativeSizeInstance:b}),this._needsRebuildSteps=
!1,this._wasDefaultColor=d,this._was3D=c,this._wasRotatedOrNegativeSize=b,this._wasTexRotated=e,this._wasMustPreDraw=a}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(a){return this._effectParams[a]}_GetEffectChainShaderParametersForIndex(a){return a<this._effectParamBuffers.length?this._effectParamBuffers[a]:this._effectParams[a]}GetEffectParameter(a,b){if(0>a||a>=this._effectParams.length)return null;a=this._effectParams[a];return 0>b||b>=a.length?null:a[b]}SetEffectParameter(a,
b,d){if(0>a||a>=this._effectParams.length)return!1;const c=this._effectParams[a];if(0>b||b>=c.length)return!1;const e=c[b];if(e instanceof C3$jscomp$195.Color){if(e.equalsIgnoringAlpha(d))return!1;e.copyRgb(d)}else{if(e===d)return!1;c[b]=d}a<this._effectParamBuffers.length&&this._effectParamBuffers[a].SetParameterValue(b,d);return!0}_UpdateAllEffectParamBuffers(){const a=this._effectParams,b=this._effectParamBuffers;for(let d=0,c=b.length;d<c;++d){const e=b[d],g=a[d];for(let k=0,l=g.length;k<l;++k)e.SetParameterValue(k,
g[k])}}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some(a=>a.GetShaderProgram().BlendsBackground())}IsEffectIndexActive(a){return this._activeEffectFlags[a]}SetEffectIndexActive(a,b){this._activeEffectFlags[a]=!!b}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map(a=>({name:a.GetName(),active:this._activeEffectFlags[a.GetIndex()],params:C3$jscomp$195.EffectList.SaveFxParamsToJson(this._effectParams[a.GetIndex()])}))}_LoadFromJson(a){for(const b of a)if(a=
this._effectList.GetEffectTypeByName(b.name))this._activeEffectFlags[a.GetIndex()]=b.active,this._effectParams[a.GetIndex()]=C3$jscomp$195.EffectList.LoadFxParamsFromJson(b.params);this.UpdateActiveEffects();this._UpdateAllEffectParamBuffers()}};"use strict";
const C3$jscomp$196=self.C3,tempCandidates=[],tileCollRectCandidates=[],tempJumpthruRet=[],tempPolyA=C3$jscomp$196.New(C3$jscomp$196.CollisionPoly),tempPolyB=C3$jscomp$196.New(C3$jscomp$196.CollisionPoly),tempQuad$jscomp$4=C3$jscomp$196.New(C3$jscomp$196.Quad),tempRect$jscomp$8=C3$jscomp$196.New(C3$jscomp$196.Rect),tempRect2$jscomp$1=C3$jscomp$196.New(C3$jscomp$196.Rect);let tempPolyC=null,tempRect3$jscomp$1=null,tempQuadB=null;
C3$jscomp$196.CollisionEngine=class extends C3$jscomp$196.DefendedBase{constructor(a){super();this._runtime=a;this._collisionCellHeight=this._collisionCellWidth=0;this._registeredCollisions=[];this._polyCheckSec=this._polyCheckCount=this._collisionCheckSec=this._collisionCheckCount=0;this._iCollisionEngine=new self.ICollisionEngine(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetICollisionEngine(){return this._iCollisionEngine}_Update1sStats(){this._collisionCheckSec=this._collisionCheckCount;
this._collisionCheckCount=0;this._polyCheckSec=this._polyCheckCount;this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(a,b){const d=a.GetWorldInfo(),c=b.GetWorldInfo();d&&c&&d.IsCollisionEnabled()&&c.IsCollisionEnabled()&&this._registeredCollisions.push([a,b])}AddRegisteredCollisionCandidates(a,b,d){for(const [c,e]of this._registeredCollisions){let g;if(a===c)g=e;else if(a===e)g=c;else continue;g.BelongsToObjectClass(b)&&
(d.includes(g)||d.push(g))}}CheckRegisteredCollision(a,b){if(!this._registeredCollisions.length)return!1;for(const [d,c]of this._registeredCollisions)if(a===d&&b===c||a===c&&b===d)return!0;return!1}ClearRegisteredCollisions(){C3$jscomp$196.clearArray(this._registeredCollisions)}TestOverlap(a,b){if(!a||!b||a===b)return!1;a=a.GetWorldInfo();b=b.GetWorldInfo();if(!a.IsCollisionEnabled()||!b.IsCollisionEnabled())return!1;this._collisionCheckCount++;const d=a.GetLayer(),c=b.GetLayer();return d.IsTransformCompatibleWith(c)?
this._TestOverlap_SameLayers(a,b):this._TestOverlap_DifferentLayers(a,b)}_TestOverlap_SameLayers(a,b){if(!a.GetBoundingBox().intersectsRect(b.GetBoundingBox()))return!1;this._polyCheckCount++;if(!a.GetBoundingQuad().intersectsQuad(b.GetBoundingQuad())||a.HasTilemap()&&b.HasTilemap())return!1;if(a.HasTilemap())return this.TestTilemapOverlap(a,b);if(b.HasTilemap())return this.TestTilemapOverlap(b,a);if(!a.HasOwnCollisionPoly()&&!b.HasOwnCollisionPoly())return!0;const d=a.GetTransformedCollisionPoly(),
c=b.GetTransformedCollisionPoly();return d.intersectsPoly(c,b.GetX()-a.GetX(),b.GetY()-a.GetY())}_TestOverlap_DifferentLayers(a,b){var d=a.HasTilemap(),c=b.HasTilemap();if(d&&!c)return this.TestTilemapOverlapDifferentLayers(a,b);if(c&&!d)return this.TestTilemapOverlapDifferentLayers(b,a);if(c||d)return!1;c=a.GetLayer();d=b.GetLayer();tempPolyA.copy(a.GetTransformedCollisionPoly());tempPolyB.copy(b.GetTransformedCollisionPoly());var e=tempPolyA.pointsArr();for(let g=0,k=e.length;g<k;g+=2){const l=
g+1,n=e[l],[p,r]=c.LayerToCanvasCss(e[g]+a.GetX(),n+a.GetY());e[g]=p;e[l]=r}a=tempPolyB.pointsArr();for(let g=0,k=a.length;g<k;g+=2){c=g+1;e=a[c];const [l,n]=d.LayerToCanvasCss(a[g]+b.GetX(),e+b.GetY());a[g]=l;a[c]=n}tempPolyA.setBboxChanged();tempPolyB.setBboxChanged();this._polyCheckCount++;return tempPolyA.intersectsPoly(tempPolyB,0,0)}TestTilemapOverlapDifferentLayers(a,b){var d=a.GetLayer(),c=b.GetLayer();tempPolyC||(tempPolyC=C3$jscomp$196.New(C3$jscomp$196.CollisionPoly));tempRect3$jscomp$1||
(tempRect3$jscomp$1=C3$jscomp$196.New(C3$jscomp$196.Rect));tempQuadB||(tempQuadB=C3$jscomp$196.New(C3$jscomp$196.Quad));var e=b.GetX(),g=b.GetY();const [k,l]=c.LayerToCanvasCss(e,g),[n,p]=d.CanvasCssToLayer(k,l);d=n-e;g=p-g;tempRect3$jscomp$1.copy(b.GetBoundingBox());tempRect3$jscomp$1.offset(d,g);if(!a.GetBoundingBox().intersectsRect(tempRect3$jscomp$1))return!1;tempQuadB.copy(b.GetBoundingQuad());tempQuadB.offset(d,g);this._polyCheckCount++;if(!a.GetBoundingQuad().intersectsQuad(tempQuadB))return!1;
tempPolyC.copy(b.GetTransformedCollisionPoly());c=tempPolyC.pointsArr();for(let r=0,w=c.length;r<w;r+=2)e=r+1,c[r]+=d,c[e]+=g;tempPolyC.setBboxChanged();return this.TestTilemapOverlap(a,b,n,p,tempPolyC,tempRect3$jscomp$1,tempQuadB)}TestTilemapOverlap(a,b,d,c,e,g,k){g=void 0!==g?g:b.GetBoundingBox();const l=a.GetX(),n=a.GetY();var p=a.GetInstance().GetSdkInstance();d=void 0!==d?d:b.GetX();c=void 0!==c?c:b.GetY();a=b.HasOwnCollisionPoly();k=void 0!==k?k:b.GetBoundingQuad();p.GetCollisionRectCandidates(g,
tileCollRectCandidates);for(let z=0,B=tileCollRectCandidates.length;z<B;++z){var r=tileCollRectCandidates[z];p=r.GetRect();this._collisionCheckCount++;if(g.intersectsRectOffset(p,l,n)&&(tempQuad$jscomp$4.setFromRect(p),tempQuad$jscomp$4.offset(l,n),tempQuad$jscomp$4.intersectsQuad(k)))if(a){var w=void 0!==e?e:b.GetTransformedCollisionPoly();let C=d,E=c;void 0!==e&&(C=b.GetX(),E=b.GetY());if(r=r.GetPoly()){if(this._polyCheckCount++,r.intersectsPoly(w,C-(l+p.getLeft()),E-(n+p.getTop())))return C3$jscomp$196.clearArray(tileCollRectCandidates),
!0}else if(tempPolyA.setFromQuad(tempQuad$jscomp$4,0,0),tempPolyA.intersectsPoly(w,C,E))return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}else if(w=r.GetPoly()){if(tempPolyA.setFromQuad(k,0,0),w.intersectsPoly(tempPolyA,-(l+p.getLeft()),-(n+p.getTop())))return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}else return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}C3$jscomp$196.clearArray(tileCollRectCandidates);return!1}TestAndSelectCanvasPointOverlap(a,b,d){const c=a.GetCurrentSol();
var e=this._runtime.GetCurrentEvent();if(!e)throw Error("cannot call outside event");const g=e.IsOrBlock(),k=new Map,l=p=>{let r=k.get(p);"undefined"===typeof r&&(r=p.IsSelfAndParentsInteractive(),k.set(p,r));return r};if(c.IsSelectAll()){d||(c._SetSelectAll(!1),C3$jscomp$196.clearArray(c._GetOwnInstances()));g&&C3$jscomp$196.clearArray(c._GetOwnElseInstances());for(var n of a.GetInstances()){const p=n.GetWorldInfo(),r=p.GetLayer();e=!1;l(r)&&p.IsInViewport2()&&(e=b.some(([w,z])=>{const [B,C]=r.CanvasCssToLayer(w,
z,p.GetTotalZElevation());return p.ContainsPoint(B,C)}));if(e){if(d)return!1;c._PushInstance(n)}else g&&c._PushElseInstance(n)}}else{n=!1;g&&!e.IsFirstConditionOfType(this._runtime.GetCurrentCondition())?this._runtime.IsCurrentConditionFirst()&&!c._GetOwnElseInstances().length&&c._GetOwnInstances().length?e=c._GetOwnInstances():(e=c._GetOwnElseInstances(),n=!0):e=c._GetOwnInstances();let p=0;for(let r=0,w=e.length;r<w;++r){const z=e[r],B=z.GetWorldInfo(),C=B.GetLayer();let E=!1;l(C)&&B.IsInViewport2()&&
(E=b.some(([F,I])=>{const [K,O]=C.CanvasCssToLayer(F,I,B.GetTotalZElevation());return B.ContainsPoint(K,O)}));if(E){if(d)return!1;n?c._PushInstance(z):e[p++]=z}else n?e[p++]=z:g&&c._PushElseInstance(z)}d||(e.length=p)}a.ApplySolToContainer();k.clear();return d?!0:c.HasAnyInstances()}GetCollisionCandidates(a,b,d,c){a=a?1!==a.GetParallaxX()||1!==a.GetParallaxY():!1;if(b.IsFamily())for(const e of b.GetFamilyMembers())a||e.IsAnyInstanceParallaxed()?C3$jscomp$196.appendArray(c,e.GetInstances()):(e._UpdateAllCollisionCells(),
e._GetCollisionCellGrid().QueryRange(d,c));else a||b.IsAnyInstanceParallaxed()?C3$jscomp$196.appendArray(c,b.GetInstances()):(b._UpdateAllCollisionCells(),b._GetCollisionCellGrid().QueryRange(d,c))}GetObjectClassesCollisionCandidates(a,b,d,c){for(const e of b)this.GetCollisionCandidates(a,e,d,c)}GetSolidCollisionCandidates(a,b,d){const c=this._runtime.GetSolidBehavior();c&&this.GetObjectClassesCollisionCandidates(a,c.GetObjectClasses(),b,d)}GetJumpthruCollisionCandidates(a,b,d){const c=this._runtime.GetJumpthruBehavior();
c&&this.GetObjectClassesCollisionCandidates(a,c.GetObjectClasses(),b,d)}IsSolidCollisionAllowed(a,b){return a._IsSolidEnabled()&&(!b||b.GetWorldInfo().IsSolidCollisionAllowed(a.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(a){const b=a.GetWorldInfo();this.GetSolidCollisionCandidates(b.GetLayer(),b.GetBoundingBox(),tempCandidates);for(const d of tempCandidates)if(this.IsSolidCollisionAllowed(d,a)&&this.TestOverlap(a,d))return C3$jscomp$196.clearArray(tempCandidates),d;C3$jscomp$196.clearArray(tempCandidates);
return null}TestRectOverlapSolid(a,b){this.GetSolidCollisionCandidates(null,a,tempCandidates);for(const d of tempCandidates)if(this.IsSolidCollisionAllowed(d,b)&&this.TestRectOverlap(a,d))return C3$jscomp$196.clearArray(tempCandidates),d;C3$jscomp$196.clearArray(tempCandidates);return null}TestOverlapJumpthru(a,b){let d=null;b&&(d=tempJumpthruRet,C3$jscomp$196.clearArray(d));const c=a.GetWorldInfo();this.GetJumpthruCollisionCandidates(c.GetLayer(),c.GetBoundingBox(),tempCandidates);for(const e of tempCandidates)if(e._IsJumpthruEnabled()&&
this.TestOverlap(a,e))if(b)d.push(e);else return C3$jscomp$196.clearArray(tempCandidates),e;C3$jscomp$196.clearArray(tempCandidates);return d}PushOut(a,b,d,c,e){c=c||50;const g=a.GetWorldInfo(),k=g.GetX(),l=g.GetY();for(let n=0;n<c;++n)if(g.SetXY(k+b*n,l+d*n),g.SetBboxChanged(),!this.TestOverlap(a,e))return!0;g.SetXY(k,l);g.SetBboxChanged();return!1}PushOutSolid(a,b,d,c,e,g){c=c||50;const k=a.GetWorldInfo(),l=k.GetX(),n=k.GetY();let p=null,r=null;for(let w=0;w<c;++w)if(k.SetXY(l+b*w,n+d*w),k.SetBboxChanged(),
!this.TestOverlap(a,p))if(p=this.TestOverlapSolid(a))r=p;else if(e&&(p=g?this.TestOverlap(a,g)?g:null:this.TestOverlapJumpthru(a))&&(r=p),!p)return r&&this.PushInFractional(a,b,d,r,16,!0),!0;k.SetXY(l,n);k.SetBboxChanged();return!1}PushOutSolidAxis(a,b,d,c){c=c||50;const e=a.GetWorldInfo(),g=e.GetX(),k=e.GetY();let l=null,n=null;for(let p=0;p<c;++p)for(let r=0;2>r;++r){const w=2*r-1;e.SetXY(g+b*p*w,k+d*p*w);e.SetBboxChanged();if(!this.TestOverlap(a,l))if(l=this.TestOverlapSolid(a))n=l;else return n&&
this.PushInFractional(a,b*w,d*w,n,16,!0),!0}e.SetXY(g,k);e.SetBboxChanged();return!1}PushInFractional(a,b,d,c,e,g){let k=2,l=!1;var n=!1;const p=a.GetWorldInfo();let r=p.GetX(),w=p.GetY();for(;k<=e;)n=1/k,k*=2,p.OffsetXY(b*n*(l?1:-1),d*n*(l?1:-1)),p.SetBboxChanged(),this.TestOverlap(a,c)||g&&this.TestOverlapSolid(a)?n=l=!0:(n=l=!1,r=p.GetX(),w=p.GetY());n&&(p.SetXY(r,w),p.SetBboxChanged())}PushOutSolidNearest(a,b=100){let d=0;const c=a.GetWorldInfo(),e=c.GetX(),g=c.GetY();let k=0,l=this.TestOverlapSolid(a);
if(!l)return!0;for(;d<=b;){let n=0,p=0;switch(k){case 0:n=0;p=-1;d++;break;case 1:n=1;p=-1;break;case 2:n=1;p=0;break;case 3:p=n=1;break;case 4:n=0;p=1;break;case 5:n=-1;p=1;break;case 6:n=-1;p=0;break;case 7:p=n=-1}k=(k+1)%8;c.SetXY(Math.floor(e+n*d),Math.floor(g+p*d));c.SetBboxChanged();if(!this.TestOverlap(a,l)&&(l=this.TestOverlapSolid(a),!l))return!0}c.SetXY(e,g);c.SetBboxChanged();return!1}CalculateBounceAngle(a,b,d,c){const e=a.GetWorldInfo(),g=e.GetX(),k=e.GetY(),l=Math.max(10,C3$jscomp$196.distanceTo(b,
d,g,k));var n=C3$jscomp$196.angleTo(b,d,g,k),p=c||this.TestOverlapSolid(a);if(!p)return C3$jscomp$196.clampAngle(n+Math.PI);let r=p;var w=0,z=0;const B=C3$jscomp$196.toRadians(5);let C;for(C=1;36>C;++C){const E=n-C*B;e.SetXY(b+Math.cos(E)*l,d+Math.sin(E)*l);e.SetBboxChanged();if(!this.TestOverlap(a,r)&&(r=c?null:this.TestOverlapSolid(a),!r)){w=E;break}}36===C&&(w=C3$jscomp$196.clampAngle(n+Math.PI));r=p;for(C=1;36>C;++C)if(p=n+C*B,e.SetXY(b+Math.cos(p)*l,d+Math.sin(p)*l),e.SetBboxChanged(),!this.TestOverlap(a,
r)&&(r=c?null:this.TestOverlapSolid(a),!r)){z=p;break}36===C&&(z=C3$jscomp$196.clampAngle(n+Math.PI));e.SetXY(g,k);e.SetBboxChanged();if(z===w)return z;a=C3$jscomp$196.angleDiff(z,w)/2;a=C3$jscomp$196.angleClockwise(z,w)?C3$jscomp$196.clampAngle(w+a+Math.PI):C3$jscomp$196.clampAngle(z+a);w=Math.cos(n);n=Math.sin(n);z=Math.cos(a);a=Math.sin(a);b=w*z+n*a;return C3$jscomp$196.angleTo(0,0,w-2*b*z,n-2*b*a)}TestSegmentOverlap(a,b,d,c,e){if(!e)return!1;const g=e.GetWorldInfo();if(!g.IsCollisionEnabled())return!1;
this._collisionCheckCount++;tempRect$jscomp$8.set(Math.min(a,d),Math.min(b,c),Math.max(a,d),Math.max(b,c));if(!g.GetBoundingBox().intersectsRect(tempRect$jscomp$8))return!1;if(e.HasTilemap())return this._TestSegmentOverlapTilemap(a,b,d,c,e,g);this._polyCheckCount++;return g.GetBoundingQuad().intersectsSegment(a,b,d,c)?g.HasOwnCollisionPoly()?g.GetTransformedCollisionPoly().intersectsSegment(g.GetX(),g.GetY(),a,b,d,c):!0:!1}_TestSegmentOverlapTilemap(a,b,d,c,e,g){const k=g.GetX();g=g.GetY();e=e.GetSdkInstance();
tempRect2$jscomp$1.set(a,b,d,c);tempRect2$jscomp$1.normalize();e.GetCollisionRectCandidates(tempRect2$jscomp$1,tileCollRectCandidates);for(let n=0,p=tileCollRectCandidates.length;n<p;++n){var l=tileCollRectCandidates[n];e=l.GetRect();this._collisionCheckCount++;if(tempRect$jscomp$8.intersectsRectOffset(e,k,g)&&(tempQuad$jscomp$4.setFromRect(e),tempQuad$jscomp$4.offset(k,g),tempQuad$jscomp$4.intersectsSegment(a,b,d,c)))if(l=l.GetPoly()){if(this._polyCheckCount++,l.intersectsSegment(k+e.getLeft(),g+
e.getTop(),a,b,d,c))return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}else return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}C3$jscomp$196.clearArray(tileCollRectCandidates);return!1}TestRectOverlap(a,b){if(!b)return!1;const d=b.GetWorldInfo();if(!d.IsCollisionEnabled())return!1;this._collisionCheckCount++;if(!d.GetBoundingBox().intersectsRect(a))return!1;if(b.HasTilemap())return this._TestRectOverlapTilemap(a,b,d);this._polyCheckCount++;tempQuad$jscomp$4.setFromRect(a);if(!d.GetBoundingQuad().intersectsQuad(tempQuad$jscomp$4))return!1;
if(!d.HasOwnCollisionPoly())return!0;tempPolyA.setFromRect(a,d.GetX(),d.GetY());a=d.GetTransformedCollisionPoly();return tempPolyA.intersectsPoly(a,0,0)}_TestRectOverlapTilemap(a,b,d){const c=d.GetX();d=d.GetY();b.GetSdkInstance().GetCollisionRectCandidates(a,tileCollRectCandidates);for(let g=0,k=tileCollRectCandidates.length;g<k;++g){var e=tileCollRectCandidates[g];b=e.GetRect();this._collisionCheckCount++;if(a.intersectsRectOffset(b,c,d))if(e=e.GetPoly()){if(this._polyCheckCount++,tempPolyA.setFromRect(a,
0,0),e.intersectsPoly(tempPolyA,-(c+b.getLeft()),-(d+b.getTop())))return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}else return C3$jscomp$196.clearArray(tileCollRectCandidates),!0}C3$jscomp$196.clearArray(tileCollRectCandidates);return!1}TestRayIntersectsInstance(a,b){if(a){var d=a.GetWorldInfo();d.IsCollisionEnabled()&&(this._collisionCheckCount++,d.GetBoundingBox().intersectsRect(b.rect)&&(a.HasTilemap()?this._TestRayIntersectsTilemap(a,d,b):(this._polyCheckCount++,d.HasOwnCollisionPoly()?
b.TestInstancePoly(a,d.GetX(),d.GetY(),d.GetTransformedCollisionPoly()):b.TestInstanceQuad(a,d.GetBoundingQuad()))))}}_TestRayIntersectsTilemap(a,b,d){const c=b.GetX(),e=b.GetY();a.GetSdkInstance().GetCollisionRectCandidates(d.rect,tileCollRectCandidates);for(let k=0,l=tileCollRectCandidates.length;k<l;k++){var g=tileCollRectCandidates[k];const n=g.GetRect();this._collisionCheckCount++;d.rect.intersectsRectOffset(n,c,e)&&(g=g.GetPoly(),this._polyCheckCount++,g?d.TestInstancePoly(a,c+n.getLeft(),e+
n.getTop(),g):d.TestInstanceRect(a,b.GetX(),b.GetY(),n))}C3$jscomp$196.clearArray(tileCollRectCandidates)}SetCollisionCellSize(a,b){if(a!==this._collisionCellWidth||b!==this._collisionCellHeight){this._collisionCellWidth=a;this._collisionCellHeight=b;var d=this._runtime.GetAllObjectClasses();for(const c of d)if(c.IsWorldType()){for(const e of c.instancesIncludingPendingCreate())e.GetWorldInfo()._RemoveFromCollisionCells();c._GetCollisionCellGrid().SetCellSize(a,b);c._SetAnyCollisionCellChanged();
for(const e of c.instancesIncludingPendingCreate())d=e.GetWorldInfo(),d._SetCollisionCellChanged(),d._UpdateCollisionCell()}}}GetCollisionCellSize(){return[this._collisionCellWidth,this._collisionCellHeight]}_InitCollisionCellSize(a,b){this._collisionCellWidth=a;this._collisionCellHeight=b}};"use strict";const C3$jscomp$197=self.C3;
C3$jscomp$197.SparseGrid=class extends C3$jscomp$197.DefendedBase{constructor(a,b){super();this._cellWidth=a;this._cellHeight=b;this._cells=C3$jscomp$197.New(C3$jscomp$197.PairMap)}Release(){this._cells.Release();this._cells=null}SetCellSize(a,b){if(!this._cells.IsEmpty())throw Error("grid not empty");this._cellWidth=a;this._cellHeight=b}GetCell(a,b,d){let c=this._cells.Get(a,b);return c?c:d?(c=C3$jscomp$197.New(C3$jscomp$197.GridCell,this,a,b),this._cells.Set(a,b,c),c):null}XToCell(a){a=Math.floor(a/
this._cellWidth);return isFinite(a)?a:0}YToCell(a){a=Math.floor(a/this._cellHeight);return isFinite(a)?a:0}Update(a,b,d){if(b)for(let c=b.getLeft(),e=b.getRight();c<=e;++c)for(let g=b.getTop(),k=b.getBottom();g<=k;++g){if(d&&d.containsPoint(c,g))continue;const l=this.GetCell(c,g,!1);l&&(l.Remove(a),l.IsEmpty()&&this._cells.Delete(c,g))}if(d)for(let c=d.getLeft(),e=d.getRight();c<=e;++c)for(let g=d.getTop(),k=d.getBottom();g<=k;++g)b&&b.containsPoint(c,g)||this.GetCell(c,g,!0).Insert(a)}QueryRange(a,
b){let d=this.XToCell(a.getLeft());const c=this.YToCell(a.getTop()),e=this.XToCell(a.getRight());a=this.YToCell(a.getBottom());if(isFinite(e)&&isFinite(a))for(;d<=e;++d)for(let g=c;g<=a;++g){const k=this.GetCell(d,g,!1);k&&k.Dump(b)}}};"use strict";const C3$jscomp$198=self.C3;
C3$jscomp$198.GridCell=class extends C3$jscomp$198.DefendedBase{constructor(a,b,d){super();this._grid=a;this._x=b;this._y=d;this._instances=C3$jscomp$198.New(C3$jscomp$198.ArraySet)}Release(){this._instances.Release();this._grid=this._instances=null}IsEmpty(){return this._instances.IsEmpty()}Insert(a){this._instances.Add(a)}Remove(a){this._instances.Delete(a)}Dump(a){C3$jscomp$198.appendArray(a,this._instances.GetArray())}};"use strict";const C3$jscomp$199=self.C3;
C3$jscomp$199.Ray=class{constructor(){this.dy=this.dx=this.y2=this.x2=this.y1=this.x1=0;this.rect=new C3$jscomp$199.Rect;this.hitFraction=2;this.hitUid=null;this.distance=this.hitY=this.hitX=this.hitNormalDy=this.hitNormalDx=this.hitNormal=0;this.normalX=1;this.normalY=0;this.reflectionX=1;this.reflectionY=0}DidCollide(){return 1.000001>this.hitFraction}Reset(){this.hitFraction=2}Set(a,b,d,c){this.x1=a;this.y1=b;this.x2=d;this.y2=c;this.dx=d-a;this.dy=c-b;this.rect.set(a,b,d,c);this.rect.normalize();
this.hitFraction=2;this.hitUid=null;this.distance=this.hitY=this.hitX=this.hitNormalDy=this.hitNormalDx=this.hitNormal=0;this.normalX=1;this.normalY=0;this.reflectionX=1;this.reflectionY=0;return this}Complete(){if(!1!==this.DidCollide()){var a=this.dx*this.hitFraction,b=this.dy*this.hitFraction,d=Math.hypot(a,b);a/=d;b/=d;this.distance=d-1E-6;this.hitX=this.x1+a*this.distance;this.hitY=this.y1+b*this.distance;this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2;this.normalX=Math.cos(this.hitNormal);
this.normalY=Math.sin(this.hitNormal);d=a*this.normalX+b*this.normalY;this.reflectionX=a-2*this.normalX*d;this.reflectionY=b-2*this.normalY*d;0<d&&(this.hitNormal=C3$jscomp$199.clampAngle(this.hitNormal+Math.PI),this.normalX=-this.normalX,this.normalY=-this.normalY)}}TestInstanceSegment(a,b,d,c,e){const g=C3$jscomp$199.rayIntersect(this.x1,this.y1,this.x2,this.y2,b,d,c,e);0<=g&&g<this.hitFraction&&(this.hitFraction=g,this.hitUid=a.GetUID(),this.hitNormalDx=b-c,this.hitNormalDy=d-e)}TestInstanceRect(a,
b,d,c){const e=b+c.getLeft();b+=c.getRight();const g=d+c.getTop();d+=c.getBottom();this.TestInstanceSegment(a,e,g,b,g);this.TestInstanceSegment(a,b,g,b,d);this.TestInstanceSegment(a,b,d,e,d);this.TestInstanceSegment(a,e,d,e,g)}TestInstanceQuad(a,b){const d=b.getTlx(),c=b.getTly(),e=b.getTrx(),g=b.getTry(),k=b.getBrx(),l=b.getBry(),n=b.getBlx();b=b.getBly();this.TestInstanceSegment(a,d,c,e,g);this.TestInstanceSegment(a,e,g,k,l);this.TestInstanceSegment(a,k,l,n,b);this.TestInstanceSegment(a,n,b,d,c)}TestInstancePoly(a,
b,d,c){c=c.pointsArr();for(let e=0,g=c.length;e<g;e+=2){const k=(e+2)%g;this.TestInstanceSegment(a,c[e]+b,c[e+1]+d,c[k]+b,c[k+1]+d)}}};"use strict";
const C3$jscomp$200=self.C3,VALID_FULLSCREEN_MODES=new Set("off crop scale-inner scale-outer letterbox-scale letterbox-integer-scale".split(" ")),VALID_FULLSCREEN_SCALING_QUALITIES=new Set(["high","low"]),glMatrix$jscomp$11=self.glMatrix,mat4$jscomp$10=glMatrix$jscomp$11.mat4,tempProjection=mat4$jscomp$10.create(),tempQuad$jscomp$5=C3$jscomp$200.New(C3$jscomp$200.Quad),tempRect$jscomp$9=C3$jscomp$200.New(C3$jscomp$200.Rect);
C3$jscomp$200.CanvasManager=class extends C3$jscomp$200.DefendedBase{constructor(a){super();this._runtime=a;this._canvasLayers=[];this._isWebGPUEnabled=!1;this._iRenderer=this._webgpuRenderer=this._webglRenderer=null;this._gpuPreference="high-performance";this._isLimitedToWebGL1=!1;this._windowInnerHeight=this._windowInnerWidth=0;this._cssDisplayMode="";this._canvasCssOffsetY=this._canvasCssOffsetX=this._canvasDeviceHeight=this._canvasDeviceWidth=this._canvasCssHeight=this._canvasCssWidth=0;this._zAxisScale=
"normalized";this._initFieldOfView=0;this._zNear=1;this._zFar=1E4;this._enableMipmaps=!0;this._drawHeight=this._drawWidth=this._textureAnisotropy=0;this._documentFullscreenMode=this._fullscreenMode="letterbox-scale";this._deviceTransformOffY=this._deviceTransformOffX=0;this._defaultProjectionMatrix=mat4$jscomp$10.create();this._fullscreenScalingQuality=this._wantFullscreenScalingQuality="high";this._isDocumentFullscreen=!1;this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets=
new Set;this._shaderData=self.C3_Shaders;this._effectChainManager=C3$jscomp$200.New(C3$jscomp$200.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:b=>this.ReleaseEffectCompositorRenderTarget(b),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()});this._gpuTimeEndFrame=this._gpuTimeStartFrame=0;this._gpuLastUtilisation=NaN;this._gpuFrameTimingsBuffer=
null;this._layersGpuProfile=new Map;this._gpuCurUtilisation=NaN;this._webgpuFrameTimings=new Map;this._snapshotFormat="";this._snapshotQuality=1;this._snapshotArea=C3$jscomp$200.New(C3$jscomp$200.Rect);this._snapshotUrl="";this._snapshotResolve=this._snapshotPromise=null;this._loaderStartTime=this._isPastingToDrawingCanvas=0;this._rafId=-1;this._loadingProgress=0;this._loadingprogress_handler=b=>this._loadingProgress=b.progress;this._percentText=null;this._splashTextures={logo:null,powered:null,website:null};
this._splashFadeOutStartTime=this._splashFadeInFinishTime=this._splashFrameNumber=0;this._splashState="fade-in";this._splashDoneResolve=null;this._splashDonePromise=new Promise(b=>this._splashDoneResolve=b)}_SetGPUPowerPreference(a){this._gpuPreference=a}_SetWebGPUEnabled(a){this._isWebGPUEnabled=!!a}_SetZAxisScale(a){this._zAxisScale=a}GetZAxisScale(){return this._zAxisScale}_SetInitFieldOfView(a){this._initFieldOfView=a}_SetZDistances(a,b){this._zNear=a;this._zFar=b}_SetLimitedToWebGL1(a){this._isLimitedToWebGL1=
!!a}async CreateCanvas(a){var b=a.canvas;this._canvasLayers.push({canvas:b,ctx:null});this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",c=>this._OnWindowResize(c));this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",c=>this._OnFullscreenChange(c));this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",c=>this._OnFullscreenError(c));b.addEventListener("webglcontextlost",c=>this._OnWebGLContextLost(c));b.addEventListener("webglcontextrestored",
c=>this._OnWebGLContextRestored(c));this._isDocumentFullscreen=!!a.isFullscreen;this._cssDisplayMode=a.cssDisplayMode;var d=navigator.gpu&&this._isWebGPUEnabled;b=!1;if(d)try{await this._InitWebGPUContext(!0)}catch(c){this._MaybeLogRendererError("WebGPU",c),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!0)}catch(c){this._MaybeLogRendererError("WebGL",c),this._webglRenderer=null}this.GetRenderer()||(b=!0);if(!this.GetRenderer()&&d)try{await this._InitWebGPUContext(!1)}catch(c){this._MaybeLogRendererError("WebGPU",
c),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!1)}catch(c){this._MaybeLogRendererError("WebGL",c),this._webglRenderer=null}d=this.GetRenderer();if(!d)throw Error("failed to acquire a renderer - check WebGL or WebGPU is supported");d.SetHasMajorPerformanceCaveat(b);this._webgpuRenderer&&(this._webgpuRenderer.ondevicelost=()=>this._OnWebGPUDeviceLost(),this._webgpuRenderer.ondevicerestored=()=>this._OnWebGPUDeviceRestored());"normalized"===this._zAxisScale?d.SetZAxisScaleNormalized():
(d.SetZAxisScaleRegular(),d.SetFovY(this._initFieldOfView));this.SetSize(a.windowInnerWidth,a.windowInnerHeight,!0);await this._InitRenderer()}_MaybeLogRendererError(a,b){b&&"string"===typeof b.message&&b.message.startsWith("renderer-unavailable")||console.error(`Error creating ${a} renderer: `,b)}async _InitWebGPUContext(a){const b={nearZ:this._zNear,farZ:this._zFar};a={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:a,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),
canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),canSampleDepth:this._runtime.UsesAnyDepthSampling()};this._webgpuRenderer=C3$jscomp$200.New(C3$jscomp$200.Gfx.WebGPURenderer,b);await this._webgpuRenderer.Create(this._canvasLayers[0].canvas,a)}async _InitWebGLContext(a){a={alpha:!0,powerPreference:this._gpuPreference,enableGpuProfiling:"xbox-uwp-webview2"!==this._runtime.GetExportType(),depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:a,
nearZ:this._zNear,farZ:this._zFar};this._isLimitedToWebGL1&&(a.maxWebGLVersion=1);this._webglRenderer=C3$jscomp$200.New(C3$jscomp$200.Gfx.WebGLRenderer,this._canvasLayers[0].canvas,a);await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){const a=[];for(const [b,d]of Object.entries(this._shaderData)){d.src=d.wgsl;const c=C3$jscomp$200.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();a.push(this._webgpuRenderer.CreateShaderProgram(Object.assign({vertexSrc:c,name:b},d)))}await Promise.all(a)}}async _InitWebGL(){if(this._shaderData){const a=
[];for(const [b,d]of Object.entries(this._shaderData)){let c;if(d.glslWebGL2&&2<=this._webglRenderer.GetWebGLVersionNumber())d.src=d.glslWebGL2,c=C3$jscomp$200.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();else{if(!d.glsl)throw Error(`shader '${b}' does not support WebGL 1`);d.src=d.glsl;c=C3$jscomp$200.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource()}a.push(this._webglRenderer.CreateShaderProgram(Object.assign({vertexSrc:c,name:b},d)))}await Promise.all(a);this._webglRenderer.ResetLastProgram();
this._webglRenderer.SetTextureFillMode()}this._webglRenderer.SupportsGPUProfiling()&&(this._gpuFrameTimingsBuffer=C3$jscomp$200.New(C3$jscomp$200.Gfx.WebGLQueryResultBuffer,this._webglRenderer))}async _InitRenderer(){this._webgpuRenderer?await this._InitWebGPU():this._webglRenderer&&await this._InitWebGL();const a=this.GetRenderer();a.SetMipmapsEnabled(this._enableMipmaps);a.SupportsGPUProfiling()&&(this._gpuLastUtilisation=0);for(const b of this._runtime._GetAllEffectLists()){for(const d of b.GetAllEffectTypes())d._InitRenderer(a);
b._InitRenderer(a);b.UpdateActiveEffects()}this._iRenderer=new self.IRenderer(this._runtime,a)}Release(){this._webglRenderer=this._runtime=null;this._canvasLayers.length=0}IsInWorker(){return this._runtime.IsInWorker()}_OnWindowResize(a){const b=this._runtime;if(!b.IsExportToVideo()){var d=a.devicePixelRatio;this.IsInWorker()&&(self.devicePixelRatio=d);b._SetDevicePixelRatio(d);this._isDocumentFullscreen=!!a.isFullscreen;this._cssDisplayMode=a.cssDisplayMode;this.SetSize(a.innerWidth,a.innerHeight);
b.UpdateRender();d=new C3$jscomp$200.Event("window-resize");d.data=a;b.Dispatcher().dispatchEventAndWaitAsyncSequential(d);a=new C3$jscomp$200.Event("resize");a.cssWidth=this.GetCssWidth();a.cssHeight=this.GetCssHeight();a.deviceWidth=this.GetDeviceWidth();a.deviceHeight=this.GetDeviceHeight();b.DispatchUserScriptEvent(a);b.IsDebug()&&(b.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused())&&b.Render()}}_OnFullscreenChange(a){this._isDocumentFullscreen=!!a.isFullscreen;this.SetSize(a.innerWidth,a.innerHeight,
!0);this._runtime.UpdateRender()}_OnFullscreenError(a){this._isDocumentFullscreen=!!a.isFullscreen;this.SetSize(a.innerWidth,a.innerHeight,!0);this._runtime.UpdateRender()}SetSize(a,b,d=!1){a=Math.floor(a);b=Math.floor(b);if(0>=a||0>=b)throw Error("invalid size");if(this._windowInnerWidth!==a||this._windowInnerHeight!==b||d){this._windowInnerWidth=a;this._windowInnerHeight=b;d=this.GetCurrentFullscreenMode();"letterbox-scale"===d?this._CalculateLetterboxScale(a,b):"letterbox-integer-scale"===d?this._CalculateLetterboxIntegerScale(a,
b):"off"===d?this._CalculateFixedSizeCanvas(a,b):this._CalculateFullsizeCanvas(a,b);this._UpdateFullscreenScalingQuality(d);for(const {canvas:e}of this._canvasLayers)e.width=this._canvasDeviceWidth,e.height=this._canvasDeviceHeight;this._runtime.PostComponentMessageToDOM("canvas","update-size",{marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight,displayScale:this.GetDisplayScale()});a=this.GetRenderer();a.SetSize(this._canvasDeviceWidth,
this._canvasDeviceHeight,!0);for(var c of this._availableAdditionalRenderTargets)a.DeleteRenderTarget(c);C3$jscomp$200.clearArray(this._availableAdditionalRenderTargets);this.UpdateDefaultProjectionMatrix();c=this._runtime.GetLayoutManager();c.SetAllLayerProjectionChanged();c.SetAllLayerMVChanged()}}UpdateDefaultProjectionMatrix(){this.GetRenderer().CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight())}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(a,
b){const d=this._runtime.GetDevicePixelRatio(),c=this._runtime.GetOriginalViewportWidth(),e=this._runtime.GetOriginalViewportHeight(),g=c/e;a/b>g?(this._canvasCssWidth=Math.round(b*g),this._canvasCssHeight=b,this._canvasCssOffsetX=Math.floor((a-this._canvasCssWidth)/2),this._canvasCssOffsetY=0):(this._canvasCssWidth=a,this._canvasCssHeight=Math.round(a/g),this._canvasCssOffsetX=0,this._canvasCssOffsetY=Math.floor((b-this._canvasCssHeight)/2));this._canvasDeviceWidth=Math.round(this._canvasCssWidth*
d);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*d);this._runtime.SetViewportSize(c,e)}_CalculateLetterboxIntegerScale(a,b){const d=this._runtime.GetDevicePixelRatio();1!==d&&(a+=1,b+=1);const c=this._runtime.GetOriginalViewportWidth(),e=this._runtime.GetOriginalViewportHeight();var g=c/e;g=a/b>g?b*g*d/c:a/g*d/e;1<g?g=Math.floor(g):1>g&&(g=1/Math.ceil(1/g));this._canvasDeviceWidth=Math.round(c*g);this._canvasDeviceHeight=Math.round(e*g);this._canvasCssWidth=this._canvasDeviceWidth/d;this._canvasCssHeight=
this._canvasDeviceHeight/d;this._canvasCssOffsetX=Math.max(Math.floor((a-this._canvasCssWidth)/2),0);this._canvasCssOffsetY=Math.max(Math.floor((b-this._canvasCssHeight)/2),0);this._runtime.SetViewportSize(c,e)}_CalculateFullsizeCanvas(a,b){const d=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=a;this._canvasCssHeight=b;this._canvasDeviceWidth=Math.round(this._canvasCssWidth*d);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*d);this._canvasCssOffsetY=this._canvasCssOffsetX=0;a=
this.GetDisplayScale();this._runtime.SetViewportSize(this._canvasCssWidth/a,this._canvasCssHeight/a)}_CalculateFixedSizeCanvas(a,b){const d=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth();this._canvasCssHeight=this._runtime.GetViewportHeight();this._canvasDeviceWidth=Math.round(this._canvasCssWidth*d);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*d);this.IsDocumentFullscreen()?(this._canvasCssOffsetX=Math.floor((a-this._canvasCssWidth)/2),this._canvasCssOffsetY=
Math.floor((b-this._canvasCssHeight)/2)):this._canvasCssOffsetY=this._canvasCssOffsetX=0;this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(a){if("high"===this._wantFullscreenScalingQuality)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else{let d;if("off"===this.GetCurrentFullscreenMode()){var b=this._runtime.GetViewportWidth();d=this._runtime.GetViewportHeight()}else b=
this._runtime.GetOriginalViewportWidth(),d=this._runtime.GetOriginalViewportHeight();this._canvasDeviceWidth<b||this._canvasDeviceHeight<d?(this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high"):(this._drawWidth=b,this._drawHeight=d,this._fullscreenScalingQuality="low","scale-inner"===a?(a=b/d,b=this._windowInnerWidth/this._windowInnerHeight,b<a?this._drawWidth=this._drawHeight*b:b>a&&(this._drawHeight=this._drawWidth/b)):"scale-outer"===
a&&(a=b/d,b=this._windowInnerWidth/this._windowInnerHeight,b>a?this._drawWidth=this._drawHeight*b:b<a&&(this._drawHeight=this._drawWidth/b)))}}GetRuntime(){return this._runtime}GetMainCanvas(){return this._canvasLayers[0].canvas}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}GetCssDisplayMode(){return this._cssDisplayMode}SetFullscreenMode(a){if(!VALID_FULLSCREEN_MODES.has(a))throw Error("invalid fullscreen mode");this._fullscreenMode=
a;a=this._runtime.GetLayoutManager();a.SetAllLayerProjectionChanged();a.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(a){if(!VALID_FULLSCREEN_MODES.has(a))throw Error("invalid fullscreen mode");this._documentFullscreenMode=a;a=this._runtime.GetLayoutManager();a.SetAllLayerProjectionChanged();a.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){return this.IsDocumentFullscreen()?this.GetDocumentFullscreenMode():
this.GetFullscreenMode()}SetFullscreenScalingQuality(a){if(!VALID_FULLSCREEN_SCALING_QUALITIES.has(a))throw Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=a;this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(a){switch(a){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";
case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw Error("invalid fullscreen mode");}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(a){this._enableMipmaps=!!a}_SetTextureAnisotropy(a){this._textureAnisotropy=a}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(a){console.log("[Construct] WebGL context lost");
a.preventDefault();this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets.clear();this._effectChainManager.OnContextLost();this._webglRenderer.OnContextLost();this._runtime._OnRendererContextLost()}_OnWebGPUDeviceLost(){console.log("[Construct] WebGPU device lost");this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets.clear();this._effectChainManager.OnContextLost();this._runtime._OnRendererContextLost()}async _OnWebGLContextRestored(a){await this._webglRenderer.OnContextRestored();
await this._InitRenderer();await this._runtime._OnRendererContextRestored();console.log("[Construct] WebGL context restored")}async _OnWebGPUDeviceRestored(){await this._InitRenderer();await this._runtime._OnRendererContextRestored();console.log("[Construct] WebGPU device restored")}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetIRenderer(){return this._iRenderer}GetRenderScale(){return"low"===
this._fullscreenScalingQuality?1/this._runtime.GetDevicePixelRatio():this.GetDisplayScale()}GetDisplayScale(){const a=this.GetCurrentFullscreenMode();if("off"===a||"crop"===a)return 1;const b=this._runtime.GetOriginalViewportWidth(),d=this._runtime.GetOriginalViewportHeight(),c=b/d,e=this._canvasDeviceWidth/this._canvasDeviceHeight;return"scale-inner"!==a&&e>c||"scale-inner"===a&&e<c?this._canvasCssHeight/d:this._canvasCssWidth/b}GetEffectLayerScaleParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?
1:this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(a,b){this._deviceTransformOffX=a;this._deviceTransformOffY=b}SetDeviceTransform(a,b,d,c=!0){b=b||this._drawWidth;d=d||this._drawHeight;const e=b/2+this._deviceTransformOffX,g=d/2+this._deviceTransformOffY;if(c){c=this.GetDefaultProjectionMatrix();if(b!==this._drawWidth||d!==this._drawHeight)a.CalculatePerspectiveMatrix(tempProjection,
b/d),c=tempProjection;a.SetProjectionMatrix(c)}b=a.CalculateLookAtModelView2(e,g,a.GetDefaultCameraZ(d),e,g,0,d);a.SetModelViewMatrix(b)}SetCssTransform(a,b=!0){var d=this.GetCssWidth();const c=this.GetCssHeight();d/=2;const e=c/2;b&&a.SetProjectionMatrix(this.GetDefaultProjectionMatrix());b=a.CalculateLookAtModelView2(d,e,a.GetDefaultCameraZ(c),d,e,0,c);a.SetModelViewMatrix(b)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetHTMLLayerCount(){return this._canvasLayers.length}_CanUseImageBitmapRenderingContext(){return"undefined"!==
typeof OffscreenCanvas&&this.GetMainCanvas()instanceof OffscreenCanvas&&("Chromium"!==C3$jscomp$200.Platform.BrowserEngine||124<=C3$jscomp$200.Platform.BrowserVersionNumber)}async SetHTMLLayerCount(a,b=!1){if(1>a)throw Error("invalid HTML layer count");if(this._canvasLayers.length!==a){b={count:a,immediate:b,marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight};b=this.IsInWorker()?await this._runtime.PostComponentMessageToDOMAsync("canvas",
"set-html-layer-count",b):self.c3_runtimeInterface._OnSetHTMLLayerCount(b);if(a<this._canvasLayers.length)this._canvasLayers.length=a;else for(const d of b.addedCanvases){d.width=this._canvasDeviceWidth;d.height=this._canvasDeviceHeight;a=this._CanUseImageBitmapRenderingContext()?"bitmaprenderer":"2d";b=d.getContext(a);if(!b)throw Error(`failed to acquire '${a}' canvas context`);this._canvasLayers.push({canvas:d,ctx:b})}this._runtime.UpdateRender()}}BlitMainCanvasToHTMLLayerCanvas(a){if(!(a>=this._canvasLayers.length)){var b=
this.GetMainCanvas();a=this._canvasLayers[a].ctx;this._CanUseImageBitmapRenderingContext()?a.transferFromImageBitmap(b.transferToImageBitmap()):(a.globalCompositeOperation="copy",a.drawImage(b,0,0))}}GetAdditionalRenderTarget(a){a.depth=this._runtime.Uses3DFeatures();const b=this._availableAdditionalRenderTargets,d=b.findIndex(e=>e.IsCompatibleWithOptions(a));let c;-1!==d?(c=b[d],b.splice(d,1)):c=this.GetRenderer().CreateRenderTarget(a);this._usedAdditionalRenderTargets.add(c);return c}ReleaseAdditionalRenderTarget(a){if(!this._usedAdditionalRenderTargets.has(a))throw Error("render target not in use");
this._usedAdditionalRenderTargets.delete(a);this._availableAdditionalRenderTargets.push(a)}GetEffectCompositorRenderTarget(){const a={sampling:this._runtime.GetSampling()};"low"===this.GetCurrentFullscreenScalingQuality()&&(a.width=this.GetDrawWidth(),a.height=this.GetDrawHeight());return this.GetAdditionalRenderTarget(a)}ReleaseEffectCompositorRenderTarget(a){this.ReleaseAdditionalRenderTarget(a)}*activeLayersGpuProfiles(){for(const a of this._runtime.GetLayoutManager().runningLayouts())for(const b of a.GetLayers()){const d=
this._layersGpuProfile.get(b);d&&(yield d)}}GetLayerTimingsBuffer(a){if(!this.GetRenderer().SupportsGPUProfiling())return null;let b=this._layersGpuProfile.get(a);b||(b={layer:a,name:a.GetName(),timingsBuffer:C3$jscomp$200.New(C3$jscomp$200.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastTotalUtilisation:0,lastSelfUtilisation:0},this._layersGpuProfile.set(a,b));return b.timingsBuffer}_Update1sFrameRange(){const a=this.GetRenderer();if(a.SupportsGPUProfiling()&&0===this._gpuTimeEndFrame){this._gpuTimeEndFrame=
a.GetFrameNumber();this._gpuCurUtilisation=NaN;for(const b of this.activeLayersGpuProfiles())b.curUtilisation=NaN}}_UpdateTick(){this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGL();this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(isNaN(this._gpuCurUtilisation)&&(this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),!isNaN(this._gpuCurUtilisation))){if(this._runtime.IsDebug())for(var a of this.activeLayersGpuProfiles())if(a.curUtilisation=
a.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),isNaN(a.curUtilisation))return;this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame);this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1);if(this._runtime.IsDebug()){const d=new Map;for(const c of this.activeLayersGpuProfiles())c.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),c.lastTotalUtilisation=Math.min(c.curUtilisation,1),d.set(c.layer,c.lastTotalUtilisation);
for(var b of this.activeLayersGpuProfiles())a=b.layer,a=(d.get(a)||0)-a.GetSubLayers().reduce((c,e)=>c+(d.get(e)||0),0),b.lastSelfUtilisation=C3$jscomp$200.clamp(a,0,1);b=this._runtime.GetMainRunningLayout();b=this._gpuLastUtilisation-b._GetRootLayers().reduce((c,e)=>c+(d.get(e)||0),0);self.C3Debugger.UpdateGPUProfile(C3$jscomp$200.clamp(b,0,1),this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame;this._gpuTimeEndFrame=0}}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(0!==
this._gpuTimeEndFrame){for(var a=this._gpuTimeStartFrame;a<this._gpuTimeEndFrame;++a){var b=this._webgpuFrameTimings.get(a);if(b&&!b.HasResult())return}a=this._runtime.GetMainRunningLayout();b=C3$jscomp$200.MakeFilledArray(a.GetLayerCount()+1,0);var d=0;for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){var c=this._webgpuFrameTimings.get(e);if(!c)continue;c=c.GetResult();let g=BigInt(0),k=BigInt(0);const l=BigInt(0);for(let n=0,p=Math.min(b.length,c.length/2);n<p;++n){const r=c[2*n],w=
c[2*n+1];r!==l&&(g===l||r<g)&&(g=r);w>k&&(k=w);b[n]+=Number(w-r)/1E9}d+=Number(k-g)/1E9}this._gpuLastUtilisation=C3$jscomp$200.clamp(d,0,1);if(this._runtime.IsDebug()){d=a.GetLayers();const e=new Map;for(let k=0,l=Math.min(d.length,b.length-1);k<l;++k)e.set(d[k],b[k+1]);b=[];const g=new Map;for(const [k,l]of e)d=[...k.selfAndAllSubLayers()].reduce((n,p)=>n+(e.get(p)||0),0),g.set(k,d),b.push({name:k.GetName(),lastSelfUtilisation:C3$jscomp$200.clamp(l,0,1),lastTotalUtilisation:C3$jscomp$200.clamp(d,
0,1)});a=this._gpuLastUtilisation-a._GetRootLayers().reduce((k,l)=>k+(g.get(l)||0),0);self.C3Debugger.UpdateGPUProfile(C3$jscomp$200.clamp(a,0,1),this._gpuLastUtilisation,b)}for(a=this._gpuTimeStartFrame;a<this._gpuTimeEndFrame;++a)this._webgpuFrameTimings.delete(a);this._gpuTimeStartFrame=this._gpuTimeEndFrame;this._gpuTimeEndFrame=0}}_AddWebGPUFrameTiming(a){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),a)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(a,
b,d,c,e,g){this._snapshotFormat=a;this._snapshotQuality=b;this._snapshotArea.setWH(d,c,e,g);return this._snapshotPromise?this._snapshotPromise:this._snapshotPromise=new Promise(k=>{this._snapshotResolve=k})}_MaybeTakeSnapshot(){if(this._snapshotFormat){var a=this.GetMainCanvas(),b=this._snapshotArea,d=C3$jscomp$200.clamp(Math.floor(b.getLeft()),0,a.width),c=C3$jscomp$200.clamp(Math.floor(b.getTop()),0,a.height),e=b.width();e=0===e?a.width-d:C3$jscomp$200.clamp(Math.floor(e),0,a.width-d);b=b.height();
b=0===b?a.height-c:C3$jscomp$200.clamp(Math.floor(b),0,a.height-c);if((0!==d||0!==c||e!==a.width||b!==a.height)&&0<e&&0<b){const g=C3$jscomp$200.CreateCanvas(e,b);g.getContext("2d").drawImage(a,d,c,e,b,0,0,e,b);a=g}C3$jscomp$200.CanvasToBlob(a,this._snapshotFormat,this._snapshotQuality).then(g=>{this._snapshotUrl&&URL.revokeObjectURL(this._snapshotUrl);this._snapshotUrl=URL.createObjectURL(g);this._snapshotPromise=null;this._snapshotResolve(this._snapshotUrl)});this._snapshotFormat="";this._snapshotQuality=
1}}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(a){a?this._isPastingToDrawingCanvas++:this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return 0<this._isPastingToDrawingCanvas}InitLoadingScreen(a){const b=this.GetRenderer();2===a?(this._percentText=C3$jscomp$200.New(C3$jscomp$200.Gfx.RendererText,this.GetRenderer()),this._percentText.SetFontName("Arial"),this._percentText.SetFontSize(16),this._percentText.SetHorizontalAlignment("center"),this._percentText.SetVerticalAlignment("center"),
this._percentText.SetSize(300,200)):0===a?(a=this._runtime.GetLoadingLogoAsset())&&a.LoadStaticTexture(b).catch(d=>console.warn("[C3 runtime] Failed to create texture for loading logo: ",d)):4===a&&(this._LoadSvgSplashImage("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIxNzAwLjc5MDA0cHgiIGhlaWdodD0iMTcwMC43OTAwNHB4IiB2aWV3Qm94PSIyODcgMzE3IDExMjUgMTEyNSINCgkgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTcwMC43OTAwNCAxNzAwLjc5MDA0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJsb2dvIj4NCgk8Zz4NCgkJPGc+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0ZGRkZGRiIgZD0iTTM1NC45Nzc1NCwxMTk1LjYyMzA1DQoJCQkJYzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NjI5LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOGwtNC45MzI2Miw4LjU0MTk5DQoJCQkJYy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNjU2LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMzMiwwLDUuOTYxOTEtMC40NDMzNiw4LjcyNjU2LTEuMjY4NTVjNi4yOTQ5Mi0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTczOCw2LjUwMDk4bDQuOTMxNjQsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM4NDgsNS43MzQzOGMtOS4wMDM5MSw1LjYwMTU2LTE5LjYzMTg0LDguODM3ODktMzEuMDE2Niw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzI5Ni4xNTgyLDEyMjEuOTU3MDMsMzIyLjQ5MjE5LDExOTUuNjIzMDUsMzU0Ljk3NzU0LDExOTUuNjIzMDUNCgkJCQlMMzU0Ljk3NzU0LDExOTUuNjIzMDV6IE03MDMuMjE0ODQsMTI1OS4xNzU3OGMtMTQuNTU5NTctOS44MTczOC0yMC4yMDMxMy0yMC4wMzIyMy0yMC4yMDMxMy0zMy4wODAwOA0KCQkJCWMwLTE4LjQ4OTI2LDE1LjcxNDg0LTI5Ljc2MzY3LDM4LjI2NjYtMjkuNzYzNjdjOS42NTcyMywwLDE4LjcyMTY4LDIuNTQyOTcsMjYuNTU5NTcsNi45OTQxNA0KCQkJCWMyLjA0OTgsMS4xNjQwNiwyLjc2MTcyLDMuNzgzMiwxLjU4MzAxLDUuODI0MjJsLTMuNDE3OTcsNS45MTk5MmMtMy4yNDcwNyw1LjYyNDAyLTkuOTA4Miw4LjMzMTA1LTE2LjE1MzMyLDYuNTQ4ODMNCgkJCQljLTIuNzIzNjMtMC43NzYzNy01LjU5ODYzLTEuMTkyMzgtOC41NzEyOS0xLjE5MjM4Yy0xMC40OTAyMywwLTExLjU5ODYzLDkuNTc2MTctNC44NTc0MiwxNC4xMjMwNWwyMy42ODY1MiwxNS45NzY1Ng0KCQkJCWM5Ljk5MDIzLDYuNzM4MjgsMTUuODk1NTEsMTcuMDY2NDEsMTUuODk1NTEsMjguNzE4NzVjMCwxOC43ODYxMy0xNS4wMDY4NCwzMy4zMDc2Mi0zOC4yNjc1OCwzMy4zMDc2Mg0KCQkJCWMtOS41MjI0NiwwLTE4LjU4Nzg5LTEuOTU3MDMtMjYuODE1NDMtNS40OTAyM2MtNy43ODEyNS0zLjMzOTg0LTEwLjkzMzU5LTEyLjc4MjIzLTYuNjk3MjctMjAuMTE4MTZsMy40ODczLTYuMDQxOTkNCgkJCQljMS4yMTM4Ny0yLjA5OTYxLDMuOTMxNjQtMi43NTk3Nyw1Ljk3NDYxLTEuNDU2MDVjNi44NTkzOCw0LjM4MjgxLDE2LjQ5MDIzLDcuNTk0NzMsMjQuNzU4NzksNy41OTQ3Mw0KCQkJCWMxMC41NDU5LDAsMTEuMzI4MTMtOS45NTg5OCwzLjc2NzU4LTE1LjA1NzYyTDcwMy4yMTQ4NCwxMjU5LjE3NTc4TDcwMy4yMTQ4NCwxMjU5LjE3NTc4eiBNOTg0LjYzMDg2LDEyMDIuMDAwOTgNCgkJCQljMC0yLjM0NzY2LDEuOTAzMzItNC4yNTE5NSw0LjI1MTk1LTQuMjUxOTVoOS45MjE4OGM3LjgyNzE1LDAsMTQuMTcyODUsNi4zNDU3LDE0LjE3Mjg1LDE0LjE3MzgzdjU3LjQwMTM3DQoJCQkJYzAsOC42MTAzNSw2Ljk4MDQ3LDE1LjU5MDgyLDE1LjU5MDgyLDE1LjU5MDgyczE1LjU5MDgyLTYuOTgwNDcsMTUuNTkwODItMTUuNTkwODJ2LTU3LjQwMTM3DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoOS45MjA5YzIuMzQ4NjMsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2NjcuMzIzMjQNCgkJCQljMCwyNC4yNjU2My0xOS42NzA5LDQzLjkzNzUtNDMuOTM2NTIsNDMuOTM3NXMtNDMuOTM3NS0xOS42NzE4OC00My45Mzc1LTQzLjkzNzVWMTIwMi4wMDA5OEw5ODQuNjMwODYsMTIwMi4wMDA5OHoNCgkJCQkgTTQ2Ni44NjkxNCwxMTk1LjYyMzA1YzMyLjQ4NDM4LDAsNTguODE4MzYsMjYuMzMzOTgsNTguODE4MzYsNTguODE5MzRjMCwzMi40ODQzOC0yNi4zMzM5OCw1OC44MTkzNC01OC44MTgzNiw1OC44MTkzNA0KCQkJCWMtMzIuNDg2MzMsMC01OC44MTkzNC0yNi4zMzQ5Ni01OC44MTkzNC01OC44MTkzNEM0MDguMDQ5OCwxMjIxLjk1NzAzLDQzNC4zODI4MSwxMTk1LjYyMzA1LDQ2Ni44NjkxNCwxMTk1LjYyMzA1DQoJCQkJTDQ2Ni44NjkxNCwxMTk1LjYyMzA1eiBNNDY2Ljg2OTE0LDEyMjUuMDMzMmMtMTYuMjQzMTYsMC0yOS40MTAxNiwxMy4xNjY5OS0yOS40MTAxNiwyOS40MDkxOA0KCQkJCXMxMy4xNjY5OSwyOS40MDgyLDI5LjQxMDE2LDI5LjQwODJjMTYuMjQxMjEsMCwyOS40MDgyLTEzLjE2NjAyLDI5LjQwODItMjkuNDA4MlM0ODMuMTEwMzUsMTIyNS4wMzMyLDQ2Ni44NjkxNCwxMjI1LjAzMzINCgkJCQlMNDY2Ljg2OTE0LDEyMjUuMDMzMnogTTU1Ni43MzI0MiwxMzExLjEzNDc3Yy0yLjM0NzY2LDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtOTQuOTYxOTENCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzM4My0xNC4xNzM4M2gzLjk1ODk4YzQuNjI1LDAsOC45NTg5OCwyLjI1Njg0LDExLjYxMTMzLDYuMDQ1OWw0MS4xMjIwNyw1OC43NDcwN3YtNTAuNjE5MTQNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2g5LjkyMTg4YzIuMzQ3NjYsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2OTQuOTYwOTQNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3MzgzLDE0LjE3Mjg1aC0zLjk1ODk4Yy00LjYyNSwwLTguOTU4OTgtMi4yNTU4Ni0xMS42MTEzMy02LjA0NDkybC00MS4xMjIwNy01OC43NDYwOXY1MC42MTgxNg0KCQkJCWMwLDcuODI5MS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVINTU2LjczMjQyTDU1Ni43MzI0MiwxMzExLjEzNDc3eiBNMTIxNS4wMjA1MSwxMjExLjkyMjg1DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoNTAuMzE1NDNjMi4zNDg2MywwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyDQoJCQkJYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVoLTYuMDI0NDF2NzUuMTE4MTZjMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMTg4DQoJCQkJYy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtODUuMDQxMDJoLTE1Ljk0NDM0Yy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMzMyLTQuMjUxOTUtNC4yNTE5NVYxMjExLjkyMjg1DQoJCQkJTDEyMTUuMDIwNTEsMTIxMS45MjI4NXogTTc3Ni40NDkyMiwxMjExLjkyMjg1YzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTczODMtMTQuMTczODNoNTAuMzE0NDUNCgkJCQljMi4zNDk2MSwwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcxODgsMTQuMTcyODVoLTYuMDI1Mzl2NzUuMTE4MTYNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMDljLTIuMzQ5NjEsMC00LjI1MTk1LTEuOTAyMzQtNC4yNTE5NS00LjI1di04NS4wNDEwMmgtMTUuOTQ1MzENCgkJCQljLTIuMzQ3NjYsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMTEuOTIyODVMNzc2LjQ0OTIyLDEyMTEuOTIyODV6IE05MjkuNjA0NDksMTI3Mi4wMjI0NmwyNi45NTgwMSwzMi4xMjc5Mw0KCQkJCWMyLjMxNDQ1LDIuNzU3ODEsMC4zNDM3NSw2Ljk4NDM4LTMuMjU2ODQsNi45ODQzOGgtMTkuNzA1MDhjLTQuMTg5NDUsMC04LjE2NTA0LTEuODUxNTYtMTAuODU3NDItNS4wNjA1NWwtMjIuNjgxNjQtMjcuMDMxMjUNCgkJCQl2MjcuODQxOGMwLDIuMzQ3NjYtMS45MDMzMiw0LjI1LTQuMjUxOTUsNC4yNWgtOS45MjA5Yy03LjgyNzE1LDAtMTQuMTcyODUtNi4zNDM3NS0xNC4xNzI4NS0xNC4xNzI4NXYtODUuMDM5MDYNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2gyOS43NjM2N2MyMi43MDAyLDAsNDEuMTAyNTQsMTcuMTMzNzksNDEuMTAyNTQsMzguMjY4NTUNCgkJCQlDOTU2Ljc1NDg4LDEyNTIuNTkwODIsOTQ1LjQzNjUyLDEyNjYuNzAyMTUsOTI5LjYwNDQ5LDEyNzIuMDIyNDZMOTI5LjYwNDQ5LDEyNzIuMDIyNDZ6IE05MDAuMDYxNTIsMTIyMS44NDM3NXYzMi41OTg2M2g4LjUwMzkxDQoJCQkJYzEwLjk1ODk4LDAsMTkuODQyNzctNy4yOTc4NSwxOS44NDI3Ny0xNi4yOTg4M2MwLTkuMDAxOTUtOC44ODM3OS0xNi4yOTk4LTE5Ljg0Mjc3LTE2LjI5OThIOTAwLjA2MTUyTDkwMC4wNjE1MiwxMjIxLjg0Mzc1eg0KCQkJCSBNMTE1OC4zNTkzOCwxMTk1LjYyMzA1YzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NzI3LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOA0KCQkJCWwtNC45MzI2Miw4LjU0MTk5Yy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNTU5LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMyMjMsMCw1Ljk2MDk0LTAuNDQzMzYsOC43MjU1OS0xLjI2ODU1YzYuMjk1OS0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTgzNiw2LjUwMDk4bDQuOTMwNjYsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM3NSw1LjczNDM4Yy05LjAwNDg4LDUuNjAxNTYtMTkuNjMyODEsOC44Mzc4OS0zMS4wMTc1OCw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzEwOTkuNTQwMDQsMTIyMS45NTcwMywxMTI1Ljg3NDAyLDExOTUuNjIzMDUsMTE1OC4zNTkzOCwxMTk1LjYyMzA1eiIvPg0KCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwMEZGREEiIGQ9Ik0xMzE4LjE5NzI3LDEyMDYuMDMyMjMNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2MyMC42NTYyNSwwLDQxLjMxMjUsMCw2MS45Njg3NSwwYzMuNDI5NjksMCw1LjQ1MDIsMy44ODA4NiwzLjQ4MzQsNi42OTA0Mw0KCQkJCWwtMTkuMjk2ODgsMjcuNTY3MzhjMTUuNTQyOTcsOC4zNzU5OCwyNi4xMDY0NSwyNC44MDA3OCwyNi4xMDY0NSw0My42OTUzMWMwLDI3LjM5NzQ2LTIyLjIwODk4LDQ5LjYwNjQ1LTQ5LjYwNjQ1LDQ5LjYwNjQ1DQoJCQkJYy0xNi42ODg0OCwwLTMxLjQ1MTE3LTguMjQwMjMtNDAuNDQzMzYtMjAuODc1OThjLTEuNDUwMi0yLjAzOTA2LTAuODMxMDUtNC44OTk0MSwxLjMzNTk0LTYuMTUyMzRsMTAuOTc3NTQtNi4zMzc4OQ0KCQkJCWM0Ljg4MTg0LTIuODE4MzYsMTAuOTc5NDktMi40NzU1OSwxNS41MTQ2NSwwLjg3MzA1YzMuNTI4MzIsMi42MDU0Nyw3Ljg5MTYsNC4xNDY0OCwxMi42MTUyMyw0LjE0NjQ4DQoJCQkJYzExLjc0MjE5LDAsMjEuMjU5NzctOS41MTg1NSwyMS4yNTk3Ny0yMS4yNTk3N3MtOS41MTc1OC0yMS4yNTk3Ny0yMS4yNTk3Ny0yMS4yNTk3N2gtMTUuMjE3NzcNCgkJCQljLTMuNDI5NjksMC01LjQ1MDItMy44ODA4Ni0zLjQ4NDM4LTYuNjkwNDNsMTguMTM1NzQtMjUuOTA4MmgtMzIuMDA5NzdjLTIuMzQ4NjMsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMDYuMDMyMjN6DQoJCQkJIi8+DQoJCTwvZz4NCgkJPGc+DQoJCQk8Zz4NCgkJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0RBRThGNyIgZD0iTTg1MC4zOTU1MSw4NTcuNTkxOA0KCQkJCQljLTUwLjM1NjQ1LDAtOTQuMzI1Mi0yNy4zNTY0NS0xMTcuODUyNTQtNjguMDIwNTFsLTgwLjAzMDI3LDQ2LjIwNDFjLTQuNjU1MjcsMi42ODk0NS02LjEzMTg0LDguNzE4NzUtMy4yNDkwMiwxMy4yNTU4Ng0KCQkJCQljNDIuMjM3Myw2Ni40ODYzMywxMTYuNTMzMiwxMTAuNjA3NDIsMjAxLjEzMTg0LDExMC42MDc0MmM4OC4xMjU5OCwwLDE2NS4wNzEyOS00Ny44NzUsMjA2LjI0MzE2LTExOS4wMzYxM2wtODAuNDg3My00Ni40Njk3Mw0KCQkJCQljLTQuMzEzNDgtMi40OTAyMy05LjgwMTc2LTEuMjA1MDgtMTIuNTcwMzEsMi45MzU1NUM5MzkuMTc1NzgsODMzLjU2MjUsODk3LjU5MTgsODU3LjU5MTgsODUwLjM5NTUxLDg1Ny41OTE4DQoJCQkJCUw4NTAuMzk1NTEsODU3LjU5MTh6IE0xMTM2LjcyMTY4LDU1Ni4yMTc3N2M0LjYxNDI2LTIuNjYzMDksNi4xMTAzNS04LjYxOTE0LDMuMzEyNS0xMy4xNTEzNw0KCQkJCQljLTU5LjkxNTA0LTk3LjAzMDI3LTE2Ny4yMjQ2MS0xNjEuNjk0MzQtMjg5LjYzODY3LTE2MS42OTQzNGMtMTI1Ljg5MzU1LDAtMjM1LjgxMzQ4LDY4LjM5MjU4LTI5NC42MzM3OSwxNzAuMDQ5OA0KCQkJCQlsODAuMzc2OTUsNDYuNDA2MjVjNC4zOTc0NiwyLjUzOTA2LDEwLjAwMTk1LDEuMTQ5NDEsMTIuNzEwOTQtMy4xNDU1MQ0KCQkJCQljNDIuMTY0MDYtNjYuODUxNTYsMTE2LjY2ODk1LTExMS4yNjM2NywyMDEuNTQ1OS0xMTEuMjYzNjdjODguMTI1OTgsMCwxNjUuMDcxMjksNDcuODc1OTgsMjA2LjI0MzE2LDExOS4wMzYxMw0KCQkJCQlMMTEzNi43MjE2OCw1NTYuMjE3Nzd6Ii8+DQoJCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNBNUJBQzgiIGQ9Ik04NTAuMzk1NTEsOTU5LjYzODY3DQoJCQkJCWMtODQuNTk4NjMsMC0xNTguODk0NTMtNDQuMTIxMDktMjAxLjEzMTg0LTExMC42MDc0MmMtMi44NzY5NS00LjUzMDI3LTEuMzk5NDEtMTAuNTcwMzEsMy4yNDkwMi0xMy4yNTU4Nmw4MC4wMzAyNy00Ni4yMDQxDQoJCQkJCWMtMTEuNTgxMDUtMjAuMDE2Ni0xOC4yMDk5Ni00My4yNTQ4OC0xOC4yMDk5Ni02OC4wNDE5OWMwLTc0Ljc4NTE2LDYwLjU1NzYyLTEzNi4wNjI1LDEzNi4wNjI1LTEzNi4wNjI1DQoJCQkJCWM0Ny4xOTYyOSwwLDg4Ljc4MDI3LDI0LjAyOTMsMTEzLjE4NTU1LDYwLjUyMjQ2YzIuNzY0NjUsNC4xMzM3OSw4LjI2MzY3LDUuNDIxODgsMTIuNTcwMzEsMi45MzU1NWw4MC40ODczLTQ2LjQ2OTczDQoJCQkJCWMtNDEuMTcxODgtNzEuMTYwMTYtMTE4LjExNzE5LTExOS4wMzYxMy0yMDYuMjQzMTYtMTE5LjAzNjEzYy04NC44NzY5NSwwLTE1OS4zODE4NCw0NC40MTIxMS0yMDEuNTQ1OSwxMTEuMjYzNjcNCgkJCQkJYy0yLjcwNjA1LDQuMjkxMDItOC4zMTgzNiw1LjY4MTY0LTEyLjcxMDk0LDMuMTQ1NTFsLTgwLjM3Njk1LTQ2LjQwNjI1DQoJCQkJCWMtMjguOTUyMTUsNTAuMDQwMDQtNDUuNTIzNDQsMTA4LjEzOTY1LTQ1LjUyMzQ0LDE3MC4xMDc0MmMwLDE4Ni45NjM4NywxNTEuMzk0NTMsMzQwLjE1NzIzLDM0MC4xNTcyMywzNDAuMTU3MjMNCgkJCQkJYzEyMi40MTQwNiwwLDIyOS43MjM2My02NC42NjQwNiwyODkuNjM4NjctMTYxLjY5NTMxYzIuNzk0OTItNC41MjYzNywxLjI5NDkyLTEwLjQ5MDIzLTMuMzEyNS0xMy4xNTEzN2wtODAuMDgzMDEtNDYuMjM3Mw0KCQkJCQlDMTAxNS40NjY4LDkxMS43NjM2Nyw5MzguNTIxNDgsOTU5LjYzODY3LDg1MC4zOTU1MSw5NTkuNjM4Njd6Ii8+DQoJCQk8L2c+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzAwRkZEQSIgZD0iTTExMzcuMTg1NTUsNzU4LjExMzI4di03My4xNjc5N2wtNjMuMzY1MjMsMzYuNTgzOTgNCgkJCQlMMTEzNy4xODU1NSw3NTguMTEzMjhMMTEzNy4xODU1NSw3NTguMTEzMjh6IE0xMDI2LjU3NjE3LDcwNS4xNjQwNmwxMjAuMDU4NTktNjkuMzE2NDENCgkJCQljMTIuNTY4MzYtNy4yNTU4NiwyOC4zNDQ3MywxLjg1MjU0LDI4LjM0NTcsMTYuMzY2MjF2MTM4LjYzMDg2Yy0wLjAwMDk4LDE0LjUxMjctMTUuNzc3MzQsMjMuNjIyMDctMjguMzQ1NywxNi4zNjYyMQ0KCQkJCWwtMTIwLjA1ODU5LTY5LjMxNjQxQzEwMTQuMDI4MzIsNzMwLjY0OTQxLDEwMTQuMDI4MzIsNzEyLjQwOTE4LDEwMjYuNTc2MTcsNzA1LjE2NDA2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=").then(d=>
{"done"===this._splashState?b.DeleteTexture(d):this._splashTextures.logo=d}).catch(d=>console.warn("Failed to load splash image: ",d)),this._LoadBitmapSplashImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAmd137hFVqjO7zCKIRGZ881JRAAAFZklEQVR42u2aO68SQRTHR3leQeI3wMRo7CDGZyyg0MTEYlFbEylMLC+JsQYfvTZWFpgYKwuImlhqYiyNfgOsbRBYefn4O+ecGdgF0caEMbv/5N6BYRY4vzNzzplZVKxYsWLFihUrViwHVcIBJdoDqAjqvwGwF6LJ6YgDAI5EHQBuRR3AvBZNAENu73pAI8oAVB74GWkA6gOG0QawF2hFGkACKEcaQA7yna804Z9UG5U6A9ys2SfH8Y2vaWNyQrfm8aC8AiBdgX9aOSkGIBIAl6Qq4pcm3L8r6SELfNQmF6E1oI4iDu4CP+w1xuIEtPx6CEC2A61HSvX1lSwPB5UbCgIgQ/d7YDXIFN9Ex/PUyNM7YD1jAEfAALIlqSO6SqsN0igEoAfSsKWS5i3303JzQ6tLoAfRjF3eEm+NqclgovsMn2GNAJwTAPcgOsyjjIIAFq/ngbrJuS3lhpYA0uSVnAecVYU28EZbzm7Kmhl/jeqEl8ATlauweUXtdD1AX0PtCxlWoQGpYysARl11g17Pmu69mCtHtASwA9Tp30P9uMCeLeKBeMuXUPBVqSZbmSvhGwN4w1NDrHoOdFXKM/EhBGBGQbNPMaSDKvXdx0g5oiWAXbKzZ1zTx9CYrPZB5u0HPFb7Tb38kswsmiDZkzbnaZsTZkAmBOApxxDqqshyqmiAjmgBoADyStt8swy56xrG7K0Se7qDsu72a4uAWDRjmzpIilVVTcvvcn70ggA+Smmgx72WCdLRMB2RBfCiQ0EqZR2Xo+m9g+9s13VtGb3U0kiox8THIr6wrSA+TGqq/wabCiH2/g4vp5w7SSC4HfZbKs2z3fooweuh42cwpRjp06KY2jxetgDSNqInMdIDxhsAyMIv8AckgJpyRAEARzng1ezW6KvK0rMUBmnye57+VfDF2vdGALA19q2+6wFfNwJIYmCm2A5myhUtAYx46duQ2Cdfd1DX9o1T3pxi4ZiDu9UBBiAGWg10X3UjgH1kdhNVyaiuyAKYnZRUaPNzj/LgBw4EVdXk5X+eYuQ6gJ0wgIMbAIjfZY309TxxRTYILr5jEMAuqtrwhm7LtCMIAXiwDkBf3PwzAFkHelRDuaI/Akhiqr1V1xAe69lQ/juAv8+APHzKkXXligIA1mNABiPtrZpuv6kOutp1gfxtAWQCZe0fY8Bes8Gop+E7kwRCAFazgCpgkvIm1I5SmHNvdQWA+NTqb1lAXtijHzijMIBCoA44SDWOn8ZPamdpUxRN1wAkAju7v9UBUi8m9SBnFAaQC1aCjOE2u7SJq5iKDWsAssGyTkrFzZWgUq8x7qGqnFEYgN0L2AK+guN4wO1nVHm03w0BEFsvKqt98Gub9wJVDoUDyq7OaAVA30S0Xem+Dw9ldmwbDZnuEgWfl5cAKuaa3CG1YTd42O4GufFLmogzWgGwD3go9f1Y4hbQZbdJcEiV5OAr7U2WAC4Dz6i9job2vKyBZhCAXNOXt0oB+iPdURiAPRFqGkfmgbnxHmoyJfD9o0q0MWwtAGQBvFfqDO8m+r8/EWrJiZCw0YzcURhA6ExQZsKIl7TtKMDogswAVn+5nbQ7gxCAIUSHzerCVLmjMIDQqbAYPjXBcWTznD3hFQCCSXRUHEwatQMAZkJ12DXlgDunIWEAolfBX0tI6RcsAHJi4DvJAqFrvtcWc8SvFwMABnJf4JZ57tBpyBqAtTtDFZOxXi9uZKROaVPLwTQo1+CtfdyhO0MhAKE7Q/spGEZZWXeOxLejvDtH4ttR0qHTkK2ojwcq0urgk4qyEi6dhmxB6Wa0YyAAZ34asRUB8F35ZcBWxDuGKKuIJypWrFixYsX6B/oFRYsi2zOzWJcAAAAASUVORK5CYII=").then(d=>
{"done"===this._splashState?b.DeleteTexture(d):this._splashTextures.powered=d}).catch(d=>console.warn("Failed to load splash image: ",d)),this._LoadBitmapSplashImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAdxHdu4hmVZnuRMwzqiLYE4y2AAAFw0lEQVR42u2Yy+9LQRTHp6Xq0VIkXkFvwkYslAWJiGJj2a6sJJe/oF3YWGElEQmxkYi4ErFWNpatWFmIx9Lm1sJCLKgqraqv82h726l6hOuRzDf53TtnOr+ZOZ+ZOffca5ycnJycnJycnJycnJycnJz+pi7g2G9osxjvzX8qB8ABcAAcgH8XwDa85dspNOiaRDuAR4U0PnHtDuyy7IJRJS6gvVmL6TywVkp4ZxIhulUxFvlaXQTrgEHbnMDH5XRjlXCdb+uAnc2ojWgFFTYBZ8e9tzcaswAk6v/3K4sPfPNRFj87IXj+KXQUS9m2jXoH1lMuLq2DtEcAtNMBT9PjanFq7ySAhbABVEAaeDaAwkk2D7GRqctAMQJIq2sBauLnB/VxCfqKpWrbRhSC1W5SMQ9RTgBUwKpF1ccmAIQ2gCxE+20Au9nSESvDgeIDkJSBMpA9vgyXdsj0H0GORL3n2fbwPOKoSQS4Q2cBOGzSJbQYAHDbZEI+rEuBcyZRlF71fIP/x0wBuIBOw6xH3xu2GQFAP2cegmvSwHkeqBZjECzB46UXD3bg8UKJCT6QYzgDY9uiU7hC11doERq6MAZ2CPJ7ipEulOrteDcB4KOZBpBG7zrV1JGzATzmIdnrl/go3bRiBJBHlZc+6ItjuQQ+yFLz8Gka2LZFRVTFGdoQJQ0LPodHnXkS8AjlRWkBLwKQswAs0PDzGpcsAAMNuG+5WgdqxwjgEcp8qcBjN5oZdPhEvOfhU/hsbJuVloWV6WWgp2IBLxXQNEwLDfKqoMXrEQBjATiFA3qePlgAZJRl+EStdaAQjfgALOC1zfeX8ALV+7S69JdALWjxHGqztmxyMnTD6OOBWvAdGDkn60c6vrI5H4CPnOJsWQDe8G0hIU0MB8ojFx+AFAeqeitLy5FkL3w0yNNcSOx3oDxjjxaH9XxldZluY5NBfwrAQvQbRjQXAO8UqVq5dh6A7HCgWzgdFwBdgOX4lMZbTndkWWkDN07Bk+zItllLdHm1+FkLwBSADNDf8B0AnGOp5gFYgJEexwcgGQx4iyeD9ybFkWsbDZbv0+2Y8XvGtqMpWsUimpMAzA1AUrj5ALjm2wCoONKB+ACYsEeDlU04MMs4imeJQqljslSuD4xl/zgAsx6ku/8DgDwaO9AwFU56qhzOPiXpKCzCpSSdb8v+CQDmXshb99cARAPFCOA1chWaFXlP55yn2FqEgiFvOSzYtmiJzisKB7MxQPS8iO63YsD3AHDv8QPgjR92eKuf9vts1wdZjvZhN4XajD35FNDiR7ln0LYBaILY+OZT4DsA+BkTP4AUrgXkxSJcDFps+72X7EGlx6mBbU/lAbdQjvKA7hSAlSuHxdw0gORsHrAUnXkAUuj+AQAZdHGRp9bShX2ECz1JRSk4zNhRJqj5SZQJfpgCUNS2eRsAP/usTDAxPxFKA834AZgAOM1z6qGgxxpdmUDQNjP25LtAsojxu0AehSkAF6RLXWR/EkAdVYEevQtswVtpMwuAB1JGh2jbxQcgBKrig/qSxTD6o2Nm7fttSY6uUnErV+jb4CJyaArAI5luJkCDOy5HAPISSB5A3wYbhJERahvtPALAAw2EI9Vzsh2TTuk23qEceN9d4vVVv227hNroe0CRi/o9IKTZTQFIAc/M8jwGEiouG2/042u8u25uAuPvAavRH7XhzqcBpICdRpssRa+aNLFoh2JeyBzU08fih/ht20WZXghW34s+/ZQnAKhzojsSH4CC/sjARPKamLXacOfTAIwfNSkCbROLluG9Tm2gdl3PY178tu2SBIpFQ6fHH//2GAvAogCkjtGDEAFQYPsu6DdBqw11bgFIF8dNHsQGIEFRSDOe0RS9YYJk23JMrw+/Cr9bFX0VXmNsACbhA088qXhBrMYAlq8Gjhh//FX4YNSGO7cASO9n9B99AuHk5OTk5OTk5OTk5OTk5OTk5OT0VX0B7+fX+9cwWYYAAAAASUVORK5CYII=").then(d=>
{"done"===this._splashState?b.DeleteTexture(d):this._splashTextures.website=d}).catch(d=>console.warn("Failed to load splash image: ",d)))}async _LoadSvgSplashImage(a){a=(new URL(a,this._runtime.GetRuntimeBaseURL())).toString();a=await C3$jscomp$200.FetchBlob(a);a=await this._runtime.RasterSvgImage(a,2048,2048);return await this.GetRenderer().CreateStaticTextureAsync(a,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(a){a=(new URL(a,this._runtime.GetRuntimeBaseURL())).toString();a=await C3$jscomp$200.FetchBlob(a);
return await this.GetRenderer().CreateStaticTextureAsync(a,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now();this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler);this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen());3!==this._runtime.GetLoaderStyle()&&this.HideCordovaSplashScreen()}async EndLoadingScreen(){const a=this.GetRenderer();
this._loadingProgress=1;const b=this._runtime.GetLoaderStyle();4===b&&await this._splashDonePromise;this._splashDonePromise=this._splashDoneResolve=null;-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1);this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler);this._loadingprogress_handler=null;this._percentText&&(this._percentText.Release(),this._percentText=null);this._runtime.ReleaseLoadingLogoAsset();a.Start();this._splashTextures.logo&&
(a.DeleteTexture(this._splashTextures.logo),this._splashTextures.logo=null);this._splashTextures.powered&&(a.DeleteTexture(this._splashTextures.powered),this._splashTextures.powered=null);this._splashTextures.website&&(a.DeleteTexture(this._splashTextures.website),this._splashTextures.website=null);a.ClearRgba(0,0,0,0);a.Finish();this._splashState="done";this._gpuTimeStartFrame=a.GetFrameNumber();3===b&&this.HideCordovaSplashScreen()}_DrawLoadingScreen(){if(-1!==this._rafId){var a=this.GetRenderer();
a.Start();this._rafId=-1;var b=this._runtime.GetAssetManager().HasHadErrorLoading(),d=this._runtime.GetLoaderStyle();3!==d&&(this.SetCssTransform(a),a.ClearRgba(0,0,0,0),a.ResetColor(),a.SetTextureFillMode(),a.SetTexture(null));if(0===d)this._DrawProgressBarAndLogoLoadingScreen(b);else if(1===d)this._DrawProgressBarLoadingScreen(b,120,0);else if(2===d)this._DrawPercentTextLoadingScreen(b);else if(3===d)C3$jscomp$200.noop();else if(4===d)this._DrawSplashLoadingScreen(b);else throw Error("invalid loader style");
a.Finish();this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen())}}_DrawPercentTextLoadingScreen(a){a?this._percentText.SetColorRgb(1,0,0):this._percentText.SetColorRgb(.6,.6,.6);this._percentText.SetText(Math.round(100*this._loadingProgress)+"%");a=this._canvasCssWidth/2;const b=this._canvasCssHeight/2;tempQuad$jscomp$5.setRect(a-150,b-100,a+150,b+100);a=this.GetRenderer();a.SetTexture(this._percentText.GetTexture());a.Quad3(tempQuad$jscomp$5,this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(a,
b,d){const c=this.GetRenderer();c.SetColorFillMode();a?c.SetColorRgba(1,0,0,1):c.SetColorRgba(.118,.565,1,1);a=this._canvasCssWidth/2;const e=this._canvasCssHeight/2,g=b/2;tempRect$jscomp$9.setWH(a-g,e-4+d,Math.floor(b*this._loadingProgress),8);c.Rect(tempRect$jscomp$9);tempRect$jscomp$9.setWH(a-g,e-4+d,b,8);tempRect$jscomp$9.offset(-.5,-.5);tempRect$jscomp$9.inflate(.5,.5);c.SetColorRgba(0,0,0,1);c.LineRect2(tempRect$jscomp$9);tempRect$jscomp$9.inflate(1,1);c.SetColorRgba(1,1,1,1);c.LineRect2(tempRect$jscomp$9)}_DrawProgressBarAndLogoLoadingScreen(a){const b=
this.GetRenderer();var d=this._runtime.GetLoadingLogoAsset();if(d)if(d=d.GetTexture()){var c=d.GetWidth(),e=d.GetHeight(),g=this._canvasCssWidth/2,k=this._canvasCssHeight/2,l=c/2;e/=2;tempQuad$jscomp$5.setRect(g-l,k-e,g+l,k+e);b.SetTexture(d);b.Quad(tempQuad$jscomp$5);this._DrawProgressBarLoadingScreen(a,c,e+16)}else this._DrawProgressBarLoadingScreen(a,120,0);else this._DrawProgressBarLoadingScreen(a,120,0)}_DrawSplashLoadingScreen(a){const b=this.GetRenderer(),d=this._splashTextures.logo,c=this._splashTextures.powered,
e=this._splashTextures.website,g=Date.now();0===this._splashFrameNumber&&(this._loaderStartTime=g);const k=this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova(),l=k?0:200,n=k?0:3E3;let p=1;"fade-in"===this._splashState?p=Math.min((g-this._loaderStartTime)/300,1):"fade-out"===this._splashState&&(p=Math.max(1-(g-this._splashFadeOutStartTime)/300,0));b.SetColorFillMode();b.SetColorRgba(.231*p,.251*p,.271*p,p);tempRect$jscomp$9.set(0,0,this._canvasCssWidth,this._canvasCssHeight);
b.Rect(tempRect$jscomp$9);const r=Math.ceil(this._canvasCssWidth),w=Math.ceil(this._canvasCssHeight);let z;256<this._canvasCssHeight?(b.SetColorRgba(.302*p,.334*p,.365*p,p),z=Math.max(.005*w,2),tempRect$jscomp$9.setWH(0,.8*w-z/2,r,z),b.Rect(tempRect$jscomp$9),a?b.SetColorRgba(p,0,0,p):b.SetColorRgba(.161*p,.953*p,.816*p,p),a=r*this._loadingProgress,tempRect$jscomp$9.setWH(.5*r-a/2,.8*w-z/2,a,z),b.Rect(tempRect$jscomp$9),b.SetColorRgba(p,p,p,p),b.SetTextureFillMode(),c&&(a=1.5*C3$jscomp$200.clamp(.22*
w,105,.6*r),z=a/8,tempRect$jscomp$9.setWH(.5*r-a/2,.2*w-z/2,a,z),b.SetTexture(c),b.Rect(tempRect$jscomp$9)),d&&(z=a=Math.min(.395*w,.95*r),tempRect$jscomp$9.setWH(.5*r-a/2,.485*w-z/2,a,z),b.SetTexture(d),b.Rect(tempRect$jscomp$9)),e&&(a=1.5*C3$jscomp$200.clamp(.22*w,105,.6*r),z=a/8,tempRect$jscomp$9.setWH(.5*r-a/2,.868*w-z/2,a,z),b.SetTexture(e),b.Rect(tempRect$jscomp$9))):(b.SetColorRgba(.302*p,.334*p,.365*p,p),z=Math.max(.005*w,2),tempRect$jscomp$9.setWH(0,.85*w-z/2,r,z),b.Rect(tempRect$jscomp$9),
a?b.SetColorRgba(p,0,0,p):b.SetColorRgba(.161*p,.953*p,.816*p,p),a=r*this._loadingProgress,tempRect$jscomp$9.setWH(.5*r-a/2,.85*w-z/2,a,z),b.Rect(tempRect$jscomp$9),b.SetColorRgba(p,p,p,p),b.SetTextureFillMode(),d&&(z=a=.55*w,tempRect$jscomp$9.setWH(.5*r-a/2,.45*w-z/2,a,z),b.SetTexture(d),b.Rect(tempRect$jscomp$9)));this._splashFrameNumber++;"fade-in"===this._splashState&&300<=g-this._loaderStartTime&&2<=this._splashFrameNumber&&(this._splashState="wait",this._splashFadeInFinishTime=g);"wait"===this._splashState&&
g-this._splashFadeInFinishTime>=n&&1<=this._loadingProgress&&(this._splashState="fade-out",this._splashFadeOutStartTime=g);("fade-out"===this._splashState&&g-this._splashFadeOutStartTime>=300+l||k&&1<=this._loadingProgress&&500>g-this._loaderStartTime)&&this._splashDoneResolve()}};"use strict";const C3$jscomp$201=self.C3,C3Debugger$jscomp$3=self.C3Debugger,DEFAULT_RUNTIME_OPTS={messagePort:null,runtimeBaseUrl:"",headless:!1,hasDom:!0,isInWorker:!1,useAudio:!0,projectData:"",exportType:""};
let ife=!0;
C3$jscomp$201.Runtime=class extends C3$jscomp$201.DefendedBase{constructor(a){a=Object.assign({},DEFAULT_RUNTIME_OPTS,a);super();this._messagePort=a.messagePort;this._runtimeBaseUrl=a.runtimeBaseUrl;this._previewUrl=a.previewUrl;this._isHeadless=!!a.headless;this._hasDom=!!a.hasDom;this._isInWorker=!!a.isInWorker;ife=a.ife;this._useAudio=!!a.useAudio;this._exportType=a.exportType;this._isiOSCordova=!!a.isiOSCordova;this._isiOSWebView=!!a.isiOSWebView;this._isWindowsWebView2=!!a.isWindowsWebView2;this._isAnyWebView2Wrapper=
!!a.isAnyWebView2Wrapper;this._isFBInstantAvailable=!!a.isFBInstantAvailable;this._opusWasmScriptUrl=a.opusWasmScriptUrl;this._opusWasmBinaryUrl=a.opusWasmBinaryUrl;this._isDebugging=this._breakpointsEnabled=this._isDebug=!("preview"!==this._exportType||!a.isDebug);this._debuggingDisabled=0;this._additionalLoadPromises=[];this._additionalCreatePromises=[];this._isUsingCreatePromises=!1;this._appId=this._projectUniqueId=this._projectVersion=this._projectName="";this._originalViewportHeight=this._originalViewportWidth=
0;this._devicePixelRatio=self.devicePixelRatio;this._loaderStyle=this._viewportHeight=this._viewportWidth=this._parallaxYorigin=this._parallaxXorigin=0;this._usesLoaderLayout=!1;this._isLoading=!0;this._usesAnyDepthSampling=this._usesAnyCrossSampling=this._usesAnyBackgroundBlending=!1;this._loadingLogoAsset=null;this._assetManager=C3$jscomp$201.New(C3$jscomp$201.AssetManager,this,a);this._layoutManager=C3$jscomp$201.New(C3$jscomp$201.LayoutManager,this);this._eventSheetManager=C3$jscomp$201.New(C3$jscomp$201.EventSheetManager,
this);this._addonManager=C3$jscomp$201.New(C3$jscomp$201.AddonManager,this,a.wrapperComponentIds);this._collisionEngine=C3$jscomp$201.New(C3$jscomp$201.CollisionEngine,this);this._timelineManager=C3$jscomp$201.New(C3$jscomp$201.TimelineManager,this);this._transitionManager=C3$jscomp$201.New(C3$jscomp$201.TransitionManager,this);this._templateManager=C3$jscomp$201.New(C3$jscomp$201.TemplateManager,this);this._flowchartManager=C3$jscomp$201.New(C3$jscomp$201.FlowchartManager,this);this._textIconManager=
C3$jscomp$201.New(C3$jscomp$201.TextIconManager,{getIconSetMeta:d=>this._GetTextIconSetMeta(d),getIconSetContent:d=>this._GetTextIconSetContent(d)});this._iconChangeHandlers=new Map;this._allObjectClasses=[];this._objectClassesByName=new Map;this._objectClassesBySid=new Map;this._familyCount=0;this._allContainers=[];this._allEffectLists=new Set;this._currentLayoutStack=[];this._instancesPendingCreate=[];this._instancesPendingDestroy=new Map;this._isFlushingPendingInstances=this._hasPendingInstances=
!1;this._nextUid=this._objectCount=0;this._instancesByUid=new Map;this._instancesPendingRelease=new Set;this._instancesPendingReleaseAffectedObjectClasses=new Set;this._objectReferenceTable=[];this._jsPropNameTable=[];this._canvasManager=null;this._uses3dFeatures=!1;this._framerateMode="vsync";this._sampling="trilinear";this._isPixelRoundingEnabled=!1;this._needRender=!0;this._isPausedOnBlur=this._pauseOnBlur=!1;this._exportToVideo=null;this._tickCallbacks={normal:d=>{this._ruafId=this._rafId=-1;
this.Tick(d)},tickOnly:d=>{this._ruafId=-1;this.Tick(d,!1,"skip-render")},renderOnly:()=>{this._rafId=-1;this.Render()}};this._ruafId=this._rafId=-1;this._tickCountNoSave=this._tickCount=0;this._hasStartedTicking=this._isInTick=this._hasStarted=!1;this._isLayoutFirstTick=!0;this._suspendCount=0;this._scheduleTriggersThrottle=new C3$jscomp$201.PromiseThrottle(1);this._randomNumberCallback=()=>Math.random();this._dt=this._dt1=this._dtRaw=this._lastTickTime=this._startTime=0;this._timeScale=1;this._maxDt=
1/30;this._minDt=0;this._gameTime=C3$jscomp$201.New(C3$jscomp$201.KahanSum);this._gameTimeRaw=C3$jscomp$201.New(C3$jscomp$201.KahanSum);this._wallTime=C3$jscomp$201.New(C3$jscomp$201.KahanSum);this._instanceTimes=new Map;this._fpsFrameCount=-1;this._fps=this._fpsLastTime=0;this._tpsTickCount=-1;this._mainThreadTime=this._mainThreadTimeCounter=this._tps=0;this._isLoadingState=!1;this._loadFromSlotName=this._saveToSlotName="";this._loadFromJson=null;this._lastSaveJson="";this._savegamesStorage=this._projectStorage=
null;this._dispatcher=C3$jscomp$201.New(C3$jscomp$201.Event.Dispatcher);this._domEventHandlers=new Map;this._pendingResponsePromises=new Map;this._nextDomResponseId=0;this._isReadyToHandleEvents=this._didRequestDeviceMotionEvent=this._didRequestDeviceOrientationEvent=!1;this._waitingToHandleEvents=[];this._eventObjects={pretick:C3$jscomp$201.New(C3$jscomp$201.Event,"pretick",!1),tick:C3$jscomp$201.New(C3$jscomp$201.Event,"tick",!1),tick2:C3$jscomp$201.New(C3$jscomp$201.Event,"tick2",!1),instancedestroy:C3$jscomp$201.New(C3$jscomp$201.Event,
"instancedestroy",!1),beforelayoutchange:C3$jscomp$201.New(C3$jscomp$201.Event,"beforelayoutchange",!1),layoutchange:C3$jscomp$201.New(C3$jscomp$201.Event,"layoutchange",!1)};this._eventObjects.instancedestroy.instance=null;this._userScriptDispatcher=C3$jscomp$201.New(C3$jscomp$201.Event.Dispatcher);this._userScriptEventObjects=null;const b=(d,c)=>C3$jscomp$201.BehaviorInstance.SortByTickSequence(this,d,c);this._behInstsToTick=C3$jscomp$201.New(C3$jscomp$201.RedBlackSet,b);this._behInstsToPostTick=
C3$jscomp$201.New(C3$jscomp$201.RedBlackSet,b);this._behInstsToTick2=C3$jscomp$201.New(C3$jscomp$201.RedBlackSet,b);this._jobScheduler=C3$jscomp$201.New(C3$jscomp$201.JobSchedulerRuntime,this,a.jobScheduler);a.canvas&&(this._canvasManager=C3$jscomp$201.New(C3$jscomp$201.CanvasManager,this));this._messagePort.onmessage=d=>this._OnMessageFromDOM(d.data);this.AddDOMComponentMessageHandler("runtime","visibilitychange",d=>this._OnVisibilityChange(d));this.AddDOMComponentMessageHandler("runtime","wrapper-extension-message",
d=>this._OnWrapperExtensionMessage(d));this.AddDOMComponentMessageHandler("runtime","opus-decode",d=>this._WasmDecodeWebMOpus(d.arrayBuffer));this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",()=>this._GetRemotePreviewStatusInfo());this.AddDOMComponentMessageHandler("runtime","js-invoke-function",d=>this._InvokeFunctionFromJS(d));this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self.goToLastErrorScript);this.AddDOMComponentMessageHandler("runtime",
"offline-audio-render-completed",d=>this._OnOfflineAudioRenderCompleted(d));this._dispatcher.addEventListener("window-blur",d=>this._OnWindowBlur(d));this._dispatcher.addEventListener("window-focus",()=>this._OnWindowFocus());this._timelineManager.AddRuntimeListeners();this._templateManager.AddRuntimeListeners();this._iRuntime=null;this._interfaceMap=new WeakMap;this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null,timelineController:null,platformInfo:null};this._instancesNeedingAfterLoadMap=
new WeakMap;this._instancesNeedingAfterLoadArray=[]}static Create(a){return C3$jscomp$201.New(C3$jscomp$201.Runtime,a)}Release(){C3$jscomp$201.clearArray(this._allObjectClasses);this._objectClassesByName.clear();this._objectClassesBySid.clear();this._layoutManager.Release();this._layoutManager=null;this._eventSheetManager.Release();this._eventSheetManager=null;this._addonManager.Release();this._addonManager=null;this._assetManager.Release();this._assetManager=null;this._collisionEngine.Release();
this._collisionEngine=null;this._timelineManager.Release();this._timelineManager=null;this._transitionManager.Release();this._transitionManager=null;this._templateManager.Release();this._templateManager=null;this._flowchartManager.Release();this._flowchartManager=null;this._textIconManager.Release();this._textIconManager=null;this._canvasManager&&(this._canvasManager.Release(),this._canvasManager=null);this._dispatcher.Release();this._tickEvent=this._dispatcher=null}_OnMessageFromDOM(a){const b=a.type;
if("event"===b)this._OnEventFromDOM(a);else if("result"===b)this._OnResultFromDOM(a);else throw Error(`unknown message '${b}'`);}_OnEventFromDOM(a){if(this._isReadyToHandleEvents){var b=a.component,d=a.handler,c=a.data,e=a.dispatchOpts,g=!(!e||!e.dispatchRuntimeEvent);e=!(!e||!e.dispatchUserScriptEvent);var k=a.responseId;if("runtime"===b&&(g&&(a=new C3$jscomp$201.Event(d),a.data=c,this._dispatcher.dispatchEventAndWaitAsyncSequential(a)),e)){a=new C3$jscomp$201.Event(d,!0);for(const [l,n]of Object.entries(c))a[l]=
n;this.DispatchUserScriptEvent(a)}if(a=this._domEventHandlers.get(b))if(a=a.get(d)){g=null;try{g=a(c)}catch(l){console.error(`Exception in '${b}' handler '${d}':`,l);null!==k&&this._PostResultToDOM(k,!1,""+l);return}null!==k&&(g&&g.then?g.then(l=>this._PostResultToDOM(k,!0,l)).catch(l=>{console.error(`Rejection from '${b}' handler '${d}':`,l);this._PostResultToDOM(k,!1,""+l)}):this._PostResultToDOM(k,!0,g))}else g||e||console.warn(`[Runtime] No DOM handler '${d}' for component '${b}'`);else g||e||
console.warn(`[Runtime] No DOM event handlers for component '${b}'`)}else this._waitingToHandleEvents.push(a)}_PostResultToDOM(a,b,d){this._messagePort.postMessage({type:"result",responseId:a,isOk:b,result:d})}_OnResultFromDOM(a){const b=a.responseId,d=a.isOk;a=a.result;const c=this._pendingResponsePromises.get(b);d?c.resolve(a):c.reject(a);this._pendingResponsePromises.delete(b)}AddDOMComponentMessageHandler(a,b,d){let c=this._domEventHandlers.get(a);c||(c=new Map,this._domEventHandlers.set(a,c));
if(c.has(b))throw Error(`[Runtime] Component '${a}' already has handler '${b}'`);c.set(b,d)}PostComponentMessageToDOM(a,b,d,c){this._messagePort.postMessage({type:"event",component:a,handler:b,data:d,responseId:null},c)}PostComponentMessageToDOMAsync(a,b,d,c){const e=this._nextDomResponseId++,g=new Promise((k,l)=>{this._pendingResponsePromises.set(e,{resolve:k,reject:l})});this._messagePort.postMessage({type:"event",component:a,handler:b,data:d,responseId:e},c);return g}SendWrapperExtensionMessage(a,
b,d,c=-1){this.PostComponentMessageToDOM("runtime","send-wrapper-extension-message",{componentId:a,messageId:b,params:d,asyncId:c})}SendWrapperExtensionMessageAsync(a,b,d){const c=this._nextDomResponseId++,e=new Promise((g,k)=>{this._pendingResponsePromises.set(c,{resolve:g,reject:k})});this.SendWrapperExtensionMessage(a,b,d,c);return e}_OnWrapperExtensionMessage(a){if(-1!==a.asyncId){const b=a.asyncId;this._pendingResponsePromises.get(b).resolve(a.params);this._pendingResponsePromises.delete(b)}else this._OnEventFromDOM({component:"wrapper-extension:"+
a.componentId,handler:a.messageId,data:a.params,responseId:null})}AddWrapperExtensionMessageHandler(a,b,d){this.AddDOMComponentMessageHandler("wrapper-extension:"+a,b,d)}HasWrapperComponentId(a){return this._addonManager.HasWrapperComponentId(a)}PostToDebugger(a){if(!this.IsDebug())throw Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",a)}async Init(a){C3$jscomp$201.CommonACES_SetRuntime(this);this.IsDebug()?await C3Debugger$jscomp$3.Init(this):self.C3Debugger&&
self.C3Debugger.InitPreview(this);var [b]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);await this._LoadDataJson(b);await this._InitialiseCanvas(a);this.IsPreview()||console.info("Made with Construct, the game and app creator :: https://www.construct.net");this.GetWebGLRenderer()?(b=this.GetWebGLRenderer(),console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGL ${b.GetWebGLVersionNumber()} [${b.GetUnmaskedRenderer()}]`)):
this.GetWebGPURenderer()&&console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGPU [${this.GetWebGPURenderer().GetAdapterInfoString()}]`);this.GetRenderer().HasMajorPerformanceCaveat()&&console.warn("[C3 runtime] The renderer indicates a major performance caveat. Software rendering may be in use. This can result in significantly degraded performance.");this._isReadyToHandleEvents=!0;for(const d of this._waitingToHandleEvents)this._OnEventFromDOM(d);C3$jscomp$201.clearArray(this._waitingToHandleEvents);
this._canvasManager&&this._canvasManager.StartLoadingScreen();for(const d of a.runOnStartupFunctions)this._additionalLoadPromises.push(this._RunOnStartupFunction(d));await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]);C3$jscomp$201.clearArray(this._additionalLoadPromises);if(this._assetManager.HasHadErrorLoading())this._canvasManager&&this._canvasManager.HideCordovaSplashScreen();else return this._canvasManager&&await this._canvasManager.EndLoadingScreen(),await this._dispatcher.dispatchEventAndWaitAsync(new C3$jscomp$201.Event("beforeruntimestart")),
await this.Start(),this._messagePort.postMessage({type:"runtime-ready"}),this}async _RunOnStartupFunction(a){try{await a(this._iRuntime)}catch(b){console.error("[C3 runtime] Error in runOnStartup function: ",b)}}async _LoadDataJson(a){a=a.project;this._projectName=a[0];this._projectVersion=a[16];this._projectUniqueId=a[31];this._appId=a[38];var b=a[39]||"loading-logo.png";this._isPixelRoundingEnabled=!!a[9];this._originalViewportWidth=this._viewportWidth=a[10];this._originalViewportHeight=this._viewportHeight=
a[11];this._collisionEngine._InitCollisionCellSize(this._originalViewportWidth,this._originalViewportHeight);this._parallaxXorigin=this._originalViewportWidth/2;this._parallaxYorigin=this._originalViewportHeight/2;this._framerateMode=a[37];this._uses3dFeatures=!!a[40];this._sampling=a[14];this._usesAnyBackgroundBlending=a[15];this._usesAnyCrossSampling=a[42];this._usesAnyDepthSampling=a[17];this._usesLoaderLayout=!!a[18];this._loaderStyle=a[19];this._nextUid=a[21];this._pauseOnBlur=a[22];const d=
this._assetManager;d._SetFileStructure(a[45]);d._SetAudioFiles(a[7],a[25]);d._SetMediaSubfolder(a[8]);d._SetFontsSubfolder(a[32]);d._SetIconsSubfolder(a[28]);d._SetWebFonts(a[29]);if(0===this._loaderStyle){let l="";this.IsPreview()?d._HasLocalUrlBlob(b)&&(l=d.GetLocalUrlAsBlobUrl(b)):l="flat"===d.GetFileStructure()?d.GetIconsSubfolder()+b:b;l&&(this._loadingLogoAsset=d.LoadImage({url:l}))}this._canvasManager&&(this._canvasManager.SetFullscreenMode(C3$jscomp$201.CanvasManager._FullscreenModeNumberToString(a[12])),
this._canvasManager.SetFullscreenScalingQuality(a[23]?"high":"low"),this._canvasManager.SetMipmapsEnabled(0!==a[24]),this._canvasManager._SetGPUPowerPreference(a[34]),this._canvasManager._SetTextureAnisotropy(a[41]),this._canvasManager._SetWebGPUEnabled(a[13]),this._canvasManager._SetZAxisScale(a[30]),this._canvasManager._SetZDistances(a[46],a[47]),this._canvasManager._SetInitFieldOfView(a[26]),this._canvasManager._SetLimitedToWebGL1(a[48]));(b=a[43])&&await this._LoadExportToVideoData(b);this._InitScriptInterfaces();
this._addonManager.CreateSystemPlugin();this._objectReferenceTable=self.C3_GetObjectRefTable();b=a[2];for(var c of b[1])this._addonManager.CreateBehavior(c);for(const l of b[0])this._addonManager.CreatePlugin(l);this._objectReferenceTable=self.C3_GetObjectRefTable();this._LoadJsPropNameTable();this._addonManager._InitAddonScriptInterfaces();for(var e of a[3])c=C3$jscomp$201.ObjectClass.Create(this,this._allObjectClasses.length,e),this._allObjectClasses.push(c),this._objectClassesByName.set(c.GetName().toLowerCase(),
c),this._objectClassesBySid.set(c.GetSID(),c);for(const l of a[4])this._allObjectClasses[l[0]]._LoadFamily(l);for(var g of a[27])e=g.map(l=>this._allObjectClasses[l]),this._allContainers.push(C3$jscomp$201.New(C3$jscomp$201.Container,this,e));this._InitObjectsScriptInterface();for(const l of this._allObjectClasses)l._OnAfterCreate();for(const l of a[5])this._layoutManager.Create(l);(g=a[1])&&(g=this._layoutManager.GetLayoutByName(g))&&this._layoutManager.SetFirstLayout(g);for(var k of a[35])this._transitionManager.Create(k);
for(const l of a[33])this._timelineManager.Create(l);for(const l of a[44])this._templateManager.Create(l);this._templateManager.HasTemplates()||(this._templateManager.Release(),this._templateManager=null);for(const l of a[49])this._flowchartManager.Create(l);this._flowchartManager.HasFlowcharts()||(this._flowchartManager.Release(),this._flowchartManager=null);for(const l of a[6])this._eventSheetManager.Create(l);this._eventSheetManager._PostInit();this._InitGlobalVariableScriptInterface();C3$jscomp$201.clearArray(this._objectReferenceTable);
this.FlushPendingInstances();k="any";a=a[20];1===a?k="portrait":2===a&&(k="landscape");this.PostComponentMessageToDOM("runtime","set-target-orientation",{targetOrientation:k})}async _LoadExportToVideoData(a){const b=a.format;"image-sequence"===b?this._exportToVideo=new self.C3ExportToImageSequence(this,a):"image-sequence-gif"===b?this._exportToVideo=new self.C3ExportToGIF(this,a):"webm"===b?this._exportToVideo=new self.C3ExportToWebMVideo(this,a):"mp4"===b&&(this._exportToVideo=new self.C3ExportToMP4Video(this,
a));this._framerateMode="unlimited-frame";this._canvasManager.SetFullscreenMode("off");this._devicePixelRatio=1;self.devicePixelRatio=1;await this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{message:this._exportToVideo.GetExportingMessageForPercent(0),duration:this._exportToVideo.GetDuration()})}GetLoaderStyle(){return this._loaderStyle}IsExportToVideo(){return null!==this._exportToVideo}GetExportVideoDuration(){return this._exportToVideo.GetDuration()}GetExportVideoFramerate(){return this._exportToVideo.GetFramerate()}_InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),
height:this._canvasManager.GetDeviceHeight()})}_ExportToVideoAddFrame(){const a=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetMainCanvas(),a)}_ExportToVideoAddKeyframe(){this._exportToVideo&&this._exportToVideo.AddKeyframe()}_OnOfflineAudioRenderCompleted(a){this._exportToVideo.OnOfflineAudioRenderCompleted(a)}_ExportToVideoFinish(){return this._exportToVideo.Finish()}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(a){this._additionalLoadPromises.push(a)}SetUsingCreatePromises(a){this._isUsingCreatePromises=
!!a}AddCreatePromise(a){this._isUsingCreatePromises&&this._additionalCreatePromises.push(a)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(a){this._allEffectLists.add(a)}_RemoveEffectList(a){this._allEffectLists.delete(a)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(a){this._canvasManager&&(await this._canvasManager.CreateCanvas(a),this._canvasManager.InitLoadingScreen(this._loaderStyle))}async _MaybeLoadOpusDecoder(){if(!this._assetManager.IsAudioFormatSupported("audio/webm; codecs=opus")){var a=
null;try{a=this.IsiOSCordova()&&this._assetManager.IsFileProtocol()?await this._assetManager.CordovaFetchLocalFileAsArrayBuffer(this._opusWasmBinaryUrl):await this._assetManager.FetchArrayBuffer(this._opusWasmBinaryUrl)}catch(b){console.info("Failed to fetch Opus decoder WASM; assuming project has no Opus audio.",b);return}a?this.AddJobWorkerBuffer(a,"opus-decoder-wasm"):this.AddJobWorkerBlob(null,"opus-decoder-wasm");await this.AddJobWorkerScripts([this._opusWasmScriptUrl])}}async _WasmDecodeWebMOpus(a){return await this.AddJob("OpusDecode",
{arrayBuffer:a},[a])}async Start(){this._hasStarted=!0;this._startTime=Date.now();let a=null;const b=new Promise(c=>a=c);if(this._usesLoaderLayout){for(var d of this._allObjectClasses)d.IsFamily()||d.IsOnLoaderLayout()||!d.IsWorldType()||d.OnCreate();(async()=>{await this._assetManager.WaitForAllToLoad();await b;this._isLoading=!1;this._OnLoadFinished()})()}else this._isLoading=!1;this._assetManager.SetInitialLoadFinished();this.IsDebug()&&C3Debugger$jscomp$3.RuntimeInit(ife);for(const c of this._layoutManager.GetAllLayouts())c._CreateGlobalNonWorlds();
this.IsExportToVideo()&&await this._InitExportToVideo();d=this._layoutManager.GetFirstLayout();await d._Load(null,this.GetRenderer());await d._StartRunning(!0);this._fpsLastTime=performance.now();a();this._usesLoaderLayout||this._OnLoadFinished();(await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking")).isSuspended&&!this.IsExportToVideo()?this._suspendCount++:this.Tick()}_OnLoadFinished(){this.Trigger(C3$jscomp$201.Plugins.System.Cnds.OnLoadFinished,null,null);this.PostComponentMessageToDOM("runtime",
"register-sw")}GetObjectReference(a){a=Math.floor(a);const b=this._objectReferenceTable;if(0>a||a>=b.length)throw Error("invalid object reference");return b[a]}_LoadJsPropNameTable(){for(const a of self.C3_JsPropNameTable){const b=C3$jscomp$201.first(Object.keys(a));this._jsPropNameTable.push(b)}}GetJsPropName(a){a=Math.floor(a);const b=this._jsPropNameTable;if(0>a||a>=b.length)throw Error("invalid prop reference");return b[a]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetRuntimeBaseURL(){return this._runtimeBaseUrl}GetPreviewURL(){return this._previewUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return 0===
this.GetCurrentEventStackFrame().GetConditionIndex()}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetAddonManager(){return this._addonManager}GetSystemPlugin(){return this._addonManager.GetSystemPlugin()}GetObjectClassByIndex(a){a=Math.floor(a);if(0>a||a>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[a]}GetObjectClassByName(a){return this._objectClassesByName.get(a.toLowerCase())||null}GetObjectClassBySID(a){return this._objectClassesBySid.get(a)||
null}GetSingleGlobalObjectClassByCtor(a){return(a=C3$jscomp$201.AddonManager.GetPluginByConstructorFunction(a))?a.GetSingleGlobalObjectClass():null}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(const a of this._allObjectClasses)a.IsFamily()||(yield*a.instances())}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(a){a.runtime=this.GetIRuntime();const b=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();
b&&C3Debugger$jscomp$3.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(a);b&&C3Debugger$jscomp$3.AddScriptTime()}DispatchUserScriptEventAsyncWait(a){a.runtime=this.GetIRuntime();return this._userScriptDispatcher.dispatchEventAndWaitAsync(a)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(a,b){if(this._originalViewportWidth!==a||this._originalViewportHeight!==b)this._originalViewportWidth=
a,this._originalViewportHeight=b,a=this.GetLayoutManager(),a.SetAllLayerProjectionChanged(),a.SetAllLayerMVChanged()}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(a,b){if(this._viewportWidth!==a||this._viewportHeight!==b)this._viewportWidth=a,this._viewportHeight=b,a=this.GetLayoutManager(),a.SetAllLayerProjectionChanged(),a.SetAllLayerMVChanged()}_SetDevicePixelRatio(a){this.IsExportToVideo()||(this._devicePixelRatio=a)}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){return this._canvasManager?
this._canvasManager.GetDrawWidth():this._viewportWidth}GetDrawHeight(){return this._canvasManager?this._canvasManager.GetDrawHeight():this._viewportHeight}GetRenderScale(){return this._canvasManager?this._canvasManager.GetRenderScale():1}GetDisplayScale(){return this._canvasManager?this._canvasManager.GetDisplayScale():1}GetEffectLayerScaleParam(){return this._canvasManager?this._canvasManager.GetEffectLayerScaleParam():1}GetEffectDevicePixelRatioParam(){return this._canvasManager?this._canvasManager.GetEffectDevicePixelRatioParam():
1}GetCanvasClientX(){return this._canvasManager?this._canvasManager.GetCanvasClientX():0}GetCanvasClientY(){return this._canvasManager?this._canvasManager.GetCanvasClientY():0}GetCanvasCssWidth(){return this._canvasManager?this._canvasManager.GetCssWidth():0}GetCanvasCssHeight(){return this._canvasManager?this._canvasManager.GetCssHeight():0}GetFullscreenMode(){return this._canvasManager?this._canvasManager.GetFullscreenMode():"off"}GetAdditionalRenderTarget(a){return this._canvasManager?this._canvasManager.GetAdditionalRenderTarget(a):
null}ReleaseAdditionalRenderTarget(a){this._canvasManager&&this._canvasManager.ReleaseAdditionalRenderTarget(a)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyCrossSampling(){return this._usesAnyCrossSampling}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){return this._canvasManager?this._canvasManager.GetGPUUtilisation():NaN}IsLinearSampling(){return"nearest"!==this.GetSampling()}GetFramerateMode(){return this._framerateMode}_SetFramerateMode(a){this._framerateMode!==
a&&(this._framerateMode=a,-1!==this._rafId||-1!==this._ruafId)&&(this._CancelAnimationFrame(),this._RequestAnimationFrame())}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){this._loadingLogoAsset&&(this._loadingLogoAsset.ReleaseTexture(),this._loadingLogoAsset.Release(),this._loadingLogoAsset=null)}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetTemplateManager(){return this._templateManager}GetFlowchartManager(){return this._flowchartManager}GetAssetManager(){return this._assetManager}LoadImage(a){return this._assetManager.LoadImage(a)}CreateInstance(a,
b,d,c,e,g){if(g&&this._templateManager){const k=this._templateManager.GetTemplateData(a,g);if(k)return a=this.CreateInstanceFromData(k,b,!1,d,c,!1,e,void 0,e),this._templateManager.MapInstanceToTemplateName(a,g),a}return this.CreateInstanceFromData(a,b,!1,d,c,!1,e,void 0,e)}CreateInstanceFromData(a,b,d,c,e,g,k,l,n){var p=null;let r=null;if(a instanceof C3$jscomp$201.ObjectClass){r=a;if(r.IsFamily()){a=r.GetFamilyMembers();var w=Math.floor(this.Random()*a.length);r=a[w]}p=r.GetDefaultInstanceData()}else p=
a,r=this.GetObjectClassByIndex(p[1]);var z=r.GetPlugin().IsWorldType();if(this._isLoading&&z&&!r.IsOnLoaderLayout())return null;const B=b;z||(b=null);var C=d&&!g&&p&&!this._instancesByUid.has(p[2])?p[2]:this._nextUid++;w=p?p[0]:null;a=C3$jscomp$201.New(C3$jscomp$201.Instance,{runtime:this,objectType:r,layer:b,worldData:w,instVarData:p?p[3]:null,uid:C});this._instancesByUid.set(C,a);C=null;z&&(C=a.GetWorldInfo(),"undefined"!==typeof c&&"undefined"!==typeof e&&(C.SetX(c),C.SetY(e)),r._SetAnyCollisionCellChanged(!0));
b&&(n||b._AddInstance(a,!0),1===b.GetParallaxX()&&1===b.GetParallaxY()||r._SetAnyInstanceParallaxed(!0),b.GetLayout().MaybeLoadTexturesFor(r));this._objectCount++;let E=!0;if(l){var F=l.GetObjectClass();F.IsInContainer()&&r.IsInContainer()&&(l=r.GetContainer(),F=F.GetContainer(),l===F&&(E=!1))}if(r.IsInContainer()&&!d&&!g&&E){for(var I of r.GetContainer().objectTypes())I!==r&&(l=this.CreateInstanceFromData(I,B,!1,C?C.GetX():c,C?C.GetY():e,!0,!1,void 0,n),a._AddSibling(l));for(var K of a.siblings()){K._AddSibling(a);
for(const O of a.siblings())K!==O&&K._AddSibling(O)}}z&&!d&&k&&this._CreateChildInstancesFromData(a,w,C,b,c,e,n);if(r.IsInContainer()&&!d&&!g&&k)for(const O of a.siblings())if(d=O.GetWorldInfo())I=O.GetPlugin(),K=O.GetObjectClass().GetDefaultInstanceData()[0],I.IsWorldType()?this._CreateChildInstancesFromData(O,K,d,b,d.GetX(),d.GetY(),n):this._CreateChildInstancesFromData(O,K,d,b,void 0,void 0,n);!g&&k&&("undefined"===typeof c&&(c=w[0]),"undefined"===typeof e&&(e=w[1]),b=C.GetTopParent(),c=c-C.GetX()+
b.GetX(),e=e-C.GetY()+b.GetY(),b.SetXY(c,e));r._SetIIDsStale();e=p?C3$jscomp$201.cloneArray(p[5]):null;p=p?p[4].map(O=>C3$jscomp$201.cloneArray(O)):null;(z=z&&w&&w[13])&&a._SetHasTilemap();a._CreateSdkInstance(e,p);z&&(w=w[13],a.GetSdkInstance().LoadTilemapData(w[2],w[0],w[1]));this._instancesPendingCreate.push(a);this._hasPendingInstances=!0;this.IsDebug()&&C3Debugger$jscomp$3.InstanceCreated(a);return a}_CreateChildInstancesFromData(a,b,d,c,e,g,k){var l=d.GetSceneGraphZIndexExportData(),n=d.GetSceneGraphChildrenExportData();
a.GetWorldInfo().SetSceneGraphZIndex(l);if(n){"undefined"===typeof e&&(e=b[0]);"undefined"===typeof g&&(g=b[1]);l=new Set;d=b[0];b=b[1];for(const C of n){var p=C[0],r=C[1],w=C[2];n=C[3];var z=!!C[4];const E=C[5];var B=C[6];r=B?B:this._layoutManager.GetLayoutBySID(p).GetLayer(r).GetInitialInstanceData(w);p=this.GetObjectClassByIndex(r[1]);w=a.HasSibling(p);B=l.has(p);w&&!B&&z?(z=a.GetSibling(p),z.GetWorldInfo().Init(r[0]),w=e+r[0][0]-d,r=g+r[0][1]-b,z.GetWorldInfo().SetXY(w,r),z.GetWorldInfo().SetSceneGraphZIndex(E),
a.AddChild(z,{transformX:!!(n>>0&1),transformY:!!(n>>1&1),transformWidth:!!(n>>2&1),transformHeight:!!(n>>3&1),transformAngle:!!(n>>4&1),destroyWithParent:!!(n>>5&1),transformZElevation:!!(n>>6&1),transformOpacity:!!(n>>7&1),transformVisibility:!!(n>>8&1)}),l.add(p)):(z=this.CreateInstanceFromData(r,c,!1,e+r[0][0]-d,g+r[0][1]-b,!1,!0,a,k),z.GetWorldInfo().SetSceneGraphZIndex(E),a.AddChild(z,{transformX:!!(n>>0&1),transformY:!!(n>>1&1),transformWidth:!!(n>>2&1),transformHeight:!!(n>>3&1),transformAngle:!!(n>>
4&1),destroyWithParent:!!(n>>5&1),transformZElevation:!!(n>>6&1),transformOpacity:!!(n>>7&1),transformVisibility:!!(n>>8&1)}))}}}DestroyInstance(a){if(!this._instancesPendingRelease.has(a)){var b=a.GetObjectClass(),d=this._instancesPendingDestroy.get(b);if(d){if(d.has(a))return;d.add(a)}else d=new Set,d.add(a),this._instancesPendingDestroy.set(b,d);this.IsDebug()&&C3Debugger$jscomp$3.InstanceDestroyed(a);a._MarkDestroyed();this._hasPendingInstances=!0;if(a.IsInContainer())for(const c of a.siblings())this.DestroyInstance(c);
for(const c of a.children())c.GetDestroyWithParent()&&this.DestroyInstance(c);this._layoutManager.IsEndingLayout()||this._isLoadingState||(b=this.GetEventSheetManager(),b.BlockFlushingInstances(!0),a._TriggerOnDestroyed(),b.BlockFlushingInstances(!1));a._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}}FlushPendingInstances(){this._hasPendingInstances&&(this._isFlushingPendingInstances=!0,this._FlushInstancesPendingCreate(),this._FlushInstancesPendingDestroy(),this._hasPendingInstances=
this._isFlushingPendingInstances=!1,this.UpdateRender())}_FlushInstancesPendingCreate(){for(const a of this._instancesPendingCreate){const b=a.GetObjectClass();b._AddInstance(a);for(const d of b.GetFamilies())d._AddInstance(a),d._SetIIDsStale()}C3$jscomp$201.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(!0);for(const [a,b]of this._instancesPendingDestroy.entries())this._FlushInstancesPendingDestroyForObjectClass(a,b),b.clear();
this._instancesPendingDestroy.clear();this._dispatcher.SetDelayRemoveEventsEnabled(!1)}_FlushInstancesPendingDestroyForObjectClass(a,b){for(const c of b){var d=this._eventObjects.instancedestroy;d.instance=c;this._dispatcher.dispatchEvent(d);this._instancesByUid.delete(c.GetUID());this._instanceTimes.delete(c);if(d=c.GetWorldInfo())d._RemoveFromCollisionCells(),d._RemoveFromRenderCells(),d._MarkDestroyed();this._instancesPendingRelease.add(c);this._objectCount--}C3$jscomp$201.arrayRemoveAllInSet(a.GetInstances(),
b);a._SetIIDsStale();this._instancesPendingReleaseAffectedObjectClasses.add(a);0===a.GetInstances().length&&a._SetAnyInstanceParallaxed(!1);for(const c of a.GetFamilies())C3$jscomp$201.arrayRemoveAllInSet(c.GetInstances(),b),c._SetIIDsStale(),this._instancesPendingReleaseAffectedObjectClasses.add(c);if(a.GetPlugin().IsWorldType()){a=new Set([...b].map(c=>c.GetWorldInfo().GetLayer()));for(const c of a)c._RemoveAllInstancesInSet(b)}}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(a){for(const b of this._GetInstancesPendingCreate())a.IsFamily()?
b.GetObjectClass().BelongsToFamily(a)&&(yield b):b.GetObjectClass()===a&&(yield b)}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(a,b){this._instancesByUid.set(a,b)}_OnRendererContextLost(){this._dispatcher.dispatchEvent(C3$jscomp$201.New(C3$jscomp$201.Event,"renderercontextlost"));this.SetSuspended(!0);for(var a of this._allObjectClasses)!a.IsFamily()&&a.HasLoadedTextures()&&a.ReleaseTextures();(a=this.GetMainRunningLayout())&&a._OnRendererContextLost();C3$jscomp$201.ImageInfo.OnRendererContextLost();
C3$jscomp$201.ImageAsset.OnRendererContextLost()}async _OnRendererContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetRenderer());this._dispatcher.dispatchEvent(C3$jscomp$201.New(C3$jscomp$201.Event,"renderercontextrestored"));this.SetSuspended(!1);this.UpdateRender()}_OnVisibilityChange(a){a=a.hidden;this.SetSuspended(a);a||this.UpdateRender()}_OnWindowBlur(a){this.IsPreview()&&this._pauseOnBlur&&!C3$jscomp$201.Platform.IsMobile&&!a.data.parentHasFocus&&(this.SetSuspended(!0),
this._isPausedOnBlur=!0)}_OnWindowFocus(){this._isPausedOnBlur&&(this.SetSuspended(!1),this._isPausedOnBlur=!1)}_RequestAnimationFrame(){const a=this._tickCallbacks;"vsync"===this._framerateMode?-1===this._rafId&&(this._rafId=self.requestAnimationFrame(a.normal)):"unlimited-tick"===this._framerateMode?(-1===this._ruafId&&(this._ruafId=C3$jscomp$201.RequestUnlimitedAnimationFrame(a.tickOnly)),-1===this._rafId&&(this._rafId=self.requestAnimationFrame(a.renderOnly))):-1===this._ruafId&&(this._ruafId=
C3$jscomp$201.RequestUnlimitedAnimationFrame(a.normal))}_CancelAnimationFrame(){-1!==this._rafId&&(self.cancelAnimationFrame(this._rafId),this._rafId=-1);-1!==this._ruafId&&(C3$jscomp$201.CancelUnlimitedAnimationFrame(this._ruafId),this._ruafId=-1)}IsSuspended(){return 0<this._suspendCount}SetSuspended(a){if(!this.IsExportToVideo()){var b=this.IsSuspended();this._suspendCount+=a?1:-1;0>this._suspendCount&&(this._suspendCount=0);a=this.IsSuspended();!b&&a?(console.log("[Construct] Suspending"),this._CancelAnimationFrame(),
this._dispatcher.dispatchEvent(C3$jscomp$201.New(C3$jscomp$201.Event,"suspend")),this.Trigger(C3$jscomp$201.Plugins.System.Cnds.OnSuspend,null,null)):b&&!a&&(console.log("[Construct] Resuming"),this._fpsLastTime=this._lastTickTime=b=performance.now(),this._mainThreadTimeCounter=this._mainThreadTime=this._tps=this._tpsTickCount=this._fps=this._fpsFrameCount=0,this._dispatcher.dispatchEvent(C3$jscomp$201.New(C3$jscomp$201.Event,"resume")),this.Trigger(C3$jscomp$201.Plugins.System.Cnds.OnResume,null,
null),this.HitBreakpoint()||this.Tick(b))}}_AddBehInstToTick(a){this._behInstsToTick.Add(a)}_AddBehInstToPostTick(a){this._behInstsToPostTick.Add(a)}_AddBehInstToTick2(a){this._behInstsToTick2.Add(a)}_RemoveBehInstToTick(a){this._behInstsToTick.Remove(a)}_RemoveBehInstToPostTick(a){this._behInstsToPostTick.Remove(a)}_RemoveBehInstToTick2(a){this._behInstsToTick2.Remove(a)}_BehaviorTick(){const a=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(!0);for(const b of this._behInstsToTick)b instanceof
a?b._tick():b.Tick();this._behInstsToTick.SetQueueingEnabled(!1)}_BehaviorPostTick(){const a=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(!0);for(const b of this._behInstsToPostTick)b instanceof a?b._postTick():b.PostTick();this._behInstsToPostTick.SetQueueingEnabled(!1)}_BehaviorTick2(){const a=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(!0);for(const b of this._behInstsToTick2)b instanceof a?b._tick2():b.Tick2();this._behInstsToTick2.SetQueueingEnabled(!1)}*_DebugBehaviorTick(){const a=
globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(!0);for(const b of this._behInstsToTick){let d;d=b instanceof a?b._tick():b.Tick();C3$jscomp$201.IsIterator(d)&&(yield*d)}this._behInstsToTick.SetQueueingEnabled(!1)}*_DebugBehaviorPostTick(){const a=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(!0);for(const b of this._behInstsToPostTick){let d;d=b instanceof a?b._postTick():b.PostTick();C3$jscomp$201.IsIterator(d)&&(yield*d)}this._behInstsToPostTick.SetQueueingEnabled(!1)}*_DebugBehaviorTick2(){const a=
globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(!0);for(const b of this._behInstsToTick2){let d;d=b instanceof a?b._tick2():b.Tick2();C3$jscomp$201.IsIterator(d)&&(yield*d)}this._behInstsToTick2.SetQueueingEnabled(!1)}async Tick(a,b,d){this._hasStartedTicking=!0;const c="background-wake"===d;d="background-wake"!==d&&"skip-render"!==d;var e=this.GetLayoutManager(),g=this.GetCanvasManager();if(this._hasStarted&&(!this.IsSuspended()||b||c)){b=performance.now();this._isInTick=
!0;this._MeasureDt(a||0);this._tpsTickCount++;this._ReleasePendingInstances();a=this.Step_BeforePreTick();this.IsDebugging()&&await a;a=this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects.pretick);a instanceof Promise&&await a;a=this.Step_AfterPreTick();this.IsDebugging()&&await a;this._NeedsHandleSaveOrLoad()&&await this._HandleSaveOrLoad();e.IsPendingChangeMainLayout()&&await this._MaybeChangeLayout();a=this.Step_RunEventsEtc();this.IsDebugging()&&await a;a=e.GetMainRunningLayout();
var k=a._GetPendingSetHTMLLayerCount();e=!1;-1!==k&&(a._ResetPendingHTMLLayerCount(),g.GetHTMLLayerCount()!==k&&(g=this.GetCanvasManager().SetHTMLLayerCount(k),this.IsInWorker()&&(e=!0,await g)));d&&this.Render();e&&this.PostComponentMessageToDOM("canvas","cleanup-html-layers");if(this.IsExportToVideo()&&(await this._ExportToVideoAddFrame(),this.GetGameTime()>=this.GetExportVideoDuration())){this._ExportToVideoFinish();return}this.IsSuspended()||c||this._RequestAnimationFrame();this._tickCount++;
this._tickCountNoSave++;this._isInTick=!1;this._mainThreadTimeCounter+=performance.now()-b}}async Step_BeforePreTick(){const a=this._eventSheetManager,b=this.IsDebug();this.FlushPendingInstances();a.BlockFlushingInstances(!0);this.PushCurrentLayout(this.GetMainRunningLayout());b&&C3Debugger$jscomp$3.StartMeasuringTime();this.IsDebugging()?await a.DebugRunScheduledWaits():a.RunScheduledWaits();b&&C3Debugger$jscomp$3.AddEventsTime();this.PopCurrentLayout();a.BlockFlushingInstances(!1);this.FlushPendingInstances();
a.BlockFlushingInstances(!0)}async Step_AfterPreTick(){const a=this.IsDebug(),b=this.IsDebugging(),d=this._dispatcher,c=this._eventObjects,e=this._userScriptEventObjects;a&&C3Debugger$jscomp$3.StartMeasuringTime();b?await this.DebugIterateAndBreak(this._DebugBehaviorTick()):this._BehaviorTick();b?await this.DebugIterateAndBreak(this._DebugBehaviorPostTick()):this._BehaviorPostTick();a&&C3Debugger$jscomp$3.AddBehaviorTickTime();a&&C3Debugger$jscomp$3.StartMeasuringTime();b?await this.DebugFireGeneratorEventAndBreak(c.tick):
d.dispatchEvent(c.tick);a&&C3Debugger$jscomp$3.AddPluginTickTime();this._eventSheetManager.BlockFlushingInstances(!1);this.DispatchUserScriptEvent(e.tick)}async Step_RunEventsEtc(){const a=this._eventSheetManager,b=this._dispatcher,d=this._eventObjects,c=this.IsDebug(),e=this.IsDebugging();c&&C3Debugger$jscomp$3.StartMeasuringTime();e?await a.DebugRunEvents(this._layoutManager):a.RunEvents(this._layoutManager);c&&C3Debugger$jscomp$3.AddEventsTime();this._collisionEngine.ClearRegisteredCollisions();
this._ReleasePendingInstances();this._isLayoutFirstTick=!1;a.BlockFlushingInstances(!0);c&&C3Debugger$jscomp$3.StartMeasuringTime();e?await this.DebugIterateAndBreak(this._DebugBehaviorTick2()):this._BehaviorTick2();c&&C3Debugger$jscomp$3.AddBehaviorTickTime();c&&C3Debugger$jscomp$3.StartMeasuringTime();e?await this.DebugFireGeneratorEventAndBreak(d.tick2):b.dispatchEvent(d.tick2);c&&C3Debugger$jscomp$3.AddPluginTickTime();a.BlockFlushingInstances(!1);e&&await a.RunQueuedDebugTriggersAsync()}_ReleasePendingInstances(){if(0!==
this._instancesPendingRelease.size){var a=this._dispatcher;a.SetDelayRemoveEventsEnabled(!0);for(const b of this._instancesPendingReleaseAffectedObjectClasses)b.GetSolStack().RemoveInstances(this._instancesPendingRelease);this._instancesPendingReleaseAffectedObjectClasses.clear();this._eventSheetManager.RemoveInstancesFromScheduledWaits(this._instancesPendingRelease);for(const b of this._instancesPendingRelease)b.Release();this._instancesPendingRelease.clear();a.SetDelayRemoveEventsEnabled(!1)}}async _MaybeChangeLayout(){const a=
this.GetLayoutManager();let b=0;for(;a.IsPendingChangeMainLayout()&&10>b++;)await this._DoChangeLayout(a.GetPendingChangeMainLayout())}_MeasureDt(a){let b=0;this.IsExportToVideo()?this._dt1=this._dtRaw=b=1/this.GetExportVideoFramerate():0!==this._lastTickTime&&(b=Math.max(a-this._lastTickTime,0)/1E3,.5<b&&(b=0),this._dtRaw=b,this._dt1=C3$jscomp$201.clamp(b,this._minDt,this._maxDt));this._lastTickTime=a;this._dt=this._dt1*this._timeScale;this._gameTime.Add(this._dt);this._gameTimeRaw.Add(b*this._timeScale);
this._wallTime.Add(this._dt1);for(const [d,c]of this._instanceTimes)c.Add(this._dt1*d.GetTimeScale());this._canvasManager&&this._canvasManager._UpdateTick();1E3<=a-this._fpsLastTime&&(this._fpsLastTime+=1E3,1E3<=a-this._fpsLastTime&&(this._fpsLastTime=a),this._fps=this._fpsFrameCount,this._fpsFrameCount=0,this._tps=this._tpsTickCount,this._tpsTickCount=0,this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1E3,1),this._mainThreadTimeCounter=0,this._canvasManager&&this._canvasManager._Update1sFrameRange(),
this._collisionEngine._Update1sStats(),this.IsDebug()&&C3Debugger$jscomp$3.Update1sPerfStats())}_SetTrackingInstanceTime(a,b){b?this._instanceTimes.has(a)||(b=C3$jscomp$201.New(C3$jscomp$201.KahanSum),b.Copy(this._gameTime),this._instanceTimes.set(a,b)):this._instanceTimes.delete(a)}_GetInstanceGameTime(a){return(a=this._instanceTimes.get(a))?a.Get():this.GetGameTime()}async _DoChangeLayout(a){const b=this._dispatcher,d=this.GetLayoutManager().GetMainRunningLayout();await d._StopRunning();d._Unload(a,
this.GetRenderer());d===a&&this._eventSheetManager.ClearAllScheduledWaits();this._collisionEngine.ClearRegisteredCollisions();this._ReleasePendingInstances();b.dispatchEvent(this._eventObjects.beforelayoutchange);C3$jscomp$201.Asyncify.SetHighThroughputMode(!0);await a._Load(d,this.GetRenderer());C3$jscomp$201.Asyncify.SetHighThroughputMode(!1);await a._StartRunning(!1);b.dispatchEvent(this._eventObjects.layoutchange);this.UpdateRender();this._isLayoutFirstTick=!0;this.FlushPendingInstances();this._ExportToVideoAddKeyframe()}UpdateRender(){this._needRender=
!0}GetWebGLRenderer(){return this._canvasManager?this._canvasManager.GetWebGLRenderer():null}GetWebGPURenderer(){return this._canvasManager?this._canvasManager.GetWebGPURenderer():null}GetRenderer(){return this._canvasManager?this._canvasManager.GetRenderer():null}Render(){const a=this._canvasManager;if(a&&!a.IsRendererContextLost()){var b=this.GetRenderer(),d=b.SupportsGPUProfiling(),c=d&&b.IsWebGL();d=d&&b.IsWebGPU();c&&b.CheckForQueryResults();if(this._needRender||this.IsExportToVideo()){var e=
this._layoutManager.GetMainRunningLayout();this._fpsFrameCount++;b.Start();var g=this.IsDebug();g&&C3Debugger$jscomp$3.StartMeasuringTime();this._needRender=!1;var k=null;c&&(k=a.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery(),b.StartQuery(k));c=null;d&&(c=b.StartFrameTiming(2*(1+e.GetLayerCount())),b.StartMeasuringRenderPassTime(0,1));this.Uses3DFeatures()&&"low"===a.GetCurrentFullscreenScalingQuality()?b.SetFixedSizeDepthBuffer(a.GetDrawWidth(),a.GetDrawHeight()):b.SetAutoSizeDepthBuffer();this._Render(this.GetRenderer(),
e);k&&b.EndQuery(k);d&&(b.StopMeasuringRenderPassTime(),this._canvasManager._AddWebGPUFrameTiming(c));b.Finish();g&&(C3Debugger$jscomp$3.AddDrawCallsTime(),C3Debugger$jscomp$3.UpdateInspectHighlight());a&&a._MaybeTakeSnapshot()}else b.IncrementFrameNumber()}}_NeedsHTMLLayerCompositing(a){return"low"===this.GetCanvasManager().GetCurrentFullscreenScalingQuality()||a.IsWebGL()&&(this.UsesAnyBackgroundBlending()||this.Uses3DFeatures())}_Render(a,b){a.SetTextureFillMode();a.SetAlphaBlend();a.SetColorRgba(1,
1,1,1);a.SetRenderTarget(null);a.SetTexture(null);a.SetDepthEnabled(this.Uses3DFeatures());this._NeedsHTMLLayerCompositing(a)&&b._MaybeStartDrawToOwnTexture(a);const d=b.GetHTMLLayerCount();for(let c=1;c<d;++c)b.DrawForHTMLLayerIndex(a,c),a.IsWebGPU()&&a.Restart();this._NeedsHTMLLayerCompositing(a)||b._MaybeStartDrawToOwnTexture(a);b.DrawMain(a)}Trigger(a,b,d){if(!this._hasStarted)return!1;var c=!this._isInTick&&!this._eventSheetManager.IsInTrigger();let e=0;c&&(e=performance.now());const g=this.IsDebug();
g&&this.SetDebuggingEnabled(!1);a=this._eventSheetManager._Trigger(this._layoutManager,a,b,d);c&&(c=performance.now()-e,this._mainThreadTimeCounter+=c,g&&C3Debugger$jscomp$3.AddTriggersTime(c));g&&this.SetDebuggingEnabled(!0);return a}DebugTrigger(a,b,d){if(!this.IsDebugging())return this.Trigger(a,b,d);if(this.HitBreakpoint())throw Error("called DebugTrigger() while stopped on breakpoint");if(!this._isInTick&&!this._eventSheetManager.IsInTrigger())throw Error("called DebugTrigger() outside of event code - use TriggerAsync() instead");
return this._eventSheetManager._DebugTrigger(this._layoutManager,a,b,d)}async TriggerAsync(a,b,d){if(!this.IsDebugging())return this.Trigger(a,b,d);if(!this._hasStarted)return!1;if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(a,b,d);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(a,b,d);const c=performance.now();a=this._eventSheetManager._DebugTrigger(this._layoutManager,a,b,d);for(b=a.next();!b.done;)await this.DebugBreak(b.value),b=a.next();this.IsSuspended()||
this._eventSheetManager.IsInTrigger()||(await this._eventSheetManager.RunQueuedDebugTriggersAsync(),this._hasStartedTicking&&!this._isInTick&&this._RequestAnimationFrame());this._mainThreadTimeCounter+=performance.now()-c;return b.value}FastTrigger(a,b,d){const c=this.IsDebug();c&&this.SetDebuggingEnabled(!1);a=this._eventSheetManager._FastTrigger(this._layoutManager,a,b,d);c&&this.SetDebuggingEnabled(!0);return a}DebugFastTrigger(a,b,d){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,
a,b,d)}ScheduleTriggers(a){return this._scheduleTriggersThrottle.Add(a)}PushCurrentLayout(a){this._currentLayoutStack.push(a)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){return this._currentLayoutStack.length?this._currentLayoutStack.at(-1):this.GetMainRunningLayout()}GetDt(a){return a&&-1!==a.GetTimeScale()?this._dt1*a.GetTimeScale():this._dt}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetDtRaw(){return this._dtRaw}GetTimeScale(){return this._timeScale}SetTimeScale(a){if(isNaN(a)||
0>a)a=0;this._timeScale=a}SetMinDt(a){this._minDt=Math.max(a,0)}GetMinDt(){return this._minDt}SetMaxDt(a){this._maxDt=Math.max(a,0)}GetMaxDt(){return this._maxDt}GetFramesPerSecond(){return this._fps}GetTicksPerSecond(){return this._tps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(a){if(this._isLoadingState)throw Error("cannot call while loading state - wait until afterload event");
return this._instancesByUid.get(a)||null}_RefreshUidMap(){this._instancesByUid.clear();for(const a of this._allObjectClasses)if(!a.IsFamily())for(const b of a.GetInstances())this._instancesByUid.set(b.GetUID(),b)}IsPreview(){return"preview"===this._exportType}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsCordova(){return"cordova"===this._exportType}IsAndroidWebView(){return"Android"===C3$jscomp$201.Platform.OS&&("cordova"===this._exportType||"playable-ad"===this._exportType||
"instant-games"===this._exportType)}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}IsWindowsWebView2(){return this._isWindowsWebView2}IsAnyWebView2Wrapper(){return this._isAnyWebView2Wrapper}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._addonManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._addonManager.GetJumpthruBehavior()}Uses3DFeatures(){return this._uses3dFeatures}GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight())}GetDefaultCameraZ(a){return this.GetRenderer().GetDefaultCameraZ(a||
this.GetViewportHeight())}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(a){a=!!a;this._isPixelRoundingEnabled!==a&&(this._isPixelRoundingEnabled=a,this.GetLayoutManager().SetAllLayerMVChanged(),this.UpdateRender())}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}GetTextIconSet(a){if(!this._iconChangeHandlers.has(a)){var b=()=>this.DeleteTextIconSet(a);this._iconChangeHandlers.set(a,b);a.Dispatcher().addEventListener("animationframeimagechange",b)}b=this._textIconManager.GetIconSet(a);
b.HasLoaded()||b.LoadContent().then(()=>this.UpdateRender());return b}DeleteTextIconSet(a){this._textIconManager.DeleteIconSet(a)}_GetTextIconSetMeta(a){const b=[];for(const d of a.GetAnimations())for(const c of d.GetFrames())a=c.GetImageInfo(),b.push({source:c,width:a.GetWidth(),height:a.GetHeight(),tag:c.GetTag()});return{icons:b}}async _GetTextIconSetContent(a){const b=C3$jscomp$201.New(C3$jscomp$201.PromiseThrottle);var d=[];const c=new Map;for(const e of a.GetAnimations())for(const g of e.GetFrames()){const k=
g.GetImageInfo().GetImageAsset();c.has(k)||(c.set(k,null),d.push(b.Add(async()=>{const l=await k.LoadToDrawable();c.set(k,l)})))}await Promise.all(d);d=[];for(const e of a.GetAnimations())for(const g of e.GetFrames())d.push(b.Add(async()=>{var k=g.GetImageInfo();const l=c.get(k.GetImageAsset());k=await k.ExtractImageToCanvas(l);return{drawable:await createImageBitmap(k)}}));a=await Promise.all(d);for(const e of c.values())e instanceof ImageBitmap&&e.close&&e.close();return{icons:a}}SaveToSlot(a){this._saveToSlotName=
a}LoadFromSlot(a){this._loadFromSlotName=a}LoadFromJsonString(a){this._loadFromJson=a}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!(!this._saveToSlotName&&!this._loadFromSlotName&&null===this._loadFromJson)}async _HandleSaveOrLoad(){this._saveToSlotName&&(this.FlushPendingInstances(),await this._DoSaveToSlot(this._saveToSlotName),this._ClearSaveOrLoad());this._loadFromSlotName&&(await this._DoLoadFromSlot(this._loadFromSlotName),this._ClearSaveOrLoad(),this.IsDebug()&&
C3Debugger$jscomp$3.StepIfPausedInDebugger());if(null!==this._loadFromJson){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson),this._lastSaveJson=this._loadFromJson,await this.TriggerAsync(C3$jscomp$201.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(a){console.error("[Construct] Failed to load state from JSON string: ",a),await this.TriggerAsync(C3$jscomp$201.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._loadFromSlotName=
this._saveToSlotName="";this._loadFromJson=null}_GetProjectStorage(){this._projectStorage||(this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()}));return this._projectStorage}_GetSavegamesStorage(){this._savegamesStorage||(this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()}));return this._savegamesStorage}async _DoSaveToSlot(a){const b=await this._SaveToJsonString();
try{await this._GetSavegamesStorage().setItem(a,b),console.log("[Construct] Saved state to storage ("+b.length+" chars)"),this._lastSaveJson=b,await this.TriggerAsync(C3$jscomp$201.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson=""}catch(d){console.error("[Construct] Failed to save state to storage: ",d),await this.TriggerAsync(C3$jscomp$201.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(a){try{const b=await this._GetSavegamesStorage().getItem(a);if(!b)throw Error("empty slot");
console.log("[Construct] Loaded state from storage ("+b.length+" chars)");await this._DoLoadFromJsonString(b);this._lastSaveJson=b;await this.TriggerAsync(C3$jscomp$201.Plugins.System.Cnds.OnLoadComplete,null);this._lastSaveJson=""}catch(b){console.error("[Construct] Failed to load state from storage: ",b),await this.TriggerAsync(C3$jscomp$201.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){const a={c3save:!0,version:1,rt:{time:this.GetGameTime(),timeRaw:this.GetGameTimeRaw(),walltime:this.GetWallTime(),
timescale:this.GetTimeScale(),tickcount:this.GetTickCount(),next_uid:this._nextUid,running_layout:this.GetMainRunningLayout().GetSID(),start_time_offset:Date.now()-this._startTime},types:{},layouts:{},events:this._eventSheetManager._SaveToJson(),timelines:this._timelineManager._SaveToJson(),user_script_data:null};for(var b of this._allObjectClasses)b.IsFamily()||b.HasNoSaveBehavior()||(a.types[b.GetSID().toString()]=b._SaveToJson());for(const d of this._layoutManager.GetAllLayouts())a.layouts[d.GetSID().toString()]=
d._SaveToJson();b=this._CreateUserScriptEvent("save");b.saveData=null;await this.DispatchUserScriptEventAsyncWait(b);a.user_script_data=b.saveData;return JSON.stringify(a)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(a){var b=this.GetLayoutManager();a=JSON.parse(a);if(a.c2save)throw Error("C2 saves are incompatible with C3 runtime");if(!a.c3save)throw Error("not valid C3 save data");if(1<a.version)throw Error("C3 save data from future version");this.ClearIntancesNeedingAfterLoad();
this._dispatcher.dispatchEvent(C3$jscomp$201.New(C3$jscomp$201.Event,"beforeload"));for(var d of this.allInstances())d.GetObjectClass().HasNoSaveBehavior()||d._OnBeforeLoad();d=a.rt;this._gameTime.Set(d.time);d.hasOwnProperty("timeRaw")&&this._gameTimeRaw.Set(d.timeRaw);this._wallTime.Set(d.walltime);this._timeScale=d.timescale;this._tickCount=d.tickcount;this._startTime=Date.now()-d.start_time_offset;var c=d.running_layout;this._isLoadingState=!0;var e=!1;if(c!==this.GetMainRunningLayout().GetSID())if(e=
b.GetLayoutBySID(c))await this._DoChangeLayout(e),e=!0;else return;for(const [l,n]of Object.entries(a.layouts))c=parseInt(l,10),(c=b.GetLayoutBySID(c))&&c._LoadFromJson(n);for(const [l,n]of Object.entries(a.types))c=parseInt(l,10),c=this.GetObjectClassBySID(c),!c||c.IsFamily()||c.HasNoSaveBehavior()||c._LoadFromJson(n);for(var g of this._layoutManager.GetAllLayouts())for(const l of g.allLayers())l._LoadFromJsonAfterInstances();this.FlushPendingInstances();this._RefreshUidMap();this._isLoadingState=
!1;if(e){for(const l of this.allInstances())l.SetupInitialSceneGraphConnections();for(const [l,n]of Object.entries(a.types))g=parseInt(l,10),g=this.GetObjectClassBySID(g),!g||g.IsFamily()||g.HasNoSaveBehavior()||g._SetupSceneGraphConnectionsOnChangeOfLayout(n)}this._nextUid=d.next_uid;this._eventSheetManager._LoadFromJson(a.events);for(const l of this._allObjectClasses)if(!l.IsFamily()&&l.IsInContainer())for(const n of l.GetInstances()){d=n.GetIID();for(const p of l.GetContainer().objectTypes())if(p!==
l){g=p.GetInstances();if(0>d||d>=g.length)throw Error("missing sibling instance");n._AddSibling(g[d])}}this._timelineManager._LoadFromJson(a.timelines);b.SetAllLayerProjectionChanged();b.SetAllLayerMVChanged();this._dispatcher.dispatchEvent(C3$jscomp$201.New(C3$jscomp$201.Event,"afterload"));this.DispatchUserScriptEvent(this._CreateUserScriptEvent("afterload"));this.DoAfterLoad();for(var [k]of Object.entries(a.types))b=parseInt(k,10),(b=this.GetObjectClassBySID(b))&&b._ClearLoadInstancesJson();k=
this._CreateUserScriptEvent("load");k.saveData=a.user_script_data;await this.DispatchUserScriptEventAsyncWait(k);this.UpdateRender()}SortOnTmpHierarchyPosition(a,b){return a.GetWorldInfo().GetTmpHierarchyPosition()-b.GetWorldInfo().GetTmpHierarchyPosition()}AddInstanceNeedingAfterLoad(a,b){a.GetWorldInfo()&&(this._instancesNeedingAfterLoadMap.set(a,b),this._instancesNeedingAfterLoadArray.push(a))}ClearIntancesNeedingAfterLoad(){this._instancesNeedingAfterLoadMap=new WeakMap;C3$jscomp$201.clearArray(this._instancesNeedingAfterLoadArray)}DoAfterLoad(a=
"full",b=null){this._instancesNeedingAfterLoadArray.sort(this.SortOnTmpHierarchyPosition);for(const d of this._instancesNeedingAfterLoadArray)d._OnAfterLoad(this._instancesNeedingAfterLoadMap.get(d),a,b);for(const d of this._instancesNeedingAfterLoadArray)d._OnAfterLoad2(this._instancesNeedingAfterLoadMap.get(d),a,b);this.ClearIntancesNeedingAfterLoad()}async AddJobWorkerScripts(a){a=await Promise.all(a.map(async b=>{const d=C3$jscomp$201.IsAbsoluteURL(b)&&(new URL(b)).origin!==location.origin,c=
this.IsCordova()&&this._assetManager.IsFileProtocol();return d||c||this.IsPreview()||"playable-ad"===this.GetExportType()?(b=await this._assetManager.FetchBlob(b),URL.createObjectURL(b)):C3$jscomp$201.IsRelativeURL(b)?(new URL(b,this._runtimeBaseUrl)).toString():b}));this._jobScheduler.ImportScriptsToJobWorkers(a)}AddJobWorkerBlob(a,b){this._jobScheduler.SendBlobToJobWorkers(a,b)}AddJobWorkerBuffer(a,b){this._jobScheduler.SendBufferToJobWorkers(a,b)}AddJob(a,b,d,c){return this._jobScheduler.AddJob(a,
b,d,null,null,c)}BroadcastJob(a,b,d,c){return this._jobScheduler.BroadcastJob(a,b,d,c)}GetMaxNumJobWorkers(){return this._jobScheduler.GetMaxNumWorkers()}InvokeDownload(a,b){this.PostComponentMessageToDOM("runtime","invoke-download",{url:a,filename:b})}async RasterSvgImage(a,b,d,c,e,g){c=c||b;e=e||d;if(this.IsInWorker())return(await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{blob:a,imageWidth:b,imageHeight:d,surfaceWidth:c,surfaceHeight:e,imageBitmapOpts:g})).imageBitmap;a=
await self.C3_RasterSvgImageBlob(a,b,d,c,e);return g?await self.createImageBitmap(a,g):a}async GetSvgImageSize(a){return this.IsInWorker()?await this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{blob:a}):await self.C3_GetSvgImageSize(a)}RequestDeviceOrientationEvent(){this._didRequestDeviceOrientationEvent||(this._didRequestDeviceOrientationEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-orientation"))}RequestDeviceMotionEvent(){this._didRequestDeviceMotionEvent||
(this._didRequestDeviceMotionEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-motion"))}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(a){this._randomNumberCallback=a}_GetRemotePreviewStatusInfo(){const a=this.GetRenderer();return{fps:this.GetFramesPerSecond(),tps:this.GetTicksPerSecond(),cpu:this.GetMainThreadTime(),gpu:this.GetGPUUtilisation(),layout:this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"",renderer:a.IsWebGL()?a.GetUnmaskedRenderer():
a.GetAdapterInfoString()}}HitBreakpoint(){return this.IsDebug()?C3Debugger$jscomp$3.HitBreakpoint():!1}DebugBreak(a){return this.IsDebugging()?C3Debugger$jscomp$3.DebugBreak(a):Promise.resolve()}DebugBreakNext(){return this.IsDebugging()?C3Debugger$jscomp$3.BreakNext():!1}SetDebugBreakpointsEnabled(a){this._breakpointsEnabled=!!a;this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(a){a?this._debuggingDisabled--:
this._debuggingDisabled++;this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&0===this._debuggingDisabled}IsCPUProfiling(){return this.IsDebug()&&C3Debugger$jscomp$3.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&C3Debugger$jscomp$3.IsGPUProfiling()}async DebugIterateAndBreak(a){if(a)for(const b of a)await this.DebugBreak(b)}DebugFireGeneratorEventAndBreak(a){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(a))}_InvokeFunctionFromJS(a){return this._eventSheetManager._InvokeFunctionFromJS(a.name,
a.params)}_GetHTMLLayerWrapElement(a){if(this.IsInWorker())throw Error("not supported in worker mode");return self.c3_runtimeInterface._GetHTMLWrapElement(a)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(a){a=C3$jscomp$201.New(C3$jscomp$201.Event,a,!1);a.runtime=this._iRuntime;return a}_InitScriptInterfaces(){this._iRuntime=new self.IRuntime(this);this._userScriptEventObjects={tick:this._CreateUserScriptEvent("tick")}}_InitObjectsScriptInterface(){const a={};for(const b of this._allObjectClasses)a[b.GetJsPropName()]=
{value:b.GetIObjectClass(),enumerable:!0,writable:!1};this._iRuntime._InitObjects(a)}_InitGlobalVariableScriptInterface(){const a={};for(const b of this.GetEventSheetManager().GetAllGlobalVariables())a[b.GetJsPropName()]=b._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(a)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(a,b){this._interfaceMap.set(a,b)}_UnwrapScriptInterface(a){return this._interfaceMap.get(a)}_UnwrapIObjectClass(a){if(!(a instanceof
self.IObjectClass))throw new TypeError("expected IObjectClass");a=this._UnwrapScriptInterface(a);if(!(a&&a instanceof C3$jscomp$201.ObjectClass))throw Error("invalid IObjectClass");return a}_UnwrapIInstance(a){if(!(a instanceof self.IInstance))throw new TypeError("expected IInstance");a=this._UnwrapScriptInterface(a);if(!(a&&a instanceof C3$jscomp$201.Instance))throw Error("invalid IInstance");return a}_UnwrapIWorldInstance(a){if(!(a instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");
a=this._UnwrapScriptInterface(a);if(!(a&&a instanceof C3$jscomp$201.Instance))throw Error("invalid IInstance");return a}};self.C3_CreateRuntime=C3$jscomp$201.Runtime.Create;self.C3_InitRuntime=(a,b)=>a.Init(b);"use strict";const C3$jscomp$202=self.C3;
C3$jscomp$202.JobSchedulerRuntime=class extends C3$jscomp$202.DefendedBase{constructor(a,b){super();this._runtime=a;this._jobPromises=new Map;this._nextJobId=0;this._inputPort=b.inputPort;b.outputPort.onmessage=d=>this._OnJobWorkerMessage(d);this._maxNumWorkers=b.maxNumWorkers;this._jobWorkerCount=1;this._hadErrorCreatingWorker=this._isCreatingWorker=!1}async Init(){}GetMaxNumWorkers(){return this._maxNumWorkers}ImportScriptsToJobWorkers(a){this._inputPort.postMessage({type:"_import_scripts",scripts:a})}SendBlobToJobWorkers(a,
b){this._inputPort.postMessage({type:"_send_blob",blob:a,id:b})}SendBufferToJobWorkers(a,b){this._inputPort.postMessage({type:"_send_buffer",buffer:a,id:b},[a])}AddJob(a,b,d,c,e,g){d||(d=[]);if("number"===typeof g&&(g=Math.floor(g),0>=g))throw Error("invalid maxWorkerNum");const k=this._nextJobId++;a={type:a,isBroadcast:!1,maxWorkerNum:g,jobId:k,params:b,transferables:d};b=new Promise((l,n)=>{this._jobPromises.set(k,{resolve:l,progress:c,reject:n,cancelled:!1,maxWorkerNum:g})});e&&e.SetAction(()=>
this._CancelJob(k));this._inputPort.postMessage(a,d);this._MaybeCreateExtraWorker();return b}BroadcastJob(a,b,d,c){d||(d=[]);if("number"===typeof c&&(c=Math.floor(c),0>=c))throw Error("invalid maxWorkerNum");const e=this._nextJobId++;this._inputPort.postMessage({type:a,isBroadcast:!0,maxWorkerNum:c,jobId:e,params:b,transferables:d},d)}_CancelJob(a){const b=this._jobPromises.get(a);b&&(b.cancelled=!0,b.resolve=null,b.progress=null,b.reject=null,this._inputPort.postMessage({type:"_cancel",jobId:a}))}_OnJobWorkerMessage(a){a=
a.data;const b=a.type,d=a.jobId;switch(b){case "result":this._OnJobResult(d,a.result);break;case "progress":this._OnJobProgress(d,a.progress);break;case "error":this._OnJobError(d,a.error);break;case "ready":this._OnJobWorkerReady();break;default:throw Error(`unknown message from worker '${b}'`);}}_OnJobResult(a,b){const d=this._jobPromises.get(a);if(!d)throw Error("invalid job ID");d.cancelled||d.resolve(b);this._jobPromises.delete(a)}_OnJobProgress(a,b){a=this._jobPromises.get(a);if(!a)throw Error("invalid job ID");
!a.cancelled&&a.progress&&a.progress(b)}_OnJobError(a,b){const d=this._jobPromises.get(a);if(!d)throw Error("invalid job ID");d.cancelled||d.reject(b);this._jobPromises.delete(a)}_OnJobWorkerReady(){this._isCreatingWorker&&(this._isCreatingWorker=!1,this._jobWorkerCount++,this._jobWorkerCount<this._maxNumWorkers?this._MaybeCreateExtraWorker():this._inputPort.postMessage({type:"_no_more_workers"}))}_GetWorkerCountNeededForPendingJobs(){let a=0;const b=[...this._jobPromises.values()].sort((d,c)=>(d.maxWorkerNum||
Infinity)-(c.maxWorkerNum||Infinity));for(const d of b)a<(d.maxWorkerNum||Infinity)&&a++;return a}async _MaybeCreateExtraWorker(){if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._GetWorkerCountNeededForPendingJobs()<=this._jobWorkerCount))try{this._isCreatingWorker=!0,(await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker")).outputPort.onmessage=a=>this._OnJobWorkerMessage(a)}catch(a){this._hadErrorCreatingWorker=
!0,this._isCreatingWorker=!1,console.error(`[Construct] Failed to create job worker; stopping creating any more (created ${this._jobWorkerCount} so far)`,a)}}};self.C3_Shaders={};"use strict";const C3$jscomp$203=self.C3;let cacheRegex=null,lastRegex="",lastFlags="",regexMatches=[],lastMatchesStr="",lastMatchesRegex="",lastMatchesFlags="";const forEachStack=C3$jscomp$203.New(C3$jscomp$203.ArrayStack);
function ForEachOrdered_SortInstances(a,b){a=a[1];b=b[1];if("number"===typeof a&&"number"===typeof b)return a-b;a=""+a;b=""+b;return a<b?-1:a>b?1:0}
C3$jscomp$203.Plugins.System=class extends C3$jscomp$203.SDKPluginBase{constructor(a){super(a);this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack();this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._imagesLoadingComplete=this._imagesLoadingTotal=0;this._functionMaps=new Map;this._signalTags=[]}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(a){this._runtime.Trigger(a,null,null)}GetRegex(a,b){cacheRegex&&a===lastRegex&&b===lastFlags||
(cacheRegex=new RegExp(a,b),lastRegex=a,lastFlags=b);cacheRegex.lastIndex=0;return cacheRegex}GetRegexMatches(a,b,d){if(a===lastMatchesStr&&b===lastMatchesRegex&&d===lastMatchesFlags)return regexMatches;const c=this.GetRegex(b,d);regexMatches=a.match(c);lastMatchesStr=a;lastMatchesRegex=b;lastMatchesFlags=d;return regexMatches}async _LoadTexturesForObjectClasses(a,b){if(b.length){this._imagesLoadingTotal+=b.length;var d=[];for(const c of b)d.push(a.MaybeLoadTexturesFor(c));await C3$jscomp$203.PromiseAllWithProgress(d,
()=>{this._imagesLoadingComplete++});this._imagesLoadingComplete++;this._imagesLoadingComplete===this._imagesLoadingTotal&&(this._imagesLoadingTotal=this._imagesLoadingComplete=0,this._runtime.Trigger(C3$jscomp$203.Plugins.System.Cnds.OnImageLoadingComplete,null,null))}}_UnloadTexturesForObjectClasses(a,b){for(const d of b)0===d.GetInstanceCount()&&a.MaybeUnloadTexturesFor(d)}_GetForEachStack(){return forEachStack}_Repeat(a){var b=this._runtime.GetEventSheetManager();const d=b.GetEventStack(),c=d.GetCurrentStackFrame(),
e=c.GetCurrentEvent(),g=e.GetSolModifiers();var k=c.IsSolModifierAfterCnds();const l=d.Push(e),n=b.GetLoopStack(),p=n.Push();p.SetEnd(a);if(k)for(k=0;k<a&&!p.IsStopped();++k)b.PushCopySol(g),p.SetIndex(k),e.Retrigger(c,l),b.PopSol(g);else for(b=0;b<a&&!p.IsStopped();++b)p.SetIndex(b),e.Retrigger(c,l);d.Pop();n.Pop();return!1}*_DebugRepeat(a){var b=this._runtime.GetEventSheetManager();const d=b.GetEventStack(),c=d.GetCurrentStackFrame(),e=c.GetCurrentEvent(),g=e.GetSolModifiers();var k=c.IsSolModifierAfterCnds();
const l=d.Push(e),n=b.GetLoopStack(),p=n.Push();p.SetEnd(a);if(k)for(k=0;k<a&&!p.IsStopped();++k)b.PushCopySol(g),p.SetIndex(k),yield*e.DebugRetrigger(c,l),b.PopSol(g);else for(b=0;b<a&&!p.IsStopped();++b)p.SetIndex(b),yield*e.DebugRetrigger(c,l);d.Pop();n.Pop();return!1}_While(){var a=this._runtime.GetEventSheetManager();const b=a.GetEventStack(),d=b.GetCurrentStackFrame(),c=d.GetCurrentEvent(),e=c.GetSolModifiers();var g=d.IsSolModifierAfterCnds();const k=b.Push(c),l=a.GetLoopStack(),n=l.Push();
if(g)for(g=0;!n.IsStopped();++g)a.PushCopySol(e),n.SetIndex(g),c.Retrigger(d,k)||n.Stop(),a.PopSol(e);else for(a=0;!n.IsStopped();++a)n.SetIndex(a),c.Retrigger(d,k)||n.Stop();b.Pop();l.Pop();return!1}*_DebugWhile(){var a=this._runtime.GetEventSheetManager();const b=a.GetEventStack(),d=b.GetCurrentStackFrame(),c=d.GetCurrentEvent(),e=c.GetSolModifiers();var g=d.IsSolModifierAfterCnds();const k=b.Push(c),l=a.GetLoopStack(),n=l.Push();if(g)for(g=0;!n.IsStopped();++g)a.PushCopySol(e),n.SetIndex(g),(yield*c.DebugRetrigger(d,
k))||n.Stop(),a.PopSol(e);else for(a=0;!n.IsStopped();++a)n.SetIndex(a),(yield*c.DebugRetrigger(d,k))||n.Stop();b.Pop();l.Pop();return!1}_For(a,b,d){var c=this._runtime.GetEventSheetManager();const e=c.GetEventStack(),g=e.GetCurrentStackFrame(),k=g.GetCurrentEvent(),l=k.GetSolModifiers(),n=g.IsSolModifierAfterCnds(),p=e.Push(k),r=c.GetLoopStack(),w=r.Push();w.SetName(a);w.SetEnd(d);if(d<b)if(n)for(a=b;a>=d&&!w.IsStopped();--a)c.PushCopySol(l),w.SetIndex(a),k.Retrigger(g,p),c.PopSol(l);else for(c=
b;c>=d&&!w.IsStopped();--c)w.SetIndex(c),k.Retrigger(g,p);else if(n)for(a=b;a<=d&&!w.IsStopped();++a)c.PushCopySol(l),w.SetIndex(a),k.Retrigger(g,p),c.PopSol(l);else for(c=b;c<=d&&!w.IsStopped();++c)w.SetIndex(c),k.Retrigger(g,p);e.Pop();r.Pop();return!1}*_DebugFor(a,b,d){var c=this._runtime.GetEventSheetManager();const e=c.GetEventStack(),g=e.GetCurrentStackFrame(),k=g.GetCurrentEvent(),l=k.GetSolModifiers(),n=g.IsSolModifierAfterCnds(),p=e.Push(k),r=c.GetLoopStack(),w=r.Push();w.SetName(a);w.SetEnd(d);
if(d<b)if(n)for(a=b;a>=d&&!w.IsStopped();--a)c.PushCopySol(l),w.SetIndex(a),yield*k.DebugRetrigger(g,p),c.PopSol(l);else for(c=b;c>=d&&!w.IsStopped();--c)w.SetIndex(c),yield*k.DebugRetrigger(g,p);else if(n)for(a=b;a<=d&&!w.IsStopped();++a)c.PushCopySol(l),w.SetIndex(a),yield*k.DebugRetrigger(g,p),c.PopSol(l);else for(c=b;c<=d&&!w.IsStopped();++c)w.SetIndex(c),yield*k.DebugRetrigger(g,p);e.Pop();r.Pop();return!1}_ForEach(a){var b=a.GetCurrentSol();const d=b.GetInstances();if(0===d.length)return!1;
var c=this._runtime.GetEventSheetManager();const e=c.GetEventStack(),g=e.GetCurrentStackFrame(),k=g.GetCurrentEvent(),l=k.GetSolModifiers(),n=g.IsSolModifierAfterCnds(),p=e.Push(k),r=c.GetLoopStack(),w=r.Push(),z=a.IsInContainer(),B=forEachStack.Push();C3$jscomp$203.shallowAssignArray(B,d);w.SetEnd(B.length);if(n)for(let C=0,E=B.length;C<E&&!w.IsStopped();++C)c.PushCopySol(l),b=B[C],a.GetCurrentSol().SetSinglePicked(b),z&&b.SetSiblingsSinglePicked(),w.SetIndex(C),k.Retrigger(g,p),c.PopSol(l);else{b._SetSelectAll(!1);
a=b._GetOwnInstances();C3$jscomp$203.clearArray(a);a.push(null);for(let C=0,E=B.length;C<E&&!w.IsStopped();++C)c=B[C],a[0]=c,z&&c.SetSiblingsSinglePicked(),w.SetIndex(C),k.Retrigger(g,p)}e.Pop();r.Pop();C3$jscomp$203.clearArray(B);forEachStack.Pop();return!1}*_DebugForEach(a){var b=a.GetCurrentSol();const d=b.GetInstances();if(0===d.length)return!1;var c=this._runtime.GetEventSheetManager();const e=c.GetEventStack(),g=e.GetCurrentStackFrame(),k=g.GetCurrentEvent(),l=k.GetSolModifiers(),n=g.IsSolModifierAfterCnds(),
p=e.Push(k),r=c.GetLoopStack(),w=r.Push(),z=a.IsInContainer(),B=forEachStack.Push();C3$jscomp$203.shallowAssignArray(B,d);w.SetEnd(B.length);if(n)for(let C=0,E=B.length;C<E&&!w.IsStopped();++C)c.PushCopySol(l),b=B[C],a.GetCurrentSol().SetSinglePicked(b),z&&b.SetSiblingsSinglePicked(),w.SetIndex(C),yield*k.DebugRetrigger(g,p),c.PopSol(l);else{b._SetSelectAll(!1);a=b._GetOwnInstances();C3$jscomp$203.clearArray(a);a.push(null);for(let C=0,E=B.length;C<E&&!w.IsStopped();++C)c=B[C],a[0]=c,z&&c.SetSiblingsSinglePicked(),
w.SetIndex(C),yield*k.DebugRetrigger(g,p)}e.Pop();r.Pop();C3$jscomp$203.clearArray(B);forEachStack.Pop();return!1}_ForEachOrdered(a,b){const d=a.GetCurrentSol(),c=d.GetInstances();if(0===c.length)return!1;var e=this._runtime.GetEventSheetManager();const g=e.GetEventStack(),k=e.GetCurrentCondition(),l=g.GetCurrentStackFrame(),n=l.GetCurrentEvent(),p=n.GetSolModifiers(),r=l.IsSolModifierAfterCnds(),w=g.Push(n),z=e.GetLoopStack(),B=z.Push(),C=a.IsInContainer(),E=forEachStack.Push();C3$jscomp$203.clearArray(E);
B.SetEnd(c.length);for(let F=0,I=c.length;F<I;++F)E.push([c[F],k.ReevaluateParameter(1,F)]);E.sort(ForEachOrdered_SortInstances);1===b&&E.reverse();if(r)for(let F=0,I=E.length;F<I&&!B.IsStopped();++F)e.PushCopySol(p),b=E[F][0],a.GetCurrentSol().SetSinglePicked(b),C&&b.SetSiblingsSinglePicked(),B.SetIndex(F),n.Retrigger(l,w),e.PopSol(p);else{d._SetSelectAll(!1);a=d._GetOwnInstances();C3$jscomp$203.clearArray(a);a.push(null);for(let F=0,I=E.length;F<I&&!B.IsStopped();++F)e=E[F][0],a[0]=e,C&&e.SetSiblingsSinglePicked(),
B.SetIndex(F),n.Retrigger(l,w)}g.Pop();z.Pop();C3$jscomp$203.clearArray(E);forEachStack.Pop();return!1}*_DebugForEachOrdered(a,b){const d=a.GetCurrentSol(),c=d.GetInstances();if(0===c.length)return!1;var e=this._runtime.GetEventSheetManager();const g=e.GetEventStack(),k=e.GetCurrentCondition(),l=g.GetCurrentStackFrame(),n=l.GetCurrentEvent(),p=n.GetSolModifiers(),r=l.IsSolModifierAfterCnds(),w=g.Push(n),z=e.GetLoopStack(),B=z.Push(),C=a.IsInContainer(),E=forEachStack.Push();C3$jscomp$203.clearArray(E);
B.SetEnd(c.length);for(let F=0,I=c.length;F<I;++F)E.push([c[F],k.ReevaluateParameter(1,F)]);E.sort(ForEachOrdered_SortInstances);1===b&&E.reverse();if(r)for(let F=0,I=E.length;F<I&&!B.IsStopped();++F)e.PushCopySol(p),b=E[F][0],a.GetCurrentSol().SetSinglePicked(b),C&&b.SetSiblingsSinglePicked(),B.SetIndex(F),yield*n.DebugRetrigger(l,w),e.PopSol(p);else{d._SetSelectAll(!1);a=d._GetOwnInstances();C3$jscomp$203.clearArray(a);a.push(null);for(let F=0,I=E.length;F<I&&!B.IsStopped();++F)e=E[F][0],a[0]=e,
C&&e.SetSiblingsSinglePicked(),B.SetIndex(F),yield*n.DebugRetrigger(l,w)}g.Pop();z.Pop();C3$jscomp$203.clearArray(E);forEachStack.Pop();return!1}_GetFunctionMap(a,b){let d=this._functionMaps.get(a);if(d)return d;if(!b)return null;d={defaultFunc:null,strMap:new Map};this._functionMaps.set(a,d);return d}_DoCallMappedFunction(a,b,d,c,e){b.GetEventBlock().RunAsMappedFunctionCall(d,b.IsCopyPicked());c&&a.PopSol(e)}*_DebugDoCallMappedFunction(a,b,d,c,e){yield*b.GetEventBlock().DebugRunAsMappedFunctionCall(d,
b.IsCopyPicked());c&&a.PopSol(e)}};const C3$jscomp$204=self.C3;C3$jscomp$204.Plugins.System.Type=class extends C3$jscomp$204.DefendedBase{constructor(a){super();this._objectClass=a;this._runtime=a.GetRuntime();this._plugin=a.GetPlugin()}OnCreate(){}Release(){this._plugin=this._runtime=this._objectClass=null}};const C3$jscomp$205=self.C3;
C3$jscomp$205.Plugins.System.Instance=class extends C3$jscomp$205.DefendedBase{constructor(a,b){super();this._inst=a;this._objectClass=this._inst.GetObjectClass();this._sdkType=this._objectClass.GetSdkType();this._runtime=this._inst.GetRuntime()}Release(){this._runtime=this._sdkType=this._objectClass=this._inst=null}};const C3$jscomp$206=self.C3,tmpPickArray=[];
C3$jscomp$206.Plugins.System.Cnds={EveryTick(){return!0},OnLayoutStart(){return!0},OnLayoutEnd(){return!0},OnSuspend(){return!0},OnResume(){return!0},IsSuspended(){return this._runtime.IsSuspended()},Else(){const a=this._runtime.GetCurrentEventStackFrame();return a.GetElseBranchRan()?!1:!a.GetLastEventTrue()},TriggerOnce(){const a=this._runtime.GetCurrentCondition().GetSavedDataMap();let b=a.get("TriggerOnce_lastTick");"undefined"===typeof b&&(b=-1,a.set("TriggerOnce_lastTick",-1));const d=this._runtime.GetTickCount();
a.set("TriggerOnce_lastTick",d);return this._runtime.IsLayoutFirstTick()||b!==d-1},Every(a){const b=this._runtime.GetCurrentCondition().GetSavedDataMap(),d=b.get("Every_lastTime")||0,c=this._runtime.GetGameTime();b.has("Every_seconds")||b.set("Every_seconds",a);const e=b.get("Every_seconds");if(c>=d+e)return b.set("Every_lastTime",d+e),c>=b.get("Every_lastTime")+.04&&b.set("Every_lastTime",c),b.set("Every_seconds",a),!0;c<d-.1&&b.set("Every_lastTime",c);return!1},IsGroupActive(a){return(a=this._runtime.GetEventSheetManager().GetEventGroupByName(a))&&
a.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile(){return C3$jscomp$206.Platform.IsMobile},OnLoadFinished(){return!0},OnCanvasSnapshot(){return!0},EffectsSupported(){return!0},OnSaveComplete(){return!0},OnSaveFailed(){return!0},OnLoadComplete(){return!0},OnLoadFailed(){return!0},ObjectUIDExists(a){return!!this._runtime.GetInstanceByUID(a)},IsOnPlatform(a){switch(a){case 0:return"browser"===C3$jscomp$206.Platform.Context;case 1:return"iOS"===C3$jscomp$206.Platform.OS;case 2:return"Android"===
C3$jscomp$206.Platform.OS;case 8:return"cordova"===C3$jscomp$206.Platform.Context;case 9:return"scirra-arcade"===this._runtime.GetExportType();case 10:return"nwjs"===C3$jscomp$206.Platform.Context;case 13:return"windows-uwp"===this._runtime.GetExportType();default:return!1}},RegexTest(a,b,d){return this.GetRegex(b,d).test(a)},Compare(a,b,d){return C3$jscomp$206.compare(a,b,d)},CompareBetween(a,b,d){return a>=b&&a<=d},CompareVar(a,b,d){return C3$jscomp$206.compare(a.GetValue(),b,d)},CompareBoolVar(a){return!!a.GetValue()},
CompareTime(a,b){const d=this._runtime.GetGameTime();return 0===a?(a=this._runtime.GetCurrentCondition().GetSavedDataMap(),!a.get("CompareTime_executed")&&d>=b?(a.set("CompareTime_executed",!0),!0):!1):C3$jscomp$206.compare(d,a,b)},IsNaN(a){return isNaN(a)},AngleWithin(a,b,d){return C3$jscomp$206.angleDiff(C3$jscomp$206.toRadians(a),C3$jscomp$206.toRadians(d))<=C3$jscomp$206.toRadians(b)},IsClockwiseFrom(a,b){return C3$jscomp$206.angleClockwise(C3$jscomp$206.toRadians(a),C3$jscomp$206.toRadians(b))},
IsBetweenAngles(a,b,d){a=C3$jscomp$206.toRadians(a);b=C3$jscomp$206.toRadians(b);d=C3$jscomp$206.toRadians(d);return C3$jscomp$206.angleClockwise(d,b)?C3$jscomp$206.angleClockwise(a,b)&&!C3$jscomp$206.angleClockwise(a,d):!(!C3$jscomp$206.angleClockwise(a,b)&&C3$jscomp$206.angleClockwise(a,d))},IsValueType(a,b){return"number"===typeof a?0===b:1===b},EvaluateExpression(a){return!!a},OnSignal(a){return a.toLowerCase()===this._signalTags.at(-1)},PickByComparison(a,b,d,c){if(!a)return!1;const e=this._GetForEachStack(),
g=e.Push(),k=a.GetCurrentSol();C3$jscomp$206.shallowAssignArray(g,k.GetInstances());k.IsSelectAll()&&C3$jscomp$206.clearArray(k._GetOwnElseInstances());const l=this._runtime.GetCurrentCondition();let n=0;for(let p=0,r=g.length;p<r;++p){const w=g[p];g[n]=w;b=l.ReevaluateParameter(1,p);c=l.ReevaluateParameter(3,p);C3$jscomp$206.compare(b,d,c)?++n:k._PushElseInstance(w)}C3$jscomp$206.truncateArray(g,n);k.SetArrayPicked(g);b=!!g.length;C3$jscomp$206.clearArray(g);e.Pop();a.ApplySolToContainer();return b},
PickByEvaluate(a,b){if(!a)return!1;const d=this._GetForEachStack(),c=d.Push(),e=a.GetCurrentSol();C3$jscomp$206.shallowAssignArray(c,e.GetInstances());e.IsSelectAll()&&C3$jscomp$206.clearArray(e._GetOwnElseInstances());const g=this._runtime.GetCurrentCondition();let k=0;for(let l=0,n=c.length;l<n;++l){const p=c[l];c[k]=p;(b=g.ReevaluateParameter(1,l))?++k:e._PushElseInstance(p)}C3$jscomp$206.truncateArray(c,k);e.SetArrayPicked(c);b=!!c.length;C3$jscomp$206.clearArray(c);d.Pop();a.ApplySolToContainer();
return b},PickByHighestLowestValue(a,b,d){if(!a)return!1;const c=a.GetCurrentSol(),e=c.GetInstances();if(0===e.length)return!1;const g=this._runtime.GetCurrentCondition();let k=null,l=0;for(let n=0,p=e.length;n<p;++n){const r=e[n];d=g.ReevaluateParameter(2,n);if(null===k||0===b&&d<l||1===b&&d>l)l=d,k=r}c.PickOne(k);a.ApplySolToContainer();return!0},PickNth(a,b){if(!a)return!1;const d=a.GetCurrentSol(),c=d.GetInstances();b=Math.floor(b);if(b>=c.length)return!1;d.PickOne(c[b]);a.ApplySolToContainer();
return!0},PickRandom(a){if(!a)return!1;const b=a.GetCurrentSol(),d=b.GetInstances(),c=Math.floor(this._runtime.Random()*d.length);if(c>=d.length)return!1;b.PickOne(d[c]);a.ApplySolToContainer();return!0},PickAll(a){if(!a||!a.GetInstanceCount())return!1;a.GetCurrentSol()._SetSelectAll(!0);a.ApplySolToContainer();return!0},PickOverlappingPoint(a,b,d){if(!a)return!1;const c=a.GetCurrentSol();var e=c.GetInstances();const g=this._runtime.GetCurrentEvent().IsOrBlock(),k=this._runtime.GetCurrentCondition().IsInverted();
c.IsSelectAll()?(C3$jscomp$206.shallowAssignArray(tmpPickArray,e),c.ClearArrays(),c._SetSelectAll(!1)):g?(C3$jscomp$206.shallowAssignArray(tmpPickArray,c._GetOwnElseInstances()),C3$jscomp$206.clearArray(c._GetOwnElseInstances())):(C3$jscomp$206.shallowAssignArray(tmpPickArray,c._GetOwnInstances()),C3$jscomp$206.clearArray(c._GetOwnInstances()));for(let l=0,n=tmpPickArray.length;l<n;++l)e=tmpPickArray[l],C3$jscomp$206.xor(e.GetWorldInfo().ContainsPoint(b,d),k)?c._PushInstance(e):c._PushElseInstance(e);
a.ApplySolToContainer();return C3$jscomp$206.xor(!!c._GetOwnInstances().length,k)},PickLastCreated(a){if(!a)return!1;var b=a.IsFamily();let d=null;const c=this._runtime._GetInstancesPendingCreate();for(let e=c.length-1;0<=e;--e){const g=c[e];if(b){if(g.GetObjectClass().BelongsToFamily(a)){d=g;break}}else if(g.GetObjectClass()===a){d=g;break}}d||(b=a.GetInstances(),b.length&&(d=b.at(-1)));if(!d)return!1;a.GetCurrentSol().PickOne(d);a.ApplySolToContainer();return!0},Repeat(a){return this._runtime.IsDebugging()?
this._DebugRepeat(a):this._Repeat(a)},While(){return this._runtime.IsDebugging()?this._DebugWhile():this._While()},For(a,b,d){return this._runtime.IsDebugging()?this._DebugFor(a,b,d):this._For(a,b,d)},ForEach(a){return this._runtime.IsDebugging()?this._DebugForEach(a):this._ForEach(a)},ForEachOrdered(a,b,d){return this._runtime.IsDebugging()?this._DebugForEachOrdered(a,d):this._ForEachOrdered(a,d)},LayerVisible(a){return a?a.IsVisible():!1},LayerInteractive(a){return a?a.IsSelfAndParentsInteractive():
!1},LayerIsHTML(a){return a?a.IsHTMLElementsLayer():!1},LayerEmpty(a){return a?!a.GetInstanceCount():!1},LayerCmpOpacity(a,b,d){return a?C3$jscomp$206.compare(100*a.GetOpacity(),b,d):!1},LayerNameExists(a){const b=this._runtime.GetMainRunningLayout();return b?b.HasLayerByName(a):!1},OnImageLoadingComplete(){return!0},IsLoadingImages(){return 0<this._imagesLoadingTotal},TemplateExists(a,b){const d=this._runtime.GetTemplateManager();return d&&b?!!d.GetTemplateData(a,b):!1}};const C3$jscomp$207=self.C3;
function SortZOrderList$jscomp$1(a,b){const d=a[0]-b[0];return 0!==d?d:a[1]-b[1]}function SortInstancesByValue(a,b){return a[1]-b[1]}const tempZOrderList$jscomp$1=[],tempInstValues=[],tempRect$jscomp$10=C3$jscomp$207.New(C3$jscomp$207.Rect),tempColor$jscomp$7=C3$jscomp$207.New(C3$jscomp$207.Color);
C3$jscomp$207.Plugins.System.Acts={SetVar(a,b){a.SetValue(b)},AddVar(a,b){a.IsNumber()&&"number"!==typeof b&&(b=parseFloat(b));a.SetValue(a.GetValue()+b)},SubVar(a,b){a.IsNumber()&&a.SetValue(a.GetValue()-b)},SetBoolVar(a,b){a.SetValue(!!b)},ToggleBoolVar(a){a.SetValue(!a.GetValue())},ResetEventVar(a){a.SetValue(a.GetInitialValue())},ResetGlobals(a){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue(a)},CreateObject(a,b,d,c,e,g){if(a&&b&&(d=this._runtime.CreateInstance(a,b,d,c,e,g))){e&&
b.SortAndAddInstancesByZIndex(d);b=this._runtime.GetEventSheetManager();b.BlockFlushingInstances(!0);d._TriggerOnCreatedOnSelfAndRelated();b.BlockFlushingInstances(!1);b=new Map;d.CollectInstancesToPick(b,a,e);for(const [k,l]of b)k.GetCurrentSol().SetSetPicked(l)}},CreateObjectByName(a,b,d,c,e,g){a&&b&&(a=this._runtime.GetObjectClassByName(a))&&C3$jscomp$207.Plugins.System.Acts.CreateObject.call(this,a,b,d,c,e,g)},RecreateInitialObjects(a,b,d,c,e,g,k,l,n,p){if(a){var r=this._runtime.GetCurrentLayout();
if(g&&(r=this._runtime.GetLayoutManager().GetLayoutByName(g),!r))return;g=null;if("number"!==typeof k||0<=k)if(g=r.GetLayer(k),!g)return;tempRect$jscomp$10.set(b,d,c,e);b=r.RecreateInitialObjects(a,tempRect$jscomp$10,g,l,n,p);a.GetCurrentSol().SetArrayPicked(b);a.ApplySolToContainer()}},StopLoop(){const a=this._loopStack;a.IsInLoop()&&a.GetCurrent().Stop()},SetGroupActive(a,b){(a=this._runtime.GetEventSheetManager().GetEventGroupByName(a))&&(0===b?a.SetGroupActive(!1):1===b?a.SetGroupActive(!0):a.SetGroupActive(!a.IsGroupActive()))},
SetTimescale(a){this._runtime.SetTimeScale(a)},SetObjectTimescale(a,b){0>b&&(b=0);if(a){a=a.GetCurrentSol().GetInstances();for(const d of a)d.SetTimeScale(b)}},RestoreObjectTimescale(a){if(a){a=a.GetCurrentSol().GetInstances();for(const b of a)b.RestoreTimeScale()}},Wait(a){if(!(0>a))return this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(a),!0},WaitForSignal(a){this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(a);return!0},WaitForPreviousActions(){const a=this._runtime.GetEventSheetManager();
a.AddScheduledWait().InitPromise(a.GetPromiseForAllAsyncActions());return!0},Signal(a){a=a.toLowerCase();this._signalTags.push(a);this._runtime.Trigger(C3$jscomp$207.Plugins.System.Cnds.OnSignal,null);this._signalTags.pop();for(const b of this._runtime.GetEventSheetManager().scheduledWaits())b.IsSignal()&&b.GetSignalTag()===a&&b.SetSignalled()},async SnapshotCanvas(a,b,d,c,e,g){const k=this._runtime.GetCanvasManager();k&&(this.UpdateRender(),await k.SnapshotCanvas(0===a?"image/png":"image/jpeg",b/
100,d,c,e,g),await this._runtime.TriggerAsync(C3$jscomp$207.Plugins.System.Cnds.OnCanvasSnapshot,null))},SetCanvasSize(a,b){if(!(0>=a||0>=b)){this._runtime.SetViewportSize(a,b);this._runtime.GetCurrentLayout().BoundScrolling();var d=this._runtime.GetCanvasManager();d&&("off"!==d.GetCurrentFullscreenMode()&&this._runtime.SetOriginalViewportSize(a,b),d.SetSize(d.GetLastWidth(),d.GetLastHeight(),!0),this._runtime.UpdateRender())}},SetFullscreenQuality(a){const b=this._runtime.GetCanvasManager();b&&"off"!==
b.GetCurrentFullscreenMode()&&(b.SetFullscreenScalingQuality(0!==a?"high":"low"),b.SetSize(b.GetLastWidth(),b.GetLastHeight(),!0))},SaveState(a){this._runtime.SaveToSlot(a)},LoadState(a){this._runtime.LoadFromSlot(a)},LoadStateJSON(a){this._runtime.LoadFromJsonString(a)},SetHalfFramerateMode(a){},ResetPersisted(){for(const a of this._runtime.GetLayoutManager().GetAllLayouts())a.ResetPersistData()},SetPixelRounding(a){this._runtime.SetPixelRoundingEnabled(0!==a)},SetFramerateMinMax(a,b){this._runtime.SetMaxDt(1/
a);this._runtime.SetMinDt(1/b)},SetDeltaTimeMinMax(a,b){this._runtime.SetMinDt(a);this._runtime.SetMaxDt(b)},SetFramerateMode(a){this._runtime._SetFramerateMode(["vsync","unlimited-tick","unlimited-frame"][a])},SortZOrderByInstVar(a,b){if(a){var d=a.GetCurrentSol().GetInstances(),c=this._runtime.GetCurrentLayout(),e=a.IsFamily();a=a.GetFamilyIndex();for(let k=0,l=d.length;k<l;++k){var g=d[k];const n=g.GetWorldInfo();if(!n)continue;let p;p=e?g.GetInstanceVariableValue(b+g.GetObjectClass().GetFamilyInstanceVariableOffset(a)):
g.GetInstanceVariableValue(b);tempZOrderList$jscomp$1.push([n.GetLayer().GetIndex(),n.GetZIndex()]);tempInstValues.push([g,p])}if(tempZOrderList$jscomp$1.length){tempZOrderList$jscomp$1.sort(SortZOrderList$jscomp$1);tempInstValues.sort(SortInstancesByValue);b=!1;for(let k=0,l=tempZOrderList$jscomp$1.length;k<l;++k)d=tempInstValues[k][0],e=c.GetLayerByIndex(tempZOrderList$jscomp$1[k][0]),a=tempZOrderList$jscomp$1[k][1],g=e._GetInstances(),g[a]!==d&&(g[a]=d,d.GetWorldInfo()._SetLayer(e,!0),e.SetZIndicesChanged(d),
b=!0);b&&this._runtime.UpdateRender();C3$jscomp$207.clearArray(tempZOrderList$jscomp$1);C3$jscomp$207.clearArray(tempInstValues)}}},SetCollisionCellSize(a,b){a=Math.floor(a);b=Math.floor(b);0>=a||0>=b||!Number.isFinite(a)||!Number.isFinite(b)||this._runtime.GetCollisionEngine().SetCollisionCellSize(a,b)},GoToLayout(a){if(!this._runtime.IsLoading()){var b=this._runtime.GetLayoutManager();b.IsPendingChangeMainLayout()||b.ChangeMainLayout(a)}},GoToLayoutByName(a){if(!this._runtime.IsLoading()){var b=
this._runtime.GetLayoutManager();b.IsPendingChangeMainLayout()||(a=b.GetLayoutByName(a))&&b.ChangeMainLayout(a)}},NextPrevLayout(a){if(!this._runtime.IsLoading()){var b=this._runtime.GetLayoutManager();if(!b.IsPendingChangeMainLayout()){var d=b.GetAllLayouts(),c=d.indexOf(b.GetMainRunningLayout());a&&0===c||(a||c!==d.length-1)&&b.ChangeMainLayout(d[c+(a?-1:1)])}}},RestartLayout(){if(!this._runtime.IsLoading()){var a=this._runtime.GetLayoutManager();a.IsPendingChangeMainLayout()||(a.ChangeMainLayout(a.GetMainRunningLayout()),
this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation())}},SetLayerVisible(a,b){a&&a.SetVisible(b)},SetLayerInteractive(a,b){a&&a.SetInteractive(b)},SetLayerHTML(a,b){a&&a.SetIsHTMLElementsLayer(b)},SetLayerOpacity(a,b){a&&a.SetOpacity(b/100)},SetLayerScale(a,b){a&&a.SetOwnScale(b)},SetLayerScaleRate(a,b){a&&a.SetScaleRate(b)},SetLayerAngle(a,b){a&&a.SetAngle(C3$jscomp$207.toRadians(+b))},SetLayerScroll(a,b,d){a&&(a.SetOwnScrollPositionEnabled(!0),a.SetScrollX(b),a.SetScrollY(d))},
RestoreLayerScroll(a){a&&a.SetOwnScrollPositionEnabled(!1)},SetLayerParallax(a,b,d){a&&a.SetParallax(b/100,d/100)},SetLayerZElevation(a,b){a&&a.SetZElevation(+b)},SetLayerBackground(a,b){a&&(tempColor$jscomp$7.setFromRgbValue(b),tempColor$jscomp$7.clamp(),a=a.GetBackgroundColor(),a.equalsIgnoringAlpha(tempColor$jscomp$7)||(a.copyRgb(tempColor$jscomp$7),this.UpdateRender()))},SetLayerTransparent(a,b){a&&a.SetTransparent(b)},SetLayerBlendMode(a,b){a&&a.SetBlendMode(b)},SetLayerEffectEnabled(a,b,d){a&&
(d=a.GetEffectList().GetEffectTypeByName(d))&&(b=1===b,d.IsActive()!==b&&(d.SetActive(b),a.UpdateActiveEffects(),this._runtime.UpdateRender()))},SetLayerEffectParam(a,b,d,c){if(a&&(a=a.GetEffectList(),b=a.GetEffectTypeByName(b))){d=Math.floor(d);var e=b.GetShaderProgram().GetParameterType(d);e&&("color"===e?(tempColor$jscomp$7.setFromRgbValue(c),c=tempColor$jscomp$7):"percent"===e&&(c/=100),a.SetEffectParameter(b.GetIndex(),d,c)&&b.IsActive()&&this._runtime.UpdateRender())}},SetLayerForceOwnTexture(a,
b){a&&a.SetForceOwnTexture(b)},SetLayoutScale(a){this._runtime.GetCurrentLayout().SetScale(+a)},SetLayoutAngle(a){this._runtime.GetCurrentLayout().SetAngle(C3$jscomp$207.toRadians(+a))},SetLayoutEffectEnabled(a,b){const d=this._runtime.GetCurrentLayout();if(b=d.GetEffectList().GetEffectTypeByName(b))a=1===a,b.IsActive()!==a&&(b.SetActive(a),d.UpdateActiveEffects(),this._runtime.UpdateRender())},SetLayoutEffectParam(a,b,d){const c=this._runtime.GetCurrentLayout().GetEffectList();if(a=c.GetEffectTypeByName(a)){b=
Math.floor(b);var e=a.GetShaderProgram().GetParameterType(b);e&&("color"===e?(tempColor$jscomp$7.setFromRgbValue(d),d=tempColor$jscomp$7):"percent"===e&&(d/=100),c.SetEffectParameter(a.GetIndex(),b,d)&&a.IsActive()&&this._runtime.UpdateRender())}},SetLayoutVanishingPoint(a,b){this._runtime.GetCurrentLayout().SetVanishingPointXY(a/100,b/100)},SetLayoutProjection(a){const b=this._runtime.GetCurrentLayout();0===a?b.SetPerspectiveProjection():b.SetOrthographicProjection()},ScrollX(a){this._runtime.GetCurrentLayout().SetScrollX(a)},
ScrollY(a){this._runtime.GetCurrentLayout().SetScrollY(a)},Scroll(a,b){const d=this._runtime.GetCurrentLayout();d.SetScrollX(a);d.SetScrollY(b)},ScrollToObject(a){if(a&&(a=a.GetFirstPicked())&&(a=a.GetWorldInfo())){var b=this._runtime.GetCurrentLayout();b.SetScrollX(a.GetX());b.SetScrollY(a.GetY())}},AddLayer(a,b,d){const c=this._runtime.GetCurrentLayout();try{c.AddLayer(a,b,d)}catch(e){console.warn("[Construct] Cannot add layer: ",e)}},MoveLayer(a,b,d){if(a){var c=this._runtime.GetCurrentLayout();
try{c.MoveLayer(a,b,d)}catch(e){console.warn("[Construct] Cannot move layer: ",e)}}},RemoveLayer(a){a&&this._runtime.GetCurrentLayout().RemoveLayer(a)},RemoveAllDynamicLayers(){this._runtime.GetCurrentLayout().RemoveAllDynamicLayers()},async LoadObjectTextures(a){const b=this._runtime.GetMainRunningLayout();b&&a&&!this._runtime.IsLoading()&&(a=a.IsFamily()?a.GetFamilyMembers():[a],await this._LoadTexturesForObjectClasses(b,a))},async LoadObjectTexturesByName(a){await C3$jscomp$207.Plugins.System.Acts.LoadObjectTextures.call(this,
this._runtime.GetObjectClassByName(a))},UnloadObjectTextures(a){const b=this._runtime.GetMainRunningLayout();b&&a&&(a=a.IsFamily()?a.GetFamilyMembers():[a],this._UnloadTexturesForObjectClasses(b,a))},UnloadObjectTexturesByName(a){C3$jscomp$207.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(a))},UnloadUnusedTextures(){const a=this._runtime.GetMainRunningLayout();if(a){var b=a._GetTextureLoadedObjectTypes();this._UnloadTexturesForObjectClasses(a,b)}},async LoadLayoutTextures(a){const b=
this._runtime.GetMainRunningLayout();a&&b&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(b,a._GetInitialObjectClasses())},async LoadLayoutTexturesByName(a){const b=this._runtime.GetMainRunningLayout();(a=this._runtime.GetLayoutManager().GetLayoutByName(a))&&b&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(b,a._GetInitialObjectClasses())},SetFunctionReturnValue(a){const b=this._eventStack.GetCurrentExpFuncStackFrame();if(b)switch(b.GetFunctionReturnType()){case 1:"number"===
typeof a&&b.SetFunctionReturnValue(a);break;case 2:"string"===typeof a&&b.SetFunctionReturnValue(a);break;case 3:b.SetFunctionReturnValue(a)}},MapFunction(a,b,d){var c=this._GetFunctionMap(a.toLowerCase(),!0);const e=c.strMap,g=b.toLowerCase();e.has(g)&&console.warn(`[Construct] Function map '${a}' string '${b}' already in map; overwriting entry`);if(c=C3$jscomp$207.first(e.values())||c.defaultFunc){c=0!==c.GetReturnType();const k=0!==d.GetReturnType();if(c!==k){console.error(`[Construct] Function map '${a}' string '${b}' function return type not compatible with other functions in the map; entry ignored`);
return}}e.set(g,d)},MapFunctionDefault(a,b){const d=this._GetFunctionMap(a.toLowerCase(),!0);d.defaultFunc&&console.warn(`[Construct] Function map '${a}' already has a default; overwriting entry`);var c=C3$jscomp$207.first(d.strMap.values())||d.defaultFunc;if(c){c=0!==c.GetReturnType();const e=0!==b.GetReturnType();if(c!==e){console.error(`[Construct] Function map '${a}' default: function return type not compatible with other functions in the map; entry ignored`);return}}d.defaultFunc=b},CallMappedFunction(a,
b,d){d=Math.floor(d);var c=this._GetFunctionMap(a.toLowerCase(),!1);if(c){var e=c.strMap.get(b.toLowerCase());if(!e)if(c.defaultFunc)e=c.defaultFunc,d=0;else{console.warn(`[Construct] Call mapped function: no function associated with map '${a}' string '${b}'; call ignored (consider setting a default)`);return}if(e.IsEnabled())if(0!==e.GetReturnType())console.warn(`[Construct] Call mapped function: map '${a}' string '${b}' has a return type so cannot be called`);else{a=this._runtime;b=a.GetEventSheetManager();
var g=b.GetCurrentEvent();c=g.GetSolModifiersIncludingParents();var k=0<c.length;k&&(e.IsCopyPicked()?b.PushCopySol(c):b.PushCleanSol(c));var l=[];if(g=b.FindFirstFunctionBlockParent(g)){g=g.GetFunctionParameters();for(let n=d,p=g.length;n<p;++n)l.push(g[n].GetValue())}d=e.GetFunctionParameters();for(let n=l.length,p=d.length;n<p;++n)l.push(d[n].GetInitialValue());return a.IsDebugging()?this._DebugDoCallMappedFunction(b,e,l,k,c):this._DoCallMappedFunction(b,e,l,k,c)}}else console.warn(`[Construct] Call mapped function: map name '${a}' not found; call ignored`)}};
const C3$jscomp$208=self.C3;
C3$jscomp$208.Plugins.System.Exps={int:function(a){"string"===typeof a&&(a=parseInt(a,10),isNaN(a)&&(a=0));return Math.floor(a)},float:function(a){"string"===typeof a&&(a=parseFloat(a),isNaN(a)&&(a=0));return a},str(a){return a.toString()},len(a){return"string"===typeof a?a.length:0},random(a,b){return"undefined"===typeof b?this._runtime.Random()*a:this._runtime.Random()*(b-a)+a},choose(...a){const b=Math.floor(this._runtime.Random()*a.length);return a[b]},chooseindex(a,...b){"number"!==typeof a&&
(a=0);a=C3$jscomp$208.clamp(Math.floor(a),0,b.length-1);return b[a]},pi(){return Math.PI},infinity(){return Infinity},sqrt(a){return Math.sqrt(a)},abs(a){return Math.abs(a)},round(a){return Math.round(a)},roundtodp(a,b){b=Math.max(Math.floor(b),0);b=Math.pow(10,b);return Math.round((a+Number.EPSILON)*b)/b},floor(a){return Math.floor(a)},ceil(a){return Math.ceil(a)},sign(a){return Math.sign(a)},sin(a){return Math.sin(C3$jscomp$208.toRadians(a))},cos(a){return Math.cos(C3$jscomp$208.toRadians(a))},
tan(a){return Math.tan(C3$jscomp$208.toRadians(a))},asin(a){return C3$jscomp$208.toDegrees(Math.asin(a))},acos(a){return C3$jscomp$208.toDegrees(Math.acos(a))},atan(a){return C3$jscomp$208.toDegrees(Math.atan(a))},exp(a){return Math.exp(a)},ln(a){return Math.log(a)},log10(a){return Math.log10(a)},max(...a){let b=a[0];"number"!==typeof b&&(b=0);for(let d=1,c=a.length;d<c;++d){let e=a[d];"number"===typeof e&&b<e&&(b=e)}return b},min(...a){let b=a[0];"number"!==typeof b&&(b=0);for(let d=1,c=a.length;d<
c;++d){let e=a[d];"number"===typeof e&&b>e&&(b=e)}return b},clamp(a,b,d){return C3$jscomp$208.clamp(a,b,d)},distance(a,b,d,c){return C3$jscomp$208.distanceTo(a,b,d,c)},angle(a,b,d,c){return C3$jscomp$208.toDegrees(C3$jscomp$208.angleTo(a,b,d,c))},lerp(a,b,d){return C3$jscomp$208.lerp(a,b,d)},unlerp(a,b,d){return C3$jscomp$208.unlerp(a,b,d)},qarp(a,b,d,c){return C3$jscomp$208.qarp(a,b,d,c)},cubic(a,b,d,c,e){return C3$jscomp$208.cubic(a,b,d,c,e)},cosp(a,b,d){return C3$jscomp$208.cosp(a,b,d)},anglediff(a,
b){return C3$jscomp$208.toDegrees(C3$jscomp$208.angleDiff(C3$jscomp$208.toRadians(a),C3$jscomp$208.toRadians(b)))},anglelerp(a,b,d){return C3$jscomp$208.toDegrees(C3$jscomp$208.angleLerp(C3$jscomp$208.toRadians(a),C3$jscomp$208.toRadians(b),d))},anglerotate(a,b,d){return C3$jscomp$208.toDegrees(C3$jscomp$208.angleRotate(C3$jscomp$208.toRadians(a),C3$jscomp$208.toRadians(b),C3$jscomp$208.toRadians(d)))},setbit(a,b,d){b|=0;return(a|0)&~(1<<b)|(0!==d?1:0)<<b},togglebit(a,b){return(a|0)^1<<(b|0)},getbit(a,
b){return(a|0)&1<<(b|0)?1:0},newline(){return"\n"},uppercase(a){return"string"===typeof a?a.toUpperCase():""},lowercase(a){return"string"===typeof a?a.toLowerCase():""},left(a,b){return"string"===typeof a?a.substr(0,b):""},mid(a,b,d){return"string"!==typeof a?"":0>d?a.substr(b):a.substr(b,d)},right(a,b){return"string"===typeof a?a.substr(Math.max(a.length-b,0)):""},trim(a){return"string"===typeof a?a.trim():""},tokenat(a,b,d){if("string"!==typeof a||"string"!==typeof d)return"";a=a.split(d);b=Math.floor(b);
return 0>b||b>=a.length?"":a[b]},tokencount(a,b){return"string"===typeof a&&"string"===typeof b&&a.length?a.split(b).length:0},find(a,b){return"string"===typeof a&&"string"===typeof b?a.search(new RegExp(C3$jscomp$208.EscapeRegex(b),"i")):-1},findcase(a,b){return"string"===typeof a&&"string"===typeof b?a.search(new RegExp(C3$jscomp$208.EscapeRegex(b),"")):-1},replace(a,b,d){return"string"===typeof a&&"string"===typeof b&&"string"===typeof d?a.replace(new RegExp(C3$jscomp$208.EscapeRegex(b),"gi"),
d):"string"===typeof a?a:""},stringsub(a,...b){for(let d=0,c=b.length;d<c;++d)a=a.replaceAll(`{${d}}`,b[d].toString());return a},regexsearch(a,b,d){b=this.GetRegex(b,d);return a?a.search(b):-1},regexreplace(a,b,d,c){b=this.GetRegex(b,d);return a?a.replace(b,c):""},regexmatchcount(a,b,d){return(a=this.GetRegexMatches(a.toString(),b,d))?a.length:0},regexmatchat(a,b,d,c){c=Math.floor(c);a=this.GetRegexMatches(a.toString(),b,d);return!a||0>c||c>=a.length?"":a[c]},zeropad(a,b){let d=0>a?"-":"";0>a&&(a=
-a);d+="0".repeat(Math.max(b-a.toString().length,0));return d+a.toString()},urlencode(a){return encodeURIComponent(a)},urldecode(a){return decodeURIComponent(a)},dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1E3},unixtime(){return Date.now()},time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFramesPerSecond()},
cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},
scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return C3$jscomp$208.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},vanishingpointx(){return 100*
this._runtime.GetCurrentLayout().GetVanishingPointX()},vanishingpointy(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointY()},viewportleft(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetViewport3D().getLeft():0},viewporttop(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetViewport3D().getTop():0},viewportright(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetViewport3D().getRight():0},viewportbottom(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?
a.GetViewport3D().getBottom():0},viewportwidth(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetViewport3D().width():0},viewportheight(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetViewport3D().height():0},viewportmidx(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?(a=a.GetViewport3D(),(a.getLeft()+a.getRight())/2):0},viewportmidy(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?(a=a.GetViewport3D(),(a.getTop()+a.getBottom())/2):0},canvastolayerx(a,
b,d){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.CanvasCssToLayer(b,d)[0]:0},canvastolayery(a,b,d){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.CanvasCssToLayer(b,d)[1]:0},layertocanvasx(a,b,d){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.LayerToCanvasCss(b,d)[0]:0},layertocanvasy(a,b,d){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.LayerToCanvasCss(b,d)[1]:0},layertolayerx(a,b,d,c){const e=this._runtime.GetCurrentLayout();a=e.GetLayer(a);b=e.GetLayer(b);
if(!a||!b||a===b)return d;const [g,k]=a.LayerToCanvasCss(d,c);return b.CanvasCssToLayer(g,k)[0]},layertolayery(a,b,d,c){const e=this._runtime.GetCurrentLayout();a=e.GetLayer(a);b=e.GetLayer(b);if(!a||!b||a===b)return c;const [g,k]=a.LayerToCanvasCss(d,c);return b.CanvasCssToLayer(g,k)[1]},layerscale(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetOwnScale():0},layerangle(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?C3$jscomp$208.toDegrees(a.GetOwnAngle()):0},layeropacity(a){return(a=
this._runtime.GetCurrentLayout().GetLayer(a))?100*a.GetOpacity():0},layerscalerate(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetScaleRate():0},layerscrollx(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetScrollX():0},layerscrolly(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetScrollY():0},layerparallaxx(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?100*a.GetParallaxX():0},layerparallaxy(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?
100*a.GetParallaxY():0},layerzelevation(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetZElevation():0},layerindex(a){return(a=this._runtime.GetCurrentLayout().GetLayer(a))?a.GetIndex():-1},canvassnapshot(){const a=this._runtime.GetCanvasManager();return a?a.GetCanvasSnapshotUrl():""},loopindex(a){const b=this._loopStack;return b.IsInLoop()?a?(a=b.FindByName(a))?a.GetIndex():0:b.GetCurrent().GetIndex():0},savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(a,b,
...d){var c=this._GetFunctionMap(a.toLowerCase(),!1);if(!c)return console.warn(`[Construct] Call mapped function: map name '${a}' not found; returning 0`),0;let e=c.strMap.get(b.toLowerCase());if(!e)if(c.defaultFunc)e=c.defaultFunc;else return console.warn(`[Construct] Call mapped function: no function associated with map '${a}' string '${b}'; returning 0 (consider setting a default)`),0;c=e.GetReturnType();const g=e.GetDefaultReturnValue();if(0===c)return console.warn(`[Construct] Call mapped function: map '${a}' string '${b}' has no return type so cannot be called from an expression; returning 0`),
0;if(!e.IsEnabled())return g;a=this._runtime.GetEventSheetManager();b=a.GetCurrentEvent().GetSolModifiersIncludingParents();const k=0<b.length;k&&(e.IsCopyPicked()?a.PushCopySol(b):a.PushCleanSol(b));var l=e.GetFunctionParameters();for(let n=d.length,p=l.length;n<p;++n)d.push(l[n].GetInitialValue());l=e.GetEventBlock();d=l.RunAsExpressionFunctionCall(l.GetSolModifiersIncludingParents(),e.IsCopyPicked(),c,g,...d);k&&a.PopSol(b);return d},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},
imageloadingprogress(){return 0===this._imagesLoadingTotal?1:this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){return this._runtime.GetWebGPURenderer()?"webgpu":"webgl"},rendererdetail(){return this._runtime.GetWebGPURenderer()?this._runtime.GetWebGPURenderer().GetAdapterInfoString():this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){let a=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*a/1048576)/100},rgb(a,b,d){return C3$jscomp$208.PackRGB(a,
b,d)},rgbex(a,b,d){return C3$jscomp$208.PackRGBEx(a/100,b/100,d/100)},rgba(a,b,d,c){return C3$jscomp$208.PackRGBAEx(a/100,b/100,d/100,c/100)},rgbex255(a,b,d){return C3$jscomp$208.PackRGBEx(a/255,b/255,d/255)},rgba255(a,b,d,c){return C3$jscomp$208.PackRGBAEx(a/255,b/255,d/255,c/255)},projectname(){return this._runtime.GetProjectName()},projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}};
"use strict";const C3$jscomp$209=self.C3;C3$jscomp$209.Plugins.TiledBg=class extends C3$jscomp$209.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};const C3$jscomp$210=self.C3;function WrapModeToStr(a){switch(a){case 0:return"clamp-to-edge";case 2:return"mirror-repeat"}return"repeat"}
C3$jscomp$210.Plugins.TiledBg.Type=class extends C3$jscomp$210.SDKTypeBase{constructor(a,b){super(a);this._wrapY=this._wrapX="repeat";b&&(this._wrapX=WrapModeToStr(b[0]),this._wrapY=WrapModeToStr(b[1]))}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(a){return this.GetImageInfo().LoadStaticTexture(a,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}};
const C3$jscomp$211=self.C3,C3X$jscomp$34=self.C3X,tempRect$jscomp$11=C3$jscomp$211.New(C3$jscomp$211.Rect),tempQuad$jscomp$6=C3$jscomp$211.New(C3$jscomp$211.Quad),rcTex$jscomp$3=C3$jscomp$211.New(C3$jscomp$211.Rect),qTex=C3$jscomp$211.New(C3$jscomp$211.Quad);
C3$jscomp$211.Plugins.TiledBg.Instance=class extends C3$jscomp$211.SDKWorldInstanceBase{constructor(a,b){super(a);this._imageOffsetY=this._imageOffsetX=0;this._imageScaleY=this._imageScaleX=1;this._imageAngle=0;this._enableTileRandomization=!1;this._tileBlendMarginY=this._tileBlendMarginX=this._tileAngleRandom=this._tileYRandom=this._tileXRandom=0;this._ownImageInfo=null;b&&(this.GetWorldInfo().SetVisible(!!b[0]),this._imageOffsetX=b[4],this._imageOffsetY=b[5],this._imageScaleX=b[6],this._imageScaleY=
b[7],this._imageAngle=C3$jscomp$211.toRadians(b[8]),this._enableTileRandomization=!!b[9],this._tileXRandom=b[10],this._tileYRandom=b[11],this._tileAngleRandom=b[12],this._tileBlendMarginX=b[13],this._tileBlendMarginY=b[14])}Release(){this._ReleaseOwnImage();super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}CalculateTextureCoordsFor3DFace(a,b,d){var c=this.GetCurrentImageInfo();const e=c.GetWidth();c=c.GetHeight();const g=this._imageOffsetX/
e,k=this._imageOffsetY/c,l=this._imageAngle;rcTex$jscomp$3.set(0,0,a/(e*this._imageScaleX),b/(c*this._imageScaleY));rcTex$jscomp$3.offset(-g,-k);0===l?d.setFromRect(rcTex$jscomp$3):d.setFromRotatedRect(rcTex$jscomp$3,-l)}SetTilingShaderProgram(a,b=!0){this._enableTileRandomization?(b=this.GetCurrentImageInfo(),a.SetTileRandomizationMode(),a.SetTileRandomizationInfo(b.GetWidth()*this._imageScaleX,b.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,
this._tileBlendMarginY)):b&&a.SetTextureFillMode()}Draw(a){var b=this.GetCurrentImageInfo(),d=b.GetTexture();if(null!==d){this.SetTilingShaderProgram(a);a.SetTexture(d);d=b.GetWidth();b=b.GetHeight();var c=this._imageOffsetX/d,e=this._imageOffsetY/b,g=this.GetWorldInfo();rcTex$jscomp$3.set(0,0,g.GetWidth()/(d*this._imageScaleX),g.GetHeight()/(b*this._imageScaleY));rcTex$jscomp$3.offset(-c,-e);g.HasMesh()?this._DrawMesh(g,a):this._DrawStandard(g,a)}}_DrawStandard(a,b){let d=a.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&
(d=a.PixelRoundQuad(d));0===this._imageAngle?b.Quad3(d,rcTex$jscomp$3):(qTex.setFromRotatedRect(rcTex$jscomp$3,-this._imageAngle),b.Quad4(d,qTex))}_DrawMesh(a,b){const d=a.GetTransformedMesh();if(a.IsMeshChanged()){a.CalculateBbox(tempRect$jscomp$11,tempQuad$jscomp$6,!1);let c=tempQuad$jscomp$6;this._runtime.IsPixelRoundingEnabled()&&(c=a.PixelRoundQuad(c));let e=rcTex$jscomp$3;0!==this._imageAngle&&(qTex.setFromRotatedRect(rcTex$jscomp$3,-this._imageAngle),e=qTex);d.CalculateTransformedMesh(a.GetSourceMesh(),
c,e);a.SetMeshChanged(!1)}d.Draw(b)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return!0}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(!0)}_SetImageOffsetX(a){this._imageOffsetX!==a&&(this._imageOffsetX=a,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(a){this._imageOffsetY!==a&&(this._imageOffsetY=a,this._runtime.UpdateRender(),
this._SetMeshChanged())}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(a){this._imageScaleX!==a&&(this._imageScaleX=a,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(a){this._imageScaleY!==a&&(this._imageScaleY=a,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(a){this._imageAngle!==a&&(this._imageAngle=a,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageAngle(){return this._imageAngle}_SetTileRandomizationEnabled(a){a=
!!a;this._enableTileRandomization!==a&&(this._enableTileRandomization=a,this._runtime.UpdateRender())}_IsTileRandomizationEnabled(){return this._enableTileRandomization}_SetTileXRandom(a){this._tileXRandom!==a&&(this._tileXRandom=a,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileXRandom(){return this._tileXRandom}_SetTileYRandom(a){this._tileYRandom!==a&&(this._tileYRandom=a,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileYRandom(){return this._tileYRandom}_SetTileAngleRandom(a){this._tileAngleRandom!==
a&&(this._tileAngleRandom=a,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileAngleRandom(){return this._tileAngleRandom}_SetTileBlendMarginX(a){this._tileBlendMarginX!==a&&(this._tileBlendMarginX=a,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileBlendMarginX(){return this._tileBlendMarginX}_SetTileBlendMarginY(a){this._tileBlendMarginY!==a&&(this._tileBlendMarginY=a,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileBlendMarginY(){return this._tileBlendMarginY}SaveToJson(){const a=
{};0!==this._imageOffsetX&&(a.iox=this._imageOffsetX);0!==this._imageOffsetY&&(a.ioy=this._imageOffsetY);1!==this._imageScaleX&&(a.isx=this._imageScaleX);1!==this._imageScaleY&&(a.isy=this._imageScaleY);0!==this._imageAngle&&(a.ia=this._imageAngle);this._enableTileRandomization&&(a.tr=!0);1!==this._tileXRandom&&(a.trx=this._tileXRandom);1!==this._tileYRandom&&(a["try"]=this._tileYRandom);1!==this._tileAngleRandom&&(a.tra=this._tileAngleRandom);.1!==this._tileBlendMarginX&&(a.trbmx=this._tileBlendMarginX);
.1!==this._tileBlendMarginY&&(a.trbmy=this._tileBlendMarginY);return a}LoadFromJson(a){this._imageOffsetX=a.iox||0;this._imageOffsetY=a.ioy||0;this._imageScaleX=a.hasOwnProperty("isx")?a.isx:1;this._imageScaleY=a.hasOwnProperty("isy")?a.isy:1;this._imageAngle=a.ia||0;this._enableTileRandomization=!!a.tr;this._tileXRandom=a.hasOwnProperty("trx")?a.trx:1;this._tileYRandom=a.hasOwnProperty("try")?a["try"]:1;this._tileAngleRandom=a.hasOwnProperty("tra")?a.tra:1;this._tileBlendMarginX=a.hasOwnProperty("trbmx")?
a.trbmx:.1;this._tileBlendMarginY=a.hasOwnProperty("trbmy")?a.trbmy:.1}GetDebuggerProperties(){return[{title:"plugins.tiledbg.properties.image-transform.name",properties:[{name:"plugins.tiledbg.properties.image-offset-x.name",value:this._GetImageOffsetX(),onedit:a=>this._SetImageOffsetX(a)},{name:"plugins.tiledbg.properties.image-offset-y.name",value:this._GetImageOffsetY(),onedit:a=>this._SetImageOffsetY(a)},{name:"plugins.tiledbg.properties.image-scale-x.name",value:100*this._GetImageScaleX(),onedit:a=>
this._SetImageScaleX(a/100)},{name:"plugins.tiledbg.properties.image-scale-y.name",value:100*this._GetImageScaleY(),onedit:a=>this._SetImageScaleY(a/100)},{name:"plugins.tiledbg.properties.image-angle.name",value:C3$jscomp$211.toDegrees(this._GetImageAngle()),onedit:a=>this._SetImageAngle(C3$jscomp$211.toRadians(a))}]},{title:"plugins.tiledbg.properties.tile-randomization.name",properties:[{name:"plugins.tiledbg.properties.enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:a=>
this._SetTileRandomizationEnabled(a)},{name:"plugins.tiledbg.properties.x-random.name",value:100*this._GetTileXRandom(),onedit:a=>this._SetTileXRandom(a/100)},{name:"plugins.tiledbg.properties.y-random.name",value:100*this._GetTileYRandom(),onedit:a=>this._SetTileYRandom(a/100)},{name:"plugins.tiledbg.properties.angle-random.name",value:100*this._GetTileAngleRandom(),onedit:a=>this._SetTileAngleRandom(a/100)},{name:"plugins.tiledbg.properties.blend-margin-x.name",value:100*this._GetTileBlendMarginX(),
onedit:a=>this._SetTileBlendMarginX(a/100)},{name:"plugins.tiledbg.properties.blend-margin-y.name",value:100*this._GetTileBlendMarginY(),onedit:a=>this._SetTileBlendMarginY(a/100)}]}]}GetPropertyValueByIndex(a){switch(a){case 4:return this._GetImageOffsetX();case 5:return this._GetImageOffsetY();case 6:return this._GetImageScaleX();case 7:return this._GetImageScaleY();case 8:return this._GetImageAngle();case 9:return this._IsTileRandomizationEnabled();case 10:return this._GetTileXRandom();case 11:return this._GetTileYRandom();
case 12:return this._GetTileAngleRandom();case 13:return this._GetTileBlendMarginX();case 14:return this._GetTileBlendMarginY()}}SetPropertyValueByIndex(a,b){switch(a){case 4:this._SetImageOffsetX(b);break;case 5:this._SetImageOffsetY(b);break;case 6:this._SetImageScaleX(b);break;case 7:this._SetImageScaleY(b);break;case 8:this._SetImageAngle(b);break;case 9:this._SetTileRandomizationEnabled(!!b);break;case 10:this._SetTileXRandom(b);break;case 11:this._SetTileYRandom(b);break;case 12:this._SetTileAngleRandom(b);
break;case 13:this._SetTileBlendMarginX(b);break;case 14:this._SetTileBlendMarginY(b)}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}};const map$jscomp$28=new WeakMap;
self.ITiledBackgroundInstance=class extends self.IWorldInstance{constructor(){super();map$jscomp$28.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetImageOffsetX(a)}get imageOffsetX(){return map$jscomp$28.get(this)._GetImageOffsetX()}set imageOffsetY(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetImageOffsetY(a)}get imageOffsetY(){return map$jscomp$28.get(this)._GetImageOffsetY()}setImageOffset(a,
b){C3X$jscomp$34.RequireFiniteNumber(a);C3X$jscomp$34.RequireFiniteNumber(b);const d=map$jscomp$28.get(this);d._SetImageOffsetX(a);d._SetImageOffsetY(b)}getImageOffset(){const a=map$jscomp$28.get(this);return[a._GetImageOffsetX(),a._GetImageOffsetY()]}set imageScaleX(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetImageScaleX(a)}get imageScaleX(){return map$jscomp$28.get(this)._GetImageScaleX()}set imageScaleY(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetImageScaleY(a)}get imageScaleY(){return map$jscomp$28.get(this)._GetImageScaleY()}setImageScale(a,
b){C3X$jscomp$34.RequireFiniteNumber(a);C3X$jscomp$34.RequireFiniteNumber(b);const d=map$jscomp$28.get(this);d._SetImageScaleX(a);d._SetImageScaleY(b)}getImageScale(){const a=map$jscomp$28.get(this);return[a._GetImageScaleX(),a._GetImageScaleY()]}set imageAngle(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetImageAngle(a)}get imageAngle(){return map$jscomp$28.get(this)._GetImageAngle()}set imageAngleDegrees(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetImageAngle(C3$jscomp$211.toRadians(a))}get imageAngleDegrees(){return C3$jscomp$211.toDegrees(map$jscomp$28.get(this)._GetImageAngle())}get imageWidth(){return map$jscomp$28.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map$jscomp$28.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const a=
map$jscomp$28.get(this).GetCurrentImageInfo();return[a.GetWidth(),a.GetHeight()]}set enableTileRandomization(a){map$jscomp$28.get(this)._SetTileRandomizationEnabled(!!a)}get enableTileRandomization(){return map$jscomp$28.get(this)._IsTileRandomizationEnabled()}set tileXRandom(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetTileXRandom(a)}get tileXRandom(){return map$jscomp$28.get(this)._GetTileXRandom()}set tileYRandom(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetTileYRandom(a)}get tileYRandom(){return map$jscomp$28.get(this)._GetTileYRandom()}setTileRandom(a,
b){C3X$jscomp$34.RequireFiniteNumber(a);C3X$jscomp$34.RequireFiniteNumber(b);const d=map$jscomp$28.get(this);d._SetTileXRandom(a);d._SetTileYRandom(b)}getTileRandom(){const a=map$jscomp$28.get(this);return[a._GetTileXRandom(),a._GetTileYRandom()]}set tileAngleRandom(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetTileAngleRandom(a)}get tileAngleRandom(){return map$jscomp$28.get(this)._GetTileAngleRandom()}set tileBlendMarginX(a){C3X$jscomp$34.RequireFiniteNumber(a);map$jscomp$28.get(this)._SetTileBlendMarginX(a)}get tileBlendMarginX(){return map$jscomp$28.get(this)._GetTileBlendMarginX()}set tileBlendMarginY(a){C3X$jscomp$34.RequireFiniteNumber(a);
map$jscomp$28.get(this)._SetTileBlendMarginY(a)}get tileBlendMarginY(){return map$jscomp$28.get(this)._GetTileBlendMarginY()}setTileBlendMargin(a,b){C3X$jscomp$34.RequireFiniteNumber(a);C3X$jscomp$34.RequireFiniteNumber(b);const d=map$jscomp$28.get(this);d._SetTileBlendMarginX(a);d._SetTileBlendMarginY(b)}getTileBlendMargin(){const a=map$jscomp$28.get(this);return[a._GetTileBlendMarginX(),a._GetTileBlendMarginY()]}async replaceImage(a){C3X$jscomp$34.RequireInstanceOf(a,Blob);const b=map$jscomp$28.get(this),
d=b.GetRuntime(),c=C3$jscomp$211.New(C3$jscomp$211.ImageInfo);c.LoadDynamicBlobAsset(d,a);await c.LoadStaticTexture(d.GetRenderer(),{sampling:d.GetSampling(),wrapX:"repeat",wrapY:"repeat"});b.WasReleased()?c.Release():(b._ReleaseOwnImage(),b._ownImageInfo=c,d.UpdateRender())}};self.C3.Plugins.TiledBg.Cnds={OnURLLoaded(){return!0},OnURLFailed(){return!0},IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled()}};const C3$jscomp$213=self.C3;
C3$jscomp$213.Plugins.TiledBg.Acts={SetImageOffsetX(a){this._SetImageOffsetX(a)},SetImageOffsetY(a){this._SetImageOffsetY(a)},SetImageScaleX(a){this._SetImageScaleX(a/100)},SetImageScaleY(a){this._SetImageScaleY(a/100)},SetImageAngle(a){this._SetImageAngle(C3$jscomp$213.toRadians(a))},SetTileRandomizationEnabled(a){this._SetTileRandomizationEnabled(a)},SetTilePosRandom(a,b){this._SetTileXRandom(a/100);this._SetTileYRandom(b/100)},SetTileAngleRandom(a){this._SetTileAngleRandom(a/100)},SetTileBlendMargin(a,
b){this._SetTileBlendMarginX(a/100);this._SetTileBlendMarginY(b/100)},SetEffect(a){this.GetWorldInfo().SetBlendMode(a);this._runtime.UpdateRender()},async LoadURL(a,b){if(!this._ownImageInfo||this._ownImageInfo.GetURL()!==a){b=this._runtime;var d=C3$jscomp$213.New(C3$jscomp$213.ImageInfo);try{await d.LoadDynamicAsset(b,a);if(!d.IsLoaded())throw Error("image failed to load");if(this.WasReleased())return d.Release(),null;if(!await d.LoadStaticTexture(b.GetRenderer(),{sampling:b.GetSampling(),wrapX:"repeat",
wrapY:"repeat"}))return}catch(c){console.error("Load image from URL failed: ",c);this.WasReleased()||this.Trigger(C3$jscomp$213.Plugins.TiledBg.Cnds.OnURLFailed);return}this.WasReleased()?d.Release():(this._ReleaseOwnImage(),this._ownImageInfo=d,b.UpdateRender(),await this.TriggerAsync(C3$jscomp$213.Plugins.TiledBg.Cnds.OnURLLoaded))}}};const C3$jscomp$214=self.C3;
C3$jscomp$214.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return 100*this._imageScaleX},ImageScaleY(){return 100*this._imageScaleY},ImageAngle(){return C3$jscomp$214.toDegrees(this._imageAngle)},TileXRandom(){return 100*this._GetTileXRandom()},TileYRandom(){return 100*this._GetTileYRandom()},TileAngleRandom(){return 100*
this._GetTileAngleRandom()},TileBlendMarginX(){return 100*this._GetTileBlendMarginX()},TileBlendMarginY(){return 100*this._GetTileBlendMarginY()}};"use strict";const C3$jscomp$215=self.C3;C3$jscomp$215.Plugins.Sprite=class extends C3$jscomp$215.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};const C3$jscomp$216=self.C3,C3X$jscomp$35=self.C3X,spawnPickStack=[];
C3$jscomp$216.Plugins.Sprite.Type=class extends C3$jscomp$216.SDKTypeBase{constructor(a){super(a);this._animations=a.GetAnimations()}Release(){C3$jscomp$216.clearArray(this._animations);super.Release()}OnCreate(){for(const a of this._animations)a.LoadAllAssets(this._runtime)}LoadTextures(a){const b={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map(d=>d.LoadAllTextures(a,b)))}ReleaseTextures(){for(const a of this._animations)a.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(const a of this._objectClass.instancesIncludingPendingCreate())a.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(a){C3$jscomp$216.Plugins.Sprite.FinishCollisionCondition(this,
a)}BeforeRunAction(a){spawnPickStack.push({objectClass:null,createHierarchy:!1,instances:[]})}_SpawnPickInstance(a,b,d){const c=spawnPickStack.at(-1);c.objectClass=a;c.createHierarchy=d;c.instances.push(b)}AfterRunAction(a){a=spawnPickStack.pop();const b=a.objectClass,d=a.createHierarchy;if(b){var c=new Map;for(const e of a.instances)e.CollectInstancesToPick(c,b,d);for(const [e,g]of c)e.GetCurrentSol().SetSetPicked(g)}}_AddAnimation(a){a=this.GetObjectClass().AddAnimation(a);const b=this.GetRuntime();
a.GetFrameAt(0).GetImageInfo().LoadStaticTexture(b.GetRenderer(),{sampling:b.GetSampling()}).then(()=>this._UpdateAllCurrentTexture());return a}_RemoveAnimation(a){for(const b of this._objectClass.instancesIncludingPendingCreate())b.GetSdkInstance()._OnAnimationRemoved(a);this.GetObjectClass().RemoveAnimation(a)}_AddAnimationFrame(a,b){var d=this._objectClass.GetAnimationByName(a);if(!d)throw Error(`cannot find animation name '${a}'`);b=d.FrameTagOrIndexToIndex(b);0>b&&(b+=d.GetFrameCount()+1);a=
C3$jscomp$216.AnimationFrameInfo.CreateDynamic(this.GetRuntime());d.InsertFrameAt(a,b);d=this.GetRuntime();a.GetImageInfo().LoadStaticTexture(d.GetRenderer(),{sampling:d.GetSampling()}).then(()=>this._UpdateAllCurrentTexture());for(const c of this._objectClass.instancesIncludingPendingCreate())c.GetSdkInstance()._OnAnimationFramesChanged();return a}_RemoveAnimationFrame(a,b){const d=this._objectClass.GetAnimationByName(a);if(!d)throw Error(`cannot find animation name '${a}'`);if(1===d.GetFrameCount())throw Error(`cannot remove last frame from animation '${a}'`);
a=d.FrameTagOrIndexToIndex(b);0>a&&(a+=d.GetFrameCount());d.RemoveFrameAt(a);for(const c of this._objectClass.instancesIncludingPendingCreate())c.GetSdkInstance()._OnAnimationFramesChanged()}GetScriptInterfaceClass(){return self.ISpriteObjectType}};const map$jscomp$29=new WeakMap;
self.ISpriteObjectType=class extends self.IObjectClass{constructor(a){super(a);map$jscomp$29.set(this,a.GetSdkType())}getAnimation(a){C3X$jscomp$35.RequireString(a);return(a=map$jscomp$29.get(this).GetObjectClass().GetAnimationByName(a))?a.GetIAnimation():null}getAllAnimations(){return map$jscomp$29.get(this).GetObjectClass().GetAllAnimations().map(a=>a.GetIAnimation())}addAnimation(a){C3X$jscomp$35.RequireString(a);return map$jscomp$29.get(this)._AddAnimation(a).GetIAnimation()}removeAnimation(a){C3X$jscomp$35.RequireString(a);
map$jscomp$29.get(this)._RemoveAnimation(a)}addAnimationFrame(a,b){C3X$jscomp$35.RequireString(a);if("number"!==typeof b&&"string"!==typeof b)throw new TypeError("invalid insert location");return map$jscomp$29.get(this)._AddAnimationFrame(a,b).GetIAnimationFrame()}removeAnimationFrame(a,b){C3X$jscomp$35.RequireString(a);if("number"!==typeof b&&"string"!==typeof b)throw new TypeError("invalid insert location");map$jscomp$29.get(this)._RemoveAnimationFrame(a,b)}};
const C3$jscomp$217=self.C3,C3X$jscomp$36=self.C3X,tempRect$jscomp$12=C3$jscomp$217.New(C3$jscomp$217.Rect),tempQuad$jscomp$7=C3$jscomp$217.New(C3$jscomp$217.Quad),tempVec2$jscomp$1=C3$jscomp$217.New(C3$jscomp$217.Vector2),FLAG_PLAYING_FORWARDS=1,FLAG_ANIMATION_PLAYING=2,FLAG_ANIMATION_TRIGGER=4;
C3$jscomp$217.Plugins.Sprite.Instance=class extends C3$jscomp$217.SDKWorldInstanceBase{constructor(a,b){super(a);let d=!0,c="",e=0,g=!0;b&&(d=!!b[0],c=b[1],e=b[2],g=b[3]);this._currentAnimation=this._objectClass.GetAnimationByName(c)||this._objectClass.GetAnimations()[0];this._currentFrameIndex=C3$jscomp$217.clamp(e,0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);b=this._currentAnimationFrame.GetImageInfo();this._currentTexture=
b.GetTexture();this._currentRcTex=b.GetTexRect();this._currentQuadTex=b.GetTexQuad();this.HandleRendererContextLoss();a.SetFlag(FLAG_ANIMATION_PLAYING,!0);a.SetFlag(FLAG_PLAYING_FORWARDS,0<=this._currentAnimation.GetSpeed());this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed());this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo();this._animationTimer=C3$jscomp$217.New(C3$jscomp$217.KahanSum);this._animationRepeats=this._frameStartTime=0;this._animTriggerName="";this._changeAnimFrameIndex=
-1;this._changeAnimationName="";this._changeAnimationFrom=0;a=this.GetWorldInfo();this._bquadRef=a.GetBoundingQuad();a.SetVisible(d);a.SetCollisionEnabled(g);a.SetOriginX(this._currentAnimationFrame.GetOriginX());a.SetOriginY(this._currentAnimationFrame.GetOriginY());a.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly());a.SetBboxChanged();1===this._objectClass.GetAnimationCount()&&1===this._objectClass.GetAnimations()[0].GetFrameCount()||0===this._currentAnimationSpeed||this._StartTicking()}Release(){this._animationTimer=
this._currentTexture=this._currentAnimationFrame=this._currentAnimation=null;super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return!0}OnRendererContextLost(){this._currentTexture=null}OnRendererContextRestored(){this._UpdateCurrentTexture()}Draw(a){var b=this._currentTexture;null!==b&&(a.SetTexture(b),b=this.GetWorldInfo(),b.HasMesh()?this._DrawMesh(b,a):this._DrawStandard(b,a))}_DrawStandard(a,b){let d=this._bquadRef;this._runtime.IsPixelRoundingEnabled()&&
(d=a.PixelRoundQuad(d));b.Quad4(d,this._currentQuadTex)}_DrawMesh(a,b){const d=a.GetTransformedMesh();if(a.IsMeshChanged()){a.CalculateBbox(tempRect$jscomp$12,tempQuad$jscomp$7,!1);let c=tempQuad$jscomp$7;this._runtime.IsPixelRoundingEnabled()&&(c=a.PixelRoundQuad(c));d.CalculateTransformedMesh(a.GetSourceMesh(),c,this._currentQuadTex);a.SetMeshChanged(!1)}d.Draw(b)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(FLAG_ANIMATION_PLAYING)}SetAnimationPlaying(a){this._inst.SetFlag(FLAG_ANIMATION_PLAYING,
a)}IsPlayingForwards(){return this._inst.GetFlag(FLAG_PLAYING_FORWARDS)}SetPlayingForwards(a){this._inst.SetFlag(FLAG_PLAYING_FORWARDS,a)}IsInAnimationTrigger(){return this._inst.GetFlag(FLAG_ANIMATION_TRIGGER)}SetInAnimationTrigger(a){this._inst.SetFlag(FLAG_ANIMATION_TRIGGER,a)}Tick(){this._changeAnimationName&&this._DoChangeAnimation();0<=this._changeAnimFrameIndex&&this._DoChangeAnimFrame();const a=this._currentAnimationSpeed;if(this.IsAnimationPlaying()&&0!==a){var b=this._runtime.GetDt(this._inst);
this._animationTimer.Add(b);b=this.GetAnimationTime();var d=this._currentAnimationFrame,c=d.GetDuration()/a;if(!(b<this._frameStartTime+c)){var e=this._currentAnimation,g=this._currentAnimationRepeatTo,k=e.GetFrameCount(),l=e.GetRepeatCount(),n=e.IsLooping(),p=e.IsPingPong();this.IsPlayingForwards()?this._currentFrameIndex++:this._currentFrameIndex--;this._frameStartTime+=c;this._currentFrameIndex>=k&&(p?(this.SetPlayingForwards(!1),this._currentFrameIndex=k-2):n?this._currentFrameIndex=g:(this._animationRepeats++,
this._animationRepeats>=l?this._FinishAnimation(!1):this._currentFrameIndex=g));0>this._currentFrameIndex&&(p?(this._currentFrameIndex=1,this.SetPlayingForwards(!0),n||(this._animationRepeats++,this._animationRepeats>=l&&this._FinishAnimation(!0))):n?this._currentFrameIndex=g:(this._animationRepeats++,this._animationRepeats>=l?this._FinishAnimation(!0):this._currentFrameIndex=g));this._currentFrameIndex=C3$jscomp$217.clamp(this._currentFrameIndex,0,k-1);c=e.GetFrameAt(this._currentFrameIndex);b>this._frameStartTime+
c.GetDuration()/a&&(this._frameStartTime=b);this._OnFrameChanged(d,c)}}else this._StopTicking()}_FinishAnimation(a){this._currentFrameIndex=a?0:this._currentAnimation.GetFrameCount()-1;this.SetAnimationPlaying(!1);this._animTriggerName=this._currentAnimation.GetName();this.SetInAnimationTrigger(!0);this.DispatchScriptEvent("animationend",!1,{animationName:this._animTriggerName});this.Trigger(C3$jscomp$217.Plugins.Sprite.Cnds.OnAnyAnimFinished);this.Trigger(C3$jscomp$217.Plugins.Sprite.Cnds.OnAnimFinished);
this.SetInAnimationTrigger(!1);this._animationRepeats=0}_OnFrameChanged(a,b,d){if(a!==b){var c=this.GetWorldInfo(),e=a.GetImageInfo(),g=b.GetImageInfo(),k=e.GetWidth();e=e.GetHeight();var l=g.GetWidth(),n=g.GetHeight();if(d&&d.onFrameChange)d.onFrameChange(c,k,e,l,n);else k!==l&&c.SetWidth(c.GetWidth()*(l/k)),e!==n&&c.SetHeight(c.GetHeight()*(n/e));c.SetOriginX(b.GetOriginX());c.SetOriginY(b.GetOriginY());c.SetSourceCollisionPoly(b.GetCollisionPoly());c.SetBboxChanged();this._currentAnimationFrame=
b;this._currentTexture=g.GetTexture();this._currentRcTex=g.GetTexRect();this._currentQuadTex=g.GetTexQuad();d=this.GetInstance().GetBehaviorInstances();for(let p=0,r=d.length;p<r;++p)d[p].OnSpriteFrameChanged(a,b);this.DispatchScriptEvent("framechange",!1,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex});this.Trigger(C3$jscomp$217.Plugins.Sprite.Cnds.OnFrameChanged);this._runtime.UpdateRender()}}_StartAnim(a){this.SetAnimationPlaying(!0);this._frameStartTime=
this.GetAnimationTime();1===a&&0!==this._currentFrameIndex&&(this._changeAnimFrameIndex=0,this.IsInAnimationTrigger()||this._DoChangeAnimFrame());this._StartTicking()}_SetAnim(a,b,d){this._changeAnimationName=a;this._changeAnimationFrom=b;this._StartTicking();!d&&this.IsInAnimationTrigger()||this._DoChangeAnimation()}_GetCurrentAnimation(){return this._currentAnimation}_GetCurrentAnimationName(){return this._changeAnimationName?this._changeAnimationName:this._currentAnimation.GetName()}_OnAnimationRemoved(a){C3$jscomp$217.equalsNoCase(a,
this._GetCurrentAnimationName())&&this._SetAnim(this._objectClass.GetFirstAnimation().GetName(),1,!0)}_SetAnimFrame(a){if("string"===typeof a)if(String(Number(a))===a)a=Number(a);else{const b=this._objectClass.GetAnimationByName(this._GetCurrentAnimationName());if(!b)return;a=b.GetFrameIndexByTag(a);if(-1===a)return}isFinite(a)&&(this._changeAnimFrameIndex=a,this.IsInAnimationTrigger()||this._DoChangeAnimFrame())}_OnAnimationFramesChanged(){if(!this._changeAnimationName&&-1===this._changeAnimFrameIndex){var a=
this._currentAnimationFrame,b=this._currentAnimation.GetFrameAt(C3$jscomp$217.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1));a!==b&&this._OnFrameChanged(a,b);1<this._currentAnimation.GetFrameCount()&&0<this._currentAnimationSpeed&&this._StartTicking()}}_GetAnimFrame(){return this._currentFrameIndex}_GetAnimFrameTag(){return this._currentAnimationFrame.GetTag()}_SetAnimSpeed(a){this._currentAnimationSpeed=Math.abs(a);this.SetPlayingForwards(0<=a);0<this._currentAnimationSpeed&&
this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(a){if("string"===typeof a&&(a=this._currentAnimation.GetFrameIndexByTag(a),-1===a))return;this._currentAnimationRepeatTo=a=C3$jscomp$217.clamp(Math.floor(a),0,this._currentAnimation.GetFrameCount()-1)}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(a){const b=this._currentAnimationFrame;var d=this._objectClass.GetAnimationByName(this._changeAnimationName);
this._changeAnimationName="";!d||d===this._currentAnimation&&this.IsAnimationPlaying()||(this._currentAnimation=d,this.SetPlayingForwards(0<=d.GetSpeed()),this._currentAnimationSpeed=Math.abs(d.GetSpeed()),this._currentAnimationRepeatTo=d.GetRepeatTo(),this._currentFrameIndex=C3$jscomp$217.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1),1===this._changeAnimationFrom&&(this._currentFrameIndex=0),this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),d=this._currentAnimation.GetFrameAt(this._currentFrameIndex),
this._OnFrameChanged(b,d,a))}_DoChangeAnimFrame(a){const b=this._currentAnimationFrame,d=this._currentFrameIndex;this._currentFrameIndex=C3$jscomp$217.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1);this._changeAnimFrameIndex=-1;if(a||d!==this._currentFrameIndex)a=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(b,a),this._frameStartTime=this.GetAnimationTime()}_UpdateCurrentTexture(){const a=this._currentAnimationFrame.GetImageInfo();
this._currentTexture=a.GetTexture();this._currentRcTex=a.GetTexRect();this._currentQuadTex=a.GetTexQuad();this.GetWorldInfo().SetMeshChanged(!0)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(a){const b=this._currentAnimationFrame,d=this.GetWorldInfo();if("string"===typeof a)a=b.GetImagePointByName(a);else if("number"===typeof a)a=b.GetImagePointByIndex(a-
1);else throw new TypeError("expected string or number");let c=d.GetTotalZElevation();if(!a)return[d.GetX(),d.GetY(),c];tempVec2$jscomp$1.copy(a.GetVec2());if(d.HasMesh()){const [e,g,k]=d.GetSourceMesh().TransformPoint(tempVec2$jscomp$1.getX(),tempVec2$jscomp$1.getY());tempVec2$jscomp$1.set(e,g);c+=k}tempVec2$jscomp$1.offset(-b.GetOriginX(),-b.GetOriginY());tempVec2$jscomp$1.scale(d.GetWidth(),d.GetHeight());tempVec2$jscomp$1.rotate(d.GetAngle());tempVec2$jscomp$1.offset(d.GetX(),d.GetY());return[tempVec2$jscomp$1.getX(),
tempVec2$jscomp$1.getY(),c]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(a){a=Math.floor(a);const b=this.GetWorldInfo();var d=b.GetTransformedCollisionPoly();const c=d.pointCount();a===c&&(a=0);if(0>a||a>=c)return[0,0];d=d.pointsArr();return[d[2*a]+b.GetX(),d[2*a+1]+b.GetY()]}GetDebuggerProperties(){const a=C3$jscomp$217.Plugins.Sprite.Acts;return[{title:"plugins.sprite.debugger.animation-properties.title",properties:[{name:"plugins.sprite.debugger.animation-properties.current-animation",
value:this._currentAnimation.GetName(),onedit:b=>this.CallAction(a.SetAnim,b,0)},{name:"plugins.sprite.debugger.animation-properties.current-frame",value:this._currentFrameIndex,onedit:b=>this.CallAction(a.SetAnimFrame,b)},{name:"plugins.sprite.debugger.animation-properties.is-playing",value:this.IsAnimationPlaying(),onedit:b=>b?this.CallAction(a.StartAnim,0):this.CallAction(a.StopAnim)},{name:"plugins.sprite.debugger.animation-properties.speed",value:this._currentAnimationSpeed,onedit:b=>this.CallAction(a.SetAnimSpeed,
b)},{name:"plugins.sprite.debugger.animation-properties.repeats",value:this._animationRepeats,onedit:b=>this._animationRepeats=b}]}]}SaveToJson(){const a={a:this._currentAnimation.GetSID()};0!==this._frameStartTime&&(a.fs=this._frameStartTime);var b=this.GetAnimationTime();0!==b&&(a.at=b);0!==this._currentFrameIndex&&(a.f=this._currentFrameIndex);0!==this._currentAnimationSpeed&&(a.cas=this._currentAnimationSpeed);1!==this._animationRepeats&&(a.ar=this._animationRepeats);0!==this._currentAnimationRepeatTo&&
(a.rt=this._currentAnimationRepeatTo);this.IsAnimationPlaying()||(a.ap=this.IsAnimationPlaying());this.IsPlayingForwards()||(a.af=this.IsPlayingForwards());b=this.GetWorldInfo();b.IsCollisionEnabled()&&(a.ce=b.IsCollisionEnabled());return a}LoadFromJson(a){var b=this.GetObjectClass().GetAnimationBySID(a.a);b&&(this._currentAnimation=b);this._frameStartTime=a.hasOwnProperty("fs")?a.fs:0;this._animationTimer.Set(a.hasOwnProperty("at")?a.at:0);b=a.hasOwnProperty("f")?a.f:0;this._currentFrameIndex=C3$jscomp$217.clamp(b,
0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationSpeed=a.hasOwnProperty("cas")?a.cas:0;this._animationRepeats=a.hasOwnProperty("ar")?a.ar:1;b=a.hasOwnProperty("rt")?a.rt:0;this._currentAnimationRepeatTo=C3$jscomp$217.clamp(b,0,this._currentAnimation.GetFrameCount()-1);this.SetAnimationPlaying(a.hasOwnProperty("ap")?!!a.ap:!0);this.SetPlayingForwards(a.hasOwnProperty("af")?!!a.af:!0);this._currentAnimationFrame=b=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._UpdateCurrentTexture();
const d=this.GetWorldInfo();d.SetOriginX(b.GetOriginX());d.SetOriginY(b.GetOriginY());d.SetSourceCollisionPoly(b.GetCollisionPoly());d.SetCollisionEnabled(!!a.ce);this.IsAnimationPlaying()&&this._StartTicking()}GetPropertyValueByIndex(a){const b=this.GetWorldInfo();switch(a){case 3:return b.IsCollisionEnabled();case 2:return C3$jscomp$217.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case 1:return this._currentAnimation.GetName()}}SetPropertyValueByIndex(a,b,d){var c=this.GetWorldInfo();
switch(a){case 3:c.SetCollisionEnabled(!!b);break;case 2:this.SetAnimationPlaying(!1);a=this._currentAnimation.GetFrameCount()-1;c=b=C3$jscomp$217.clamp(b,0,a);b=this._currentAnimation.GetFrameAt(this._currentFrameIndex);const e=this._currentAnimation.GetFrameAt(c);this._OnFrameChanged(b,e,d);this._currentFrameIndex=C3$jscomp$217.clamp(c,0,a);break;case 1:this._changeAnimationName=b,this._DoChangeAnimation(d),1<this._currentAnimation.GetFrameCount()&&0<this._currentAnimation.GetSpeed()?this._StartTicking():
this._StopTicking()}}GetScriptInterfaceClass(){return self.ISpriteInstance}};const map$jscomp$30=new WeakMap,ANIM_FROM_MODES=new Map([["current-frame",0],["beginning",1]]);
self.ISpriteInstance=class extends self.IWorldInstance{constructor(){super();map$jscomp$30.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return map$jscomp$30.get(this).GetImagePointCount()}getImagePointX(a){return this.getImagePoint(a)[0]}getImagePointY(a){return this.getImagePoint(a)[1]}getImagePointZ(a){return this.getImagePoint(a)[2]}getImagePoint(a){if("string"!==typeof a&&"number"!==typeof a)throw new TypeError("expected string or number");return map$jscomp$30.get(this).GetImagePoint(a)}getPolyPointCount(){return map$jscomp$30.get(this).GetCollisionPolyPointCount()}getPolyPointX(a){C3X$jscomp$36.RequireFiniteNumber(a);
return map$jscomp$30.get(this).GetCollisionPolyPoint(a)[0]}getPolyPointY(a){C3X$jscomp$36.RequireFiniteNumber(a);return map$jscomp$30.get(this).GetCollisionPolyPoint(a)[1]}getPolyPoint(a){C3X$jscomp$36.RequireFiniteNumber(a);return map$jscomp$30.get(this).GetCollisionPolyPoint(a)}stopAnimation(){map$jscomp$30.get(this).SetAnimationPlaying(!1)}startAnimation(a="current-frame"){C3X$jscomp$36.RequireString(a);a=ANIM_FROM_MODES.get(a);if("undefined"===typeof a)throw Error("invalid mode");map$jscomp$30.get(this)._StartAnim(a)}setAnimation(a,
b="beginning"){C3X$jscomp$36.RequireString(a);C3X$jscomp$36.RequireString(b);b=ANIM_FROM_MODES.get(b);if("undefined"===typeof b)throw Error("invalid mode");const d=map$jscomp$30.get(this);if(!d.GetObjectClass().GetAnimationByName(a))throw Error(`animation name "${a}" does not exist`);d._SetAnim(a,b)}getAnimation(a){C3X$jscomp$36.RequireString(a);return(a=map$jscomp$30.get(this).GetObjectClass().GetAnimationByName(a))?a.GetIAnimation():null}get animation(){return map$jscomp$30.get(this)._GetCurrentAnimation().GetIAnimation()}get animationName(){return map$jscomp$30.get(this)._GetCurrentAnimationName()}set animationFrame(a){C3X$jscomp$36.RequireFiniteNumber(a);
map$jscomp$30.get(this)._SetAnimFrame(a)}get animationFrame(){return map$jscomp$30.get(this)._GetAnimFrame()}set animationFrameTag(a){C3X$jscomp$36.RequireString(a);map$jscomp$30.get(this)._SetAnimFrame(a)}get animationFrameTag(){return map$jscomp$30.get(this)._GetAnimFrameTag()}set animationSpeed(a){C3X$jscomp$36.RequireFiniteNumber(a);map$jscomp$30.get(this)._SetAnimSpeed(a)}get animationSpeed(){return map$jscomp$30.get(this)._GetAnimSpeed()}set animationRepeatToFrame(a){C3X$jscomp$36.RequireFiniteNumber(a);
map$jscomp$30.get(this)._SetAnimRepeatToFrame(a)}get animationRepeatToFrame(){return map$jscomp$30.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return map$jscomp$30.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map$jscomp$30.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const a=map$jscomp$30.get(this).GetCurrentImageInfo();return[a.GetWidth(),a.GetHeight()]}async replaceCurrentAnimationFrame(a){C3X$jscomp$36.RequireInstanceOf(a,Blob);const b=map$jscomp$30.get(this),
d=b.GetRuntime(),c=b.GetCurrentImageInfo(),e=C3$jscomp$217.New(C3$jscomp$217.ImageInfo);e.LoadDynamicBlobAsset(d,a);await e.LoadStaticTexture(d.GetRenderer(),{sampling:d.GetSampling()});b.WasReleased()?e.Release():(c.ReplaceWith(e),a=b.GetSdkType(),a._UpdateAllCurrentTexture(),a.GetObjectClass().Dispatcher().dispatchEvent(new C3$jscomp$217.Event("animationframeimagechange")),d.UpdateRender())}setSolidCollisionFilter(a,b){C3X$jscomp$36.RequireString(b);map$jscomp$30.get(this).GetWorldInfo().SetSolidCollisionFilter(!!a,
b)}};const C3$jscomp$218=self.C3;
C3$jscomp$218.Plugins.Sprite.Cnds={IsAnimPlaying(a){return C3$jscomp$218.equalsNoCase(this._GetCurrentAnimationName(),a)},CompareFrame(a,b){return C3$jscomp$218.compare(this._currentFrameIndex,a,b)},CompareFrameTag(a,b){if("string"!==typeof b)return!1;const d=this._currentAnimationFrame.GetTag();return C3$jscomp$218.compare(d.toLowerCase(),a,b.toLowerCase())},CompareAnimSpeed(a,b){return C3$jscomp$218.compare(this._GetAnimSpeed(),a,b)},OnAnimFinished(a){return C3$jscomp$218.equalsNoCase(this._animTriggerName,a)},
OnAnyAnimFinished(){return!0},OnFrameChanged(){return!0},IsMirrored(){return 0>this.GetWorldInfo().GetWidth()},IsFlipped(){return 0>this.GetWorldInfo().GetHeight()},OnURLLoaded(){return!0},OnURLFailed(){return!0},IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}};const C3$jscomp$219=self.C3;
C3$jscomp$219.Plugins.Sprite.Acts={Spawn(a,b,d,c,e){if(a&&b){var [g,k]=this.GetImagePoint(d);if(d=this._runtime.CreateInstance(a,b,g,k,c,e))c&&b.SortAndAddInstancesByZIndex(d),a.GetPlugin().IsRotatable()&&(b=d.GetWorldInfo(),b.SetAngle(this.GetWorldInfo().GetAngle()),b.SetBboxChanged()),b=this._runtime.GetEventSheetManager(),b.BlockFlushingInstances(!0),d._TriggerOnCreatedOnSelfAndRelated(),b.BlockFlushingInstances(!1),a!==this._runtime.GetCurrentAction().GetObjectClass()&&this._sdkType._SpawnPickInstance(a,
d,c)}},StopAnim(){this.SetAnimationPlaying(!1)},StartAnim(a){this._StartAnim(a)},SetAnim(a,b){this._SetAnim(a,b)},SetAnimFrame(a){this._SetAnimFrame(a)},SetAnimSpeed(a){this._SetAnimSpeed(a)},SetAnimRepeatToFrame(a){this._SetAnimRepeatToFrame(a)},AddRemoveAnimation(a,b){try{0===a?this.GetSdkType()._AddAnimation(b):this.GetSdkType()._RemoveAnimation(b)}catch(d){console.error(`[Construct] Error ${0===a?"adding":"removing"} animation: `,d)}},AddRemoveAnimationFrame(a,b,d){try{0===a?this.GetSdkType()._AddAnimationFrame(b,
d):this.GetSdkType()._RemoveAnimationFrame(b,d)}catch(c){console.error(`[Construct] Error ${0===a?"adding":"removing"} animation frame: `,c)}},SetMirrored(a){const b=this.GetWorldInfo(),d=b.GetWidth();a=Math.abs(d)*(0===a?-1:1);d!==a&&(b.SetWidth(a),b.SetBboxChanged())},SetFlipped(a){const b=this.GetWorldInfo(),d=b.GetHeight();a=Math.abs(d)*(0===a?-1:1);d!==a&&(b.SetHeight(a),b.SetBboxChanged())},SetScale(a){const b=this._currentAnimationFrame.GetImageInfo(),d=this.GetWorldInfo();var c=0>d.GetWidth()?
-1:1;const e=0>d.GetHeight()?-1:1;c*=b.GetWidth()*a;a=b.GetHeight()*a*e;if(d.GetWidth()!==c||d.GetHeight()!==a)d.SetSize(c,a),d.SetBboxChanged()},async LoadURL(a,b,d){d=this._currentAnimationFrame.GetImageInfo();const c=this.GetWorldInfo(),e=this._runtime,g=this._sdkType;if(d.GetURL()===a)0===b&&(c.SetSize(d.GetWidth(),d.GetHeight()),c.SetBboxChanged()),this.Trigger(C3$jscomp$219.Plugins.Sprite.Cnds.OnURLLoaded);else{var k=C3$jscomp$219.New(C3$jscomp$219.ImageInfo);try{await k.LoadDynamicAsset(e,
a);if(!k.IsLoaded())throw Error("image failed to load");if(this.WasReleased()){k.Release();return}await k.LoadStaticTexture(e.GetRenderer(),{sampling:e.GetSampling()})}catch(l){console.error("Load image from URL failed: ",l);this.WasReleased()||this.Trigger(C3$jscomp$219.Plugins.Sprite.Cnds.OnURLFailed);return}this.WasReleased()?k.Release():(d.ReplaceWith(k),g._UpdateAllCurrentTexture(),g.GetObjectClass().Dispatcher().dispatchEvent(new C3$jscomp$219.Event("animationframeimagechange")),e.UpdateRender(),
0===b&&(c.SetSize(d.GetWidth(),d.GetHeight()),c.SetBboxChanged()),await this.TriggerAsync(C3$jscomp$219.Plugins.Sprite.Cnds.OnURLLoaded))}},SetCollisions(a){this.GetWorldInfo().SetCollisionEnabled(a)},SetSolidCollisionFilter(a,b){this.GetWorldInfo().SetSolidCollisionFilter(0===a,b)},SetEffect(a){this.GetWorldInfo().SetBlendMode(a);this._runtime.UpdateRender()}};
self.C3.Plugins.Sprite.Exps={AnimationFrame(){return this._GetAnimFrame()},AnimationFrameTag(){return this._GetAnimFrameTag()},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(a){return this.GetImagePoint(a)[0]},ImagePointY(a){return this.GetImagePoint(a)[1]},ImagePointZ(a){return this.GetImagePoint(a)[2]},
ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(a){return this.GetCollisionPolyPoint(a)[0]},PolyPointYAt(a){return this.GetCollisionPolyPoint(a)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}};"use strict";const C3$jscomp$221=self.C3;
C3$jscomp$221.Plugins.TextBox=class extends C3$jscomp$221.SDKDOMPluginBase{constructor(a){super(a,"text-input");this.AddElementMessageHandler("click",(b,d)=>b._OnClick(d));this.AddElementMessageHandler("dblclick",(b,d)=>b._OnDoubleClick(d));this.AddElementMessageHandler("change",(b,d)=>b._OnChange(d))}Release(){super.Release()}};const C3$jscomp$222=self.C3;C3$jscomp$222.Plugins.TextBox.Type=class extends C3$jscomp$222.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};
const C3$jscomp$223=self.C3,C3X$jscomp$37=self.C3X,elemTypes="text password email number tel url textarea search".split(" ");
C3$jscomp$223.Plugins.TextBox.Instance=class extends C3$jscomp$223.SDKDOMInstanceBase{constructor(a,b){super(a,"text-input");this._title=this._placeholder=this._text="";this._isEnabled=!0;this._spellCheck=this._isReadOnly=!1;this._type="text";this._autoFontSize=!0;this._maxLength=-1;this._className=this._id="";b&&(this._text=b[0],this._placeholder=b[1],this._title=b[2],this.GetWorldInfo().SetVisible(b[3]),this._isEnabled=b[4],this._isReadOnly=b[5],this._spellCheck=b[6],this._type=elemTypes[b[7]],
this._autoFontSize=b[8],this._id=b[9],this._className=b[10]);this.CreateElement({type:this._type,id:this._id,className:this._className})}Release(){super.Release()}GetElementState(){return{text:this._text,placeholder:this._placeholder,title:this._title,isEnabled:this._isEnabled,isReadOnly:this._isReadOnly,spellCheck:this._spellCheck,maxLength:this._maxLength}}async _OnClick(a){this.DispatchScriptEvent("click",!0);await this.TriggerAsync(C3$jscomp$223.Plugins.TextBox.Cnds.OnClicked)}async _OnDoubleClick(a){this.DispatchScriptEvent("dblclick",
!0);await this.TriggerAsync(C3$jscomp$223.Plugins.TextBox.Cnds.OnDoubleClicked)}async _OnChange(a){this._text=a.text;this.DispatchScriptEvent("change",!0);await this.TriggerAsync(C3$jscomp$223.Plugins.TextBox.Cnds.OnTextChanged)}_SetText(a){this._text!==a&&(this._text=a,this.UpdateElementState())}_GetText(){return this._text}_SetPlaceholder(a){this._placeholder!==a&&(this._placeholder=a,this.UpdateElementState())}_GetPlaceholder(){return this._placeholder}_SetTooltip(a){this._title!==a&&(this._title=
a,this.UpdateElementState())}_GetTooltip(){return this._title}_SetEnabled(a){a=!!a;this._isEnabled!==a&&(this._isEnabled=a,this.UpdateElementState())}_IsEnabled(){return this._isEnabled}_SetReadOnly(a){a=!!a;this._isReadOnly!==a&&(this._isReadOnly=a,this.UpdateElementState())}_IsReadOnly(){return this._isReadOnly}_SetMaxLength(a){a=Math.max(+a,-1);this._maxLength!==a&&(this._maxLength=a,this.UpdateElementState())}_GetMaxLength(){return this._maxLength}_ScrollToBottom(){Promise.resolve().then(()=>
this.PostToDOMElement("scroll-to-bottom"))}Draw(a){}SaveToJson(){return{t:this._text,p:this._placeholder,ti:this._title,e:this._isEnabled,r:this._isReadOnly,sp:this._spellCheck,ml:this._maxLength,type:this._type,id:this._id}}LoadFromJson(a){this._text=a.t;this._placeholder=a.p;this._title=a.ti;this._isEnabled=a.e;this._isReadOnly=a.r;this._spellCheck=a.sp;this._maxLength=a.hasOwnProperty("ml")?a.ml:-1;this._type=a.type;this._id=a.id;this.UpdateElementState()}GetPropertyValueByIndex(a){switch(a){case 0:return this._text;
case 1:return this._placeholder;case 2:return this._title;case 4:return this._isEnabled;case 5:return this._isReadOnly;case 6:return this._spellCheck;case 8:return this._autoFontSize}}SetPropertyValueByIndex(a,b){switch(a){case 0:if(this._text===b)break;this._text=b;this.UpdateElementState();break;case 1:if(this._placeholder===b)break;this._placeholder=b;this.UpdateElementState();break;case 2:if(this._title===b)break;this._title=b;this.UpdateElementState();break;case 4:if(this._isEnabled===!!b)break;
this._isEnabled=!!b;this.UpdateElementState();break;case 5:if(this._isReadOnly===!!b)break;this._isReadOnly=!!b;this.UpdateElementState();break;case 6:if(this._spellCheck===!!b)break;this._spellCheck=!!b;this.UpdateElementState();break;case 8:this._autoFontSize=!!b}}GetDebuggerProperties(){const a=C3$jscomp$223.Plugins.TextBox.Acts;return[{title:"plugins.textbox.name",properties:[{name:"plugins.textbox.properties.text.name",value:this._text,onedit:b=>this.CallAction(a.SetText,b)},{name:"plugins.textbox.properties.enabled.name",
value:this._isEnabled,onedit:b=>this.CallAction(a.SetEnabled,b)},{name:"plugins.textbox.properties.read-only.name",value:this._isReadOnly,onedit:b=>this.CallAction(a.SetReadOnly,b)}]}]}GetScriptInterfaceClass(){return self.ITextInputInstance}};const map$jscomp$31=new WeakMap;
self.ITextInputInstance=class extends self.IDOMInstance{constructor(){super();map$jscomp$31.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set text(a){C3X$jscomp$37.RequireString(a);map$jscomp$31.get(this)._SetText(a)}get text(){return map$jscomp$31.get(this)._GetText()}set placeholder(a){C3X$jscomp$37.RequireString(a);map$jscomp$31.get(this)._SetPlaceholder(a)}get placeholder(){return map$jscomp$31.get(this)._GetPlaceholder()}set tooltip(a){C3X$jscomp$37.RequireString(a);map$jscomp$31.get(this)._SetTooltip(a)}get tooltip(){return map$jscomp$31.get(this)._GetTooltip()}set isEnabled(a){map$jscomp$31.get(this)._SetEnabled(a)}get isEnabled(){return map$jscomp$31.get(this)._IsEnabled()}set isReadOnly(a){map$jscomp$31.get(this)._SetReadOnly(a)}get isReadOnly(){return map$jscomp$31.get(this)._IsReadOnly()}set maxLength(a){C3X$jscomp$37.RequireFiniteNumber(a);
map$jscomp$31.get(this)._SetMaxLength(a)}get maxLength(){return map$jscomp$31.get(this)._GetMaxLength()}scrollToBottom(){map$jscomp$31.get(this)._ScrollToBottom()}};const C3$jscomp$224=self.C3;C3$jscomp$224.Plugins.TextBox.Cnds={CompareText(a,b){return 0===b?C3$jscomp$224.equalsNoCase(this._text,a):this._text===a},OnTextChanged(){return!0},OnClicked(){return!0},OnDoubleClicked(){return!0}};
self.C3.Plugins.TextBox.Acts={SetText(a){this._SetText(a.toString())},AppendText(a){""!==a&&this._SetText(this._GetText()+a)},SetPlaceholder(a){this._SetPlaceholder(a)},SetTooltip(a){this._SetTooltip(a)},SetReadOnly(a){this._SetReadOnly(0===a)},ScrollToBottom(){this._ScrollToBottom()},SetMaxLength(a){this._SetMaxLength(a)}};self.C3.Plugins.TextBox.Exps={Text(){return this._GetText()},MaxLength(){return this._GetMaxLength()}};"use strict";const C3$jscomp$227=self.C3;C3$jscomp$227.Plugins.Text=class extends C3$jscomp$227.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};
const C3$jscomp$228=self.C3;C3$jscomp$228.Plugins.Text.Type=class extends C3$jscomp$228.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}LoadTextures(a){}ReleaseTextures(){}};
const C3$jscomp$229=self.C3,C3X$jscomp$38=self.C3X,TEMP_COLOR_ARRAY$jscomp$1=[0,0,0],HORIZONTAL_ALIGNMENTS=["left","center","right"],VERTICAL_ALIGNMENTS=["top","center","bottom"],TEXT_DIRECTIONS=["ltr","rtl"],tempRect$jscomp$13=new C3$jscomp$229.Rect,tempQuad$jscomp$8=new C3$jscomp$229.Quad,tempColor$jscomp$8=new C3$jscomp$229.Color,tempVec2$jscomp$2=C3$jscomp$229.New(C3$jscomp$229.Vector2),BBCODE_TAG_TO_HTML=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["iconoffsety",null]]);
C3$jscomp$229.Plugins.Text.Instance=class extends C3$jscomp$229.SDKWorldInstanceBase{constructor(a,b){super(a);this._text="";this._enableBBcode=!0;this._faceName="Arial";this._ptSize=12;this._lineHeightOffset=0;this._isItalic=this._isBold=!1;this._color=C3$jscomp$229.New(C3$jscomp$229.Color);this._verticalAlign=this._horizontalAlign=0;this._wrapByWord=!0;this._textDirection=0;this._iconObjectClass=null;this._htmlString="";this._readAloud=this._isHtmlStringUpToDate=!1;this._screenReaderText=null;this._typewriterEndTime=
this._typewriterStartTime=-1;this._typewriterLength=0;this._rendererText=C3$jscomp$229.New(C3$jscomp$229.Gfx.RendererText,this._runtime.GetRenderer(),{timeout:5});this._rendererText.ontextureupdate=()=>this._runtime.UpdateRender();this._animationframeimagechange_handler=()=>this._OnIconObjectClassImageChanged();this._pendingUpdateIconSet=!1;b&&(this._text=b[0],this._enableBBcode=!!b[1],this._faceName=b[2],this._ptSize=b[3],this._lineHeightOffset=b[4],this._isBold=!!b[5],this._isItalic=!!b[6],this._horizontalAlign=
b[8],this._verticalAlign=b[9],this._wrapByWord=0===b[10],this._textDirection=b[11],this._SetIconObjectClass(this._runtime.GetObjectClassBySID(b[12])),a=b[7],this._color.setRgb(a[0],a[1],a[2]),this.GetWorldInfo().SetVisible(b[13]),this._readAloud=!!b[15]);this._UpdateTextSettings();this._UpdateScreenReaderText()}Release(){this._SetIconObjectClass(null);this._CancelTypewriter();this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null);this._rendererText.Release();this._rendererText=
null;super.Release()}_UpdateTextSettings(){const a=this._rendererText;a.SetText(this._text);a.SetBBCodeEnabled(this._enableBBcode);this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass?this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass)):this._rendererText.SetIconSet(null);a.SetIconSmoothing("nearest"!==this._runtime.GetSampling());a.SetFontName(this._faceName);a.SetLineHeight(this._lineHeightOffset);a.SetBold(this._isBold);a.SetItalic(this._isItalic);a.SetColor(this._color);
a.SetHorizontalAlignment(HORIZONTAL_ALIGNMENTS[this._horizontalAlign]);a.SetVerticalAlignment(VERTICAL_ALIGNMENTS[this._verticalAlign]);a.SetWordWrapMode(this._wrapByWord?"word":"character");a.SetTextDirection(TEXT_DIRECTIONS[this._textDirection])}_UpdateTextSize(){const a=this.GetWorldInfo();this._rendererText.SetFontSize(this._ptSize);this._rendererText.SetFontSizeScale(a.GetSceneGraphScale());var b=a.GetLayer();b=b.GetRenderScale()*b.Get2DScaleFactorToZ(a.GetTotalZElevation());a.HasMesh()&&b!==
this._rendererText.GetZoom()&&a.SetMeshChanged(!0);this._rendererText.SetSize(a.GetWidth(),a.GetHeight(),b)}_SetIconObjectClass(a){a&&(a.IsFamily()||a.GetPlugin().constructor!==C3$jscomp$229.Plugins.Sprite)||a===this._iconObjectClass||(this._iconObjectClass&&this._iconObjectClass.Dispatcher().removeEventListener("animationframeimagechange",this._animationframeimagechange_handler),(this._iconObjectClass=a)&&this._iconObjectClass.Dispatcher().addEventListener("animationframeimagechange",this._animationframeimagechange_handler),
this._UpdateTextSettings(),this._isHtmlStringUpToDate=!1,this._runtime.UpdateRender())}_OnIconObjectClassImageChanged(){this._runtime.DeleteTextIconSet(this._iconObjectClass);this._runtime.UpdateRender();this._pendingUpdateIconSet=!0}_UpdateScreenReaderText(){if(this._readAloud){let a=this._text;this._enableBBcode&&(a=C3$jscomp$229.BBString.StripAnyTags(a));this._screenReaderText?this._screenReaderText.SetText(a):this._screenReaderText=C3$jscomp$229.New(C3$jscomp$229.ScreenReaderText,this._runtime,
a)}else this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null)}Draw(a){var b=this.GetWorldInfo();this._UpdateTextSize();this._pendingUpdateIconSet&&(this._pendingUpdateIconSet=!1,this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass&&this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass)));const d=this._rendererText.GetTexture();if(d){var c=b.GetLayer();if(0===b.GetAngle()&&0===c.GetAngle()&&0===b.GetTotalZElevation()&&!b.HasMesh()&&
c.RendersIn2DMode()){b=b.GetBoundingQuad();const [e,g]=c.LayerToDrawSurface(b.getTlx(),b.getTly()),[k,l]=c.LayerToDrawSurface(b.getBrx(),b.getBry());b=e-Math.round(e);const n=g-Math.round(g);tempRect$jscomp$13.set(e,g,k,l);tempRect$jscomp$13.offset(-b,-n);tempQuad$jscomp$8.setFromRect(tempRect$jscomp$13);const [p,r]=a.GetRenderTargetSize(a.GetRenderTarget());this._runtime.GetCanvasManager().SetDeviceTransform(a,p,r);a.SetTexture(d);a.Quad3(tempQuad$jscomp$8,this._rendererText.GetTexRect());c._SetTransform(a)}else a.SetTexture(d),
b.HasMesh()?this._DrawMesh(b,a):this._DrawStandard(b,a)}}_DrawStandard(a,b){a=a.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(a=this._PixelRoundQuad(a));b.Quad3(a,this._rendererText.GetTexRect())}_DrawMesh(a,b){const d=a.GetTransformedMesh();if(a.IsMeshChanged()){a.CalculateBbox(tempRect$jscomp$13,tempQuad$jscomp$8,!1);let c=tempQuad$jscomp$8;this._runtime.IsPixelRoundingEnabled()&&(c=this._PixelRoundQuad(c));d.CalculateTransformedMesh(a.GetSourceMesh(),c,this._rendererText.GetTexRect());
a.SetMeshChanged(!1)}d.Draw(b)}_PixelRoundQuad(a){const b=a.getTlx()-Math.round(a.getTlx()),d=a.getTly()-Math.round(a.getTly());if(0===b&&0===d)return a;tempQuad$jscomp$8.copy(a);tempQuad$jscomp$8.offset(-b,-d);return tempQuad$jscomp$8}GetCurrentSurfaceSize(){const a=this._rendererText.GetTexture();return a?[a.GetWidth(),a.GetHeight()]:[100,100]}GetCurrentTexRect(){return this._rendererText.GetTexRect()}IsCurrentTexRotated(){return!1}SaveToJson(){const a={t:this._text,c:this._color.toJSON(),fn:this._faceName,
ps:this._ptSize};this._enableBBcode&&(a.bbc=this._enableBBcode);0!==this._horizontalAlign&&(a.ha=this._horizontalAlign);0!==this._verticalAlign&&(a.va=this._verticalAlign);this._wrapByWord||(a.wr=this._wrapByWord);0!==this._lineHeightOffset&&(a.lho=this._lineHeightOffset);this._isBold&&(a.b=this._isBold);this._isItalic&&(a.i=this._isItalic);-1!==this._typewriterEndTime&&(a.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength});this._iconObjectClass&&(a.ioc=this._iconObjectClass.GetSID());
return a}LoadFromJson(a){this._CancelTypewriter();this._text=a.t;this._color.setFromJSON(a.c);this._faceName=a.fn;this._ptSize=a.ps;this._enableBBcode=a.hasOwnProperty("bbc")?a.bbc:!1;this._horizontalAlign=a.hasOwnProperty("ha")?a.ha:0;this._verticalAlign=a.hasOwnProperty("va")?a.va:0;this._wrapByWord=a.hasOwnProperty("wr")?a.wr:!0;this._lineHeightOffset=a.hasOwnProperty("lho")?a.lho:0;this._isBold=a.hasOwnProperty("b")?a.b:!1;this._isItalic=a.hasOwnProperty("i")?a.i:!1;if(a.hasOwnProperty("tw")){const b=
a.tw;this._typewriterStartTime=b.st;this._typewriterEndTime=b.en;this._typewriterLength=b.l}a.hasOwnProperty("ioc")?(a=this.GetRuntime().GetObjectClassBySID(a.ioc))&&this._SetIconObjectClass(a):this._SetIconObjectClass(null);this._UpdateTextSettings();this._UpdateScreenReaderText();this._isHtmlStringUpToDate=!1;-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(a){switch(a){case 0:return this.GetText();case 1:return this._enableBBcode;case 2:return this._GetFontFace();case 3:return this._GetFontSize();
case 4:return this._GetLineHeight();case 5:return this._IsBold();case 6:return this._IsItalic();case 7:return TEMP_COLOR_ARRAY$jscomp$1[0]=this._color.getR(),TEMP_COLOR_ARRAY$jscomp$1[1]=this._color.getG(),TEMP_COLOR_ARRAY$jscomp$1[2]=this._color.getB(),TEMP_COLOR_ARRAY$jscomp$1;case 8:return this._GetHAlign();case 9:return this._GetVAlign();case 10:return this._IsWrapByWord()?1:0;case 15:return this._IsReadAloud()}}SetPropertyValueByIndex(a,b){switch(a){case 0:this._SetText(b);break;case 1:if(this._enableBBcode===
!!b)break;this._enableBBcode=!!b;this._UpdateTextSettings();break;case 2:this._SetFontFace(b);break;case 3:this._SetFontSize(b);break;case 4:this._SetLineHeight(b);break;case 5:this._SetBold(b);break;case 6:this._SetItalic(b);break;case 7:a=this._color;if(a.getR()===b[0]&&a.getG()===b[1]&&a.getB()===b[2])break;this._color.setRgb(b[0],b[1],b[2]);this._UpdateTextSettings();break;case 8:this._SetHAlign(b);break;case 9:this._SetVAlign(b);break;case 10:this._SetWrapByWord(0===b)}}SetPropertyColorOffsetValueByIndex(a,
b,d,c){if(0!==b||0!==d||0!==c)switch(a){case 7:this._color.addRgb(b,d,c),this._UpdateTextSettings()}}_SetText(a){this._text!==a&&(this._text=a,this._rendererText.SetText(a),this._UpdateScreenReaderText(),this._isHtmlStringUpToDate=!1,this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(a,b){this._UpdateTextSize();this._SetText(a);this._typewriterStartTime=this._runtime.GetWallTime();this._typewriterEndTime=this._typewriterStartTime+b/this.GetInstance().GetActiveTimeScale();this._typewriterLength=
this._rendererText.GetLengthInGraphemes();this._rendererText.SetDrawMaxCharacterCount(0);this._StartTicking()}_CancelTypewriter(){this._typewriterEndTime=this._typewriterStartTime=-1;this._typewriterLength=0;this._rendererText.SetDrawMaxCharacterCount(-1);this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(C3$jscomp$229.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetFontFace(a){this._faceName!==a&&(this._faceName=
a,this._rendererText.SetFontName(a),this._runtime.UpdateRender())}_GetFontFace(){return this._faceName}_SetBold(a){a=!!a;this._isBold!==a&&(this._isBold=a,this._rendererText.SetBold(a),this._runtime.UpdateRender())}_IsBold(){return this._isBold}_SetItalic(a){a=!!a;this._isItalic!==a&&(this._isItalic=a,this._rendererText.SetItalic(a),this._runtime.UpdateRender())}_IsItalic(){return this._isItalic}_SetFontSize(a){this._ptSize!==a&&(this._ptSize=a,this._runtime.UpdateRender())}_GetFontSize(){return this._ptSize}_SetFontColor(a){this._color.equalsIgnoringAlpha(a)||
(this._color.copyRgb(a),this._rendererText.SetColor(this._color),this._runtime.UpdateRender())}_GetFontColor(){return this._color}_SetLineHeight(a){this._lineHeightOffset!==a&&(this._lineHeightOffset=a,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeightOffset}_SetHAlign(a){this._horizontalAlign!==a&&(this._horizontalAlign=a,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(a){this._verticalAlign!==
a&&(this._verticalAlign=a,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapByWord(a){a=!!a;this._wrapByWord!==a&&(this._wrapByWord=a,this._UpdateTextSettings(),this._runtime.UpdateRender())}_IsWrapByWord(){return this._wrapByWord}_SetTextDirection(a){this._textDirection!==a&&(this._textDirection=a,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetTextDirection(){return this._textDirection}_SetReadAloud(a){this._readAloud=!!a;this._UpdateScreenReaderText()}_IsReadAloud(){return this._readAloud}_GetTextWidth(){this._UpdateTextSize();
return this._rendererText.GetTextWidth()}_GetTextHeight(){this._UpdateTextSize();return this._rendererText.GetTextHeight()}_GetTagAtPosition(a,b){this._UpdateTextSize();const d=this.GetWorldInfo();tempVec2$jscomp$2.set(a-d.GetX(),b-d.GetY());tempVec2$jscomp$2.rotate(-d.GetAngle());tempVec2$jscomp$2.offset(d.GetWidth()*d.GetOriginX(),d.GetHeight()*d.GetOriginY());tempVec2$jscomp$2.divide(d.GetWidth(),d.GetHeight());tempVec2$jscomp$2.scale(this._rendererText.GetWidth(),this._rendererText.GetHeight());
if(a=this._rendererText.HitTestFragment(tempVec2$jscomp$2.getX(),tempVec2$jscomp$2.getY()))if(a=a.GetStyleTag("tag"))return a.param;return""}_HasTagAtPosition(a,b,d){return(b=this._GetTagAtPosition(b,d))&&C3$jscomp$229.equalsNoCase(a,b)}_GetTagPosition(a,b){this._UpdateTextSize();b=Math.floor(b);var d=this._rendererText.FindFragmentWithTag(a,b);if(!d)return null;a=this.GetWorldInfo();const c=this._rendererText.GetDrawScale();b=d.GetPosX();const e=d.GetPosY()-(d.GetHeight()-d.GetFontBoundingBoxDescent())*
c,g=d.GetWidth()*c/this._rendererText.GetWidth()*a.GetWidth();d=d.GetHeight()*c/this._rendererText.GetHeight()*a.GetHeight();tempVec2$jscomp$2.set(b,e);tempVec2$jscomp$2.divide(this._rendererText.GetWidth(),this._rendererText.GetHeight());tempVec2$jscomp$2.scale(a.GetWidth(),a.GetHeight());tempVec2$jscomp$2.offset(-a.GetWidth()*a.GetOriginX(),-a.GetHeight()*a.GetOriginY());tempVec2$jscomp$2.rotate(a.GetAngle());tempVec2$jscomp$2.offset(a.GetX(),a.GetY());return{x:tempVec2$jscomp$2.getX(),y:tempVec2$jscomp$2.getY(),
width:g,height:d}}_GetTagCount(a){this._UpdateTextSize();return this._rendererText.CountFragmentsWithTag(a)}_GetHTMLCloseTag(a){a=BBCODE_TAG_TO_HTML.get(a);if(null===a)return"";a||(a="span");return`</${a||"span"}>`}_GetHTMLOpenTag(a,b){let d=BBCODE_TAG_TO_HTML.get(a);if(null===d)return"";d||(d="span");switch(a){case "color":return`<${d} style="color: ${b}">`;case "font":return`<${d} style="font-family: '${b}'">`;case "opacity":return`<${d} style="opacity: ${b}%">`;case "size":return`<${d} style="font-size: ${b}pt">`;
case "background":return`<${d} style="background-color: ${b}">`;case "hide":return`<${d} style="visibility: hidden">`;case "class":return`<${d} class="${b}">`;case "tag":return`<${d} data-tag="${b}">`;default:return`<${d}>`}}async _UpdateHTMLString(){if(this._isHtmlStringUpToDate)return this._htmlString;var a=(new C3$jscomp$229.BBString(this._text,{noEscape:!0})).toFragmentList();const b=new Map;let d='<span class="c3-text"';var c=[];c.push(`font-family: '${this._GetFontFace()}';`);this._IsBold()&&
c.push("font-weight: bold;");this._IsItalic()&&c.push("font-style: italic;");this._IsWrapByWord()||c.push("word-break: break-all;");d+=` style="${c.join(" ")}">`;c=this._iconObjectClass?this.GetRuntime().GetTextIconSet(this._iconObjectClass):null;if(this._iconObjectClass){var e=C3$jscomp$229.New(C3$jscomp$229.PromiseThrottle),g=[];const r=new Map;for(var k of a)if(k.IsIcon()){const w=k.GetTextIcon(c);if(w){const z=w.GetSource().GetImageInfo().GetImageAsset();r.has(z)||(r.set(z,null),g.push(e.Add(async()=>
{const B=await z.LoadToDrawable();r.set(z,B)})))}}await Promise.all(g);k=[];for(var l of a)if(l.IsIcon()){const w=l.GetTextIcon(c);if(w){const z=w.GetSource(),B=z.GetImageInfo().GetImageAsset();k.push(e.Add(async()=>{const C=await z.GetImageInfo().ExtractImageToBlobURL(r.get(B));b.set(w,C)}))}}await Promise.all(k);for(var n of r.values())n instanceof ImageBitmap&&n.close&&n.close()}l=new Map;for(var p of a){k=p.GetStyleMap();a=[...l.keys()];a.reverse();for(const r of a)k.has(r)&&k.get(r)===l.get(r)||
(l.delete(r),d+=this._GetHTMLCloseTag(r));for(const [r,w]of k)l.has(r)||(l.set(r,w),d+=this._GetHTMLOpenTag(r,w));p.IsText()&&(d+=C3$jscomp$229.ReplaceAll(C3$jscomp$229.EscapeHTML(p.GetCharacterArray().join("")),"\n","<br>"));if(p.IsIcon()&&c&&(a=p.GetTextIcon(c))&&(n=b.get(a))){e=[];g="0.2em";if(k=k.get("iconoffsety"))k=k.trim(),g=k.endsWith("%")?parseFloat(k)/100+"em":k+"px";e.push(`top: ${g}`);"nearest"===this._runtime.GetSampling()&&e.push("image-rendering: pixelated");d+=`<img class="c3-text-icon" data-icon="${p.GetIconParameter()}" width="${a.GetWidth()}" height="${a.GetHeight()}" style="${e.join(";")}" src="${n}">`}}p=
[...l.keys()];p.reverse();for(const r of p)d+=this._GetHTMLCloseTag(r);this._htmlString=d+"</span>";this._isHtmlStringUpToDate=!0;return this._htmlString}Tick(){var a=this._runtime.GetWallTime();a>=this._typewriterEndTime?(this._CancelTypewriter(),this.Trigger(C3$jscomp$229.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender()):(a=C3$jscomp$229.relerp(this._typewriterStartTime,this._typewriterEndTime,a,0,this._typewriterLength),a=Math.floor(a),a!==this._rendererText.GetDrawMaxCharacterCount()&&
(this._rendererText.SetDrawMaxCharacterCount(a),this._runtime.UpdateRender()))}GetDebuggerProperties(){return[{title:"plugins.text.name",properties:[{name:"plugins.text.properties.text.name",value:this.GetText(),onedit:a=>this._SetText(a)},{name:"plugins.text.properties.font.name",value:this._GetFontFace(),onedit:a=>this._SetFontFace(a)},{name:"plugins.text.properties.size.name",value:this._GetFontSize(),onedit:a=>this._SetFontSize(a)},{name:"plugins.text.properties.line-height.name",value:this._GetLineHeight(),
onedit:a=>this._SetLineHeight(a)},{name:"plugins.text.properties.bold.name",value:this._IsBold(),onedit:a=>this._SetBold(a)},{name:"plugins.text.properties.italic.name",value:this._IsItalic(),onedit:a=>this._SetItalic(a)}]}]}GetScriptInterfaceClass(){return self.ITextInstance}};
const map$jscomp$32=new WeakMap,SCRIPT_HORIZONTAL_ALIGNMENTS=new Map([["left",0],["center",1],["right",2]]),SCRIPT_VERTICAL_ALIGNMENTS=new Map([["top",0],["center",1],["bottom",2]]),SCRIPT_WRAP_MODES=new Map([["word",!0],["character",!1]]),SCRIPT_TEXT_DIRECTIONS=["ltr","rtl"];
self.ITextInstance=class extends self.IWorldInstance{constructor(){super();map$jscomp$32.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return map$jscomp$32.get(this).GetText()}set text(a){C3X$jscomp$38.RequireString(a);const b=map$jscomp$32.get(this);b._CancelTypewriter();b._SetText(a)}typewriterText(a,b){C3X$jscomp$38.RequireString(a);C3X$jscomp$38.RequireFiniteNumber(b);const d=map$jscomp$32.get(this);d._CancelTypewriter();d._StartTypewriter(a,b)}typewriterFinish(){map$jscomp$32.get(this)._FinishTypewriter()}set fontFace(a){C3X$jscomp$38.RequireString(a);
map$jscomp$32.get(this)._SetFontFace(a)}get fontFace(){return map$jscomp$32.get(this)._GetFontFace()}set isBold(a){map$jscomp$32.get(this)._SetBold(a)}get isBold(){return map$jscomp$32.get(this)._IsBold()}set isItalic(a){map$jscomp$32.get(this)._SetItalic(a)}get isItalic(){return map$jscomp$32.get(this)._IsItalic()}set sizePt(a){C3X$jscomp$38.RequireFiniteNumber(a);map$jscomp$32.get(this)._SetFontSize(a)}get sizePt(){return map$jscomp$32.get(this)._GetFontSize()}set fontColor(a){C3X$jscomp$38.RequireArray(a);
if(3>a.length)throw Error("expected 3 elements");tempColor$jscomp$8.setRgb(a[0],a[1],a[2]);map$jscomp$32.get(this)._SetFontColor(tempColor$jscomp$8)}get fontColor(){const a=map$jscomp$32.get(this)._GetFontColor();return[a.getR(),a.getG(),a.getB()]}set lineHeight(a){C3X$jscomp$38.RequireFiniteNumber(a);map$jscomp$32.get(this)._SetLineHeight(a)}get lineHeight(){return map$jscomp$32.get(this)._GetLineHeight()}set horizontalAlign(a){C3X$jscomp$38.RequireString(a);a=SCRIPT_HORIZONTAL_ALIGNMENTS.get(a);
if("undefined"===typeof a)throw Error("invalid mode");map$jscomp$32.get(this)._SetHAlign(a)}get horizontalAlign(){return HORIZONTAL_ALIGNMENTS[map$jscomp$32.get(this)._GetHAlign()]}set verticalAlign(a){C3X$jscomp$38.RequireString(a);a=SCRIPT_VERTICAL_ALIGNMENTS.get(a);if("undefined"===typeof a)throw Error("invalid mode");map$jscomp$32.get(this)._SetVAlign(a)}get verticalAlign(){return VERTICAL_ALIGNMENTS[map$jscomp$32.get(this)._GetVAlign()]}set wordWrapMode(a){C3X$jscomp$38.RequireString(a);a=SCRIPT_WRAP_MODES.get(a);
if("undefined"===typeof a)throw Error("invalid mode");map$jscomp$32.get(this)._SetWrapByWord(a)}get wordWrapMode(){return map$jscomp$32.get(this)._IsWrapByWord()?"word":"character"}set textDirection(a){C3X$jscomp$38.RequireString(a);a=SCRIPT_TEXT_DIRECTIONS.indexOf(a);if(-1===a)throw Error("invalid text direction");map$jscomp$32.get(this)._SetTextDirection(a)}get textDirection(){return SCRIPT_TEXT_DIRECTIONS[map$jscomp$32.get(this)._GetTextDirection()]}set readAloud(a){map$jscomp$32.get(this)._SetReadAloud(!!a)}get readAloud(){return map$jscomp$32.get(this)._IsReadAloud()}get textWidth(){return map$jscomp$32.get(this)._GetTextWidth()}get textHeight(){return map$jscomp$32.get(this)._GetTextHeight()}getTextSize(){const a=
map$jscomp$32.get(this);return[a._GetTextWidth(),a._GetTextHeight()]}hasTagAtPosition(a,b,d){C3X$jscomp$38.RequireString(a);C3X$jscomp$38.RequireFiniteNumber(b);C3X$jscomp$38.RequireFiniteNumber(d);return map$jscomp$32.get(this)._HasTagAtPosition(a,b,d)}getTagAtPosition(a,b){C3X$jscomp$38.RequireFiniteNumber(a);C3X$jscomp$38.RequireFiniteNumber(b);return map$jscomp$32.get(this)._GetTagAtPosition(a,b)}getTagPositionAndSize(a,b=0){C3X$jscomp$38.RequireString(a);C3X$jscomp$38.RequireFiniteNumber(b);
return map$jscomp$32.get(this)._GetTagPosition(a,b)}getTagCount(a){C3X$jscomp$38.RequireString(a);return map$jscomp$32.get(this)._GetTagCount(a)}changeIconSet(a){const b=map$jscomp$32.get(this);a=b.GetRuntime()._UnwrapIObjectClass(a);b._SetIconObjectClass(a)}getAsHtmlString(){return map$jscomp$32.get(this)._UpdateHTMLString()}};const C3$jscomp$230=self.C3;
C3$jscomp$230.Plugins.Text.Cnds={CompareText(a,b){return b?this._text===a:C3$jscomp$230.equalsNoCase(this._text,a)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished(){return!0},HasTagAtPosition(a,b,d){return this._HasTagAtPosition(a,b,d)}};const C3$jscomp$231=self.C3,tempColor$jscomp$9=C3$jscomp$231.New(C3$jscomp$231.Color);
C3$jscomp$231.Plugins.Text.Acts={SetText(a){this._CancelTypewriter();"number"===typeof a&&1E9>a&&(a=Math.round(1E10*a)/1E10);this._SetText(a.toString())},AppendText(a){this._CancelTypewriter();"number"===typeof a&&1E9>a&&(a=Math.round(1E10*a)/1E10);(a=a.toString())&&this._SetText(this._text+a)},TypewriterText(a,b){this._CancelTypewriter();"number"===typeof a&&1E9>a&&(a=Math.round(1E10*a)/1E10);this._StartTypewriter(a.toString(),b)},SetFontFace(a,b){let d=!1,c=!1;switch(b){case 1:d=!0;break;case 2:c=
!0;break;case 3:c=d=!0}if(a!==this._faceName||d!==this._isBold||c!==this._isItalic)this._SetFontFace(a),this._SetBold(d),this._SetItalic(c)},SetFontSize(a){this._SetFontSize(a)},SetFontColor(a){tempColor$jscomp$9.setFromRgbValue(a);tempColor$jscomp$9.clamp();this._SetFontColor(tempColor$jscomp$9)},SetWebFont(a,b){console.warn("[Text] 'Set web font' action is deprecated and no longer has any effect")},SetEffect(a){this.GetWorldInfo().SetBlendMode(a);this._runtime.UpdateRender()},TypewriterFinish(){this._FinishTypewriter()},
SetLineHeight(a){this._SetLineHeight(a)},SetHAlign(a){this._SetHAlign(a)},SetVAlign(a){this._SetVAlign(a)},SetWrapping(a){this._SetWrapByWord(0===a)},SetTextDirection(a){this._SetTextDirection(a)},ChangeIconSet(a){this._SetIconObjectClass(a)},UpdateHTML(){return this._UpdateHTMLString()},SetReadAloud(a){this._SetReadAloud(a)}};const C3$jscomp$232=self.C3;
C3$jscomp$232.Plugins.Text.Exps={Text(){return this._text},PlainText(){return this._enableBBcode?C3$jscomp$232.BBString.StripAnyTags(this._text):this._text},FaceName(){return this._faceName},FaceSize(){return this._ptSize},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()},LineHeight(){return this._lineHeightOffset},TagAtPosition(a,b){return this._GetTagAtPosition(a,b)},TagCount(a){return this._GetTagCount(a)},TagX(a,b){return(a=this._GetTagPosition(a,b))?a.x:0},TagY(a,
b){return(a=this._GetTagPosition(a,b))?a.y:0},TagWidth(a,b){return(a=this._GetTagPosition(a,b))?a.width:0},TagHeight(a,b){return(a=this._GetTagPosition(a,b))?a.height:0},AsHTML(){return this._htmlString}};"use strict";const C3$jscomp$233=self.C3;C3$jscomp$233.Plugins.AJAX=class extends C3$jscomp$233.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};const C3$jscomp$234=self.C3;C3$jscomp$234.Plugins.AJAX.Type=class extends C3$jscomp$234.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};
const C3$jscomp$235=self.C3;
C3$jscomp$235.Plugins.AJAX.Instance=class extends C3$jscomp$235.SDKInstanceBase{constructor(a,b){super(a);this._lastData="";this._lastStatusCode=0;this._curTag="";this._progress=0;this._timeout=-1;this._nextRequestHeaders=new Map;this._nextReponseBinaryData=null;this._nextRequestOverrideMimeType="";this._nextRequestWithCredentials=!1;this._nwjsAppFolder=this._nwjsPath=this._nwjsFs=null;if(this._isNWjs="nwjs"===this._runtime.GetExportType())this._nwjsFs=require("fs"),this._nwjsPath=require("path"),
this._nwjsAppFolder=this._nwjsPath.dirname((self.process||nw.process).execPath)+"\\"}Release(){super.Release()}async _TriggerError(a,b,d){console.error(`[Construct] AJAX request to '${b}' (tag '${a}') failed: `,d);this._curTag=a;await this.TriggerAsync(C3$jscomp$235.Plugins.AJAX.Cnds.OnAnyError);this._curTag=a;await this.TriggerAsync(C3$jscomp$235.Plugins.AJAX.Cnds.OnError)}async _TriggerComplete(a){this._curTag=a;await this.TriggerAsync(C3$jscomp$235.Plugins.AJAX.Cnds.OnAnyComplete);this._curTag=
a;await this.TriggerAsync(C3$jscomp$235.Plugins.AJAX.Cnds.OnComplete)}async _OnProgress(a,b){b.lengthComputable&&(this._progress=b.loaded/b.total,this._curTag=a,await this.TriggerAsync(C3$jscomp$235.Plugins.AJAX.Cnds.OnProgress))}_OnError(a,b,d){if(this._isNWjs){var c=this._nwjsFs,e=this._nwjsAppFolder+b;c.existsSync(e)?c.readFile(e,{encoding:"utf8"},(g,k)=>{g?this._TriggerError(a,b,g):(this._lastData=k.replace(/\r\n/g,"\n"),this._TriggerComplete(a))}):this._TriggerError(a,b,d)}else this._TriggerError(a,
b,d)}async _DoCordovaRequest(a,b){const d=this._runtime.GetAssetManager(),c=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{if(c){const e=await d.CordovaFetchLocalFileAsArrayBuffer(b);c.SetArrayBufferTransfer(e);this._lastData=""}else this._lastData=(await d.CordovaFetchLocalFileAsText(b)).replace(/\r\n/g,"\n");this._lastStatusCode=0;this._TriggerComplete(a)}catch(e){this._TriggerError(a,b,e)}}_DoRequest(a,b,d,c){return new Promise(e=>{const g=l=>{this._OnError(a,b,l);e()},k=this._nextReponseBinaryData;
this._nextReponseBinaryData=null;try{const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(4===l.readyState){this._lastData=k?"":(l.responseText||"").replace(/\r\n/g,"\n");this._lastStatusCode=l.status;if(400<=l.status)this._TriggerError(a,b,l.status+l.statusText);else{const n=this._lastData.length||k&&l.response instanceof ArrayBuffer;this._isNWjs&&!n||!this._isNWjs&&0===l.status&&!n||(k&&k.SetArrayBufferTransfer(l.response),this._TriggerComplete(a))}e()}};l.onerror=g;l.ontimeout=g;l.onabort=g;
l.onprogress=n=>this._OnProgress(a,n);l.open(d,b);0<=this._timeout&&"undefined"!==typeof l.timeout&&(l.timeout=this._timeout);l.responseType=k?"arraybuffer":"text";c&&!this._nextRequestHeaders.has("Content-Type")&&("string"!==typeof c?l.setRequestHeader("Content-Type","application/octet-stream"):l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));for(const [n,p]of this._nextRequestHeaders)try{l.setRequestHeader(n,p)}catch(r){console.error(`[Construct] AJAX: Failed to set header '${n}: ${p}': `,
r)}this._nextRequestHeaders.clear();if(this._nextRequestOverrideMimeType){try{l.overrideMimeType(this._nextRequestOverrideMimeType)}catch(n){console.error("[Construct] AJAX: failed to override MIME type: ",n)}this._nextRequestOverrideMimeType=""}this._nextRequestWithCredentials&&(l.withCredentials=!0,this._nextRequestWithCredentials=!1);c?l.send(c):l.send()}catch(l){g(l)}})}GetDebuggerProperties(){return[{title:"plugins.ajax.debugger.title",properties:[{name:"plugins.ajax.debugger.last-status-code",
value:this._lastStatusCode},{name:"plugins.ajax.debugger.last-data",value:this._lastData}]}]}SaveToJson(){return{lastData:this._lastData,lastStatusCode:this._lastStatusCode}}LoadFromJson(a){this._lastData=a.lastData;this._lastStatusCode=a.hasOwnProperty("lastStatusCode")?a.lastStatusCode:0;this._curTag="";this._progress=0}};const C3$jscomp$236=self.C3;
C3$jscomp$236.Plugins.AJAX.Cnds={OnComplete(a){return C3$jscomp$236.equalsNoCase(this._curTag,a)},OnAnyComplete(){return!0},OnError(a){return C3$jscomp$236.equalsNoCase(this._curTag,a)},OnAnyError(){return!0},OnProgress(a){return C3$jscomp$236.equalsNoCase(this._curTag,a)}};const C3$jscomp$237=self.C3;
C3$jscomp$237.Plugins.AJAX.Acts={async Request(a,b){this._runtime.IsCordova()&&C3$jscomp$237.IsRelativeURL(b)&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(a,b):this._runtime.IsPreview()&&C3$jscomp$237.IsRelativeURL(b)?(b=this._runtime.GetAssetManager().GetLocalUrlAsBlobUrl(b),await this._DoRequest(a,b,"GET",null)):await this._DoRequest(a,b,"GET",null)},async RequestFile(a,b){this._runtime.IsCordova()&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(a,
b):await this._DoRequest(a,this._runtime.GetAssetManager().GetLocalUrlAsBlobUrl(b),"GET",null)},async Post(a,b,d,c){await this._DoRequest(a,b,c,d)},async PostBinary(a,b,d,c){d&&(d=d.GetFirstPicked(this._inst))&&(d=d.GetSdkInstance().GetArrayBufferReadOnly(),await this._DoRequest(a,b,c,d))},SetTimeout(a){this._timeout=1E3*a},SetHeader(a,b){this._nextRequestHeaders.set(a,b)},SetResponseBinary(a){a&&(a=a.GetFirstPicked(this._inst))&&(this._nextReponseBinaryData=a.GetSdkInstance())},OverrideMIMEType(a){this._nextRequestOverrideMimeType=
a},SetWithCredentials(a){this._nextRequestWithCredentials=!!a}};self.C3.Plugins.AJAX.Exps={LastData(){return this._lastData},LastStatusCode(){return this._lastStatusCode},Progress(){return this._progress},Tag(){return this._curTag}};"use strict";const C3$jscomp$239=self.C3;C3$jscomp$239.Plugins.Dictionary=class extends C3$jscomp$239.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};const C3$jscomp$240=self.C3;C3$jscomp$240.Plugins.Dictionary.Type=class extends C3$jscomp$240.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};
const C3$jscomp$241=self.C3,IInstance$jscomp$3=self.IInstance;
C3$jscomp$241.Plugins.Dictionary.Instance=class extends C3$jscomp$241.SDKInstanceBase{constructor(a,b){super(a);this._data=new Map;this._curKey=""}Release(){this._data.clear();super.Release()}GetAsJsonString(){return JSON.stringify({c2dictionary:!0,data:C3$jscomp$241.MapToObject(this._data)})}GetDataMap(){return this._data}SaveToJson(){return C3$jscomp$241.MapToObject(this._data)}LoadFromJson(a){C3$jscomp$241.ObjectToMap(a,this._data)}GetDebuggerProperties(){return[{title:"plugins.dictionary.name",properties:[{name:"plugins.dictionary.debugger.key-count",
value:this._data.size},...[...this._data].map(a=>({name:"$"+a[0],value:a[1],onedit:b=>this._data.set(a[0],b)}))]}]}GetScriptInterfaceClass(){return self.IDictionaryInstance}};const map$jscomp$33=new WeakMap;self.IDictionaryInstance=class extends IInstance$jscomp$3{constructor(){super();map$jscomp$33.set(this,IInstance$jscomp$3._GetInitInst().GetSdkInstance())}getDataMap(){return map$jscomp$33.get(this).GetDataMap()}};const C3$jscomp$242=self.C3;
C3$jscomp$242.Plugins.Dictionary.Cnds={CompareValue(a,b,d){a=this._data.get(a);return"undefined"===typeof a?!1:C3$jscomp$242.compare(a,b,d)},ForEachKey(){const a=this._runtime,b=a.GetEventSheetManager(),d=a.GetCurrentEvent(),c=d.GetSolModifiers(),e=a.GetEventStack(),g=e.GetCurrentStackFrame(),k=e.Push(d);a.SetDebuggingEnabled(!1);for(const l of this._data.keys())this._curKey=l,b.PushCopySol(c),this.GetObjectClass().GetCurrentSol().PickOne(this.GetInstance()),d.Retrigger(g,k),b.PopSol(c);a.SetDebuggingEnabled(!0);
this._curKey="";e.Pop();return!1},CompareCurrentValue(a,b){const d=this._data.get(this._curKey);return"undefined"===typeof d?!1:C3$jscomp$242.compare(d,a,b)},HasKey(a){return this._data.has(a)},IsEmpty(){return 0===this._data.size}};const C3$jscomp$243=self.C3;
C3$jscomp$243.Plugins.Dictionary.Acts={AddKey(a,b){this._data.set(a,b)},SetKey(a,b){this._data.has(a)&&this._data.set(a,b)},DeleteKey(a){this._data.delete(a)},Clear(){this._data.clear()},JSONLoad(a){let b=null;try{b=JSON.parse(a)}catch(d){console.error("[Construct] Error parsing JSON: ",d);return}b.c2dictionary&&C3$jscomp$243.ObjectToMap(b.data,this._data)},JSONDownload(a){const b=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(b,a)}};
self.C3.Plugins.Dictionary.Exps={Get(a){a=this._data.get(a);return"undefined"===typeof a?0:a},GetDefault(a,b){a=this._data.get(a);return"undefined"===typeof a?b:a},KeyCount(){return this._data.size},CurrentKey(){return this._curKey},CurrentValue(){return this._data.get(this._curKey)??0},AsJSON(){return this.GetAsJsonString()}};"use strict";const C3$jscomp$245=self.C3;C3$jscomp$245.Plugins.Touch=class extends C3$jscomp$245.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};
const C3$jscomp$246=self.C3,C3X$jscomp$40=self.C3X;C3$jscomp$246.Plugins.Touch.Type=class extends C3$jscomp$246.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}};let touchObjectType=null;function GetTouchSdkInstance(){return touchObjectType.GetSingleGlobalInstance().GetSdkInstance()}
self.ITouchObjectType=class extends self.IObjectClass{constructor(a){super(a);touchObjectType=a;a.GetRuntime()._GetCommonScriptInterfaces().touch=this}requestPermission(a){C3X$jscomp$40.RequireString(a);const b=GetTouchSdkInstance();if("orientation"===a)return b._RequestPermission(0);if("motion"===a)return b._RequestPermission(1);throw Error("invalid type");}};const C3$jscomp$247=self.C3;
C3$jscomp$247.Plugins.Touch.Instance=class extends C3$jscomp$247.SDKInstanceBase{constructor(a,b){super(a,"touch");this._touches=new Map;this._isMouseDown=this._useMouseInput=!1;this._triggerType=this._getTouchIndex=this._curTouchY=this._curTouchX=this._triggerPermission=this._triggerId=this._triggerIndex=this._accWithGZ=this._accWithGY=this._accWithGX=this._accZ=this._accY=this._accX=this._orientGamma=this._orientBeta=this._orientAlpha=this._orientCompassHeading=0;this._permissionPromises=[];b&&
(this._useMouseInput=b[0]);this.AddDOMMessageHandler("permission-result",d=>this._OnPermissionResult(d));a=this.GetRuntime().Dispatcher();this._disposables=new C3$jscomp$247.CompositeDisposable(C3$jscomp$247.Disposable.From(a,"pointerdown",d=>this._OnPointerDown(d.data)),C3$jscomp$247.Disposable.From(a,"pointermove",d=>this._OnPointerMove(d.data)),C3$jscomp$247.Disposable.From(a,"pointerup",d=>this._OnPointerUp(d.data,!1)),C3$jscomp$247.Disposable.From(a,"pointercancel",d=>this._OnPointerUp(d.data,
!0)),C3$jscomp$247.Disposable.From(a,"deviceorientation",d=>this._OnDeviceOrientation(d.data)),C3$jscomp$247.Disposable.From(a,"deviceorientationabsolute",d=>this._OnDeviceOrientationAbsolute(d.data)),C3$jscomp$247.Disposable.From(a,"devicemotion",d=>this._OnDeviceMotion(d.data)),C3$jscomp$247.Disposable.From(a,"tick2",d=>this._OnTick2()))}Release(){this._touches.clear();super.Release()}_OnPointerDown(a){if("mouse"===a.pointerType)if(this._useMouseInput)this._isMouseDown=!0;else return;const b=a.pointerId;
if(!this._touches.has(b)){var d=a.pageX-this._runtime.GetCanvasClientX();a=a.pageY-this._runtime.GetCanvasClientY();var c=performance.now(),e=this._touches.size;this._triggerIndex=e;this._triggerId=b;var g=C3$jscomp$247.New(C3$jscomp$247.Plugins.Touch.TouchInfo);g.Init(c,d,a,b,e);this._touches.set(b,g);this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnNthTouchStart);this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnTouchStart);this._curTouchX=d;this._curTouchY=a;this._triggerType=0;this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnTouchObject)}}_OnPointerMove(a){if("mouse"!==
a.pointerType||this._isMouseDown){var b=this._touches.get(a.pointerId);if(b){var d=performance.now();if(!(2>d-b.GetTime())){var c=a.pageX-this._runtime.GetCanvasClientX(),e=a.pageY-this._runtime.GetCanvasClientY();b.Update(d,c,e,a.width,a.height,a.pressure)}}}}_OnPointerUp(a,b){if("mouse"===a.pointerType)if(this._isMouseDown)this._isMouseDown=!1;else return;const d=performance.now(),c=a.pointerId,e=this._touches.get(c);if(e){this._triggerIndex=e.GetStartIndex();this._triggerId=e.GetId();if(!b){const g=
a.pageX-this._runtime.GetCanvasClientX();a=a.pageY-this._runtime.GetCanvasClientY();this._curTouchX=g;this._curTouchY=a;this._triggerType=1;this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnTouchObject)}this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnNthTouchEnd);this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnTouchEnd);b||(b=e.ShouldTriggerTap(d),"single-tap"===b?(this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnTapGesture),this._curTouchX=e.GetX(),this._curTouchY=e.GetY(),this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnTapGestureObject)):
"double-tap"===b&&(this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnDoubleTapGesture),this._curTouchX=e.GetX(),this._curTouchY=e.GetY(),this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnDoubleTapGestureObject)));e.Release();this._touches.delete(c)}}_RequestPermission(a){this._PostToDOMMaybeSync("request-permission",{type:a});return new Promise((b,d)=>{this._permissionPromises.push({type:a,resolve:b,reject:d})})}_OnPermissionResult(a){const b=a.result,d=a.type;this._triggerPermission=d;a=this._permissionPromises.filter(c=>
c.type===d);for(const c of a)c.resolve(b?"granted":"denied");this._permissionPromises=this._permissionPromises.filter(c=>c.type!==d);b?(this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnPermissionGranted),0===d?this._runtime.RequestDeviceOrientationEvent():this._runtime.RequestDeviceMotionEvent()):this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(a){"number"===typeof a.webkitCompassHeading?this._orientCompassHeading=a.webkitCompassHeading:a.absolute&&(this._orientCompassHeading=
a.alpha);this._orientAlpha=a.alpha;this._orientBeta=a.beta;this._orientGamma=a.gamma}_OnDeviceOrientationAbsolute(a){this._orientCompassHeading=a.alpha}_OnDeviceMotion(a){const b=a.acceleration;b&&(this._accX=b.x,this._accY=b.y,this._accZ=b.z);if(a=a.accelerationIncludingGravity)this._accWithGX=a.x,this._accWithGY=a.y,this._accWithGZ=a.z}_OnTick2(){const a=performance.now();let b=0;for(const d of this._touches.values())d.GetTime()<=a-50&&d._SetLastTime(a),d.ShouldTriggerHold(a)&&(this._triggerIndex=
d.GetStartIndex(),this._triggerId=d.GetId(),this._getTouchIndex=b,this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnHoldGesture),this._curTouchX=d.GetX(),this._curTouchY=d.GetY(),this.Trigger(C3$jscomp$247.Plugins.Touch.Cnds.OnHoldGestureObject),this._getTouchIndex=0),++b}_GetTouchByIndex(a){a=Math.floor(a);for(const b of this._touches.values()){if(0===a)return b;--a}return null}_IsClientPosOnCanvas(a,b){return 0<=a&&0<=b&&a<this._runtime.GetCanvasCssWidth()&&b<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){return[{title:"plugins.touch.debugger.touches",
properties:[...this._touches.values()].map(a=>({name:"$"+a.GetId(),value:a.GetX()+", "+a.GetY()}))}]}};const C3$jscomp$248=self.C3;
C3$jscomp$248.Plugins.Touch.Cnds={OnTouchStart(){return!0},OnTouchEnd(){return!0},IsInTouch(){return 0<this._touches.size},OnTouchObject(a,b){return a&&b===this._triggerType&&this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)?this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(a,[[this._curTouchX,this._curTouchY]],!1):!1},IsTouchingObject(a){if(!a)return!1;const b=this._runtime.GetCurrentCondition().IsInverted(),d=[...this._touches.values()].filter(c=>this._IsClientPosOnCanvas(c.GetX(),
c.GetY())).map(c=>[c.GetX(),c.GetY()]);return C3$jscomp$248.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(a,d,b),b)},CompareTouchSpeed(a,b,d){return(a=this._GetTouchByIndex(a))?C3$jscomp$248.compare(a.GetSpeed(),b,d):!1},OrientationSupported(){return!0},MotionSupported(){return!0},CompareOrientation(a,b,d){this._runtime.RequestDeviceOrientationEvent();return C3$jscomp$248.compare(0===a?this._orientAlpha:1===a?this._orientBeta:this._orientGamma,b,d)},CompareAcceleration(a,
b,d){this._runtime.RequestDeviceMotionEvent();return C3$jscomp$248.compare(0===a?this._accWithGX:1===a?this._accWithGY:2===a?this._accWithGZ:3===a?this._accX:4===a?this._accY:this._accZ,b,d)},OnNthTouchStart(a){a=Math.floor(a);return a===this._triggerIndex},OnNthTouchEnd(a){a=Math.floor(a);return a===this._triggerIndex},HasNthTouch(a){a=Math.floor(a);return this._touches.size>=a+1},OnHoldGesture(){return!0},OnTapGesture(){return!0},OnDoubleTapGesture(){return!0},OnHoldGestureObject(a){return a&&this._IsClientPosOnCanvas(this._curTouchX,
this._curTouchY)?this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(a,[[this._curTouchX,this._curTouchY]],!1):!1},OnTapGestureObject(a){return a&&this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)?this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(a,[[this._curTouchX,this._curTouchY]],!1):!1},OnDoubleTapGestureObject(a){return a&&this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)?this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(a,[[this._curTouchX,
this._curTouchY]],!1):!1},OnPermissionGranted(a){return this._triggerPermission===a},OnPermissionDenied(a){return this._triggerPermission===a}};self.C3.Plugins.Touch.Acts={RequestPermission(a){this._RequestPermission(a)}};const C3$jscomp$250=self.C3;
C3$jscomp$250.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(a){const b=this._GetTouchByIndex(this._getTouchIndex);return b?b.GetPositionForLayer(this._runtime.GetCurrentLayout(),a,!0):0},Y(a){const b=this._GetTouchByIndex(this._getTouchIndex);return b?b.GetPositionForLayer(this._runtime.GetCurrentLayout(),a,!1):0},XAt(a,b){return(a=this._GetTouchByIndex(a))?a.GetPositionForLayer(this._runtime.GetCurrentLayout(),b,!0):0},YAt(a,b){return(a=this._GetTouchByIndex(a))?a.GetPositionForLayer(this._runtime.GetCurrentLayout(),
b,!1):0},XForID(a,b){return(a=this._touches.get(a))?a.GetPositionForLayer(this._runtime.GetCurrentLayout(),b,!0):0},YForID(a,b){return(a=this._touches.get(a))?a.GetPositionForLayer(this._runtime.GetCurrentLayout(),b,!1):0},AbsoluteX(){const a=this._GetTouchByIndex(0);return a?a.GetX():0},AbsoluteY(){const a=this._GetTouchByIndex(0);return a?a.GetY():0},AbsoluteXAt(a){return(a=this._GetTouchByIndex(a))?a.GetX():0},AbsoluteYAt(a){return(a=this._GetTouchByIndex(a))?a.GetY():0},AbsoluteXForID(a){return(a=
this._touches.get(a))?a.GetX():0},AbsoluteYForID(a){return(a=this._touches.get(a))?a.GetY():0},SpeedAt(a){return(a=this._GetTouchByIndex(a))?a.GetSpeed():0},SpeedForID(a){return(a=this._touches.get(a))?a.GetSpeed():0},AngleAt(a){return(a=this._GetTouchByIndex(a))?C3$jscomp$250.toDegrees(a.GetAngle()):0},AngleForID(a){return(a=this._touches.get(a))?C3$jscomp$250.toDegrees(a.GetAngle()):0},CompassHeading(){this._runtime.RequestDeviceOrientationEvent();return this._orientCompassHeading},Alpha(){this._runtime.RequestDeviceOrientationEvent();
return this._orientAlpha},Beta(){this._runtime.RequestDeviceOrientationEvent();return this._orientBeta},Gamma(){this._runtime.RequestDeviceOrientationEvent();return this._orientGamma},AccelerationXWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGX},AccelerationYWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGY},AccelerationZWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGZ},AccelerationX(){this._runtime.RequestDeviceMotionEvent();return this._accX},
AccelerationY(){this._runtime.RequestDeviceMotionEvent();return this._accY},AccelerationZ(){this._runtime.RequestDeviceMotionEvent();return this._accZ},TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(a){return(a=this._touches.get(a))?a.GetWidth():0},HeightForID(a){return(a=this._touches.get(a))?a.GetHeight():0},PressureForID(a){return(a=this._touches.get(a))?a.GetPressure():0}};"use strict";const C3$jscomp$251=self.C3;
let lastTapX=-1E3,lastTapY=-1E3,lastTapTime=-1E4;
C3$jscomp$251.Plugins.Touch.TouchInfo=class extends C3$jscomp$251.DefendedBase{constructor(){super();this._pressure=this._height=this._width=this._lastY=this._lastX=this._y=this._x=this._startY=this._startX=this._lastTime=this._time=this._startTime=this._startIndex=this._pointerId=0;this._isTooFarForHold=this._hasTriggeredHold=!1}Release(){}Init(a,b,d,c,e){this._pointerId=c;this._startIndex=e;this._startTime=this._lastTime=this._time=a;this._startX=b;this._startY=d;this._x=b;this._y=d;this._lastX=
b;this._lastY=d}Update(a,b,d,c,e,g){this._lastTime=this._time;this._time=a;this._lastX=this._x;this._lastY=this._y;this._x=b;this._y=d;this._width=c;this._height=e;this._pressure=g;!this._isTooFarForHold&&15<=C3$jscomp$251.distanceTo(this._startX,this._startY,this._x,this._y)&&(this._isTooFarForHold=!0)}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(a){this._lastTime=a}GetX(){return this._x}GetY(){return this._y}GetSpeed(){const a=C3$jscomp$251.distanceTo(this._x,
this._y,this._lastX,this._lastY),b=(this._time-this._lastTime)/1E3;return 0<b?a/b:0}GetAngle(){return C3$jscomp$251.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(a){return this._hasTriggeredHold?!1:500<=a-this._startTime&&!this._isTooFarForHold&&15>C3$jscomp$251.distanceTo(this._startX,this._startY,this._x,this._y)?this._hasTriggeredHold=!0:!1}ShouldTriggerTap(a){if(this._hasTriggeredHold)return"";
if(333>=a-this._startTime&&!this._isTooFarForHold&&15>C3$jscomp$251.distanceTo(this._startX,this._startY,this._x,this._y)){if(666>=a-lastTapTime&&25>C3$jscomp$251.distanceTo(lastTapX,lastTapY,this._x,this._y))return lastTapY=lastTapX=-1E3,lastTapTime=-1E4,"double-tap";lastTapX=this._x;lastTapY=this._y;lastTapTime=a;return"single-tap"}return""}GetPositionForLayer(a,b,d){return"undefined"===typeof b?a.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(this._x,this._y)[d?0:1]:(a=a.GetLayer(b))?a.CanvasCssToLayer(this._x,
this._y)[d?0:1]:0}};"use strict";const C3$jscomp$252=self.C3;C3$jscomp$252.Plugins.Mouse=class extends C3$jscomp$252.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};const C3$jscomp$253=self.C3,C3X$jscomp$41=self.C3X;C3$jscomp$253.Plugins.Mouse.Type=class extends C3$jscomp$253.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IMouseObjectType}};let mouseObjectType=null;
function GetMouseSdkInstance(){return mouseObjectType.GetSingleGlobalInstance().GetSdkInstance()}
self.IMouseObjectType=class extends self.IObjectClass{constructor(a){super(a);mouseObjectType=a;a.GetRuntime()._GetCommonScriptInterfaces().mouse=this}getMouseX(a){return GetMouseSdkInstance().GetMousePositionForLayer(a)[0]}getMouseY(a){return GetMouseSdkInstance().GetMousePositionForLayer(a)[1]}getMousePosition(a){return GetMouseSdkInstance().GetMousePositionForLayer(a)}isMouseButtonDown(a){return GetMouseSdkInstance().IsMouseButtonDown(a)}setCursorStyle(a){C3X$jscomp$41.RequireString(a);GetMouseSdkInstance().SetCursorStyle(a)}setCursorObjectClass(a){const b=
GetMouseSdkInstance();a=b.GetRuntime()._UnwrapIObjectClass(a);b.SetCursorObjectClass(a)}};const C3$jscomp$254=self.C3;let lastSetCursor=null;
C3$jscomp$254.Plugins.Mouse.Instance=class extends C3$jscomp$254.SDKInstanceBase{constructor(a,b){super(a,"mouse");this._buttonMap=[!1,!1,!1,!1,!1];this._wheelDeltaZ=this._wheelDeltaY=this._wheelDeltaX=this._triggerDir=this._triggerType=this._triggerButton=this._mouseYcanvas=this._mouseXcanvas=0;this._hasPointerLock=!1;this._movementY=this._movementX=0;this.AddDOMMessageHandlers([["pointer-lock-change",d=>this._OnPointerLockChange(d)],["pointer-lock-error",d=>this._OnPointerLockError(d)]]);a=this.GetRuntime().Dispatcher();
this._disposables=new C3$jscomp$254.CompositeDisposable(C3$jscomp$254.Disposable.From(a,"pointermove",d=>this._OnPointerMove(d.data)),C3$jscomp$254.Disposable.From(a,"pointerdown",d=>this._OnPointerDown(d.data)),C3$jscomp$254.Disposable.From(a,"pointerup",d=>this._OnPointerUp(d.data)),C3$jscomp$254.Disposable.From(a,"dblclick",d=>this._OnDoubleClick(d.data)),C3$jscomp$254.Disposable.From(a,"wheel",d=>this._OnMouseWheel(d.data)),C3$jscomp$254.Disposable.From(a,"window-blur",()=>this._OnWindowBlur()))}Release(){super.Release()}_OnPointerDown(a){"mouse"===
a.pointerType&&(this._mouseXcanvas=a.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=a.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(a.lastButtons,a.buttons))}_OnPointerMove(a){this._movementX=a.movementX;this._movementY=a.movementY;this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnMovement);this._movementY=this._movementX=0;"mouse"===a.pointerType&&(this._mouseXcanvas=a.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=a.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(a.lastButtons,
a.buttons))}_OnPointerUp(a){"mouse"===a.pointerType&&this._CheckButtonChanges(a.lastButtons,a.buttons)}_CheckButtonChanges(a,b){this._CheckButtonChange(a,b,1,0);this._CheckButtonChange(a,b,4,1);this._CheckButtonChange(a,b,2,2);this._CheckButtonChange(a,b,8,3);this._CheckButtonChange(a,b,16,4)}_CheckButtonChange(a,b,d,c){!(a&d)&&b&d?this._OnMouseDown(c):a&d&&!(b&d)&&this._OnMouseUp(c)}_OnMouseDown(a){this._buttonMap[a]=!0;this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnAnyClick);this._triggerButton=
a;this._triggerType=0;this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnClick);this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseUp(a){this._buttonMap[a]&&(this._buttonMap[a]=!1,this._triggerButton=a,this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnRelease))}_OnDoubleClick(a){this._triggerButton=a.button;this._triggerType=1;this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnClick);this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseWheel(a){this._triggerDir=0>a.deltaY?
1:0;this._wheelDeltaX=a.deltaX;this._wheelDeltaY=a.deltaY;this._wheelDeltaZ=a.deltaZ;this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnWheel)}_OnWindowBlur(){for(let a=0,b=this._buttonMap.length;a<b&&this._buttonMap[a];++a)this._buttonMap[a]=!1,this._triggerButton=a,this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnRelease)}GetMousePositionForLayer(a){const b=this._runtime.GetMainRunningLayout(),d=this._mouseXcanvas,c=this._mouseYcanvas;return"undefined"===typeof a?b.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(d,
c):(a=b.GetLayer(a))?a.CanvasCssToLayer(d,c):[0,0]}IsMouseButtonDown(a){a=Math.floor(a);return!!this._buttonMap[a]}_IsMouseOverCanvas(){return 0<=this._mouseXcanvas&&0<=this._mouseYcanvas&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight()}SetCursorStyle(a){lastSetCursor!==a&&(lastSetCursor=a,this.PostToDOM("cursor",a))}async SetCursorObjectClass(a){if(!C3$jscomp$254.Platform.IsMobile&&a){var b=a.GetFirstPicked();b&&(a=b.GetWorldInfo(),b=b.GetCurrentImageInfo(),
a&&b&&lastSetCursor!==b&&(lastSetCursor=b,a=`url(${await b.ExtractImageToBlobURL()}) ${Math.round(a.GetOriginX()*b.GetWidth())} ${Math.round(a.GetOriginY()*b.GetHeight())}, auto`,this.PostToDOM("cursor",a)))}}_OnPointerLockChange(a){this._UpdatePointerLockState(a["has-pointer-lock"])}_OnPointerLockError(a){this._UpdatePointerLockState(a["has-pointer-lock"]);this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnPointerLockError)}_UpdatePointerLockState(a){this._hasPointerLock!==a&&((this._hasPointerLock=
a)?this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnPointerLocked):this.Trigger(C3$jscomp$254.Plugins.Mouse.Cnds.OnPointerUnlocked))}GetDebuggerProperties(){return[{title:"plugins.mouse.name",properties:[{name:"plugins.mouse.debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:"plugins.mouse.debugger.left-button",value:this._buttonMap[0]},{name:"plugins.mouse.debugger.middle-button",value:this._buttonMap[1]},{name:"plugins.mouse.debugger.right-button",value:this._buttonMap[2]},
{name:"plugins.mouse.debugger.button-4",value:this._buttonMap[3]},{name:"plugins.mouse.debugger.button-5",value:this._buttonMap[4]}]},{title:"plugins.mouse.debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map(a=>({name:"$"+a.GetName(),value:a.CanvasCssToLayer(this._mouseXcanvas,this._mouseYcanvas).join(", ")}))}]}};const C3$jscomp$255=self.C3;
C3$jscomp$255.Plugins.Mouse.Cnds={OnClick(a,b){return this._triggerButton===a&&this._triggerType===b},OnAnyClick(){return!0},IsButtonDown(a){return this._buttonMap[a]},OnRelease(a){return this._triggerButton===a},IsOverObject(a){const b=this._runtime.GetCurrentCondition().IsInverted(),d=[];this._IsMouseOverCanvas()&&d.push([this._mouseXcanvas,this._mouseYcanvas]);return C3$jscomp$255.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(a,d,b),b)},OnObjectClicked(a,b,d){if(a!==this._triggerButton||
b!==this._triggerType||!this._IsMouseOverCanvas())return!1;a=this._mouseXcanvas;b=this._mouseYcanvas;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(d,[[a,b]],!1)},OnWheel(a){return 2===a||this._triggerDir===a},OnPointerLocked(){return!0},OnPointerUnlocked(){return!0},OnPointerLockError(){return!0},HasPointerLock(){return this._hasPointerLock},OnMovement(){return!0}};const CURSOR_STYLES="auto pointer text crosshair move help wait none".split(" ");
self.C3.Plugins.Mouse.Acts={SetCursor(a){this.SetCursorStyle(CURSOR_STYLES[a])},SetCursorSprite(a){this.SetCursorObjectClass(a)},RequestPointerLock(){this._PostToDOMMaybeSync("request-pointer-lock")},ReleasePointerLock(){this.PostToDOM("release-pointer-lock")}};
self.C3.Plugins.Mouse.Exps={X(a){return this.GetMousePositionForLayer(a)[0]},Y(a){return this.GetMousePositionForLayer(a)[1]},AbsoluteX(){return this._mouseXcanvas},AbsoluteY(){return this._mouseYcanvas},MovementX(){return this._movementX},MovementY(){return this._movementY},WheelDeltaX(){return this._wheelDeltaX},WheelDeltaY(){return this._wheelDeltaY},WheelDeltaZ(){return this._wheelDeltaZ}};"use strict";const C3$jscomp$258=self.C3;
C3$jscomp$258.Plugins.Button=class extends C3$jscomp$258.SDKDOMPluginBase{constructor(a){super(a,"button");this.AddElementMessageHandler("click",(b,d)=>b._OnClick(d))}Release(){super.Release()}};const C3$jscomp$259=self.C3;C3$jscomp$259.Plugins.Button.Type=class extends C3$jscomp$259.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$260=self.C3,C3X$jscomp$42=self.C3X;
C3$jscomp$260.Plugins.Button.Instance=class extends C3$jscomp$260.SDKDOMInstanceBase{constructor(a,b){super(a,"button");this._text="OK";this._isChecked=this._isCheckbox=!1;this._className=this._id=this._title="";this._autoFontSize=this._isEnabled=!0;b&&(this._isCheckbox=1===b[0],this._text=b[1],this._title=b[2],this.GetWorldInfo().SetVisible(b[3]),this._isEnabled=b[4],this._autoFontSize=b[5],this._isChecked=b[6],this._id=b[7],this._className=b[8]);this.CreateElement({id:this._id,className:this._className})}Release(){super.Release()}GetElementState(){return{text:this._text,
isCheckbox:this._isCheckbox,isChecked:this._isChecked,title:this._title,isVisible:this.GetWorldInfo().IsVisible(),isEnabled:this._isEnabled}}async _OnClick(a){this._isChecked=a.isChecked;this.DispatchScriptEvent("click",!0);await this.TriggerAsync(C3$jscomp$260.Plugins.Button.Cnds.OnClicked)}_SetText(a){this._text!==a&&(this._text=a,this.UpdateElementState())}_GetText(){return this._text}_SetTooltip(a){this._title!==a&&(this._title=a,this.UpdateElementState())}_GetTooltip(){return this._title}_SetEnabled(a){a=
!!a;this._isEnabled!==a&&(this._isEnabled=a,this.UpdateElementState())}_IsEnabled(){return this._isEnabled}_SetChecked(a){this._isCheckbox&&(a=!!a,this._isChecked!==a&&(this._isChecked=a,this.UpdateElementState()))}_IsChecked(){return this._isChecked}Draw(a){}SaveToJson(){return{text:this._text,checked:this._isChecked,title:this._title,enabled:this._isEnabled}}LoadFromJson(a){this._text=a.text;this._isChecked=a.checked;this._title=a.title;this._isEnabled=a.enabled;this.UpdateElementState()}GetPropertyValueByIndex(a){switch(a){case 1:return this._GetText();
case 2:return this._GetTooltip();case 4:return this._IsEnabled();case 5:return this._autoFontSize;case 6:return this._IsChecked()}}SetPropertyValueByIndex(a,b){switch(a){case 1:this._SetText(b);break;case 2:this._SetTooltip(b);break;case 4:this._SetEnabled(!!b);break;case 5:this._autoFontSize=!!b;break;case 6:this._SetChecked(!!b)}}GetDebuggerProperties(){return[{title:"plugins.button.name",properties:[{name:"plugins.button.properties.text.name",value:this._GetText(),onedit:a=>this._SetText(a)},{name:"plugins.button.properties.enabled.name",
value:this._IsEnabled(),onedit:a=>this._SetEnabled(a)},{name:"plugins.button.properties.checked.name",value:this._IsChecked(),onedit:a=>this._SetChecked(a)}]}]}GetScriptInterfaceClass(){return self.IButtonInstance}};const map$jscomp$34=new WeakMap;
self.IButtonInstance=class extends self.IDOMInstance{constructor(){super();map$jscomp$34.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set text(a){C3X$jscomp$42.RequireString(a);map$jscomp$34.get(this)._SetText(a)}get text(){return map$jscomp$34.get(this)._GetText()}set tooltip(a){C3X$jscomp$42.RequireString(a);map$jscomp$34.get(this)._SetTooltip(a)}get tooltip(){return map$jscomp$34.get(this)._GetTooltip()}set isEnabled(a){map$jscomp$34.get(this)._SetEnabled(a)}get isEnabled(){return map$jscomp$34.get(this)._IsEnabled()}set isChecked(a){map$jscomp$34.get(this)._SetChecked(a)}get isChecked(){return map$jscomp$34.get(this)._IsChecked()}};
const C3$jscomp$261=self.C3;C3$jscomp$261.Plugins.Button.Cnds={OnClicked(){return!0},IsChecked(){return this._isChecked},CompareText(a,b){return b?this._text===a:C3$jscomp$261.equalsNoCase(this._text,a)}};self.C3.Plugins.Button.Acts={SetText(a){this._SetText(a)},SetTooltip(a){this._SetTooltip(a)},SetChecked(a){this._SetChecked(0!==a)},ToggleChecked(){this._isCheckbox&&(this._isChecked=!this._isChecked,this.UpdateElementState())}};self.C3.Plugins.Button.Exps={Text(){return this._text}};"use strict";
const C3$jscomp$264=self.C3;C3$jscomp$264.Plugins.Json=class extends C3$jscomp$264.SDKPluginBase{constructor(a){super(a)}Release(){super.Release()}};const C3$jscomp$265=self.C3;C3$jscomp$265.Plugins.Json.Type=class extends C3$jscomp$265.SDKTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$266=self.C3,C3X$jscomp$43=self.C3X,IInstance$jscomp$4=self.IInstance;
C3$jscomp$266.Plugins.Json.Instance=class extends C3$jscomp$266.SDKInstanceBase{constructor(a,b){super(a);this._valueCache=[null,null];this._locationCache=[null,null];this._data={};this._path=[];this._currentKey="";this._currentValue=0}Release(){super.Release()}_InvalidateValueCache(){this._valueCache[0]=null;this._valueCache[1]=null}_HasValueCache(a,b){const d=this._valueCache[0];if(null===a||null===d)return!1;if(d===a||C3$jscomp$266.arraysEqual(d,a))return!0;if(b&&0<d.length){for(let c=0,e=Math.min(a.length,
d.length);c<e;++c)if(a[c]!==d[c])return!1;return!0}return!1}_GetValueCache(){return this._valueCache[1]}_UpdateValueCache(a,b){this._valueCache[0]=a;this._valueCache[1]=b}_InvalidateLocationCache(){this._locationCache[0]=null;this._locationCache[1]=null}_HasLocationCache(a){return this._locationCache[0]===a}_GetLocationCache(){return this._locationCache[1]}_UpdateLocationCache(a,b){this._locationCache[0]=a;this._locationCache[1]=b}_SetData(a){this._data=a;this._InvalidateValueCache();this._SetPath("")}_GetData(){return this._data}_SetPath(a){this._path=
this._ParsePathUnsafe(a);this._InvalidateLocationCache()}_ParsePath(a){return C3$jscomp$266.cloneArray(this._ParsePathUnsafe(a))}_ParsePathUnsafe(a){const b=[];let d=!1,c;if(this._HasLocationCache(a))return this._GetLocationCache();"."===a[0]?(c=C3$jscomp$266.cloneArray(this._path),a=a.slice(1)):c=[];for(const e of a)d?(b.push(e),d=!1):"\\"===e?d=!0:"."===e?(c.push(b.join("")),C3$jscomp$266.clearArray(b)):b.push(e);0!==b.length&&c.push(b.join(""));this._UpdateLocationCache(a,c);return c}_GetValueAtFullPath(a,
b){if(this._HasValueCache(a,!1))return this._GetValueCache();let d=this._data;for(const e of a)if(Array.isArray(d)){var c=parseInt(e,10);if(0>c||c>=d.length||!isFinite(c)){d=null;break}d=d[c]}else if("object"===typeof d&&null!==d)if(d.hasOwnProperty(e))d=d[e];else if(b)c={},d=d[e]=c;else{d=null;break}else{d=null;break}this._UpdateValueCache(a,d);return d}_GetValue(a){var b=this._ParsePath(a);if(!b.length)return this._data;a=b.pop();b=this._GetValueAtFullPath(b,!1);return Array.isArray(b)?(a=parseInt(a,
10),0<=a&&a<b.length?b[a]:null):"object"===typeof b&&null!==b?b.hasOwnProperty(a)?b[a]:null:null}_JSONTypeOf(a){return null===a?"null":Array.isArray(a)?"array":typeof a}_GetTypeOf(a){a=this._GetValue(a);return this._JSONTypeOf(a)}_ToSafeValue(a){const b=typeof a;return"number"===b||"string"===b?a:"boolean"===b?a?1:0:0}_GetSafeValue(a){return this._ToSafeValue(this._GetValue(a))}_HasKey(a){var b=this._ParsePath(a);if(!b.length)return!1;a=b.pop();b=this._GetValueAtFullPath(b,!1);return Array.isArray(b)?
(a=parseInt(a,10),0<=a&&a<b.length):"object"===typeof b&&null!==b?b.hasOwnProperty(a):!1}_SetValue(a,b){var d=this._ParsePath(a);if(!d.length)return!1;this._HasValueCache(d,!0)&&this._InvalidateValueCache();a=d.pop();d=this._GetValueAtFullPath(d,!0);if(Array.isArray(d)){a=parseInt(a,10);if(!isFinite(a)||0>a||a>=d.length)return!1;d[a]=b;return!0}return"object"===typeof d&&null!==d?(d[a]=b,!0):!1}_DeleteKey(a){var b=this._ParsePath(a);if(!b.length)return!1;this._HasValueCache(b,!0)&&this._InvalidateValueCache();
a=b.pop();b=this._GetValueAtFullPath(b,!1);return Array.isArray(b)?!1:"object"===typeof b&&null!==b?(delete b[a],!0):!1}SaveToJson(){return{path:this._path,data:this._data}}LoadFromJson(a){this._InvalidateValueCache();this._InvalidateLocationCache();this._path=a.path;this._data=a.data}_SanitizeValue(a){return"number"===typeof a?isFinite(a)?a:0:"object"==typeof a?JSON.stringify(a):a+""}GetDebuggerProperties(){let a;try{a=this._SanitizeValue(this._data)}catch(b){a='"invalid"'}return[{title:"plugins.json.debugger.title",
properties:[{name:"plugins.json.debugger.data",value:a,onedit:b=>{try{const d=JSON.parse(b);this._SetData(d)}catch(d){}}},{name:"plugins.json.debugger.path",value:this._path.map(b=>b.replace(/\./g,"\\.")).join(".")}]}]}GetScriptInterfaceClass(){return self.IJSONInstance}};const map$jscomp$35=new WeakMap;
self.IJSONInstance=class extends IInstance$jscomp$4{constructor(){super();map$jscomp$35.set(this,IInstance$jscomp$4._GetInitInst().GetSdkInstance())}getJsonDataCopy(){const a=map$jscomp$35.get(this)._GetData();return JSON.parse(JSON.stringify(a))}setJsonDataCopy(a){try{const b=JSON.parse(JSON.stringify(a));map$jscomp$35.get(this)._SetData(b)}catch(b){throw console.error("[JSON plugin] setJsonData: object is not valid JSON: ",b),b;}}setJsonString(a){C3X$jscomp$43.RequireString(a);try{const b=JSON.parse(a);
map$jscomp$35.get(this)._SetData(b)}catch(b){throw console.error("[JSON plugin] setJsonString: string is not valid JSON: ",b),b;}}toCompactString(){return JSON.stringify(map$jscomp$35.get(this)._GetData())}toBeautifiedString(){return JSON.stringify(map$jscomp$35.get(this)._GetData(),null,4)}};const C3$jscomp$267=self.C3,JSON_TYPES="null boolean number string object array".split(" ");
C3$jscomp$267.Plugins.Json.Cnds={HasKey(a){return this._HasKey(a)},CompareType(a,b){return this._GetTypeOf(a)===JSON_TYPES[b]},CompareValue(a,b,d){return C3$jscomp$267.compare(this._GetSafeValue(a),b,d)},IsBooleanSet(a){return!0===this._GetValue(a)},ForEach(a){const b=this._GetValue(a);if("object"!==typeof b||null===b)return!1;const d=this._runtime,c=d.GetEventSheetManager(),e=d.GetCurrentEvent(),g=e.GetSolModifiers(),k=d.GetEventStack(),l=k.GetCurrentStackFrame(),n=k.Push(e),p=this._path,r=this._currentKey,
w=this._currentValue;a=this._ParsePathUnsafe(a);d.SetDebuggingEnabled(!1);for(const [z,B]of Object.entries(b))this._path=C3$jscomp$267.cloneArray(a),this._path.push(z),this._currentKey=z,this._currentValue=B,c.PushCopySol(g),this.GetObjectClass().GetCurrentSol().PickOne(this.GetInstance()),e.Retrigger(l,n),c.PopSol(g);d.SetDebuggingEnabled(!0);this._path=p;this._InvalidateLocationCache();this._currentKey=r;this._currentValue=w;k.Pop();return!1},OnParseError(){return!0}};const C3$jscomp$268=self.C3;
C3$jscomp$268.Plugins.Json.Acts={Parse(a){try{this._SetData(JSON.parse(a))}catch(b){console.warn("[JSON plugin] Failed to parse JSON data: ",b),this._SetData({}),this.Trigger(C3$jscomp$268.Plugins.Json.Cnds.OnParseError)}},SetPath(a){this._SetPath(a)},SetValue(a,b){this._SetValue(a,b)},SetArray(a,b){let d=this._GetValue(a);Array.isArray(d)?C3$jscomp$268.resizeArray(d,b,0):(d=[],C3$jscomp$268.extendArray(d,b,0),this._SetValue(a,d))},SetObject(a){this._SetValue(a,{})},SetJSON(a,b){let d=null;try{d=
JSON.parse(b)}catch(c){console.warn("[JSON plugin] Failed to parse JSON data: ",c),this.Trigger(C3$jscomp$268.Plugins.Json.Cnds.OnParseError)}this._SetValue(a,d)},SetNull(a){this._SetValue(a,null)},SetBoolean(a,b){this._SetValue(a,0!==b)},ToggleBoolean(a){const b=this._GetValue(a);"boolean"===typeof b&&this._SetValue(a,!b)},AddTo(a,b){const d=this._GetValue(a);"number"===typeof d&&this._SetValue(a,d+b)},SubtractFrom(a,b){const d=this._GetValue(a);"number"===typeof d&&this._SetValue(a,d-b)},DeleteKey(a){this._DeleteKey(a)},
PushValue(a,b,d){b=this._GetValue(b);Array.isArray(b)&&(0===a?b.push(d):b.unshift(d),this._InvalidateValueCache())},PopValue(a,b){b=this._GetValue(b);Array.isArray(b)&&(0===a?b.pop():b.shift(),this._InvalidateValueCache())},InsertValue(a,b,d){b=this._GetValue(b);Array.isArray(b)&&(b.splice(d,0,a),this._InvalidateValueCache())},RemoveValues(a,b,d){b=this._GetValue(b);Array.isArray(b)&&0<a&&(b.splice(d,a),this._InvalidateValueCache())}};
self.C3.Plugins.Json.Exps={ToCompactString(){try{return JSON.stringify(this._data)}catch(a){return""}},ToBeautifiedString(){try{return JSON.stringify(this._data,null,4)}catch(a){return""}},Get(a){return this._GetSafeValue(a)},GetAsCompactString(a){a=this._GetValue(a);return JSON.stringify(a)},GetAsBeautifiedString(a){a=this._GetValue(a);return JSON.stringify(a,null,4)},Front(a){a=this._GetValue(a);return Array.isArray(a)?this._ToSafeValue(a[0]):-1},Back(a){a=this._GetValue(a);return Array.isArray(a)?
(a=a.at(-1),this._ToSafeValue(a)):-1},Type(a){return this._GetTypeOf(a)},ArraySize(a){a=this._GetValue(a);return Array.isArray(a)?a.length:-1},Path(){return this._path.map(a=>a.replace(/\./g,"\\.")).join(".")},CurrentKey(){return this._currentKey},CurrentValue(){return this._ToSafeValue(this._currentValue)},CurrentType(){return this._JSONTypeOf(this._currentValue)}};"use strict";const C3$jscomp$270=self.C3;C3$jscomp$270.Behaviors.MoveTo=class extends C3$jscomp$270.SDKBehaviorBase{constructor(a){super(a)}Release(){super.Release()}};
const C3$jscomp$271=self.C3;C3$jscomp$271.Behaviors.MoveTo.Type=class extends C3$jscomp$271.SDKBehaviorTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$272=self.C3,C3X$jscomp$44=self.C3X,IBehaviorInstance$jscomp$2=self.IBehaviorInstance;
C3$jscomp$272.Behaviors.MoveTo.Instance=class extends C3$jscomp$272.SDKBehaviorInstanceBase{constructor(a,b){super(a);this._maxSpeed=200;this._dec=this._acc=600;this._rotateSpeed=0;this._setAngle=!0;this._stopOnSolids=!1;this._isEnabled=!0;this._speed=0;this._movingAngle=this.GetWorldInfo().GetAngle();this._waypoints=[];b&&(this._maxSpeed=b[0],this._acc=b[1],this._dec=b[2],this._rotateSpeed=C3$jscomp$272.toRadians(b[3]),this._setAngle=b[4],this._stopOnSolids=b[5],this._isEnabled=b[6]);this._timelineInfo=
null;this._lastBezierSegment=this._lastBezierPosition=NaN}Release(){this._timelineInfo&&(this._timelineInfo.Release(),this._timelineInfo=null);this._lastBezierSegment=this._lastBezierPosition=NaN;super.Release()}SaveToJson(){return{ms:this._maxSpeed,acc:this._acc,dec:this._dec,rs:this._rotateSpeed,sa:this._setAngle,sos:this._stopOnSolids,s:this._speed,ma:this._movingAngle,wp:this._waypoints.map(a=>({x:a.x,y:a.y})),e:this._isEnabled}}LoadFromJson(a){this._maxSpeed=a.ms;this._acc=a.acc;this._dec=a.dec;
this._rotateSpeed=a.rs;this._setAngle=a.sa;this._stopOnSolids=a.sos;this._speed=a.s;this._movingAngle=a.ma;this._waypoints=a.wp.map(b=>({x:b.x,y:b.y}));this._SetEnabled(a.e);this._isEnabled&&0<this._waypoints.length&&this._StartTicking()}_AddWaypoint(a,b,d,c){d&&C3$jscomp$272.clearArray(this._waypoints);this._waypoints.push({x:a,y:b,opts:c});this._isEnabled&&this._StartTicking()}_GetWaypointCount(){return this._waypoints.length}_GetWaypointXAt(a){a=Math.floor(a);return 0>a||a>=this._waypoints.length?
0:this._waypoints[a].x}_GetWaypointYAt(a){a=Math.floor(a);return 0>a||a>=this._waypoints.length?0:this._waypoints[a].y}_IsMoving(){return 0<this._waypoints.length}_Stop(){C3$jscomp$272.clearArray(this._waypoints);this._speed=0;this._StopTicking()}_GetTargetX(){return 0<this._waypoints.length?this._waypoints[0].x:0}_GetTargetY(){return 0<this._waypoints.length?this._waypoints[0].y:0}_GetTargetIsBezier(){if(0<this._waypoints.length){const a=this._waypoints[0];if(a.opts)return a.opts.isBezier}return!1}_GetTargetIsBezierFirst(){if(0<
this._waypoints.length){const a=this._waypoints[0];if(a.opts)return a.opts.isBezier&&a.opts.isFirst}return!1}_GetTargetBezierPosition(){if(0<this._waypoints.length){const a=this._waypoints[0];if(a.opts)return a.opts.bezierPosition}return!1}_GetTargetBezierSegment(){if(0<this._waypoints.length){const a=this._waypoints[0];if(a.opts)return a.opts.bezierSegment}return!1}_SetSpeed(a){this._IsMoving()&&(this._speed=Math.min(a,this._maxSpeed))}_GetSpeed(){return this._speed}_SetMaxSpeed(a){this._maxSpeed=
Math.max(a,0);this._SetSpeed(this._speed)}_GetMaxSpeed(){return this._maxSpeed}_IsRotationEnabled(){return this._isEnabled&&this._IsMoving()&&this._GetTargetIsBezier()?this._GetTargetIsBezierFirst()?!0:!1:0!==this._rotateSpeed}Tick(){if(this._isEnabled&&this._IsMoving()){var a=this._runtime.GetDt(this._inst),b=this._inst.GetWorldInfo(),d=b.GetX(),c=b.GetY(),e=b.GetAngle(),g=this._speed,k=this._maxSpeed,l=this._acc,n=this._dec,p=this._GetTargetX(),r=this._GetTargetY(),w=C3$jscomp$272.angleTo(d,c,p,
r),z=!1;0<n&&1===this._waypoints.length&&(z=.5*g*g/n*1.0001,z=C3$jscomp$272.distanceSquared(d,c,p,r)<=z*z)&&(k=C3$jscomp$272.distanceTo(d,c,p,r),this._speed=k=g=Math.sqrt(2*n*k));if(this._IsRotationEnabled()){const B=C3$jscomp$272.angleDiff(this._movingAngle,w);if(B>Number.EPSILON){const C=B/this._rotateSpeed,E=C3$jscomp$272.distanceTo(b.GetX(),b.GetY(),p,r)/(2*Math.sin(B));k=Math.min(k,C3$jscomp$272.clamp(E*B/C,0,this._maxSpeed))}}g=Math.min(g*a+.5*(z?-n:l)*a*a,k*a);if(z){if(0<n&&(this._speed=Math.max(this._speed-
n*a,0),0===this._speed)){this._OnArrived(b,p,r);return}}else this._speed=0===l?k:Math.min(this._speed+l*a,k);C3$jscomp$272.distanceSquared(b.GetX(),b.GetY(),p,r)<=g*g?this._OnArrived(b,p,r):(this._IsRotationEnabled()?this._movingAngle=C3$jscomp$272.angleRotate(this._movingAngle,w,this._rotateSpeed*a):this._movingAngle=w,b.OffsetXY(Math.cos(this._movingAngle)*g,Math.sin(this._movingAngle)*g),this._setAngle&&(a=this._GetTargetIsBezier(),l=this._GetTargetIsBezierFirst(),a&&!l?(n=this._GetTargetBezierSegment(),
p=this._GetTargetBezierPosition(),a=b.GetX(),l=b.GetY(),self.isNaN(this._lastBezierSegment)&&(this._lastBezierSegment=0),n=this._lastBezierSegment===n?this._timelineInfo.Project(a,l,{tRange:[this._lastBezierPosition,p]}):this._timelineInfo.Project(a,l),a=this._timelineInfo.TangentAngle(a,l,n[2],n[4]),b.SetAngle(a)):(b.SetAngle(this._movingAngle),this._lastBezierSegment=this._lastBezierPosition=NaN)),b.SetBboxChanged(),this._CheckSolidCollision(d,c,e))}}_OnArrived(a,b,d){a.SetXY(b,d);a.SetBboxChanged();
a=this._waypoints[0];a.opts&&a.opts.isBezier?(this._lastBezierPosition=a.opts.bezierPosition,this._lastBezierSegment=a.opts.bezierSegment):this._lastBezierSegment=this._lastBezierPosition=NaN;this._waypoints.shift();0===this._waypoints.length&&(this._timelineInfo&&(this._timelineInfo.Release(),this._timelineInfo=null,this._lastBezierSegment=this._lastBezierPosition=NaN),this._speed=0,this._StopTicking());this.DispatchScriptEvent("arrived");this.Trigger(C3$jscomp$272.Behaviors.MoveTo.Cnds.OnArrived)}_CheckSolidCollision(a,
b,d){const c=this._runtime.GetCollisionEngine();if(this._stopOnSolids&&c.TestOverlapSolid(this._inst)){this._Stop();const g=this._inst.GetWorldInfo();var e=g.GetX();const k=g.GetY(),l=C3$jscomp$272.angleTo(e,k,a,b);e=C3$jscomp$272.distanceTo(e,k,a,b);c.PushOutSolid(this._inst,Math.cos(l),Math.sin(l),Math.max(e,1))||(g.SetXY(a,b),g.SetAngle(d),g.SetBboxChanged());this.DispatchScriptEvent("hitsolid");this.Trigger(C3$jscomp$272.Behaviors.MoveTo.Cnds.OnHitSolid)}}_IsSetAngle(){return this._setAngle}_SetSetAngle(a){this._setAngle=
!!a}_SetAngleOfMotion(a){this._movingAngle=a;this._isEnabled&&this._setAngle&&!this._IsMoving()&&(a=this.GetWorldInfo(),a.SetAngle(this._movingAngle),a.SetBboxChanged())}_GetAngleOfMotion(){return this._movingAngle}_SetAcceleration(a){this._acc=Math.max(a,0)}_GetAcceleration(){return this._acc}_SetDeceleration(a){this._dec=Math.max(a,0)}_GetDeceleration(){return this._dec}_SetRotateSpeed(a){this._rotateSpeed=Math.max(a,0)}_GetRotateSpeed(){return this._rotateSpeed}_SetStopOnSolids(a){this._stopOnSolids=
!!a}_IsStopOnSolids(){return this._stopOnSolids}_SetEnabled(a){a=!!a;this._isEnabled!==a&&((this._isEnabled=a)&&this._IsMoving()?this._StartTicking():this._StopTicking())}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(a){switch(a){case 0:return this._GetMaxSpeed();case 1:return this._GetAcceleration();case 2:return this._GetDeceleration();case 3:return C3$jscomp$272.toDegrees(this._GetRotateSpeed());case 4:return this._IsSetAngle();case 5:return this._IsStopOnSolids();case 6:return this._IsEnabled()}}SetPropertyValueByIndex(a,
b){switch(a){case 0:this._SetMaxSpeed(b);break;case 1:this._SetAcceleration(b);break;case 2:this._SetDeceleration(b);break;case 3:this._SetRotateSpeed(C3$jscomp$272.toRadians(b));break;case 4:this._SetSetAngle(b);break;case 5:this._SetStopOnSolids(b);break;case 6:this._SetEnabled(b)}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.moveto.debugger.speed",value:this._GetSpeed(),onedit:a=>this._SetSpeed(a)},{name:"behaviors.moveto.debugger.angle-of-motion",
value:C3$jscomp$272.toDegrees(this._GetAngleOfMotion()),onedit:a=>this._movingAngle=C3$jscomp$272.toRadians(a)},{name:"behaviors.moveto.debugger.target-x",value:this._GetTargetX()},{name:"behaviors.moveto.debugger.target-y",value:this._GetTargetY()},{name:"behaviors.moveto.debugger.waypoint-count",value:this._GetWaypointCount()},{name:"behaviors.moveto.properties.max-speed.name",value:this._GetMaxSpeed(),onedit:a=>this._SetMaxSpeed(a)},{name:"behaviors.moveto.properties.acceleration.name",value:this._GetAcceleration(),
onedit:a=>this._SetAcceleration(a)},{name:"behaviors.moveto.properties.deceleration.name",value:this._GetDeceleration(),onedit:a=>this._SetDeceleration(a)},{name:"behaviors.moveto.properties.rotate-speed.name",value:C3$jscomp$272.toDegrees(this._GetRotateSpeed()),onedit:a=>this._SetRotateSpeed(C3$jscomp$272.toRadians(a))},{name:"behaviors.moveto.properties.enabled.name",value:this._IsEnabled(),onedit:a=>this._SetEnabled(a)}]}]}GetScriptInterfaceClass(){return self.IMoveToBehaviorInstance}};
const map$jscomp$36=new WeakMap;
self.IMoveToBehaviorInstance=class extends IBehaviorInstance$jscomp$2{constructor(){super();map$jscomp$36.set(this,IBehaviorInstance$jscomp$2._GetInitInst().GetSdkInstance())}moveToPosition(a,b,d=!0){C3X$jscomp$44.RequireFiniteNumber(a);C3X$jscomp$44.RequireFiniteNumber(b);map$jscomp$36.get(this)._AddWaypoint(a,b,!!d)}getTargetX(){return map$jscomp$36.get(this)._GetTargetX()}getTargetY(){return map$jscomp$36.get(this)._GetTargetY()}getTargetPosition(){const a=map$jscomp$36.get(this);return[a._GetTargetX(),
a._GetTargetY()]}getWaypointCount(){return map$jscomp$36.get(this)._GetWaypointCount()}getWaypointX(a){C3X$jscomp$44.RequireFiniteNumber(a);return map$jscomp$36.get(this)._GetWaypointXAt(a)}getWaypointY(a){C3X$jscomp$44.RequireFiniteNumber(a);return map$jscomp$36.get(this)._GetWaypointYAt(a)}getWaypoint(a){C3X$jscomp$44.RequireFiniteNumber(a);const b=map$jscomp$36.get(this);return[b._GetWaypointXAt(a),b._GetWaypointYAt(a)]}stop(){map$jscomp$36.get(this)._Stop()}get isMoving(){return map$jscomp$36.get(this)._IsMoving()}get speed(){return map$jscomp$36.get(this)._GetSpeed()}set speed(a){C3X$jscomp$44.RequireFiniteNumber(a);
map$jscomp$36.get(this)._SetSpeed(a)}get maxSpeed(){return map$jscomp$36.get(this)._GetMaxSpeed()}set maxSpeed(a){C3X$jscomp$44.RequireFiniteNumber(a);map$jscomp$36.get(this)._SetMaxSpeed(a)}get acceleration(){return map$jscomp$36.get(this)._GetAcceleration()}set acceleration(a){C3X$jscomp$44.RequireFiniteNumber(a);map$jscomp$36.get(this)._SetAcceleration(a)}get deceleration(){return map$jscomp$36.get(this)._GetDeceleration()}set deceleration(a){C3X$jscomp$44.RequireFiniteNumber(a);map$jscomp$36.get(this)._SetDeceleration(a)}get angleOfMotion(){return map$jscomp$36.get(this)._GetAngleOfMotion()}set angleOfMotion(a){C3X$jscomp$44.RequireFiniteNumber(a);
map$jscomp$36.get(this)._SetAngleOfMotion(a)}get rotateSpeed(){return map$jscomp$36.get(this)._GetRotateSpeed()}set rotateSpeed(a){C3X$jscomp$44.RequireFiniteNumber(a);map$jscomp$36.get(this)._SetRotateSpeed(a)}get isStopOnSolids(){return map$jscomp$36.get(this)._IsStopOnSolids()}set isStopOnSolids(a){map$jscomp$36.get(this)._SetStopOnSolids(a)}get isEnabled(){return map$jscomp$36.get(this)._IsEnabled()}set isEnabled(a){map$jscomp$36.get(this)._SetEnabled(a)}};const C3$jscomp$273=self.C3;
C3$jscomp$273.Behaviors.MoveTo.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(a,b){return C3$jscomp$273.compare(this._GetSpeed(),a,b)},IsEnabled(){return this._IsEnabled()},OnArrived(){return!0},OnHitSolid(){return!0}};const C3$jscomp$274=self.C3;
C3$jscomp$274.Behaviors.MoveTo.Acts={MoveToPosition(a,b,d){this._AddWaypoint(a,b,0===d)},MoveToObject(a,b,d){if(a&&(a=a.GetPairedInstance(this._inst))&&a.GetWorldInfo()){var [c,e]=a.GetImagePoint(b);this._AddWaypoint(c,e,0===d)}},MoveAlongPathfindingPath(a){var b=this._inst.GetBehaviorSdkInstanceFromCtor(C3$jscomp$274.Behaviors.Pathfinding);if(b&&(b=b._GetPath(),0!==b.length))for(let d=0,c=b.length;d<c;++d){const e=b[d];this._AddWaypoint(e.x,e.y,0===d&&0===a)}},MoveAlongTimeline(a,b,d){a=C3$jscomp$274.New(C3$jscomp$274.TimelineInfo,
a,b);if(a.WasInitialized()){a.SetOrigin(this._inst.GetWorldInfo());b=!0;for(const g of a.segments())switch(g.GetType()){case "line":var c=g.GetX(),e=g.GetY();this._AddWaypoint(c,e,b&&0===d);b=!1;break;case "cubic-bezier":for(c=0;c<=g.GetStepCount();c++){e=c*g.GetStepIncrement();const k=g.Map(e);this._AddWaypoint(k[0],k[1],b&&0===d,{isBezier:!0,isFirst:b,bezierPosition:g._Map(e),bezierSegment:g.GetIndex()});b=!1}}this._timelineInfo=a}else a.Release()},MoveAlongTimelineByName(a,b,d){(a=this._runtime.GetTimelineManager().GetTimelineByName(a))&&
C3$jscomp$274.Behaviors.MoveTo.Acts.MoveAlongTimeline.call(this,a,b,d)},Stop(){this._Stop()},SetMovingAngle(a){this._SetAngleOfMotion(C3$jscomp$274.toRadians(a))},SetSpeed(a){this._SetSpeed(a)},SetMaxSpeed(a){this._SetMaxSpeed(a)},SetAcceleration(a){this._SetAcceleration(a)},SetDeceleration(a){this._SetDeceleration(a)},SetRotateSpeed(a){this._SetRotateSpeed(C3$jscomp$274.toRadians(a))},SetStopOnSolids(a){this._SetStopOnSolids(a)},SetEnabled(a){this._SetEnabled(a)}};const C3$jscomp$275=self.C3;
C3$jscomp$275.Behaviors.MoveTo.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},MovingAngle(){return C3$jscomp$275.toDegrees(this._GetAngleOfMotion())},RotateSpeed(){return C3$jscomp$275.toDegrees(this._GetRotateSpeed())},TargetX(){return this._GetTargetX()},TargetY(){return this._GetTargetY()},WaypointCount(){return this._GetWaypointCount()},WaypointXAt(a){return this._GetWaypointXAt(a)},
WaypointYAt(a){return this._GetWaypointYAt(a)}};"use strict";const C3$jscomp$276=self.C3,C3X$jscomp$45=self.C3X;let tempVec2a=null,tempVec2b=null,vec2RecycleCache=[],Box2D=null,physicsBehavior=null;
function SetObjectTypeCollisionsEnabled(a,b,d){var c=a.GetSavedDataMap();const e=b.GetSavedDataMap();d?((c=c.get("Physics_DisabledCollisions"))&&c.delete(b.GetSID()),(b=e.get("Physics_DisabledCollisions"))&&b.delete(a.GetSID())):(d=c.get("Physics_DisabledCollisions"),d||(d=new Set,c.set("Physics_DisabledCollisions",d)),c=e.get("Physics_DisabledCollisions"),c||(c=new Set,e.set("Physics_DisabledCollisions",c)),d.add(b.GetSID()),c.add(a.GetSID()))}
C3$jscomp$276.Behaviors.Physics=class extends C3$jscomp$276.SDKBehaviorBase{constructor(a){super(a);physicsBehavior=this;this._world=null;this._worldG=10;this._worldScale=.02;this._worldManifold=null;this._lastUpdateTick=-1;this._steppingMode=1;this._velocityIterations=8;this._positionIterations=3;this._allCollisionsEnabled=!0;this._runtime.AddLoadPromise(this._LoadBox2DWasm())}GetScriptInterfaceClass(){return self.IPhysicsBehavior}async _LoadBox2DWasm(){const a=await this._runtime.GetAssetManager().GetProjectFileUrl("box2d.wasm");
await new Promise(b=>{self.Box2DWasmModule({wasmBinaryFile:a}).then(d=>{Box2D=d;this._InitBox2DWorld();b()})})}_InitBox2DWorld(){const a=this._runtime.GetCollisionEngine();tempVec2a=C3$jscomp$276.Behaviors.Physics.GetVec2(0,0);tempVec2b=C3$jscomp$276.Behaviors.Physics.GetVec2(0,0);this._world=new Box2D.b2World(C3$jscomp$276.Behaviors.Physics.GetTempVec2A(0,this._worldG),!0);var b=new Box2D.JSContactListener;b.BeginContact=d=>{var c=Box2D.wrapPointer(d,Box2D.b2Contact);d=C3$jscomp$276.Behaviors.Physics.Instance.LookupBehInstFromBody(c.GetFixtureA().GetBody());
c=C3$jscomp$276.Behaviors.Physics.Instance.LookupBehInstFromBody(c.GetFixtureB().GetBody());a.RegisterCollision(d.GetObjectInstance(),c.GetObjectInstance())};b.EndContact=()=>{};b.PreSolve=()=>{};b.PostSolve=()=>{};this._world.SetContactListener(b);b=new Box2D.JSContactFilter;b.ShouldCollide=(d,c)=>{if(this._allCollisionsEnabled)return!0;d=Box2D.wrapPointer(d,Box2D.b2Fixture);c=Box2D.wrapPointer(c,Box2D.b2Fixture);d=C3$jscomp$276.Behaviors.Physics.Instance.LookupBehInstFromBody(d.GetBody());c=C3$jscomp$276.Behaviors.Physics.Instance.LookupBehInstFromBody(c.GetBody());
d=d.GetObjectInstance().GetObjectClass();const e=c.GetObjectInstance().GetObjectClass();c=d.GetSID();const g=e.GetSID();return(d=d.GetSavedDataMap().get("Physics_DisabledCollisions"))&&d.has(g)?!1:(d=e.GetSavedDataMap().get("Physics_DisabledCollisions"))&&d.has(c)?!1:!0};this._world.SetContactFilter(b);this._worldManifold=new Box2D.b2WorldManifold}Release(){super.Release()}GetBox2D(){return Box2D}GetWorld(){return this._world}GetWorldScale(){return this._worldScale}GetSteppingMode(){return this._steppingMode}SetSteppingMode(a){this._steppingMode=
a}SetLastUpdateTick(a){this._lastUpdateTick=a}GetLastUpdateTick(){return this._lastUpdateTick}SetVelocityIterations(a){this._velocityIterations=Math.max(a,1)}GetVelocityIterations(){return this._velocityIterations}SetPositionIterations(a){this._positionIterations=Math.max(a,1)}GetPositionIterations(){return this._positionIterations}SetIterations(a,b){this.SetVelocityIterations(a);this.SetPositionIterations(b)}GetGravity(){return this._worldG}SetGravity(a){a!==this._worldG&&(this._world.SetGravity(C3$jscomp$276.Behaviors.Physics.GetTempVec2A(0,
a)),this._worldG=a,this._WakeUpAllPhysicsBodies())}_WakeUpAllPhysicsBodies(){for(const b of this.GetInstances()){var a=C3$jscomp$276.Behaviors.Physics.Instance.LookupBehInstFromInst(b);a&&(a=a.GetBody())&&a.SetAwake(!0)}}DisableShouldCollideFastPath(){this._allCollisionsEnabled=!1}SetCollisionsEnabled(a,b,d){d=!!d;if(a&&b){if(b.IsFamily())for(const c of b.GetFamilyMembers())SetObjectTypeCollisionsEnabled(a,c,d);else SetObjectTypeCollisionsEnabled(a,b,d);this.DisableShouldCollideFastPath()}}GetWorldManifold(){return this._worldManifold}static GetPhysicsCollisionKey(){return"Physics_DisabledCollisions"}static GetVec2(a,
b){if(vec2RecycleCache.length){const d=vec2RecycleCache.pop();d.set_x(a);d.set_y(b);return d}return new Box2D.b2Vec2(a,b)}static FreeVec2(a){vec2RecycleCache.push(a)}static GetTempVec2A(a,b){tempVec2a.set_x(a);tempVec2a.set_y(b);return tempVec2a}static GetTempVec2B(a,b){tempVec2b.set_x(a);tempVec2b.set_y(b);return tempVec2b}static CreatePolygonShape(a){const b=new Box2D.b2PolygonShape,d=Box2D._malloc(8*a.length);var c=0;for(let e=0;e<a.length;++e)Box2D.HEAPF32[d+c>>2]=a[e].get_x(),Box2D.HEAPF32[d+
(c+4)>>2]=a[e].get_y(),c+=8;c=Box2D.wrapPointer(d,Box2D.b2Vec2);b.Set(c,a.length);Box2D._free(d);return b}};const STEPPING_MODES=["fixed","variable"];
self.IPhysicsBehavior=class extends self.IBehavior{constructor(){super()}set worldGravity(a){C3X$jscomp$45.RequireFiniteNumber(a);physicsBehavior.SetGravity(a)}get worldGravity(){return physicsBehavior.GetGravity()}set steppingMode(a){a=STEPPING_MODES.indexOf(a);if(0>a)throw Error("invalid stepping mode");physicsBehavior.SetSteppingMode(STEPPING_MODES[a])}get steppingMode(){return STEPPING_MODES[physicsBehavior.GetSteppingMode()]}set velocityIterations(a){C3X$jscomp$45.RequireFiniteNumber(a);physicsBehavior.SetVelocityIterations(a)}get velocityIterations(){return physicsBehavior.GetVelocityIterations()}set positionIterations(a){C3X$jscomp$45.RequireFiniteNumber(a);
physicsBehavior.SetPositionIterations(a)}get positionIterations(){return physicsBehavior.GetPositionIterations()}setCollisionsEnabled(a,b,d){const c=physicsBehavior.GetRuntime();a=c._UnwrapIObjectClass(a);b=c._UnwrapIObjectClass(b);physicsBehavior.SetCollisionsEnabled(a,b,!!d)}};const C3$jscomp$277=self.C3;C3$jscomp$277.Behaviors.Physics.Type=class extends C3$jscomp$277.SDKBehaviorTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};
const C3$jscomp$278=self.C3,C3X$jscomp$46=self.C3X,IBehaviorInstance$jscomp$3=self.IBehaviorInstance,body2beh=new WeakMap,inst2beh=new WeakMap,tileConvexPolyCache=new WeakMap,GetTempVec2A=C3$jscomp$278.Behaviors.Physics.GetTempVec2A,GetTempVec2B=C3$jscomp$278.Behaviors.Physics.GetTempVec2B,tempRect$jscomp$14=C3$jscomp$278.New(C3$jscomp$278.Rect),tempQuad$jscomp$9=C3$jscomp$278.New(C3$jscomp$278.Quad);
C3$jscomp$278.Behaviors.Physics.Instance=class extends C3$jscomp$278.SDKBehaviorInstanceBase{constructor(a,b){super(a);a=this.GetBehavior();const d=this.GetWorldInfo();this._box2d=a.GetBox2D();this._world=a.GetWorld();this._worldScale=a.GetWorldScale();this._isImmovable=!1;this._actualCollisionMask=this._collisionMask=0;this._preventRotation=!1;this._density=1;this._friction=.5;this._restitution=.2;this._linearDamping=0;this._angularDamping=.01;this._isBullet=!1;this._isEnabled=!0;this._body=null;
this._fixtures=[];this._myJoints=[];this._myCreatedJoints=[];this._joiningMe=new Set;this._lastKnownX=d.GetX();this._lastKnownY=d.GetY();this._lastKnownAngle=d.GetAngle();this._lastHeight=this._lastWidth=0;this._lastTickOverride=!1;b&&(this._isImmovable=!!b[0],this._collisionMask=b[1],this._preventRotation=!!b[2],this._density=b[3],this._friction=b[4],this._restitution=b[5],this._linearDamping=b[6],this._angularDamping=b[7],this._isBullet=!!b[8],this._isEnabled=!!b[9]);b=this._runtime.Dispatcher();
this._disposables=new C3$jscomp$278.CompositeDisposable(C3$jscomp$278.Disposable.From(b,"instancedestroy",c=>this._OnInstanceDestroyed(c.instance)),C3$jscomp$278.Disposable.From(b,"beforeload",()=>this._OnBeforeLoad()),C3$jscomp$278.Disposable.From(b,"afterload",()=>this._OnAfterLoad()));inst2beh.set(this._inst,this);this._isEnabled&&this._StartTicking()}PostCreate(){this._CreateBody()}Release(){this._DestroyMyJoints();C3$jscomp$278.clearArray(this._myCreatedJoints);this._joiningMe.clear();this._body&&
(this._DestroyFixtures(),this._world.DestroyBody(this._body),this._body=null);super.Release()}_CreateFixture(a){if(this._body)return a=this._body.CreateFixture(a),this._fixtures.push(a),a}_DestroyFixtures(){if(this._body){for(const a of this._fixtures)this._body.DestroyFixture(a);C3$jscomp$278.clearArray(this._fixtures)}}_GetBoundingQuadExcludingMesh(){const a=this.GetWorldInfo();return a.HasMesh()?(a.CalculateBbox(tempRect$jscomp$14,tempQuad$jscomp$9,!1),tempQuad$jscomp$9):a.GetBoundingQuad()}_Destroy(a){this._box2d.destroy(a)}_CreateBody(){if(this._isEnabled){var a=
this._box2d.b2FixtureDef,b=this._box2d.b2BodyDef,d=this.GetWorldInfo(),c=d.HasOwnCollisionPoly();this._actualCollisionMask=this._collisionMask;c||this._inst.HasTilemap()||0!==this._actualCollisionMask||(this._actualCollisionMask=1);if(!this._body){b=new b;b.set_type(this._isImmovable?0:2);c=d.GetX()*this._worldScale;var e=d.GetY()*this._worldScale;2===this._actualCollisionMask&&(e=this._GetBoundingQuadExcludingMesh(),c=e.midX()*this._worldScale,e=e.midY()*this._worldScale);b.set_position(GetTempVec2B(c,
e));b.set_angle(d.GetAngle());b.set_fixedRotation(this._preventRotation);b.set_linearDamping(this._linearDamping);b.set_angularDamping(this._angularDamping);b.set_bullet(this._isBullet);this._body=this._world.CreateBody(b);this._Destroy(b);body2beh.set(this._body,this)}this._DestroyFixtures();a=new a;a.set_density(this._density);a.set_friction(this._friction);a.set_restitution(this._restitution);b=Math.max(Math.abs(d.GetWidth()),1);c=Math.max(Math.abs(d.GetHeight()),1);0===this._actualCollisionMask?
this._inst.HasTilemap()?this._CreateTilemapFixtures(a):this._CreatePolygonFixture(a,b,c):1===this._actualCollisionMask?this._CreateBoundingBoxFixture(a,d,b,c):this._CreateCircleFixture(a,b,c);this._lastWidth=d.GetWidth();this._lastHeight=d.GetHeight();d.SetPhysicsBodyChanged(!1);this._Destroy(a)}}_CreateBoundingBoxFixture(a,b,d,c){const e=new this._box2d.b2PolygonShape;d*=this._worldScale;c*=this._worldScale;let g=b.GetOriginX(),k=b.GetOriginY();0>b.GetWidth()&&(g=1-g);0>b.GetHeight()&&(k=1-k);b=
C3$jscomp$278.Behaviors.Physics.GetVec2((.5-g)*d,(.5-k)*c);e.SetAsBox(d/2,c/2,b,0);a.set_shape(e);this._CreateFixture(a);this._Destroy(e);C3$jscomp$278.Behaviors.Physics.FreeVec2(b)}_CreateCircleFixture(a,b,d){const c=new this._box2d.b2CircleShape;c.set_m_radius(Math.min(b,d)*this._worldScale*.5);a.set_shape(c);this._CreateFixture(a);this._Destroy(c)}_CreatePolygonFixture(a,b,d){const c=this.GetWorldInfo();var e=0>c.GetWidth();const g=0>c.GetHeight(),k=this._worldScale,l=c.GetCustomTransformedCollisionPoly(e?
-b:b,g?-d:d,0).pointsArr(),n=l.length/2,p=[];for(let r=0;r<n;++r)p.push(C3$jscomp$278.Behaviors.Physics.GetVec2(l[2*r],l[2*r+1]));e!==g&&p.reverse();e=C3$jscomp$278.Behaviors.Physics.Separator.Separate(p,b*d);for(const r of p)C3$jscomp$278.Behaviors.Physics.FreeVec2(r);if(e.length)for(const r of e){for(const w of r)w.set_x(w.get_x()*k),w.set_y(w.get_y()*k);b=C3$jscomp$278.Behaviors.Physics.CreatePolygonShape(r);a.set_shape(b);this._CreateFixture(a);this._Destroy(b);for(const w of r)C3$jscomp$278.Behaviors.Physics.FreeVec2(w)}else this._CreateBoundingBoxFixture(a,
c,b,d)}_CreateTilemapFixtures(a){const b=this._worldScale,d=C3$jscomp$278.Behaviors.Physics.GetVec2,c=C3$jscomp$278.Behaviors.Physics.FreeVec2,e=[];this._inst.GetSdkInstance().GetAllCollisionRects(e);const g=[];for(let r=0,w=e.length;r<w;++r){var k=e[r],l=k.GetRect(),n=k.GetPoly();if(n){var p=tileConvexPolyCache.get(n);if(!p){p=n.pointsArr();const z=n.pointCount();for(let B=0;B<z;++B)g.push(d(p[2*B],p[2*B+1]));k=k.GetTileId()&3758096384;(-2147483648===k||1073741824===k||536870912===k||k&-2147483648&&
k&1073741824&&k&536870912)&&g.reverse();p=C3$jscomp$278.Behaviors.Physics.Separator.Separate(g,l.width()*l.height());tileConvexPolyCache.set(n,p);for(const B of g)c(B);C3$jscomp$278.clearArray(g)}for(let z=0,B=p.length;z<B;++z){n=p[z];for(let C=0,E=n.length;C<E;++C)g.push(d((l.getLeft()+n[C].get_x())*b,(l.getTop()+n[C].get_y())*b));n=C3$jscomp$278.Behaviors.Physics.CreatePolygonShape(g);a.set_shape(n);this._CreateFixture(a);this._Destroy(n);for(const C of g)c(C);C3$jscomp$278.clearArray(g)}}else g.push(d(l.getLeft()*
b,l.getTop()*b)),g.push(d(l.getRight()*b,l.getTop()*b)),g.push(d(l.getRight()*b,l.getBottom()*b)),g.push(d(l.getLeft()*b,l.getBottom()*b)),l=C3$jscomp$278.Behaviors.Physics.CreatePolygonShape(g),a.set_shape(l),this._CreateFixture(a),this._Destroy(l);for(const z of g)c(z);C3$jscomp$278.clearArray(g)}}_DestroyBody(){this._body&&(this._DestroyMyJoints(),body2beh.delete(this._body),this._DestroyFixtures(),this._world.DestroyBody(this._body),this._body=null)}_DestroyMyJoints(){for(const a of this._myJoints)this._world.DestroyJoint(a);
C3$jscomp$278.clearArray(this._myJoints)}_RecreateMyJoints(){for(const a of this._myCreatedJoints)switch(a.type){case 0:this._DoCreateDistanceJoint(...a.params);break;case 1:this._DoCreateRevoluteJoint(...a.params);break;case 2:this._DoCreateLimitedRevoluteJoint(...a.params);break;case 3:this._DoCreatePrismaticJoint(...a.params)}}_GetInstImagePoint(a){const b=this.GetWorldInfo();return-1===a?[b.GetX(),b.GetY()]:0===a&&this._body?(a=this._body.GetWorldCenter(),[a.get_x()/this._worldScale,a.get_y()/
this._worldScale]):this._inst.GetImagePoint(a)}_CreateDistanceJoint(a,b,d,c,e){if(this._isEnabled&&b&&b!==this._inst){var g=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b);g&&g._IsEnabled()&&(this._myCreatedJoints.push({type:0,params:[a,b.GetUID(),d,c,e]}),this._DoCreateDistanceJoint(a,b.GetUID(),d,c,e))}}_DoCreateDistanceJoint(a,b,d,c,e){if(this._isEnabled){var g=this._runtime.GetInstanceByUID(b);if(g&&g!==this._inst&&(b=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(g))&&
b._IsEnabled()){b._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(!1);b._UpdateBodyToMatchInstance(!1);var [k,l]=this._GetInstImagePoint(a),[n,p]=g.GetImagePoint(d);a=k-n;d=l-p;g=this._worldScale;var r=new this._box2d.b2DistanceJointDef;r.Initialize(this._body,b.GetBody(),GetTempVec2A(k*g,l*g),GetTempVec2B(n*g,p*g));r.set_length(Math.hypot(a,d)*g);r.set_dampingRatio(c);r.set_frequencyHz(e);this._myJoints.push(this._world.CreateJoint(r));this._Destroy(r)}}}_CreateRevoluteJoint(a,b){if(this._isEnabled&&
b&&b!==this._inst){var d=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b);d&&d._IsEnabled()&&(this._myCreatedJoints.push({type:1,params:[a,b.GetUID()]}),this._DoCreateRevoluteJoint(a,b.GetUID()))}}_DoCreateRevoluteJoint(a,b){if(this._isEnabled&&(b=this._runtime.GetInstanceByUID(b))&&b!==this._inst&&(b=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b))&&b._IsEnabled()){b._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(!1);b._UpdateBodyToMatchInstance(!1);
var [d,c]=this._GetInstImagePoint(a);a=this._worldScale;var e=new this._box2d.b2RevoluteJointDef;e.Initialize(this._body,b.GetBody(),GetTempVec2A(d*a,c*a));this._myJoints.push(this._world.CreateJoint(e));this._Destroy(e)}}_CreateLimitedRevoluteJoint(a,b,d,c){if(this._isEnabled&&b&&b!==this._inst){var e=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b);e&&e._IsEnabled()&&(d=C3$jscomp$278.toDegrees(d),c=C3$jscomp$278.toDegrees(c),this._myCreatedJoints.push({type:2,params:[a,b.GetUID(),
d,c]}),this._DoCreateLimitedRevoluteJoint(a,b.GetUID(),d,c))}}_DoCreateLimitedRevoluteJoint(a,b,d,c){if(this._isEnabled&&(b=this._runtime.GetInstanceByUID(b))&&b!==this._inst&&(b=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b))&&b._IsEnabled()){b._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(!1);b._UpdateBodyToMatchInstance(!1);var [e,g]=this._GetInstImagePoint(a);a=this._worldScale;var k=new this._box2d.b2RevoluteJointDef;k.Initialize(this._body,b.GetBody(),GetTempVec2A(e*
a,g*a));k.set_enableLimit(!0);k.set_lowerAngle(C3$jscomp$278.toRadians(d));k.set_upperAngle(C3$jscomp$278.toRadians(c));this._myJoints.push(this._world.CreateJoint(k));this._Destroy(k)}}_CreatePrismaticJoint(a,b,d,c,e,g,k,l,n){if(this._isEnabled&&b&&b!==this._inst){var p=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b);p&&p._IsEnabled()&&(d=C3$jscomp$278.toDegrees(d),l=C3$jscomp$278.toDegrees(l),this._myCreatedJoints.push({type:3,params:[a,b.GetUID(),d,c,e,g,k,l,n]}),this._DoCreatePrismaticJoint(a,
b.GetUID(),d,c,e,g,k,l,n))}}_DoCreatePrismaticJoint(a,b,d,c,e,g,k,l,n){if(this._isEnabled&&(b=this._runtime.GetInstanceByUID(b))&&b!==this._inst&&(b=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(b))&&b._IsEnabled()){b._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(!1);b._UpdateBodyToMatchInstance(!1);var [p,r]=this._GetInstImagePoint(a);d=C3$jscomp$278.toRadians(d);a=Math.cos(d);d=Math.sin(d);var w=this._worldScale,z=new this._box2d.b2PrismaticJointDef;z.Initialize(this._body,
b.GetBody(),GetTempVec2A(p*w,r*w),GetTempVec2B(a,d));z.set_enableLimit(!!c);z.set_lowerTranslation(e*w);z.set_upperTranslation(g*w);z.set_enableMotor(!!k);z.set_motorSpeed(C3$jscomp$278.toRadians(l));z.set_maxMotorForce(n);this._myJoints.push(this._world.CreateJoint(z));this._Destroy(z)}}_RemoveJoints(){this._isEnabled&&(this._DestroyMyJoints(),C3$jscomp$278.clearArray(this._myCreatedJoints),this._joiningMe.clear())}_RemoveOtherInstanceJointsToMe(){for(const a of this._joiningMe){const b=C3$jscomp$278.Behaviors.Physics.Instance.LookupBehInstFromInst(a);
if(!b||!b._IsEnabled())return;b._DestroyJointsForInstance(this._inst)}this._joiningMe.clear()}_OnInstanceDestroyed(a){this._DestroyJointsForInstance(a)}_DestroyJointsForInstance(a){const b=a.GetUID();let d=0;for(let c=0,e=this._myCreatedJoints.length;c<e;++c)this._myCreatedJoints[d]=this._myCreatedJoints[c],d<this._myJoints.length&&(this._myJoints[d]=this._myJoints[c]),this._myCreatedJoints[c].params[1]===b?c<this._myJoints.length&&this._world.DestroyJoint(this._myJoints[c]):++d;C3$jscomp$278.truncateArray(this._myCreatedJoints,
d);d<this._myJoints.length&&C3$jscomp$278.truncateArray(this._myJoints,d);this._joiningMe.delete(a)}GetBody(){return this._body}static LookupBehInstFromBody(a){return body2beh.get(a)||null}static LookupBehInstFromInst(a){return inst2beh.get(a)||null}SaveToJson(){const a={e:this._isEnabled,im:this._isImmovable,pr:this._preventRotation,d:this._density,fr:this._friction,re:this._restitution,ld:this._linearDamping,ad:this._angularDamping,b:this._isBullet,mcj:this._myCreatedJoints};if(this._isEnabled){const b=
this._body.GetLinearVelocity();a.vx=b.get_x();a.vy=b.get_y();a.om=this._body.GetAngularVelocity()}return a}_OnBeforeLoad(){this._DestroyMyJoints();C3$jscomp$278.clearArray(this._myCreatedJoints);this._joiningMe.clear()}LoadFromJson(a){this._DestroyBody();this._isEnabled=a.e;a.hasOwnProperty("im")&&(this._isImmovable=!!a.im);this._preventRotation=a.pr;this._density=a.d;this._friction=a.fr;this._restitution=a.re;this._linearDamping=a.ld;this._angularDamping=a.ad;this._isBullet=a.b;this._myCreatedJoints=
a.mcj;const b=this.GetWorldInfo();this._lastKnownX=b.GetX();this._lastKnownY=b.GetY();this._lastKnownAngle=b.GetAngle();this._lastWidth=b.GetWidth();this._lastHeight=b.GetHeight();this._isEnabled&&(this._CreateBody(),this._body.SetLinearVelocity(GetTempVec2A(a.vx,a.vy)),this._body.SetAngularVelocity(a.om),0===a.vx&&0===a.vy&&0===a.om||this._body.SetAwake(!0),this._myCreatedJoints=a.mcj);this._isEnabled?this._StartTicking():this._StopTicking()}_OnAfterLoad(){this._isEnabled&&this._RecreateMyJoints()}Tick(){if(this._isEnabled){var a=
this._runtime,b=this.GetBehavior();if(0===b.GetSteppingMode())var d=a.GetTimeScale()/60;else d=a.GetDt(this._inst),d>1/30&&(d=1/30);var c=a.GetTickCountNoSave();if(c>b.GetLastUpdateTick()&&0<a.GetTimeScale()){a=this._runtime.IsDebug();let e=0;a&&(e=performance.now());0!==d&&this._world.Step(d,b.GetVelocityIterations(),b.GetPositionIterations());this._world.ClearForces();a&&self.C3Debugger.AddPhysicsTime(performance.now()-e);b.SetLastUpdateTick(c)}this._UpdateBodyToMatchInstance(!0)}}_UpdateBodyToMatchInstance(a){const b=
this._inst.GetWorldInfo();var d=this._worldScale;(b.GetWidth()!==this._lastWidth||b.GetHeight()!==this._lastHeight||b.IsPhysicsBodyChanged())&&this._CreateBody();var c=this._body,e=b.GetX(),g=b.GetY(),k=e-this._lastKnownX;const l=g-this._lastKnownY,n=.001<Math.abs(k)||.001<Math.abs(l),p=b.GetAngle()!==this._lastKnownAngle;2===this._actualCollisionMask&&(g=this._GetBoundingQuadExcludingMesh(),e=g.midX(),g=g.midY());n?(p?c.SetTransform(GetTempVec2A(e*d,g*d),b.GetAngle()):c.SetTransform(GetTempVec2A(e*
d,g*d),c.GetAngle()),a&&(c.SetLinearVelocity(GetTempVec2A(k,l)),this._lastTickOverride=!0),c.SetAwake(!0)):a&&this._lastTickOverride&&(this._lastTickOverride=!1,c.SetLinearVelocity(GetTempVec2A(0,0)),c.SetTransform(GetTempVec2A(e*d,g*d),c.GetAngle()));!n&&p&&(c.SetTransform(c.GetPosition(),b.GetAngle()),c.SetAwake(!0));k=c.GetPosition();a=k.get_x()/d;d=k.get_y()/d;c=c.GetAngle();if(a!==b.GetX()||d!==b.GetY()||c!==b.GetAngle())if(b.SetXY(a,d),b.SetAngle(c),b.SetBboxChanged(),2===this._actualCollisionMask&&
(d=this._GetBoundingQuadExcludingMesh(),c=d.midX()-b.GetX(),d=d.midY()-b.GetY(),0!==c||0!==d))b.OffsetXY(-c,-d),b.SetBboxChanged();this._lastKnownX=b.GetX();this._lastKnownY=b.GetY();this._lastKnownAngle=b.GetAngle()}GetPropertyValueByIndex(a){switch(a){case 2:return this._IsPreventRotate();case 3:return this._GetDensity();case 4:return this._GetFriction();case 5:return this._GetElasticity();case 6:return this._GetLinearDamping();case 7:return this._GetAngularDamping();case 8:return this._IsBullet();
case 9:return this._IsEnabled()}}SetPropertyValueByIndex(a,b){switch(a){case 2:this._SetPreventRotate(b);break;case 3:this._SetDensity(b);break;case 4:this._SetFriction(b);break;case 5:this._SetElasticity(b);break;case 6:this._SetLinearDamping(b);break;case 7:this._SetAngularDamping(b);break;case 8:this._SetBullet(b);break;case 9:this._SetEnabled(b)}}_SetEnabled(a){a=!!a;this._isEnabled&&!a?(this._RemoveOtherInstanceJointsToMe(),this._DestroyBody(),this._isEnabled=!1,this._StopTicking()):!this._isEnabled&&
a&&(this._isEnabled=!0,this._CreateBody(),this._StartTicking())}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){const a=[{name:"behaviors.physics.properties.enabled.name",value:this._IsEnabled(),onedit:b=>this._SetEnabled(b)},{name:"behaviors.physics.properties.immovable.name",value:this._IsImmovable(),onedit:b=>this._SetImmovable(b)},{name:"behaviors.physics.properties.density.name",value:this._GetDensity(),onedit:b=>this._SetDensity(b)},{name:"behaviors.physics.properties.friction.name",
value:this._GetFriction(),onedit:b=>this._SetFriction(b)},{name:"behaviors.physics.properties.elasticity.name",value:this._GetElasticity(),onedit:b=>this._SetElasticity(b)},{name:"behaviors.physics.properties.linear-damping.name",value:this._GetLinearDamping(),onedit:b=>this._SetLinearDamping(b)},{name:"behaviors.physics.properties.angular-damping.name",value:this._GetAngularDamping(),onedit:b=>this._SetAngularDamping(b)}];this._isEnabled&&(a.push({name:"behaviors.physics.debugger.is-sleeping",value:!this._IsAwake()}),
a.push({name:"behaviors.physics.debugger.velocity-x",value:this._GetVelocityX(),onedit:b=>this._SetVelocity(b,this._GetVelocityY())}),a.push({name:"behaviors.physics.debugger.velocity-y",value:this._GetVelocityY(),onedit:b=>this._SetVelocity(this._GetVelocityX(),b)}),a.push({name:"behaviors.physics.debugger.angular-velocity",value:C3$jscomp$278.toDegrees(this._GetAngularVelocity()),onedit:b=>this._SetAngularVelocity(C3$jscomp$278.toRadians(b))}),a.push({name:"behaviors.physics.debugger.mass",value:this._GetMass()}));
return[{title:"$"+this.GetBehaviorType().GetName(),properties:a}]}_ApplyForce(a,b,d){const [c,e]=this._GetInstImagePoint(d);this._DoApplyForce(a,b,c,e)}_ApplyForceToward(a,b,d,c){const [e,g]=this._GetInstImagePoint(c);b=C3$jscomp$278.angleTo(e,g,b,d);this._DoApplyForce(Math.cos(b)*a,Math.sin(b)*a,e,g)}_ApplyForceAtAngle(a,b,d){const [c,e]=this._GetInstImagePoint(d);this._DoApplyForce(Math.cos(b)*a,Math.sin(b)*a,c,e)}_DoApplyForce(a,b,d,c){if(this._isEnabled){var e=this._worldScale;this._body.ApplyForce(GetTempVec2A(a,
b),GetTempVec2B(d*e,c*e),!0)}}_ApplyImpulse(a,b,d){const [c,e]=this._GetInstImagePoint(d);this._DoApplyImpulse(a,b,c,e)}_ApplyImpulseToward(a,b,d,c){const [e,g]=this._GetInstImagePoint(c);b=C3$jscomp$278.angleTo(e,g,b,d);this._DoApplyImpulse(Math.cos(b)*a,Math.sin(b)*a,e,g)}_ApplyImpulseAtAngle(a,b,d){const [c,e]=this._GetInstImagePoint(d);this._DoApplyImpulse(Math.cos(b)*a,Math.sin(b)*a,c,e)}_DoApplyImpulse(a,b,d,c){if(this._isEnabled){var e=this._worldScale;this._body.ApplyLinearImpulse(GetTempVec2A(a,
b),GetTempVec2B(d*e,c*e),!0);a=this.GetWorldInfo();this._lastKnownX=a.GetX();this._lastKnownY=a.GetY();this._lastTickOverride=!1}}_ApplyTorque(a){this._isEnabled&&this._body.ApplyTorque(a,!0)}_ApplyTorqueToAngle(a,b){b=C3$jscomp$278.angleClockwise(this.GetWorldInfo().GetAngle(),b)?-1:1;this._ApplyTorque(a*b)}_ApplyTorqueToPosition(a,b,d){var c=this.GetWorldInfo();b=C3$jscomp$278.angleTo(c.GetX(),c.GetY(),b,d);c=C3$jscomp$278.angleClockwise(c.GetAngle(),b)?-1:1;this._ApplyTorque(a*c)}_SetAngularVelocity(a){this._isEnabled&&
(this._body.SetAngularVelocity(a),this._body.SetAwake(!0))}_GetAngularVelocity(){return this._isEnabled?this._body.GetAngularVelocity():0}_SetVelocity(a,b){if(this._isEnabled){var d=this._worldScale;this._body.SetLinearVelocity(GetTempVec2A(a*d,b*d));this._body.SetAwake(!0);a=this.GetWorldInfo();this._lastKnownX=a.GetX();this._lastKnownY=a.GetY();this._lastTickOverride=!1}}_GetVelocity(){if(!this._isEnabled)return[0,0];const a=this._worldScale,b=this._body.GetLinearVelocity();return[b.get_x()/a,b.get_y()/
a]}_GetVelocityX(){return this._isEnabled?this._body.GetLinearVelocity().get_x()/this._worldScale:0}_GetVelocityY(){return this._isEnabled?this._body.GetLinearVelocity().get_y()/this._worldScale:0}_Teleport(a,b){if(this._isEnabled){var d=this._worldScale;this._body.SetTransform(GetTempVec2A(a*d,b*d),this._body.GetAngle());d=this.GetWorldInfo();d.SetXY(a,b);d.SetBboxChanged();this._lastKnownX=d.GetX();this._lastKnownY=d.GetY()}}_SetDensity(a){if(this._isEnabled&&this._density!==a){this._density=a;
for(const b of this._fixtures)b.SetDensity(a);this._body.ResetMassData()}}_GetDensity(){return this._isEnabled?this._density:0}_SetFriction(a){if(this._isEnabled&&this._friction!==a){this._friction=a;for(var b of this._fixtures)b.SetFriction(a);for(a=this._body.GetContactList();this._box2d.getPointer(a);a=a.get_next())(b=a.get_contact())&&b.ResetFriction()}}_GetFriction(){return this._isEnabled?this._friction:0}_SetElasticity(a){if(this._isEnabled&&this._restitution!==a){this._restitution=a;for(const b of this._fixtures)b.SetRestitution(a)}}_GetElasticity(){return this._isEnabled?
this._restitution:0}_SetLinearDamping(a){this._isEnabled&&this._linearDamping!==a&&(this._linearDamping=a,this._body.SetLinearDamping(a))}_GetLinearDamping(){return this._isEnabled?this._linearDamping:0}_SetAngularDamping(a){this._isEnabled&&this._angularDamping!==a&&(this._angularDamping=a,this._body.SetAngularDamping(a))}_GetAngularDamping(){return this._isEnabled?this._angularDamping:0}_SetImmovable(a){this._isEnabled&&(a=!!a,this._isImmovable!==a&&(this._isImmovable=a,this._body.SetType(this._isImmovable?
0:2),this._body.SetAwake(!0)))}_IsImmovable(){return this._isImmovable}_SetPreventRotate(a){this._isEnabled&&(a=!!a,this._preventRotation!==a&&(this._preventRotation=a,this._body.SetFixedRotation(this._preventRotation),this._body.SetAngularVelocity(0),this._body.SetAwake(!0)))}_IsPreventRotate(){return this._preventRotation}_SetBullet(a){this._isEnabled&&(a=!!a,this._isBullet!==a&&(this._isBullet=a,this._body.SetBullet(this._isBullet),this._body.SetAwake(!0)))}_IsBullet(){return this._isBullet}_SetAwake(a){this._isEnabled&&
this._body.SetAwake(!!a)}_IsAwake(){return this._isEnabled?this._body.IsAwake():!1}_GetMass(){return this._isEnabled?this._body.GetMass()/this._worldScale:0}_GetCenterOfMassX(){return this._isEnabled?this._body.GetWorldCenter().get_x()/this._worldScale:0}_GetCenterOfMassY(){return this._isEnabled?this._body.GetWorldCenter().get_y()/this._worldScale:0}_GetCenterOfMass(){if(!this._isEnabled)return[0,0];const a=this._body.GetWorldCenter(),b=this._worldScale;return[a.get_x()/b,a.get_y()/b]}_GetContactCount(){if(!this._isEnabled)return 0;
let a=0;for(let d=this._body.GetContactList();this._box2d.getPointer(d);d=d.get_next()){var b=d.get_contact();b&&(b=b.GetManifold().get_pointCount(),a+=b)}return a}_GetContactPositionAt(a){a=Math.floor(a);if(!this._isEnabled)return[0,0];var b=0;for(let c=this._body.GetContactList();this._box2d.getPointer(c);c=c.get_next()){var d=c.get_contact();if(!d)continue;const e=d.GetManifold().get_pointCount();if(a>=b&&a<b+e)return a-=b,b=this.GetBehavior().GetWorldManifold(),d.GetWorldManifold(b),d=b.get_points(a),
[d.get_x()/this._worldScale,d.get_y()/this._worldScale];b+=e}return[0,0]}GetScriptInterfaceClass(){return self.IPhysicsBehaviorInstance}};const map$jscomp$37=new WeakMap;function UnwrapIWorldInstance(a,b){return map$jscomp$37.get(a).GetRuntime()._UnwrapIWorldInstance(b)}
self.IPhysicsBehaviorInstance=class extends IBehaviorInstance$jscomp$3{constructor(){super();map$jscomp$37.set(this,IBehaviorInstance$jscomp$3._GetInitInst().GetSdkInstance())}get isEnabled(){return map$jscomp$37.get(this)._IsEnabled()}set isEnabled(a){map$jscomp$37.get(this)._SetEnabled(a)}applyForce(a,b,d=0){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._ApplyForce(a,b,d)}applyForceTowardPosition(a,b,d,c=0){C3X$jscomp$46.RequireFiniteNumber(a);
C3X$jscomp$46.RequireFiniteNumber(b);C3X$jscomp$46.RequireFiniteNumber(d);map$jscomp$37.get(this)._ApplyForceToward(a,b,d,c)}applyForceAtAngle(a,b,d=0){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._ApplyForceAtAngle(a,b,d)}applyImpulse(a,b,d=0){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._ApplyImpulse(a,b,d)}applyImpulseTowardPosition(a,b,d,c=0){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);
C3X$jscomp$46.RequireFiniteNumber(d);map$jscomp$37.get(this)._ApplyImpulseToward(a,b,d,c)}applyImpulseAtAngle(a,b,d=0){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._ApplyImpulseAtAngle(a,b,d)}applyTorque(a){C3X$jscomp$46.RequireFiniteNumber(a);map$jscomp$37.get(this)._ApplyTorque(a)}applyTorqueToAngle(a,b){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._ApplyTorqueToAngle(a,b)}applyTorqueToPosition(a,
b,d){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);C3X$jscomp$46.RequireFiniteNumber(d);map$jscomp$37.get(this)._ApplyTorqueToPosition(a,b,d)}set angularVelocity(a){C3X$jscomp$46.RequireFiniteNumber(a);map$jscomp$37.get(this)._SetAngularVelocity(a)}get angularVelocity(){return map$jscomp$37.get(this)._GetAngularVelocity()}setVelocity(a,b){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._SetVelocity(a,b)}getVelocityX(){return map$jscomp$37.get(this)._GetVelocityX()}getVelocityY(){return map$jscomp$37.get(this)._GetVelocityY()}getVelocity(){return map$jscomp$37.get(this)._GetVelocity()}teleport(a,
b){C3X$jscomp$46.RequireFiniteNumber(a);C3X$jscomp$46.RequireFiniteNumber(b);map$jscomp$37.get(this)._Teleport(a,b)}set density(a){C3X$jscomp$46.RequireFiniteNumber(a);map$jscomp$37.get(this)._SetDensity(a)}get density(){return map$jscomp$37.get(this)._GetDensity()}set friction(a){C3X$jscomp$46.RequireFiniteNumber(a);map$jscomp$37.get(this)._SetFriction(a)}get friction(){return map$jscomp$37.get(this)._GetFriction()}set elasticity(a){C3X$jscomp$46.RequireFiniteNumber(a);map$jscomp$37.get(this)._SetElasticity(a)}get elasticity(){return map$jscomp$37.get(this)._GetElasticity()}set linearDamping(a){C3X$jscomp$46.RequireFiniteNumber(a);
map$jscomp$37.get(this)._SetLinearDamping(a)}get linearDamping(){return map$jscomp$37.get(this)._GetLinearDamping()}set angularDamping(a){C3X$jscomp$46.RequireFiniteNumber(a);map$jscomp$37.get(this)._SetAngularDamping(a)}get angularDamping(){return map$jscomp$37.get(this)._GetAngularDamping()}set isImmovable(a){map$jscomp$37.get(this)._SetImmovable(a)}get isImmovable(){return map$jscomp$37.get(this)._IsImmovable()}set isPreventRotation(a){map$jscomp$37.get(this)._SetPreventRotate(a)}get isPreventRotation(){return map$jscomp$37.get(this)._IsPreventRotate()}set isBullet(a){map$jscomp$37.get(this)._SetBullet(a)}get isBullet(){return map$jscomp$37.get(this)._IsBullet()}get mass(){return map$jscomp$37.get(this)._GetMass()}getCenterOfMassX(){return map$jscomp$37.get(this)._GetCenterOfMassX()}getCenterOfMassY(){return map$jscomp$37.get(this)._GetCenterOfMassY()}getCenterOfMass(){return map$jscomp$37.get(this)._GetCenterOfMass()}getContactCount(){return map$jscomp$37.get(this)._GetContactCount()}getContactX(a){C3X$jscomp$46.RequireFiniteNumber(a);
return map$jscomp$37.get(this)._GetContactPositionAt(a)[0]}getContactY(a){C3X$jscomp$46.RequireFiniteNumber(a);return map$jscomp$37.get(this)._GetContactPositionAt(a)[1]}getContact(a){C3X$jscomp$46.RequireFiniteNumber(a);return map$jscomp$37.get(this)._GetContactPositionAt(a)}set isAwake(a){map$jscomp$37.get(this)._SetAwake(!!a)}get isAwake(){return map$jscomp$37.get(this)._IsAwake()}get isSleeping(){return!map$jscomp$37.get(this)._IsAwake()}createDistanceJoint(a,b,d,c,e){C3X$jscomp$46.RequireFiniteNumber(c);
C3X$jscomp$46.RequireFiniteNumber(e);b=UnwrapIWorldInstance(this,b);map$jscomp$37.get(this)._CreateDistanceJoint(a,b,d,c,e)}createRevoluteJoint(a,b){b=UnwrapIWorldInstance(this,b);map$jscomp$37.get(this)._CreateRevoluteJoint(a,b)}createLimitedRevoluteJoint(a,b,d,c){C3X$jscomp$46.RequireFiniteNumber(d);C3X$jscomp$46.RequireFiniteNumber(c);b=UnwrapIWorldInstance(this,b);map$jscomp$37.get(this)._CreateLimitedRevoluteJoint(a,b,d,c)}createPrismaticJoint(a,b,d,c,e,g,k,l,n){b=UnwrapIWorldInstance(this,b);
map$jscomp$37.get(this)._CreatePrismaticJoint(a,b,d,c,e,g,k,l,n)}removeAllJoints(){map$jscomp$37.get(this)._RemoveJoints()}};const C3$jscomp$279=self.C3;
C3$jscomp$279.Behaviors.Physics.Cnds={IsSleeping(){return!this._IsAwake()},CompareVelocity(a,b,d){if(!this._isEnabled)return!1;if(0===a)a=this._GetVelocityX();else if(1===a)a=this._GetVelocityY();else{const [c,e]=this._GetVelocity();a=Math.hypot(c,e)}return C3$jscomp$279.compare(a,b,d)},CompareAngularVelocity(a,b){if(!this._isEnabled)return!1;const d=C3$jscomp$279.toDegrees(this._GetAngularVelocity());return C3$jscomp$279.compare(d,a,b)},CompareMass(a,b){if(!this._isEnabled)return!1;const d=this._GetMass();
return C3$jscomp$279.compare(d,a,b)},IsEnabled(){return this._IsEnabled()}};const C3$jscomp$280=self.C3;
C3$jscomp$280.Behaviors.Physics.Acts={ApplyForce(a,b,d){this._ApplyForce(a,b,d)},ApplyForceToward(a,b,d,c){this._ApplyForceToward(a,b,d,c)},ApplyForceAtAngle(a,b,d){this._ApplyForceAtAngle(a,C3$jscomp$280.toRadians(b),d)},ApplyImpulse(a,b,d){this._ApplyImpulse(a,b,d)},ApplyImpulseToward(a,b,d,c){this._ApplyImpulseToward(a,b,d,c)},ApplyImpulseAtAngle(a,b,d){this._ApplyImpulseAtAngle(a,C3$jscomp$280.toRadians(b),d)},ApplyTorque(a){this._ApplyTorque(C3$jscomp$280.toRadians(a))},ApplyTorqueToAngle(a,
b){this._ApplyTorqueToAngle(C3$jscomp$280.toRadians(a),C3$jscomp$280.toRadians(b))},ApplyTorqueToPosition(a,b,d){this._ApplyTorqueToPosition(C3$jscomp$280.toRadians(a),b,d)},SetAngularVelocity(a){this._SetAngularVelocity(C3$jscomp$280.toRadians(a))},CreateDistanceJoint(a,b,d,c,e){b&&(b=b.GetFirstPicked(this._inst),this._CreateDistanceJoint(a,b,d,c,e))},CreateRevoluteJoint(a,b){b&&(b=b.GetFirstPicked(this._inst),this._CreateRevoluteJoint(a,b))},CreateLimitedRevoluteJoint(a,b,d,c){b&&(b=b.GetFirstPicked(this._inst),
this._CreateLimitedRevoluteJoint(a,b,C3$jscomp$280.toRadians(d),C3$jscomp$280.toRadians(c)))},CreatePrismaticJoint(a,b,d,c,e,g,k,l,n){b&&(b=b.GetFirstPicked(this._inst),this._CreatePrismaticJoint(a,b,C3$jscomp$280.toRadians(d),c,e,g,k,C3$jscomp$280.toRadians(l),n))},RemoveJoints(){this._RemoveJoints()},SetWorldGravity(a){this.GetBehavior().SetGravity(a)},SetSteppingMode(a){this.GetBehavior().SetSteppingMode(a)},SetIterations(a,b){this.GetBehavior().SetIterations(a,b)},SetVelocity(a,b){this._SetVelocity(a,
b)},Teleport(a,b){this._Teleport(a,b)},SetDensity(a){this._SetDensity(a)},SetFriction(a){this._SetFriction(a)},SetElasticity(a){this._SetElasticity(a)},SetLinearDamping(a){this._SetLinearDamping(a)},SetAngularDamping(a){this._SetAngularDamping(a)},SetImmovable(a){this._SetImmovable(a)},EnableCollisions(a,b){this.GetBehavior().SetCollisionsEnabled(this.GetObjectClass(),a,0!==b)},SetPreventRotate(a){this._SetPreventRotate(0!==a)},SetBullet(a){this._SetBullet(0!==a)},SetAwake(a){this._SetAwake(!!a)},
SetEnabled(a){this._SetEnabled(0!==a)}};const C3$jscomp$281=self.C3;
C3$jscomp$281.Behaviors.Physics.Exps={VelocityX(){return this._GetVelocityX()},VelocityY(){return this._GetVelocityY()},AngularVelocity(){return C3$jscomp$281.toDegrees(this._GetAngularVelocity())},Mass(){return this._GetMass()},CenterOfMassX(){return this._GetCenterOfMassX()},CenterOfMassY(){return this._GetCenterOfMassY()},Density(){return this._GetDensity()},Friction(){return this._GetFriction()},Elasticity(){return this._GetElasticity()},LinearDamping(){return this._GetLinearDamping()},AngularDamping(){return this._GetAngularDamping()},
ContactCount(){return this._GetContactCount()},ContactXAt(a){return this._GetContactPositionAt(a)[0]},ContactYAt(a){return this._GetContactPositionAt(a)[1]}};"use strict";const C3$jscomp$282=self.C3,b2Separator={};C3$jscomp$282.Behaviors.Physics.Separator=b2Separator;const GetVec2$jscomp$1=C3$jscomp$282.Behaviors.Physics.GetVec2,FreeVec2$jscomp$1=C3$jscomp$282.Behaviors.Physics.FreeVec2;function CloneVec2(a){return GetVec2$jscomp$1(a.get_x(),a.get_y())}
b2Separator.det=function(a,b,d,c,e,g){return a*c+d*g+e*b-b*d-c*e-g*a};b2Separator.hitRay=function(a,b,d,c,e,g,k,l){var n=d-a,p=c-b,r=k-e;const w=l-g;r=(r*(g-b)-w*(e-a))/(p*r-n*w);n=a+r*n;p=b+r*p;a=b2Separator.isOnSegment(d,c,a,b,n,p);e=b2Separator.isOnSegment(n,p,e,g,k,l);return a&&e?GetVec2$jscomp$1(n,p):null};b2Separator.isOnSegment=function(a,b,d,c,e,g){return(d+.1>=a&&a>=e-.1||d-.1<=a&&a<=e+.1)&&(c+.1>=b&&b>=g-.1||c-.1<=b&&b<=g+.1)&&b2Separator.isOnLine(a,b,d,c,e,g)};
b2Separator.isOnLine=function(a,b,d,c,e,g){return.1<Math.abs(e-d)?.1>Math.abs((g-c)/(e-d)*(a-d)+c-b):.1>Math.abs(a-d)};b2Separator.pointsMatch=function(a,b,d,c){return.1>Math.abs(d-a)&&.1>Math.abs(c-b)};
b2Separator.Separate=function(a,b){a=b2Separator.calcShapes(a);let d=[];for(let c=0,e=a.length;c<e;++c){const g=a[c],k=[];let l=0;for(let n=0,p=g.length;n<p;++n){const r=g[n],w=g[(n+1)%p];l+=r.get_x()*w.get_y()-r.get_y()*w.get_x();k.push(GetVec2$jscomp$1(r.get_x(),r.get_y()))}l=Math.abs(l/2);if(l>=.001*b)d.push(k);else for(let n=0,p=k.length;n<p;n++)FreeVec2$jscomp$1(k[n])}return d=SplitConvexPolysOver8Points(d)};
b2Separator.calcShapes=function(a){var b;let d;var c;let e;let g,k,l,n;let p;var r=0;let w=0,z,B=[],C=[];for(C.push(a);C.length;){a=C[0];d=a.length;z=!0;for(b=0;b<d;b++){g=b;k=b<d-1?b+1:b+1-d;var E=b<d-2?b+2:b+2-d;l=a[g];n=a[k];E=a[E];E=b2Separator.det(l.get_x(),l.get_y(),n.get_x(),n.get_y(),E.get_x(),E.get_y());if(0>E){z=!1;var F=1E9;for(c=0;c<d;c++)if(c!==g&&c!==k){b=c;E=c<d-1?c+1:0;var I=a[b];var K=a[E];if(I=b2Separator.hitRay(l.get_x(),l.get_y(),n.get_x(),n.get_y(),I.get_x(),I.get_y(),K.get_x(),
K.get_y()))K=n.get_x()-I.get_x(),e=n.get_y()-I.get_y(),K=K*K+e*e,K<F?(w=b,r=E,p=I,F=K):FreeVec2$jscomp$1(I)}if(1E9===F)return[];c=[];F=[];b=w;E=r;I=a[b];K=a[E];r=!1;b2Separator.pointsMatch(p.get_x(),p.get_y(),K.get_x(),K.get_y())||(c.push(p),r=!0);b2Separator.pointsMatch(p.get_x(),p.get_y(),I.get_x(),I.get_y())||(F.push(p),r=!0);r||FreeVec2$jscomp$1(p);w=-1;for(r=g;;){if(r!==E)c.push(a[r]);else{if(0>w||w>=d)return[];b2Separator.isOnSegment(K.get_x(),K.get_y(),a[w].get_x(),a[w].get_y(),l.get_x(),l.get_y())||
c.push(a[r]);break}w=r;0>r-1?r=d-1:r--}c.reverse();w=-1;for(r=k;;){if(r!==b)F.push(a[r]);else{if(0>w||w>=d)return[];r!==b||b2Separator.isOnSegment(I.get_x(),I.get_y(),a[w].get_x(),a[w].get_y(),n.get_x(),n.get_y())||F.push(a[r]);break}w=r;r+1>d-1?r=0:r++}C.push(c,F);C.shift();break}}z&&B.push(C.shift())}return B};function SplitConvexPolysOver8Points(a){const b=[];for(const d of a)8>=d.length?b.push(d):b.push.apply(b,SplitConvexPoly(d));return b}
function SplitConvexPoly(a){const b=[];b.push(a.splice(0,8));const d=b[0][0];let c=b[0][7];for(;a.length;){const e=a.splice(0,Math.min(a.length,6));let g=e.at(-1);e.push(CloneVec2(d));e.push(CloneVec2(c));b.push(e);c=g}return b}"use strict";const C3$jscomp$283=self.C3;
C3$jscomp$283.Behaviors.DragnDrop=class extends C3$jscomp$283.SDKBehaviorBase{constructor(a){super(a);a=this._runtime.Dispatcher();this._disposables=new C3$jscomp$283.CompositeDisposable(C3$jscomp$283.Disposable.From(a,"pointerdown",b=>this._OnPointerDown(b.data)),C3$jscomp$283.Disposable.From(a,"pointermove",b=>this._OnPointerMove(b.data)),C3$jscomp$283.Disposable.From(a,"pointerup",b=>this._OnPointerUp(b.data,!1)),C3$jscomp$283.Disposable.From(a,"pointercancel",b=>this._OnPointerUp(b.data,!0)))}Release(){this._disposables.Release();
this._disposables=null;super.Release()}_OnPointerDown(a){"mouse"===a.pointerType&&0!==a.button||this._OnInputDown(a.pointerId.toString(),a.pageX-this._runtime.GetCanvasClientX(),a.pageY-this._runtime.GetCanvasClientY())}_OnPointerMove(a){0!==(a.lastButtons&1)&&0===(a.buttons&1)?this._OnInputUp(a.pointerId.toString()):this._OnInputMove(a.pointerId.toString(),a.pageX-this._runtime.GetCanvasClientX(),a.pageY-this._runtime.GetCanvasClientY())}_OnPointerUp(a,b){"mouse"===a.pointerType&&0!==a.button||this._OnInputUp(a.pointerId.toString())}async _OnInputDown(a,
b,d){var c=this.GetInstances();let e=null,g=null,k=0,l=0;for(const n of c){c=n.GetBehaviorSdkInstanceFromCtor(C3$jscomp$283.Behaviors.DragnDrop);if(!c.IsEnabled()||c.IsDragging()||n.IsDestroyed())continue;const p=n.GetWorldInfo(),r=p.GetLayer(),[w,z]=r.CanvasCssToLayer(b,d,p.GetTotalZElevation());if(!r.IsSelfAndParentsInteractive()||!p.ContainsPoint(w,z))continue;if(!e){e=n;g=c;k=w;l=z;continue}const B=e.GetWorldInfo();if(r.GetIndex()>B.GetLayer().GetIndex()||r.GetIndex()===B.GetLayer().GetIndex()&&
p.GetZIndex()>B.GetZIndex())e=n,g=c,k=w,l=z}e&&await g._OnDown(a,k,l)}_OnInputMove(a,b,d){var c=this.GetInstances();for(const e of c){c=e.GetBehaviorSdkInstanceFromCtor(C3$jscomp$283.Behaviors.DragnDrop);if(!c.IsEnabled()||!c.IsDragging()||c.IsDragging()&&c.GetDragSource()!==a)continue;const g=e.GetWorldInfo(),k=g.GetLayer(),[l,n]=k.CanvasCssToLayer(b,d,g.GetTotalZElevation());c._OnMove(l,n)}}async _OnInputUp(a){var b=this.GetInstances();for(const d of b)b=d.GetBehaviorSdkInstanceFromCtor(C3$jscomp$283.Behaviors.DragnDrop),
b.IsDragging()&&b.GetDragSource()===a&&await b._OnUp()}};const C3$jscomp$284=self.C3;C3$jscomp$284.Behaviors.DragnDrop.Type=class extends C3$jscomp$284.SDKBehaviorTypeBase{constructor(a){super(a)}Release(){super.Release()}OnCreate(){}};const C3$jscomp$285=self.C3,IBehaviorInstance$jscomp$4=self.IBehaviorInstance;
C3$jscomp$285.Behaviors.DragnDrop.Instance=class extends C3$jscomp$285.SDKBehaviorInstanceBase{constructor(a,b){super(a);this._isDragging=!1;this._dy=this._dx=0;this._dragSource="<none>";this._axes=0;this._isEnabled=!0;b&&(this._axes=b[0],this._isEnabled=b[1])}Release(){super.Release()}SaveToJson(){return{a:this._axes,e:this._isEnabled}}LoadFromJson(a){this._axes=a.a;this._isEnabled=a.e;this._isDragging=!1}_SetEnabled(a){this._isEnabled=!!a;this._isEnabled||(this._isDragging=!1)}IsEnabled(){return this._isEnabled}_SetAxes(a){this._axes=
a}_GetAxes(){return this._axes}_Drop(){this._isDragging&&this._OnUp()}IsDragging(){return this._isDragging}GetDragSource(){return this._dragSource}async _OnDown(a,b,d){const c=this.GetWorldInfo();this._dx=b-c.GetX();this._dy=d-c.GetY();this._isDragging=!0;this._dragSource=a;this.DispatchScriptEvent("dragstart");await this.TriggerAsync(C3$jscomp$285.Behaviors.DragnDrop.Cnds.OnDragStart)}_OnMove(a,b){const d=this.GetWorldInfo();a-=this._dx;b-=this._dy;if(0===this._axes){if(d.GetX()!==a||d.GetY()!==
b)d.SetXY(a,b),d.SetBboxChanged()}else 1===this._axes?d.GetX()!==a&&(d.SetX(a),d.SetBboxChanged()):2===this._axes&&d.GetY()!==b&&(d.SetY(b),d.SetBboxChanged())}async _OnUp(){this._isDragging=!1;this.DispatchScriptEvent("drop");await this.TriggerAsync(C3$jscomp$285.Behaviors.DragnDrop.Cnds.OnDrop)}GetPropertyValueByIndex(a){switch(a){case 0:return this._GetAxes();case 1:return this.IsEnabled()}}SetPropertyValueByIndex(a,b){switch(a){case 0:this._SetAxes(b);break;case 1:this._SetEnabled(!!b)}}GetDebuggerProperties(){let a=
"";0===this._axes?a="behaviors.dragndrop.properties.axes.items.both":1===this._axes?a="behaviors.dragndrop.properties.axes.items.horizontal-only":2===this._axes&&(a="behaviors.dragndrop.properties.axes.items.vertical-only");return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.dragndrop.debugger.is-dragging",value:this.IsDragging()},{name:"behaviors.dragndrop.properties.axes.name",value:[a]},{name:"behaviors.dragndrop.properties.enabled.name",value:this.IsEnabled(),onedit:b=>
this._SetEnabled(b)}]}]}GetScriptInterfaceClass(){return self.IDragDropBehaviorInstance}};const map$jscomp$38=new WeakMap,VALID_AXES=["both","horizontal","vertical"];self.IDragDropBehaviorInstance=class extends IBehaviorInstance$jscomp$4{constructor(){super();map$jscomp$38.set(this,IBehaviorInstance$jscomp$4._GetInitInst().GetSdkInstance())}set axes(a){a=VALID_AXES.indexOf(a);if(-1===a)throw Error("invalid axes");map$jscomp$38.get(this)._SetAxes(a)}get axes(){return VALID_AXES[map$jscomp$38.get(this)._GetAxes()]}drop(){map$jscomp$38.get(this)._Drop()}get isDragging(){return map$jscomp$38.get(this).IsDragging()}get isEnabled(){return map$jscomp$38.get(this).IsEnabled()}set isEnabled(a){map$jscomp$38.get(this)._SetEnabled(a)}};
self.C3.Behaviors.DragnDrop.Cnds={IsDragging(){return this.IsDragging()},OnDragStart(){return!0},OnDrop(){return!0},IsEnabled(){return this.IsEnabled()}};self.C3.Behaviors.DragnDrop.Acts={SetEnabled(a){this._SetEnabled(!!a)},SetAxes(a){this._SetAxes(a)},Drop(){this._Drop()}};self.C3.Behaviors.DragnDrop.Exps={};const C3$jscomp$289=self.C3;
self.C3_GetObjectRefTable=function(){return[C3$jscomp$289.Plugins.TiledBg,C3$jscomp$289.Plugins.Sprite,C3$jscomp$289.Plugins.TextBox,C3$jscomp$289.Plugins.Text,C3$jscomp$289.Plugins.AJAX,C3$jscomp$289.Behaviors.MoveTo,C3$jscomp$289.Behaviors.Physics,C3$jscomp$289.Plugins.Dictionary,C3$jscomp$289.Behaviors.DragnDrop,C3$jscomp$289.Plugins.Touch,C3$jscomp$289.Plugins.Mouse,C3$jscomp$289.Plugins.Button,C3$jscomp$289.Plugins.Json,C3$jscomp$289.Plugins.Dictionary.Cnds.CompareInstanceVar,C3$jscomp$289.Plugins.System.Cnds.Every,
C3$jscomp$289.Plugins.System.Acts.CreateObject,C3$jscomp$289.Plugins.System.Exps.random,C3$jscomp$289.Behaviors.DragnDrop.Cnds.IsDragging,C3$jscomp$289.Plugins.Sprite.Cnds.CompareX,C3$jscomp$289.Plugins.Sprite.Acts.SetPos,C3$jscomp$289.Plugins.Sprite.Exps.X,C3$jscomp$289.Plugins.Sprite.Exps.Y,C3$jscomp$289.Plugins.Sprite.Cnds.OnCollision,C3$jscomp$289.Plugins.Sprite.Acts.Destroy,C3$jscomp$289.Plugins.Dictionary.Acts.SetInstanceVar,C3$jscomp$289.Plugins.Text.Acts.SetText,C3$jscomp$289.Plugins.Sprite.Cnds.OnCreated,
C3$jscomp$289.Plugins.Sprite.Acts.SetAnim,C3$jscomp$289.Plugins.System.Exps.choose,C3$jscomp$289.Behaviors.MoveTo.Acts.SetSpeed,C3$jscomp$289.Behaviors.MoveTo.Acts.MoveToPosition,C3$jscomp$289.Behaviors.MoveTo.Acts.SetMaxSpeed,C3$jscomp$289.Plugins.Mouse.Cnds.OnObjectClicked,C3$jscomp$289.Plugins.System.Acts.SetLayerVisible,C3$jscomp$289.Plugins.System.Acts.SetLayerInteractive,C3$jscomp$289.Plugins.Touch.Cnds.OnTapGestureObject,C3$jscomp$289.Plugins.Sprite.Cnds.CompareY,C3$jscomp$289.ScriptsInEvents.EventSheet1_Event14_Act2,
C3$jscomp$289.ScriptsInEvents.EventSheet1_Event16_Act2]};
self.C3_JsPropNameTable=[{headerStartPage:0},{TiledBackground:0},{startButton:0},{startObj:0},{StartPage:0},{emailInput:0},{nameInput:0},{countdown:0},{infoCountdown:0},{TiledBackground2:0},{Text2:0},{restartButton:0},{gameoverscore:0},{Text3:0},{TiledBackground3:0},{TiledBackground4:0},{AJAX:0},{background:0},{type:0},{speed:0},{MoveTo:0},{MoveTo2:0},{coin:0},{Physics:0},{money:0},{interval:0},{score:0},{time:0},{combo:0},{play:0},{game_status:0},{username:0},{email:0},{store:0},{Sprite:0},{DragDrop:0},
{drag:0},{Touch:0},{Mouse:0},{Text:0},{ScoreText:0},{TimeText:0},{Button:0},{header:0},{name:0},{time_left:0},{JSON:0}];
self.InstanceType={headerStartPage:class extends self.ITiledBackgroundInstance{},TiledBackground:class extends self.ITiledBackgroundInstance{},startButton:class extends self.ITiledBackgroundInstance{},startObj:class extends self.ISpriteInstance{},StartPage:class extends self.ITiledBackgroundInstance{},emailInput:class extends self.ITextInputInstance{},nameInput:class extends self.ITextInputInstance{},countdown:class extends self.ITextInstance{},infoCountdown:class extends self.ITextInstance{},TiledBackground2:class extends self.ITiledBackgroundInstance{},
Text2:class extends self.ITextInstance{},restartButton:class extends self.ITiledBackgroundInstance{},gameoverscore:class extends self.ITextInstance{},Text3:class extends self.ITextInstance{},TiledBackground3:class extends self.ITiledBackgroundInstance{},TiledBackground4:class extends self.ITiledBackgroundInstance{},AJAX:class extends self.IInstance{},background:class extends self.ITiledBackgroundInstance{},coin:class extends self.ISpriteInstance{},money:class extends self.ISpriteInstance{},store:class extends self.IDictionaryInstance{},
Sprite:class extends self.ISpriteInstance{},drag:class extends self.ISpriteInstance{},Touch:class extends self.IInstance{},Mouse:class extends self.IInstance{},Text:class extends self.ITextInstance{},ScoreText:class extends self.ITextInstance{},TimeText:class extends self.ITextInstance{},Button:class extends self.IButtonInstance{},header:class extends self.ITiledBackgroundInstance{},JSON:class extends self.IJSONInstance{}};
self.C3_ExpressionFuncs=[()=>"play",a=>{const b=a._GetNode(0);return()=>b.ExpInstVar()},()=>0,a=>{const b=a._GetNode(0).GetBoundMethod();return()=>b(60,660)},()=>"drops",()=>50,()=>680,a=>{const b=a._GetNode(0);return()=>b.ExpObject()},a=>{const b=a._GetNode(0),d=a._GetNode(1);return()=>b.ExpInstVar()+d.ExpInstVar()},a=>{const b=a._GetNode(0).GetBoundMethod();return()=>b("money","coin")},a=>{const b=a._GetNode(0).GetBoundMethod(),d=a._GetNode(1),c=a._GetNode(2);return()=>b(d.ExpInstVar(),c.ExpInstVar()+
300)},()=>1920,()=>1E3,()=>3,a=>{const b=a._GetNode(0);return()=>Math.exp(b.ExpInstVar()/90)},a=>{const b=a._GetNode(0);return()=>b.ExpInstVar()+60},()=>"Start Page",()=>"countdown",()=>60,()=>480,()=>1,()=>2.4,a=>{const b=a._GetNode(0);return()=>b.ExpInstVar()-1},()=>4,()=>1280,()=>"stop",()=>"Game Over",()=>"standby",()=>15,a=>{const b=a._GetNode(0);return()=>b.ExpInstVar()+1}];var module$working$444913146$c3runtime={};runOnStartup(async a=>{a.addEventListener("beforeprojectstart",()=>OnBeforeProjectStart$$module$working$444913146$scripts$project$main(a))});async function OnBeforeProjectStart$$module$working$444913146$scripts$project$main(a){a.addEventListener("tick",()=>Tick$$module$working$444913146$scripts$project$main(a))}function Tick$$module$working$444913146$scripts$project$main(a){}var module$working$444913146$scripts$project$main={};const scriptsInEvents$$module$working$444913146$scripts$project$scriptsInEvents={async EventSheet1_Event14_Act2(a,b){(async()=>{const d=a.objects.store.getFirstInstance();console.log(d,"STORE");await fetch("https://script.google.com/macros/s/AKfycbzI_Qd-oELlct_kiOt-mZp9RUub3eL7xdD693SCVfv-MHAVEvaf3mdxzNCN-5n7gGyQ/exec",{method:"POST",body:JSON.stringify({column1:"name",column2:"email@gmail.com",column3:"TEST"})})})()},async EventSheet1_Event16_Act2(a,b){(async()=>{console.log("fetching data");await fetch("https://script.google.com/macros/s/AKfycbzI_Qd-oELlct_kiOt-mZp9RUub3eL7xdD693SCVfv-MHAVEvaf3mdxzNCN-5n7gGyQ/exec",
{method:"POST",body:JSON.stringify({column1:"Value 1",column2:"Value 2",column3:"Value 3"})})})()}};self.C3.ScriptsInEvents=scriptsInEvents$$module$working$444913146$scripts$project$scriptsInEvents;var module$working$444913146$scripts$project$scriptsInEvents={};var module$working$444913146$__c3root__={};
=======
`}static GetPointVertexShaderSource_WebGL1(){return["attribute vec4 aPoints;","varying float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointVertexShaderSource_WebGL2(){return["#version 300 es","in vec4 aPoints;","out float pointOpacity;","uniform float zElevation;","uniform mat4 matP;",
"uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return["uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);",
"\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;",
"uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);",
"}"].join("\n")}static GetPointFragmentShaderSource_WebGL2(){return["#version 300 es","uniform lowp sampler2D samplerFront;","in lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","out lowp vec4 outColor;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));",
"\toutColor = texture(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetColorFillFragmentShaderSource(){return["uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = color;","}"].join("\n")}static GetLinearGradientFillFragmentShaderSource(){return["precision lowp float;","varying mediump vec2 vTex;","uniform vec4 color;","uniform vec4 color2_;","vec3 fromLinear(vec3 linearRGB)",
"{","\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));","\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);","\tvec3 lower = linearRGB * vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","vec3 toLinear(vec3 sRGB)","{","\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));","\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));","\tvec3 lower = sRGB/vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","void main(void) {","\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);",
"\tfloat a = mix(color.a, color2_.a, vTex.x);","\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);","}"].join("\n")}static GetPenumbraFillFragmentShaderSource(){return[`#ifdef GL_FRAGMENT_PRECISION_HIGH`,`#define highmedp highp`,`#else`,`#define highmedp mediump`,`#endif`,`precision lowp float;`,`varying highmedp vec2 vTex;`,`uniform vec4 color;`,`void main(void) {`,`	highmedp float grad = vTex.x / (1.0 - vTex.y);`,`	gl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);`,
`}`].join("\n")}static GetSmoothLineFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float f = step(diffSq.x + diffSq.y, 0.25);",
"\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump float innerF = step(distSq, 0.25);",
"\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}static GetSmoothEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;",
"\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);","\tgl_FragColor = color * f;","}"].join("\n")}static GetSmoothEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;",
"uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 pxNorm = pixelSize * norm;","\tmediump vec2 innerEdge1 = halfNorm - pxNorm;","\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;",
"\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);","\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;","\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;","\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);","\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;","\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);","\tgl_FragColor = color * innerF * outerF;",
"}"].join("\n")}};

}

// ../lib/gfx/webgl/shaderUniform.js
{
'use strict';const C3=self.C3;const glMatrix=self.glMatrix;const mat4=glMatrix.mat4;const TYPE_SIZES=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);
C3.Gfx.WebGLShaderUniform=class WebGLShaderUniform{constructor(owner,name,type){if(!TYPE_SIZES.has(type))throw new Error("invalid uniform type");this._owner=owner;this._gl=this._owner.GetWebGLContext();this._name=name;this._type=type;this._isColorType=this._type==="color";this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),name);this._isUsed=!!this._location;const typeSize=TYPE_SIZES.get(type);this._lastValue=new Float32Array(typeSize);this._lastBatchValue=new Float32Array(typeSize)}Release(){this._owner=
null;this._gl=null;this._location=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(v0){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastBatchValue.set(this._lastValue);this._gl.uniform1f(this._location,v0)}Init1i(v0){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastBatchValue.set(this._lastValue);this._gl.uniform1i(this._location,v0)}Init2f(v0,v1){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastValue[1]=v1;this._lastBatchValue.set(this._lastValue);
this._gl.uniform2f(this._location,v0,v1)}Init3f(v0,v1,v2){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastValue[1]=v1;this._lastValue[2]=v2;this._lastBatchValue.set(this._lastValue);this._gl.uniform3f(this._location,v0,v1,v2)}Init4f(v0,v1,v2,v3){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastValue[1]=v1;this._lastValue[2]=v2;this._lastValue[3]=v3;this._lastBatchValue.set(this._lastValue);this._gl.uniform4f(this._location,v0,v1,v2,v3)}Update1f(v0){v0=Math.fround(v0);const lastValue=
this._lastValue;if(lastValue[0]===v0)return;lastValue[0]=v0;this._gl.uniform1f(this._location,v0)}Update1i(v0){const lastValue=this._lastValue;if(lastValue[0]===v0)return;lastValue[0]=v0;this._gl.uniform1i(this._location,v0)}Update2f(v0,v1){v0=Math.fround(v0);v1=Math.fround(v1);const lastValue=this._lastValue;if(lastValue[0]===v0&&lastValue[1]===v1)return;lastValue[0]=v0;lastValue[1]=v1;this._gl.uniform2f(this._location,v0,v1)}Update3f(v0,v1,v2){v0=Math.fround(v0);v1=Math.fround(v1);v2=Math.fround(v2);
const lastValue=this._lastValue;if(lastValue[0]===v0&&lastValue[1]===v1&&lastValue[2]===v2)return;lastValue[0]=v0;lastValue[1]=v1;lastValue[2]=v2;this._gl.uniform3f(this._location,v0,v1,v2)}Update4f(v0,v1,v2,v3){v0=Math.fround(v0);v1=Math.fround(v1);v2=Math.fround(v2);v3=Math.fround(v3);const lastValue=this._lastValue;if(lastValue[0]===v0&&lastValue[1]===v1&&lastValue[2]===v2&&lastValue[3]===v3)return;lastValue[0]=v0;lastValue[1]=v1;lastValue[2]=v2;lastValue[3]=v3;this._gl.uniform4f(this._location,
v0,v1,v2,v3)}UpdateMatrix4fv(m){const lastValue=this._lastValue;if(mat4.exactEquals(lastValue,m))return;C3.typedArraySet16(lastValue,m,0);this._gl.uniformMatrix4fv(this._location,false,m)}IsSetToCustomInBatch(p){const batchValue=this._lastBatchValue;if(this.IsColorType())return batchValue[0]===Math.fround(p.getR())&&batchValue[1]===Math.fround(p.getG())&&batchValue[2]===Math.fround(p.getB());else return batchValue[0]===Math.fround(p)}SetBatchValueCustom(p){const batchValue=this._lastBatchValue;if(this.IsColorType()){batchValue[0]=
p.getR();batchValue[1]=p.getG();batchValue[2]=p.getB()}else batchValue[0]=p}IsSetTo1InBatch(x){return this._lastBatchValue[0]===Math.fround(x)}IsSetTo2InBatch(x,y){const batchValue=this._lastBatchValue;return batchValue[0]===Math.fround(x)&&batchValue[1]===Math.fround(y)}SetBatch1(x){this._lastBatchValue[0]=x}SetBatch2(x,y){const batchValue=this._lastBatchValue;batchValue[0]=x;batchValue[1]=y}};

}

// ../lib/gfx/webgl/batchJob.js
{
'use strict';const C3=self.C3;const glMatrix=self.glMatrix;const vec4=glMatrix.vec4;const mat4=glMatrix.mat4;const BATCH_NULL=0;const BATCH_QUAD=1;const BATCH_SETTEXTURE=2;const BATCH_SETCOLOR=3;const BATCH_SETBLEND=4;const BATCH_SETVIEWPORT=5;const BATCH_SETPROJECTION=6;const BATCH_SETMODELVIEW=7;const BATCH_SETRENDERTARGET=8;const BATCH_CLEARSURFACE=9;const BATCH_POINTS=10;const BATCH_SETPROGRAM=11;const BATCH_SETPROGRAMPARAMETERS=12;const BATCH_SETPROGRAMCUSTOMPARAMETERS=13;
const BATCH_INVALIDATEFRAMEBUFFER=14;const BATCH_SETPOINTTEXCOORDS=15;const BATCH_SETTILEMAPINFO=16;const BATCH_BLITFRAMEBUFFER=17;const BATCH_STARTQUERY=18;const BATCH_ENDQUERY=19;const BATCH_SETELLIPSEPARAMS=20;const BATCH_SETGRADIENTCOLOR=21;const BATCH_CLEARDEPTH=22;const BATCH_SETDEPTHENABLED=23;const BATCH_SETDEPTHSAMPLINGENABLED=24;const BATCH_COPLANAR_STARTSTENCILPASS=25;const BATCH_COPLANAR_STARTCOLORPASS=26;const BATCH_COPLANAR_RESTORE=27;const BATCH_SET_SCISSOR=28;
const BATCH_SETTILERANDOMIZATIONINFO=29;C3.Gfx.BatchState=class BatchState{constructor(renderer){this.renderer=renderer;this.currentMV=mat4.create();this.currentMatP=mat4.create();this.currentFramebuffer=null;this.currentFramebufferNoDepth=null;this.isDepthSamplingEnabled=false;this.currentColor=vec4.fromValues(1,1,1,1);this.currentShader=null;this.pointTexCoords=new C3.Rect;this.clearColor=C3.New(C3.Color,0,0,0,0)}};
C3.Gfx.WebGLBatchJob=class WebGLBatchJob{constructor(batchState){const arrayBuffer=new ArrayBuffer(96);this._type=0;this._batchState=batchState;this._gl=batchState.renderer.GetContext();this._startIndex=0;this._indexCount=0;this._texParam=null;this._mat4param=new Float32Array(arrayBuffer,0,16);this._colorParam=new Float32Array(arrayBuffer,64,4);this._srcOriginRect=new Float32Array(arrayBuffer,80,4);this._shaderParams=[]}InitQuad(startIndex,indexCount){this._type=BATCH_QUAD;this._startIndex=startIndex;
this._indexCount=indexCount}DoQuad(){const gl=this._gl;gl.drawElements(gl.TRIANGLES,this._indexCount,gl.UNSIGNED_SHORT,this._startIndex)}InitSetTexture(rendererTex){this._type=BATCH_SETTEXTURE;this._texParam=rendererTex}DoSetTexture(){const gl=this._gl;const texParam=this._texParam;gl.bindTexture(gl.TEXTURE_2D,texParam?texParam._GetTexture():null)}InitSetColor(c){this._type=BATCH_SETCOLOR;c.writeToTypedArray(this._colorParam,0)}DoSetColor(){const c=this._colorParam;const batchState=this._batchState;
vec4.copy(batchState.currentColor,c);batchState.currentShader.UpdateColor(c)}InitSetGradientColor(c){this._type=BATCH_SETGRADIENTCOLOR;c.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){const c=this._colorParam;const s=this._batchState.currentShader;if(s._uColor2.IsUsed())s._uColor2.Update4f(c[0],c[1],c[2],c[3])}InitSetBlend(s,d){this._type=BATCH_SETBLEND;this._startIndex=s;this._indexCount=d}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(x,y,w,h){this._type=
BATCH_SETVIEWPORT;const colorParam=this._colorParam;colorParam[0]=x;colorParam[1]=y;colorParam[2]=w;colorParam[3]=h}DoSetViewport(){const colorParam=this._colorParam;this._gl.viewport(colorParam[0],colorParam[1],colorParam[2],colorParam[3])}InitSetProjection(m){this._type=BATCH_SETPROJECTION;mat4.copy(this._mat4param,m)}DoSetProjection(){const batchState=this._batchState;const allShaderPrograms=batchState.renderer._allShaderPrograms;const currentShader=batchState.currentShader;const mat4param=this._mat4param;
for(let i=0,len=allShaderPrograms.length;i<len;++i){const s=allShaderPrograms[i];if(s===currentShader)s.UpdateMatP(mat4param,true);else s.SetMatPStale()}mat4.copy(batchState.currentMatP,mat4param)}InitSetModelView(m){this._type=BATCH_SETMODELVIEW;mat4.copy(this._mat4param,m)}DoSetModelView(){const batchState=this._batchState;const allShaderPrograms=batchState.renderer._allShaderPrograms;const currentShader=batchState.currentShader;const mat4param=this._mat4param;for(let i=0,len=allShaderPrograms.length;i<
len;++i){const s=allShaderPrograms[i];if(s===currentShader)s.UpdateMatMV(mat4param,true);else s.SetMatMVStale()}mat4.copy(batchState.currentMV,mat4param)}InitSetRenderTarget(renderTarget){this._type=BATCH_SETRENDERTARGET;this._texParam=renderTarget}DoSetRenderTarget(){const gl=this._gl;const renderTarget=this._texParam;const batchState=this._batchState;if(renderTarget){batchState.currentFramebuffer=renderTarget._GetFramebuffer();batchState.currentFramebufferNoDepth=renderTarget._GetFramebufferNoDepth();
if(batchState.isDepthSamplingEnabled&&batchState.currentFramebufferNoDepth)gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebufferNoDepth);else gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebuffer)}else{batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;gl.bindFramebuffer(gl.FRAMEBUFFER,null)}}InitClearSurface(c){this._type=BATCH_CLEARSURFACE;c.writeToTypedArray(this._mat4param,0)}InitClearSurface2(r,g,b,a){this._type=BATCH_CLEARSURFACE;const c=this._mat4param;
c[0]=r;c[1]=g;c[2]=b;c[3]=a}DoClearSurface(){const gl=this._gl;const mat4param=this._mat4param;const batchState=this._batchState;const lastClearColor=batchState.clearColor;const r=mat4param[0];const g=mat4param[1];const b=mat4param[2];const a=mat4param[3];if(!lastClearColor.equalsRgba(r,g,b,a)){gl.clearColor(r,g,b,a);lastClearColor.setRgba(r,g,b,a)}gl.clear(gl.COLOR_BUFFER_BIT)}InitSetPointTexCoords(rect){this._type=BATCH_SETPOINTTEXCOORDS;rect.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){const mat4param=
this._mat4param;this._batchState.pointTexCoords.set(mat4param[0],mat4param[1],mat4param[2],mat4param[3])}InitPoints(startIndex,z){this._type=BATCH_POINTS;this._startIndex=startIndex;this._indexCount=1;this._mat4param[0]=z}DoPoints(){const gl=this._gl;const batchState=this._batchState;const renderer=batchState.renderer;const s=renderer._spPoints;gl.useProgram(s._shaderProgram);s.UpdateMatP(batchState.currentMatP,false);s.UpdateMatMV(batchState.currentMV,false);const ptc=batchState.pointTexCoords;if(s._uPointTexStart.IsUsed())s._uPointTexStart.Update2f(ptc.getLeft(),
ptc.getTop());if(s._uPointTexEnd.IsUsed())s._uPointTexEnd.Update2f(ptc.getRight(),ptc.getBottom());const z=this._mat4param[0];if(s._uZElevation.IsUsed())s._uZElevation.Update1f(z);if(s._uColor.IsUsed()){const c=batchState.currentColor;s._uColor.Update4f(c[0],c[1],c[2],c[3])}gl.drawArrays(gl.POINTS,this._startIndex/4,this._indexCount);gl.useProgram(batchState.currentShader._shaderProgram)}InitSetProgram(program){this._type=BATCH_SETPROGRAM;this._texParam=program}DoSetProgram(){const gl=this._gl;const batchState=
this._batchState;const s=this._texParam;batchState.currentShader=s;gl.useProgram(s._shaderProgram);s.UpdateMatP(batchState.currentMatP,false);s.UpdateMatMV(batchState.currentMV,false);if(s._uColor.IsUsed()){const c=batchState.currentColor;s._uColor.Update4f(c[0],c[1],c[2],c[3])}}InitSetProgramParameters(){this._type=BATCH_SETPROGRAMPARAMETERS}DoSetProgramParameters(){const s=this._batchState.currentShader;const gl=this._gl;const mat4param=this._mat4param;const colorParam=this._colorParam;const srcOriginRect=
this._srcOriginRect;if(s._uSamplerBack.IsUsed()){const renderer=this._batchState.renderer;const texParam=this._texParam;if(renderer._lastTexture1!==texParam){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,texParam?texParam._GetTexture():null);renderer._lastTexture1=texParam;gl.activeTexture(gl.TEXTURE0)}}if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[0],mat4param[1]);if(s._uDestStart.IsUsed())s._uDestStart.Update2f(mat4param[2],mat4param[3]);if(s._uDestEnd.IsUsed())s._uDestEnd.Update2f(mat4param[4],
mat4param[5]);if(s._uDevicePixelRatio.IsUsed())s._uDevicePixelRatio.Update1f(this._indexCount);if(s._uLayerScale.IsUsed())s._uLayerScale.Update1f(mat4param[6]);if(s._uLayerAngle.IsUsed())s._uLayerAngle.Update1f(mat4param[7]);if(s._uSrcStart.IsUsed())s._uSrcStart.Update2f(mat4param[12],mat4param[13]);if(s._uSrcEnd.IsUsed())s._uSrcEnd.Update2f(mat4param[14],mat4param[15]);if(s._uSrcOriginStart.IsUsed())s._uSrcOriginStart.Update2f(srcOriginRect[0],srcOriginRect[1]);if(s._uSrcOriginEnd.IsUsed())s._uSrcOriginEnd.Update2f(srcOriginRect[2],
srcOriginRect[3]);if(s._uLayoutStart.IsUsed())s._uLayoutStart.Update2f(colorParam[0],colorParam[1]);if(s._uLayoutEnd.IsUsed())s._uLayoutEnd.Update2f(colorParam[2],colorParam[3]);if(s._uSeconds.IsUsed())s._uSeconds.Update1f(this._startIndex)}InitSetProgramCustomParameters(){this._type=BATCH_SETPROGRAMCUSTOMPARAMETERS}DoSetProgramCustomParameters(){const s=this._batchState.currentShader;const uCustomParameters=s._uCustomParameters;const shaderParams=this._shaderParams;for(let i=0,len=uCustomParameters.length;i<
len;++i){const shaderUniform=uCustomParameters[i];const paramValue=shaderParams[i];if(shaderUniform.IsColorType())shaderUniform.Update3f(paramValue.getR(),paramValue.getG(),paramValue.getB());else shaderUniform.Update1f(paramValue)}}InitInvalidateFramebuffer(fbo){this._type=BATCH_INVALIDATEFRAMEBUFFER;this._texParam=fbo}DoInvalidateFramebuffer(){const gl=this._gl;const fbo=this._texParam;const lastBoundFbo=this._batchState.currentFramebuffer;if(fbo!==lastBoundFbo)gl.bindFramebuffer(gl.FRAMEBUFFER,
fbo);gl.invalidateFramebuffer(gl.FRAMEBUFFER,[gl.COLOR_ATTACHMENT0]);if(fbo!==lastBoundFbo)gl.bindFramebuffer(gl.FRAMEBUFFER,lastBoundFbo)}InitBlitFramebuffer(sourceRenderTarget,destRenderTarget,mode){this._type=BATCH_BLITFRAMEBUFFER;const mat4param=this._mat4param;const renderer=this._batchState.renderer;mat4param[0]=sourceRenderTarget.GetWidth();mat4param[1]=sourceRenderTarget.GetHeight();mat4param[2]=destRenderTarget?destRenderTarget.GetWidth():renderer.GetWidth();mat4param[3]=destRenderTarget?
destRenderTarget.GetHeight():renderer.GetHeight();mat4param[4]=sourceRenderTarget.IsLinearSampling()?1:0;mat4param[5]=mode==="stretch";const shaderParams=this._shaderParams;C3.clearArray(shaderParams);shaderParams.push(sourceRenderTarget._GetFramebuffer());shaderParams.push(destRenderTarget?destRenderTarget._GetFramebuffer():null)}DoBlitFramebuffer(){const mat4param=this._mat4param;const shaderParams=this._shaderParams;const gl=this._gl;const srcWidth=mat4param[0];const srcHeight=mat4param[1];const destWidth=
mat4param[2];const destHeight=mat4param[3];const isLinearSampling=mat4param[4]!==0;const isStretch=mat4param[5]!==0;const srcFbo=shaderParams[0];const destFbo=shaderParams[1];gl.bindFramebuffer(gl.READ_FRAMEBUFFER,srcFbo);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,destFbo);if(isStretch)gl.blitFramebuffer(0,0,srcWidth,srcHeight,0,0,destWidth,destHeight,gl.COLOR_BUFFER_BIT,isLinearSampling?gl.LINEAR:gl.NEAREST);else{const w=Math.min(srcWidth,destWidth);const h=Math.min(srcHeight,destHeight);const srcOffY=
Math.max(srcHeight-destHeight,0);const destOffY=Math.max(destHeight-srcHeight,0);gl.blitFramebuffer(0,srcOffY,w,h+srcOffY,0,destOffY,w,h+destOffY,gl.COLOR_BUFFER_BIT,gl.NEAREST)}}InitStartQuery(query){this._type=BATCH_STARTQUERY;this._texParam=query}DoStartQuery(){this._texParam.BeginTimeElapsed();this._texParam=null}InitEndQuery(query){this._type=BATCH_ENDQUERY;this._texParam=query}DoEndQuery(){this._texParam.EndTimeElapsed();this._texParam=null}InitSetEllipseParams(pixelW,pixelH,outlineThickness){this._type=
BATCH_SETELLIPSEPARAMS;const mat4param=this._mat4param;mat4param[0]=pixelW;mat4param[1]=pixelH;mat4param[2]=outlineThickness}DoSetEllipseParams(){const s=this._batchState.currentShader;const mat4param=this._mat4param;if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[0],mat4param[1]);if(s._uOutlineThickness.IsUsed())s._uOutlineThickness.Update1f(mat4param[2])}InitSetTilemapInfo(srcRect,textureWidth,textureHeight,tileWidth,tileHeight,tileSpacingX,tileSpacingY){this._type=BATCH_SETTILEMAPINFO;
const mat4param=this._mat4param;srcRect.writeToTypedArray(mat4param,0);mat4param[4]=1/textureWidth;mat4param[5]=1/textureHeight;mat4param[6]=tileWidth/textureWidth;mat4param[7]=tileHeight/textureHeight;mat4param[8]=tileSpacingX/textureWidth;mat4param[9]=tileSpacingY/textureHeight}DoSetTilemapInfo(){const s=this._batchState.currentShader;const mat4param=this._mat4param;if(s._uSrcStart.IsUsed())s._uSrcStart.Update2f(mat4param[0],mat4param[1]);if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[4],
mat4param[5]);if(s._uTileSize.IsUsed())s._uTileSize.Update2f(mat4param[6],mat4param[7]);if(s._uTileSpacing.IsUsed())s._uTileSpacing.Update2f(mat4param[8],mat4param[9])}InitSetTileRandomizationInfo(textureWidth,textureHeight,xRandom,yRandom,angleRandom,blendMarginX,blendMarginY){this._type=BATCH_SETTILERANDOMIZATIONINFO;const mat4param=this._mat4param;mat4param[0]=1/textureWidth;mat4param[1]=1/textureHeight;mat4param[2]=xRandom;mat4param[3]=yRandom;mat4param[4]=angleRandom;mat4param[5]=blendMarginX;
mat4param[6]=blendMarginY}DoSetTileRandomizationInfo(){const s=this._batchState.currentShader;const mat4param=this._mat4param;if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[0],mat4param[1]);if(s._uTileSize.IsUsed())s._uTileSize.Update2f(mat4param[2],mat4param[3]);if(s._uOutlineThickness.IsUsed())s._uOutlineThickness.Update1f(mat4param[4]);if(s._uTileSpacing.IsUsed())s._uTileSpacing.Update2f(mat4param[5],mat4param[6])}InitClearDepth(isDepthEnabled){this._type=BATCH_CLEARDEPTH;this._startIndex=
isDepthEnabled?1:0}DoClearDepth(){const gl=this._gl;const isDepthEnabled=this._startIndex!==0;if(!isDepthEnabled)gl.depthMask(true);gl.clear(gl.DEPTH_BUFFER_BIT);if(!isDepthEnabled)gl.depthMask(false)}InitSetDepthEnabled(e){this._type=BATCH_SETDEPTHENABLED;this._startIndex=e?1:0}DoSetDepthEnabled(){const gl=this._gl;if(this._startIndex===0){gl.disable(gl.DEPTH_TEST);gl.depthMask(false)}else{gl.enable(gl.DEPTH_TEST);gl.depthMask(true)}}InitSetDepthSamplingEnabled(e){this._type=BATCH_SETDEPTHSAMPLINGENABLED;
this._startIndex=e?1:0}DoSetDepthSamplingEnabled(){const gl=this._gl;const batchState=this._batchState;const renderer=batchState.renderer;const isDepthSamplingEnabled=this._startIndex!==0;batchState.isDepthSamplingEnabled=isDepthSamplingEnabled;gl.activeTexture(gl.TEXTURE2);if(isDepthSamplingEnabled){if(batchState.currentFramebufferNoDepth)gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebufferNoDepth);gl.bindTexture(gl.TEXTURE_2D,renderer._GetDepthBuffer())}else{gl.bindTexture(gl.TEXTURE_2D,
null);if(batchState.currentFramebufferNoDepth)gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebuffer)}gl.activeTexture(gl.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=BATCH_COPLANAR_STARTSTENCILPASS}DoCoplanarStartStencilPass(){const gl=this._gl;gl.clear(gl.STENCIL_BUFFER_BIT);gl.enable(gl.STENCIL_TEST);gl.stencilFunc(gl.ALWAYS,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE);gl.colorMask(false,false,false,false)}InitCoplanarStartColorPass(){this._type=BATCH_COPLANAR_STARTCOLORPASS}DoCoplanarStartColorPass(){const gl=
this._gl;gl.colorMask(true,true,true,true);gl.stencilFunc(gl.EQUAL,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}InitCoplanarRestore(){this._type=BATCH_COPLANAR_RESTORE}DoCoplanarRestore(){const gl=this._gl;gl.disable(gl.STENCIL_TEST)}InitSetScissor(enable,x,y,w,h){this._type=BATCH_SET_SCISSOR;this._startIndex=enable?1:0;const mat4param=this._mat4param;mat4param[0]=x;mat4param[1]=y;mat4param[2]=w;mat4param[3]=h}DoSetScissor(){const gl=this._gl;const mat4param=this._mat4param;if(this._startIndex===1){gl.enable(gl.SCISSOR_TEST);
gl.scissor(mat4param[0],mat4param[1],mat4param[2],mat4param[3])}else gl.disable(gl.SCISSOR_TEST)}Run(){switch(this._type){case 1:this.DoQuad();return;case 2:this.DoSetTexture();return;case 3:this.DoSetColor();return;case 4:this.DoSetBlend();return;case 5:this.DoSetViewport();return;case 6:this.DoSetProjection();return;case 7:this.DoSetModelView();return;case 8:this.DoSetRenderTarget();return;case 9:this.DoClearSurface();return;case 10:this.DoPoints();return;case 11:this.DoSetProgram();return;case 12:this.DoSetProgramParameters();
return;case 13:this.DoSetProgramCustomParameters();return;case 14:this.DoInvalidateFramebuffer();return;case 15:this.DoSetPointTextureCoords();return;case 16:this.DoSetTilemapInfo();return;case 17:this.DoBlitFramebuffer();return;case 18:this.DoStartQuery();return;case 19:this.DoEndQuery();return;case 20:this.DoSetEllipseParams();return;case 21:this.DoSetGradientColor();return;case 22:this.DoClearDepth();return;case 23:this.DoSetDepthEnabled();return;case 24:this.DoSetDepthSamplingEnabled();return;
case 25:this.DoCoplanarStartStencilPass();return;case 26:this.DoCoplanarStartColorPass();return;case 27:this.DoCoplanarRestore();return;case 28:this.DoSetScissor();return;case 29:this.DoSetTileRandomizationInfo();return}}};

}

// ../lib/gfx/text.js
{
'use strict';const C3=self.C3;const MAX_TEXTURE_SIZE=4096;const EXTRA_LINE_HEIGHT=4;const GENERIC_FONT_FAMILIES=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);const DEFAULT_OPTS={timeout:60};const tempColor=new C3.Color(0,0,0,1);const VALID_HORIZ_ALIGNMENTS=new Set(["left","center","right"]);const VALID_VERT_ALIGNMENTS=new Set(["top","center","bottom"]);
const VALID_WORD_WRAP_MODES=new Set(["word","character"]);const VALID_TEXT_DIRECTIONS=new Set(["ltr","rtl"]);const allRendererTexts=new Set;if(C3.FontManager)C3.FontManager.addEventListener("fontload",e=>{const fontName=e.font.GetName();for(const f of allRendererTexts)if(f.IsBBCodeEnabled()||C3.equalsNoCase(f.GetFontName(),fontName))f._SetWordWrapChanged()});function fillOrStrokeRect(ctx,isStroke,x,y,w,h){if(isStroke)ctx.strokeRect(x,y,w,h);else ctx.fillRect(x,y,w,h)}
function ptToPx(pt){return pt*(4/3)}function getOffsetParam(paramStr,fragHeight){paramStr=paramStr.trim();const param=parseFloat(paramStr);if(!isFinite(param))return 0;if(paramStr.endsWith("%"))return fragHeight*param/100;else return param}let didCheckFoundBoundingBoxSupport=false;let supportsFontBoundingBoxMeasurements=false;
C3.Gfx.RendererText=class RendererText{constructor(renderer,opts){opts=Object.assign({},DEFAULT_OPTS,opts);this._renderer=renderer;this._fontName="Arial";this._fontSize=16;this._fontSizeScale=1;this._lineHeight=0;this._isBold=false;this._isItalic=false;this._colorStr="black";this._isBBcodeEnabled=false;this._iconSet=null;this._iconSmoothing=true;this.onloadfont=null;this._alreadyLoadedFonts=new Set;this._horizontalAlign="left";this._verticalAlign="top";this._text="";this._bbString=null;this._wrappedText=
C3.New(C3.WordWrap);this._wrapMode="word";this._textDirection="ltr";this._wordWrapChanged=false;this._textLayoutChanged=false;this._drawChanged=false;this._drawMaxCharCount=-1;this._drawCharCount=0;this._cssWidth=0;this._cssHeight=0;this._width=0;this._height=0;this._zoom=1;this._textCanvas=null;this._textContext=null;this._measureContext=null;this._measureContextTop=null;this._lastCanvasWidth=-1;this._lastCanvasHeight=-1;this._lastTextCanvasFont="";this._lastMeasureCanvasFont="";this._lastTextCanvasFillStyle=
"";this._lastTextCanvasOpacity=1;this._lastTextCanvasLineWidth=1;this._measureTextCallback=frag=>this._MeasureText(frag);this._texture=null;this._rcTex=new C3.Rect;this._scaleFactor=1;this._textureTimeout=new C3.IdleTimeout(()=>{this.ReleaseTexture();this._SetTextCanvasSize(8,8)},opts.timeout);this.ontextureupdate=null;this._wasReleased=false;allRendererTexts.add(this)}Release(){this.onloadfont=null;this._alreadyLoadedFonts.clear();this._iconSet=null;this._bbString=null;this._textCanvas=null;this._textContext=
null;this._measureContext=null;this._measureContextTop=null;this._measureTextCallback=null;this._textureTimeout.Release();this.ontextureupdate=null;this.ReleaseTexture();this._wrappedText.Clear();this._wrappedText=null;this._renderer=null;this._wasReleased=true;allRendererTexts.delete(this)}_SetDrawChanged(){this._drawChanged=true}_SetTextLayoutChanged(){this._SetDrawChanged();this._textLayoutChanged=true}_SetWordWrapChanged(){this._SetTextLayoutChanged();this._wordWrapChanged=true}SetBBCodeEnabled(e){e=
!!e;if(this._isBBcodeEnabled===e)return;this._isBBcodeEnabled=e;const textBaseline=this._isBBcodeEnabled?"alphabetic":"top";if(this._textContext)this._textContext.textBaseline=textBaseline;if(this._measureContext)this._measureContext.textBaseline=textBaseline;this._SetWordWrapChanged()}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetIconSet(iconSet){if(this._iconSet===iconSet)return;this._iconSet=iconSet;this._wrappedText.SetIconSet(iconSet);if(this._iconSet&&this._iconSet.IsLoading())this._iconSet.LoadContent().then(()=>
this._SetDrawChanged());this._SetWordWrapChanged()}SetIconSmoothing(s){s=!!s;if(this._iconSmoothing===s)return;this._iconSmoothing=s;this._SetDrawChanged()}SetFontName(fontName){if(!fontName)fontName="serif";if(this._fontName===fontName)return;this._fontName=fontName;this._SetWordWrapChanged()}GetFontName(){return this._fontName}SetFontSize(fontSize){if(fontSize<.1)fontSize=.1;if(this._fontSize===fontSize)return;this._fontSize=fontSize;this._SetWordWrapChanged()}GetFontSize(){return this._fontSize}SetFontSizeScale(s){if(this._fontSizeScale===
s)return;this._fontSizeScale=s;this._SetWordWrapChanged()}SetLineHeight(h){if(this._lineHeight===h)return;this._lineHeight=h;this._SetTextLayoutChanged()}GetLineHeight(){return this._lineHeight}SetBold(bold){bold=!!bold;if(this._isBold===bold)return;this._isBold=bold;this._SetWordWrapChanged()}IsBold(){return this._isBold}SetItalic(italic){italic=!!italic;if(this._isItalic===italic)return;this._isItalic=italic;this._SetWordWrapChanged()}IsItalic(){return this._isItalic}SetDrawMaxCharacterCount(n){n=
Math.floor(n);if(this._drawMaxCharCount===n)return;this._drawMaxCharCount=n;this._SetDrawChanged()}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetFontString(useCssUnits,frag){let ret=[];if(this._isBold||frag.HasStyleTag("b"))ret.push("bold");if(this._isItalic||frag.HasStyleTag("i"))ret.push("italic");const sizeStyle=frag.GetStyleTag("size");const fontSize=(sizeStyle?parseFloat(sizeStyle.param):this._fontSize)*this._fontSizeScale;if(useCssUnits)ret.push(fontSize+"pt");else ret.push(fontSize*
this.GetDrawScale()+"pt");let fontName=this._fontName;const fontStyle=frag.GetStyleTag("font");if(fontStyle&&fontStyle.param){fontName=fontStyle.param;if(this.onloadfont&&!this._alreadyLoadedFonts.has(fontName)){this.onloadfont(fontName);this._alreadyLoadedFonts.add(fontName)}}if(fontName)if(GENERIC_FONT_FAMILIES.has(fontName))ret.push(fontName);else ret.push('"'+fontName+'"');return ret.join(" ")}SetColor(c){if(c instanceof C3.Color)c=c.getCssRgb();if(this._colorStr===c)return;this._colorStr=c;this._SetDrawChanged()}SetColorRgb(r,
g,b){tempColor.setRgb(r,g,b);this.SetColor(tempColor)}SetHorizontalAlignment(h){if(!VALID_HORIZ_ALIGNMENTS.has(h))throw new Error("invalid horizontal alignment");if(this._horizontalAlign===h)return;this._horizontalAlign=h;this._SetTextLayoutChanged()}GetHorizontalAlignment(){return this._horizontalAlign}SetVerticalAlignment(v){if(!VALID_VERT_ALIGNMENTS.has(v))throw new Error("invalid vertical alignment");if(this._verticalAlign===v)return;this._verticalAlign=v;this._SetTextLayoutChanged()}GetVerticalAlignment(){return this._verticalAlign}SetWordWrapMode(m){if(!VALID_WORD_WRAP_MODES.has(m))throw new Error("invalid word wrap mode");
if(this._wrapMode===m)return;this._wrapMode=m;this._SetWordWrapChanged()}GetWordWrapMode(){return this._wrapMode}SetTextDirection(d){if(!VALID_TEXT_DIRECTIONS.has(d))throw new Error("invalid text direction");if(this._textDirection===d)return;this._textDirection=d;if(this._textContext)this._textContext.direction=this._textDirection;if(this._measureContext)this._measureContext.direction=this._textDirection;this._SetWordWrapChanged()}GetTextDirection(){return this._textDirection}SetText(text){if(this._text===
text)return;this._text=text;this._SetWordWrapChanged()}GetText(){return this._text}GetDrawScale(){return this._scaleFactor*this._zoom*self.devicePixelRatio}SetSize(cssWidth,cssHeight,zoom){if(typeof zoom==="undefined")zoom=1;if(cssWidth<=0||cssWidth<=0)return;if(this._cssWidth===cssWidth&&this._cssHeight===cssHeight&&this._zoom===zoom)return;const oldCssWidth=this._cssWidth;this._cssWidth=cssWidth;this._cssHeight=cssHeight;this._zoom=zoom;const dpr=self.devicePixelRatio;this._width=this._cssWidth*
this._zoom*dpr;this._height=this._cssHeight*this._zoom*dpr;const maxDim=Math.max(this._width,this._height);const maxTextureSize=Math.min(this._renderer.GetMaxTextureSize(),MAX_TEXTURE_SIZE);let scale=1;if(maxDim>maxTextureSize){scale=maxTextureSize/maxDim;this._width=Math.min(this._width*scale,maxTextureSize);this._height=Math.min(this._height*scale,maxTextureSize)}this._scaleFactor=scale;if(this._cssWidth!==oldCssWidth)this._SetWordWrapChanged();else this._SetTextLayoutChanged()}GetWidth(){return this._width}GetHeight(){return this._height}GetZoom(){return this._zoom}GetTextWidth(){this._UpdateTextMeasurements();
return this._wrappedText.GetMaxLineWidth()}GetTextHeight(){this._UpdateTextMeasurements();return this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+EXTRA_LINE_HEIGHT)-this._lineHeight}GetLengthInGraphemes(){this._UpdateTextMeasurements();let ret=0;for(const line of this._wrappedText.GetLines())for(const frag of line.fragments())ret+=frag.GetLength();return ret}GetTexture(){this._textureTimeout.Reset();this._MaybeUpdate();return this._texture}HitTestFragment(x,
y){this._UpdateTextMeasurements();const scale=this.GetDrawScale();const lines=this._wrappedText.GetLines();for(const line of lines){const yOff=line.GetFontBoundingBoxDescent()*scale;if(y>=line.GetPosY()-line.GetHeight()*scale+yOff&&y<line.GetPosY()+yOff)for(const frag of line.fragments())if(x>=frag.GetPosX()&&x<frag.GetPosX()+frag.GetWidth()*scale)return frag}return null}*fragmentsWithTag(tag){this._UpdateTextMeasurements();const lines=this._wrappedText.GetLines();for(const line of lines)for(const frag of line.fragments()){const tagStyle=
frag.GetStyleTag("tag");if(tagStyle&&C3.equalsNoCase(tagStyle.param,tag))yield frag}}FindFragmentWithTag(tag,index){for(const frag of this.fragmentsWithTag(tag))if(index===0)return frag;else--index;return null}CountFragmentsWithTag(tag){let count=0;for(const frag of this.fragmentsWithTag(tag))++count;return count}_MaybeUpdate(){if(this._texture&&!this._drawChanged&&!this._textLayoutChanged&&!this._wordWrapChanged)return;if(this._wasReleased)return;if(this._width<=0||this._height<=0)return;this._drawChanged=
false;this._DoUpdate()}_DoUpdate(){if(this._wasReleased)return;this._UpdateTextMeasurements();this._SetTextCanvasSize(Math.max(C3.nextHighestPowerOfTwo(Math.ceil(this._width)),128),Math.max(C3.nextHighestPowerOfTwo(Math.ceil(this._height)),64));this._DrawTextToCanvas();this._UpdateTexture();this._textureTimeout.Reset()}_SetTextCanvasSize(w,h){if(!this._textCanvas)this._textCanvas=C3.CreateCanvas(16,16);let wasReset=false;if(this._lastCanvasWidth!==w||this._lastCanvasHeight!==h){this._lastCanvasWidth=
w;this._lastCanvasHeight=h;this._textCanvas.width=w;this._textCanvas.height=h;wasReset=true}if(!this._textContext){this._textContext=this._textCanvas.getContext("2d");wasReset=true}if(wasReset){this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top";this._textContext.direction=this._textDirection;this._textContext.font=this._lastTextCanvasFont;this._textContext.fillStyle=this._lastTextCanvasFillStyle;this._textContext.strokeStyle=this._lastTextCanvasFillStyle;this._textContext.globalAlpha=
this._lastTextCanvasOpacity;this._textContext.lineWidth=this._lastTextCanvasLineWidth}else this._textContext.clearRect(0,0,w,h)}_MaybeCreateMeasureContext(){if(this._measureContext)return;this._measureContext=C3.CreateCanvas(16,16).getContext("2d");this._measureContextTop=C3.CreateCanvas(16,16).getContext("2d");this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top";this._measureContextTop.textBaseline="top";this._measureContext.direction=this._textDirection;this._measureContextTop.direction=
this._textDirection}_SetMeasureFontString(fontString){if(this._lastMeasureCanvasFont===fontString)return;this._lastMeasureCanvasFont=fontString;this._measureContext.font=fontString;this._measureContextTop.font=fontString}_SupportsFontBoundingBoxMeasurements(){if(!didCheckFoundBoundingBoxSupport){didCheckFoundBoundingBoxSupport=true;this._MaybeCreateMeasureContext();const textMetrics=this._measureContext.measureText("test");supportsFontBoundingBoxMeasurements=typeof textMetrics["fontBoundingBoxAscent"]===
"number"&&typeof textMetrics["fontBoundingBoxDescent"]==="number"}return supportsFontBoundingBoxMeasurements}_UpdateTextMeasurements(){this._UpdateWordWrap();this._UpdateTextLayout()}_UpdateWordWrap(){if(!this._wordWrapChanged)return;this._MaybeCreateMeasureContext();if(this._isBBcodeEnabled&&(!this._bbString||this._bbString.toString()!==this._text))this._bbString=new C3.BBString(this._text,{noEscape:true});this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,
this._measureTextCallback,this._cssWidth,this._wrapMode,0);this._wordWrapChanged=false}_UpdateTextLayout(){if(!this._textLayoutChanged)return;this._LayoutText();this._textLayoutChanged=false}_MeasureText(frag){const text=frag.IsText()?frag.GetCharacterArray().join(""):" ";this._SetMeasureFontString(this._GetFontString(true,frag));const sizeStyle=frag.GetStyleTag("size");const fontSize=(sizeStyle?parseFloat(sizeStyle.param):this._fontSize)*this._fontSizeScale;const textMetrics=this._measureContext.measureText(text);
let topToAlphabeticDistance=0;if(this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()){const textMetricsTop=this._measureContextTop.measureText(text);topToAlphabeticDistance=textMetrics["fontBoundingBoxAscent"]-textMetricsTop["fontBoundingBoxAscent"]}return{width:textMetrics.width,height:ptToPx(fontSize),fontBoundingBoxAscent:textMetrics["fontBoundingBoxAscent"]||0,fontBoundingBoxDescent:textMetrics["fontBoundingBoxDescent"]||0,topToAlphabeticDistance}}_SetDrawFontString(fontString){if(this._lastTextCanvasFont===
fontString)return;this._lastTextCanvasFont=fontString;this._textContext.font=fontString}_SetDrawCanvasColor(styleStr){if(this._lastTextCanvasFillStyle===styleStr)return;this._lastTextCanvasFillStyle=styleStr;this._textContext.fillStyle=styleStr;this._textContext.strokeStyle=styleStr}_SetDrawCanvasOpacity(o){if(this._lastTextCanvasOpacity===o)return;this._lastTextCanvasOpacity=o;this._textContext.globalAlpha=o}_SetDrawCanvasLineWith(w){if(this._lastTextCanvasLineWidth===w)return;this._lastTextCanvasLineWidth=
w;this._textContext.lineWidth=w}_LayoutText(){const scale=this.GetDrawScale();const lineSpaceHeight=(EXTRA_LINE_HEIGHT+this._lineHeight)*scale;let penY=0;const lines=this._wrappedText.GetLines();if(lines.length===0)return;for(const line of lines){line.SetPosX(NaN);line.SetPosY(NaN);for(const frag of line.fragments()){frag.SetPosX(NaN);frag.SetPosY(NaN)}}const useFontBoundingBoxMeasurements=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements();let firstLineTextHeight=lines[0].GetHeight()*
scale;if(this._verticalAlign==="center"){const linesTotalHeight=lines.reduce((a,v)=>a+v.GetHeight()*scale+lineSpaceHeight,0)-lineSpaceHeight;penY=Math.max(this._height/2-linesTotalHeight/2,0);if(useFontBoundingBoxMeasurements)firstLineTextHeight=lines[0].GetTopToAlphabeticDistance()*scale}else if(this._verticalAlign==="bottom"){const linesTotalHeight=lines.reduce((a,v)=>a+v.GetHeight()*scale+lineSpaceHeight,0)-this._lineHeight*scale;const lastLineDescentHeight=useFontBoundingBoxMeasurements?lines.at(-1).GetFontBoundingBoxDescent()*
scale:0;penY=this._height-linesTotalHeight-lastLineDescentHeight-2}for(let i=0,len=lines.length;i<len;++i){const line=lines[i];const curLineTextHeight=line.GetHeight()*scale;const startPenY=penY;if(this._isBBcodeEnabled){penY+=i===0?firstLineTextHeight:curLineTextHeight;if(i>0&&penY>this._height-EXTRA_LINE_HEIGHT*scale)break}else if(i>0&&penY>=this._height-curLineTextHeight)break;if(startPenY>=0)this._LayoutTextLine(line,penY,scale);if(!this._isBBcodeEnabled)penY+=curLineTextHeight;penY+=lineSpaceHeight}}_LayoutTextLine(line,
penY,scale){let penX=0;if(this._horizontalAlign==="center")penX=(this._width-line.GetWidth()*scale)/2;else if(this._horizontalAlign==="right")penX=this._width-line.GetWidth()*scale;line.SetPosX(penX);line.SetPosY(penY);for(const frag of this._textDirection==="ltr"?line.fragments():line.fragmentsReverse()){this._LayoutFragment(frag,penX,penY,scale);penX+=frag.GetWidth()*scale}}_LayoutFragment(frag,penX,penY,scale){const offsetXStyle=frag.GetStyleTag("offsetx");penX+=offsetXStyle?getOffsetParam(offsetXStyle.param,
frag.GetHeight())*scale:0;const offsetYStyle=frag.GetStyleTag("offsety");penY+=offsetYStyle?getOffsetParam(offsetYStyle.param,frag.GetHeight())*scale:0;if(frag.IsIcon()){const iconOffsetYStyle=frag.GetStyleTag("iconoffsety");penY+=iconOffsetYStyle?getOffsetParam(iconOffsetYStyle.param,frag.GetHeight())*scale:.2*frag.GetHeight()*scale}frag.SetPosX(penX);frag.SetPosY(penY)}_DrawTextToCanvas(){this._textContext.imageSmoothingEnabled=this._iconSmoothing;this._drawCharCount=0;const scale=this.GetDrawScale();
const lines=this._wrappedText.GetLines();for(const line of lines)this._DrawTextLine(line,scale)}_DrawTextLine(line,scale){const penX=line.GetPosX();const penY=line.GetPosY();if(!Number.isFinite(penX)||!Number.isFinite(penY))return;for(const frag of this._textDirection==="ltr"?line.fragments():line.fragmentsReverse())this._DrawFragment(frag,scale,line.GetHeight())}_DrawFragment(frag,scale,lineHeight){const textContext=this._textContext;const penX=frag.GetPosX();const penY=frag.GetPosY();if(!Number.isFinite(penX)||
!Number.isFinite(penY))return;const lineFontScale=lineHeight/16;let fragWidth=frag.GetWidth()*scale;const fragHeight=frag.GetHeight()*scale;const fragFontScale=frag.GetHeight()/16;const lineSpaceHeight=(EXTRA_LINE_HEIGHT+this._lineHeight)*scale;let chArr=frag.IsText()?frag.GetCharacterArray():null;if(this._drawMaxCharCount!==-1){if(this._drawCharCount>=this._drawMaxCharCount)return;if(frag.IsText())if(this._drawCharCount+chArr.length>this._drawMaxCharCount){chArr=chArr.slice(0,this._drawMaxCharCount-
this._drawCharCount);fragWidth=this._MeasureText(frag).width*scale}this._drawCharCount+=frag.GetLength()}const backgroundStyle=frag.GetStyleTag("background");const hasUnderline=frag.HasStyleTag("u");const hasStrikethrough=frag.HasStyleTag("s");if(frag.IsText()&&C3.IsCharArrayAllWhitespace(chArr)&&!backgroundStyle&&!hasUnderline&&!hasStrikethrough||frag.HasStyleTag("hide"))return;const colorStyle=frag.GetStyleTag("color");const opacityStyle=frag.GetStyleTag("opacity");this._SetDrawCanvasOpacity(opacityStyle?
parseFloat(opacityStyle.param)/100:1);if(backgroundStyle){this._SetDrawCanvasColor(backgroundStyle.param);textContext.fillRect(penX,penY-fragHeight,fragWidth,fragHeight+lineSpaceHeight)}const lineThicknessStyle=frag.GetStyleTag("linethickness");const lineThicknessScale=lineThicknessStyle?parseFloat(lineThicknessStyle.param):1;const isStroke=frag.HasStyleTag("stroke");if(isStroke)this._SetDrawCanvasLineWith(fragFontScale*.5*lineThicknessScale*this.GetDrawScale());if(frag.IsText()){const text=chArr.join("");
this._SetDrawFontString(this._GetFontString(false,frag));if(!isStroke){this._SetDrawCanvasLineWith(fragFontScale*.5*lineThicknessScale*this.GetDrawScale());const outlineBackStyle=frag.GetStyleTag("outlineback");if(outlineBackStyle){this._SetDrawCanvasColor(outlineBackStyle.param);this._FillOrStrokeText(true,text,penX,penY,fragWidth)}}this._SetDrawCanvasColor(colorStyle?colorStyle.param:this._colorStr);this._FillOrStrokeText(isStroke,text,penX,penY,fragWidth);if(!isStroke){this._SetDrawCanvasLineWith(fragFontScale*
.5*lineThicknessScale*this.GetDrawScale());const outlineStyle=frag.GetStyleTag("outline");if(outlineStyle){this._SetDrawCanvasColor(outlineStyle.param);this._FillOrStrokeText(true,text,penX,penY,fragWidth)}}}else if(frag.IsIcon())if(frag.GetWidth()>0){const drawable=frag.GetDrawable(this._iconSet);if(drawable)textContext.drawImage(drawable,penX,penY-fragHeight,fragWidth,fragHeight)}this._SetDrawCanvasColor(colorStyle?colorStyle.param:this._colorStr);if(hasUnderline)fillOrStrokeRect(textContext,isStroke,
penX,penY+scale*lineFontScale,fragWidth,scale*lineFontScale*lineThicknessScale);if(hasStrikethrough){const defaultStrikeY=penY-fragHeight/4;const defaultStrikeHeight=scale*fragFontScale;const strikeYMid=defaultStrikeY+defaultStrikeHeight/2;textContext.fillRect(penX,strikeYMid-defaultStrikeHeight*lineThicknessScale/2,fragWidth,defaultStrikeHeight*lineThicknessScale)}}_FillOrStrokeText(isStroke,text,x,y,width){if(this._textDirection==="rtl")x+=width;if(isStroke)if(C3.Platform.BrowserEngine==="Gecko")this._textContext.strokeText(text,
x,y,width);else this._textContext.strokeText(text,x,y);else if(C3.Platform.BrowserEngine==="Gecko")this._textContext.fillText(text,x,y,width);else this._textContext.fillText(text,x,y)}_UpdateTexture(){if(this._renderer.IsContextLost())return;if(!this._texture)this._texture=this._renderer.CreateDynamicTexture(this._textCanvas.width,this._textCanvas.height,{mipMap:true,mipMapQuality:"high"});this._renderer.UpdateTexture(this._textCanvas,this._texture);this._rcTex.set(0,0,this._width/this._texture.GetWidth(),
this._height/this._texture.GetHeight());if(this.ontextureupdate)this.ontextureupdate()}GetTexRect(){return this._rcTex}ReleaseTexture(){if(this._texture){if(!this._renderer.IsContextLost())this._renderer.DeleteTexture(this._texture);this._texture=null}}static OnContextLost(){for(const rendererText of allRendererTexts)rendererText.ReleaseTexture()}static GetAll(){return allRendererTexts.values()}};

}

// ../lib/gfx/webgl/query.js
{
'use strict';const C3=self.C3;
class WebGLRealTimeElapsedQuery{constructor(renderer){this._gl=renderer.GetContext();this._version=renderer.GetWebGLVersionNumber();this._timerExt=renderer._GetDisjointTimerQueryExtension();this._query=null;this._isActive=false;this._hasResult=false;this._result=0;if(this._version===1)this._query=this._timerExt["createQueryEXT"]();else this._query=this._gl["createQuery"]()}Release(){this._DeleteQueryObject();this._gl=null;this._timerExt=null;this._hasResult=false}_DeleteQueryObject(){if(!this._query)return;if(this._version===
1)this._timerExt["deleteQueryEXT"](this._query);else this._gl["deleteQuery"](this._query);this._query=null}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");if(this._version===1)this._timerExt["beginQueryEXT"](this._timerExt["TIME_ELAPSED_EXT"],this._query);else this._gl["beginQuery"](this._timerExt["TIME_ELAPSED_EXT"],this._query);this._isActive=true}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");if(this._version===1)this._timerExt["endQueryEXT"](this._timerExt["TIME_ELAPSED_EXT"]);
else this._gl["endQuery"](this._timerExt["TIME_ELAPSED_EXT"]);this._isActive=false}CheckForResult(){if(!this._query||this._hasResult||this._isActive)return;let available=false;if(this._version===1)available=this._timerExt["getQueryObjectEXT"](this._query,this._timerExt["QUERY_RESULT_AVAILABLE_EXT"]);else available=this._gl["getQueryParameter"](this._query,this._gl["QUERY_RESULT_AVAILABLE"]);const disjoint=this._gl.getParameter(this._timerExt["GPU_DISJOINT_EXT"]);if(available&&!disjoint){if(this._version===
1)this._result=this._timerExt["getQueryObjectEXT"](this._query,this._timerExt["QUERY_RESULT_EXT"]);else this._result=this._gl["getQueryParameter"](this._query,this._gl["QUERY_RESULT"]);this._result/=1E9;this._hasResult=true}if(available||disjoint)this._DeleteQueryObject()}HasResult(){return this._hasResult}GetResult(){if(!this._hasResult)throw new Error("no result available");return this._result}}
C3.Gfx.WebGLTimeElapsedQuery=class WebGLTimeElapsedQuery{constructor(renderer){this._renderer=renderer;this._frameNumber=renderer.GetFrameNumber();this._isActive=false;this._parentQuery=null;this._isNested=false;this._realQuery=null;this._queries=[]}Release(){for(const q of this._queries)if(q instanceof WebGLRealTimeElapsedQuery)q.Release();C3.clearArray(this._queries);this._parentQuery=null;this._realQuery=null;this._renderer=null}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");
const stack=this._renderer._GetTimeQueryStack();if(stack.length>0){this._isNested=true;this._parentQuery=stack.at(-1);this._parentQuery._EndReal();this._parentQuery._queries.push(this)}else{this._isNested=false;this._parentQuery=null}this._isActive=true;stack.push(this);this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");const top=this._renderer._GetTimeQueryStack().pop();if(top!==this)throw new Error("can only end most nested query");this._isActive=false;this._EndReal();
if(this._parentQuery){this._parentQuery._StartReal();this._parentQuery=null}}_StartReal(){this._realQuery=C3.New(WebGLRealTimeElapsedQuery,this._renderer);this._queries.push(this._realQuery);this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed();this._realQuery=null}CheckForResult(){for(const q of this._queries)q.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every(q=>q.HasResult())}GetResult(){return this._queries.reduce((a,v)=>a+v.GetResult(),
0)}GetFrameNumber(){return this._frameNumber}};

}

// ../lib/gfx/webgl/queryResultBuffer.js
{
'use strict';const C3=self.C3;
C3.Gfx.WebGLQueryResultBuffer=class WebGLQueryResultBuffer{constructor(renderer,maxQueries=1E3){this._renderer=renderer;this._maxQueries=maxQueries;this._buffer=[];this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear();this._renderer._RemoveQueryResultBuffer(this);this._renderer=null}Clear(){for(const q of this._buffer)q.Release();C3.clearArray(this._buffer)}AddTimeElapsedQuery(){const ret=new C3.Gfx.WebGLTimeElapsedQuery(this._renderer);this._buffer.push(ret);if(this._buffer.length>this._maxQueries){const oldest=
this._buffer.shift();oldest.Release()}return ret}CheckForResults(toFrameNumber){for(const q of this._buffer){if(q.GetFrameNumber()>=toFrameNumber)return;if(q.IsNested())return;q.CheckForResult()}}GetFrameRangeResultSum(startFrame,endFrame){if(endFrame<=startFrame)return NaN;let sum=0;for(const q of this._buffer){if(q.GetFrameNumber()>=endFrame)break;if(q.GetFrameNumber()<startFrame)continue;if(q.HasResult())sum+=q.GetResult();else return NaN}return sum}DeleteAllBeforeFrameNumber(frameNumber){for(let i=
0,len=this._buffer.length;i<len;++i){const q=this._buffer[i];if(q.GetFrameNumber()<frameNumber)q.Release();else{if(i>0)this._buffer.splice(0,i);return}}}};

}

// ../lib/gfx/webgl/webglRenderer.js
{
'use strict';const C3=self.C3;const assert=self.assert;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const vec4=glMatrix.vec4;const mat4=glMatrix.mat4;const DEFAULT_WEBGLRENDERER_OPTS={powerPreference:"default",enableGpuProfiling:true,alpha:false,depth:false,canSampleDepth:false,maxWebGLVersion:2,failIfMajorPerformanceCaveat:false};const VALID_POWER_PREFERENCES=new Set(["default","low-power","high-performance"]);const MAX_VERTICES=8E3;const MAX_INDICES=MAX_VERTICES/2*3;const MAX_POINTS=8E3;
const LAST_POINT=MAX_POINTS-4;const PARTIAL_TEXTURE_UPLOAD_CHUNK_SIZE=256*1024;const defaultTexCoordsQuad=new C3.Quad(0,0,1,0,1,1,0,1);const tmpProjection=mat4.create();const tmpModelView=mat4.create();const tmpQuad=new C3.Quad;const tmpRect=new C3.Rect;let loseContextExtension=null;
if(C3.isDebug){self.debug_lose_webgl_context=function(){if(!loseContextExtension){console.warn("WEBGL_lose_context not supported");return}loseContextExtension.loseContext()};self.debug_restore_webgl_context=function(){if(!loseContextExtension){console.warn("WEBGL_lose_context not supported");return}loseContextExtension.restoreContext()}}const pendingPolls=new Set;let pollRafId=-1;
function CheckPendingPolls(){pollRafId=-1;for(const info of pendingPolls)if(info.checkFunc()){info.resolve();pendingPolls.delete(info)}if(pendingPolls.size>0)pollRafId=self.requestAnimationFrame(CheckPendingPolls)}
C3.Gfx.WebGLRenderer=class WebGLRenderer extends C3.Gfx.RendererBase{constructor(canvas,opts){super(opts);opts=Object.assign({},DEFAULT_WEBGLRENDERER_OPTS,opts);if(!VALID_POWER_PREFERENCES.has(opts.powerPreference))throw new Error("invalid power preference");const attribs={"alpha":!!opts.alpha,"depth":false,"antialias":false,"powerPreference":opts.powerPreference,"failIfMajorPerformanceCaveat":!!opts.failIfMajorPerformanceCaveat};let gl=null;let version=0;if(opts.maxWebGLVersion>=2){gl=canvas.getContext("webgl2",
attribs);version=2}if(!gl){gl=canvas.getContext("webgl",attribs);version=1}if(!gl)throw new Error("renderer-unavailable (could not get WebGL context)");this._gl=gl;this._attribs=gl.getContextAttributes();this._versionString=gl.getParameter(gl.VERSION);this._version=version;this._viewport=vec4.create();this._didChangeTransform=false;this._bbProjectionMatrix=mat4.create();this._usesDepthBuffer=!!opts.depth;this._canSampleDepth=!!(opts.depth&&opts.canSampleDepth);this._isDepthEnabled=this._usesDepthBuffer;
this._isDepthSamplingEnabled=false;this._depthBuffer=null;this._isAutoSizeDepthBuffer=true;this._depthBufferWidth=0;this._depthBufferHeight=0;this._vertexBuffer=null;this._texcoordBuffer=null;this._indexBuffer=null;this._pointBuffer=null;this._vertexData=new Float32Array(MAX_VERTICES*this.GetNumVertexComponents());this._indexData=new Uint16Array(MAX_INDICES);this._texcoordData=new Float32Array(MAX_VERTICES*2);this._pointData=new Float32Array(MAX_POINTS*4);this._vertexPtr=0;this._texPtr=0;this._pointPtr=
0;this._lastVertexPtr=0;this._lastProgram=null;this._spDeviceTransformTextureFill=null;this._batch=[];this._batchPtr=0;this._topOfBatch=0;this._currentRenderTarget=null;this._lastPointZ=0;this._batchState=C3.New(C3.Gfx.BatchState,this);this._lastColor=C3.New(C3.Color,1,1,1,1);this._lastTexture0=null;this._lastTexture1=null;this._lastSrcBlend=0;this._lastDestBlend=0;this._lastPointTexCoords=new C3.Rect;this._lastScissorRect=C3.New(C3.Rect,0,0,-1,-1);this._coplanarMode=0;this._maxTextureSize=-1;this._minPointSize=
0;this._maxPointSize=0;this._highpPrecision=0;this._unmaskedVendor="(unavailable)";this._unmaskedRenderer="(unavailable)";this._extensions=[];this._isInitialisingAfterContextRestored=false;this._parallelShaderCompileExt=null;this._anisotropicExt=null;this._depthTextureExt=null;this._fragDepthExt=null;this._stdDerivativesExt=null;this._textureLodExt=null;this._maxAnisotropy=0;this._isGpuProfilingEnabled=!!opts.enableGpuProfiling;this._timerExt=null;this._allQueryResultBuffers=new Set;this._timeQueryStack=
[];this.FillIndexBufferData(this._indexData)}IsWebGL(){return true}async InitState(){super.InitState();const gl=this._gl;const numVertexComponents=this.GetNumVertexComponents();this._lastColor.setRgba(1,1,1,1);this._lastTexture0=null;this._lastTexture1=null;this._vertexPtr=0;this._pointPtr=0;this._lastVertexPtr=MAX_VERTICES*numVertexComponents-4*numVertexComponents;C3.clearArray(this._batch);this._batchPtr=0;this._topOfBatch=0;this._lastProgram=null;this._currentRenderTarget=null;this._lastPointTexCoords.set(0,
0,1,1);this._lastPointZ=0;const batchState=this._batchState;batchState.currentShader=null;batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;vec4.set(batchState.currentColor,1,1,1,1);batchState.clearColor.setRgba(0,0,0,0);batchState.pointTexCoords.set(0,0,1,1);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);this._lastSrcBlend=gl.ONE;this._lastDestBlend=gl.ONE_MINUS_SRC_ALPHA;this._InitBlendModes(gl);gl.disable(gl.CULL_FACE);
gl.disable(gl.STENCIL_TEST);gl.disable(gl.DITHER);if(this._usesDepthBuffer){gl.enable(gl.DEPTH_TEST);gl.depthMask(true);gl.depthFunc(gl.LEQUAL)}else{gl.disable(gl.DEPTH_TEST);gl.depthMask(false)}this._isDepthEnabled=this._usesDepthBuffer;this._isDepthSamplingEnabled=false;this._pointBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._pointBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._pointData.byteLength,gl.DYNAMIC_DRAW);this._vertexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer);
gl.bufferData(gl.ARRAY_BUFFER,this._vertexData.byteLength,gl.DYNAMIC_DRAW);this._texcoordBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._texcoordBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._texcoordData.byteLength,gl.DYNAMIC_DRAW);this._indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this._indexData,gl.STATIC_DRAW);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,null);this._maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);
const pointsizes=gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);this._minPointSize=pointsizes[0];this._maxPointSize=pointsizes[1];const highpVertex=gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT);const highpFrag=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);if(highpVertex&&highpFrag)this._highpPrecision=Math.min(highpVertex["precision"],highpFrag["precision"]);else this._highpPrecision=0;if(this._maxPointSize>2048)this._maxPointSize=2048;this._extensions=gl.getSupportedExtensions();
const debug_ext=gl.getExtension("WEBGL_debug_renderer_info");if(debug_ext){this._unmaskedVendor=gl.getParameter(debug_ext["UNMASKED_VENDOR_WEBGL"]);this._unmaskedRenderer=gl.getParameter(debug_ext["UNMASKED_RENDERER_WEBGL"])}this._parallelShaderCompileExt=gl.getExtension("KHR_parallel_shader_compile");if(C3.isDebug)loseContextExtension=gl.getExtension("WEBGL_lose_context");if(this._isGpuProfilingEnabled)if(this.GetWebGLVersionNumber()===1)this._timerExt=gl.getExtension("EXT_disjoint_timer_query");
else this._timerExt=gl.getExtension("EXT_disjoint_timer_query_webgl2")||gl.getExtension("EXT_disjoint_timer_query");this._anisotropicExt=gl.getExtension("EXT_texture_filter_anisotropic");if(this._anisotropicExt)this._maxAnisotropy=gl.getParameter(this._anisotropicExt["MAX_TEXTURE_MAX_ANISOTROPY_EXT"]);else this._maxAnisotropy=0;if(this.GetWebGLVersionNumber()<2&&this._usesDepthBuffer&&this._canSampleDepth){this._depthTextureExt=gl.getExtension("WEBGL_depth_texture");if(!this._depthTextureExt)throw new Error("no depth texture support");
}if(this.GetWebGLVersionNumber()<2){this._fragDepthExt=gl.getExtension("EXT_frag_depth");this._stdDerivativesExt=gl.getExtension("OES_standard_derivatives");this._textureLodExt=gl.getExtension("EXT_shader_texture_lod")}const WebGLShaderProgram=C3.Gfx.WebGLShaderProgram;const vsSource=WebGLShaderProgram.GetDefaultVertexShaderSource(false);let textureFillFragmentSrc=WebGLShaderProgram.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth();let textureFillVertexSrc=vsSource;let pointFragmentSrc=WebGLShaderProgram.GetPointFragmentShaderSource_WebGL1_NoFragDepth();
let pointVertexSrc=WebGLShaderProgram.GetPointVertexShaderSource_WebGL1();let tilemapFragmentSrc=WebGLShaderProgram.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth();let tilemapVertexSrc=WebGLShaderProgram.GetDefaultVertexShaderSource(true);let useFragDepthExt=false;if(this._usesDepthBuffer)if(this.GetWebGLVersionNumber()<2){if(this._fragDepthExt){textureFillFragmentSrc=WebGLShaderProgram.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT();pointFragmentSrc=WebGLShaderProgram.GetPointFragmentShaderSource_WebGL1_FragDepthEXT();
tilemapFragmentSrc=WebGLShaderProgram.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT();useFragDepthExt=true}}else{textureFillVertexSrc=WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();textureFillFragmentSrc=WebGLShaderProgram.GetTextureFillFragmentShaderSource_WebGL2();pointFragmentSrc=WebGLShaderProgram.GetPointFragmentShaderSource_WebGL2();pointVertexSrc=WebGLShaderProgram.GetPointVertexShaderSource_WebGL2();tilemapFragmentSrc=WebGLShaderProgram.GetTilemapFragmentShaderSource_WebGL2();
tilemapVertexSrc=WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2(true)}const tileRandomizationFragmentSrc=WebGLShaderProgram.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),useFragDepthExt,this._stdDerivativesExt&&this._textureLodExt);const tileRandomizationVertexSrc=this.GetWebGLVersionNumber()>=2?WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2():vsSource;const DEFAULT_SHADER_PROGRAMS=[[textureFillFragmentSrc,textureFillVertexSrc,"<default>"],[textureFillFragmentSrc,
textureFillVertexSrc,"<default-device-transform>"],[pointFragmentSrc,pointVertexSrc,"<point>"],[WebGLShaderProgram.GetColorFillFragmentShaderSource(),vsSource,"<fill>"],[WebGLShaderProgram.GetLinearGradientFillFragmentShaderSource(),vsSource,"<lineargradient>"],[WebGLShaderProgram.GetPenumbraFillFragmentShaderSource(),vsSource,"<penumbra>"],[WebGLShaderProgram.GetHardEllipseFillFragmentShaderSource(),vsSource,"<hardellipse>"],[WebGLShaderProgram.GetHardEllipseOutlineFragmentShaderSource(),vsSource,
"<hardellipseoutline>"],[WebGLShaderProgram.GetSmoothEllipseFillFragmentShaderSource(),vsSource,"<smoothellipse>"],[WebGLShaderProgram.GetSmoothEllipseOutlineFragmentShaderSource(),vsSource,"<smoothellipseoutline>"],[WebGLShaderProgram.GetSmoothLineFillFragmentShaderSource(),vsSource,"<smoothline>"],[tilemapFragmentSrc,tilemapVertexSrc,"<tilemap>"],[tileRandomizationFragmentSrc,tileRandomizationVertexSrc,"<tilerandomization>"]];const defaultShaders=await Promise.all(DEFAULT_SHADER_PROGRAMS.map(i=>
this.CreateShaderProgram({src:i[0],vertexSrc:i[1],name:i[2]})));this._spTextureFill=defaultShaders[0];this._spDeviceTransformTextureFill=defaultShaders[1];this._spPoints=defaultShaders[2];this._spColorFill=defaultShaders[3];this._spLinearGradientFill=defaultShaders[4];this._spPenumbraFill=defaultShaders[5];this._spHardEllipseFill=defaultShaders[6];this._spHardEllipseOutline=defaultShaders[7];this._spSmoothEllipseFill=defaultShaders[8];this._spSmoothEllipseOutline=defaultShaders[9];this._spSmoothLineFill=
defaultShaders[10];this._spTilemapFill=defaultShaders[11];this._spTileRandomization=defaultShaders[12];this.SetTextureFillMode()}async CreateShaderProgram(shaderInfo){const ret=await C3.Gfx.WebGLShaderProgram.Create(this,shaderInfo);this._AddShaderProgram(ret);return ret}ResetLastProgram(){this._lastProgram=null}SetSize(w,h,force){if(this._width===w&&this._height===h&&!force)return;this.EndBatch();const gl=this._gl;const batchState=this._batchState;this._width=w;this._height=h;this._SetViewport(0,
0,w,h);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,w/h);this.SetProjectionMatrix(this._bbProjectionMatrix);if(this._spDeviceTransformTextureFill){gl.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram());this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP);this._lastProgram=this._spDeviceTransformTextureFill;this._batchState.currentShader=this._spDeviceTransformTextureFill}gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,
null);gl.activeTexture(gl.TEXTURE0);this._lastTexture0=null;this._lastTexture1=null;if(this._usesDepthBuffer&&this._isAutoSizeDepthBuffer)this._SetDepthBufferSize(this._width,this._height);if(this._currentRenderTarget)this._currentRenderTarget._Resize(this._width,this._height);gl.bindFramebuffer(gl.FRAMEBUFFER,null);this._currentRenderTarget=null;batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null}_SetDepthBufferSize(width,height){const gl=this._gl;if(this._depthBuffer&&this._depthBufferWidth===
width&&this._depthBufferHeight===height)return;if(this._canSampleDepth){if(this._depthBuffer)gl.deleteTexture(this._depthBuffer);this._depthBuffer=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this._depthBuffer);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(this.GetWebGLVersionNumber()>=
2)gl.texImage2D(gl.TEXTURE_2D,0,gl.DEPTH24_STENCIL8,width,height,0,gl.DEPTH_STENCIL,gl.UNSIGNED_INT_24_8,null);else if(this._depthTextureExt)gl.texImage2D(gl.TEXTURE_2D,0,gl.DEPTH_STENCIL,width,height,0,gl.DEPTH_STENCIL,this._depthTextureExt["UNSIGNED_INT_24_8_WEBGL"],null);else;gl.bindTexture(gl.TEXTURE_2D,null)}else{if(this._depthBuffer)gl.deleteRenderbuffer(this._depthBuffer);this._depthBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this._depthBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,
this._version>=2?gl.DEPTH24_STENCIL8:gl.DEPTH_STENCIL,width,height);gl.bindRenderbuffer(gl.RENDERBUFFER,null)}this._depthBufferWidth=width;this._depthBufferHeight=height}SetFixedSizeDepthBuffer(width,height){if(!this._usesDepthBuffer)return;this._isAutoSizeDepthBuffer=false;this._SetDepthBufferSize(width,height)}SetAutoSizeDepthBuffer(){if(!this._usesDepthBuffer)return;this._isAutoSizeDepthBuffer=true;this._SetDepthBufferSize(this._width,this._height)}_SetViewport(x,y,w,h){const viewport=this._viewport;
if(viewport[0]===x&&viewport[1]===y&&viewport[2]===w&&viewport[3]===h)return;const b=this.PushBatch();b.InitSetViewport(x,y,w,h);vec4.set(viewport,x,y,w,h);this._topOfBatch=0}SetFovY(f){super.SetFovY(f);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetNearZ(z){super.SetNearZ(z);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetFarZ(z){super.SetFarZ(z);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetProjectionMatrix(matP){if(mat4.exactEquals(this._matP,
matP))return;const b=this.PushBatch();b.InitSetProjection(matP);mat4.copy(this._matP,matP);this._topOfBatch=0;this._didChangeTransform=true}SetDefaultRenderTargetProjectionState(){let projectionMatrix;let viewportWidth,viewportHeight;const currentRenderTarget=this._currentRenderTarget;if(currentRenderTarget===null){projectionMatrix=this._bbProjectionMatrix;viewportWidth=this.GetWidth();viewportHeight=this.GetHeight()}else{projectionMatrix=currentRenderTarget.GetProjectionMatrix();viewportWidth=currentRenderTarget.GetWidth();
viewportHeight=currentRenderTarget.GetHeight()}this.SetProjectionMatrix(projectionMatrix);this._SetViewport(0,0,viewportWidth,viewportHeight)}SetModelViewMatrix(matMV){if(mat4.exactEquals(this._matMV,matMV))return;const b=this.PushBatch();b.InitSetModelView(matMV);mat4.copy(this._matMV,matMV);this._topOfBatch=0;this._didChangeTransform=true}ResetDidChangeTransformFlag(){this._didChangeTransform=false}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){const batch=
this._batch;if(this._batchPtr===batch.length)batch.push(new C3.Gfx.WebGLBatchJob(this._batchState));return batch[this._batchPtr++]}EndBatch(){if(this._batchPtr===0)return;if(this.IsContextLost())return;this._WriteBuffers();this._ExecuteBatch();this._batchPtr=0;this._vertexPtr=0;this._texPtr=0;this._pointPtr=0;this._topOfBatch=0}_WriteBuffers(){const gl=this._gl;if(this._pointPtr>0){gl.bindBuffer(gl.ARRAY_BUFFER,this._pointBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr))}if(this._vertexPtr>
0){gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr));gl.bindBuffer(gl.ARRAY_BUFFER,this._texcoordBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr))}}_ExecuteBatch(){const batch=this._batch;for(let i=0,len=this._batchPtr;i<len;++i)batch[i].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(r,g,b,a){const lastColor=this._lastColor;if(lastColor.equalsRgba(r,g,b,a))return;lastColor.setRgba(r,
g,b,a);const batch=this.PushBatch();batch.InitSetColor(lastColor);this._topOfBatch=0;this._currentStateGroup=null}SetOpacity(a){const lastColor=this._lastColor;if(lastColor.getA()===a)return;lastColor.setA(a);const batch=this.PushBatch();batch.InitSetColor(lastColor);this._topOfBatch=0;this._currentStateGroup=null}SetColor(c){const lastColor=this._lastColor;if(lastColor.equals(c))return;lastColor.set(c);const batch=this.PushBatch();batch.InitSetColor(lastColor);this._topOfBatch=0;this._currentStateGroup=
null}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(rendererTex){if(rendererTex===this._lastTexture0)return;const b=this.PushBatch();b.InitSetTexture(rendererTex);this._lastTexture0=rendererTex;this._topOfBatch=0}_ResetLastTexture(){this._lastTexture0=null}SetBlendMode(bm){const arr=this._GetBlendByIndex(bm);this._SetBlend(arr[0],arr[1])}SetNamedBlendMode(bm){const o=this.GetNamedBlend(bm);this._SetBlend(o.srcBlend,o.destBlend)}_SetBlend(s,d){if(s===this._lastSrcBlend&&
d===this._lastDestBlend)return;const b=this.PushBatch();b.InitSetBlend(s,d);this._lastSrcBlend=s;this._lastDestBlend=d;this._topOfBatch=0;this._currentStateGroup=null}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(r){this.Rect2(r.getLeft(),
r.getTop(),r.getRight(),r.getBottom())}Rect2(left,top,right,bottom){this.Quad2(left,top,right,top,right,bottom,left,bottom)}_ExtendQuadBatch(){let v=this._vertexPtr;if(v>=this._lastVertexPtr){this.EndBatch();v=0}if(this._topOfBatch===1)this._batch[this._batchPtr-1]._indexCount+=6;else{const b=this.PushBatch();b.InitQuad(v,6);this._topOfBatch=1}}_WriteQuadToVertexBuffer(quad){quad.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ);this._vertexPtr+=12}Quad(quad){this._ExtendQuadBatch();
this._WriteQuadToVertexBuffer(quad);defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad2(tlx,tly,trx,try_,brx,bry,blx,bly){this._ExtendQuadBatch();const vd=this._vertexData;let v=this._vertexPtr;const z=this._baseZ+this._currentZ;vd[v++]=tlx;vd[v++]=tly;vd[v++]=z;vd[v++]=trx;vd[v++]=try_;vd[v++]=z;vd[v++]=brx;vd[v++]=bry;vd[v++]=z;vd[v++]=blx;vd[v++]=bly;vd[v++]=z;this._vertexPtr=v;defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=
8}Quad3(quad,rcTex){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(quad);rcTex.writeAsQuadToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad4(quad,uv){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(quad);uv.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad3D(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,rcTex){this._ExtendQuadBatch();const vd=this._vertexData;let v=this._vertexPtr;const z=this._baseZ+this._currentZ;vd[v++]=tlx;vd[v++]=tly;vd[v++]=
z+tlz;vd[v++]=trx;vd[v++]=try_;vd[v++]=z+trz;vd[v++]=brx;vd[v++]=bry;vd[v++]=z+brz;vd[v++]=blx;vd[v++]=bly;vd[v++]=z+blz;this._vertexPtr=v;rcTex.writeAsQuadToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}Quad3D2(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,uv){this._ExtendQuadBatch();const vd=this._vertexData;let v=this._vertexPtr;const z=this._baseZ+this._currentZ;vd[v++]=tlx;vd[v++]=tly;vd[v++]=z+tlz;vd[v++]=trx;vd[v++]=try_;vd[v++]=z+trz;vd[v++]=brx;vd[v++]=bry;vd[v++]=z+brz;
vd[v++]=blx;vd[v++]=bly;vd[v++]=z+blz;this._vertexPtr=v;uv.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8}DrawMesh(posArr,uvArr,indexArr){const vd=this._vertexData;const td=this._texcoordData;if(indexArr.length%3!==0)throw new Error("invalid index buffer length");for(let i=0,len=indexArr.length;i<len;){const index0=indexArr[i++];const index1=indexArr[i++];const index2=indexArr[i++];const pos0=index0*3;const pos1=index1*3;const pos2=index2*3;const uv0=index0*2;const uv1=index1*
2;const uv2=index2*2;this._ExtendQuadBatch();let v=this._vertexPtr;let t=this._texPtr;vd[v++]=posArr[pos0+0];vd[v++]=posArr[pos0+1];vd[v++]=posArr[pos0+2];vd[v++]=posArr[pos1+0];vd[v++]=posArr[pos1+1];vd[v++]=posArr[pos1+2];vd[v++]=posArr[pos2+0];vd[v++]=posArr[pos2+1];vd[v++]=posArr[pos2+2];vd[v++]=posArr[pos2+0];vd[v++]=posArr[pos2+1];vd[v++]=posArr[pos2+2];td[t++]=uvArr[uv0+0];td[t++]=uvArr[uv0+1];td[t++]=uvArr[uv1+0];td[t++]=uvArr[uv1+1];td[t++]=uvArr[uv2+0];td[t++]=uvArr[uv2+1];td[t++]=uvArr[uv2+
0];td[t++]=uvArr[uv2+1];this._vertexPtr=v;this._texPtr=t}}FullscreenQuad(mode,curTex){this.SetCurrentZ(0);mat4.copy(tmpProjection,this._matP);mat4.copy(tmpModelView,this._matMV);this.SetDefaultRenderTargetProjectionState();const [width,height]=this.GetRenderTargetSize(this._currentRenderTarget);const tempMat4b=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(height),0,0,0,height);this.SetModelViewMatrix(tempMat4b);if(mode==="crop"&&this._currentRenderTarget&&curTex){const left=this._width/
2;const top=this._height/2;const srcW=curTex.GetWidth();const srcH=curTex.GetHeight();const destW=this._currentRenderTarget.GetWidth();const destH=this._currentRenderTarget.GetHeight();const copyW=Math.min(destW,srcW);const copyH=Math.min(destH,srcH);const srcOffY=Math.max(srcH-destH,0);const destOffY=Math.max(destH-srcH,0);tmpRect.set(-left,top-destOffY,-left+copyW,top-copyH-destOffY);tmpQuad.setFromRect(tmpRect);tmpRect.set(0,srcOffY,copyW,copyH+srcOffY);tmpRect.divide(srcW,srcH);this.Quad3(tmpQuad,
tmpRect)}else{const halfW=width/2;const halfH=height/2;this.Rect2(-halfW,halfH,halfW,-halfH)}this.SetProjectionMatrix(tmpProjection);this.SetModelViewMatrix(tmpModelView)}StartRenderingPoints(rect){if(this._lastPointTexCoords.equals(rect))return;this._lastPointTexCoords.copy(rect);const b=this.PushBatch();b.InitSetPointTexCoords(rect);this._topOfBatch=0}FinishRenderingPoints(){}Point(x_,y_,size_,opacity_){if(this._pointPtr>=LAST_POINT)this.EndBatch();let p=this._pointPtr;const z=this._baseZ+this._currentZ;
if(this._topOfBatch===2&&this._lastPointZ===z)this._batch[this._batchPtr-1]._indexCount++;else{const b=this.PushBatch();b.InitPoints(p,z);this._topOfBatch=2;this._lastPointZ=z}const pd=this._pointData;pd[p++]=x_;pd[p++]=y_;pd[p++]=size_;pd[p++]=opacity_;this._pointPtr=p}SetProgram(program){if(this._lastProgram===program)return;const b=this.PushBatch();b.InitSetProgram(program);this._lastProgram=program;this._topOfBatch=0;this._currentStateGroup=null}GetProgram(){return this._lastProgram}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(c){const b=
this.PushBatch();b.InitSetGradientColor(c);this._topOfBatch=0}SetEllipseParams(pixelW,pixelH,outlineThickness=1){const b=this.PushBatch();b.InitSetEllipseParams(pixelW,pixelH,outlineThickness);this._topOfBatch=0}SetTilemapInfo(srcRect,textureWidth,textureHeight,tileWidth,tileHeight,tileSpacingX,tileSpacingY){if(this._lastProgram!==this._spTilemapFill)throw new Error("must set tilemap fill mode first");const b=this.PushBatch();b.InitSetTilemapInfo(srcRect,textureWidth,textureHeight,tileWidth,tileHeight,
tileSpacingX,tileSpacingY);this._topOfBatch=0}SetTileRandomizationInfo(textureWidth,textureHeight,xRandom,yRandom,angleRandom,blendMarginX,blendMarginY){if(this._lastProgram!==this._spTileRandomization)throw new Error("must set tile randomization mode first");const b=this.PushBatch();b.InitSetTileRandomizationInfo(textureWidth,textureHeight,xRandom,yRandom,angleRandom,blendMarginX,blendMarginY);this._topOfBatch=0}SetProgramParameters(backTex,destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,
dpr,layerScale,layerAngle,time){const s=this._lastProgram;time=time%10800;if(!s._hasAnyOptionalUniforms||s.AreOptionalUniformsAlreadySetInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time))return;const b=this.PushBatch();b.InitSetProgramParameters();s.SetOptionalUniformsInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time);const mat4param=b._mat4param;mat4param[0]=pixelWidth;mat4param[1]=pixelHeight;
destRect.writeToTypedArray(mat4param,2);mat4param[6]=layerScale;mat4param[7]=layerAngle;srcRect.writeToTypedArray(mat4param,12);const colorParam=b._colorParam;layoutRect.writeToTypedArray(colorParam,0);const tmp=colorParam[1];colorParam[1]=colorParam[3];colorParam[3]=tmp;srcOriginRect.writeToTypedArray(b._srcOriginRect,0);b._startIndex=time;b._indexCount=dpr;if(s._uSamplerBack.IsUsed())b._texParam=backTex?backTex.GetTexture():null;else b._texParam=null;this._topOfBatch=0}SetProgramCustomParameters(params){const s=
this._lastProgram;if(params.length===0||s.AreCustomParametersAlreadySetInBatch(params))return;const b=this.PushBatch();b.InitSetProgramCustomParameters();s.SetCustomParametersInBatch(params);C3.shallowAssignArray(b._shaderParams,params);this._topOfBatch=0}ClearRgba(r,g,b_,a){const b=this.PushBatch();b.InitClearSurface2(r,g,b_,a);this._topOfBatch=0}Clear(c){const b=this.PushBatch();b.InitClearSurface(c);this._topOfBatch=0}Start(){}Finish(){super.Finish();this._gl.flush()}ClearDepth(){if(!this._usesDepthBuffer||
!this._currentRenderTarget||!this._currentRenderTarget.HasDepthBuffer())return;const batch=this.PushBatch();batch.InitClearDepth(this._isDepthEnabled);this._topOfBatch=0}SetDepthEnabled(e){e=!!e;if(this._isDepthEnabled===e)return;if(!this._usesDepthBuffer)return;this._isDepthEnabled=e;const batch=this.PushBatch();batch.InitSetDepthEnabled(e);this._topOfBatch=0}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(e){e=
!!e;if(!this._canSampleDepth)return;if(this._isDepthSamplingEnabled===e)return;if(e&&this.IsDepthEnabled())throw new Error("depth still enabled");this._isDepthSamplingEnabled=e;const batch=this.PushBatch();batch.InitSetDepthSamplingEnabled(e);this._topOfBatch=0}SetScissorRect(x,y,w,h,rtHeight_=0){x=Math.floor(x);y=Math.floor(y);w=Math.floor(w);h=Math.floor(h);if(this._lastScissorRect.equalsWH(x,y,w,h))return;this._lastScissorRect.setWH(x,y,w,h);const rtHeight=rtHeight_||this.GetRenderTargetSize(this.GetRenderTarget())[1];
y=rtHeight-y-h;const batch=this.PushBatch();batch.InitSetScissor(true,x,y,w,h);this._topOfBatch=0}RemoveScissorRect(){if(this._lastScissorRect.getRight()===-1)return;this._lastScissorRect.set(0,0,-1,-1);const batch=this.PushBatch();batch.InitSetScissor(false,0,0,0,0);this._topOfBatch=0}CheckForQueryResults(){for(const qrb of this._allQueryResultBuffers)qrb.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost();
C3.Gfx.WebGLRendererTexture.OnContextLost();C3.Gfx.WebGLRenderTarget.OnContextLost();C3.Gfx.RendererText.OnContextLost();for(const qrb of this._allQueryResultBuffers)qrb.Clear();this._extensions=[];this._timerExt=null;this._parallelShaderCompileExt=null;this._anisotropicExt=null;this._depthTextureExt=null;this._fragDepthExt=null;this._stdDerivativesExt=null;this._textureLodExt=null;this._maxAnisotropy=0;this._unmaskedVendor="(unavailable)";this._unmaskedRenderer="(unavailable)";this._lastProgram=
null;this._spDeviceTransformTextureFill=null;this._depthBuffer=null;for(const stateGroup of this._stateGroups.values())stateGroup.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=true;await this.InitState();this._isInitialisingAfterContextRestored=false;for(const stateGroup of this._stateGroups.values())stateGroup.OnContextRestored(this);this.SetSize(this._width,this._height,true)}CreateStaticTexture(data,opts){if(this.IsContextLost())throw new Error("context lost");
this.EndBatch();const rendererTex=C3.New(C3.Gfx.WebGLRendererTexture,this);rendererTex._CreateStatic(data,opts);return rendererTex}async CreateStaticTextureAsync(data,opts){if(this.IsContextLost())throw new Error("context lost");opts=Object.assign({},opts);if(C3.Supports.ImageBitmapOptions){let imageBitmap=await createImageBitmap(data,{"premultiplyAlpha":"premultiply"});const isTiled=opts.wrapX&&opts.wrapX!=="clamp-to-edge"||opts.wrapY&&opts.wrapY!=="clamp-to-edge";const isPOT=C3.isPOT(imageBitmap.width)&&
C3.isPOT(imageBitmap.height);if(!this.SupportsNPOTTextures()&&!isPOT&&isTiled)if(C3.Supports.ImageBitmapOptionsResize){imageBitmap=await createImageBitmap(data,{"premultiplyAlpha":"premultiply","resizeWidth":C3.nextHighestPowerOfTwo(imageBitmap.width),"resizeHeight":C3.nextHighestPowerOfTwo(imageBitmap.height)});opts.premultiplyAlpha=false}else imageBitmap=await createImageBitmap(data,{"premultiplyAlpha":"none"});else opts.premultiplyAlpha=false;return await C3.Asyncify(()=>this.CreateStaticTexture(imageBitmap,
opts))}else{if(data instanceof Blob){if(typeof Image==="undefined")throw new Error("texture upload variant not supported in worker");const img=await C3.BlobToImage(data);data=img}return await C3.Asyncify(()=>this.CreateStaticTexture(data,opts))}}CreateDynamicTexture(width,height,opts){this.EndBatch();const rendererTex=C3.New(C3.Gfx.WebGLRendererTexture,this);rendererTex._CreateDynamic(width,height,opts);return rendererTex}UpdateTexture(data,rendererTex,opts){this.EndBatch();rendererTex._Update(data,
opts)}DeleteTexture(rendererTex){if(!rendererTex)return;rendererTex.SubtractReference();if(rendererTex.GetReferenceCount()>0)return;this.EndBatch();if(rendererTex===this._lastTexture0){this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._lastTexture0=null}if(rendererTex===this._lastTexture1){this._gl.activeTexture(this._gl.TEXTURE1);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._gl.activeTexture(this._gl.TEXTURE0);this._lastTexture1=null}rendererTex._Delete()}CreateRenderTarget(opts){let width=
this._width;let height=this._height;let isDefaultSize=true;if(opts){if(typeof opts.width==="number"){width=Math.floor(opts.width);isDefaultSize=false}if(typeof opts.height==="number"){height=Math.floor(opts.height);isDefaultSize=false}}if(width<=0||height<=0)throw new Error("invalid size");this.EndBatch();const renderTarget=C3.New(C3.Gfx.WebGLRenderTarget,this);renderTarget._Create(width,height,Object.assign({isDefaultSize},opts));this._currentRenderTarget=null;this._batchState.currentFramebuffer=
null;this._batchState.currentFramebufferNoDepth=null;return renderTarget}SetRenderTarget(renderTarget,updateProjection=true){if(renderTarget===this._currentRenderTarget)return;if(renderTarget&&renderTarget.IsDefaultSize())renderTarget._Resize(this._width,this._height);const b=this.PushBatch();b.InitSetRenderTarget(renderTarget);this._currentRenderTarget=renderTarget;this._topOfBatch=0;if(updateProjection)this.SetDefaultRenderTargetProjectionState()}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(renderTarget){if(renderTarget)return[renderTarget.GetWidth(),
renderTarget.GetHeight()];else return[this._width,this._height]}CopyRenderTarget(renderTarget,mode="stretch"){if(this._version<2||this._currentRenderTarget&&this._currentRenderTarget.GetMultisampling()>0){this.SetCopyBlend();this.ResetColor();this.DrawRenderTarget(renderTarget,mode)}else{const b=this.PushBatch();b.InitBlitFramebuffer(renderTarget,this._currentRenderTarget,mode);this._topOfBatch=0}}DrawRenderTarget(renderTarget,mode="stretch"){const tex=renderTarget.GetTexture();if(!tex)throw new Error("not a texture-backed render target");
this.SetTexture(tex);this.FullscreenQuad(mode,tex)}InvalidateRenderTarget(renderTarget){if(this._version<2)return;const b=this.PushBatch();b.InitInvalidateFramebuffer(renderTarget._GetFramebuffer());this._topOfBatch=0}DeleteRenderTarget(renderTarget){this.SetRenderTarget(null);this.EndBatch();const renderTex=renderTarget.GetTexture();if(renderTex===this._lastTexture0){this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._lastTexture0=null}if(renderTex===this._lastTexture1){this._gl.activeTexture(this._gl.TEXTURE1);
this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._gl.activeTexture(this._gl.TEXTURE0);this._lastTexture1=null}renderTarget._Delete()}async ReadBackRenderTargetToImageData(renderTarget,forceSynchronous,areaRect){this.EndBatch();const oldRenderTarget=this._currentRenderTarget;let width,height,framebuffer;if(renderTarget){width=renderTarget.GetWidth();height=renderTarget.GetHeight();framebuffer=renderTarget._GetFramebuffer()}else{width=this.GetWidth();height=this.GetHeight();framebuffer=null}let x=
0;let y=0;let areaWidth=width;let areaHeight=height;if(areaRect){x=C3.clamp(Math.floor(areaRect.getLeft()),0,width-1);y=C3.clamp(Math.floor(areaRect.getTop()),0,height-1);let w=areaRect.width();if(w===0)w=width-x;else w=C3.clamp(Math.floor(w),0,width-x);let h=areaRect.height();if(h===0)h=height-y;else h=C3.clamp(Math.floor(h),0,height-y);areaWidth=w;areaHeight=h;y=height-(y+areaHeight)}const gl=this._gl;gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);const restorePreviousRenderTarget=()=>{gl.bindFramebuffer(gl.FRAMEBUFFER,
null);this._currentRenderTarget=null;this._batchState.currentFramebuffer=null;this._batchState.currentFramebufferNoDepth=null;this.SetRenderTarget(oldRenderTarget)};let imageData;if(!forceSynchronous&&this.GetWebGLVersionNumber()>=2){gl.bindFramebuffer(gl.READ_FRAMEBUFFER,framebuffer);const pixelBuffer=gl.createBuffer();const bufferSize=areaWidth*areaHeight*4;const PIXEL_PACK_BUFFER=gl["PIXEL_PACK_BUFFER"];gl.bindBuffer(PIXEL_PACK_BUFFER,pixelBuffer);gl.bufferData(PIXEL_PACK_BUFFER,bufferSize,gl["STREAM_READ"]);
gl.readPixels(x,y,areaWidth,areaHeight,gl.RGBA,gl.UNSIGNED_BYTE,0);gl.bindFramebuffer(gl.READ_FRAMEBUFFER,null);gl.bindBuffer(PIXEL_PACK_BUFFER,null);restorePreviousRenderTarget();const sync=gl["fenceSync"](gl["SYNC_GPU_COMMANDS_COMPLETE"],0);await this._WaitForObjectReady(()=>gl["getSyncParameter"](sync,gl["SYNC_STATUS"])===gl["SIGNALED"]);gl["deleteSync"](sync);imageData=new ImageData(areaWidth,areaHeight);gl.bindBuffer(PIXEL_PACK_BUFFER,pixelBuffer);gl["getBufferSubData"](PIXEL_PACK_BUFFER,0,new Uint8Array(imageData.data.buffer),
0,bufferSize);gl.bindBuffer(PIXEL_PACK_BUFFER,null);gl.deleteBuffer(pixelBuffer)}else{imageData=new ImageData(areaWidth,areaHeight);gl.readPixels(x,y,areaWidth,areaHeight,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(imageData.data.buffer));restorePreviousRenderTarget()}return imageData}CoplanarStartStencilPass(){this.SetDepthEnabled(true);const batch=this.PushBatch();batch.InitCoplanarStartStencilPass();this._topOfBatch=0;this._coplanarMode=1}CoplanarStartColorPass(){this.SetDepthEnabled(false);const batch=
this.PushBatch();batch.InitCoplanarStartColorPass();this._topOfBatch=0;this._coplanarMode=2}IsCoplanarColorPass(){return this._coplanarMode===2}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(true);const batch=this.PushBatch();batch.InitCoplanarRestore();this._topOfBatch=0;this._coplanarMode=0}StartQuery(query){if(!this.SupportsGPUProfiling())return;const b=this.PushBatch();b.InitStartQuery(query);this._topOfBatch=0}EndQuery(query){if(!this.SupportsGPUProfiling())return;const b=this.PushBatch();
b.InitEndQuery(query);this._topOfBatch=0}_WaitForObjectReady(checkFunc){const ret=new Promise(resolve=>pendingPolls.add({resolve,checkFunc}));if(pollRafId===-1)pollRafId=self.requestAnimationFrame(CheckPendingPolls);return ret}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs["alpha"]?4:3)}GetEstimatedRenderBufferMemoryUsage(){let ret=0;for(const t of C3.Gfx.WebGLRenderTarget.allRenderTargets()){if(t.GetTexture())continue;ret+=t.GetEstimatedMemoryUsage()}return ret}GetEstimatedTextureMemoryUsage(){let ret=
0;for(const t of C3.Gfx.WebGLRendererTexture.allTextures())ret+=t.GetEstimatedMemoryUsage();return ret}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return this.GetWebGLVersionNumber()>=2}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){return this._highpPrecision!==
0}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetWebGLExtensionsAnalyticsString(){if(this.GetWebGLVersionNumber()>=2)return"webgl2";else{const exts=[];if(this._fragDepthExt)exts.push("EXT_frag_depth");if(this._stdDerivativesExt)exts.push("OES_standard_derivatives");if(this._textureLodExt)exts.push("EXT_shader_texture_lod");if(exts.length>0)return"webgl1:"+exts.join(",");else return"webgl1:none"}}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(qrb){this._allQueryResultBuffers.add(qrb)}_RemoveQueryResultBuffer(qrb){this._allQueryResultBuffers.delete(qrb)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(gl){this._InitBlendModeData([["normal",
gl.ONE,gl.ONE_MINUS_SRC_ALPHA],["additive",gl.ONE,gl.ONE],["xor",gl.ONE,gl.ONE_MINUS_SRC_ALPHA],["copy",gl.ONE,gl.ZERO],["destination-over",gl.ONE_MINUS_DST_ALPHA,gl.ONE],["source-in",gl.DST_ALPHA,gl.ZERO],["destination-in",gl.ZERO,gl.SRC_ALPHA],["source-out",gl.ONE_MINUS_DST_ALPHA,gl.ZERO],["destination-out",gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],["source-atop",gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],["destination-atop",gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA]])}CreateWebGLText(){return this.CreateRendererText()}};

}

// ../lib/gfx/effectCompositor/effectChainManager.js
{
'use strict';const C3=self.C3;const DEFAULT_CTOR_OPTS={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};
C3.Gfx.EffectChainManager=class EffectChainManager{constructor(opts){opts=Object.assign({},DEFAULT_CTOR_OPTS,opts);this._cbGetDrawSize=opts.getDrawSize;this._cbGetRenderTarget=opts.getRenderTarget;this._cbReleaseRenderTarget=opts.releaseRenderTarget;this._cbGetTime=opts.getTime;this._cbRedraw=opts.redraw;this._webgpuBackTexture=null;this._allEffectChains=new Set}_AddEffectChain(ec){this._allEffectChains.add(ec)}_RemoveEffectChain(ec){this._allEffectChains.delete(ec)}OnContextLost(){this._webgpuBackTexture=
null;for(const ec of this._allEffectChains)ec.OnContextLost()}GetDrawSize(renderer){if(this._cbGetDrawSize)return this._cbGetDrawSize(renderer);else return[renderer.GetWidth(),renderer.GetHeight()]}GetRenderTarget(effectChain){return this._cbGetRenderTarget(effectChain)}ReleaseRenderTarget(rt,effectChain){this._cbReleaseRenderTarget(rt,effectChain)}GetTime(){return this._cbGetTime()}Redraw(effectChain){this._cbRedraw(effectChain)}_GetWebGPUBackTexture(renderer,width,height){width=Math.floor(width);
height=Math.floor(height);if(this._webgpuBackTexture&&(this._webgpuBackTexture.GetWidth()!==width||this._webgpuBackTexture.GetHeight()!==height)){renderer.DeleteTexture(this._webgpuBackTexture);this._webgpuBackTexture=null}if(this._webgpuBackTexture===null)this._webgpuBackTexture=renderer.CreateStaticTexture(null,{width,height,sampling:"nearest",mipMap:false});return this._webgpuBackTexture}};

}

// ../lib/gfx/effectCompositor/effectChain.js
{
'use strict';const C3=self.C3;const assert=self.assert;const glMatrix=self.glMatrix;const mat4=glMatrix.mat4;const tempRect=C3.New(C3.Rect);const tempRect2=C3.New(C3.Rect);const tempRect3=C3.New(C3.Rect);const tempRect4=C3.New(C3.Rect);const tempMat4a=mat4.create();const tempMat4b=mat4.create();const DEFAULT_CTOR_OPTS={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:false};
const DEFAULT_BUILDSTEPS_OPTS={indexMap:null,forcePreDraw:false,forcePostDraw:false,is3D:false,isSourceTextureRotated:false,isRotatedOrNegativeSizeInstance:false,useFullSurface:false};
C3.Gfx.EffectChain=class EffectChain{constructor(manager,opts){opts=Object.assign({},DEFAULT_CTOR_OPTS,opts);this._manager=manager;this._cbDrawContent=opts.drawContent;this._cbGetSourceTextureInfo=opts.getSourceTextureInfo;this._cbGetShaderParameters=opts.getShaderParameters;this._cbDrawContentHook=null;this._shaderProgramList=[];this._shaderProgramIndices=[];this._steps=[];this._needsRebuild=false;this._blendMode=0;this._isAnyShaderAnimated=false;this._isAnyShaderDepthSampling=false;this._isAnyShaderBackgroundBlending=
false;this._isAnyShaderCrossSampling=false;this._isAnyIsSrcTexRotated=false;this._useCopyTextureBackgroundSampling=false;this._didChangeTransform=false;this._depthEnabledAtStart=false;this._coplanarColorPassAtStart=false;this._canUseFastPath=false;this._useFullSurface=false;this._isSourceTextureRotated=false;this._numTempSurfacesRequired=0;this._renderTargets=[null,null,null];this._invalidateRenderTargets=!!opts.invalidateRenderTargets;this._boxExtendHorizontal=0;this._boxExtendVertical=0;this._drawWidth=
0;this._drawHeight=0;this._contentObject=null;this._contextObject=null;this._layoutRect=C3.New(C3.Rect);this._drawSurfaceRect=C3.New(C3.Rect);this._rcTexOriginal=C3.New(C3.Rect);this._rcTexBounce=C3.New(C3.Rect);this._rcTexDest=C3.New(C3.Rect);this._devicePixelRatio=1;this._layerScale=1;this._layerAngle=0;this._time=0;this._destRenderTarget=null;this._backTex=null;this._compositOffX=0;this._compositOffY=0;this._updateOwnProjection=false;this._projectionMatrix=mat4.create();this._modelViewMatrix=mat4.create();
this._manager._AddEffectChain(this)}Release(){this._manager._RemoveEffectChain(this);C3.clearArray(this._steps);C3.clearArray(this._shaderProgramList);C3.clearArray(this._shaderProgramIndices);this._contentObject=null;this._contextObject=null;this._cbDrawContent=null;this._cbGetSourceTextureInfo=null;this._cbGetShaderParameters=null}OnContextLost(){this._needsRebuild=true;C3.clearArray(this._steps);C3.clearArray(this._shaderProgramList);C3.clearArray(this._shaderProgramIndices)}NeedsRebuild(){return this._needsRebuild}BuildSteps(shaderProgramList,
opts){opts=Object.assign({},DEFAULT_BUILDSTEPS_OPTS,opts);C3.clearArray(this._steps);this._boxExtendHorizontal=0;this._boxExtendVertical=0;this._isAnyShaderAnimated=false;this._isAnyShaderDepthSampling=false;this._isAnyShaderBackgroundBlending=false;this._isAnyShaderCrossSampling=false;this._isAnyIsSrcTexRotated=false;this._useCopyTextureBackgroundSampling=false;this._numTempSurfacesRequired=0;this._isSourceTextureRotated=!!opts.isSourceTextureRotated;this._useFullSurface=!!opts.useFullSurface;this._needsRebuild=
false;C3.shallowAssignArray(this._shaderProgramList,shaderProgramList);if(shaderProgramList.length===0)return;if(opts.indexMap){if(opts.indexMap.length!==shaderProgramList.length)throw new Error("incorrect indexMap length");C3.shallowAssignArray(this._shaderProgramIndices,opts.indexMap)}else{C3.clearArray(this._shaderProgramIndices);for(let i=0,len=shaderProgramList.length;i<len;++i)this._shaderProgramIndices.push(i)}for(const s of shaderProgramList){this._boxExtendHorizontal+=s.GetBoxExtendHorizontal();
this._boxExtendVertical+=s.GetBoxExtendVertical();if(s.IsAnimated())this._isAnyShaderAnimated=true;if(s.UsesDepth())this._isAnyShaderDepthSampling=true;if(s.BlendsBackground())this._isAnyShaderBackgroundBlending=true;if(s.UsesCrossSampling())this._isAnyShaderCrossSampling=true;if(s.UsesIsSrcTexRotated())this._isAnyIsSrcTexRotated=true}this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(shaderProgramList[0].GetRenderer());const doPreDraw=this._ShouldPreDraw(shaderProgramList[0],
opts);const doPostDraw=this._ShouldPostDraw(shaderProgramList.at(-1),opts);if(shaderProgramList.length===1&&!doPreDraw&&!doPostDraw){this._canUseFastPath=true;return}this._canUseFastPath=false;let lastTargetId=0;if(doPreDraw){this._numTempSurfacesRequired=1;this._steps.push(C3.New(C3.Gfx.EffectChain.Step.PreDraw,this,-1,1));lastTargetId=1}for(let i=0,len=shaderProgramList.length;i<len;++i)if(i===0&&!doPreDraw){this._numTempSurfacesRequired=1;this._steps.push(C3.New(C3.Gfx.EffectChain.Step.FirstBounce,
this,-1,1,i));lastTargetId=1}else{let nextTargetId=lastTargetId===1?2:1;if(i===len-1&&!doPostDraw)nextTargetId=0;this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,nextTargetId);this._steps.push(C3.New(C3.Gfx.EffectChain.Step.Bounce,this,lastTargetId,nextTargetId,i));lastTargetId=nextTargetId}if(doPostDraw)this._steps.push(C3.New(C3.Gfx.EffectChain.Step.PostDraw,this,lastTargetId,0))}_ShouldPreDraw(firstShaderProgram,opts){if(opts.forcePreDraw||firstShaderProgram.MustPreDraw()||
opts.is3D&&!firstShaderProgram.Supports3DDirectRendering()||firstShaderProgram.UsesDepth()&&!this._useFullSurface||(this._boxExtendHorizontal!==0||this._boxExtendVertical!==0))return true;if(firstShaderProgram.GetRenderer().IsWebGL())return firstShaderProgram.BlendsBackground()&&(opts.isRotatedOrNegativeSizeInstance||opts.isSourceTextureRotated)||firstShaderProgram.UsesAnySrcRectOrPixelSize()&&opts.isSourceTextureRotated;else return firstShaderProgram.BlendsBackground()&&!this._useCopyTextureBackgroundSampling&&
opts.isRotatedOrNegativeSizeInstance}_ShouldPostDraw(lastShaderProgram,opts){if(opts.forcePostDraw)return true;if(lastShaderProgram.GetRenderer().IsWebGL())return lastShaderProgram.BlendsBackground()||lastShaderProgram.UsesCrossSampling();else return(lastShaderProgram.BlendsBackground()||lastShaderProgram.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling()}_ShouldUseCopyTextureBackgroundSampling(renderer){return renderer.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling}Render(renderer,
destRenderTarget,opts){if(renderer.IsWebGPU()&&destRenderTarget===null)destRenderTarget=renderer.GetBackbufferRenderTarget();this._destRenderTarget=destRenderTarget;this._contentObject=opts.contentObject||null;this._contextObject=opts.contextObject||null;this._blendMode=opts.blendMode||0;this._devicePixelRatio=opts.devicePixelRatio||1;this._layerScale=opts.layerScale||1;this._layerAngle=opts.layerAngle||0;this._time=typeof opts.time==="number"?opts.time:this._manager.GetTime();this._didChangeTransform=
false;renderer.ResetDidChangeTransformFlag();if(this._isAnyShaderAnimated)this._Redraw();let didCalcDrawSizeAndRects=false;if(this._UseCopyTextureBackgroundSampling()){this._CalculateDrawSizeAndRectangles(renderer,opts);didCalcDrawSizeAndRects=true;this._backTex=this._manager._GetWebGPUBackTexture(renderer,this._drawWidth,this._drawHeight);tempRect.copy(this._drawSurfaceRect);tempRect.roundOuter();if(renderer.IsWebGPU())renderer._MaybeDoPendingClearRenderPass(this._destRenderTarget);renderer.CopyTextureToTexture(this._destRenderTarget.GetTexture(),
this._backTex,tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height())}if(this._canUseFastPath){this._Render_FastPath(renderer,opts);return}if(!didCalcDrawSizeAndRects)this._CalculateDrawSizeAndRectangles(renderer,opts);if(this._rcTexOriginal.width()===0&&this._rcTexOriginal.height()===0)return;renderer.SetAlphaBlend();renderer.ResetColor();renderer.SetBaseZ(0);renderer.SetCurrentZ(0);this._cbDrawContentHook=opts.drawContentHook||null;this._compositOffX=opts.compositOffX||0;this._compositOffY=
opts.compositOffY||0;this._updateOwnProjection=!!opts.updateOwnProjection;this._OnBeforeStartEffectChain(renderer);this._renderTargets[0]=destRenderTarget;this._renderTargets[1]=this._numTempSurfacesRequired>=1?this._GetRenderTarget():null;this._renderTargets[2]=this._numTempSurfacesRequired===2?this._GetRenderTarget():null;for(const step of this._steps){const srcTarget=this._GetRenderTargetForId(step.GetSrcTargetId());const destTarget=this._GetRenderTargetForId(step.GetDestTargetId());if(renderer.IsWebGPU())step.Run_WebGPU(renderer,
srcTarget,destTarget);else step.Run_WebGL(renderer,srcTarget,destTarget)}renderer.SetTexture(null);if(this._renderTargets[1])this._ReleaseRenderTarget(this._renderTargets[1]);if(this._renderTargets[2])this._ReleaseRenderTarget(this._renderTargets[2]);this._renderTargets.fill(null);this._OnAfterEndEffectChain(renderer);this._destRenderTarget=null;this._backTex=null;this._contentObject=null;this._contextObject=null;this._cbDrawContentHook=null}_CalculateDrawSizeAndRectangles(renderer,opts){const [drawWidth,
drawHeight]=this._manager.GetDrawSize(renderer);this._SetDrawSize(renderer,drawWidth,drawHeight);this._CalculateRectangles(opts)}_SetDrawSize(renderer,drawWidth,drawHeight){if(drawWidth<=0||drawHeight<=0)throw new Error("invalid draw size");if(this._drawWidth!==drawWidth||this._drawHeight!==drawHeight)this._CalculateDeviceTransformMatrices(renderer,drawWidth,drawHeight,0,0,this._projectionMatrix,this._modelViewMatrix);this._drawWidth=drawWidth;this._drawHeight=drawHeight}_CalculateDeviceTransformMatrices(renderer,
width,height,offX,offY,projMat,mvMat){const scrollX=width/2+offX;const scrollY=height/2+offY;renderer.CalculatePerspectiveMatrix(projMat,width/height);const tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(height),scrollX,scrollY,0,height);mat4.copy(mvMat,tempMat4)}_CalculateRectangles(opts){this._layoutRect.copy(opts.layoutRect);if(opts.drawSurfaceRect)this._drawSurfaceRect.copy(opts.drawSurfaceRect);else this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight);
this._rcTexOriginal.copy(this._drawSurfaceRect);this._rcTexOriginal.divide(this._drawWidth,this._drawHeight);const boxScale=this._layerScale*this._devicePixelRatio;this._drawSurfaceRect.inflate(this._boxExtendHorizontal*boxScale,this._boxExtendVertical*boxScale);this._rcTexDest.copy(this._drawSurfaceRect);this._rcTexDest.divide(this._drawWidth,this._drawHeight);this._drawSurfaceRect.clampBoth(0,0,this._drawWidth,this._drawHeight);this._rcTexBounce.copy(this._drawSurfaceRect);this._rcTexBounce.divide(this._drawWidth,
this._drawHeight)}_OnBeforeStartEffectChain(renderer){this._depthEnabledAtStart=renderer.IsDepthEnabled();this._coplanarColorPassAtStart=renderer.IsCoplanarColorPass();if(this._useFullSurface){renderer.SetDepthEnabled(false);if(this._isAnyShaderDepthSampling)renderer.SetDepthSamplingEnabled(true)}else{tempRect.copy(this._drawSurfaceRect);if(renderer.IsWebGL()){const boxScale=this._layerScale*this._devicePixelRatio;tempRect.inflate(Math.max(this._boxExtendHorizontal,1)*boxScale,Math.max(this._boxExtendVertical,
1)*boxScale);tempRect.roundOuter();tempRect.clamp(0,0,this._drawWidth,this._drawHeight)}else tempRect.roundOuter();renderer.SetScissorRect(tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height(),this._drawHeight)}}_OnAfterEffectChainDrawContent(renderer){renderer.ResetColor();if(!this._useFullSurface){if(this._coplanarColorPassAtStart)renderer.CoplanarRestoreStandardRendering();renderer.SetDepthEnabled(false);if(this._isAnyShaderDepthSampling)renderer.SetDepthSamplingEnabled(true)}if(renderer.IsWebGPU())renderer.SetNormalizedCoordsProgramVariant(true)}_OnAfterEndEffectChain(renderer){renderer.SetDepthSamplingEnabled(false);
if(this._coplanarColorPassAtStart)renderer.CoplanarStartColorPass();renderer.SetDepthEnabled(this._depthEnabledAtStart);if(!this._useFullSurface)renderer.RemoveScissorRect();if(renderer.IsWebGPU())renderer.SetNormalizedCoordsProgramVariant(false);this._didChangeTransform=renderer.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(id){return id<0?null:this._renderTargets[id]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(rt){this._manager.ReleaseRenderTarget(rt,
this)}_GetShaderProgramAt(i){return this._shaderProgramList[i]}_DrawContent(renderer){if(this._cbDrawContentHook)this._cbDrawContentHook(this,renderer,()=>this._cbDrawContent(renderer,this));else this._cbDrawContent(renderer,this);if(!this._canUseFastPath)this._OnAfterEffectChainDrawContent(renderer)}_IsRenderTargetSameSizeAndOffset(renderer){if(this._useFullSurface)return true;if(this._compositOffX!==0||this._compositOffY!==0)return false;const [rtWidth,rtHeight]=renderer.GetRenderTargetSize(renderer.GetRenderTarget());
if(rtWidth!==this._drawWidth||rtHeight!==this._drawHeight)return false;return true}_SetDeviceTransform(renderer,isLast){let projMat=this._projectionMatrix;let mvMat=this._modelViewMatrix;if(isLast&&!this._IsRenderTargetSameSizeAndOffset(renderer)){projMat=tempMat4a;mvMat=tempMat4b;const [rtWidth,rtHeight]=renderer.GetRenderTargetSize(renderer.GetRenderTarget());this._CalculateDeviceTransformMatrices(renderer,rtWidth,rtHeight,this._compositOffX,this._compositOffY,projMat,mvMat);if(!this._useFullSurface)renderer.RemoveScissorRect()}renderer.SetProjectionMatrix(projMat);
renderer.SetModelViewMatrix(mvMat)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(index,renderer){return this._cbGetShaderParameters(this._shaderProgramIndices[index],renderer)}_SetProgramParameters(renderer,index){let rcTexDest=this._rcTexDest;let srcRect=this._rcTexBounce;let srcOriginRect=this._rcTexOriginal;if(renderer.IsWebGL()){tempRect2.copy(rcTexDest);tempRect2.flipAround(1);rcTexDest=tempRect2;tempRect3.copy(srcRect);tempRect3.flipAround(1);srcRect=tempRect3;tempRect4.copy(srcOriginRect);
tempRect4.flipAround(1);srcOriginRect=tempRect4}this._DoSetProgramParameters(renderer,index,srcRect,srcOriginRect,rcTexDest,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(renderer,index){let srcRect=this._rcTexBounce;let srcOriginRect=this._rcTexOriginal;let pixelWidth=1/this._drawWidth;let pixelHeight=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let {srcTexRect,srcWidth,srcHeight}=this._cbGetSourceTextureInfo(this._contentObject);if(!srcTexRect){tempRect.set(0,0,0,
0);srcTexRect=tempRect}if(!srcWidth)srcWidth=this._drawWidth;if(!srcHeight)srcHeight=this._drawHeight;srcRect=srcTexRect;srcOriginRect=srcTexRect;pixelWidth=1/srcWidth;pixelHeight=1/srcHeight}else if(renderer.IsWebGL()){tempRect3.copy(srcRect);tempRect3.flipAround(1);srcRect=tempRect3;tempRect4.copy(srcOriginRect);tempRect4.flipAround(1);srcOriginRect=tempRect4}let rcTexDest=this._rcTexDest;if(renderer.IsWebGL()){rcTexDest=tempRect2;rcTexDest.copy(this._rcTexDest);rcTexDest.flipAround(1)}this._DoSetProgramParameters(renderer,
index,srcRect,srcOriginRect,rcTexDest,pixelWidth,pixelHeight);if(renderer.IsWebGPU()&&this._isAnyIsSrcTexRotated)renderer.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_GetBackTex(renderer){if(this._isAnyShaderBackgroundBlending)if(renderer.IsWebGPU())if(this._UseCopyTextureBackgroundSampling())return this._backTex;else return this._destRenderTarget.GetTexture();else return this._destRenderTarget;else return null}_DoSetProgramParameters(renderer,index,srcRect,srcOriginRect,rcTexDest,
pixelWidth,pixelHeight){renderer.SetProgramParameters(this._GetBackTex(renderer),rcTexDest,srcRect,srcOriginRect,this._layoutRect,pixelWidth,pixelHeight,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time);renderer.SetProgramCustomParameters(this._GetShaderParameters(index,renderer))}_Render_FastPath(renderer,opts){const shaderProgram=this._shaderProgramList[0];const wasDepthEnabled=renderer.IsDepthEnabled();const usesDepth=shaderProgram.UsesDepth();if(usesDepth){renderer.SetDepthEnabled(false);
renderer.SetDepthSamplingEnabled(true);this._rcTexDest.set(0,0,1,1);this._rcTexOriginal.set(0,0,1,1)}renderer.SetProgram(shaderProgram);renderer.SetBlendMode(this._blendMode);renderer.SetRenderTarget(this._destRenderTarget);let pixelWidth=0;let pixelHeight=1;this._rcTexOriginal.set(0,0,1,1);if(shaderProgram.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){const {srcTexRect,srcWidth,srcHeight}=this._cbGetSourceTextureInfo(this._contentObject);if(srcTexRect)this._rcTexOriginal.copy(srcTexRect);
pixelWidth=Number.isFinite(srcWidth)?1/srcWidth:0;pixelHeight=Number.isFinite(srcHeight)?1/srcHeight:0}else{const [drawWidth,drawHeight]=this._manager.GetDrawSize(renderer);pixelWidth=1/drawWidth;pixelHeight=1/drawHeight}if(opts.layoutRect)this._layoutRect.copy(opts.layoutRect);else this._layoutRect.set(0,0,0,0);renderer.SetProgramParameters(this._GetBackTex(renderer),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,pixelWidth,pixelHeight,this._devicePixelRatio,this._layerScale,
this._layerAngle,this._time);renderer.SetProgramCustomParameters(this._GetShaderParameters(0,renderer));if(renderer.IsWebGPU()&&this._isAnyIsSrcTexRotated)renderer.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated);renderer.SetBaseZ(0);this._DrawContent(renderer);if(usesDepth){renderer.SetDepthSamplingEnabled(false);renderer.SetDepthEnabled(wasDepthEnabled)}}_UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling}_UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling}IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending}CanSkipCalculatingDrawSurfaceRect(){if(!this._canUseFastPath)return false;
if(this._UseCopyTextureBackgroundSampling())return false;return true}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(msg,
renderer,renderTarget){}};

}

// ../lib/gfx/effectCompositor/step.js
{
'use strict';const C3=self.C3;
C3.Gfx.EffectChain.Step=class EffectChainStep{constructor(effectChain,srcTargetId,destTargetId,index=-1){this._effectChain=effectChain;this._srcTargetId=srcTargetId;this._destTargetId=destTargetId;this._index=index}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(renderer,srcRenderTarget,destRenderTarget){}Run_WebGPU(renderer,
srcRenderTarget,destRenderTarget){}};

}

// ../lib/gfx/effectCompositor/preDrawStep.js
{
'use strict';const C3=self.C3;
C3.Gfx.EffectChain.Step.PreDraw=class PreDrawStep extends C3.Gfx.EffectChain.Step{constructor(effectChain,srcTargetId,destTargetId,index){super(effectChain,srcTargetId,destTargetId,index)}Run_WebGL(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetAlphaBlend();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget,effectChain._UpdateOwnProjection());renderer.ClearRgba(0,0,0,0);effectChain._DrawContent(renderer);effectChain._ClampRcTexDest()}Run_WebGPU(renderer,
srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetAlphaBlend();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget,false);renderer.ClearRgba(0,0,0,0);effectChain._DrawContent(renderer);effectChain._ClampRcTexDest()}};

}

// ../lib/gfx/effectCompositor/postDrawStep.js
{
'use strict';const C3=self.C3;const tempRect=C3.New(C3.Rect);const tempQuad=C3.New(C3.Quad);
C3.Gfx.EffectChain.Step.PostDraw=class PostDrawStep extends C3.Gfx.EffectChain.Step{constructor(effectChain,srcTargetId,destTargetId,index){super(effectChain,srcTargetId,destTargetId,index)}Run_WebGL(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget);effectChain._SetDeviceTransform(renderer,true);renderer.SetBlendMode(effectChain._GetBlendMode());renderer.SetTexture(srcRenderTarget.GetTexture());
tempQuad.setFromRect(effectChain._GetDrawSurfaceRect());tempRect.copy(effectChain._GetRcTexBounce());tempRect.flipAround(1);renderer.Quad3(tempQuad,tempRect);if(effectChain._ShouldInvalidateRenderTargets())renderer.InvalidateRenderTarget(srcRenderTarget)}Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget,false);if(effectChain._IsRenderTargetSameSizeAndOffset(renderer))tempQuad.setFromRect(effectChain._GetRcTexBounce());
else{renderer.SetNormalizedCoordsProgramVariant(false);effectChain._SetDeviceTransform(renderer,true);tempQuad.setFromRect(effectChain._GetDrawSurfaceRect())}renderer.SetBackTexture(null);renderer.SetBlendMode(effectChain._GetBlendMode());renderer.SetTexture(srcRenderTarget.GetTexture());if(effectChain.UseFullSurface())renderer.FullscreenQuad();else renderer.Quad3(tempQuad,effectChain._GetRcTexBounce())}};

}

// ../lib/gfx/effectCompositor/firstBounceStep.js
{
'use strict';const C3=self.C3;
C3.Gfx.EffectChain.Step.FirstBounce=class FirstBounceStep extends C3.Gfx.EffectChain.Step{constructor(effectChain,srcTargetId,destTargetId,index){super(effectChain,srcTargetId,destTargetId,index)}Run_WebGL(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget,effectChain._UpdateOwnProjection());renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();renderer.SetProgram(this.GetShaderProgram());effectChain._SetFirstBounceProgramParameters(renderer,this.GetIndex());
effectChain._DrawContent(renderer);effectChain._ClampRcTexDest()}Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget,false);renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();renderer.SetProgram(this.GetShaderProgram());effectChain._SetFirstBounceProgramParameters(renderer,this.GetIndex());effectChain._DrawContent(renderer);effectChain._ClampRcTexDest()}};

}

// ../lib/gfx/effectCompositor/bounceStep.js
{
'use strict';const C3=self.C3;const tempRect=C3.New(C3.Rect);const tempQuad=C3.New(C3.Quad);
C3.Gfx.EffectChain.Step.Bounce=class BounceStep extends C3.Gfx.EffectChain.Step{constructor(effectChain,srcTargetId,destTargetId,index){super(effectChain,srcTargetId,destTargetId,index)}Run_WebGL(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget);const isLast=this.GetDestTargetId()===0;if(isLast)renderer.SetBlendMode(effectChain._GetBlendMode());else{renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend()}renderer.SetProgram(this.GetShaderProgram());
effectChain._SetProgramParameters(renderer,this.GetIndex());renderer.SetTexture(srcRenderTarget.GetTexture());effectChain._SetDeviceTransform(renderer,isLast);tempQuad.setFromRect(effectChain._GetDrawSurfaceRect());tempRect.copy(effectChain._GetRcTexBounce());tempRect.flipAround(1);renderer.Quad3(tempQuad,tempRect);if(effectChain._ShouldInvalidateRenderTargets())renderer.InvalidateRenderTarget(srcRenderTarget)}Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){const effectChain=this.GetEffectChain();
renderer.SetRenderTarget(destRenderTarget,false);const isLast=this.GetDestTargetId()===0;if(isLast){renderer.SetBlendMode(effectChain._GetBlendMode());renderer.SetBackTexture(null);if(effectChain._IsRenderTargetSameSizeAndOffset(renderer))tempQuad.setFromRect(effectChain._GetRcTexBounce());else{renderer.SetNormalizedCoordsProgramVariant(false);effectChain._SetDeviceTransform(renderer,true);tempQuad.setFromRect(effectChain._GetDrawSurfaceRect())}}else{renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();
tempQuad.setFromRect(effectChain._GetRcTexBounce())}renderer.SetProgram(this.GetShaderProgram());effectChain._SetProgramParameters(renderer,this.GetIndex());renderer.SetTexture(srcRenderTarget.GetTexture());if(effectChain.UseFullSurface())renderer.FullscreenQuad();else renderer.Quad3(tempQuad,effectChain._GetRcTexBounce())}};

}

// interfaces/IRuntime.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;let runtime=null;const keysDownByKey=new Set;function SortZOrderList(a,b){const layerA=a[0];const layerB=b[0];const diff=layerA-layerB;if(diff!==0)return diff;const indexA=a[1];const indexB=b[1];return indexA-indexB}const tempZOrderList=[];const tempInstances=[];let didWarnInAlertPolyfill=false;let didWarnFpsDeprecated=false;const VALID_FRAMERATE_MODES=new Set(["vsync","unlimited-tick","unlimited-frame"]);
self.IRuntime=class IRuntime{constructor(runtime_){runtime=runtime_;Object.defineProperties(this,{assets:{value:runtime.GetAssetManager().GetIAssetManager(),writable:false},collisions:{value:runtime.GetCollisionEngine().GetICollisionEngine(),writable:false},objects:{value:{},writable:false},globalVars:{value:{},writable:false},projectName:{value:runtime.GetProjectName(),writable:false},projectVersion:{value:runtime.GetProjectVersion(),writable:false},storage:{value:new self.IStorage(runtime),writable:false},
isInWorker:{value:runtime.IsInWorker(),writable:false},viewportWidth:{value:runtime.GetOriginalViewportWidth(),writable:false},viewportHeight:{value:runtime.GetOriginalViewportHeight(),writable:false},sampling:{value:runtime.GetSampling(),writable:false},isPixelRoundingEnabled:{value:runtime.IsPixelRoundingEnabled(),writable:false}});runtime.UserScriptDispatcher().addEventListener("keydown",e=>{if(keysDownByKey.has(e["key"])){e.stopPropagation();return}keysDownByKey.add(e["key"])});runtime.UserScriptDispatcher().addEventListener("keyup",
e=>keysDownByKey.delete(e["key"]));runtime.Dispatcher().addEventListener("window-blur",()=>keysDownByKey.clear());if(runtime.IsInWorker())self["alert"]=message=>{if(!didWarnInAlertPolyfill){didWarnInAlertPolyfill=true;console.warn("[Construct] alert() was called from a Web Worker, because the project 'Use worker' setting is enabled. This method is not normally available in a Web Worker. Construct has implemented the alert for you, but note that other features may be missing in worker mode. You may wish to disable 'Use worker', or use a more convenient function like console.log(). For more information please refer to the scripting section of the manual.")}return this.alert(message)}}_InitObjects(objectDescriptors){Object.defineProperties(this.objects,
objectDescriptors)}_InitGlobalVars(globalVarDescriptors){Object.defineProperties(this.globalVars,globalVarDescriptors)}addEventListener(name,func){runtime.UserScriptDispatcher().addEventListener(name,func)}removeEventListener(name,func){runtime.UserScriptDispatcher().removeEventListener(name,func)}callFunction(name,...params){C3X.RequireString(name);const eventSheetManager=runtime.GetEventSheetManager();const functionBlock=eventSheetManager.GetFunctionBlockByName(name);if(!functionBlock)throw new Error(`cannot find function name '${name}'`);
if(!functionBlock.IsEnabled())return functionBlock.GetDefaultReturnValue();if(params.length<functionBlock.GetFunctionParameterCount())throw new Error(`not enough function parameters passed for '${name}' (${params.length} passed, ${functionBlock.GetFunctionParameterCount()} expected)`);const callEventBlock=functionBlock.GetEventBlock();let allSolModifiers=callEventBlock.GetSolModifiersIncludingParents();const currentEvent=eventSheetManager.GetCurrentEvent();if(currentEvent){allSolModifiers=allSolModifiers.slice(0);
const allSolModifiersSet=new Set(allSolModifiers);for(const objectClass of currentEvent.GetSolModifiersIncludingParents())if(!allSolModifiersSet.has(objectClass)){allSolModifiers.push(objectClass);allSolModifiersSet.add(objectClass)}for(const objectClass of eventSheetManager.GetDynamicSolModifiersSet())if(!allSolModifiersSet.has(objectClass)){allSolModifiers.push(objectClass);allSolModifiersSet.add(objectClass)}}const ret=callEventBlock.RunAsExpressionFunctionCall(allSolModifiers,functionBlock.IsCopyPicked(),
functionBlock.GetReturnType(),functionBlock.GetDefaultReturnValue(),...params);return ret}setReturnValue(v){const frame=runtime.GetEventStack().GetCurrentExpFuncStackFrame();if(!frame)throw new Error("not in a function which returns a value");switch(frame.GetFunctionReturnType()){case 1:if(typeof v==="number")frame.SetFunctionReturnValue(v);break;case 2:if(typeof v==="string")frame.SetFunctionReturnValue(v);break;case 3:if(typeof v==="number"||typeof v==="string")frame.SetFunctionReturnValue(v);break}}getViewportSize(){return[runtime.GetOriginalViewportWidth(),
runtime.GetOriginalViewportHeight()]}get dt(){return runtime.GetDt()}get dtRaw(){return runtime.GetDtRaw()}get gameTime(){return runtime.GetGameTime()}get wallTime(){return runtime.GetWallTime()}get timeScale(){return runtime.GetTimeScale()}set timeScale(t){C3X.RequireFiniteNumber(t);runtime.SetTimeScale(t)}get fps(){if(!didWarnFpsDeprecated){console.warn("IRuntime.fps is deprecated. Use IRuntime.framesPerSecond instead.");didWarnFpsDeprecated=true}return runtime.GetFramesPerSecond()}get framesPerSecond(){return runtime.GetFramesPerSecond()}get ticksPerSecond(){return runtime.GetTicksPerSecond()}get cpuUtilisation(){return runtime.GetMainThreadTime()}get gpuUtilisation(){return runtime.GetGPUUtilisation()}get framerateMode(){return runtime.GetFramerateMode()}set framerateMode(m){if(!VALID_FRAMERATE_MODES.has(m))throw new Error("invalid framerate mode");
runtime._SetFramerateMode(m)}get minDt(){return runtime.GetMinDt()}set minDt(dt){C3X.RequireFiniteNumber(dt);runtime.SetMinDt(dt)}get maxDt(){return runtime.GetMaxDt()}set maxDt(dt){runtime.SetMaxDt(dt)}random(){return runtime.Random()}get layout(){const layout=runtime.GetMainRunningLayout();if(!layout)throw new Error(`no layout is running - make sure a layout is loaded before accessing`);return layout.GetILayout()}getLayout(nameOrIndex){const layoutManager=runtime.GetLayoutManager();let layout=null;
if(typeof nameOrIndex==="number"||typeof nameOrIndex==="string")layout=layoutManager.GetLayout(nameOrIndex);else throw new TypeError("expected string or number");if(!layout)throw new Error("invalid layout");return layout.GetILayout()}getAllLayouts(){return runtime.GetLayoutManager().GetAllLayouts().map(layout=>layout.GetILayout())}goToLayout(nameOrIndex){const layoutManager=runtime.GetLayoutManager();let layout=null;if(typeof nameOrIndex==="number"||typeof nameOrIndex==="string")layout=layoutManager.GetLayout(nameOrIndex);
else throw new TypeError("expected string or number");if(!layout)throw new Error("invalid layout");if(layoutManager.IsPendingChangeMainLayout())return;layoutManager.ChangeMainLayout(layout)}get keyboard(){const ret=runtime._GetCommonScriptInterfaces().keyboard;if(!ret)throw new Error("runtime.keyboard used but Keyboard object missing - add it to your project first");return ret}get mouse(){const ret=runtime._GetCommonScriptInterfaces().mouse;if(!ret)throw new Error("runtime.mouse used but Mouse object missing - add it to your project first");
return ret}get touch(){const ret=runtime._GetCommonScriptInterfaces().touch;if(!ret)throw new Error("runtime.touch used but Touch object missing - add it to your project first");return ret}get timelineController(){const ret=runtime._GetCommonScriptInterfaces().timelineController;if(!ret)throw new Error("runtime.timelineController used but Timeline Controller object missing - add it to your project first");return ret}get platformInfo(){const ret=runtime._GetCommonScriptInterfaces().platformInfo;if(!ret)throw new Error("runtime.platformInfo used but Platform Info object missing - add it to your project first");
return ret}invokeDownload(url,filename){C3X.RequireString(url);C3X.RequireString(filename);runtime.InvokeDownload(url,filename)}getInstanceByUid(uid){C3X.RequireFiniteNumber(uid);const ret=runtime.GetInstanceByUID(uid);return ret?ret.GetInterfaceClass():null}sortZOrder(iterable,callback){C3X.RequireFunction(callback);const layout=runtime.GetCurrentLayout();for(const iinst of iterable){const inst=runtime._UnwrapIWorldInstance(iinst);const wi=inst.GetWorldInfo();tempZOrderList.push([wi.GetLayer().GetIndex(),
wi.GetZIndex()]);tempInstances.push(inst)}if(tempZOrderList.length===0)return;tempZOrderList.sort(SortZOrderList);tempInstances.sort((a,b)=>callback(a.GetInterfaceClass(),b.GetInterfaceClass()));let anyChanged=false;for(let i=0,len=tempZOrderList.length;i<len;++i){const inst=tempInstances[i];const layer=layout.GetLayerByIndex(tempZOrderList[i][0]);const toZ=tempZOrderList[i][1];const layerInstances=layer._GetInstances();if(layerInstances[toZ]!==inst){layerInstances[toZ]=inst;inst.GetWorldInfo()._SetLayer(layer,
true);layer.SetZIndicesChanged(inst);anyChanged=true}}if(anyChanged)runtime.UpdateRender();C3.clearArray(tempZOrderList);C3.clearArray(tempInstances)}async createWorker(url,opts){const messageChannel=new MessageChannel;const port1=messageChannel.port1;const port2=messageChannel.port2;await runtime.PostComponentMessageToDOMAsync("runtime","script-create-worker",{"url":url,"opts":opts,"port2":port2},[port2]);return port1}alert(message){return runtime.PostComponentMessageToDOMAsync("runtime","alert",
{"message":message+(runtime.IsInWorker()?" [via Web Worker]":"")})}getHTMLLayer(index){C3X.RequireFiniteNumber(index);return runtime._GetHTMLLayerWrapElement(index)}addLoadPromise(promise){runtime.AddLoadPromise(promise)}};

}

// interfaces/other/IAssetManager.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;let assetManager=null;
self.IAssetManager=class IAssetManager{constructor(assetManager_){assetManager=assetManager_;Object.defineProperties(this,{isWebMOpusSupported:{value:assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:false}})}loadImageAsset(iImageInfo){const imageInfo=self.IImageInfo._Unwrap(iImageInfo);if(!imageInfo)throw new Error(`invalid IImageInfo`);imageInfo.LoadAsset(assetManager.GetRuntime())}fetchText(url){return assetManager.FetchText(url)}fetchJson(url){return assetManager.FetchJson(url)}fetchBlob(url){return assetManager.FetchBlob(url)}fetchArrayBuffer(url){return assetManager.FetchArrayBuffer(url)}getProjectFileUrl(url){return assetManager.GetProjectFileUrl(url)}getMediaFileUrl(url){if(assetManager.GetFileStructure()==="flat"&&
C3.IsRelativeURL(url))url=url.toLowerCase();return assetManager.GetMediaFileUrl(url)}get mediaFolder(){return assetManager.GetMediaSubfolder()}async decodeWebMOpus(audioContext,arrayBuffer){if(this.isWebMOpusSupported)throw new Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");const decodedArrayBuffer=await assetManager.GetRuntime()._WasmDecodeWebMOpus(arrayBuffer);const decodedFloats=new Float32Array(decodedArrayBuffer);const audioBuffer=audioContext["createBuffer"](1,
decodedFloats.length,48E3);const channelBuffer=audioBuffer["getChannelData"](0);channelBuffer.set(decodedFloats);return audioBuffer}loadScripts(...urls){return assetManager.LoadScripts(...urls)}compileWebAssembly(url){return assetManager.CompileWebAssembly(url)}loadStyleSheet(url){return assetManager.LoadStyleSheet(url)}};

}

// interfaces/other/ICollisionEngine.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;let collisionEngine=null;
self.ICollisionEngine=class ICollisionEngine{constructor(collisionEngine_){collisionEngine=collisionEngine_;Object.defineProperties(this,{runtime:{value:collisionEngine.GetRuntime(),writable:false}})}testOverlap(wi1_,wi2_){const runtime=collisionEngine.GetRuntime();const wi1=runtime._UnwrapIWorldInstance(wi1_);const wi2=runtime._UnwrapIWorldInstance(wi2_);return collisionEngine.TestOverlap(wi1,wi2)}testOverlapAny(wi1_,iterable){const runtime=collisionEngine.GetRuntime();const wi1=runtime._UnwrapIWorldInstance(wi1_);
for(const wi2_ of iterable){const wi2=runtime._UnwrapIWorldInstance(wi2_);if(collisionEngine.TestOverlap(wi1,wi2))return wi2_}return null}testOverlapSolid(wi_){const wi=collisionEngine.GetRuntime()._UnwrapIWorldInstance(wi_);const ret=collisionEngine.TestOverlapSolid(wi);return ret?ret.GetInterfaceClass():null}setCollisionCellSize(width,height){C3X.RequireFiniteNumber(width);C3X.RequireFiniteNumber(height);width=Math.floor(width);height=Math.floor(height);if(width<=0||height<=0)throw new Error("invalid cell size");
collisionEngine.SetCollisionCellSize(width,height)}getCollisionCellSize(){return collisionEngine.GetCollisionCellSize()}getCollisionCandidates(iObjectClasses,domrect){const runtime=collisionEngine.GetRuntime();let objectClasses;if(Array.isArray(iObjectClasses))objectClasses=iObjectClasses.map(ioc=>runtime._UnwrapIObjectClass(ioc));else objectClasses=[runtime._UnwrapIObjectClass(iObjectClasses)];const bbox=C3.Rect.FromObject(domrect);const ret=[];collisionEngine.GetObjectClassesCollisionCandidates(null,
objectClasses,bbox,ret);return ret.map(wi=>wi.GetInterfaceClass())}};

}

// interfaces/other/IStorage.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;self.IStorage=class IStorage{constructor(runtime){this._storage=runtime._GetProjectStorage()}getItem(key){C3X.RequireString(key);return this._storage.getItem(key)}setItem(key,value){C3X.RequireString(key);return this._storage.setItem(key,value)}removeItem(key){C3X.RequireString(key);return this._storage.removeItem(key)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}};

}

// interfaces/objects/IPlugin.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const internalApiToken=C3._GetInternalAPIToken();
self.IPlugin=class IPlugin{constructor(){const plugin=C3.AddonManager._GetInitObject2(internalApiToken);Object.defineProperties(this,{runtime:{value:plugin.GetRuntime().GetIRuntime(),writable:false},isSingleGlobal:{value:plugin.IsSingleGlobal(),writable:false},isWorldType:{value:plugin.IsWorldType(),writable:false},isHTMLElementType:{value:plugin.IsHTMLElementType(),writable:false},isRotatable:{value:plugin.IsRotatable(),writable:false},hasEffects:{value:plugin.HasEffects(),writable:false},is3d:{value:plugin.Is3D(),
writable:false},supportsHierarchies:{value:plugin.SupportsSceneGraph(),writable:false},supportsMesh:{value:plugin.SupportsMesh(),writable:false}})}};

}

// interfaces/objects/IObjectClass.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.IObjectClass=class IObjectClass{constructor(){const objectClass=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,objectClass);Object.defineProperties(this,{name:{value:objectClass.GetName(),writable:false},runtime:{value:objectClass.GetRuntime().GetIRuntime(),writable:false},plugin:{value:objectClass.GetPlugin().GetIPlugin(),writable:false}});objectClass.GetRuntime()._MapScriptInterface(this,objectClass)}addEventListener(type,func){C3X.RequireString(type);C3X.RequireFunction(func);
map.get(this).UserScriptDispatcher().addEventListener(type,func)}removeEventListener(type,func){C3X.RequireString(type);C3X.RequireFunction(func);map.get(this).UserScriptDispatcher().removeEventListener(type,func)}getAllInstances(){return[...this.instances()]}getFirstInstance(){return C3.first(this.instances())}getPickedInstances(){return[...this.pickedInstances()]}getFirstPickedInstance(){return C3.first(this.pickedInstances())}*instances(){for(const inst of map.get(this).instancesIncludingPendingCreate())yield inst.GetInterfaceClass()}*pickedInstances(){for(const inst of map.get(this).GetCurrentSol().GetInstances())yield inst.GetInterfaceClass()}setInstanceClass(Class){C3X.RequireFunction(Class);
const objectClass=map.get(this);if(objectClass.GetInstanceCount()>0)throw new Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");map.get(this)._SetUserScriptInstanceClass(Class)}createInstance(layerNameOrIndex,x,y,createHierarchy,template){C3X.RequireNumber(x);C3X.RequireNumber(y);if(typeof layerNameOrIndex!=="number"&&typeof layerNameOrIndex!=="string")throw new TypeError("invalid layer parameter");const objectClass=map.get(this);const runtime=
objectClass.GetRuntime();const layer=runtime.GetMainRunningLayout().GetLayer(layerNameOrIndex);if(!layer)throw new Error("invalid layer");const inst=runtime.CreateInstance(objectClass,layer,x,y,createHierarchy,template);if(createHierarchy)layer.SortAndAddInstancesByZIndex(inst);const eventSheetManager=runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);if(!eventSheetManager.IsInEventEngine()&&
!runtime.GetLayoutManager().IsEndingLayout())runtime.FlushPendingInstances();return inst.GetInterfaceClass()}};

}

// interfaces/layouts/ILayout.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const VALID_WHERE_STRINGS=["above","below","top-sublayer","bottom-sublayer"];
self.ILayout=class ILayout{constructor(layout){map.set(this,layout);const effectInstanceArr=[];const effectList=layout.GetEffectList();const effectCount=effectList.GetAllEffectTypes().length;for(let i=0;i<effectCount;++i)effectInstanceArr.push(new self.IEffectInstance(effectList,i));Object.defineProperties(this,{name:{value:layout.GetName(),writable:false},index:{value:layout.GetIndex(),writable:false},effects:{value:effectInstanceArr,writable:false}})}addEventListener(type,func){C3X.RequireString(type);
C3X.RequireFunction(func);map.get(this).UserScriptDispatcher().addEventListener(type,func)}removeEventListener(type,func){C3X.RequireString(type);C3X.RequireFunction(func);map.get(this).UserScriptDispatcher().removeEventListener(type,func)}get width(){return map.get(this).GetWidth()}set width(w){C3X.RequireFiniteNumber(w);map.get(this).SetWidth(w)}get height(){return map.get(this).GetHeight()}set height(h){C3X.RequireFiniteNumber(h);map.get(this).SetHeight(h)}setSize(w,h){C3X.RequireFiniteNumber(w);
C3X.RequireFiniteNumber(h);const layout=map.get(this);layout.SetWidth(w);layout.SetHeight(h)}getSize(){const layout=map.get(this);return[layout.GetWidth(),layout.GetHeight()]}set scale(s){C3X.RequireFiniteNumber(s);map.get(this).SetScale(s)}get scale(){return map.get(this).GetScale()}set angle(a){C3X.RequireFiniteNumber(a);map.get(this).SetAngle(a)}get angle(){return map.get(this).GetAngle()}set scrollX(x){C3X.RequireNumber(x);map.get(this).SetScrollX(x)}get scrollX(){return map.get(this).GetScrollX()}set scrollY(y){C3X.RequireNumber(y);
map.get(this).SetScrollY(y)}get scrollY(){return map.get(this).GetScrollY()}scrollTo(x,y){C3X.RequireNumber(x);C3X.RequireNumber(y);const layout=map.get(this);layout.SetScrollX(x);layout.SetScrollY(y)}getScrollPosition(){const layout=map.get(this);return[layout.GetScrollX(),layout.GetScrollY()]}getLayer(nameOrIndex){const layout=map.get(this);let layer=null;if(typeof nameOrIndex==="number"||typeof nameOrIndex==="string")layer=layout.GetLayer(nameOrIndex);else throw new TypeError("expected string or number");
if(!layer)return null;return layer.GetILayer()}getAllLayers(){return map.get(this).GetLayers().map(layer=>layer.GetILayer())}*allLayers(){for(const layer of map.get(this).allLayers())yield layer.GetILayer()}addLayer(layerName,iInsertBy,whereStr){const layout=map.get(this);const ILayer=self.ILayer;C3X.RequireString(layerName);C3X.RequireOptionalInstanceOf(iInsertBy,ILayer);const insertBy=iInsertBy?layout.GetRuntime()._UnwrapScriptInterface(iInsertBy):null;const where=VALID_WHERE_STRINGS.indexOf(whereStr);
if(where<0)throw new Error("invalid location");layout.AddLayer(layerName,insertBy,where)}moveLayer(iLayer,iInsertBy,whereStr){const layout=map.get(this);const runtime=layout.GetRuntime();const ILayer=self.ILayer;C3X.RequireInstanceOf(iLayer,ILayer);const layer=runtime._UnwrapScriptInterface(iLayer);if(!layer)throw new Error("invalid layer");C3X.RequireOptionalInstanceOf(iInsertBy,ILayer);const insertBy=iInsertBy?runtime._UnwrapScriptInterface(iInsertBy):null;const where=VALID_WHERE_STRINGS.indexOf(whereStr);
if(where<0)throw new Error("invalid location");layout.MoveLayer(layer,insertBy,where)}removeLayer(iLayer){const layout=map.get(this);const ILayer=self.ILayer;C3X.RequireInstanceOf(iLayer,ILayer);const layer=layout.GetRuntime()._UnwrapScriptInterface(iLayer);if(!layer)throw new Error("invalid layer");const runtime=layer.GetRuntime();layout.RemoveLayer(layer);if(!runtime.GetEventSheetManager().IsInEventEngine())runtime.FlushPendingInstances()}removeAllDynamicLayers(){const layout=map.get(this);const runtime=
layout.GetRuntime();layout.RemoveAllDynamicLayers();if(!runtime.GetEventSheetManager().IsInEventEngine())runtime.FlushPendingInstances()}setVanishingPoint(vpX,vpY){C3X.RequireFiniteNumber(vpX);C3X.RequireFiniteNumber(vpY);map.get(this).SetVanishingPointXY(vpX,vpY)}getVanishingPoint(){return map.get(this)._GetVanishingPoint()}set projection(p){C3X.RequireString(p);const layout=map.get(this);if(p==="perspective")layout.SetPerspectiveProjection();else if(p==="orthographic")layout.SetOrthographicProjection();
else throw new Error("invalid projection");}get projection(){if(map.get(this).IsOrthographicProjection())return"orthographic";else return"perspective"}};

}

// interfaces/layouts/ILayer.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]);const INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(a=>[a[1],a[0]]));const tempColor=C3.New(C3.Color);
self.ILayer=class ILayer{constructor(layer){map.set(this,layer);const effectInstanceArr=[];const effectList=layer.GetEffectList();const effectCount=effectList.GetAllEffectTypes().length;for(let i=0;i<effectCount;++i)effectInstanceArr.push(new self.IEffectInstance(effectList,i));Object.defineProperties(this,{name:{value:layer.GetName(),writable:false},layout:{value:layer.GetLayout().GetILayout(),writable:false},effects:{value:effectInstanceArr,writable:false}});layer.GetRuntime()._MapScriptInterface(this,
layer)}get parentLayer(){const parent=map.get(this).GetParentLayer();return parent?parent.GetILayer():null}*parentLayers(){for(const parent of map.get(this).parentLayers())yield parent.GetILayer()}*subLayers(){for(const layer of map.get(this).GetSubLayers())yield layer.GetILayer()}*allSubLayers(){for(const subLayer of map.get(this).GetSubLayers())for(const layer of subLayer.selfAndAllSubLayers())yield layer.GetILayer()}get index(){return map.get(this).GetIndex()}get isVisible(){return map.get(this)._IsVisibleFlagSet()}set isVisible(v){map.get(this).SetVisible(v)}get isSelfAndParentsVisible(){return map.get(this).IsVisible()}get isInteractive(){return map.get(this).IsInteractive()}set isInteractive(i){map.get(this).SetInteractive(i)}get isHTMLElementsLayer(){return map.get(this).IsHTMLElementsLayer()}set isHTMLElementsLayer(i){map.get(this).SetIsHTMLElementsLayer(!!i)}get isSelfAndParentsInteractive(){return map.get(this).IsSelfAndParentsInteractive()}get opacity(){return map.get(this).GetOpacity()}set opacity(o){o=
C3.clamp(+o,0,1);if(isNaN(o))return;map.get(this).SetOpacity(o)}set scale(s){C3X.RequireFiniteNumber(s);map.get(this).SetOwnScale(s)}get scale(){return map.get(this).GetOwnScale()}set scaleRate(r){C3X.RequireFiniteNumber(r);map.get(this).SetScaleRate(r)}get scaleRate(){return map.get(this).GetScaleRate()}set angle(a){C3X.RequireFiniteNumber(a);map.get(this).SetAngle(a)}get angle(){return map.get(this).GetOwnAngle()}set parallaxX(p){C3X.RequireFiniteNumber(p);map.get(this).SetParallaxX(p)}get parallaxX(){return map.get(this).GetParallaxX()}set parallaxY(p){C3X.RequireFiniteNumber(p);
map.get(this).SetParallaxY(p)}get parallaxY(){return map.get(this).GetParallaxY()}set zElevation(z){C3X.RequireFiniteNumber(z);map.get(this).SetZElevation(z)}get zElevation(){return map.get(this).GetZElevation()}set isTransparent(t){map.get(this).SetTransparent(t)}get isTransparent(){return map.get(this).IsTransparent()}set isForceOwnTexture(f){map.get(this).SetForceOwnTexture(f)}get isForceOwnTexture(){return map.get(this).IsForceOwnTexture()}set blendMode(bm){C3X.RequireString(bm);const index=BLEND_MODE_TO_INDEX.get(bm);
if(typeof index!=="number")throw new Error("invalid blend mode");map.get(this).SetBlendMode(index)}get blendMode(){return INDEX_TO_BLEND_MODE.get(map.get(this).GetBlendMode())}set backgroundColor(arr){C3X.RequireArray(arr);if(arr.length<3)throw new Error("expected 3 elements");tempColor.setRgb(arr[0],arr[1],arr[2]);const layer=map.get(this);const bgColor=layer.GetBackgroundColor();if(bgColor.equalsIgnoringAlpha(tempColor))return;bgColor.copyRgb(tempColor);layer.GetRuntime().UpdateRender()}get backgroundColor(){const c=
map.get(this).GetBackgroundColor();return[c.getR(),c.getG(),c.getB()]}set scrollX(x){C3X.RequireNumber(x);const layer=map.get(this);layer.SetOwnScrollPositionEnabled(true);layer.SetScrollX(x)}get scrollX(){return map.get(this).GetScrollX()}set scrollY(y){C3X.RequireNumber(y);const layer=map.get(this);layer.SetOwnScrollPositionEnabled(true);layer.SetScrollY(y)}get scrollY(){return map.get(this).GetScrollY()}scrollTo(x,y){C3X.RequireNumber(x);C3X.RequireNumber(y);const layer=map.get(this);layer.SetOwnScrollPositionEnabled(true);
layer.SetScrollX(x);layer.SetScrollY(y)}getScrollPosition(){const layer=map.get(this);return[layer.GetScrollX(),layer.GetScrollY()]}restoreScrollPosition(){map.get(this).SetOwnScrollPositionEnabled(false)}getViewport(){return map.get(this).GetViewport().toDOMRect()}cssPxToLayer(clientX,clientY,z=0){C3X.RequireNumber(clientX);C3X.RequireNumber(clientY);C3X.RequireNumber(z);const layer=map.get(this);const runtime=layer.GetRuntime();return layer.CanvasCssToLayer(clientX-runtime.GetCanvasClientX(),clientY-
runtime.GetCanvasClientY(),z)}layerToCssPx(layerX,layerY,z=0){C3X.RequireNumber(layerX);C3X.RequireNumber(layerY);C3X.RequireNumber(z);const layer=map.get(this);const runtime=layer.GetRuntime();const [clientX,clientY]=layer.LayerToCanvasCss(layerX,layerY,z);return[clientX+runtime.GetCanvasClientX(),clientY+runtime.GetCanvasClientY()]}drawSurfaceToLayer(x,y,z=0){C3X.RequireNumber(x);C3X.RequireNumber(y);C3X.RequireNumber(z);return map.get(this).DrawSurfaceToLayer(x,y,z)}layerToDrawSurface(x,y,z=0){C3X.RequireNumber(x);
C3X.RequireNumber(y);C3X.RequireNumber(z);return map.get(this).LayerToDrawSurface(x,y,z)}get renderScale(){return map.get(this).GetRenderScale()}};

}

// interfaces/objects/IInstance.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const dispatchers=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();function GetDispatcher(iinst){let dispatcher=dispatchers.get(iinst);if(dispatcher)return dispatcher;dispatcher=C3.New(C3.Event.Dispatcher);dispatchers.set(iinst,dispatcher);return dispatcher}
self.IInstance=class IInstance{constructor(){const initInst=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,initInst);const descriptors={runtime:{value:initInst.GetRuntime().GetIRuntime(),writable:false},objectType:{value:initInst.GetObjectClass().GetIObjectClass(),writable:false},plugin:{value:initInst.GetPlugin().GetIPlugin(),writable:false},uid:{value:initInst.GetUID(),writable:false}};initInst._GetInstVarsScriptDescriptor(descriptors);initInst._GetBehaviorsScriptDescriptor(descriptors);
Object.defineProperties(this,descriptors);initInst.GetRuntime()._MapScriptInterface(this,initInst)}static _GetInitInst(){return C3.AddonManager._GetInitObject()}_release(){const dispatcher=dispatchers.get(this);if(dispatcher){dispatcher.Release();dispatchers.delete(this)}map.delete(this)}addEventListener(type,func,capture){C3X.RequireString(type);C3X.RequireFunction(func);GetDispatcher(this).addEventListener(type,func,capture)}removeEventListener(type,func,capture){C3X.RequireString(type);C3X.RequireFunction(func);
GetDispatcher(this).removeEventListener(type,func,capture)}dispatchEvent(e){GetDispatcher(this).dispatchEvent(e)}destroy(){const inst=map.get(this);const runtime=inst.GetRuntime();runtime.DestroyInstance(inst);if(!runtime.GetEventSheetManager().IsInEventEngine()&&!runtime.GetLayoutManager().IsEndingLayout()&&!runtime.GetEventSheetManager().IsFlushingBlocked())runtime.FlushPendingInstances()}getOtherContainerInstances(){const siblings=map.get(this).GetSiblings();return siblings?siblings.map(s=>s.GetInterfaceClass()):
[]}*otherContainerInstances(){const inst=map.get(this);if(!inst.IsInContainer())return;for(const s of inst.siblings())yield s.GetInterfaceClass()}get templateName(){return map.get(this).GetTemplateName()}set timeScale(t){C3X.RequireFiniteNumber(t);map.get(this).SetTimeScale(t)}get timeScale(){return map.get(this).GetActiveTimeScale()}restoreTimeScale(){map.get(this).RestoreTimeScale()}get dt(){const inst=map.get(this);return inst.GetRuntime().GetDt(inst)}};

}

// interfaces/sdk/ISDKInstanceBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.ISDKInstanceBase=class ISDKInstanceBase extends self.IInstance{constructor(opts){super();map.set(this,C3.AddonManager._GetInitObject2(internalApiToken));this._p_isTicking=false;this._p_tickFunc=null;this._p_isTicking2=false;this._p_tickFunc2=null;this._p_domComponentId=opts?.domComponentId;this._p_wrapperComponentId=opts?.wrapperComponentId}_release(){super._release();map.delete(this)}_getInitProperties(){return C3.AddonManager._GetInitProperties()}_trigger(method){const inst=map.get(this);inst.GetRuntime().Trigger(method,
inst)}_addDOMMessageHandler(messageId,callback){C3X.RequireString(messageId);C3X.RequireFunction(callback);if(!this._p_domComponentId)throw new Error(`no DOM component id set`);const runtime=map.get(this).GetRuntime();runtime.AddDOMComponentMessageHandler(this._p_domComponentId,messageId,callback)}_addDOMMessageHandlers(arr){C3X.RequireArray(arr);for(const [messageId,callback]of arr)this._addDOMMessageHandler(messageId,callback)}_postToDOM(messageId,data){C3X.RequireString(messageId);if(!this._p_domComponentId)throw new Error(`no DOM component id set`);
const runtime=map.get(this).GetRuntime();runtime.PostComponentMessageToDOM(this._p_domComponentId,messageId,data)}_postToDOMAsync(messageId,data){C3X.RequireString(messageId);if(!this._p_domComponentId)throw new Error(`no DOM component id set`);const runtime=map.get(this).GetRuntime();return runtime.PostComponentMessageToDOMAsync(this._p_domComponentId,messageId,data)}_postToDOMMaybeSync(handler,data){const runtime=map.get(this).GetRuntime();if(runtime.IsInWorker())this._postToDOM(handler,data);else return window["c3_runtimeInterface"]["_OnMessageFromRuntime"]({"type":"event",
"component":this._p_domComponentId,"handler":handler,"data":data,"responseId":null})}_setTicking(isTicking){isTicking=!!isTicking;if(this._p_isTicking===isTicking)return;this._p_isTicking=isTicking;const runtime=map.get(this).GetRuntime();if(isTicking){if(!this._p_tickFunc)this._p_tickFunc=()=>this._tick();runtime.Dispatcher().addEventListener("tick",this._p_tickFunc)}else runtime.Dispatcher().removeEventListener("tick",this._p_tickFunc)}_isTicking(){return this._p_isTicking}_tick(){}_setTicking2(isTicking){isTicking=
!!isTicking;if(this._p_isTicking2===isTicking)return;this._p_isTicking2=isTicking;const runtime=map.get(this).GetRuntime();if(isTicking){if(!this._p_tickFunc2)this._p_tickFunc2=()=>this._tick2();runtime.Dispatcher().addEventListener("tick2",this._p_tickFunc2)}else runtime.Dispatcher().removeEventListener("tick2",this._p_tickFunc2)}_isTicking2(){return this._p_isTicking2}_tick2(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(o){}_isWrapperExtensionAvailable(){if(!this._p_wrapperComponentId)throw new Error(`no wrapper component id set`);
const runtime=map.get(this).GetRuntime();return runtime.HasWrapperComponentId(this._p_wrapperComponentId)}_addWrapperExtensionMessageHandler(messageId,callback){C3X.RequireString(messageId);C3X.RequireFunction(callback);if(!this._p_wrapperComponentId)throw new Error(`no wrapper component id set`);const runtime=map.get(this).GetRuntime();runtime.AddWrapperExtensionMessageHandler(this._p_wrapperComponentId,messageId,callback)}_addWrapperMessageHandlers(arr){C3X.RequireArray(arr);for(const [messageId,
callback]of arr)this._addWrapperExtensionMessageHandler(messageId,callback)}_sendWrapperExtensionMessage(messageId,params){C3X.RequireString(messageId);C3X.RequireOptionalArray(params);if(!this._p_wrapperComponentId)throw new Error(`no wrapper component id set`);const runtime=map.get(this).GetRuntime();runtime.SendWrapperExtensionMessage(this._p_wrapperComponentId,messageId,params)}_sendWrapperExtensionMessageAsync(messageId,params){C3X.RequireString(messageId);C3X.RequireOptionalArray(params);if(!this._p_wrapperComponentId)throw new Error(`no wrapper component id set`);
const runtime=map.get(this).GetRuntime();return runtime.SendWrapperExtensionMessageAsync(this._p_wrapperComponentId,messageId,params)}};

}

// interfaces/objects/IWorldInstance.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const IInstance=self.IInstance;const ILayer=self.ILayer;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();const BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]);const INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(a=>[a[1],a[0]]));const tempColor=C3.New(C3.Color);
function MakeIWorldInstanceClass(BaseClass){return class IWorldInstance extends BaseClass{constructor(opts){super(opts);const inst=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,inst);const effectInstanceArr=[];const wi=inst.GetWorldInfo();const instanceEffectList=wi.GetInstanceEffectList();if(instanceEffectList){const effectCount=wi.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let i=0;i<effectCount;++i)effectInstanceArr.push(new self.IEffectInstance(instanceEffectList,
i))}const descriptors={effects:{value:effectInstanceArr,writable:false}};Object.defineProperties(this,descriptors)}get layout(){return map.get(this).GetWorldInfo().GetLayout().GetILayout()}get layer(){return map.get(this).GetWorldInfo().GetLayer().GetILayer()}get x(){return map.get(this).GetWorldInfo().GetX()}set x(v){v=+v;const wi=map.get(this).GetWorldInfo();if(isNaN(v)||wi.GetX()===v)return;wi.SetX(v);wi.SetBboxChanged()}get y(){return map.get(this).GetWorldInfo().GetY()}set y(v){v=+v;const wi=
map.get(this).GetWorldInfo();if(isNaN(v)||wi.GetY()===v)return;wi.SetY(v);wi.SetBboxChanged()}setPosition(x,y){x=+x;y=+y;const wi=map.get(this).GetWorldInfo();if(isNaN(x)||isNaN(y)||wi.GetX()===x&&wi.GetY()===y)return;wi.SetXY(x,y);wi.SetBboxChanged()}getPosition(){const wi=map.get(this).GetWorldInfo();return[wi.GetX(),wi.GetY()]}offsetPosition(dx,dy){dx=+dx;dy=+dy;if(isNaN(dx)||isNaN(dy)||dx===0&&dy===0)return;const wi=map.get(this).GetWorldInfo();wi.OffsetXY(dx,dy);wi.SetBboxChanged()}get zElevation(){return map.get(this).GetWorldInfo().GetZElevation()}set zElevation(z){z=
+z;const inst=map.get(this);const wi=inst.GetWorldInfo();if(isNaN(z)||wi.GetZElevation()===z)return;wi.SetZElevation(z);inst.GetRuntime().UpdateRender()}get totalZElevation(){return map.get(this).GetWorldInfo().GetTotalZElevation()}get width(){return map.get(this).GetWorldInfo().GetWidth()}set width(w){w=+w;const wi=map.get(this).GetWorldInfo();if(isNaN(w)||wi.GetWidth()===w)return;wi.SetWidth(w);wi.SetBboxChanged()}get height(){return map.get(this).GetWorldInfo().GetHeight()}set height(h){h=+h;const wi=
map.get(this).GetWorldInfo();if(isNaN(h)||wi.GetHeight()===h)return;wi.SetHeight(h);wi.SetBboxChanged()}setSize(w,h){w=+w;h=+h;const wi=map.get(this).GetWorldInfo();if(isNaN(w)||isNaN(h)||wi.GetWidth()===w&&wi.GetHeight()===h)return;wi.SetSize(w,h);wi.SetBboxChanged()}getSize(){const wi=map.get(this).GetWorldInfo();return[wi.GetWidth(),wi.GetHeight()]}get angle(){return map.get(this).GetWorldInfo().GetAngle()}set angle(a){a=C3.clampAngle(+a);const wi=map.get(this).GetWorldInfo();if(isNaN(a)||wi.GetAngle()===
a)return;wi.SetAngle(a);wi.SetBboxChanged()}get angleDegrees(){return C3.toDegrees(this.angle)}set angleDegrees(a){this.angle=C3.toRadians(a)}getBoundingBox(){return map.get(this).GetWorldInfo().GetBoundingBox().toDOMRect()}getBoundingQuad(){return map.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad()}isOnScreen(){return map.get(this).GetWorldInfo().IsInViewport2()}get isVisible(){return map.get(this).GetWorldInfo().IsVisible()}set isVisible(v){v=!!v;const inst=map.get(this);const wi=inst.GetWorldInfo();
if(wi.IsVisible()===v)return;wi.SetVisible(v);inst.GetRuntime().UpdateRender()}get opacity(){return map.get(this).GetWorldInfo().GetOpacity()}set opacity(o){o=C3.clamp(+o,0,1);const inst=map.get(this);const wi=inst.GetWorldInfo();if(isNaN(o)||wi.GetOpacity()===o)return;wi.SetOpacity(o);inst.GetRuntime().UpdateRender()}set colorRgb(arr){C3X.RequireArray(arr);if(arr.length<3)throw new Error("expected 3 elements");tempColor.setRgb(arr[0],arr[1],arr[2]);const inst=map.get(this);const wi=inst.GetWorldInfo();
if(wi.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor))return;wi.SetUnpremultipliedColor(tempColor);inst.GetRuntime().UpdateRender()}get colorRgb(){const c=map.get(this).GetWorldInfo().GetUnpremultipliedColor();return[c.getR(),c.getG(),c.getB()]}set blendMode(bm){C3X.RequireString(bm);const index=BLEND_MODE_TO_INDEX.get(bm);if(typeof index!=="number")throw new Error("invalid blend mode");const inst=map.get(this);const wi=inst.GetWorldInfo();wi.SetBlendMode(index);inst.GetRuntime().UpdateRender()}get blendMode(){return INDEX_TO_BLEND_MODE.get(map.get(this).GetWorldInfo().GetBlendMode())}moveToTop(){map.get(this).GetWorldInfo().ZOrderMoveToTop()}moveToBottom(){map.get(this).GetWorldInfo().ZOrderMoveToBottom()}moveToLayer(ilayer){C3X.RequireInstanceOf(ilayer,
ILayer);const inst=map.get(this);const layer=inst.GetRuntime()._UnwrapScriptInterface(ilayer);if(!layer)throw new Error("invalid layer");inst.GetWorldInfo().ZOrderMoveToLayer(layer)}moveAdjacentToInstance(other,isAfter){C3X.RequireInstanceOf(other,IWorldInstance);map.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(map.get(other),isAfter)}get zIndex(){return map.get(this).GetWorldInfo().GetZIndex()}get isCollisionEnabled(){return map.get(this).GetWorldInfo().IsCollisionEnabled()}set isCollisionEnabled(e){map.get(this).GetWorldInfo().SetCollisionEnabled(!!e)}containsPoint(x,
y){C3X.RequireNumber(x);C3X.RequireNumber(y);return map.get(this).GetWorldInfo().ContainsPoint(+x,+y)}testOverlap(worldInstance){C3X.RequireInstanceOf(worldInstance,IWorldInstance);const a=map.get(this);const b=map.get(worldInstance);return a.GetRuntime().GetCollisionEngine().TestOverlap(a,b)}testOverlapSolid(){const inst=map.get(this);const overlapInst=inst.GetRuntime().GetCollisionEngine().TestOverlapSolid(inst);return overlapInst?overlapInst.GetInterfaceClass():null}getParent(){const parent=map.get(this).GetParent();
return parent?parent.GetInterfaceClass():null}getTopParent(){const parent=map.get(this).GetTopParent();return parent?parent.GetInterfaceClass():null}*parents(){for(const parent of map.get(this).parents())yield parent.GetInterfaceClass()}getChildCount(){return map.get(this).GetChildCount()}getChildAt(index){const child=map.get(this).GetChildAt(index);return child?child.GetInterfaceClass():null}*children(){for(const child of map.get(this).children())yield child.GetInterfaceClass()}*allChildren(){for(const child of map.get(this).allChildren())yield child.GetInterfaceClass()}addChild(ichild,
opts){C3X.RequireInstanceOf(ichild,IWorldInstance);C3X.RequireOptionalObject(opts);if(!opts)opts={};const inst=map.get(this);const child=map.get(ichild);inst.AddChild(child,opts)}removeChild(ichild){C3X.RequireInstanceOf(ichild,IWorldInstance);const inst=map.get(this);const child=map.get(ichild);inst.RemoveChild(child)}removeFromParent(){const inst=map.get(this);if(!inst.HasParent())return;const parent=inst.GetParent();parent.RemoveChild(inst)}createMesh(hsize,vsize){C3X.RequireFiniteNumber(hsize);
C3X.RequireFiniteNumber(vsize);map.get(this).GetWorldInfo().CreateMesh(hsize,vsize)}releaseMesh(){const wi=map.get(this).GetWorldInfo();wi.ReleaseMesh();wi.SetBboxChanged()}setMeshPoint(col,row,opts){C3X.RequireFiniteNumber(col);C3X.RequireFiniteNumber(row);C3X.RequireObject(opts);const wi=map.get(this).GetWorldInfo();if(wi.SetMeshPoint(col,row,opts))wi.SetBboxChanged()}getMeshSize(){const wi=map.get(this).GetWorldInfo();if(!wi.HasMesh())return[0,0];const sourceMesh=wi.GetSourceMesh();return[sourceMesh.GetHSize(),
sourceMesh.GetVSize()]}}}self.IWorldInstance=MakeIWorldInstanceClass(self.IInstance);self.IWorldInstanceSDKBase=MakeIWorldInstanceClass(self.ISDKInstanceBase);

}

// interfaces/objects/IDOMInstance.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;self.IDOMInstance=class IDOMInstance extends self.IWorldInstance{constructor(){super();map.set(this,self.IInstance._GetInitInst())}getElement(){return map.get(this).GetSdkInstance()._GetElementInDOMMode()}focus(){map.get(this).GetSdkInstance().FocusElement()}blur(){map.get(this).GetSdkInstance().BlurElement()}setCssStyle(prop,val){C3X.RequireString(prop);map.get(this).GetSdkInstance().SetElementCSSStyle(prop,val)}};

}

// interfaces/objects/IBehaviorInstance.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const dispatchers=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();function GetDispatcher(ibehinst){let dispatcher=dispatchers.get(ibehinst);if(dispatcher)return dispatcher;dispatcher=C3.New(C3.Event.Dispatcher);dispatchers.set(ibehinst,dispatcher);return dispatcher}
self.IBehaviorInstance=class IBehaviorInstance{constructor(){const initBehInst=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,initBehInst);const descriptors={runtime:{value:initBehInst.GetRuntime().GetIRuntime(),writable:false},behavior:{value:initBehInst.GetBehavior().GetIBehavior(),writable:false},behaviorType:{value:initBehInst.GetBehaviorType().GetIBehaviorType(),writable:false}};Object.defineProperties(this,descriptors);initBehInst.GetRuntime()._MapScriptInterface(this,initBehInst)}static _GetInitInst(){return C3.AddonManager._GetInitObject()}get instance(){return map.get(this).GetObjectInstance().GetInterfaceClass()}_release(){const dispatcher=
dispatchers.get(this);if(dispatcher){dispatcher.Release();dispatchers.delete(this)}map.delete(this)}addEventListener(type,func,capture){C3X.RequireString(type);C3X.RequireFunction(func);GetDispatcher(this).addEventListener(type,func,capture)}removeEventListener(type,func,capture){C3X.RequireString(type);C3X.RequireFunction(func);GetDispatcher(this).removeEventListener(type,func,capture)}dispatchEvent(e){GetDispatcher(this).dispatchEvent(e)}};

}

// interfaces/objects/IBehaviorType.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const internalApiToken=C3._GetInternalAPIToken();self.IBehaviorType=class IBehaviorType{constructor(){const initBehType=C3.AddonManager._GetInitObject2(internalApiToken);const descriptors={runtime:{value:initBehType.GetRuntime().GetIRuntime(),writable:false},behavior:{value:initBehType.GetBehavior().GetIBehavior(),writable:false},name:{value:initBehType.GetName(),writable:false}};Object.defineProperties(this,descriptors)}};

}

// interfaces/objects/IBehavior.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.IBehavior=class IBehavior{constructor(){const behavior=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,behavior);const descriptors={runtime:{value:behavior.GetRuntime().GetIRuntime(),writable:false}};Object.defineProperties(this,descriptors)}getAllInstances(){return map.get(this).GetInstances().map(inst=>inst.GetInterfaceClass())}static getByConstructor(ctor){if(!ctor)return null;const behavior=C3.AddonManager.GetBehaviorByConstructorFunction(ctor);return behavior?behavior.GetIBehavior():
null}};

}

// interfaces/objects/IEffectInstance.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const tempColor=C3.New(C3.Color);
self.IEffectInstance=class IEffectInstance{constructor(effectList,index){map.set(this,effectList);const descriptors={index:{value:index,writable:false}};Object.defineProperties(this,descriptors)}get name(){const effectTypes=map.get(this).GetAllEffectTypes();return effectTypes[this.index].GetName()}get isActive(){return map.get(this).IsEffectIndexActive(this.index)}set isActive(a){a=!!a;const fxList=map.get(this);if(fxList.IsEffectIndexActive(this.index)===a)return;fxList.SetEffectIndexActive(this.index,
a);fxList.UpdateActiveEffects();fxList.GetRuntime().UpdateRender()}setParameter(i,v){C3X.RequireFiniteNumber(i);i=Math.floor(+i);const fxList=map.get(this);const oldValue=fxList.GetEffectParameter(this.index,i);if(oldValue===null)throw new RangeError("invalid index");if(oldValue instanceof C3.Color){if(!Array.isArray(v)||v.length<3)throw new TypeError("expected array with 3 elements");tempColor.setRgb(v[0],v[1],v[2]);v=tempColor}else if(typeof v!=="number")throw new TypeError("expected number");const didChange=
fxList.SetEffectParameter(this.index,i,v);if(didChange&&fxList.IsEffectIndexActive(this.index))fxList.GetRuntime().UpdateRender()}getParameter(i){C3X.RequireFiniteNumber(i);i=Math.floor(+i);const fxList=map.get(this);const ret=fxList.GetEffectParameter(this.index,i);if(ret===null)throw new RangeError("invalid index");if(ret instanceof C3.Color)return[ret.getR(),ret.getG(),ret.getB()];else return ret}};

}

// interfaces/objects/IAnimation.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;
self.IAnimation=class IAnimation{constructor(animationInfo){map.set(this,animationInfo);Object.defineProperties(this,{name:{value:animationInfo.GetName(),writable:false}})}get speed(){return map.get(this).GetSpeed()}get isLooping(){return map.get(this).IsLooping()}get repeatCount(){return map.get(this).GetRepeatCount()}get repeatTo(){return map.get(this).GetRepeatTo()}get isPingPong(){return map.get(this).IsPingPong()}get frameCount(){return map.get(this).GetFrameCount()}getFrames(){return map.get(this).GetFrames().map(f=>f.GetIAnimationFrame())}*frames(){for(const f of map.get(this).GetFrames())yield f.GetIAnimationFrame()}};

}

// interfaces/objects/IImageInfo.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;self.IImageInfo=class IImageInfo{constructor(imageInfo){map.set(this,imageInfo)}static _Unwrap(iImageInfo){return map.get(iImageInfo)}get width(){return map.get(this).GetWidth()}get height(){return map.get(this).GetHeight()}getSize(){const imageInfo=map.get(this);return[imageInfo.GetWidth(),imageInfo.GetHeight()]}getTexture(renderer){return renderer.getTextureForImageInfo(this)}getTexRect(){return map.get(this).GetTexRect().toDOMRect()}};

}

// interfaces/objects/IAnimationFrame.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;
self.IAnimationFrame=class IAnimationFrame extends self.IImageInfo{constructor(animationFrameInfo){super(animationFrameInfo.GetImageInfo());map.set(this,animationFrameInfo);Object.defineProperties(this,{duration:{value:animationFrameInfo.GetDuration(),writable:false},originX:{value:animationFrameInfo.GetOriginX(),writable:false},originY:{value:animationFrameInfo.GetOriginY(),writable:false}})}getOrigin(){const afi=map.get(this);return[afi.GetOriginX(),afi.GetOriginY()]}getImagePointCount(){return map.get(this).GetImagePointCount()}getImagePointX(nameOrIndex){return this.getImagePoint(nameOrIndex)[0]}getImagePointY(nameOrIndex){return this.getImagePoint(nameOrIndex)[1]}getImagePoint(nameOrIndex){const afi=
map.get(this);let ip=null;if(typeof nameOrIndex==="number")ip=afi.GetImagePointByIndex(Math.floor(nameOrIndex));else if(typeof nameOrIndex==="string")ip=afi.GetImagePointByName(nameOrIndex);else throw new TypeError("expected string or number");if(!ip)return this.getOrigin();return[ip.GetX(),ip.GetY()]}getPolyPointCount(){const poly=map.get(this).GetCollisionPoly();return poly?poly.pointCount():0}getPolyPointX(index){return this.getPolyPoint(index)[0]}getPolyPointY(index){return this.getPolyPoint(index)[1]}getPolyPoint(index){C3X.RequireFiniteNumber(index);
index=Math.floor(index);const poly=map.get(this).GetCollisionPoly();if(!poly||index<0||index>=poly.pointCount())return[0,0];const pointsArr=poly.pointsArr();const ptX=pointsArr[index*2];const ptY=pointsArr[index*2+1];return[ptX,ptY]}get tag(){return map.get(this).GetTag()}};

}

// interfaces/other/ITimelineStateBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;function GetTimelineState(iface){const timelineState=map.get(iface);if(timelineState.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return timelineState}
self.ITimelineStateBase=class ITimelineStateBase{constructor(timelineState){map.set(this,timelineState);timelineState.GetRuntime()._MapScriptInterface(this,timelineState)}pause(){GetTimelineState(this).Stop()}resume(){GetTimelineState(this).Resume()}stop(){GetTimelineState(this).Reset()}hasTags(tags){return GetTimelineState(this).HasTags(tags)}set time(t){C3X.RequireFiniteNumber(t);GetTimelineState(this).SetTime(t)}get time(){return GetTimelineState(this).GetTime()}set totalTime(t){C3X.RequireFiniteNumber(t);
GetTimelineState(this).SetTotalTime(t)}get totalTime(){return GetTimelineState(this).GetTotalTime()}set isLooping(l){GetTimelineState(this).SetLoop(!!l)}get isLooping(){return GetTimelineState(this).GetLoop()}set isPingPong(p){GetTimelineState(this).SetPingPong(!!p)}get isPingPong(){return GetTimelineState(this).GetPingPong()}set playbackRate(p){C3X.RequireFiniteNumber(p);GetTimelineState(this).SetPlaybackRate(p)}get playbackRate(){return GetTimelineState(this).GetPlaybackRate()}get progress(){const timelineState=
GetTimelineState(this);return timelineState.GetTime()/timelineState.GetTotalTime()}get tags(){return GetTimelineState(this).GetTags()}get finished(){return GetTimelineState(this).GetPlayPromise()}get isPlaying(){return GetTimelineState(this).IsPlaying()}get isPaused(){return GetTimelineState(this).IsPaused()}get isReleased(){return map.get(this).IsReleased()}};

}

// interfaces/other/ITimelineState.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;let easeToIndexFunc=null;function GetTimelineState(iface){const timelineState=map.get(iface);if(timelineState.IsReleased())throw new Error("timeline was released and is no longer valid");return timelineState}
self.ITimelineState=class ITimelineState extends self.ITimelineStateBase{constructor(timelineState){super(timelineState);map.set(this,timelineState);const descriptors={name:{value:timelineState.GetName(),writable:false}};Object.defineProperties(this,descriptors)}};

}

// interfaces/other/ITweenState.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const behInstMap=new WeakMap;let easeToIndexFunc=null;function GetTweenState(iface){const tweenState=map.get(iface);if(tweenState.IsReleased())throw new Error("tween was released and is no longer valid");return tweenState}
self.ITweenState=class ITweenState extends self.ITimelineStateBase{constructor(tweenState,behInst,opts){super(tweenState);if(!easeToIndexFunc)easeToIndexFunc=opts.easeToIndexFunc;map.set(this,tweenState);if(behInst)behInstMap.set(this,behInst)}stop(){const tweenState=GetTweenState(this);const behInst=behInstMap.get(this);behInst.ReleaseTween(tweenState)}setEase(easeName){C3X.RequireString(easeName);const ease=self.Ease.GetEaseFromIndex(easeToIndexFunc(easeName));GetTweenState(this).SetEase(ease)}get instance(){const inst=
GetTweenState(this).GetInstance();return inst?inst.GetInterfaceClass():null}get isDestroyOnComplete(){return GetTweenState(this).GetDestroyInstanceOnComplete()}set isDestroyOnComplete(d){GetTweenState(this).SetDestroyInstanceOnComplete(!!d)}get value(){const tweenState=GetTweenState(this);if(tweenState.GetId()!=="value")throw new Error("not a value tween");return tweenState.GetPropertyTrack("value").GetSourceAdapterValue()}};

}

// interfaces/sdk/ISDKPluginBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;self.ISDKPluginBase=class ISDKPluginBase extends self.IPlugin{constructor(){super()}};

}

// interfaces/sdk/ISDKDOMPluginBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.ISDKDOMPluginBase=class ISDKDOMPluginBase extends self.ISDKPluginBase{constructor(opts){super();map.set(this,C3.AddonManager._GetInitObject2(internalApiToken));if(!opts?.domComponentId)throw new Error(`no DOM component ID specified`);this._p_domComponentId=opts.domComponentId;this._p_nextElementId=0;this._p_instMap=new Map;this._addElementMessageHandler("elem-focused",inst=>inst._onElemFocused());this._addElementMessageHandler("elem-blurred",inst=>{if(inst)inst._onElemBlurred()})}_addElement(inst){const elementId=
this._p_nextElementId++;this._p_instMap.set(elementId,inst);return elementId}_removeElement(elementId){this._p_instMap.delete(elementId)}_addElementMessageHandler(handler,func){const runtime=map.get(this).GetRuntime();runtime.AddDOMComponentMessageHandler(this._p_domComponentId,handler,e=>{const inst=this._p_instMap.get(e["elementId"]);func(inst,e)})}_addElementMessageHandlers(arr){C3X.RequireArray(arr);for(const [handler,func]of arr)this._addElementMessageHandlers(handler,func)}};

}

// interfaces/sdk/ISDKObjectTypeBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();self.ISDKObjectTypeBase=class ISDKObjectTypeBase extends self.IObjectClass{constructor(){super();const objectClass=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,objectClass)}_onCreate(){}getImageInfo(){return map.get(this).GetImageInfo().GetIImageInfo()}_loadTextures(renderer){}_releaseTextures(renderer){}_onDynamicTextureLoadComplete(){}_preloadTexturesWithInstances(renderer){}};

}

// interfaces/sdk/ISDKWorldInstanceBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.ISDKWorldInstanceBase=class ISDKWorldInstanceBase extends self.IWorldInstanceSDKBase{constructor(opts){super(opts);map.set(this,C3.AddonManager._GetInitObject2(internalApiToken));this._p_renderercontextlost_handler=null;this._p_renderercontextrestored_handler=null}_release(){super._release();if(this._p_renderercontextlost_handler){const dispatcher=map.get(this).GetRuntime().Dispatcher();dispatcher.removeEventListener("renderercontextlost",this._p_renderercontextlost_handler);dispatcher.removeEventListener("renderercontextrestored",
this._p_renderercontextrestored_handler);this._p_renderercontextlost_handler=null;this._p_renderercontextrestored_handler=null}map.delete(this)}_handleRendererContextLoss(){if(this._p_renderercontextlost_handler)return;this._p_renderercontextlost_handler=()=>this._onRendererContextLost();this._p_renderercontextrestored_handler=()=>this._onRendererContextRestored();const dispatcher=map.get(this).GetRuntime().Dispatcher();dispatcher.addEventListener("renderercontextlost",this._p_renderercontextlost_handler);
dispatcher.addEventListener("renderercontextrestored",this._p_renderercontextrestored_handler)}_onRendererContextLost(){}_onRendererContextRestored(){}_draw(renderer){}};

}

// interfaces/sdk/ISDKDOMInstanceBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const tempRect=C3.New(C3.Rect);const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.ISDKDOMInstanceBase=class ISDKDOMInstanceBase extends self.ISDKWorldInstanceBase{constructor(opts){if(!opts?.domComponentId)throw new Error(`no DOM component ID specified`);super(opts);const inst=C3.AddonManager._GetInitObject2(internalApiToken);map.set(this,inst);this._p_elementId=this.plugin._addElement(this);this._p_isElementShowing=true;this._p_elemHasFocus=false;this._p_autoFontSize=false;this._p_autoFontSizeOffset=-.2;this._p_lastRect=C3.New(C3.Rect,0,0,-1,-1);const canvasManager=inst.GetRuntime().GetCanvasManager();
this._p_lastWindowWidth=canvasManager.GetLastWidth();this._p_lastWindowHeight=canvasManager.GetLastHeight();this._p_lastHTMLIndex=-1;this._p_lastHTMLZIndex=-1;this._p_isPendingUpdateState=false;this._setTicking(true)}_release(){super._release();this.plugin._removeElement(this._p_elementId);this._postToDOMElement("destroy");this._p_elementId=-1;map.delete(this)}_getElementInDOMMode(){const runtime=map.get(this).GetRuntime();if(runtime.IsInWorker())throw new Error("not valid in worker mode");return this._postToDOMElementMaybeSync("get-element")}_postToDOMElement(handler,
data){if(!data)data={};data["elementId"]=this._p_elementId;this._postToDOM(handler,data)}_postToDOMElementMaybeSync(handler,data){if(!data)data={};data["elementId"]=this._p_elementId;return this._postToDOMMaybeSync(handler,data)}_postToDOMElementAsync(handler,data){if(!data)data={};data["elementId"]=this._p_elementId;return this._postToDOMAsync(handler,data)}_createElement(data){if(!data)data={};const wi=map.get(this).GetWorldInfo();data["elementId"]=this._p_elementId;data["isVisible"]=wi.IsVisible();
data["htmlIndex"]=wi.GetLayer().GetHTMLIndex();data["htmlZIndex"]=wi.GetHTMLZIndex();Object.assign(data,this._getElementState());this._p_isElementShowing=!!data["isVisible"];this._postToDOMMaybeSync("create",data);this._updatePosition(true)}setElementVisible(v){v=!!v;if(this._p_isElementShowing===v)return;this._p_isElementShowing=v;this._postToDOMElement("set-visible",{"isVisible":v})}_tick(){this._updatePosition(false)}_shouldPreserveElement(){const runtime=map.get(this).GetRuntime();const fullscreenMode=
runtime.GetCanvasManager().GetFullscreenMode();return C3.Platform.OS==="Android"&&(fullscreenMode==="scale-inner"||fullscreenMode==="scale-outer"||fullscreenMode==="crop")}_updatePosition(first){const inst=map.get(this);if(inst.IsDestroyed())return;const wi=inst.GetWorldInfo();const layer=wi.GetLayer();const bbox=wi.GetBoundingBox();let [cleft,ctop]=layer.LayerToCanvasCss(bbox.getLeft(),bbox.getTop());let [cright,cbottom]=layer.LayerToCanvasCss(bbox.getRight(),bbox.getBottom());const canvasManager=
inst.GetRuntime().GetCanvasManager();const rightEdge=canvasManager.GetCssWidth();const bottomEdge=canvasManager.GetCssHeight();if(!wi.IsVisible()||!layer.IsVisible()){this.setElementVisible(false);return}if(!this._shouldPreserveElement())if(cright<=0||cbottom<=0||cleft>=rightEdge||ctop>=bottomEdge){this.setElementVisible(false);return}tempRect.set(cleft,ctop,cright,cbottom);const curWinWidth=canvasManager.GetLastWidth();const curWinHeight=canvasManager.GetLastHeight();const curHTMLIndex=layer.GetHTMLIndex();
const curHTMLZIndex=wi.GetHTMLZIndex();if(!first&&tempRect.equals(this._p_lastRect)&&this._p_lastWindowWidth===curWinWidth&&this._p_lastWindowHeight===curWinHeight&&this._p_lastHTMLIndex===curHTMLIndex&&this._p_lastHTMLZIndex===curHTMLZIndex){this.setElementVisible(true);return}this._p_lastRect.copy(tempRect);this._p_lastWindowWidth=curWinWidth;this._p_lastWindowHeight=curWinHeight;this._p_lastHTMLIndex=curHTMLIndex;this._p_lastHTMLZIndex=curHTMLZIndex;this.setElementVisible(true);let fontSize=null;
if(this._p_autoFontSize)fontSize=layer.GetDisplayScale()+this._p_autoFontSizeOffset;this._postToDOMElement("update-position",{"left":Math.round(this._p_lastRect.getLeft()),"top":Math.round(this._p_lastRect.getTop()),"width":Math.round(this._p_lastRect.width()),"height":Math.round(this._p_lastRect.height()),"htmlIndex":curHTMLIndex,"htmlZIndex":curHTMLZIndex,"fontSize":fontSize})}focusElement(){this._postToDOMElementMaybeSync("focus",{"focus":true})}blurElement(){this._postToDOMElementMaybeSync("focus",
{"focus":false})}_onElemFocused(){this._p_elemHasFocus=true}_onElemBlurred(){this._p_elemHasFocus=false}isElementFocused(){return this._p_elemHasFocus}setElementCSSStyle(prop,val){this.postToDOMElement("set-css-style",{"prop":C3.CSSToCamelCase(prop),"val":val})}setElementAttribute(attribName,value){this.postToDOMElement("set-attribute",{"name":attribName,"val":value})}removeElementAttribute(attribName){this.postToDOMElement("remove-attribute",{"name":attribName})}_updateElementState(){if(this._p_isPendingUpdateState)return;
this._p_isPendingUpdateState=true;Promise.resolve().then(()=>{this._p_isPendingUpdateState=false;this._postToDOMElement("update-state",this._getElementState())})}_getElementState(){}_getElementId(){return this._p_elementId}};

}

// interfaces/sdk/ISDKBehaviorBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;self.ISDKBehaviorBase=class ISDKBehaviorBase extends self.IBehavior{constructor(){super()}};

}

// interfaces/sdk/ISDKBehaviorTypeBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;self.ISDKBehaviorTypeBase=class ISDKBehaviorTypeBase extends globalThis.IBehaviorType{constructor(){super()}_onCreate(){}};

}

// interfaces/sdk/ISDKBehaviorInstanceBase.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const internalApiToken=C3._GetInternalAPIToken();
self.ISDKBehaviorInstanceBase=class ISDKBehaviorInstanceBase extends self.IBehaviorInstance{constructor(){super();map.set(this,C3.AddonManager._GetInitObject2(internalApiToken));this._p_isTicking=false;this._p_isTicking2=false;this._p_isPostTicking=false}_release(){super._release();this._setTicking(false);this._setTicking2(false);this._setPostTicking(false);map.delete(this)}_getInitProperties(){return C3.AddonManager._GetInitProperties()}_postCreate(){}_trigger(method){const behInst=map.get(this);
behInst.GetRuntime().Trigger(method,behInst.GetObjectInstance(),behInst.GetBehaviorType())}_setTicking(isTicking){isTicking=!!isTicking;if(this._p_isTicking===isTicking)return;this._p_isTicking=isTicking;const runtime=map.get(this).GetRuntime();if(isTicking)runtime._AddBehInstToTick(this);else runtime._RemoveBehInstToTick(this)}_isTicking(){return this._p_isTicking}_tick(){}_setTicking2(isTicking){isTicking=!!isTicking;if(this._p_isTicking2===isTicking)return;this._p_isTicking2=isTicking;const runtime=
map.get(this).GetRuntime();if(isTicking)runtime._AddBehInstToTick2(this);else runtime._RemoveBehInstToTick2(this)}_isTicking2(){return this._p_isTicking2}_tick2(){}_setPostTicking(isTicking){isTicking=!!isTicking;if(this._p_isPostTicking===isTicking)return;this._p_isPostTicking=isTicking;const runtime=map.get(this).GetRuntime();if(isTicking)runtime._AddBehInstToPostTick(this);else runtime._RemoveBehInstToPostTick(this)}_isPostTicking(){return this._p_isPostTicking}_postTick(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(o){}};

}

// interfaces/gfx/IRenderer.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;let renderer=null;let runtime=null;
self.IRenderer=class IRenderer{constructor(runtime_,renderer_){runtime=runtime_;renderer=renderer_}setAlphaBlendMode(){renderer.SetAlphaBlend()}setBlendMode(blendMode){renderer.SetNamedBlendMode(blendMode)}setColorFillMode(){renderer.SetColorFillMode()}setTextureFillMode(){renderer.SetTextureFillMode()}setSmoothLineFillMode(){renderer.SetSmoothLineFillMode()}setColor(color){renderer.SetColorRgba(color[0],color[1],color[2],color[3])}setColorRgba(r,g,b,a){renderer.SetColorRgba(r,g,b,a)}resetColor(){renderer.ResetColor()}setOpacity(o){renderer.SetOpacity(o)}setCurrentZ(z){renderer.SetCurrentZ(z)}getCurrentZ(){renderer.GetCurrentZ()}rect(r){renderer.Rect2(r.left,
r.top,r.right,r.bottom)}rect2(l,t,r,b){renderer.Rect2(l,t,r,b)}quad(quad){renderer.Quad(C3.Quad.fromDOMQuad(quad))}quad2(tlx,tly,trx,try_,brx,bry,blx,bly){renderer.Quad2(tlx,tly,trx,try_,brx,bry,blx,bly)}quad3(quad,rect){renderer.Quad3(C3.Quad.fromDOMQuad(quad),C3.Rect.fromDOMRect(rect))}quad4(quad,texQuad){renderer.Quad4(C3.Quad.fromDOMQuad(quad),C3.Quad.fromDOMQuad(texQuad))}quad3D(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,rect){renderer.Quad3D(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,
blz,C3.Rect.fromDOMRect(rect))}quad3D2(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,texQuad){renderer.Quad3D2(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,C3.Quad.fromDOMQuad(texQuad))}drawMesh(posArr,uvArr,indexArr){renderer.DrawMesh(posArr,uvArr,indexArr)}convexPoly(pointsArray){renderer.ConvexPoly(pointsArray)}line(x1,y1,x2,y2){renderer.Line(x1,y1,x2,y2)}texturedLine(x1,y1,x2,y2,u,v){renderer.TexturedLine(x1,y1,x2,y2,u,v)}lineRect(l,t,r,b){renderer.LineRect(l,t,r,b)}lineRect2(rect){renderer.LineRect2(C3.Rect.fromDOMRect(rect))}lineQuad(quad){renderer.LineQuad(C3.Quad.fromDOMQuad(quad))}pushLineWidth(w){renderer.PushLineWidth(w)}popLineWidth(){renderer.PopLineWidth()}pushLineCap(lineCap){renderer.PushLineCap(lineCap)}popLineCap(){renderer.PopLineCap()}setTexture(itexture){C3X.RequireOptionalInstanceOf(itexture,
self.ITexture);const texture=itexture?runtime._UnwrapScriptInterface(itexture):null;renderer.SetTexture(texture)}loadTextureForImageInfo(iImageInfo,opts){const imageInfo=self.IImageInfo._Unwrap(iImageInfo);if(!imageInfo)throw new Error(`invalid IImageInfo`);return imageInfo.LoadStaticTexture(renderer,{wrapX:opts?.wrapX??"clamp-to-edge",wrapY:opts?.wrapY??"clamp-to-edge",sampling:opts?.sampling??"trilinear",mipMap:opts?.mipMap??true})}releaseTextureForImageInfo(iImageInfo){const imageInfo=self.IImageInfo._Unwrap(iImageInfo);
if(!imageInfo)throw new Error(`invalid IImageInfo`);imageInfo.ReleaseTexture()}getTextureForImageInfo(iImageInfo){const imageInfo=self.IImageInfo._Unwrap(iImageInfo);if(!imageInfo)throw new Error(`invalid IImageInfo`);const texture=imageInfo.GetTexture();return self.ITexture.GetInterface(runtime,texture)}createDynamicTexture(width,height,opts){C3X.RequireFiniteNumber(width);C3X.RequireFiniteNumber(height);const texture=renderer.CreateDynamicTexture(width,height,{wrapX:opts?.wrapX??"clamp-to-edge",
wrapY:opts?.wrapY??"clamp-to-edge",sampling:opts?.sampling??"trilinear",mipMap:opts?.mipMap??true});return self.ITexture.GetInterface(runtime,texture)}updateTexture(data,itexture,opts){C3X.RequireInstanceOf(itexture,self.ITexture);const texture=runtime._UnwrapScriptInterface(itexture);renderer.UpdateTexture(data,texture,{premultiplyAlpha:opts?.premultiplyAlpha??true})}deleteTexture(itexture){C3X.RequireInstanceOf(itexture,self.ITexture);const texture=runtime._UnwrapScriptInterface(itexture);renderer.DeleteTexture(texture)}createRendererText(){const rendererText=
renderer.CreateRendererText();return new self.IRendererText(runtime,rendererText)}setDeviceTransform(){runtime.GetCanvasManager().SetDeviceTransform(renderer)}setLayerTransform(iLayer){C3X.RequireInstanceOf(iLayer,globalThis.ILayer);const layer=runtime._UnwrapScriptInterface(iLayer);layer._SetTransform(renderer)}};

}

// interfaces/gfx/ITexture.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;const reverseMap=new WeakMap;
self.ITexture=class ITexture{constructor(runtime,texture){map.set(this,{runtime,texture});reverseMap.set(texture,this);runtime._MapScriptInterface(this,texture);Object.defineProperties(this,{width:{value:texture.GetWidth(),writable:false},height:{value:texture.GetHeight(),writable:false}})}static GetInterface(runtime,texture){if(!texture)return null;const existingInterface=reverseMap.get(texture);if(existingInterface)return existingInterface;return new self.ITexture(runtime,texture)}};

}

// interfaces/gfx/IRendererText.js
{
'use strict';const C3=self.C3;const C3X=self.C3X;const map=new WeakMap;function getActual(iface){return map.get(iface).rendererText}
self.IRendererText=class IRendererText{constructor(runtime,rendererText){map.set(this,{runtime,rendererText});runtime._MapScriptInterface(this,rendererText)}release(){getActual(this).Release()}set fontFace(name){C3X.RequireString(name);getActual(this).SetFontName(name)}get fontFace(){return getActual(this).GetFontName()}set sizePt(s){C3X.RequireFiniteNumber(s);getActual(this).SetFontSize(s)}get sizePt(){return getActual(this).GetFontSize()}set lineHeight(px){C3X.RequireFiniteNumber(px);getActual(this).SetLineHeight(px)}get lineHeight(){return getActual(this).GetLineHeight()}set isBold(b){getActual(this).SetBold(b)}get isBold(){return getActual(this).IsBold()}set isItalic(i){getActual(this).SetItalic(i)}get isItalic(){return getActual(this).IsItalic()}setColor(arr){C3X.RequireArray(arr);
this.setColorRgb(arr[0],arr[1],arr[2])}setColorRgb(r,g,b){getActual(this).SetColorRgb(r,g,b)}setCssColor(str){C3X.RequireString(str);getActual(this).SetColor(str)}set horizontalAlign(h){getActual(this).SetHorizontalAlignment(h)}get horizontalAlign(){return getActual(this).GetHorizontalAlignment()}set verticalAlign(v){getActual(this).SetVerticalAlignment(v)}get verticalAlign(){return getActual(this).GetVerticalAlignment()}set wordWrapMode(m){getActual(this).SetWordWrapMode(m)}get wordWrapMode(){return getActual(this).GetWordWrapMode()}set textDirection(d){getActual(this).SetTextDirection(d)}get textDirection(){return getActual(this).GetTextDirection()}set text(str){C3X.RequireString(str);
getActual(this).SetText(str)}get text(){return getActual(this).GetText()}setSize(cssWidth,cssHeight,zoomScale){C3X.RequireFiniteNumber(cssWidth);C3X.RequireFiniteNumber(cssHeight);C3X.RequireFiniteNumber(zoomScale);getActual(this).SetSize(cssWidth,cssHeight,zoomScale)}getTexture(){const {runtime,rendererText}=map.get(this);const texture=rendererText.GetTexture();return self.ITexture.GetInterface(runtime,texture)}getTexRect(){return getActual(this).GetTexRect().toDOMRect()}setTextureUpdateCallback(cb){C3X.RequireFunction(cb);
getActual(this).ontextureupdate=cb}releaseTexture(){getActual(this).ReleaseTexture()}get textWidth(){return getActual(this).GetTextWidth()}get textHeight(){return getActual(this).GetTextHeight()}};

}

// assets/assetManager.js
{
'use strict';const C3=self.C3;const VALID_LOAD_POLICIES=new Set(["local","remote"]);const EXT_TO_TYPE=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);function GetTypeFromFileExtension(filename){if(!filename)return"";const parts=filename.split(".");if(parts.length<2)return"";const ext=parts.at(-1).toLowerCase();return EXT_TO_TYPE.get(ext)||""}
function AddScript(url){return new Promise((resolve,reject)=>{const elem=document.createElement("script");elem.onload=resolve;elem.onerror=reject;elem.async=false;elem.type="module";elem.src=url;document.head.appendChild(elem)})}
C3.AssetManager=class AssetManager extends C3.DefendedBase{constructor(runtime,opts){super();const exportType=opts["exportType"];this._runtime=runtime;this._fileStructure="folders";this._localUrlBlobs=new Map;this._localBlobUrlCache=new Map;this._localBlobSWUrls=new Map;this._isCordova=exportType==="cordova";this._isiOSCordova=!!opts["isiOSCordova"];this._isFileProtocol=!!opts["isFileProtocol"];this._swClientId=opts["swClientId"];this._supportedAudioFormats=opts["supportedAudioFormats"]||{};this._audioFiles=
new Map;this._preloadSounds=false;this._mediaSubfolder="";this._fontsSubfolder="";this._iconsSubfolder="";const isRemoteLoadPolicy=exportType==="html5"||exportType==="scirra-arcade"||exportType==="instant-games";this._defaultLoadPolicy=isRemoteLoadPolicy?"remote":"local";this._assetsByUrl=new Map;this._webFonts=[];this._loadPromises=[];this._hasFinishedInitialLoad=false;this._totalAssetSizeToLoad=0;this._assetSizeLoaded=0;this._lastLoadProgress=0;this._hasHadErrorLoading=false;this._loadingRateLimiter=
C3.New(C3.RateLimiter,()=>this._FireLoadingProgressEvent(),50);this._localPromiseThrottle=C3.New(C3.PromiseThrottle,Math.max(C3.hardwareConcurrency,8));this._remotePromiseThrottle=C3.New(C3.PromiseThrottle,20);const localUrlBlobs=opts["previewImageBlobs"];if(localUrlBlobs){const projectFileBlobs=opts["previewProjectFileBlobs"];if(projectFileBlobs)Object.assign(localUrlBlobs,projectFileBlobs);const projectData=opts["projectData"];if(projectData)localUrlBlobs["data.json"]=projectData;for(const [url,
blob]of Object.entries(localUrlBlobs))this._localUrlBlobs.set(url,blob)}const localSWUrlMap=opts["previewProjectFileSWUrls"];if(localSWUrlMap)for(const [srcUrl,destUrl]of Object.entries(localSWUrlMap))this._localBlobSWUrls.set(srcUrl,destUrl);this._iAssetManager=new self.IAssetManager(this)}Release(){this._localUrlBlobs.clear();for(const url of this._localBlobUrlCache.values())if(url.startsWith("blob:"))URL.revokeObjectURL(url);this._localBlobUrlCache.clear();for(const asset of this._assetsByUrl.values())asset.Release();
this._assetsByUrl.clear();C3.clearArray(this._loadPromises);this._runtime=null}GetRuntime(){return this._runtime}_SetFileStructure(f){this._fileStructure=f;if(f==="flat"){const newMap=new Map;for(const [url,blob]of this._localUrlBlobs.entries())newMap.set(url.toLowerCase(),blob);this._localUrlBlobs=newMap}}GetFileStructure(){return this._fileStructure}_SetMediaSubfolder(folder){this._mediaSubfolder=folder}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(folder){this._fontsSubfolder=
folder}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(folder){this._iconsSubfolder=folder}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}_HasLocalUrlBlob(url){if(this._fileStructure==="flat")url=url.toLowerCase();return this._localUrlBlobs.has(url)}_GetLocalUrlBlob(url){if(this._fileStructure==="flat")url=url.toLowerCase();return this._localUrlBlobs.get(url)||null}GetLocalUrlAsBlobUrl(url){if(this._fileStructure==="flat")url=url.toLowerCase();
if(!this._HasLocalUrlBlob(url))return url;let ret=this._localBlobUrlCache.get(url);if(!ret){const blob=this._GetLocalUrlBlob(url);ret=URL.createObjectURL(blob);this._localBlobUrlCache.set(url,ret)}return ret}FetchBlob(url,loadPolicy){loadPolicy=loadPolicy||this._defaultLoadPolicy;const localBlob=this._GetLocalUrlBlob(url);if(localBlob)return Promise.resolve(localBlob);else if(C3.IsRelativeURL(url)){if(this._fileStructure==="flat")url=url.toLowerCase();if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlob(url);
else if(loadPolicy==="local")return this._localPromiseThrottle.Add(()=>C3.FetchBlob(url));else return this._remotePromiseThrottle.Add(()=>C3.FetchBlob(url))}else return C3.FetchBlob(url)}FetchArrayBuffer(url){const localBlob=this._GetLocalUrlBlob(url);if(localBlob)return C3.BlobToArrayBuffer(localBlob);else if(C3.IsRelativeURL(url)){if(this._fileStructure==="flat")url=url.toLowerCase();if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsArrayBuffer(url);else if(this._defaultLoadPolicy===
"local")return this._localPromiseThrottle.Add(()=>C3.FetchArrayBuffer(url));else return this._remotePromiseThrottle.Add(()=>C3.FetchArrayBuffer(url))}else return C3.FetchArrayBuffer(url)}FetchText(url){const localBlob=this._GetLocalUrlBlob(url);if(localBlob)return C3.BlobToString(localBlob);else if(C3.IsRelativeURL(url)){if(this._fileStructure==="flat")url=url.toLowerCase();if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsText(url);else if(this._defaultLoadPolicy==="local")return this._localPromiseThrottle.Add(()=>
C3.FetchText(url));else return this._remotePromiseThrottle.Add(()=>C3.FetchText(url))}else return C3.FetchText(url)}async FetchJson(url){const text=await this.FetchText(url);return JSON.parse(text)}_CordovaFetchLocalFileAs(filename,as_){if(this._fileStructure==="flat")filename=filename.toLowerCase();return this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{"filename":filename,"as":as_})}CordovaFetchLocalFileAsText(filename){return this._CordovaFetchLocalFileAs(filename,
"text")}async CordovaFetchLocalFileAsBlob(filename){const buffer=await this._CordovaFetchLocalFileAs(filename,"buffer");const type=GetTypeFromFileExtension(filename);return new Blob([buffer],{"type":type})}async CordovaFetchLocalFileAsBlobURL(filename){if(this._fileStructure==="flat")filename=filename.toLowerCase();let blobUrl=this._localBlobUrlCache.get(filename);if(blobUrl)return blobUrl;const blob=await this.CordovaFetchLocalFileAsBlob(filename);blobUrl=URL.createObjectURL(blob);this._localBlobUrlCache.set(filename,
blobUrl);return blobUrl}CordovaFetchLocalFileAsArrayBuffer(filename){return this._CordovaFetchLocalFileAs(filename,"buffer")}GetMediaFileUrl(filename){if(this._fileStructure==="flat")filename=filename.toLowerCase();filename=this._mediaSubfolder+filename;if(this._HasLocalUrlBlob(filename))return this.GetLocalUrlAsBlobUrl(filename);else return filename}GetProjectFileUrl(url){if(C3.IsAbsoluteURL(url))return Promise.resolve(url);else if(this._HasLocalUrlBlob(url))return Promise.resolve(this.GetLocalUrlAsBlobUrl(url));
else if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlobURL(url);else{if(this._fileStructure==="flat")url=url.toLowerCase();return Promise.resolve(url)}}GetProjectFileIframeUrl(url){if(C3.IsAbsoluteURL(url))return Promise.resolve(url);else{const queryIndex=url.indexOf("?");const queryStr=queryIndex===-1?"":url.substr(queryIndex);const urlNoSearch=queryIndex===-1?url:url.substr(0,queryIndex);if(this._HasLocalUrlBlob(urlNoSearch)){let localUrl=this._localBlobSWUrls.get(urlNoSearch)||
this.GetLocalUrlAsBlobUrl(urlNoSearch);if(!localUrl.startsWith("blob:")&&this._swClientId){const asUrl=new URL(localUrl);const params=new URLSearchParams(queryStr);params.set("__c3_client_id",this._swClientId);asUrl.search=params.toString();localUrl=asUrl.toString()}return Promise.resolve(localUrl)}else if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlobURL(urlNoSearch);else{if(this._fileStructure==="flat")url=url.toLowerCase();return Promise.resolve(url)}}}LoadProjectFileUrl(url){return this.GetProjectFileUrl(url)}LoadImage(opts){if(opts.loadPolicy&&
!VALID_LOAD_POLICIES.has(opts.loadPolicy))throw new Error("invalid load policy");let asset=this._assetsByUrl.get(opts.url);if(asset)return asset;asset=C3.New(C3.ImageAsset,this,{url:opts.url,size:opts.size||0,loadPolicy:opts.loadPolicy||this._defaultLoadPolicy});this._assetsByUrl.set(asset.GetURL(),asset);if(!this._hasFinishedInitialLoad){this._totalAssetSizeToLoad+=asset.GetSize();this._loadPromises.push(asset.Load().then(()=>this._AddLoadedSize(asset.GetSize())))}return asset}_ReleaseAsset(asset){this._assetsByUrl.delete(asset.GetURL())}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises);
this._lastLoadProgress=1}catch(err){console.error("Error loading: ",err);this._hasHadErrorLoading=true;this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=true}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(s){this._assetSizeLoaded+=s;this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){const event=C3.New(C3.Event,"loadingprogress");this._lastLoadProgress=C3.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1);event.progress=this._lastLoadProgress;
this._runtime.Dispatcher().dispatchEvent(event)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(arr){C3.shallowAssignArray(this._webFonts,arr);if(this._webFonts.length)this._loadPromises.push(this._LoadWebFonts())}async _LoadWebFonts(){const promises=[];const loadFontsForDOM=[];for(const [name,filename,size]of this._webFonts){this._totalAssetSizeToLoad+=size;promises.push(this._LoadWebFont(name,filename,loadFontsForDOM).then(()=>this._AddLoadedSize(size)))}await Promise.all(promises);
if(this._runtime.IsInWorker()&&loadFontsForDOM.length>0)await this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{"webfonts":loadFontsForDOM})}async _LoadWebFont(name,filename,loadFontsForDOM){try{const url=await this.GetProjectFileUrl(filename);if(C3.Platform.BrowserEngine==="Gecko")name=`'${name}'`;const fontFace=new FontFace(name,`url('${url}')`);if(this._runtime.IsInWorker())self.fonts.add(fontFace);else document.fonts.add(fontFace);await fontFace.load();if(this._runtime.IsInWorker())loadFontsForDOM.push({name,
url})}catch(err){console.warn(`[C3 runtime] Failed to load web font '${name}': `,err)}}IsAudioFormatSupported(type){return!!this._supportedAudioFormats[type]}_SetAudioFiles(arr,preloadSounds){this._preloadSounds=!!preloadSounds;for(const [fileName,projectFilesInfo,isMusic]of arr)this._audioFiles.set(fileName,{fileName,formats:projectFilesInfo.map(si=>({type:si[0],fileExtension:si[1],fullName:fileName+si[1],fileSize:si[2]})),isMusic})}GetPreferredAudioFile(namePart){if(this._fileStructure==="flat")namePart=
namePart.toLowerCase();const info=this._audioFiles.get(namePart);if(!info)return null;let webMOpusFile=null;for(const formatInfo of info.formats){if(!webMOpusFile&&formatInfo.type==="audio/webm; codecs=opus")webMOpusFile=formatInfo;if(this.IsAudioFormatSupported(formatInfo.type))return formatInfo}return webMOpusFile}GetProjectAudioFileUrl(namePart){const formatInfo=this.GetPreferredAudioFile(namePart);if(!formatInfo)return null;return{url:this.GetMediaFileUrl(formatInfo.fullName),type:formatInfo.type}}GetAudioToPreload(){if(this._preloadSounds){const ret=
[];for(const info of this._audioFiles.values()){if(info.isMusic)continue;const formatInfo=this.GetPreferredAudioFile(info.fileName);if(!formatInfo)continue;ret.push({originalUrl:info.fileName,url:this.GetMediaFileUrl(formatInfo.fullName),type:formatInfo.type,fileSize:formatInfo.fileSize})}return ret}else return[]}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...urls){const scriptUrls=await Promise.all(urls.map(url=>this.GetProjectFileUrl(url)));if(this._runtime.IsInWorker())if(urls.length===
1){const url=urls[0];await self.c3_import((C3.IsRelativeURL(url)?"./":"")+url)}else{const scriptStr=urls.map(url=>`import "${C3.IsRelativeURL(url)?"./":""}${url}";`).join("\n");const blobUrl=URL.createObjectURL(new Blob([scriptStr],{type:"application/javascript"}));await self.c3_import(blobUrl)}else await Promise.all(scriptUrls.map(url=>AddScript(url)))}async CompileWebAssembly(url){if(WebAssembly.compileStreaming){const fetchUrl=await this.GetProjectFileUrl(url);return await WebAssembly.compileStreaming(fetch(fetchUrl))}else{const arrayBuffer=
await C3.FetchArrayBuffer(url);return await WebAssembly.compile(arrayBuffer)}}async LoadStyleSheet(url){const fetchUrl=await this.GetProjectFileUrl(url);return await this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{"url":fetchUrl})}};

}

// assets/asset.js
{
'use strict';const C3=self.C3;
C3.Asset=class Asset extends C3.DefendedBase{constructor(assetManager,opts){super();this._assetManager=assetManager;this._runtime=assetManager.GetRuntime();this._url=opts.url||"";this._size=opts.size;this._loadPolicy=opts.loadPolicy;this._blob=opts.blob||null;this._isLoaded=!!this._blob;this._loadPromise=null}Release(){this._loadPromise=null;this._assetManager=null;this._runtime=null;this._blob=null}GetURL(){return this._url}GetSize(){return this._size}Load(){if(this._loadPolicy==="local"||this._blob){this._isLoaded=
true;return Promise.resolve()}if(this._loadPromise)return this._loadPromise;this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then(blob=>{this._isLoaded=true;this._loadPromise=null;this._blob=blob;return blob}).catch(err=>{console.error("Error loading resource: ",err);this._loadPromise=null});return this._loadPromise}IsLoaded(){return this._isLoaded}GetBlob(){if(this._blob)return Promise.resolve(this._blob);if(this._loadPromise)return this._loadPromise;return this._assetManager.FetchBlob(this._url,
this._loadPolicy)}};

}

// assets/imageAsset.js
{
'use strict';const C3=self.C3;const promiseThrottle=new C3.PromiseThrottle;const allImageAssets=new Set;
C3.ImageAsset=class ImageAsset extends C3.Asset{constructor(assetManager,opts){super(assetManager,opts);this._texturePromise=null;this._webglTexture=null;this._refCount=0;this._imageWidth=-1;this._imageHeight=-1;allImageAssets.add(this)}Release(){if(this._refCount!==0)throw new Error("released image asset which still has texture references");this._assetManager._ReleaseAsset(this);this._texturePromise=null;allImageAssets.delete(this);super.Release()}static OnRendererContextLost(){for(const imageAsset of allImageAssets){imageAsset._texturePromise=
null;imageAsset._webglTexture=null;imageAsset._refCount=0}}LoadStaticTexture(renderer,opts){opts=opts||{};this._refCount++;if(this._webglTexture)return Promise.resolve(this._webglTexture);if(this._texturePromise)return this._texturePromise;opts.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy();this._texturePromise=this._DoLoadStaticTexture(renderer,opts);return this._texturePromise}async _DoLoadStaticTexture(renderer,opts){try{const blob=await this.GetBlob();if(this._refCount===0)return null;
return await promiseThrottle.Add(async()=>{const texture=await renderer.CreateStaticTextureAsync(blob,opts);this._texturePromise=null;if(this._refCount===0){renderer.DeleteTexture(texture);return null}this._webglTexture=texture;this._imageWidth=texture.GetWidth();this._imageHeight=texture.GetHeight();return this._webglTexture})}catch(err){console.error("Failed to load texture: ",err);throw err;}}ReleaseTexture(){if(this._refCount<=0)throw new Error("texture released too many times");this._refCount--;
if(this._refCount===0&&this._webglTexture){const renderer=this._webglTexture.GetRenderer();renderer.DeleteTexture(this._webglTexture);this._webglTexture=null}}GetRefCount(){return this._refCount}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){const blob=await this.GetBlob();if(C3.Supports.ImageBitmap)return await createImageBitmap(blob);else return await C3.BlobToImage(blob)}};

}

// layouts/renderCell.js
{
'use strict';const C3=self.C3;const assert=self.assert;function SortByInstLastCachedZIndex(a,b){return a.GetWorldInfo()._GetLastCachedZIndex()-b.GetWorldInfo()._GetLastCachedZIndex()}
C3.RenderCell=class RenderCell extends C3.DefendedBase{constructor(grid,x,y){super();this._grid=grid;this._x=x;this._y=y;this._instances=[];this._isSorted=true;this._pendingRemoval=new Set;this._isAnyPendingRemoval=false}Release(){C3.clearArray(this._instances);this._pendingRemoval.clear();this._grid=null}Reset(){C3.clearArray(this._instances);this._isSorted=true;this._pendingRemoval.clear();this._isAnyPendingRemoval=false}SetChanged(){this._isSorted=false}IsEmpty(){if(!this._instances.length)return true;
if(this._instances.length>this._pendingRemoval.size)return false;this._FlushPending();return true}Insert(inst){if(this._pendingRemoval.has(inst)){this._pendingRemoval.delete(inst);if(this._pendingRemoval.size===0)this._isAnyPendingRemoval=false;return}this._instances.push(inst);this._isSorted=this._instances.length===1}Remove(inst){this._pendingRemoval.add(inst);this._isAnyPendingRemoval=true;if(this._pendingRemoval.size>=50)this._FlushPending()}_FlushPending(){if(!this._isAnyPendingRemoval)return;
if(this._instances.length===this._pendingRemoval.size){this.Reset();return}C3.arrayRemoveAllInSet(this._instances,this._pendingRemoval);this._pendingRemoval.clear();this._isAnyPendingRemoval=false}_EnsureSorted(){if(this._isSorted)return;this._instances.sort(SortByInstLastCachedZIndex);this._isSorted=true}Dump(result){this._FlushPending();this._EnsureSorted();if(this._instances.length)result.push(this._instances)}};

}

// layouts/renderGrid.js
{
'use strict';const C3=self.C3;
C3.RenderGrid=class RenderGrid extends C3.DefendedBase{constructor(cellWidth,cellHeight){super();this._cellWidth=cellWidth;this._cellHeight=cellHeight;this._cells=C3.New(C3.PairMap)}Release(){this._cells.Release();this._cells=null}GetCell(x,y,createIfMissing){let ret=this._cells.Get(x,y);if(ret)return ret;else if(createIfMissing){ret=C3.New(C3.RenderCell,this,x,y);this._cells.Set(x,y,ret);return ret}else return null}XToCell(x){return Math.floor(x/this._cellWidth)}YToCell(y){return Math.floor(y/this._cellHeight)}Update(inst,
oldRange,newRange){if(oldRange)for(let x=oldRange.getLeft(),lenx=oldRange.getRight();x<=lenx;++x)for(let y=oldRange.getTop(),leny=oldRange.getBottom();y<=leny;++y){if(newRange&&newRange.containsPoint(x,y))continue;const cell=this.GetCell(x,y,false);if(!cell)continue;cell.Remove(inst);if(cell.IsEmpty())this._cells.Delete(x,y)}if(newRange)for(let x=newRange.getLeft(),lenx=newRange.getRight();x<=lenx;++x)for(let y=newRange.getTop(),leny=newRange.getBottom();y<=leny;++y){if(oldRange&&oldRange.containsPoint(x,
y))continue;this.GetCell(x,y,true).Insert(inst)}}QueryRange(rc,result){let x=this.XToCell(rc.getLeft());const ystart=this.YToCell(rc.getTop());const lenx=this.XToCell(rc.getRight());const leny=this.YToCell(rc.getBottom());for(;x<=lenx;++x)for(let y=ystart;y<=leny;++y){const cell=this.GetCell(x,y,false);if(!cell)continue;cell.Dump(result)}}MarkRangeChanged(rc){let x=rc.getLeft();const ystart=rc.getTop();const lenx=rc.getRight();const leny=rc.getBottom();for(;x<=lenx;++x)for(let y=ystart;y<=leny;++y){const cell=
this.GetCell(x,y,false);if(!cell)continue;cell.SetChanged()}}};

}

// layouts/layer.js
{
'use strict';const C3=self.C3;const assert=self.assert;const tmpRect=new C3.Rect;const tmpQuad=new C3.Quad;const renderCellArr=[];const tmpDestRect=new C3.Rect;const tmpSrcRect=new C3.Rect;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const vec4=glMatrix.vec4;const mat4=glMatrix.mat4;const tempMat4=mat4.create();const tempVec3=vec3.create();const tempVec4=vec4.create();const camVector=vec3.create();const lookVector=vec3.create();const upVector=vec3.create();const tempVec2=C3.New(C3.Vector2);
const tempRect=C3.New(C3.Rect);function SortByInstLastCachedZIndex(a,b){return a.GetWorldInfo()._GetLastCachedZIndex()-b.GetWorldInfo()._GetLastCachedZIndex()}function SortByInstZElevation(a,b){return a.GetWorldInfo().GetZElevation()-b.GetWorldInfo().GetZElevation()}const tempInstanceList1=[];const tempInstanceList2=[];const tempInstancesByCameraDist=[];
const DEFAULT_LAYER_OPTIONS={name:"",sid:-1,isDynamic:false,isVisible:true,isInteractive:true,isHTMLElementsLayer:false,backgroundColor:[1,1,1,1],isTransparent:true,parallax:[1,1],opacity:1,isForceOwnTexture:false,renderAs3d:false,useCameraDistanceDrawOrder:false,useRenderCells:false,scaleRate:1,blendMode:0,zElevation:0,initialInstancesData:[],effectListData:[],subLayersData:[]};
C3.Layer=class Layer extends C3.DefendedBase{constructor(layout,parentLayer,opts){super();opts=Object.assign({},DEFAULT_LAYER_OPTIONS,opts);this._layout=layout;this._runtime=layout.GetRuntime();this._parentLayer=parentLayer;this._name=opts.name;this._index=-1;this._isHTMLElementsLayer=!!opts.isHTMLElementsLayer;this._htmlIndex=-1;this._sid=opts.sid;this._isDynamic=!!opts.isDynamic;this._isVisible=!!opts.isVisible;this._isInteractive=!!opts.isInteractive;this._backgroundColor=C3.New(C3.Color);this._backgroundColor.setFromJSON(opts.backgroundColor);
this._isTransparent=!!opts.isTransparent;this._parallaxX=opts.parallax[0];this._parallaxY=opts.parallax[1];this._color=C3.New(C3.Color,1,1,1,opts.opacity);this._premultipliedColor=C3.New(C3.Color);this._isForceOwnTexture=!!opts.isForceOwnTexture;this._renderAs3d=!!opts.renderAs3d;this._useCameraDistanceDrawOrder=!!opts.useCameraDistanceDrawOrder;this._useRenderCells=!!opts.useRenderCells;this._scaleRate=opts.scaleRate;this._blendMode=opts.blendMode;this._curRenderTarget=null;this._scale=1;this._zElevation=
opts.zElevation;this._angle=0;this._scrollX=0;this._scrollY=0;this._hasOwnScrollPosition=false;this._viewport=C3.New(C3.Rect);this._viewportZ0=C3.New(C3.Rect);this._viewport3D=C3.New(C3.Rect);this._isViewportChanged=true;this._projectionMatrix=mat4.create();this._isProjectionMatrixChanged=true;this._modelViewMatrix=mat4.create();this._isMVMatrixChanged=true;this._viewFrustum=C3.New(C3.Gfx.ViewFrustum);this._isViewFrustumChanged=true;this._startupInitialInstances=[];this._initialInstancesData=opts.initialInstancesData;
this._initialInstances=[];this._createdGlobalUids=[];this._initialUIDsToInstanceData=new Map;this._instances=[];this._zIndicesUpToDate=false;this._htmlZIndicesUpToDate=false;this._anyInstanceZElevated=false;const canvasManager=this._runtime.GetCanvasManager();this._effectList=C3.New(C3.EffectList,this,opts.effectListData);this._effectChain=C3.New(C3.Gfx.EffectChain,canvasManager.GetEffectChainManager(),{drawContent:(renderer,effectChain)=>{const layer=effectChain.GetContentObject();const renderSurface=
layer.GetRenderTarget();renderer.SetColor(layer.GetPremultipliedColor());renderer.DrawRenderTarget(renderSurface);renderer.InvalidateRenderTarget(renderSurface);canvasManager.ReleaseAdditionalRenderTarget(renderSurface)},getShaderParameters:index=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(index)});this._needsRebuildEffectChainSteps=true;this._wasDefaultColor=true;this._renderGrid=null;this._lastRenderList=[];this._isRenderListUpToDate=false;this._lastRenderCells=C3.New(C3.Rect,
0,0,-1,-1);this._curRenderCells=C3.New(C3.Rect,0,0,-1,-1);this._iLayer=new self.ILayer(this);this._UpdatePremultipliedColor();if(this.UsesRenderCells())this._renderGrid=C3.New(C3.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight());this._subLayers=opts.subLayersData.map(ld=>C3.Layer.CreateFromExportData(this._layout,this,ld))}_InitInitialInstances(){for(const instData of this._initialInstancesData){const objectClass=this._runtime.GetObjectClassByIndex(instData[1]);
this._layout._AddInitialObjectClass(objectClass);if(!objectClass.GetDefaultInstanceData()){objectClass.SetDefaultInstanceData(instData);objectClass._SetDefaultLayerIndex(this._index)}this._initialInstances.push(instData);this._initialUIDsToInstanceData.set(instData[2],instData)}C3.shallowAssignArray(this._startupInitialInstances,this._initialInstances);this._initialInstancesData=null}static CreateFromExportData(layout,parentLayer,data){return C3.New(C3.Layer,layout,parentLayer,{name:data[0],sid:data[2],
isVisible:data[3],isInteractive:data[13],isHTMLElementsLayer:data[19],backgroundColor:data[4].map(x=>x/255),isTransparent:data[5],parallax:[data[6],data[7]],opacity:data[8],isForceOwnTexture:data[9],renderAs3d:data[17],useCameraDistanceDrawOrder:data[18],useRenderCells:data[10],scaleRate:data[11],blendMode:data[12],zElevation:data[16],initialInstancesData:data[14],effectListData:data[15],subLayersData:data[20]})}Release(){for(const subLayer of this._subLayers)subLayer.Release();C3.clearArray(this._subLayers);
for(const inst of this._instances)this._runtime.DestroyInstance(inst);C3.clearArray(this._instances);this._effectList.Release();this._effectList=null;this._effectChain.Release();this._effectChain=null;this._iLayer=null;this._parentLayer=null;this._layout=null;this._runtime=null}GetInitialInstanceData(uid){return this._initialUIDsToInstanceData.get(uid)}CreateInitialInstances(createdInstances){const isFirstVisit=this._layout.IsFirstVisit();let k=0;const initialInstances=this._initialInstances;for(let i=
0,len=initialInstances.length;i<len;++i){const instData=initialInstances[i];const objectClass=this._runtime.GetObjectClassByIndex(instData[1]);let keep=true;if(!objectClass.HasPersistBehavior()||isFirstVisit){const inst=this._runtime.CreateInstanceFromData(instData,this,true);createdInstances.push(inst);if(objectClass.IsGlobal()){keep=false;this._createdGlobalUids.push(inst.GetUID())}}if(keep){initialInstances[k]=initialInstances[i];++k}}C3.truncateArray(initialInstances,k);this._runtime.FlushPendingInstances();
this.SetZIndicesChanged()}_AddInstance(inst,addToGrid){if(!inst.GetPlugin().IsWorldType())throw new Error("instance is not of world type");const wi=inst.GetWorldInfo();if(wi.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.push(inst);if(wi.GetZElevation()!==0)this._anyInstanceZElevated=true;if(addToGrid&&this.UsesRenderCells())inst.GetWorldInfo().SetBboxChanged();this.SetZIndicesChanged(inst)}_MaybeAddInstance(inst){if(this._instances.includes(inst))return;this._instances.push(inst);
if(inst.GetWorldInfo().GetZElevation()!==0)this._anyInstanceZElevated=true;this.SetZIndicesChanged(inst)}_PrependInstance(inst,addToGrid){const wi=inst.GetWorldInfo();if(wi.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.unshift(inst);if(wi.GetZElevation()!==0)this._anyInstanceZElevated=true;this.SetZIndicesChanged(inst);if(addToGrid&&this.UsesRenderCells())inst.GetWorldInfo().SetBboxChanged()}_RemoveInstance(inst,removeFromGrid){const index=this._instances.indexOf(inst);
if(index<0)return;if(removeFromGrid&&this.UsesRenderCells())inst.GetWorldInfo()._RemoveFromRenderCells();this._instances.splice(index,1);this.SetZIndicesChanged(inst);this._MaybeResetAnyInstanceZElevatedFlag()}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=true}_MaybeResetAnyInstanceZElevatedFlag(){if(this._instances.length===0)this._anyInstanceZElevated=false}_SortInstancesByLastCachedZIndex(isPersistMode){if(isPersistMode){const assignedZIndices=new Set;for(const inst of this._instances){const cachedZIndex=
inst.GetWorldInfo()._GetLastCachedZIndex();if(cachedZIndex>=0)assignedZIndices.add(cachedZIndex)}let index=-1;for(const inst of this._instances){const wi=inst.GetWorldInfo();if(wi._GetLastCachedZIndex()>=0)continue;++index;while(assignedZIndices.has(index))++index;wi._SetZIndex(index)}}this._instances.sort(SortByInstLastCachedZIndex)}_Start(){}_End(){for(const inst of this._instances)if(!inst.GetObjectClass().IsGlobal())this._runtime.DestroyInstance(inst);this._runtime.FlushPendingInstances();C3.clearArray(this._instances);
this._anyInstanceZElevated=false;this.SetZIndicesChanged()}RecreateInitialObjects(objectClass,rc,offsetX,offsetY,createHierarchy){const eventSheetManager=this._runtime.GetEventSheetManager();const allObjectClasses=this._runtime.GetAllObjectClasses();const isFamily=objectClass.IsFamily();const ret=[];for(const instData of this._initialInstances){const worldData=instData[0];const x=worldData[0];const y=worldData[1];if(!rc.containsPoint(x,y))continue;const objectType=allObjectClasses[instData[1]];if(objectType!==
objectClass)if(isFamily){if(!objectClass.FamilyHasMember(objectType))continue}else continue;let createOnLayer=this;const runningLayout=this._runtime.GetCurrentLayout();if(this.GetLayout()!==runningLayout){createOnLayer=runningLayout.GetLayerByName(this.GetName());if(!createOnLayer)createOnLayer=runningLayout.GetLayerByIndex(this.GetIndex())}const inst=this._runtime.CreateInstanceFromData(instData,createOnLayer,false,undefined,undefined,false,createHierarchy);createOnLayer.SortAndAddInstancesByZIndex(inst);
const wi=inst.GetWorldInfo();wi.OffsetXY(offsetX,offsetY);wi.SetBboxChanged();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);ret.push(inst)}return ret}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(i){this._index=i}GetIndex(){return this._index}_SetHTMLIndex(i){this._htmlIndex=i}GetHTMLIndex(){return this._htmlIndex}IsHTMLElementsLayer(){return this._isHTMLElementsLayer}SetIsHTMLElementsLayer(i){i=
!!i;if(this._isHTMLElementsLayer===i)return;this._isHTMLElementsLayer=i;this._layout._ReindexAndUpdateAllLayers();this._runtime.UpdateRender()}_GetSiblingIndex(){let ret=-1;const parentLayer=this.GetParentLayer();if(parentLayer)ret=parentLayer.GetSubLayers().indexOf(this);else ret=this.GetLayout()._GetRootLayers().indexOf(this);return ret}GetSID(){return this._sid}GetRuntime(){return this._runtime}IsDynamic(){return this._isDynamic}HasAnyDynamicParentLayer(){for(const parent of this.parentLayers())if(parent.IsDynamic())return true;
return false}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain}_MaybeRebuildEffectChainSteps(){const isDefaultColor=this.HasDefaultColor();if(!this._needsRebuildEffectChainSteps&&isDefaultColor===this._wasDefaultColor&&!this._effectChain.NeedsRebuild())return;const activeEffectTypes=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(activeEffectTypes.map(e=>
e.GetShaderProgram()),{indexMap:activeEffectTypes.map(e=>e.GetIndex()),forcePreDraw:!isDefaultColor,useFullSurface:true});this._needsRebuildEffectChainSteps=false;this._wasDefaultColor=isDefaultColor}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects();this._needsRebuildEffectChainSteps=true}UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=false}IsVisible(){for(const layer of this.selfAndParentLayers())if(!layer._IsVisibleFlagSet())return false;
return true}_IsVisibleFlagSet(){return this._isVisible}SetVisible(v){v=!!v;if(this._isVisible===v)return;this._isVisible=v;this._runtime.UpdateRender()}SetInteractive(i){this._isInteractive=!!i}IsInteractive(){return this._isInteractive}IsSelfAndParentsInteractive(){for(const layer of this.selfAndParentLayers())if(!layer.IsInteractive())return false;return true}SetOwnScrollPositionEnabled(e){e=!!e;if(this._hasOwnScrollPosition===e)return;this._hasOwnScrollPosition=e;if(e){const layout=this.GetLayout();
this._scrollX=layout.GetScrollX();this._scrollY=layout.GetScrollY()}this._SetMVMatrixChanged();this._runtime.UpdateRender()}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(x){const layout=this.GetLayout();const lbound=layout.GetScrollLeftBound();const rbound=layout.GetScrollRightBound();if(x>rbound)x=rbound;if(x<lbound)x=lbound;if(this._scrollX!==x){this._scrollX=x;if(this.IsOwnScrollPositionEnabled()){this._SetMVMatrixChanged();this._runtime.UpdateRender()}}}SetScrollY(y){const layout=
this.GetLayout();const ubound=layout.GetScrollTopBound();const bbound=layout.GetScrollBottomBound();if(y>bbound)y=bbound;if(y<ubound)y=ubound;if(this._scrollY!==y){this._scrollY=y;if(this.IsOwnScrollPositionEnabled()){this._SetMVMatrixChanged();this._runtime.UpdateRender()}}}GetScrollX(){if(this.IsOwnScrollPositionEnabled())return this._scrollX;else return this.GetLayout().GetScrollX()}GetScrollY(){if(this.IsOwnScrollPositionEnabled())return this._scrollY;else return this.GetLayout().GetScrollY()}GetViewport(){this._MaybeUpdateViewport();
return this._viewport}_GetViewportZ0(){this._MaybeUpdateViewport();return this._viewportZ0}GetViewport3D(){this._MaybeUpdateViewport();return this._viewport3D}_GetVanishingPoint(){const layout=this.GetLayout();return[layout.GetVanishingPointX(),layout.GetVanishingPointY()]}GetDefaultCameraZ(viewH){return this._runtime.GetDefaultCameraZ(viewH)}GetViewportForZ(z,outRect){const viewportZ0=this._GetViewportZ0();if(z===0)outRect.copy(viewportZ0);else{let midX=viewportZ0.midX();let midY=viewportZ0.midY();
const scaleFactor=this.Get2DScaleFactorToZ(z);const viewW=viewportZ0.width()/scaleFactor;const viewH=viewportZ0.height()/scaleFactor;const [vpX,vpY]=this._GetVanishingPoint();if(vpX!==.5||vpY!==.5){const cameraZ=this.GetCameraZ();const runtime=this._runtime;const zf=this.GetDefaultCameraZ()/cameraZ;let camOffX=(vpX-.5)*runtime.GetViewportWidth()/zf;let camOffY=(vpY-.5)*runtime.GetViewportHeight()/zf;const a=this.GetAngle();if(a!==0){tempVec2.set(camOffX,camOffY);tempVec2.rotate(a);camOffX=tempVec2.getX();
camOffY=tempVec2.getY()}const zProg=C3.unlerp(cameraZ,0,z);midX+=C3.lerp(camOffX,0,zProg);midY+=C3.lerp(camOffY,0,zProg)}outRect.set(midX-viewW/2,midY-viewH/2,midX+viewW/2,midY+viewH/2)}}GetOpacity(){return this._color.getA()}SetOpacity(o){o=C3.clamp(o,0,1);if(this._color.getA()===o)return;this._color.setA(o);this._UpdatePremultipliedColor();this._runtime.UpdateRender()}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color);this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,
1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(r){if(this._scaleRate===r)return;this._scaleRate=r;this._SetMVMatrixChanged();this._runtime.UpdateRender()}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(px,py){if(this._parallaxX===px&&this._parallaxY===py)return;this._parallaxX=px;this._parallaxY=py;this._SetMVMatrixChanged();this._runtime.UpdateRender();if(this._parallaxX!==1||this._parallaxY!==1)for(const inst of this._instances)inst.GetObjectClass()._SetAnyInstanceParallaxed(true)}SetParallaxX(px){this.SetParallax(px,
this.GetParallaxY())}SetParallaxY(py){this.SetParallax(this.GetParallaxX(),py)}SetZElevation(z){if(this._zElevation===z)return;this._zElevation=z;this._runtime.UpdateRender()}GetZElevation(){return this._zElevation}SetAngle(a){a=C3.clampAngle(a);if(this._angle===a)return;this._angle=a;this._SetMVMatrixChanged();this._runtime.UpdateRender()}GetAngle(){return C3.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return this._instances.length>0}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){if(this.RendersIn3DMode()&&
this._useCameraDistanceDrawOrder){C3.shallowAssignArray(tempInstancesByCameraDist,this._GetInstances());tempInstancesByCameraDist.sort((a,b)=>this._SortInstancesByCameraDistance(a,b));return tempInstancesByCameraDist}else return this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(arr){C3.appendArray(arr,this._GetInstancesInDrawOrder());for(const subLayer of this._subLayers)if(subLayer.IsVisible()&&subLayer.GetOpacity()>0)subLayer._AppendAllInstancesIncludingSubLayersInDrawOrder(arr)}_SortInstancesByCameraDistance(a,
b){const camVec=this.GetLayout().Get3DCameraPosition();const camX=camVec[0];const camY=camVec[1];const camZ=camVec[2];const wiA=a.GetWorldInfo();const wiB=b.GetWorldInfo();const dxA=wiA.GetX()-camX;const dyA=wiA.GetY()-camY;const dzA=wiA.GetZElevation()-camZ;const dxB=wiB.GetX()-camX;const dyB=wiB.GetY()-camY;const dzB=wiB.GetZElevation()-camZ;return dxB*dxB+dyB*dyB+dzB*dzB-(dxA*dxA+dyA*dyA+dzA*dzA)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(t){t=
!!t;if(this._isTransparent===t)return;this._isTransparent=t;this._runtime.UpdateRender()}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(f){f=!!f;if(this._isForceOwnTexture===f)return;this._isForceOwnTexture=f;this._runtime.UpdateRender()}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return false;
for(const subLayer of this._subLayers)if(!subLayer.SelfAndAllSubLayersHave3DCamera())return false;return true}SetBlendMode(bm){if(this._blendMode===bm)return;this._blendMode=bm;this._runtime.UpdateRender()}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}_SetParentLayer(layer){this._parentLayer=layer}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return this._subLayers.length>0}_AddSubLayer(layer,atTop=true){if(atTop)this._subLayers.push(layer);
else this._subLayers.unshift(layer)}_InsertSubLayer(layer,insertBy,isAbove){let i=this._subLayers.indexOf(insertBy);if(i===-1)throw new Error("cannot find layer to insert by");if(isAbove)++i;this._subLayers.splice(i,0,layer)}_RemoveSubLayer(layer){const i=this._subLayers.indexOf(layer);if(i===-1)throw new Error("cannot find layer to remove");this._subLayers.splice(i,1)}HasAnyVisibleSubLayer(){for(const subLayer of this._subLayers)if(subLayer.ShouldDraw())return true;return false}*selfAndAllSubLayers(){for(const subLayer of this._subLayers)yield*subLayer.selfAndAllSubLayers();
yield this}*parentLayers(){let parentLayer=this.GetParentLayer();while(parentLayer){yield parentLayer;parentLayer=parentLayer.GetParentLayer()}}*selfAndParentLayers(){yield this;yield*this.parentLayers()}HasParentLayer(layer){for(const p of this.parentLayers())if(p===layer)return true;return false}IsTransformCompatibleWith(otherLayer){return this===otherLayer||this._parallaxX===otherLayer._parallaxX&&this._parallaxY===otherLayer._parallaxY&&this._scale===otherLayer._scale&&this._scaleRate===otherLayer._scaleRate&&
this._angle===otherLayer._angle&&this.GetScrollX()===otherLayer.GetScrollX()&&this.GetScrollY()===otherLayer.GetScrollY()}SaveTransform(){return{"parallaxX":this.GetParallaxX(),"parallaxY":this.GetParallaxY(),"scale":this.GetOwnScale(),"scaleRate":this.GetScaleRate(),"angle":this.GetOwnAngle(),"hasOwnScroll":this.IsOwnScrollPositionEnabled(),"scrollX":this.GetScrollX(),"scrollY":this.GetScrollY()}}RestoreTransform(t){this.SetParallax(t["parallaxX"],t["parallaxY"]);this.SetOwnScale(t["scale"]);this.SetScaleRate(t["scaleRate"]);
this.SetAngle(t["angle"]);this.SetOwnScrollPositionEnabled(t["hasOwnScroll"]);this.SetScrollX(t["scrollX"]);this.SetScrollY(t["scrollY"]);this._MaybeUpdateViewport()}_RemoveAllInstancesInSet(s){if(s.size===0)return;const numRemoved=C3.arrayRemoveAllInSet(this._instances,s);if(numRemoved>0){this._MaybeResetAnyInstanceZElevatedFlag();this.SetZIndicesChanged()}}SetZIndicesChanged(inst){this._zIndicesUpToDate=false;this._isRenderListUpToDate=false;if(!inst||inst.GetObjectClass().GetPlugin().IsHTMLElementType())this._htmlZIndicesUpToDate=
false}_UpdateZIndices(){if(this._zIndicesUpToDate)return;this._instances.sort(SortByInstZElevation);if(this.UsesRenderCells())for(let i=0,len=this._instances.length;i<len;++i){const wi=this._instances[i].GetWorldInfo();wi._SetZIndex(i);this._renderGrid.MarkRangeChanged(wi.GetRenderCellRange())}else for(let i=0,len=this._instances.length;i<len;++i)this._instances[i].GetWorldInfo()._SetZIndex(i);this._zIndicesUpToDate=true}_UpdateHTMLZIndices(){if(this._htmlZIndicesUpToDate)return;const rootLayers=
this._layout.GetRootLayersForHTMLLayer(this.GetHTMLIndex());const allLayers=rootLayers.map(l=>[...l.selfAndAllSubLayers()]).flat();let htmlZIndex=0;for(const layer of allLayers){for(const inst of layer._GetInstances())if(inst.GetObjectClass().GetPlugin().IsHTMLElementType())inst.GetWorldInfo()._SetHTMLZIndex(htmlZIndex++);layer._SetHTMLZIndicesUpToDate()}}_SetHTMLZIndicesUpToDate(){this._htmlZIndicesUpToDate=true}MoveInstanceAdjacent(inst,other,isAfter){const instWi=inst.GetWorldInfo();const otherWi=
other.GetWorldInfo();if(instWi.GetLayer()!==this||otherWi.GetLayer()!==this)throw new Error("can't arrange Z order unless both objects on this layer");const myZ=instWi.GetZIndex();let insertZ=otherWi.GetZIndex();if(myZ===insertZ+(isAfter?1:-1))return false;C3.arrayRemove(this._instances,myZ);if(myZ<insertZ)insertZ--;if(isAfter)insertZ++;if(insertZ===this._instances.length)this._instances.push(inst);else this._instances.splice(insertZ,0,inst);this.SetZIndicesChanged(inst);return true}_MergeSortedZArrays(a,
b){const ret=[];let i=0,j=0,lena=a.length,lenb=b.length;while(i<lena&&j<lenb){const ai=a[i];const bj=b[j];if(ai.GetWorldInfo()._GetLastCachedZIndex()<bj.GetWorldInfo()._GetLastCachedZIndex()){ret.push(ai);++i}else{ret.push(bj);++j}}for(;i<lena;++i)ret.push(a[i]);for(;j<lenb;++j)ret.push(b[j]);return ret}_MergeAllSortedZArrays_pass(arr){const ret=[];const len=arr.length;for(let i=0;i<len-1;i+=2){const arr1=arr[i];const arr2=arr[i+1];ret.push(this._MergeSortedZArrays(arr1,arr2))}if(len%2===1)ret.push(arr[len-
1]);return ret}_MergeAllSortedZArrays(arr){while(arr.length>1)arr=this._MergeAllSortedZArrays_pass(arr);return arr[0]}_GetRenderCellInstancesToDraw(){this._UpdateZIndices();C3.clearArray(renderCellArr);this._renderGrid.QueryRange(this.GetViewport(),renderCellArr);if(!renderCellArr.length)return[];if(renderCellArr.length===1)return renderCellArr[0];return this._MergeAllSortedZArrays(renderCellArr)}ShouldDraw(){return this.IsVisible()&&this.GetOpacity()>0&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||
!this.IsTransparent())return true;for(const subLayer of this._subLayers)if(subLayer._DrawsAnyContentInSelfOrSubLayers())return true;return false}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||this.GetBlendMode()!==0||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return true;for(const subLayer of this._subLayers)if(subLayer.SelfOrAnySubLayerUsesOwnTexture())return true;return false}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(z){if(this._layout.IsOrthographicProjection())return 1;
else{const camZ=this.GetCameraZ();return camZ/(camZ-z)}}GetCameraZ(viewH){return this.GetDefaultCameraZ(viewH)/this.GetNormalScale()}_SetMVMatrixChanged(){this._isMVMatrixChanged=true;this._isViewFrustumChanged=true;this._isViewportChanged=true}_GetModelViewMatrix(renderer){if(this._isMVMatrixChanged){this._CalculateModelViewMatrix(renderer,this._modelViewMatrix,0,0,null);this._isMVMatrixChanged=false}return this._modelViewMatrix}GetCameraPosition(){if(this.Has3DCamera()){const camPos=this.GetLayout().Get3DCameraPosition();
return[camPos[0],camPos[1],camPos[2]]}else return this._Get2DCameraPosition()}_Get2DCameraPosition(offX=0,offY=0,viewH=0){const runtime=this._runtime;const layout=this.GetLayout();const parallaxOriginX=runtime.GetParallaxXOrigin();const parallaxOriginY=runtime.GetParallaxYOrigin();let scrollOriginX=(this.GetScrollX()-parallaxOriginX)*this._parallaxX+parallaxOriginX;let scrollOriginY=(this.GetScrollY()-parallaxOriginY)*this._parallaxY+parallaxOriginY;if(runtime.IsPixelRoundingEnabled()){scrollOriginX=
Math.round(scrollOriginX);scrollOriginY=Math.round(scrollOriginY)}let camX=scrollOriginX+offX;let camY=scrollOriginY+offY;const camZ=layout.IsOrthographicProjection()?this.GetDefaultCameraZ(viewH):this.GetCameraZ(viewH);const [vpX,vpY]=this._GetVanishingPoint();if(vpX!==.5||vpY!==.5){const zf=this.GetDefaultCameraZ(viewH)/camZ;let camOffX=(vpX-.5)*runtime.GetViewportWidth()/zf;let camOffY=(vpY-.5)*runtime.GetViewportHeight()/zf;const a=this.GetAngle();if(a!==0){tempVec2.set(camOffX,camOffY);tempVec2.rotate(a);
camOffX=tempVec2.getX();camOffY=tempVec2.getY()}camX+=camOffX;camY+=camOffY}return[camX,camY,camZ]}_CalculateModelViewMatrix(renderer,outMat,offX,offY,viewH){const runtime=this._runtime;const layout=this.GetLayout();if(this.Has3DCamera()){vec3.copy(camVector,layout.Get3DCameraPosition());vec3.copy(lookVector,layout.Get3DCameraLookAt());vec3.copy(upVector,layout.Get3DCameraUpVector());const parallaxOriginX=runtime.GetParallaxXOrigin();const parallaxOriginY=runtime.GetParallaxYOrigin();const lookDx=
lookVector[0]-camVector[0];const lookDy=lookVector[1]-camVector[1];const lookDz=lookVector[2]-camVector[2];camVector[0]=(camVector[0]-parallaxOriginX)*this._parallaxX+parallaxOriginX;camVector[1]=(camVector[1]-parallaxOriginY)*this._parallaxY+parallaxOriginY;camVector[2]*=Math.max(this._parallaxX,this._parallaxY);lookVector[0]=camVector[0]+lookDx;lookVector[1]=camVector[1]+lookDy;lookVector[2]=camVector[2]+lookDz}else{const [camX,camY,camZ]=this._Get2DCameraPosition(offX,offY,viewH);vec3.set(camVector,
camX,camY,camZ);vec3.set(lookVector,camX,camY,camZ-100);const a=this.GetAngle();if(a===0)vec3.set(upVector,0,1,0);else vec3.set(upVector,Math.sin(a),Math.cos(a),0)}renderer.CalculateLookAtModelView(outMat,camVector,lookVector,upVector,viewH||runtime.GetViewportHeight())}_SetProjectionMatrixChanged(){this._isProjectionMatrixChanged=true;this._isViewFrustumChanged=true;this._isViewportChanged=true}_GetProjectionMatrix(renderer){if(this._isProjectionMatrixChanged){this._CalculateProjectionMatrix(renderer);
this._isProjectionMatrixChanged=false}return this._projectionMatrix}_CalculateProjectionMatrix(renderer){const canvasManager=this._runtime.GetCanvasManager();const [vpX,vpY]=this._GetVanishingPoint();if(this._layout.IsOrthographicProjection())renderer.CalculateOrthographicMatrix(this._projectionMatrix,canvasManager.GetDrawWidth(),canvasManager.GetDrawHeight());else if(vpX===.5&&vpY===.5)mat4.copy(this._projectionMatrix,canvasManager.GetDefaultProjectionMatrix());else{const drawW=canvasManager.GetDrawWidth();
const drawH=canvasManager.GetDrawHeight();renderer.CalculatePerspectiveMatrix(this._projectionMatrix,drawW/drawH,vpX,vpY)}}_SetTransform(renderer,updateProjection=true,offX=0,offY=0,viewH=0){if(updateProjection)renderer.SetProjectionMatrix(this._GetProjectionMatrix(renderer));let modelViewMatrix=null;if(offX===0&&offY===0&&viewH===0)modelViewMatrix=this._GetModelViewMatrix(renderer);else{this._CalculateModelViewMatrix(renderer,tempMat4,offX,offY,viewH);modelViewMatrix=tempMat4}renderer.SetModelViewMatrix(modelViewMatrix)}PrepareForDraw(renderer){this._SetTransform(renderer);
renderer.SetBaseZ(this.GetZElevation())}_MaybeStartWebGLProfiling(renderer){let layerQuery=null;if(renderer.IsWebGL()&&this._runtime.IsGPUProfiling()){const timingsBuffer=this._runtime.GetCanvasManager().GetLayerTimingsBuffer(this);if(timingsBuffer){layerQuery=timingsBuffer.AddTimeElapsedQuery();renderer.StartQuery(layerQuery)}}return layerQuery}_MaybeStartWebGPUProfiling(renderer){if(renderer.IsWebGPU()&&this._runtime.IsGPUProfiling()){const timestampIndex=(this.GetIndex()+1)*2;renderer.StartMeasuringRenderPassTime(timestampIndex,
timestampIndex+1)}}Draw(renderer,destinationRenderTarget,isFirstToTarget){const canvasManager=this._runtime.GetCanvasManager();const useOwnTexture=this.UsesOwnTexture();let ownRenderTarget=null;const webglLayerQuery=this._MaybeStartWebGLProfiling(renderer);this._MaybeStartWebGPUProfiling(renderer);if(useOwnTexture){const rtOpts={sampling:this._runtime.GetSampling(),isSampled:true,canReadPixels:renderer.IsWebGPU()?this._runtime.UsesAnyBackgroundBlending():false};if(canvasManager.GetCurrentFullscreenScalingQuality()===
"low"){rtOpts.width=canvasManager.GetDrawWidth();rtOpts.height=canvasManager.GetDrawHeight()}ownRenderTarget=this._runtime.GetAdditionalRenderTarget(rtOpts);this._curRenderTarget=ownRenderTarget;renderer.SetRenderTarget(ownRenderTarget);if(this.IsTransparent())renderer.ClearRgba(0,0,0,0)}else{this._curRenderTarget=destinationRenderTarget;renderer.SetRenderTarget(destinationRenderTarget)}if(!this.IsTransparent())renderer.Clear(this._backgroundColor);this._layout._DrawLayerList(renderer,this._curRenderTarget,
this._subLayers,useOwnTexture&&this.IsTransparent());this._MaybeStartWebGPUProfiling(renderer);this._SetTransform(renderer);renderer.SetBaseZ(this.GetZElevation());renderer.SetDepthEnabled(this.RendersIn3DMode());if(this.GetNormalScale()>Number.EPSILON){this._UpdateZIndices();const useRenderCells=this.UsesRenderCells()&&this.GetZElevation()===0&&!this._anyInstanceZElevated;if(this.Has3DCamera())this._DrawInstances_3DCamera(renderer);else if(useRenderCells)this._DrawInstances_RenderCells(renderer);
else this._DrawInstances(renderer,this._GetInstancesInDrawOrder())}renderer.SetBaseZ(0);renderer.SetCurrentZ(0);if(useOwnTexture){renderer.SetDepthEnabled(false);this._DrawLayerOwnTextureToRenderTarget(renderer,ownRenderTarget,destinationRenderTarget,isFirstToTarget)}if(webglLayerQuery)renderer.EndQuery(webglLayerQuery);this._curRenderTarget=null}_DrawInstances(renderer,instances){const viewport=this.GetViewport();const renderTarget=this._curRenderTarget;const isOrthographic=this.GetLayout().IsOrthographicProjection();
const hasVanishingPointOutsideViewport=this.GetLayout().HasVanishingPointOutsideViewport();let lastInst=null;for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];if(inst===lastInst)continue;lastInst=inst;const wi=inst.GetWorldInfo();if(wi.IsVisible()&&wi.IsInViewport(viewport,hasVanishingPointOutsideViewport,isOrthographic))this._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget)}}_DrawInstances_3DCamera(renderer){const renderTarget=this._curRenderTarget;const viewFrustum=
this._GetViewFrustum();const coplanarInstances=tempInstanceList1;const postRenderInstances=tempInstanceList2;const instances=this._GetInstancesInDrawOrder();for(let i=0,len=instances.length;i<len;){const inst=instances[i];const wi=inst.GetWorldInfo();if(!wi.IsVisible()||!wi.IsInViewport3D(viewFrustum)){++i;continue}if(!inst.RendersToOwnZPlane()||wi.GetDepth()>0)postRenderInstances.push(inst);const startZ=inst.GetWorldInfo().GetTotalZElevation();coplanarInstances.push(inst);let endIndex=i+1;for(;endIndex<
len;++endIndex){const nextInst=instances[endIndex];const nextWi=nextInst.GetWorldInfo();if(!nextWi.IsVisible()||!nextWi.IsInViewport3D(viewFrustum))continue;if(nextWi.GetTotalZElevation()!==startZ)break;if(!nextInst.RendersToOwnZPlane()){postRenderInstances.push(nextInst);continue}if(nextWi.GetDepth()>0)postRenderInstances.push(nextInst);coplanarInstances.push(nextInst)}if(coplanarInstances.length===1&&!coplanarInstances[0].MustMitigateZFighting()){this._DrawInstanceMaybeWithEffects(inst,wi,renderer,
renderTarget);for(let j=0,lenj=postRenderInstances.length;j<lenj;++j){const postInst=postRenderInstances[j];if(postInst===inst)continue;const postWi=postInst.GetWorldInfo();const postWiLayer=postWi.GetLayer();postWiLayer._DrawInstanceMaybeWithEffects(postInst,postWi,renderer,renderTarget)}}else{this._DrawCoplanarInstances_3DCamera(renderer,coplanarInstances);for(let j=0,lenj=postRenderInstances.length;j<lenj;++j){const postInst=postRenderInstances[j];const postWi=postInst.GetWorldInfo();postWi._SetDrawNonBackFacesOnly(true);
this._DrawInstanceMaybeWithEffects(postInst,postWi,renderer,renderTarget);postWi._SetDrawNonBackFacesOnly(false)}}i=endIndex;C3.clearArray(coplanarInstances);C3.clearArray(postRenderInstances)}}_DrawCoplanarInstances_3DCamera(renderer,instances){const renderTarget=this._curRenderTarget;renderer.CoplanarStartStencilPass();for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];const wi=inst.GetWorldInfo();wi._SetDrawBackFaceOnly(true);this._DrawInstance(inst,wi,renderer)}renderer.CoplanarStartColorPass();
for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];const wi=inst.GetWorldInfo();this._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget);wi._SetDrawBackFaceOnly(false)}renderer.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(renderer){const renderGrid=this._renderGrid;const curRenderCells=this._curRenderCells;const lastRenderCells=this._lastRenderCells;const viewport=this.GetViewport();let instancesToDraw;curRenderCells.set(renderGrid.XToCell(viewport.getLeft()),
renderGrid.YToCell(viewport.getTop()),renderGrid.XToCell(viewport.getRight()),renderGrid.YToCell(viewport.getBottom()));if(!this._isRenderListUpToDate||!curRenderCells.equals(lastRenderCells)){instancesToDraw=this._GetRenderCellInstancesToDraw();this._isRenderListUpToDate=true;lastRenderCells.copy(curRenderCells)}else instancesToDraw=this._lastRenderList;this._DrawInstances(renderer,instancesToDraw);if(instancesToDraw!==this._lastRenderList)C3.shallowAssignArray(this._lastRenderList,instancesToDraw)}_DrawInstanceMaybeWithEffects(inst,
wi,renderer,renderTarget){if(wi.HasAnyActiveEffect())this._DrawInstanceWithEffectsAndRestore(inst,wi,renderer,renderTarget);else this._DrawInstance(inst,wi,renderer)}_DrawInstance(inst,wi,renderer){const wiStateGroup=wi.GetRendererStateGroup();if(renderer.GetCurrentStateGroup()!==wiStateGroup)wiStateGroup.Apply();inst.Draw(renderer)}_DrawInstanceWithEffectsAndRestore(inst,wi,renderer,renderTarget){if(this._DrawInstanceWithEffects(inst,wi,renderer,renderTarget,null))this._SetTransform(renderer)}_DrawInstanceWithEffects(inst,
wi,renderer,renderTarget,opts){const effectChain=wi.GetInstanceEffectList().GetEffectChain();effectChain.Render(renderer,renderTarget,{contentObject:inst,blendMode:wi.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),time:inst.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:wi.GetBoundingBox(),drawSurfaceRect:effectChain.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(wi),
drawContentHook:opts&&opts.drawContentHook,compositOffX:opts&&opts.compositOffX,compositOffY:opts&&opts.compositOffY,updateOwnProjection:opts&&opts.updateOwnProjection});renderer.SetBaseZ(this.GetZElevation());return effectChain.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(renderer,ownRenderTarget,destinationRenderTarget,isFirstToTarget){const activeEffectTypes=this._effectList.GetActiveEffectTypes();const runtime=this._runtime;if(activeEffectTypes.length===0){renderer.SetRenderTarget(destinationRenderTarget);
renderer.SetTextureFillMode();if(isFirstToTarget&&this._blendMode===0&&this.HasDefaultColor())renderer.CopyRenderTarget(ownRenderTarget);else{renderer.SetBlendMode(this._blendMode);renderer.SetColor(this._premultipliedColor);renderer.DrawRenderTarget(ownRenderTarget)}renderer.InvalidateRenderTarget(ownRenderTarget);runtime.ReleaseAdditionalRenderTarget(ownRenderTarget)}else this.GetEffectChain().Render(renderer,destinationRenderTarget,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:runtime.GetEffectDevicePixelRatioParam(),
layerScale:runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:true})}GetOwnScale(){return this._scale}SetOwnScale(s){if(this._scale===s)return;this._scale=s;this._layout.BoundScrolling();this._SetMVMatrixChanged();this._runtime.UpdateRender()}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*
this._layout.GetScale()-1)*this._scaleRate+1}_MaybeUpdateViewport(){if(!this._isViewportChanged)return;this._isViewportChanged=false;const parallaxOriginX=this._runtime.GetParallaxXOrigin();const parallaxOriginY=this._runtime.GetParallaxYOrigin();const scrollOriginX=(this.GetScrollX()-parallaxOriginX)*this._parallaxX+parallaxOriginX;const scrollOriginY=(this.GetScrollY()-parallaxOriginY)*this._parallaxY+parallaxOriginY;const normalScale=this.GetNormalScale();const scaledViewportWidth=this._runtime.GetViewportWidth()/
normalScale;const scaledViewportHeight=this._runtime.GetViewportHeight()/normalScale;let px=scrollOriginX-scaledViewportWidth/2;let py=scrollOriginY-scaledViewportHeight/2;if(this._runtime.IsPixelRoundingEnabled()){px=Math.round(px);py=Math.round(py)}const viewportZ0=this._viewportZ0;viewportZ0.set(px,py,px+scaledViewportWidth,py+scaledViewportHeight);const myAngle=this.GetAngle();if(myAngle!==0){tmpRect.copy(viewportZ0);tmpRect.offset(-viewportZ0.midX(),-viewportZ0.midY());tmpQuad.setFromRotatedRect(tmpRect,
myAngle);tmpQuad.getBoundingBox(tmpRect);tmpRect.offset(viewportZ0.midX(),viewportZ0.midY());viewportZ0.copy(tmpRect)}const layerZ=this._zElevation;this.GetViewportForZ(layerZ,this._viewport);if(this.Has3DCamera())this.CalculateViewport3D(layerZ,this._viewport3D);else this._viewport3D.copy(this._viewport)}CalculateViewport3D(z,outRect){const canvasManager=this._runtime.GetCanvasManager();const canvasWidth=canvasManager.GetCssWidth();const canvasHeight=canvasManager.GetCssHeight();const [tlx,tly]=
this.CanvasCssToLayer(0,0,z);const [trx,try_]=this.CanvasCssToLayer(canvasWidth,0,z);const [brx,bry]=this.CanvasCssToLayer(canvasWidth,canvasHeight,z);const [blx,bly]=this.CanvasCssToLayer(0,canvasHeight,z);let left=Math.min(tlx,trx,brx,blx);let top=Math.min(tly,try_,bry,bly);let right=Math.max(tlx,trx,brx,blx);let bottom=Math.max(tly,try_,bry,bly);if(!isFinite(left))left=-Infinity;if(!isFinite(top))top=-Infinity;if(!isFinite(right))right=Infinity;if(!isFinite(bottom))bottom=Infinity;outRect.set(left,
top,right,bottom)}CanvasCssToLayer(ptx,pty,z=0){return this._CanvasToLayer(ptx,pty,z,this.GetDisplayScale())}DrawSurfaceToLayer(ptx,pty,z=0){return this._CanvasToLayer(ptx,pty,z,this.GetRenderScale()*this.GetDevicePixelRatio())}_CanvasToLayer(canvasX,canvasY,zElevation,displayScale){const runtime=this._runtime;const renderer=runtime.GetRenderer();const normalScale=this.GetNormalScale();const scaledViewportWidth=runtime.GetViewportWidth()/normalScale;const scaledViewportHeight=runtime.GetViewportHeight()/
normalScale;const viewport=tempVec4;vec4.set(viewport,0,0,scaledViewportWidth,scaledViewportHeight);canvasX=canvasX/displayScale;canvasY=viewport[3]-canvasY/displayScale;const matP=this._GetProjectionMatrix(renderer);const matMV=this._GetModelViewMatrix(renderer);const objectCoord=tempVec3;const result=C3.Gfx.UnprojectScreenToWorldZ(canvasX,canvasY,zElevation,matMV,matP,viewport,objectCoord);if(result)return[objectCoord[0],objectCoord[1]];else return[NaN,NaN]}CanvasCssToLayer_DefaultTransform(ptx,
pty){const scale=this._scale;const scaleRate=this._scaleRate;const parallaxX=this._parallaxX;const parallaxY=this._parallaxY;const angle=this._angle;this._scale=1;this._scaleRate=1;this._parallaxX=1;this._parallaxY=1;this._angle=0;this._SetMVMatrixChanged();const ret=this.CanvasCssToLayer(ptx,pty);this._scale=scale;this._scaleRate=scaleRate;this._parallaxX=parallaxX;this._parallaxY=parallaxY;this._angle=angle;this._SetMVMatrixChanged();return ret}LayerToCanvasCss(ptx,pty,z=0){return this._LayerToCanvas(ptx,
pty,z,this.GetDisplayScale())}LayerToDrawSurface(ptx,pty,z=0){return this._LayerToCanvas(ptx,pty,z,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(layerX,layerY,zElevation,displayScale){const runtime=this._runtime;const renderer=runtime.GetRenderer();const normalScale=this.GetNormalScale();const scaledViewportWidth=runtime.GetViewportWidth()/normalScale;const scaledViewportHeight=runtime.GetViewportHeight()/normalScale;const viewport=tempVec4;vec4.set(viewport,0,0,scaledViewportWidth,
scaledViewportHeight);const matP=this._GetProjectionMatrix(renderer);const matMV=this._GetModelViewMatrix(renderer);const windowCoord=tempVec3;const result=C3.Gfx.Project(layerX,layerY,zElevation,matMV,matP,viewport,windowCoord);if(result)return[windowCoord[0]*displayScale,(viewport[3]-windowCoord[1])*displayScale];else return[NaN,NaN]}_GetLayerToDrawSurfaceScale(size,zElevation){size*=this.GetRenderScale()*this.GetDevicePixelRatio();if(zElevation!==0)size*=this.Get2DScaleFactorToZ(zElevation);return size}_InstanceBoxToDrawSurface(wi){const bbox=
wi.GetBoundingBox();const z=wi.GetTotalZElevation();const depth=wi.GetDepth();const topZ=z+depth;const bbLeft=bbox.getLeft();const bbTop=bbox.getTop();const bbRight=bbox.getRight();const bbBottom=bbox.getBottom();if(this.Has3DCamera()){if(this._IsPointBehindNearPlane(bbLeft,bbTop,z)||this._IsPointBehindNearPlane(bbRight,bbTop,z)||this._IsPointBehindNearPlane(bbRight,bbBottom,z)||this._IsPointBehindNearPlane(bbLeft,bbBottom,z))return null;if(depth>0)if(this._IsPointBehindNearPlane(bbLeft,bbTop,topZ)||
this._IsPointBehindNearPlane(bbRight,bbTop,topZ)||this._IsPointBehindNearPlane(bbRight,bbBottom,topZ)||this._IsPointBehindNearPlane(bbLeft,bbBottom,topZ))return null}else if(topZ>=this.GetCameraZ())return null;let [stlx,stly]=this.LayerToDrawSurface(bbLeft,bbTop,z);let [sbrx,sbry]=this.LayerToDrawSurface(bbRight,bbBottom,z);if(this.GetAngle()!==0||depth>0||this.Has3DCamera()){const [strx,stry]=this.LayerToDrawSurface(bbRight,bbTop,z);const [sblx,sbly]=this.LayerToDrawSurface(bbLeft,bbBottom,z);if(depth>
0){const [stlxTop,stlyTop]=this.LayerToDrawSurface(bbLeft,bbTop,topZ);const [strxTop,stryTop]=this.LayerToDrawSurface(bbRight,bbTop,topZ);const [sbrxTop,sbryTop]=this.LayerToDrawSurface(bbRight,bbBottom,topZ);const [sblxTop,sblyTop]=this.LayerToDrawSurface(bbLeft,bbBottom,topZ);let temp=Math.min(stlx,sbrx,strx,sblx,stlxTop,strxTop,sbrxTop,sblxTop);sbrx=Math.max(stlx,sbrx,strx,sblx,stlxTop,strxTop,sbrxTop,sblxTop);stlx=temp;temp=Math.min(stly,sbry,stry,sbly,stlyTop,stryTop,sbryTop,sblyTop);sbry=Math.max(stly,
sbry,stry,sbly,stlyTop,stryTop,sbryTop,sblyTop);stly=temp}else{let temp=Math.min(stlx,sbrx,strx,sblx);sbrx=Math.max(stlx,sbrx,strx,sblx);stlx=temp;temp=Math.min(stly,sbry,stry,sbly);sbry=Math.max(stly,sbry,stry,sbly);stly=temp}}tmpRect.set(stlx,stly,sbrx,sbry);return tmpRect}_GetViewFrustum(){if(this._isViewFrustumChanged){this._UpdateViewFrustum();this._isViewFrustumChanged=false}return this._viewFrustum}_UpdateViewFrustum(){const renderer=this._runtime.GetRenderer();const matP=this._GetProjectionMatrix(renderer);
const matMV=this._GetModelViewMatrix(renderer);this._viewFrustum.CalculatePlanes(matMV,matP)}_IsPointBehindNearPlane(x,y,z){return this._GetViewFrustum().IsBehindNearPlane(x,y,z)}_SaveToJson(){const o={"d":this.IsDynamic(),"s":this.GetOwnScale(),"a":this.GetOwnAngle(),"v":this._IsVisibleFlagSet(),"i":this.IsInteractive(),"html":this.IsHTMLElementsLayer(),"bc":this._backgroundColor.toJSON(),"t":this.IsTransparent(),"sx":this._scrollX,"sy":this._scrollY,"hosp":this._hasOwnScrollPosition,"px":this.GetParallaxX(),
"py":this.GetParallaxY(),"c":this._color.toJSON(),"sr":this.GetScaleRate(),"fx":this._effectList.SaveToJson(),"cg":this._createdGlobalUids};return o}_LoadFromJson(o){this._isDynamic=!!o["d"];this._scale=o["s"];this._angle=o["a"];this._isVisible=!!o["v"];this._isInteractive=o.hasOwnProperty("i")?o["i"]:true;this._isHTMLElementsLayer=!!o["html"];this._backgroundColor.setFromJSON(o["bc"]);this._isTransparent=!!o["t"];if(o.hasOwnProperty("sx"))this._scrollX=o["sx"];if(o.hasOwnProperty("sy"))this._scrollY=
o["sy"];if(o.hasOwnProperty("hosp"))this._hasOwnScrollPosition=!!o["hosp"];this._parallaxX=o["px"];this._parallaxY=o["py"];this._color.setFromJSON(o["c"]);this._UpdatePremultipliedColor();this._scaleRate=o["sr"];C3.shallowAssignArray(this._createdGlobalUids,o["cg"]);C3.shallowAssignArray(this._initialInstances,this._startupInitialInstances);const tempSet=new Set(this._createdGlobalUids);let j=0;for(let i=0,len=this._initialInstances.length;i<len;++i)if(!tempSet.has(this._initialInstances[i][2])){this._initialInstances[j]=
this._initialInstances[i];++j}C3.truncateArray(this._initialInstances,j);this._effectList.LoadFromJson(o["fx"]);this._needsRebuildEffectChainSteps=true}_LoadFromJsonAfterInstances(){this._SortInstancesByLastCachedZIndex(false);this.SetZIndicesChanged();this._SetMVMatrixChanged();this._SetProjectionMatrixChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(inst,sortExisting=false){if(this._instances.includes(inst)){if(sortExisting)this._instances.sort((f,s)=>{const firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();
const secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex});return}if(inst.HasChildren()){const instances=[...inst.allChildren()];instances.push(inst);instances.sort((f,s)=>{const firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();const secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex});for(const instanceToAdd of instances){if(!instanceToAdd.IsInContainer())continue;for(const instanceToAddSibling of instanceToAdd.siblings()){if(instances.includes(instanceToAddSibling))continue;
const siblingAndChildren=[...instanceToAddSibling.allChildren()];siblingAndChildren.push(instanceToAddSibling);siblingAndChildren.sort((f,s)=>{const firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();const secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex});if(!siblingAndChildren||!siblingAndChildren.length)continue;instances.splice(instances.length,0,...siblingAndChildren)}}for(const instance of instances)if(instance.GetPlugin().IsWorldType())this._AddInstance(instance,
true)}else{if(inst.GetPlugin().IsWorldType())this._AddInstance(inst,true);if(!inst.IsInContainer())return;for(const sibling of inst.siblings()){const siblingAndChildren=[...sibling.allChildren()];siblingAndChildren.push(sibling);siblingAndChildren.sort((f,s)=>{const firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();const secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex});if(!siblingAndChildren||!siblingAndChildren.length)continue;for(const instance of siblingAndChildren)if(instance.GetPlugin().IsWorldType())this._AddInstance(instance,
true)}}}};

}

// layouts/layout.js
{
'use strict';const C3=self.C3;const C3Debugger=self.C3Debugger;const assert=self.assert;const tempDestRect=C3.New(C3.Rect);const tempSrcRect=C3.New(C3.Rect);const tempLayoutRect=C3.New(C3.Rect);const tempColor=C3.New(C3.Color);const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const tempRender3dList=[];const tempInstanceList1=[];const tempInstanceList2=[];const tempInstanceList3=[];function vec3EqualsXYZ(v,x,y,z){return v[0]===Math.fround(x)&&v[1]===Math.fround(y)&&v[2]===Math.fround(z)}
let lastLayerPreparedForDrawing=null;function MaybePrepareLayerDraw(layer,renderer){if(lastLayerPreparedForDrawing===layer)return;layer.PrepareForDraw(renderer);lastLayerPreparedForDrawing=layer}
C3.Layout=class Layout extends C3.DefendedBase{constructor(layoutManager,index,data){super();this._layoutManager=layoutManager;this._runtime=layoutManager.GetRuntime();this._name=data[0];this._originalWidth=data[1];this._originalHeight=data[2];this._width=data[1];this._height=data[2];this._isUnboundedScrolling=!!data[3];this._isOrthographicProjection=!!data[4];this._vanishingPointX=data[5];this._vanishingPointY=data[6];this._eventSheetName=data[7];this._eventSheet=null;this._sid=data[8];this._index=
index;this._scrollX=0;this._scrollY=0;this._scale=1;this._angle=0;this._initialObjectClasses=new Set;this._textureLoadedTypes=new Set;this._textureLoadPendingPromises=new Set;this._createdInstances=[];this._createdPersistedInstances=[];this._createdPersistedInstancesToDataMap=new Map;this._createdPersistedIndexToInstanceMap=new Map;this._initialNonWorld=[];this._is3dCameraEnabled=false;this._cam3dposition=vec3.create();this._cam3dlook=vec3.create();this._cam3dup=vec3.create();this._rootLayers=[];
this._allLayersFlat=[];this._layersByName=new Map;this._layersBySid=new Map;this._pendingSetHTMLLayerCount=-1;const canvasManager=this._runtime.GetCanvasManager();this._effectList=C3.New(C3.EffectList,this,data[11]);this._effectChain=C3.New(C3.Gfx.EffectChain,canvasManager.GetEffectChainManager(),{drawContent:(renderer,effectChain)=>{const layout=effectChain.GetContentObject();const renderSurface=layout.GetRenderTarget();renderer.ResetColor();renderer.DrawRenderTarget(renderSurface);renderer.InvalidateRenderTarget(renderSurface);
canvasManager.ReleaseAdditionalRenderTarget(renderSurface)},getShaderParameters:index=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(index)});this._needsRebuildEffectChainSteps=true;this._wasFullScreenQualityLow=false;this._curRenderTarget=null;this._persistData={};this._persistedIntances=new Map;this._isFirstVisit=true;this._iLayout=new self.ILayout(this);this._userScriptDispatcher=C3.New(C3.Event.Dispatcher);for(const layerData of data[9])this._rootLayers.push(C3.Layer.CreateFromExportData(this,
null,layerData));this._ReindexLayers();for(const layer of this.allLayers())layer._InitInitialInstances();for(const instData of data[10]){const objectClass=this._runtime.GetObjectClassByIndex(instData[1]);if(!objectClass)throw new Error("missing nonworld object class");if(!objectClass.GetDefaultInstanceData())objectClass.SetDefaultInstanceData(instData);this._initialNonWorld.push(instData);this._AddInitialObjectClass(objectClass)}}Release(){for(const l of this._allLayersFlat)l.Release();C3.clearArray(this._allLayersFlat);
this._textureLoadPendingPromises.clear();this._eventSheet=null;this._layoutManager=null;this._runtime=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain}_MaybeRebuildEffectChainSteps(){const isFullscreenQualityLow=this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality()==="low";if(!this._needsRebuildEffectChainSteps&&
this._wasFullScreenQualityLow===isFullscreenQualityLow&&!this._effectChain.NeedsRebuild())return;const activeEffectTypes=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(activeEffectTypes.map(e=>e.GetShaderProgram()),{indexMap:activeEffectTypes.map(e=>e.GetIndex()),forcePostDraw:isFullscreenQualityLow,useFullSurface:true});this._needsRebuildEffectChainSteps=false;this._wasFullScreenQualityLow=isFullscreenQualityLow}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects();
this._needsRebuildEffectChainSteps=true}GetMinLayerScale(){let m=this._allLayersFlat[0].GetNormalScale();for(let i=1,len=this._allLayersFlat.length;i<len;++i){const layer=this._allLayersFlat[i];if(layer.GetParallaxX()===0&&layer.GetParallaxY()===0)continue;m=Math.min(m,layer.GetNormalScale())}return m}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){if(this.IsUnboundedScrolling())return-Infinity;
else return this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){if(this.IsUnboundedScrolling())return Infinity;else return this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){if(this.IsUnboundedScrolling())return-Infinity;else return this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){if(this.IsUnboundedScrolling())return Infinity;else return this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(x){const lbound=this.GetScrollLeftBound();const rbound=
this.GetScrollRightBound();if(x>rbound)x=rbound;if(x<lbound)x=lbound;if(this._scrollX!==x){this._scrollX=x;this._SetAllLayersMVChanged();this._runtime.UpdateRender()}}GetScrollX(){return this._scrollX}SetScrollY(y){const ubound=this.GetScrollTopBound();const bbound=this.GetScrollBottomBound();if(y>bbound)y=bbound;if(y<ubound)y=ubound;if(this._scrollY!==y){this._scrollY=y;this._SetAllLayersMVChanged();this._runtime.UpdateRender()}}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX());
this.SetScrollY(this.GetScrollY());for(const layer of this._allLayersFlat)if(layer.IsOwnScrollPositionEnabled()){layer.SetScrollX(layer.GetScrollX());layer.SetScrollY(layer.GetScrollY())}}SetVanishingPointXY(vpX,vpY){if(this._vanishingPointX===vpX&&this._vanishingPointY===vpY)return;this._vanishingPointX=vpX;this._vanishingPointY=vpY;if(this.IsPerspectiveProjection()){this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._runtime.UpdateRender()}}GetVanishingPointX(){if(this.IsOrthographicProjection())return.5;
else return this._vanishingPointX}GetVanishingPointY(){if(this.IsOrthographicProjection())return.5;else return this._vanishingPointY}HasVanishingPointOutsideViewport(){const vpX=this.GetVanishingPointX();const vpY=this.GetVanishingPointY();return vpX<0||vpX>1||vpY<0||vpY>1}SetPerspectiveProjection(){if(!this._isOrthographicProjection)return;this._isOrthographicProjection=false;this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._runtime.UpdateRender()}SetOrthographicProjection(){if(this._isOrthographicProjection)return;
this._isOrthographicProjection=true;this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._runtime.UpdateRender()}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(e){e=!!e;if(this._is3dCameraEnabled===e)return;this._is3dCameraEnabled=e;this._SetAllLayersMVChanged();this._runtime.UpdateRender()}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(camX,camY,camZ,
lookX,lookY,lookZ,upX,upY,upZ){if(vec3EqualsXYZ(this._cam3dposition,camX,camY,camZ)&&vec3EqualsXYZ(this._cam3dlook,lookX,lookY,lookZ)&&vec3EqualsXYZ(this._cam3dup,upX,upY,upZ))return;vec3.set(this._cam3dposition,camX,camY,camZ);vec3.set(this._cam3dlook,lookX,lookY,lookZ);vec3.set(this._cam3dup,upX,upY,upZ);this.Set3DCameraChanged()}Set3DCameraChanged(){this._SetAllLayersMVChanged();this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(s){if(this._scale===
s)return;this._scale=s;this._SetAllLayersMVChanged();this.BoundScrolling();this._runtime.UpdateRender()}SetAngle(a){a=C3.clampAngle(a);if(this._angle===a)return;this._angle=a;this._SetAllLayersMVChanged();this._runtime.UpdateRender()}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(w){if(!isFinite(w)||w<1)return;this._width=w}GetHeight(){return this._height}SetHeight(h){if(!isFinite(h)||h<1)return;this._height=h}GetEventSheet(){return this._eventSheet}_GetRootLayers(){return this._rootLayers}*allLayers(){for(const rootLayer of this._rootLayers)yield*rootLayer.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(p){if(typeof p===
"number")return this.GetLayerByIndex(p);else return this.GetLayerByName(p.toString())}GetLayerByIndex(i){i=C3.clamp(Math.floor(i),0,this._allLayersFlat.length-1);return this._allLayersFlat[i]}GetLayerByName(name){return this._layersByName.get(name.toLowerCase())||null}HasLayerByName(name){return!!this.GetLayerByName(name)}GetLayerBySID(sid){return this._layersBySid.get(sid)||null}_SetAllLayersProjectionChanged(){for(const layer of this._allLayersFlat)layer._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(const layer of this._allLayersFlat)layer._SetMVMatrixChanged()}AddLayer(layerName,
insertBy,where){if(this.HasLayerByName(layerName))throw new Error(`layer name '${layerName}' already in use`);if(!insertBy&&where<2)throw new Error("invalid insert position");const parentLayer=where>=2?insertBy:insertBy.GetParentLayer();const layer=C3.New(C3.Layer,this,parentLayer,{name:layerName,sid:Math.floor(Math.random()*1E15),isDynamic:true});this._InsertLayer(layer,insertBy,where);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}MoveLayer(layer,insertBy,where){if(!insertBy&&
where<2)throw new Error("invalid insert position");if(layer===insertBy&&where<2)return;this._RemoveLayer(layer);this._InsertLayer(layer,insertBy,where);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}RemoveLayer(layer){if(this._RemoveLayer(layer)){const eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);layer.Release();eventSheetManager.BlockFlushingInstances(false);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}}RemoveAllDynamicLayers(){const toRemove=
new Set;for(const layer of this.allLayers())if(layer.IsDynamic()&&!layer.HasAnyDynamicParentLayer())toRemove.add(layer);if(toRemove.size===0)return;const eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);for(const layer of toRemove){this._RemoveLayer(layer);layer.Release()}eventSheetManager.BlockFlushingInstances(false);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers()}_InsertLayer(layer,insertBy,where){if(where>=2)if(insertBy){if(insertBy===
layer||insertBy.HasParentLayer(layer))throw new Error(`cannot move layer '${layer.GetName()}' to sub-layer of itself`);insertBy._AddSubLayer(layer,where===2);layer._SetParentLayer(insertBy)}else{if(where===2)this._rootLayers.push(layer);else this._rootLayers.unshift(layer);layer._SetParentLayer(null)}else{const parentLayer=insertBy.GetParentLayer();if(parentLayer){if(insertBy.HasParentLayer(layer))throw new Error(`cannot move layer '${layer.GetName()}' to sub-layer of itself`);parentLayer._InsertSubLayer(layer,
insertBy,where===0);layer._SetParentLayer(parentLayer)}else{let i=this._rootLayers.indexOf(insertBy);if(i===-1)throw new Error("cannot find layer to insert by");if(where===0)++i;this._rootLayers.splice(i,0,layer);layer._SetParentLayer(null)}}}_RemoveLayer(layer){const parentLayer=layer.GetParentLayer();if(parentLayer){parentLayer._RemoveSubLayer(layer);return true}else if(this._rootLayers.length>1){const i=this._rootLayers.indexOf(layer);if(i===-1)throw new Error("cannot find layer to remove");this._rootLayers.splice(i,
1);return true}return false}_ReindexLayers(){this._allLayersFlat=[...this.allLayers()];this._layersByName.clear();this._layersBySid.clear();for(let i=0,len=this._allLayersFlat.length;i<len;++i){const layer=this._allLayersFlat[i];layer._SetIndex(i);this._layersByName.set(layer.GetName().toLowerCase(),layer);this._layersBySid.set(layer.GetSID(),layer)}}_ReindexHTMLLayers(){let htmlIndex=0;for(const rootLayer of this._rootLayers){for(const layer of rootLayer.selfAndAllSubLayers())layer._SetHTMLIndex(htmlIndex);
if(rootLayer.IsHTMLElementsLayer())htmlIndex++}}GetHTMLLayerCount(){return this._rootLayers.at(-1).GetHTMLIndex()+1}async _ReindexAndUpdateAllLayers(){this._ReindexLayers();this._ReindexHTMLLayers();this._pendingSetHTMLLayerCount=this.GetHTMLLayerCount()}_GetPendingSetHTMLLayerCount(){return this._pendingSetHTMLLayerCount}_ResetPendingHTMLLayerCount(){this._pendingSetHTMLLayerCount=-1}GetRootLayersForHTMLLayer(i){const ret=[];for(const rootLayer of this._rootLayers){const htmlIndex=rootLayer.GetHTMLIndex();
if(htmlIndex===i)ret.push(rootLayer);else if(htmlIndex>i)break}return ret}SaveTransform(){return{"scrollX":this.GetScrollX(),"scrollY":this.GetScrollY(),"scale":this.GetScale(),"angle":this.GetAngle(),"vpX":this.GetVanishingPointX(),"vpY":this.GetVanishingPointY()}}RestoreTransform(t){this.SetScrollX(t["scrollX"]);this.SetScrollY(t["scrollY"]);this.SetScale(t["scale"]);this.SetAngle(t["angle"]);this.SetVanishingPointXY(t["vpX"],t["vpY"])}GetLayoutBackgroundColor(){let firstDrawLayer=this._rootLayers.filter(l=>
l.ShouldDraw())[0];while(firstDrawLayer){if(!firstDrawLayer.IsTransparent()){tempColor.copyRgb(firstDrawLayer.GetBackgroundColor());tempColor.setA(1);return tempColor}else if(firstDrawLayer.UsesOwnTexture()){tempColor.setRgba(0,0,0,0);return tempColor}firstDrawLayer=firstDrawLayer.GetSubLayers().filter(l=>l.ShouldDraw())[0]}tempColor.setRgba(0,0,0,0);return tempColor}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(objectClass){if(objectClass.IsInContainer())for(const containerType of objectClass.GetContainer().GetObjectTypes())this._initialObjectClasses.add(containerType);
else this._initialObjectClasses.add(objectClass)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(previousLayout,renderer){if(previousLayout===this||!renderer)return Promise.resolve();if(previousLayout){C3.CopySet(this._textureLoadedTypes,previousLayout._textureLoadedTypes);previousLayout._textureLoadedTypes.clear()}const promises=[];for(const oc of this._initialObjectClasses)if(!this._textureLoadedTypes.has(oc)){promises.push(oc.LoadTextures(renderer));this._textureLoadedTypes.add(oc)}return Promise.all(promises)}async MaybeLoadTexturesFor(objectClass){if(objectClass.IsFamily())throw new Error("cannot load textures for family");
const renderer=this._runtime.GetRenderer();if(!renderer||renderer.IsContextLost()||this._textureLoadedTypes.has(objectClass))return;this._textureLoadedTypes.add(objectClass);const loadPromise=objectClass.LoadTextures(renderer);this._AddPendingTextureLoadPromise(loadPromise);await loadPromise;objectClass.OnDynamicTextureLoadComplete();this._runtime.UpdateRender()}_AddPendingTextureLoadPromise(promise){this._textureLoadPendingPromises.add(promise);promise.then(()=>this._textureLoadPendingPromises.delete(promise)).catch(()=>
this._textureLoadPendingPromises.delete(promise))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(objectClass){if(objectClass.IsFamily()||objectClass.GetInstanceCount()>0)throw new Error("cannot unload textures");const renderer=this._runtime.GetRenderer();if(!renderer||!this._textureLoadedTypes.has(objectClass))return;this._textureLoadedTypes.delete(objectClass);objectClass.ReleaseTextures(renderer)}_Unload(nextLayout,renderer){if(nextLayout===
this||!renderer)return;for(const oc of this._textureLoadedTypes)if(!oc.IsGlobal()&&!nextLayout._initialObjectClasses.has(oc)){oc.ReleaseTextures();this._textureLoadedTypes.delete(oc)}}_OnRendererContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(isFirstLayout){const runtime=this._runtime;const layoutManager=this._layoutManager;const eventSheetManager=runtime.GetEventSheetManager();if(this._eventSheetName){this._eventSheet=eventSheetManager.GetEventSheetByName(this._eventSheetName);
this._eventSheet._UpdateDeepIncludes()}layoutManager._SetMainRunningLayout(this);this._width=this._originalWidth;this._height=this._originalHeight;this._scrollX=runtime.GetOriginalViewportWidth()/2;this._scrollY=runtime.GetOriginalViewportHeight()/2;this.BoundScrolling();this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._ReindexHTMLLayers();await this._runtime.GetCanvasManager().SetHTMLLayerCount(this.GetHTMLLayerCount(),true);this._MoveGlobalObjectsToThisLayout(isFirstLayout);
this._runtime.SetUsingCreatePromises(true);this._CreateInitialInstances();if(!this._isFirstVisit)this._CreatePersistedInstances();this._CreateAndLinkContainerInstances(this._createdInstances);this._CreateAndLinkContainerInstances(this._createdPersistedInstances);this._CreateInitialNonWorldInstances();layoutManager.ClearPendingChangeLayout();runtime.FlushPendingInstances();this._runtime.SetUsingCreatePromises(false);const createPromises=this._runtime.GetCreatePromises();await Promise.all(createPromises);
C3.clearArray(createPromises);if(!runtime.IsLoadingState()){for(const inst of this._createdInstances)inst.SetupInitialSceneGraphConnections();for(const inst of this._createdPersistedInstances)inst.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);for(const [sidStr,typeData]of Object.entries(this._persistData)){const objectClass=this._runtime.GetObjectClassBySID(parseInt(sidStr,10));if(!objectClass||objectClass.IsFamily()||!objectClass.HasPersistBehavior())continue;
C3.clearArray(typeData)}for(const inst of this._createdInstances)inst._TriggerOnCreated();for(const inst of this._createdPersistedInstances)inst._TriggerOnCreated()}C3.clearArray(this._createdInstances);C3.clearArray(this._createdPersistedInstances);this._createdPersistedInstancesToDataMap.clear();this._createdPersistedIndexToInstanceMap.clear();await Promise.all([...this._initialObjectClasses].map(oc=>oc.PreloadTexturesWithInstances(this._runtime.GetRenderer())));if(isFirstLayout){runtime.Dispatcher().dispatchEvent(new C3.Event("beforefirstlayoutstart"));
await runtime.DispatchUserScriptEventAsyncWait(new C3.Event("beforeprojectstart"))}await this.DispatchRuntimeUserScriptEventAsyncWait(new C3.Event("beforeanylayoutstart"));runtime.Dispatcher().dispatchEvent(new C3.Event("beforelayoutstart"));await this.DispatchUserScriptEventAsyncWait(new C3.Event("beforelayoutstart"));if(!runtime.IsLoadingState())await runtime.TriggerAsync(C3.Plugins.System.Cnds.OnLayoutStart,null,null);runtime.Dispatcher().dispatchEvent(new C3.Event("afterlayoutstart"));await this.DispatchUserScriptEventAsyncWait(new C3.Event("afterlayoutstart"));
await this.DispatchRuntimeUserScriptEventAsyncWait(new C3.Event("afteranylayoutstart"));if(isFirstLayout){runtime.Dispatcher().dispatchEvent(new C3.Event("afterfirstlayoutstart"));await runtime.DispatchUserScriptEventAsyncWait(new C3.Event("afterprojectstart"))}eventSheetManager._RunQueuedTriggers(layoutManager);await this.WaitForPendingTextureLoadsToComplete();this._isFirstVisit=false}_MoveGlobalObjectsToThisLayout(isFirstLayout){for(const objectClass of this._runtime.GetAllObjectClasses()){if(objectClass.IsFamily()||
!objectClass.IsWorldType())continue;for(const inst of objectClass.GetInstances()){const wi=inst.GetWorldInfo();const oldLayer=wi.GetLayer();const layerIndex=C3.clamp(oldLayer.GetIndex(),0,this._allLayersFlat.length-1);const newLayer=this._allLayersFlat[layerIndex];wi._SetLayer(newLayer,true);newLayer._MaybeAddInstance(inst)}}if(!isFirstLayout)for(const layer of this._allLayersFlat)layer._SortInstancesByLastCachedZIndex(false)}_CreateInitialInstances(){for(const layer of this._allLayersFlat){layer.CreateInitialInstances(this._createdInstances);
layer._Start()}}_CreatePersistedInstances(){let uidsChanged=false;for(const [sidStr,typeData]of Object.entries(this._persistData)){const objectClass=this._runtime.GetObjectClassBySID(parseInt(sidStr,10));if(!objectClass||objectClass.IsFamily()||!objectClass.HasPersistBehavior())continue;for(const instData of typeData){let layer=null;if(objectClass.IsWorldType()){if(instData.hasOwnProperty("instJson"))layer=this.GetLayerBySID(instData["instJson"]["w"]["l"]);else layer=this.GetLayerBySID(instData["w"]["l"]);
if(!layer)continue}const inst=this._runtime.CreateInstanceFromData(objectClass,layer,false,0,0,true);if(instData.hasOwnProperty("instJson"))inst.LoadFromJson(instData["instJson"]);else inst.LoadFromJson(instData);uidsChanged=true;this._createdPersistedInstances.push(inst);if(instData.hasOwnProperty("instJson")){this._createdPersistedInstancesToDataMap.set(inst,instData);this._createdPersistedIndexToInstanceMap.set(instData["index"],inst)}}}for(const layer of this._allLayersFlat){layer._SortInstancesByLastCachedZIndex(true);
layer.SetZIndicesChanged()}if(uidsChanged){this._runtime.FlushPendingInstances();this._runtime._RefreshUidMap()}}_CreateAndLinkContainerInstances(createdInstances){for(const inst of createdInstances){if(!inst.IsInContainer())continue;const wi=inst.GetWorldInfo();const iid=inst.GetIID();for(const containerType of inst.GetObjectClass().GetContainer().objectTypes()){if(containerType===inst.GetObjectClass())continue;const instances=containerType.GetInstances();if(instances.length>iid)inst._AddSibling(instances[iid]);
else{let s;if(wi)s=this._runtime.CreateInstanceFromData(containerType,wi.GetLayer(),true,wi.GetX(),wi.GetY(),true);else s=this._runtime.CreateInstanceFromData(containerType,null,true,0,0,true);this._runtime.FlushPendingInstances();containerType._UpdateIIDs();inst._AddSibling(s);createdInstances.push(s)}}}}_CreateInitialNonWorldInstances(){for(const instData of this._initialNonWorld){const objectClass=this._runtime.GetObjectClassByIndex(instData[1]);if(!objectClass.IsInContainer())this._runtime.CreateInstanceFromData(instData,
null,true)}}_CreateGlobalNonWorlds(){const createdInstances=[];const initialNonWorld=this._initialNonWorld;let k=0;for(let i=0,len=initialNonWorld.length;i<len;++i){const instData=initialNonWorld[i];const objectClass=this._runtime.GetObjectClassByIndex(instData[1]);if(objectClass.IsGlobal()){if(!objectClass.IsInContainer()||!objectClass.GetContainer().HasAnyWorldType())createdInstances.push(this._runtime.CreateInstanceFromData(instData,null,true))}else{initialNonWorld[k]=instData;++k}}C3.truncateArray(initialNonWorld,
k);this._runtime.FlushPendingInstances();this._CreateAndLinkContainerInstances(createdInstances)}RecreateInitialObjects(objectClass,rc,srcLayer,offsetX,offsetY,createHierarchy){if(srcLayer)return srcLayer.RecreateInitialObjects(objectClass,rc,offsetX,offsetY,createHierarchy);else{const ret=[];for(const layer of this._allLayersFlat)ret.push(layer.RecreateInitialObjects(objectClass,rc,offsetX,offsetY,createHierarchy));return ret.flat()}}async _StopRunning(){const layoutManager=this._layoutManager;if(!this._runtime.IsLoadingState()){await this.DispatchRuntimeUserScriptEventAsyncWait(new C3.Event("beforeanylayoutend"));
await this.DispatchUserScriptEventAsyncWait(new C3.Event("beforelayoutend"));await this._runtime.TriggerAsync(C3.Plugins.System.Cnds.OnLayoutEnd,null,null);await this.DispatchUserScriptEventAsyncWait(new C3.Event("afterlayoutend"));await this.DispatchRuntimeUserScriptEventAsyncWait(new C3.Event("afteranylayoutend"))}layoutManager.SetIsEndingLayout(true);this._runtime.GetEventSheetManager().ClearAllScheduledWaits();if(!this._isFirstVisit)this._SavePersistData();for(const layer of this._allLayersFlat)layer._End();
for(const objectClass of this._runtime.GetAllObjectClasses()){if(objectClass.IsGlobal()||objectClass.IsWorldType()||objectClass.GetPlugin().IsSingleGlobal()||objectClass.IsFamily())continue;for(const inst of objectClass.GetInstances())this._runtime.DestroyInstance(inst);this._runtime.FlushPendingInstances()}layoutManager.SetIsEndingLayout(false);if(layoutManager.GetMainRunningLayout()===this)layoutManager._SetMainRunningLayout(null)}_SaveInstanceToPersist(inst,index){const sidStr=inst.GetObjectClass().GetSID().toString();
if(!this._persistData.hasOwnProperty(sidStr))this._persistData[sidStr]=[];const typePersist=this._persistData[sidStr];const persistData={"index":index,"instJson":inst.SaveToJson(),"sceneGraphJson":{"children":[]}};typePersist.push(persistData);this._persistedIntances.set(inst,persistData)}_SaveSceneGraphInfoToPersist(inst){const persistData=this._persistedIntances.get(inst);for(const child of inst.GetChildren()){const childPersistData=this._persistedIntances.get(child);if(childPersistData)persistData["sceneGraphJson"]["children"].push({"index":childPersistData["index"],
"flags":C3.SceneGraphInfo._GetFlagsNumber(child.GetWorldInfo())})}}_SavePersistData(){this._persistedIntances.clear();let persisDataIndex=0;for(const layer of this._allLayersFlat){layer._UpdateZIndices();for(const inst of layer._GetInstances()){const objectClass=inst.GetObjectClass();if(!objectClass.IsGlobal()&&objectClass.HasPersistBehavior()){this._SaveInstanceToPersist(inst,persisDataIndex);persisDataIndex++}}}for(const layer of this._allLayersFlat)for(const inst of layer._GetInstances()){const objectClass=
inst.GetObjectClass();if(!objectClass.IsGlobal()&&objectClass.HasPersistBehavior())this._SaveSceneGraphInfoToPersist(inst)}this._persistedIntances.clear()}ResetPersistData(){this._persistData={};this._isFirstVisit=true}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){const runtime=this._runtime;const isWebGL=runtime.GetRenderer().IsWebGL();return runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality()==="low"||isWebGL&&runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect()||
isWebGL&&runtime.Uses3DFeatures()}_MaybeStartDrawToOwnTexture(renderer){const canvasManager=this._runtime.GetCanvasManager();if(this.UsesOwnTexture()){renderer.SetRenderTarget(null);renderer.ClearRgba(0,0,0,0);const rtOpts={sampling:this._runtime.GetSampling(),isSampled:renderer.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:renderer.IsWebGPU()?this._runtime.UsesAnyBackgroundBlending():false};if(canvasManager.GetCurrentFullscreenScalingQuality()===
"low"){rtOpts.width=canvasManager.GetDrawWidth();rtOpts.height=canvasManager.GetDrawHeight()}this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(rtOpts)}else this._curRenderTarget=null}_MaybeCopyOwnTextureToBackbuffer(renderer){if(this._runtime._NeedsHTMLLayerCompositing(renderer)){renderer.SetDepthEnabled(false);renderer.SetRenderTarget(null);renderer.SetTextureFillMode();renderer.CopyRenderTarget(this._curRenderTarget)}}_MaybeEndDrawToOwnTexture(renderer){if(this.UsesOwnTexture()){renderer.SetDepthEnabled(false);
this._DrawLayoutOwnTextureToRenderTarget(renderer,this._curRenderTarget)}}DrawMain(renderer){renderer.SetRenderTarget(this._curRenderTarget);renderer.Clear(this.GetLayoutBackgroundColor());if(this._runtime.Uses3DFeatures())renderer.ClearDepth();const rootLayers=this.GetRootLayersForHTMLLayer(0);this._DrawLayerList(renderer,this._curRenderTarget,rootLayers,true);if(renderer.IsWebGPU())renderer.StartMeasuringRenderPassTime(0,1);this._MaybeEndDrawToOwnTexture(renderer);this._curRenderTarget=null}DrawForHTMLLayerIndex(renderer,
htmlIndex){let destRenderTarget=null;if(this._runtime._NeedsHTMLLayerCompositing(renderer))destRenderTarget=this._curRenderTarget;renderer.SetRenderTarget(destRenderTarget);renderer.ClearRgba(0,0,0,0);if(this._runtime.Uses3DFeatures())renderer.ClearDepth();const rootLayers=this.GetRootLayersForHTMLLayer(htmlIndex);this._DrawLayerList(renderer,destRenderTarget,rootLayers,true);this._MaybeCopyOwnTextureToBackbuffer(renderer);renderer.EndBatch();this._runtime.GetCanvasManager().BlitMainCanvasToHTMLLayerCanvas(htmlIndex)}_DrawLayerList(renderer,
destRenderTarget,layersArr,canCopyFirstLayer){const layersToDraw=layersArr.filter(l=>l.ShouldDraw());for(let i=0,len=layersToDraw.length;i<len;){const layer=layersToDraw[i];if(layer.SelfAndAllSubLayersHave3DCamera()&&!layer.SelfOrAnySubLayerUsesOwnTexture()){tempRender3dList.push(layer);for(let j=i+1;j<len;++j){const nextLayer=layersToDraw[j];if(nextLayer.SelfAndAllSubLayersHave3DCamera()&&!nextLayer.SelfOrAnySubLayerUsesOwnTexture())tempRender3dList.push(layersToDraw[j]);else break}if(tempRender3dList.length>=
2||tempRender3dList.length===1&&tempRender3dList[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(renderer,destRenderTarget,tempRender3dList);i+=tempRender3dList.length;C3.clearArray(tempRender3dList);continue}C3.clearArray(tempRender3dList)}layer.Draw(renderer,destRenderTarget,canCopyFirstLayer&&i===0);++i}}_DrawLayoutOwnTextureToRenderTarget(renderer,ownRenderTarget){const activeEffectTypes=this._effectList.GetActiveEffectTypes();const runtime=this._runtime;if(activeEffectTypes.length===0){renderer.SetRenderTarget(null);
renderer.SetTextureFillMode();renderer.CopyRenderTarget(ownRenderTarget);renderer.InvalidateRenderTarget(ownRenderTarget);runtime.ReleaseAdditionalRenderTarget(ownRenderTarget)}else{tempLayoutRect.set(0,0,runtime.GetViewportWidth(),runtime.GetViewportHeight());this.GetEffectChain().Render(renderer,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:tempLayoutRect,
drawSurfaceRect:null,invalidateRenderTargets:true})}}_Draw3DLayers(renderer,renderTarget,layerList){if(!layerList[0].IsTransparent()){tempColor.copyRgb(layerList[0].GetBackgroundColor());tempColor.setA(1);renderer.Clear(tempColor)}const canvasManager=this._runtime.GetCanvasManager();renderer.SetDepthEnabled(true);const fullInstanceList=tempInstanceList1;const coplanarInstances=tempInstanceList2;const postRenderInstances=tempInstanceList3;for(const layer of layerList){layer._UpdateZIndices();layer._AppendAllInstancesIncludingSubLayersInDrawOrder(fullInstanceList)}const firstLayer=
layerList[0];const webglLayerQuery=firstLayer._MaybeStartWebGLProfiling(renderer);firstLayer._MaybeStartWebGPUProfiling(renderer);for(let i=0,len=fullInstanceList.length;i<len;){const inst=fullInstanceList[i];const wi=inst.GetWorldInfo();const wiLayer=wi.GetLayer();if(!wi.IsVisible()||!wi.IsInViewport3D(wiLayer._GetViewFrustum())){++i;continue}if(!inst.RendersToOwnZPlane()||wi.GetDepth()>0)postRenderInstances.push(inst);const startZ=inst.GetWorldInfo().GetTotalZElevation();coplanarInstances.push(inst);
let endIndex=i+1;for(;endIndex<len;++endIndex){const nextInst=fullInstanceList[endIndex];const nextWi=nextInst.GetWorldInfo();if(!nextWi.IsVisible()||!nextWi.IsInViewport3D(nextWi.GetLayer()._GetViewFrustum()))continue;if(nextWi.GetTotalZElevation()!==startZ)break;if(!nextInst.RendersToOwnZPlane()){postRenderInstances.push(nextInst);continue}if(nextWi.GetDepth()>0)postRenderInstances.push(nextInst);coplanarInstances.push(nextInst)}if(coplanarInstances.length===1&&!coplanarInstances[0].MustMitigateZFighting()){MaybePrepareLayerDraw(wiLayer,
renderer);wiLayer._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget);for(let j=0,lenj=postRenderInstances.length;j<lenj;++j){const postInst=postRenderInstances[j];if(postInst===inst)continue;const postWi=postInst.GetWorldInfo();const postWiLayer=postWi.GetLayer();MaybePrepareLayerDraw(postWiLayer,renderer);postWiLayer._DrawInstanceMaybeWithEffects(postInst,postWi,renderer,renderTarget)}}else{this._Draw3DLayersCoplanarInstances(renderer,renderTarget,coplanarInstances);for(let j=0,lenj=postRenderInstances.length;j<
lenj;++j){const postInst=postRenderInstances[j];const postWi=postInst.GetWorldInfo();const postWiLayer=postWi.GetLayer();postWi._SetDrawNonBackFacesOnly(true);MaybePrepareLayerDraw(postWiLayer,renderer);postWiLayer._DrawInstanceMaybeWithEffects(postInst,postWi,renderer,renderTarget);postWi._SetDrawNonBackFacesOnly(false)}}i=endIndex;C3.clearArray(coplanarInstances);C3.clearArray(postRenderInstances)}if(webglLayerQuery)renderer.EndQuery(webglLayerQuery);C3.clearArray(fullInstanceList);lastLayerPreparedForDrawing=
null}_Draw3DLayersCoplanarInstances(renderer,renderTarget,instances){renderer.CoplanarStartStencilPass();for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];const wi=inst.GetWorldInfo();const layer=wi.GetLayer();wi._SetDrawBackFaceOnly(true);MaybePrepareLayerDraw(layer,renderer);layer._DrawInstance(inst,wi,renderer)}renderer.CoplanarStartColorPass();for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];const wi=inst.GetWorldInfo();const layer=wi.GetLayer();MaybePrepareLayerDraw(layer,
renderer);layer._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget);wi._SetDrawBackFaceOnly(false)}renderer.CoplanarRestoreStandardRendering()}_SaveToJson(){const o={"sx":this.GetScrollX(),"sy":this.GetScrollY(),"s":this.GetScale(),"a":this.GetAngle(),"w":this.GetWidth(),"h":this.GetHeight(),"ortho":this.IsOrthographicProjection(),"vpX":this.GetVanishingPointX(),"vpY":this.GetVanishingPointY(),"fv":this._isFirstVisit,"persist":this._persistData,"fx":this._effectList.SaveToJson(),"layers":{},
"dynamicLayers":[]};for(const layer of this._allLayersFlat)if(layer.IsDynamic()){const parentLayer=layer.GetParentLayer();o["dynamicLayers"].push({"sid":layer.GetSID(),"name":layer.GetName(),"parentSid":parentLayer?parentLayer.GetSID():null,"siblingIndex":layer._GetSiblingIndex(),"data":layer._SaveToJson()})}else o["layers"][layer.GetSID().toString()]=layer._SaveToJson();return o}_LoadFromJson(o){this._scrollX=o["sx"];this._scrollY=o["sy"];this._scale=o["s"];this._angle=o["a"];this._width=o["w"];
this._height=o["h"];this._isOrthographicProjection=!!o["ortho"];if(o.hasOwnProperty("vpX"))this._vanishingPointX=o["vpX"];if(o.hasOwnProperty("vpY"))this._vanishingPointY=o["vpY"];this._isFirstVisit=!!o["fv"];this._persistData=o["persist"];this._effectList.LoadFromJson(o["fx"]);this._needsRebuildEffectChainSteps=true;for(const [sidStr,data]of Object.entries(o["layers"])){const sid=parseInt(sidStr,10);const layer=this.GetLayerBySID(sid);if(!layer)continue;layer._LoadFromJson(data)}if(o.hasOwnProperty("dynamicLayers")){this.RemoveAllDynamicLayers();
this._runtime.FlushPendingInstances();const reorderLayers=new Map;const dynamicLayersData=o["dynamicLayers"];for(let i=dynamicLayersData.length-1;i>=0;--i){const dld=dynamicLayersData[i];const sid=dld["sid"];const layerName=dld["name"];const parentSid=dld["parentSid"];const siblingIndex=dld["siblingIndex"];const layerData=dld["data"];this._ReindexLayers();if(this.HasLayerByName(layerName)||this.GetLayerBySID(sid))continue;let parentLayer;let parentLayerArr;if(parentSid===null){parentLayer=null;parentLayerArr=
this._rootLayers}else{parentLayer=this.GetLayerBySID(parentSid);if(!parentLayer)continue;parentLayerArr=parentLayer.GetSubLayers()}const layer=C3.New(C3.Layer,this,parentLayer,{name:layerName,sid,isDynamic:true});parentLayerArr.push(layer);let arr=reorderLayers.get(parentLayerArr);if(!arr){arr=[];reorderLayers.set(parentLayerArr,arr)}arr.push({layer,siblingIndex});layer._LoadFromJson(layerData)}for(const [parentLayerArr,reorderArr]of reorderLayers){reorderArr.sort((a,b)=>a.siblingIndex-b.siblingIndex);
for(const r of reorderArr){const layer=r.layer;const siblingIndex=r.siblingIndex;let i=parentLayerArr.indexOf(layer);parentLayerArr.splice(i,1);parentLayerArr.splice(siblingIndex,0,layer)}}}this._ReindexAndUpdateAllLayers();this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.layout=this.GetILayout();const runtime=this._runtime;const shouldTime=runtime.IsDebug()&&
!runtime.GetEventSheetManager().IsInEventEngine();if(shouldTime)C3Debugger.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(e);if(shouldTime)C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){e.layout=this.GetILayout();return this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}DispatchRuntimeUserScriptEventAsyncWait(e){e.layout=this.GetILayout();return this._runtime.DispatchUserScriptEventAsyncWait(e)}_LogLayerTree(){this._LogLayerList(this._rootLayers)}_LogLayerList(layersArr,
indent=0){const layersRev=layersArr.slice(0);layersRev.reverse();for(const layer of layersRev){console.log(`${"\t".repeat(indent)}- ${layer.GetName()}`);this._LogLayerList(layer.GetSubLayers(),indent+1)}}};

}

// layouts/layoutManager.js
{
'use strict';const C3=self.C3;
C3.LayoutManager=class LayoutManager extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._allLayouts=[];this._layoutsByName=new Map;this._layoutsBySid=new Map;this._mainRunningLayout=null;this._runningSubLayouts=[];this._firstLayout=null;this._isEndingLayout=0;this._pendingChangeLayout=null}Release(){this._runtime=null;this._mainRunningLayout=null;this._firstLayout=null;this._pendingChangeLayout=null;C3.clearArray(this._allLayouts);this._layoutsByName.clear();this._layoutsBySid.clear();
C3.clearArray(this._runningSubLayouts)}Create(layoutData){const layout=C3.New(C3.Layout,this,this._allLayouts.length,layoutData);this._allLayouts.push(layout);this._layoutsByName.set(layout.GetName().toLowerCase(),layout);this._layoutsBySid.set(layout.GetSID(),layout)}GetRuntime(){return this._runtime}SetFirstLayout(layout){this._firstLayout=layout}GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw new Error("no first layout");
}GetLayoutByName(name){return this._layoutsByName.get(name.toLowerCase())||null}GetLayoutBySID(sid){return this._layoutsBySid.get(sid)||null}GetLayoutByIndex(index){index=C3.clamp(Math.floor(index),0,this._allLayouts.length-1);return this._allLayouts[index]}GetLayout(p){if(typeof p==="number")return this.GetLayoutByIndex(p);else return this.GetLayoutByName(p.toString())}GetAllLayouts(){return this._allLayouts}_SetMainRunningLayout(layout){this._mainRunningLayout=layout}GetMainRunningLayout(){return this._mainRunningLayout}_AddRunningSubLayout(layout){if(this._runningSubLayouts.includes(layout))throw new Error("layout already running");
this._runningSubLayouts.push(layout)}_RemoveRunningSubLayout(layout){const i=this._runningSubLayouts.indexOf(layout);if(i===-1)throw new Error("layout not running");this._runningSubLayouts.splice(i,1)}*runningLayouts(){if(this._mainRunningLayout)yield this._mainRunningLayout;if(this._runningSubLayouts.length)yield*this._runningSubLayouts}IsLayoutRunning(layout){return this._mainRunningLayout===layout||this._runningSubLayouts.includes(layout)}SetIsEndingLayout(e){if(e)this._isEndingLayout++;else{if(this._isEndingLayout<=
0)throw new Error("already unset");this._isEndingLayout--}}IsEndingLayout(){return this._isEndingLayout>0}ChangeMainLayout(layout){this._pendingChangeLayout=layout}ClearPendingChangeLayout(){this._pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this._pendingChangeLayout}GetPendingChangeMainLayout(){return this._pendingChangeLayout}SetAllLayerProjectionChanged(){const runningLayout=this.GetMainRunningLayout();if(!runningLayout)return;runningLayout._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){const runningLayout=
this.GetMainRunningLayout();if(!runningLayout)return;runningLayout._SetAllLayersMVChanged()}};

}

// timelines/timelineManager.js
{
'use strict';const C3=self.C3;const NAMES_REGEXP=new RegExp("<(.+?)>","g");
C3.TimelineManager=class TimelineManager extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._timelineDataManager=C3.New(C3.TimelineDataManager);this._pluginInstance=null;this._timelines=[];this._timelinesByName=new Map;this._objectClassToTimelineMap=new Map;this._timelinesCreatedByTemplate=new Map;this._scheduledTimelines=[];this._playingTimelines=[];this._markedForRemovalTimelines=[];this._hasRuntimeListeners=false;this._changingLayout=false;this._isTickingTimelines=
false;this._tickFunc=()=>this._OnTick();this._tick2Func=()=>this._OnTick2();this._beforeLayoutChange=()=>this._OnBeforeChangeLayout();this._layoutChange=()=>this._OnAfterChangeLayout();this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance);this._beforeLoad=e=>this._OnBeforeLoad();this._afterLoad=e=>this._OnAfterLoad();this._afterLayoutStart=e=>this._OnAfterLayoutStart();this._destroyedWhileLoadingState=[];this._renderChange=0}Release(){this.RemoveRuntimeListeners();this._tickFunc=null;this._tick2Func=
null;this._beforeLayoutChange=null;this._layoutChange=null;this._instanceDestroy=null;this._afterLoad=null;for(const timeline of this._timelines){timeline.Stop();timeline.Release()}C3.clearArray(this._timelines);this._timelines=null;this._timelineDataManager.Release();this._timelineDataManager=null;C3.clearArray(this._scheduledTimelines);this._scheduledTimelines=null;C3.clearArray(this._playingTimelines);this._playingTimelines=null;C3.clearArray(this._markedForRemovalTimelines);this._markedForRemovalTimelines=
null;this._timelinesByName.clear();this._timelinesByName=null;this._objectClassToTimelineMap.clear();this._objectClassToTimelineMap=null;this._timelinesCreatedByTemplate.clear();this._timelinesCreatedByTemplate=null;C3.clearArray(this._destroyedWhileLoadingState);this._destroyedWhileLoadingState=null;this._runtime=null}AddRuntimeListeners(){const dispatcher=this._runtime.Dispatcher();dispatcher.addEventListener("pretick",this._tickFunc);dispatcher.addEventListener("tick2",this._tick2Func);dispatcher.addEventListener("beforelayoutchange",
this._beforeLayoutChange);dispatcher.addEventListener("layoutchange",this._layoutChange);dispatcher.addEventListener("instancedestroy",this._instanceDestroy);dispatcher.addEventListener("beforeload",this._beforeLoad);dispatcher.addEventListener("afterload",this._afterLoad);dispatcher.addEventListener("afterlayoutstart",this._afterLayoutStart)}RemoveRuntimeListeners(){const dispatcher=this._runtime.Dispatcher();dispatcher.removeEventListener("pretick",this._tickFunc);dispatcher.removeEventListener("tick2",
this._tick2Func);dispatcher.removeEventListener("beforelayoutchange",this._beforeLayoutChange);dispatcher.removeEventListener("layoutchange",this._layoutChange);dispatcher.removeEventListener("instancedestroy",this._instanceDestroy);dispatcher.removeEventListener("beforeload",this._beforeLoad);dispatcher.removeEventListener("afterload",this._afterLoad);dispatcher.removeEventListener("afterlayoutstart",this._afterLayoutStart)}Create(timelineData){this._timelineDataManager.Add(timelineData);const timeline=
C3.TimelineState.CreateInitial(timelineData,this);this.Add(timeline);this.SetTimelineObjectClassesToMap(timeline);this._timelinesCreatedByTemplate.set(timeline.GetName(),0)}CreateFromTemplate(template){const timelineDataManager=this.GetTimelineDataManager();const templateName=template.GetTemplateName();const timelineDataItem=timelineDataManager.Get(templateName);const timeline=C3.TimelineState.CreateFromTemplate(`${templateName}:${this._timelinesCreatedByTemplate.get(templateName)}`,timelineDataItem,
this);this._IncreaseTemplateTimelinesCount(templateName);this.Add(timeline);return timeline}_IncreaseTemplateTimelinesCount(templateName){this._timelinesCreatedByTemplate.set(templateName,this._timelinesCreatedByTemplate.get(templateName)+1)}_SetCreatedTemplateTimelinesCount(){for(const timeline of this._timelines){if(timeline.IsTemplate())continue;const templateName=timeline.GetTemplateName();this._IncreaseTemplateTimelinesCount(templateName)}}_ClearCreatedTemplateTimelinesCount(){for(const templateName of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(templateName,
0)}Add(timeline){this._timelines.push(timeline);this._timelinesByName.set(timeline.GetName().toLowerCase(),timeline)}Remove(timeline){timeline.Removed();if(timeline.IsTemplate())return;C3.arrayFindRemove(this._timelines,timeline);C3.arrayFindRemove(this._scheduledTimelines,timeline);C3.arrayFindRemove(this._playingTimelines,timeline);C3.arrayFindRemove(this._markedForRemovalTimelines,timeline);this._timelinesByName.delete(timeline.GetName().toLowerCase());this.RemoveTimelineFromObjectClassMap(timeline);
if(!timeline.IsReleased())timeline.Release()}Trigger(method){this._runtime.Trigger(method,this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(inst){this._pluginInstance=inst}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(const timeline of this._timelines)yield timeline}*GetPlayingTimelines(){for(const timeline of this._playingTimelines)yield timeline}SetTimelineObjectClassToMap(objectClass,timeline){if(!this._objectClassToTimelineMap.has(objectClass))this._objectClassToTimelineMap.set(objectClass,
new Set);this._objectClassToTimelineMap.get(objectClass).add(timeline)}SetTimelineObjectClassesToMap(timeline){for(const objectClass of timeline.GetObjectClasses())this.SetTimelineObjectClassToMap(objectClass,timeline)}RemoveTimelineFromObjectClassMap(timeline){for(const [objectClass,timelines]of this._objectClassToTimelineMap.entries())if(timelines.has(timeline)){timelines.delete(timeline);if(timelines.size===0)this._objectClassToTimelineMap.delete(objectClass)}}GetTimelinesForObjectClass(objectClass){if(!this._objectClassToTimelineMap.has(objectClass))return;
return this._objectClassToTimelineMap.get(objectClass)}GetTimelineOfTemplateForInstances(templateTimeline,instancesObject){if(!instancesObject)return;for(const timeline of this._timelines){const found=instancesObject.every(io=>{return timeline.HasTrackInstance(io.instance,io.trackId)});if(found)if(timeline.GetName().includes(templateTimeline.GetName()))return timeline}}GetTimelineByName(name){return this._timelinesByName.get(name.toLowerCase())||null}GetScheduledOrPlayingTimelineByName(name){for(const timeline of this._scheduledTimelines)if(timeline.GetName()===
name)return timeline;for(const timeline of this._playingTimelines)if(timeline.GetName()===name)return timeline;return null}*GetTimelinesByName(name){if(NAMES_REGEXP.test(name)){NAMES_REGEXP.lastIndex=0;let match;const uniqueNames=new Set;do{match=NAMES_REGEXP.exec(name);if(match){const names=match[1].split(",");for(const name of names)uniqueNames.add(name)}}while(match);for(const name of uniqueNames.values()){const timeline=this.GetTimelineByName(name);if(timeline)yield timeline}uniqueNames.clear()}else{const timeline=
this.GetTimelineByName(name);if(timeline)yield timeline}}*GetTimelinesByTags(tags){for(const timeline of this._timelines)if(timeline.HasTags(tags))yield timeline}AddScheduledTimeline(timeline){if(!this._scheduledTimelines.includes(timeline))this._scheduledTimelines.push(timeline);this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(timeline){C3.arrayFindRemove(this._playingTimelines,timeline);this._MaybeDisableRuntimeListeners()}ScheduleTimeline(timeline){if(this._playingTimelines.includes(timeline)){timeline.SetPlaying(true);
timeline.SetScheduled(false);timeline.SetMarkedForRemoval(false)}else{timeline.SetPlaying(false);timeline.SetScheduled(true);timeline.SetMarkedForRemoval(false);if(!this._scheduledTimelines.includes(timeline))this._scheduledTimelines.push(timeline)}this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(timeline){timeline.SetPlaying(false);timeline.SetScheduled(false);timeline.ResolvePlayPromise();C3.arrayFindRemove(this._scheduledTimelines,timeline);this._MaybeDisableRuntimeListeners()}CompleteTimeline(timeline){timeline.SetPlaying(false);
timeline.SetScheduled(false);if(this._playingTimelines.includes(timeline)){timeline.SetMarkedForRemoval(true);this._markedForRemovalTimelines.push(timeline);C3.arrayFindRemove(this._playingTimelines,timeline)}}CompleteTimelineBeforeChangeOfLayout(timeline){timeline.SetPlaying(false);timeline.SetScheduled(false);timeline.SetMarkedForRemoval(false);timeline.SetPlaybackRate(1);C3.arrayFindRemove(this._playingTimelines,timeline)}CompleteTimelineAndResolve(timeline){this.CompleteTimeline(timeline);timeline.ResolvePlayPromise()}_OnTick(){if(this.GetRuntime().IsLoadingState())return;
if(!this._hasRuntimeListeners)return;if(this._changingLayout)return;this._isTickingTimelines=true;while(this._scheduledTimelines.length){const t=this._scheduledTimelines.pop();t.SetInitialState();if(t.GetRenderChange()!==0)this._renderChange=1;this._playingTimelines.push(t)}const dt=this._runtime._GetDtFast();const dt1=this._runtime.GetDt1();const ts=this._runtime.GetTimeScale();for(let i=this._playingTimelines.length-1;i>=0;i--){const t=this._playingTimelines[i];if(t)t.Tick(dt,ts,dt1)}this._isTickingTimelines=
false;if(this._renderChange!==0)this.GetRuntime().UpdateRender()}_OnTick2(){if(this.GetRuntime().IsLoadingState())return;if(!this._hasRuntimeListeners)return;if(this._changingLayout)return;let timelinesToRemove;for(let i=0,l=this._markedForRemovalTimelines.length;i<l;i++){const t=this._markedForRemovalTimelines[i];if(!timelinesToRemove)timelinesToRemove=new Set;t.Removed();this._MaybeExecuteTimelineFinishTriggers(t);timelinesToRemove.add(t)}if(timelinesToRemove){C3.arrayRemoveAllInSet(this._markedForRemovalTimelines,
timelinesToRemove);this._renderChange=0;for(let i=0,l=this._playingTimelines.length;i<l;i++)if(this._playingTimelines[i].GetRenderChange()!==0){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}_MaybeExecuteTimelineFinishTriggers(timeline){if(timeline.IsReleased())return;if(!timeline.HasValidTracks())return;if(timeline.IsComplete()&&timeline.InitialStateSet())timeline.FinishTriggers()}_MaybeEnableRuntimeListeners(){if(this._hasRuntimeListeners)return;this._hasRuntimeListeners=true}_MaybeDisableRuntimeListeners(){if(this._markedForRemovalTimelines.length)return;
if(this._playingTimelines.length)return;if(this._scheduledTimelines.length)return;if(this._isTickingTimelines)return;this._hasRuntimeListeners=false}_OnBeforeChangeLayout(){this._changingLayout=true;while(this._scheduledTimelines.length)this.DeScheduleTimeline(this._scheduledTimelines.pop());const timelinesToRemove=new Set;for(const t of this._playingTimelines){const remove=t._OnBeforeChangeLayout();if(remove){t.Removed();timelinesToRemove.add(t)}}C3.arrayRemoveAllInSet(this._playingTimelines,timelinesToRemove);
timelinesToRemove.clear();for(const t of this._markedForRemovalTimelines){const remove=t._OnBeforeChangeLayout();if(remove){t.Removed();timelinesToRemove.add(t)}}C3.arrayRemoveAllInSet(this._markedForRemovalTimelines,timelinesToRemove);this._MaybeDisableRuntimeListeners();for(const timeline of this._timelines)timeline.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=false}_OnInstanceDestroy(instance){const objectClass=instance.GetObjectClass();const timelines=this.GetTimelinesForObjectClass(objectClass);
if(!timelines)return;if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(instance);else for(const timeline of timelines){if(timeline.IsTemplate())continue;if(timeline.IsReleased()){this.Remove(timeline);continue}if(!timeline.HasValidTracks()){this._MaybeExecuteTimelineFinishTriggers(timeline);this.Remove(timeline)}}}_OnBeforeLoad(){for(const timeline of this._scheduledTimelines.map(t=>t)){this._MaybeExecuteTimelineFinishTriggers(timeline);this.Remove(timeline)}for(const timeline of this._playingTimelines.map(t=>
t)){this._MaybeExecuteTimelineFinishTriggers(timeline);this.Remove(timeline)}}_OnAfterLoad(){for(const destroyedInstance of this._destroyedWhileLoadingState)this._OnInstanceDestroy(destroyedInstance);C3.clearArray(this._destroyedWhileLoadingState);for(const timeline of this._timelines)timeline._OnAfterLoad()}_OnAfterLayoutStart(){const layoutManager=this._runtime.GetLayoutManager();const runningLayout=layoutManager.GetMainRunningLayout();if(!runningLayout)return;for(const timeline of this._timelines){const startOnLayout=
timeline.GetStartOnLayout();if(!startOnLayout)continue;if(runningLayout.GetName()===startOnLayout)this.ScheduleTimeline(timeline)}}_SaveToJson(){return{"timelinesJson":this._SaveTimelinesToJson(),"scheduledTimelinesJson":this._SaveScheduledTimelinesToJson(),"playingTimelinesJson":this._SavePlayingTimelinesToJson(),"markedForRemovalTimelinesJson":this._SaveMarkedForRemovalTimelinesToJson(),"hasRuntimeListeners":this._hasRuntimeListeners,"changingLayout":this._changingLayout,"isTickingTimelines":this._isTickingTimelines}}_LoadFromJson(o){if(!o)return;
this._ClearCreatedTemplateTimelinesCount();this._LoadTimelinesFromJson(o["timelinesJson"]);this._LoadScheduledTimelinesFromJson(o["scheduledTimelinesJson"]);this._LoadPlayingTimelinesFromJson(o["playingTimelinesJson"]);this._LoadMarkedForRemovalTimelinesFromJson(o["markedForRemovalTimelinesJson"]);this._hasRuntimeListeners=!o["hasRuntimeListeners"];this._changingLayout=!!o["changingLayout"];this._isTickingTimelines=!!o["isTickingTimelines"];this._SetCreatedTemplateTimelinesCount();this._MaybeEnableRuntimeListeners();
this._MaybeDisableRuntimeListeners()}_SaveTimelinesToJson(){return this._timelines.map(timelineState=>timelineState._SaveToJson())}_LoadTimelinesFromJson(timelinesJson){for(const timelineJson of timelinesJson){let timeline=this.GetTimelineByName(timelineJson["name"]);if(timeline)timeline._LoadFromJson(timelineJson);else{const templateName=this._GetTemplateNameFromJson(timelineJson);if(!templateName)continue;const templateTimeline=this.GetTimelineByName(templateName);timeline=this.CreateFromTemplate(templateTimeline);
timeline._LoadFromJson(timelineJson)}if(!timeline.HasTracks())this.Remove(timeline)}}_GetTemplateNameFromJson(timelineJson){const name=timelineJson["name"];const nameParts=name.split(":");if(!nameParts||nameParts.length!==2)return null;return nameParts[0]}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(scheduledTimelinesJson){this._LoadTimelines(scheduledTimelinesJson,this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(playingTimelinesJson){this._LoadTimelines(playingTimelinesJson,
this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(markedForRemovalTimelinesJson){this._LoadTimelines(markedForRemovalTimelinesJson,this._markedForRemovalTimelines)}_IsTimelineInJson(timeline,json){if(!json)return false;for(const name of json)if(name===timeline.GetName())return true;return false}_SaveTimelines(collection){return collection.map(t=>t.GetName())}_LoadTimelines(timelinesJson,
collection){const timelinesToRemove=new Set;for(const timeline of collection)if(!this._IsTimelineInJson(timeline,timelinesJson))timelinesToRemove.add(timeline);C3.arrayRemoveAllInSet(collection,timelinesToRemove);if(timelinesJson){const ff=tn=>t=>t.GetName()===tn;for(const name of timelinesJson){const timeline=this.GetTimelineByName(name);if(timeline){const t=collection.find(ff(name));if(!t)collection.push(timeline)}}}}};

}

// timelines/timelineInfo.js
{
'use strict';const C3=self.C3;const STEPS=100;const LENGTH_STEP_SIZE=.01;const BEZIER_STEP_SIZE=30;const TANGENT_RESULT=[0,0];const MAP_RESULT=[0,0];const PROJECTION_RESULT=[0,0,0,0,0];
C3.TimelineInfo=class TimelineInfo{constructor(timeline,trackId){this._initialized=false;this._timeline=timeline;this._segments=[];let trackState=null;if(trackId)trackState=this._timeline.GetTrackById(trackId);else trackState=C3.first(this._timeline.GetTracks());if(!trackState)return;const xTrack=trackState.GetPropertyTrack("offsetX");const yTrack=trackState.GetPropertyTrack("offsetY");if(!xTrack||!yTrack)return;this._xTrack=xTrack;this._yTrack=yTrack;const xPropertyKeyframes=xTrack.GetPropertyKeyframeDataItemArrayIncludingDisabled();
const yPropertyKeyframes=yTrack.GetPropertyKeyframeDataItemArrayIncludingDisabled();for(let i=1,len=Math.min(xPropertyKeyframes.length,yPropertyKeyframes.length);i<len;++i){const startX=xPropertyKeyframes[i];const endX=startX.GetNext();const prevX=startX.GetPrevious();const startY=yPropertyKeyframes[i];const endY=startY.GetNext();const prevY=startY.GetPrevious();if(prevX&&prevX.GetPathMode()==="cubic-bezier"&&prevY&&prevY.GetPathMode()==="cubic-bezier")this._segments.push(C3.New(C3.TimelineCubicBezierSegmentInfo,
prevX,prevY,startX,startY,this._segments.length));else if(prevX&&prevX.GetPathMode()==="line"&&prevY&&prevY.GetPathMode()==="line")this._segments.push(C3.New(C3.TimelineLineSegmentInfo,startX,startY,this._segments.length));else this._segments.push(C3.New(C3.TimelineLineSegmentInfo,startX,startY,this._segments.length))}this._initialized=true}Release(){for(const segment of this._segments)segment.Release();C3.clearArray(this._segments);this._segments=null;this._timeline=null;this._xTrack=null;this._yTrack=
null}WasInitialized(){return this._initialized}segments(){return this._segments}SetOrigin(wi){const ox=this._xTrack.GetResultMode()==="relative"?wi.GetX():0;const oy=this._yTrack.GetResultMode()==="relative"?wi.GetY():0;for(const segment of this._segments)segment.SetOrigin(ox,oy)}Project(x,y,opts){if(opts&&opts.tRange){if(!C3.IsFiniteNumber(opts.tRange[0]))opts.tRange[0]=0;if(!C3.IsFiniteNumber(opts.tRange[1]))opts.tRange[1]=1}const ret=[];for(const segment of this._segments)if(segment.GetType()===
"cubic-bezier"){const p=segment.Project(x,y,opts?opts.tRange:null);p[4]=segment.GetIndex();ret.push(JSON.parse(JSON.stringify(p)))}ret.sort((f,s)=>f[3]-s[3]);return ret[0]}Tangent(t,segmentIndex){return this._segments[segmentIndex].Tangent(t)}TangentAngle(x,y,t,segmentIndex){return this._segments[segmentIndex].TangentAngle(x,y,t)}};
C3.TimelineCubicBezierSegmentInfo=class TimelineCubicBezierSegmentInfo{constructor(startX,startY,endX,endY,index){this._index=index;const startXAddon=startX.GetAddOn("cubic-bezier");const endXAddon=endX.GetAddOn("cubic-bezier");const startYAddon=startY.GetAddOn("cubic-bezier");const endYAddon=endY.GetAddOn("cubic-bezier");this._aX=startX.GetValueWithResultMode();this._aY=startY.GetValueWithResultMode();this._bX=startX.GetValueWithResultMode()+startXAddon.GetStartAnchor();this._bY=startY.GetValueWithResultMode()+
startYAddon.GetStartAnchor();this._cX=endX.GetValueWithResultMode()+endXAddon.GetEndAnchor();this._cY=endY.GetValueWithResultMode()+endYAddon.GetEndAnchor();this._dX=endX.GetValueWithResultMode();this._dY=endY.GetValueWithResultMode();this._initialized=false;this._len=STEPS;this._arcLengths=new Array(this._len+1);this._arcLengths[0]=0;this._length=0;this._lut=[];this._CalculateLength()}Release(){C3.clearArray(this._arcLengths);this._arcLengths=null;C3.clearArray(this._lut);this._lut=null}GetType(){return"cubic-bezier"}GetIndex(){return this._index}GetStepCount(){return Math.floor(this._length/
BEZIER_STEP_SIZE)}GetStepIncrement(){return 1/this.GetStepCount()}SetOrigin(ox,oy){this._originX=ox;this._originY=oy;this._arcLengths=new Array(this._len+1);this._arcLengths[0]=0;this._CalculateLength()}Map(u){if(!this._initialized)return NaN;const mt=this._Map(u);MAP_RESULT[0]=this._X(mt);MAP_RESULT[1]=this._Y(mt);return MAP_RESULT}Project(x,y,tRange){const lut=this._GenerateLUT(STEPS);const i=this._FindClosestFromLUT(x,y,lut,tRange);const p=this._RefineProjection(x,y,lut,i);PROJECTION_RESULT[0]=
p.x;PROJECTION_RESULT[1]=p.y;PROJECTION_RESULT[2]=p.t;PROJECTION_RESULT[3]=p.distance;return PROJECTION_RESULT}Tangent(t){const mt=1-t;const a=mt*mt;const b=2*mt*t;const c=t*t;const d0x=3*(this._bX+this._originX-(this._aX+this._originX));const d0y=3*(this._bY+this._originY-(this._aY+this._originY));const d1x=3*(this._cX+this._originX-(this._bX+this._originX));const d1y=3*(this._cY+this._originY-(this._bY+this._originY));const d2x=3*(this._dX+this._originX-(this._cX+this._originX));const d2y=3*(this._dY+
this._originY-(this._cY+this._originY));const dx=a*d0x+b*d1x+c*d2x;const dy=a*d0y+b*d1y+c*d2y;const m=Math.hypot(dx,dy);TANGENT_RESULT[0]=dx/m;TANGENT_RESULT[1]=dy/m;return TANGENT_RESULT}TangentAngle(x,y,t){const tanget=this.Tangent(t);const angle=C3.angleTo(x,y,x+tanget[0],y+tanget[1]);return angle}_Map(u){if(!this._initialized)return;let targetLength=u*this._arcLengths[this._len];let low=0;let high=this._len;let index=0;while(low<high){index=low+((high-low)/2|0);if(this._arcLengths[index]<targetLength)low=
index+1;else high=index}if(this._arcLengths[index]>targetLength)index--;const lengthBefore=this._arcLengths[index];if(lengthBefore===targetLength)return index/this._len;else return(index+(targetLength-lengthBefore)/(this._arcLengths[index+1]-lengthBefore))/this._len}_X(t){if(!this._initialized)return NaN;return self.Ease.GetRuntimeEase("cubicbezier")(t,this._aX+this._originX,this._bX+this._originX,this._cX+this._originX,this._dX+this._originX)}_Y(t){if(!this._initialized)return NaN;return self.Ease.GetRuntimeEase("cubicbezier")(t,
this._aY+this._originY,this._bY+this._originY,this._cY+this._originY,this._dY+this._originY)}_GenerateLUT(steps){steps=steps||STEPS;if(this._lut.length===steps)return this._lut;this._lut=[];steps++;for(let i=0;i<steps;i++){const t=i/(steps-1);const x=this._X(t);const y=this._Y(t);this._lut.push({x:x,y:y,t:t,distance:0})}return this._lut}_FindClosestFromLUT(x,y,LUT,tRange=null,distance=Number.MAX_SAFE_INTEGER){let i=0;LUT.forEach((p,index)=>{p.t=index/(LUT.length-1);p.distance=C3.distanceTo(x,y,p.x,
p.y);if(tRange&&C3.IsArray(tRange)&&C3.IsFiniteNumber(tRange[0])&&C3.IsFiniteNumber(tRange[1])){if(p.t>=tRange[0]&&p.t<=tRange[1])if(p.distance<distance){distance=p.distance;i=index}}else if(p.distance<distance){distance=p.distance;i=index}});return i}_RefineProjection(x,y,LUT,i,targetDistance=0,epsilon=1){let q=LUT[i];let count=1;let distance=Number.MAX_SAFE_INTEGER;do{let i1=i===0?0:i-1;let i2=i===LUT.length-1?LUT.length-1:i+1;let t1=LUT[i1].t;let t2=LUT[i2].t;let lut=[];let step=(t2-t1)/4;if(step<
.001)break;lut.push(LUT[i1]);for(let j=1;j<=3;j++){const t=t1+j*step;const pathX=this._X(t);const pathY=this._Y(t);const pathDistance=Math.abs(C3.distanceTo(pathX,pathY,x,y)-targetDistance);if(pathDistance<distance){distance=pathDistance;q={x:pathX,y:pathY,t:t,distance:pathDistance};i=j}lut.push({x:pathX,y:pathY,t:t,distance:pathDistance})}lut.push(LUT[i2]);LUT=lut}while(count++<25);if(targetDistance&&distance>epsilon)q=null;return q}_CalculateLength(){this._initialized=true;let ox=this._X(0);let oy=
this._Y(0);let clen=0;for(let i=1;i<=this._len;i++){const x=this._X(i*LENGTH_STEP_SIZE);const y=this._Y(i*LENGTH_STEP_SIZE);const dx=ox-x;const dy=oy-y;clen+=Math.hypot(dx,dy);this._arcLengths[i]=clen;ox=x;oy=y}this._length=clen}};
C3.TimelineLineSegmentInfo=class TimelineLineSegmentInfo{constructor(startX,startY,index){this._index=index;this._targetX=startX.GetValueWithResultMode();this._targetY=startY.GetValueWithResultMode();this._originX=0;this._originY=0}Release(){}GetType(){return"line"}GetIndex(){return this._index}SetOrigin(ox,oy){this._originX=ox;this._originY=oy}GetX(){return this._targetX+this._originX}GetY(){return this._targetY+this._originY}};

}

// timelines/state/timelineState.js
{
'use strict';const C3=self.C3;const PING_PONG_BEGIN=0;const PING_PONG_END=1;
C3.TimelineState=class Timeline extends C3.DefendedBase{constructor(name,timelineDataItem,timelineManager){super();this._runtime=timelineManager.GetRuntime();this._timelineManager=timelineManager;this._timelineDataItem=timelineDataItem;this._name=name;this._tracks=[];this._tracksLength=0;this._beforeAndAfterTracks=null;this._beforeAndAfterTracksLength=0;this.CreateTrackStates();this._playPromise=null;this._playResolve=null;this._playheadTime=0;this._overshoot=0;this._playbackRate=1;this._pingPongState=
PING_PONG_BEGIN;this._currentRepeatCount=1;this._isPlaying=false;this._isScheduled=false;this._initialStateSet=false;this._complete=true;this._released=false;this._markedForRemoval=false;this._completedTick=-1;this._implicitPause=false;this._isTemplate=false;this._finishedTriggers=false;this._firstTick=false;this._lastDelta=NaN;this._tags=[""];this._stringTags="";this._tagsChanged=false;this._renderChange=0;this._hasNestedContent=0;this._iTimelineState=null}static CreateInitial(timelineDataJson,timelineManager){const timelineDataManager=
timelineManager.GetTimelineDataManager();const nameId=timelineDataManager.GetNameId();const timelineDataItem=timelineDataManager.Get(timelineDataJson[nameId]);const timeline=C3.New(C3.TimelineState,timelineDataJson[nameId],timelineDataItem,timelineManager);timeline.SetIsTemplate(true);return timeline}static CreateFromTemplate(name,timelineDataItem,timelineManager){return C3.New(C3.TimelineState,name,timelineDataItem,timelineManager)}Release(){if(this.IsReleased())return;const dispatcher=this._runtime.Dispatcher();
this._timelineManager.DeScheduleTimeline(this);this._timelineManager.CompleteTimelineAndResolve(this);for(const track of this._tracks)track.Release();C3.clearArray(this._tracks);this._tracks=null;this._runtime=null;this._timelineManager=null;this._timelineDataItem=null;this._released=true;this._playPromise=null;this._playResolve=null;this.FireReleaseEvent(dispatcher)}FireReleaseEvent(dispatcher){const event=C3.New(C3.Event,"timelinestatereleased");event.timelineState=this;dispatcher.dispatchEvent(event)}GetType(){return 0}CreateTrackStates(){for(const trackDataItem of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=
this._tracks.push(C3.TrackState.Create(this,trackDataItem))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(instance,sourceAdapter,propertyName,propertyTrack){if(!this._hasNestedContent)return;let ret;for(let i=0;i<this._tracks.length;i++){let track=this._tracks[i];if(instance!==track.GetInstance())continue;const pt=track.GetPropertyTrack(propertyName);if(!pt)continue;if(sourceAdapter.constructor!==pt.GetSourceAdapter().constructor)continue;
if(pt.GetResultMode()!==propertyTrack.GetResultMode())continue;if(!ret)ret=[];ret.push(pt)}return ret}HasTracks(){return!!this._tracks.length}GetTrackById(trackId){for(const track of this._tracks)if(C3.equalsNoCase(track.GetId(),trackId))return track;return null}GetTrackByName(name){for(const track of this._tracks){if(track.IsInstanceTrack())continue;if(C3.equalsNoCase(track.GetName(),name))return track}return null}SetName(name){this._name=name}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(tt){this._timelineDataItem.SetTotalTime(tt)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(s){this._timelineDataItem.SetStep(s)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(im){this._timelineDataItem.SetInterpolationMode(im)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(rm){this._timelineDataItem.GetResultMode(rm)}SetEase(e){for(const track of this.GetTracks())track.SetEase(e)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(l){return this._timelineDataItem.SetLoop(l)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(p){return this._timelineDataItem.SetPingPong(p)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetRepeatCount(rc){return this._timelineDataItem.SetRepeatCount(rc)}SetPlaybackRate(r){return this._playbackRate=
r}GetPlaybackRate(){return this._playbackRate}GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout()}GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph()}GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale()}GetPingPongState(){return this._pingPongState}IsForwardPlayBack(){if(!this.IsPlaying())return true;return this._playbackRate>0}GetPlayPromise(){if(this._playPromise)return this._playPromise;this._playPromise=new Promise(resolve=>
{this._playResolve=resolve});return this._playPromise}ResolvePlayPromise(){if(!this._playPromise)return;this._playResolve();this._playPromise=null;this._playResolve=null}SetTags(tags){this._tags=C3.TimelineState._GetTagArray(tags);this._tagsChanged=true}GetTags(){return this._tags}GetStringTags(){if(this._tagsChanged)this._stringTags=this._tags.join(" ");this._tagsChanged=false;return this._stringTags}HasTags(tags){if(!this._tags)return false;if(!this._tags.length)return false;const t=C3.TimelineState._GetTagArray(tags);
if(!t)return false;if(!t.length)return false;return t.every(C3.TimelineState._HasTag,this)}OnStarted(){if(!C3.Plugins.Timeline||this.constructor!==C3.TimelineState)return;C3.Plugins.Timeline.Cnds.PushTriggerTimeline(this);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimelineStarted);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimelineStartedByName);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimelineStartedByTags);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnAnyTimelineStarted);
C3.Plugins.Timeline.Cnds.PopTriggerTimeline()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(this._finishedTriggers)return;this._finishedTriggers=true;if(!C3.Plugins.Timeline||this.constructor!==C3.TimelineState)return;C3.Plugins.Timeline.Cnds.PushTriggerTimeline(this);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimelineFinished);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimelineFinishedByName);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimelineFinishedByTags);
this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnAnyTimelineFinished);C3.Plugins.Timeline.Cnds.PopTriggerTimeline()}SetPlaying(p){this._isPlaying=p}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(playingOnly=false){if(this.IsCompletedTick())return true;if(this.IsScheduled()&&!playingOnly)return true;return this._isPlaying}_IsPlaying(){return this.IsPlaying(true)}IsPaused(){return this._IsPaused()}_IsPaused(){if(this.IsReleased())return false;if(this.IsScheduled())return false;
if(this._IsPlaying())return false;if(this.IsComplete())return false;return true}SetScheduled(s){this._isScheduled=s}IsScheduled(){return this._isScheduled}SetComplete(c){this._complete=c;const t=this.GetTime();if(t<=0||t>=this.GetTotalTime())this._complete=true}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(mfr){this._markedForRemoval=mfr}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(ip){this._implicitPause=ip}IsImplicitPause(){return this._implicitPause}SetIsTemplate(it){this._isTemplate=
!!it}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(time){const lastGlobalTime=this.GetTime();this._SetTime(time);this.SetComplete(false);if(!this.IsComplete())this.SetImplicitPause(true);if(!this._IsPlaying()&&!this.IsScheduled()&&this._initialStateSet);else if(!this._IsPlaying()&&!this.IsScheduled()&&!this._initialStateSet)this.SetInitialStateFromSetTime();else if(this._IsPlaying())this.Stop();else if(this.IsScheduled()){this._timelineManager.DeScheduleTimeline(this);
this.SetInitialStateFromSetTime()}this._SetUpdateStateBefore();this._Interpolate(this.GetTime(),false,true,true,lastGlobalTime);this._SetUpdateStateAfter();if(this._renderChange)this.GetRuntime().UpdateRender();this._OnSetTime()}_SetTime(time){if(!C3.IsFiniteNumber(time))time=this.GetTotalTime();if(time<0)this._playheadTime=0;else if(time>=this.GetTotalTime())this._playheadTime=this.GetTotalTime();else this._playheadTime=time}_SetTimeAndReset(time){if(!C3.IsFiniteNumber(time))time=this.GetTotalTime();
if(time<0)this._playheadTime=0;else if(time>=this.GetTotalTime())this._playheadTime=this.GetTotalTime();else this._playheadTime=time;for(const track of this._tracks)track.SetResetState()}_OnSetTime(){if(!C3.Plugins.Timeline||this.constructor!==C3.TimelineState)return;C3.Plugins.Timeline.Cnds.PushTriggerTimeline(this);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimeSet);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimeSetByName);this._timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnTimeSetByTags);
C3.Plugins.Timeline.Cnds.PopTriggerTimeline()}_CanResume(){if(this.GetLoop())return true;else if(this.GetPingPong()&&this._pingPongState===PING_PONG_END)if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return false}else{if(this.GetTime()<=0)return false}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return false}else if(this.GetTime()<=0)return false;return true}Resume(){if(this.IsReleased())return;if(this._CanResume())this.Play(true)}Play(resume=
false){if(this.IsReleased())return false;if(this.IsScheduled())return false;if(this._IsPlaying()&&this.IsCompletedTick())return this._SchedulePlayingTimeline();if(this._IsPlaying())return false;if(!this.IsComplete()&&!resume&&!this.IsImplicitPause())return false;return this._ScheduleStoppedTimeline()}_SchedulePlayingTimeline(){this.SetImplicitPause(false);this._timelineManager.RemovePlayingTimeline(this);this._timelineManager.ScheduleTimeline(this);this.GetPlayPromise();return true}_ScheduleStoppedTimeline(){this.SetImplicitPause(false);
this._timelineManager.ScheduleTimeline(this);this.GetPlayPromise();return true}Stop(completed=false){if(this.IsReleased())return;this.SetComplete(completed);this._timelineManager.CompleteTimeline(this);if(this.IsComplete())this.ResolvePlayPromise()}Reset(render=true,beforeChangeLayout=false){if(this.IsReleased())return;if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(this.IsComplete())return;this.Stop(true);if(this.IsForwardPlayBack())this._SetTime(0);
else this._SetTime(this.GetTotalTime());const time=this.GetTime();this._SetUpdateStateBefore();if(beforeChangeLayout)this._InterpolateBeforeChangeLayout(time);else this._Interpolate(time,false,false,true);if(render)this._OnSetTime();this._SetUpdateStateAfter();if(this._renderChange&&render)this.GetRuntime().UpdateRender()}ResetBeforeChangeLayout(){this.Reset(false,true)}_InterpolateBeforeChangeLayout(time){this._Interpolate(time,false,false,true,NaN,false,true)}_OnBeforeChangeLayout(){if(this.IsReleased())return true;
if(!this.GetRuntime().IsLoadingState())if(this.HasValidGlobalTracks())return false;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this);if(!this.GetRuntime().IsLoadingState())this.ResetBeforeChangeLayout();return true}SetInitialStateFromSetTime(){this.SetInitialState(true)}SetInitialState(fromSetTime){if(this.IsMarkedForRemoval())return;if(fromSetTime){this._finishedTriggers=false;this._initialStateSet=true;this._firstTick=true;this._SetUpdateStateBefore();for(const track of this._tracks)track.SetInitialState();
this._SetUpdateStateAfter()}else{this.SetPlaying(true);this.SetScheduled(false);this.OnStarted();if(this.IsComplete()){this._completedTick=-1;if(this._pingPongState!==PING_PONG_BEGIN)this._playbackRate=Math.abs(this._playbackRate);this._pingPongState=PING_PONG_BEGIN;this._currentRepeatCount=1;this._complete=false;this._finishedTriggers=false;this._initialStateSet=true;this._firstTick=true;if(this.IsForwardPlayBack())this._SetTime(0);else this._SetTime(this.GetTotalTime());this._SetUpdateStateBefore();
for(const track of this._tracks)track.SetInitialState();this._SetUpdateStateAfter()}else{this._firstTick=true;this._finishedTriggers=false;this._SetUpdateStateBefore();for(const track of this._tracks)track.SetResumeState();this._SetUpdateStateAfter()}}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(const track of this._tracks)if(track.IsNested())this._hasNestedContent=1}_SetUpdateStateAfter(){this._renderChange=0;for(const track of this._tracks){track._SetUpdateState();
if(this._renderChange===0&&track.GetRenderChange()===1)this._renderChange=1;if(!this._beforeAndAfterTracks&&track.GetNeedsBeforeAndAfter()===1){if(!this._beforeAndAfterTracks)this._beforeAndAfterTracks=[];this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(track)}}}Tick(deltaTime,timeScale,deltaTime1){if(this.GetUseSystemTimescale()){if(deltaTime===0&&this._lastDelta===0)return;this._lastDelta=deltaTime;deltaTime=deltaTime1}else{if(deltaTime1===0&&this._lastDelta===0)return;this._lastDelta=
deltaTime1;deltaTime=deltaTime1;timeScale=1}const lastTime=this._playheadTime+this._overshoot;const newDeltaTime=deltaTime*timeScale*this._playbackRate;const newTime=lastTime+newDeltaTime;const totalTime=this._timelineDataItem._totalTime;if(newTime<0){this._playheadTime=0;this._overshoot=-newTime}else if(newTime>=totalTime){this._playheadTime=totalTime;this._overshoot=this._playheadTime-newTime}else{this._playheadTime=newTime;this._overshoot=0}let complete=false;let ensureValue=false;const loop=this.GetLoop();
const pingPong=this.GetPingPong();if(!loop&&!pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(0);ensureValue=true}else{this._SetTime(totalTime);complete=true}}else{if(this._playheadTime<=0)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(totalTime);ensureValue=true}else{this._SetTime(0);complete=true}}else if(loop&&!pingPong)if(this._playbackRate>
0){if(this._playheadTime>=totalTime){this._SetTimeAndReset(0);ensureValue=true}}else{if(this._playheadTime<=0){this._SetTimeAndReset(totalTime);ensureValue=true}}else if(!loop&&pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_END)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._pingPongState=PING_PONG_BEGIN}else complete=
true;else if(this._pingPongState===PING_PONG_BEGIN)this._pingPongState=PING_PONG_END}}else{if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_END)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._pingPongState=PING_PONG_BEGIN}else complete=true;else if(this._pingPongState===PING_PONG_BEGIN)this._pingPongState=PING_PONG_END}}else if(loop&&pingPong)if(this._playbackRate>0){if(this._playheadTime>=
totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;this._pingPongState++;C3.wrap(this._pingPongState,0,2)}}else if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;this._pingPongState++;C3.wrap(this._pingPongState,0,2)}let i;const l=this._tracksLength;if(complete){for(i=0;i<l;i++)this._tracks[i].SetEndState();this.Stop(true);this.OnCompleted();return}const bal=this._beforeAndAfterTracksLength;
for(i=0;i<bal;i++)this._beforeAndAfterTracks[i].BeforeInterpolate();if(this._hasNestedContent===1)for(i=0;i<l;i++){const track=this._tracks[i];const startOffset=track.GetStartOffset();const localTime=this._playheadTime-startOffset;const lastLocalTime=lastTime-startOffset;if(localTime<0&&lastLocalTime>0){if(startOffset<0)this._playheadTime=0;else if(startOffset>=totalTime)this._playheadTime=totalTime;else this._playheadTime=startOffset;track.Interpolate(startOffset,true,false,ensureValue,this._firstTick,
false)}else track.Interpolate(this._playheadTime,true,false,ensureValue,this._firstTick,false)}else for(i=0;i<l;i++)this._tracks[i].Interpolate(this._playheadTime,true,false,ensureValue,this._firstTick,false);for(i=0;i<bal;i++)this._beforeAndAfterTracks[i].AfterInterpolate();if(this._firstTick)this._firstTick=false}_Interpolate(time,isTicking=false,setTime=false,ensureValue=false,lastTime=NaN,onTickCall=false,ignoreGlobals=false){for(const track of this._tracks)track.BeforeInterpolate();for(const track of this._tracks){let t=
time;if(typeof lastTime==="number"&&!isNaN(lastTime)){const globalTime=this.GetTime();const localTime=globalTime-track.GetStartOffset();const lastLocalTime=lastTime-track.GetStartOffset();if(localTime<0&&lastLocalTime>0){t=track.GetStartOffset();this._SetTime(t)}}track.Interpolate(t,isTicking,setTime,ensureValue,this._firstTick,ignoreGlobals)}for(const track of this._tracks)track.AfterInterpolate();if(this._firstTick&&onTickCall)this._firstTick=false}AddTrack(){const trackDataItem=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();
const track=C3.TrackState.Create(this,trackDataItem);this._tracksLength=this._tracks.push(track);return track}Removed(){if(this.IsReleased())return;for(const track of this._tracks)track.TimelineRemoved()}CleanCaches(){for(const track of this._tracks)track.CleanCaches()}ClearTrackInstances(){for(const track of this._tracks)track.ClearInstance()}SetTrackInstance(trackId,instance,trackIndex){if(!instance)return;if(typeof trackIndex==="number"&&trackIndex>=0){const track=this._tracks[trackIndex];if(!track)return;
track.SetInstance(instance);this._timelineManager.SetTimelineObjectClassToMap(instance.GetObjectClass(),this);return}for(const track of this._tracks){if(!track.IsInstanceTrack())continue;if(trackId){if(track.GetId()!==trackId)continue;track.SetInstance(instance);this._timelineManager.SetTimelineObjectClassToMap(instance.GetObjectClass(),this);break}else{if(track.HasInstance())continue;track.SetInstance(instance);this._timelineManager.SetTimelineObjectClassToMap(instance.GetObjectClass(),this);break}}}HasTrackInstance(instance,
trackId){for(const track of this._tracks){if(!track.IsInstanceTrack())continue;if(trackId){if(trackId===track.GetId()&&instance===track.GetInstance())return true}else if(instance===track.GetInstance())return true}return false}HasValidTracks(){return this._tracks.some(t=>{if(t.IsInstanceTrack())return t.CanInstanceBeValid();else return true})}HasValidGlobalTracks(){return this._tracks.some(t=>{if(t.IsInstanceTrack()){if(!t.CanInstanceBeValid())return false;const objectClass=t.GetObjectClass();if(!objectClass)return false;
return objectClass.IsGlobal()}else return false})}GetPropertyTrack(propertyName){for(const track of this.GetTracks())for(const propertyTrack of track.GetPropertyTracks())if(propertyTrack.GetPropertyName()===propertyName)return propertyTrack}GetTrackFromInstance(instance){for(const track of this._tracks)if(instance===track.GetInstance())return track;return null}GetKeyframeWithTags(tags){let tagsArray=tags?tags.split(" "):[];const tagsSet=new Set(tagsArray.map(t=>t.toLowerCase().trim()));tagsArray=
[...tagsSet.values()];for(const track of this.GetTracks())for(const keyframeDataItem of track.GetKeyframeDataItems()){const hasAllTags=tagsArray.every(t=>keyframeDataItem.HasTag(t));if(hasAllTags)return keyframeDataItem}}GetObjectClasses(){const ret=[];for(const track of this.GetTracks())ret.push(track.GetObjectClass());return ret.filter(oc=>oc)}_OnAfterLoad(){for(const track of this.GetTracks())track._OnAfterLoad()}_SaveToJson(){return{"tracksJson":this._SaveTracksToJson(),"name":this._name,"playheadTime":this.GetTime(),
"playbackRate":this._playbackRate,"pingPongState":this._pingPongState,"currentRepeatCount":this._currentRepeatCount,"isPlaying":this._isPlaying,"isScheduled":this._isScheduled,"initialStateSet":this._initialStateSet,"finishedTriggers":this._finishedTriggers,"complete":this._complete,"released":this._released,"markedForRemoval":this._markedForRemoval,"completedTick":this._completedTick,"implicitPause":this._implicitPause,"isTemplate":this._isTemplate,"tags":this._tags.join(" "),"stringTags":this._stringTags,
"tagsChanged":this._tagsChanged,"firstTick":this._firstTick}}_LoadFromJson(o){if(!o)return;this._LoadTracksFromJson(o["tracksJson"]);this._name=o["name"];this._playheadTime=o["playheadTime"];this._playbackRate=o["playbackRate"];this._pingPongState=o["pingPongState"];this._currentRepeatCount=o["currentRepeatCount"];this._isPlaying=!!o["isPlaying"];this._isScheduled=!!o["isScheduled"];this._initialStateSet=!!o["initialStateSet"];this._finishedTriggers=o.hasOwnProperty("finishedTriggers")?!!o["finishedTriggers"]:
false;this._complete=!!o["complete"];this._released=!!o["released"];this._markedForRemoval=!!o["markedForRemoval"];this._completedTick=o["completedTick"];this._implicitPause=!!o["implicitPause"];this._isTemplate=!!o["isTemplate"];this._tags=o["tags"].split(" ");this._stringTags=o["stringTags"];this._tagsChanged=!!o["tagsChanged"];this._firstTick=!!o["firstTick"]}_SaveTracksToJson(){return this._tracks.map(trackState=>trackState._SaveToJson())}_LoadTracksFromJson(tracksJson){this.ClearTrackInstances();
tracksJson.forEach((trackJson,i)=>{const track=this._tracks[i];track._LoadFromJson(trackJson)});this._tracks.filter(track=>track.CanInstanceBeValid())}static _HasTag(tag){const tags=this.GetTags();if(tag==="")return tags.length===1&&tags[0]==="";return tags.map(t=>t.toLowerCase()).includes(tag.toLowerCase())}static _GetTagArray(tags){if(C3.IsArray(tags))return tags.slice(0);if(C3.IsString(tags))return tags.split(" ");throw new Error("invalid tags");}GetITimelineState(){if(!this._iTimelineState)this._iTimelineState=
C3.New(self.ITimelineState,this);return this._iTimelineState}};

}

// timelines/state/trackState.js
{
'use strict';const C3=self.C3;const INSTANCE_TRACK=0;const VALUE_TRACK=1;const AUDIO_TRACK=2;
C3.TrackState=class Track extends C3.DefendedBase{constructor(timeline,trackDataItem){super();this._timeline=timeline;this._trackDataItem=trackDataItem;this._trackData=trackDataItem.GetTrackData();this._instanceUid=NaN;this._objectClassIndex=NaN;this._instance=null;this._worldInfo=null;this._isNested=trackDataItem.GetStartOffset()>0;this._initialStateOfNestedSet=false;this._endStateOfNestedSet=false;this._instanceUidToLoad=NaN;this._lastKeyframeDataItem=null;this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();
this._propertyTracks=[];this.CreatePropertyTrackStates();this._worldInfoChange=0;this._renderChange=0;this._needsBeforeAndAfter=0}static Create(timeline,trackDataItem){return C3.New(C3.TrackState,timeline,trackDataItem)}Release(){this._keyframeDataItems=null;for(const propertyTrack of this._propertyTracks)propertyTrack.Release();C3.clearArray(this._propertyTracks);this._propertyTracks=null;this._timeline=null;this._instance=null;this._worldInfo=null;this._trackDataItem=null;this._lastKeyframeDataItem=
null}CreatePropertyTrackStates(){for(const propertyTrackDataItem of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C3.PropertyTrackState.Create(this,propertyTrackDataItem))}TimelineRemoved(){for(const propertyTrack of this._propertyTracks)propertyTrack.TimelineRemoved()}CleanCaches(){for(const propertyTrack of this._propertyTracks)propertyTrack.CleanCaches();this._instance=null;this._worldInfo=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){if(this._keyframeDataItems)return this._keyframeDataItems;
this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();return this._keyframeDataItems}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(propertyName){for(let i=0;i<this._propertyTracks.length;i++){const propertyTrack=this._propertyTracks[i];if(propertyTrack.GetPropertyName()===propertyName)return propertyTrack}}MaybeGetInstance(){if(!this._instance)this.GetInstance()}IsInstanceValid(){if(!this._instance)return false;return!this._instance.IsDestroyed()}CanInstanceBeValid(){if(!this.IsInstanceTrack())return false;
const uid=this.GetInstanceUID();const instance=this.GetRuntime().GetInstanceByUID(uid);if(!instance)return false;return!instance.IsDestroyed()}GetObjectClass(){if(!this.IsInstanceTrack())return;const index=this.GetObjectClassIndex();if(index===-1)return;return this.GetRuntime().GetObjectClassByIndex(index)}GetTrackIndexInTimeline(){return this._timeline.GetTracks().indexOf(this)}ClearInstance(){this._instance=null;this._instanceUid=NaN;this._worldInfo=null;this._objectClassIndex=NaN}HasInstance(){return!!this._instance}GetInstance(){if(this._instance&&
this.IsInstanceValid())return this._instance;const uid=this.GetInstanceUID();this._instance=this.GetRuntime().GetInstanceByUID(uid);return this._instance}SetInstance(instance){if(this._instance===instance)return;this.CleanCaches();this._instance=instance;this._objectClassIndex=instance.GetObjectClass().GetIndex();this._instanceUid=instance.GetUID();this._worldInfo=instance.GetWorldInfo();for(const item of this.propertyTrackItems()){const propertyTrack=item.propertyTrack;const sourceAdapter=item.sourceAdapter;
const id=propertyTrack.GetSourceAdapterId();switch(id){case "instance-variable":{const index=sourceAdapter.GetEditorIndex();const objectClass=instance.GetObjectClass();const i=objectClass.GetInstanceVariableIndexByName(item.name);const name=objectClass.GetInstanceVariableName(i);const type=objectClass.GetInstanceVariableType(i);if(name===item.name&&type===item.type)sourceAdapter.UpdateInstanceVariableIndex(i);break}case "behavior":{const timelineBehaviorType=item.behaviorType;const trackObjectClass=
this.GetObjectClass();const objectClass=instance.GetObjectClass();const instanceBehaviorType=sourceAdapter.GetBehaviorType(objectClass);if(timelineBehaviorType&&instanceBehaviorType){const name=timelineBehaviorType.GetName();const templateBehaviorIndex=trackObjectClass.GetBehaviorIndexByName(name);const instanceBehaviorIndex=objectClass.GetBehaviorIndexByName(name);const propertyIndex=sourceAdapter.GetEditorIndex();sourceAdapter.UpdateBehaviorTypeSid(instanceBehaviorType.GetSID())}break}}}}*propertyTrackItems(){for(const propertyTrack of this._propertyTracks){const sourceAdapter=
propertyTrack.GetSourceAdapter();const objectClass=this.GetObjectClass();const ret={propertyTrack:propertyTrack,sourceAdapter:sourceAdapter};switch(propertyTrack.GetSourceAdapterId()){case "world-instance":{ret.property=propertyTrack.GetPropertyName();break}case "instance-variable":{const index=sourceAdapter.GetEditorIndex();ret.name=objectClass.GetInstanceVariableName(index);ret.type=objectClass.GetInstanceVariableType(index);break}case "effect":{const effectList=objectClass.GetEffectList();const effectType=
sourceAdapter.GetEffectType(effectList);ret.effectType=effectType;break}case "behavior":{const behaviorType=sourceAdapter.GetBehaviorType(objectClass);ret.behaviorType=behaviorType;break}case "plugin":{ret.plugin=objectClass.GetPlugin();break}case "value":{break}}yield ret}}GetWorldInfo(){if(this._worldInfo&&this.IsInstanceValid())return this._worldInfo;const instance=this.GetInstance();if(instance)this._worldInfo=instance.GetWorldInfo();return this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){if(!isNaN(this._instanceUid))return this._instanceUid;
return this._trackDataItem.GetInstanceUID()}SetInstanceUID(uid){this._trackDataItem.SetInstanceUID(uid)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(im){this._trackDataItem.SetInterpolationMode(im)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(t){this._trackDataItem.SetLocalTotalTime(t)}SetResultMode(rm){this._trackDataItem.SetResultMode(rm)}SetEase(e){for(const keyframeDataItem of this.GetKeyframeDataItems())keyframeDataItem.SetEase(e);
for(const propertyTrack of this.GetPropertyTracks())propertyTrack.SetEase(e)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(e){this._trackDataItem.SetEnable(e)}GetObjectClassIndex(){if(!isNaN(this._objectClassIndex))return this._objectClassIndex;return this._trackDataItem.GetObjectClassIndex()}SetObjectClassIndex(objectClassIndex){this._trackDataItem.SetObjectClassIndex(objectClassIndex)}SetOriginalWidth(w){this._trackDataItem.SetOriginalWidth(w)}GetOriginalWidth(){const instance=this.GetInstance();
if(instance){const sdkIntance=instance.GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return instance.GetSdkInstance().GetOriginalWidth()}return this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(h){this._trackDataItem.SetOriginalHeight(h)}GetOriginalHeight(){const instance=this.GetInstance();if(instance){const sdkIntance=instance.GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return instance.GetSdkInstance().GetOriginalHeight()}return this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return this.GetType()===
INSTANCE_TRACK}IsValueTrack(){return this.GetType()===VALUE_TRACK}IsAudioTrack(){return this.GetType()===AUDIO_TRACK}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetResetState(){for(const propertyTrack of this._propertyTracks)propertyTrack.SetResetState()}SetInitialState(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;const timeline=
this.GetTimeline();const isForwardPlayBack=timeline.IsForwardPlayBack();const time=isForwardPlayBack?0:this.GetLocalTotalTime();for(const propertyTrack of this._propertyTracks){propertyTrack.SetInitialState(time);if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1}this._needsBeforeAndAfter=0;const nba=this._propertyTracks.some(pt=>pt.GetNeedsBeforeAndAfter());if(nba)this._needsBeforeAndAfter=
1;this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(time);this._initialStateOfNestedSet=false;this._endStateOfNestedSet=false;this.Interpolate(time);this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(time))}SetResumeState(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;const playbackDirection=this._timeline.IsForwardPlayBack();const time=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(time);
for(const propertyTrack of this._propertyTracks)propertyTrack.SetResumeState(time)}SetEndState(){if(this.GetTimeline().IsComplete())return;this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;if(!this._isNested){const time=this._timeline.GetTime();const totalTime=this.GetStartOffset()+this.GetLocalTotalTime();if(time>=totalTime)this.Interpolate(this.GetLocalTotalTime(),true,false,true,false,false,true);else if(time<=0)this.Interpolate(0,true,false,true,false,false,true)}}_SetUpdateState(){for(let i=
0,l=this._propertyTracks.length;i<l;i++){const propertyTrack=this._propertyTracks[i];propertyTrack._SetUpdateState();if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1}}BeforeInterpolate(){const l=this._propertyTracks.length;for(let i=0;i<l;i++)this._propertyTracks[i].BeforeInterpolate()}Interpolate(time,isTicking=false,setTime=false,ensureValue=false,firstTick=false,ignoreGlobals=
false,endState=false){if(!this._instance)this.GetInstance();const instanceValid=this._instance&&!this._instance.IsDestroyed();const isInstanceTrack=this._trackDataItem._type===INSTANCE_TRACK;if(!instanceValid&&isInstanceTrack)return;if(ignoreGlobals&&isInstanceTrack&&this.GetObjectClass().IsGlobal())return;time=time-this.GetStartOffset();if(time<0)return;this.MaybeSetInitialStateOfNestedTrack(time,isTicking);this.MaybeTriggerKeyframeReachedConditions(time,isTicking,firstTick);for(let i=0,l=this._propertyTracks.length;i<
l;i++)this._propertyTracks[i].Interpolate(time,setTime,ensureValue,endState);this.MaybeSetEndStateOfNestedTrack(time,isTicking);if(this._worldInfoChange!==0){if(!this._worldInfo)this._worldInfo=this._instance.GetWorldInfo();if(this._worldInfo)this._worldInfo.SetBboxChanged()}}AfterInterpolate(){const l=this._propertyTracks.length;for(let i=0;i<l;i++)this._propertyTracks[i].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(time,isTicking){if(!isTicking)return;if(!this._isNested)return;if(this._initialStateOfNestedSet)return;
const timeline=this.GetTimeline();if(timeline.IsForwardPlayBack()){if(time<0)return}else if(time>this.GetLocalTotalTime())return;for(const propertyTrack of this._propertyTracks)propertyTrack.SetInitialState();this._initialStateOfNestedSet=true}MaybeSetEndStateOfNestedTrack(time,isTicking){if(!isTicking)return;if(!this._isNested)return;if(this._endStateOfNestedSet)return;const timeline=this.GetTimeline();if(timeline.IsForwardPlayBack()){if(time>=this.GetLocalTotalTime()){for(const propertyTrack of this._propertyTracks)propertyTrack.Interpolate(this.GetLocalTotalTime(),
false,true);this._endStateOfNestedSet=true}}else if(time<=0){for(const propertyTrack of this._propertyTracks)propertyTrack.Interpolate(0,false,true);this._endStateOfNestedSet=true}}MaybeTriggerKeyframeReachedConditions(time,isTicking,firstTick){if(firstTick)return;if(!isTicking)return;if(!C3.Plugins.Timeline)return;const timeline=this.GetTimeline();const nextKeyframe=this._lastKeyframeDataItem.GetNext();const lastTime=this._lastKeyframeDataItem.GetTime();const nextTime=nextKeyframe?nextKeyframe.GetTime():
timeline.GetTotalTime();if(time<=lastTime||time>=nextTime){this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(time,this._trackDataItem);if(timeline.IsForwardPlayBack()){if(nextKeyframe)this.OnKeyframeReached(this._lastKeyframeDataItem)}else{const nextKeyframe=this._lastKeyframeDataItem.GetNext();if(nextKeyframe)this.OnKeyframeReached(nextKeyframe)}}}_GetLastKeyFrameBeforeTime(time){const keyframeDataItem=this._trackData.GetKeyFrameDataItemAtTime(time,this._trackDataItem);
if(keyframeDataItem)return keyframeDataItem;else return this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(time,this._trackDataItem)}OnKeyframeReached(keyframeDataItem){if(!C3.Plugins.Timeline)return;const timeline=this.GetTimeline();const timelineManager=timeline.GetTimelineManager();C3.Plugins.Timeline.Cnds.PushTriggerTimeline(timeline);C3.Plugins.Timeline.Cnds.PushTriggerKeyframe(keyframeDataItem);timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnAnyKeyframeReached);timelineManager.Trigger(C3.Plugins.Timeline.Cnds.OnKeyframeReached);
C3.Plugins.Timeline.Cnds.PopTriggerTimeline(timeline);C3.Plugins.Timeline.Cnds.PopTriggerKeyframe(keyframeDataItem)}AddKeyframe(){const keyframeData=this._trackDataItem.GetKeyframeData();const keyframeDataItem=keyframeData.AddEmptyKeyframeDataItem();return keyframeDataItem}AddPropertyTrack(){const propertyTrackData=this._trackDataItem.GetPropertyTrackData();const propertyTrackDataItem=propertyTrackData.AddEmptyPropertyTrackDataItem();const propertyTrack=C3.PropertyTrackState.Create(this,propertyTrackDataItem);
this._propertyTracks.push(propertyTrack);return propertyTrack}DeleteKeyframes(match){const keyframeData=this._trackDataItem.GetKeyframeData();keyframeData.DeleteKeyframeDataItems(match)}DeletePropertyKeyframes(match){for(const propertyTrack of this._propertyTracks)propertyTrack.DeletePropertyKeyframes(match)}SaveState(){for(const propertyTrack of this._propertyTracks)propertyTrack.SaveState()}CompareInitialStateWithCurrent(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;
for(const propertyTrack of this._propertyTracks)propertyTrack.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;let difference=false;for(const propertyTrack of this._propertyTracks){const diff=propertyTrack.CompareSaveStateWithCurrent();if(!difference&&diff)difference=true}if(difference){const keyframeDataItem=this.AddKeyframe();keyframeDataItem.SetTime(this.GetTimeline().GetTime());keyframeDataItem.SetEase("noease");
keyframeDataItem.SetEnable(true);keyframeDataItem.SetTags("")}}_OnAfterLoad(){if(!isNaN(this._instanceUidToLoad))this._LoadInstanceFromJson(this._instanceUidToLoad);this._instanceUidToLoad=NaN}_SaveToJson(){const instance=this.GetInstance();const uid=instance?instance.GetUID():this.GetInstanceUID();return{"propertyTracksJson":this._SavePropertyTracksToJson(),"lastKeyframeDataItemJson":this._SaveLastKeyframeDataItemToJson(),"initialStateOfNestedSet":this._initialStateOfNestedSet,"endStateOfNestedSet":this._endStateOfNestedSet,
"instanceUid":uid}}_LoadFromJson(o){if(!o)return;this._LoadPropertyTracksFromJson(o["propertyTracksJson"]);this._LoadLastKeyframeDataItemFromJson(o["lastKeyframeDataItemJson"]);this._instanceUidToLoad=o["instanceUid"];this._initialStateOfNestedSet=false;if(o.hasOwnProperty["initialStateOfNestedSet"])this._initialStateOfNestedSet=o["initialStateOfNestedSet"];this._endStateOfNestedSet=false;if(o.hasOwnProperty["endStateOfNestedSet"])this._endStateOfNestedSet=o["endStateOfNestedSet"];for(const propertyTrack of this._propertyTracks){if(this._worldInfoChange===
0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1}this._needsBeforeAndAfter=0;if(this._propertyTracks.some(pt=>pt.GetNeedsBeforeAndAfter()))this._needsBeforeAndAfter=1}_SaveLastKeyframeDataItemToJson(){const keyframeData=this._trackDataItem.GetKeyframeData();return keyframeData.GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map(propertyTrackState=>
propertyTrackState._SaveToJson())}_LoadPropertyTracksFromJson(propertyTracksJson){propertyTracksJson.forEach((propertyTrackJson,i)=>{const propertyTrack=this._propertyTracks[i];propertyTrack._LoadFromJson(propertyTrackJson)})}_LoadInstanceFromJson(uid){if(!C3.IsFiniteNumber(uid))return;const instance=this.GetRuntime().GetInstanceByUID(uid);if(!instance)return;const timeline=this.GetTimeline();timeline.SetTrackInstance(this._trackDataItem.GetId(),instance,this.GetTrackIndexInTimeline())}_LoadLastKeyframeDataItemFromJson(lastKeyframeDataItemIndex){const keyframeData=
this._trackDataItem.GetKeyframeData();this._lastKeyframeDataItem=keyframeData.GetKeyframeDataItemFromIndex(lastKeyframeDataItemIndex)}};

}

// timelines/state/propertyTrackState.js
{
'use strict';const C3=self.C3;
C3.PropertyTrackState=class PropertyTrack extends C3.DefendedBase{constructor(track,propertyTrackDataItem){super();this._track=track;this._propertyTrackDataItem=propertyTrackDataItem;this._propertyTrackData=propertyTrackDataItem.GetPropertyTrackData();this._worldInfoChange=0;this._renderChange=0;this._needsBeforeAndAfter=0;this._sourceAdapter=this.GetSourceAdapter();this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();this._lastPropertyKeyframeDataItem=
null;this._absoluteValueObject=null}static Create(track,propertyTrackDataItem){return C3.New(C3.PropertyTrackState,track,propertyTrackDataItem)}Release(){this._track=null;if(this._sourceAdapter){this._sourceAdapter.Release();this._sourceAdapter=null}this._propertyKeyframeDataItems=null;this._propertyTrackDataItem=null;this._propertyTrackData=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(avo){this._absoluteValueObject=
avo}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(this._sourceAdapter)return this._sourceAdapter;const id=this._propertyTrackDataItem.GetSourceAdapterId();let ret;switch(id){case "behavior":ret=
new C3.PropertyTrackState.BehaviorSourceAdapter(this);break;case "effect":ret=new C3.PropertyTrackState.EffectSourceAdapter(this);this._renderChange=1;break;case "instance-variable":ret=new C3.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case "plugin":ret=new C3.PropertyTrackState.PluginSourceAdapter(this);this._renderChange=1;break;case "world-instance":ret=new C3.PropertyTrackState.PropertySourceAdapter(this);this._renderChange=1;this._worldInfoChange=1;break;case "value":ret=new C3.PropertyTrackState.ValueSourceAdapter(this);
break;case "audio":ret=new C3.PropertyTrackState.AudioSourceAdapter(this);break}this._sourceAdapter=ret;return this._sourceAdapter}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(said){this._propertyTrackDataItem.SetSourceAdapterId(said)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(sargs){this._propertyTrackDataItem.SetSourceAdapterArguments(sargs)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(pn){this._propertyTrackDataItem.SetProperty(pn)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(pt){this._propertyTrackDataItem.SetType(pt)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(min){this._propertyTrackDataItem.SetMin(min)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(max){this._propertyTrackDataItem.SetMax(max)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(e){this._propertyTrackDataItem.SetEnable(e)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(im){this._propertyTrackDataItem.SetInterpolationMode(im)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(rm){this._propertyTrackDataItem.SetResultMode(rm)}SetEase(e){for(const propertyKeyframeDataItem of this.GetPropertyKeyframeDataItems())propertyKeyframeDataItem.SetEase(e)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){if(this._propertyKeyframeDataItems)return this._propertyKeyframeDataItems;
this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();return this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArrayIncludingDisabled()}GetPropertyKeyFrameDataItemAtTime(time){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(time,this._propertyTrackDataItem)}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,
this._propertyTrackDataItem)}GetPropertyKeyframeDataItemPairForTime(time){let start=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(time,this._propertyTrackDataItem);let end;if(start)end=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(time,this._propertyTrackDataItem);else{start=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);end=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,this._propertyTrackDataItem)}return{start,
end}}*GetPropertyKeyframeValues(){for(const propertyKeyframeDataItem of this.GetPropertyKeyframeDataItems())yield propertyKeyframeDataItem.GetValueWithResultMode()}*GetPropertyKeyframeTimes(){for(const propertyKeyframeDataItem of this.GetPropertyKeyframeDataItems())yield propertyKeyframeDataItem.GetTime()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetResetState(){this.GetSourceAdapter().SetResetState()}SetInitialState(time){this.GetSourceAdapter().SetInitialState();
this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(time);this._SetUpdateState()}SetResumeState(time){this.GetSourceAdapter().SetResumeState();this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(time)}_SetUpdateState(){const track=this.GetTrack();this._needsBeforeAndAfter=0;if(track.IsInstanceTrack()){const timeline=this.GetTimeline();const instance=track.GetInstance();const sourceAdapter=this.GetSourceAdapter();const propertyName=this.GetPropertyName();
const mayNeedBeforeAndAfterInterpolate=sourceAdapter.MayNeedBeforeAndAfterInterpolate();if(mayNeedBeforeAndAfterInterpolate){const similarPropertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,propertyName,this);if(similarPropertyTracks&&similarPropertyTracks.length)this._needsBeforeAndAfter=1}else this._needsBeforeAndAfter=0}}_GetLastPropertyKeyFrameBeforeTime(time){const timeline=this.GetTimeline();const propertyKeyframeDataItem=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(time,
this._propertyTrackDataItem);if(propertyKeyframeDataItem)return propertyKeyframeDataItem;else if(timeline.IsForwardPlayBack())return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);else return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,this._propertyTrackDataItem)}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(time,setTime=false,ensureValue=false,endState=false){let start;let end;
let propertyKeyframeReached=false;if(setTime)start=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){const timeline=this.GetTimeline();const nextPropertyKeyframe=this._lastPropertyKeyframeDataItem.GetNext();const lastTime=this._lastPropertyKeyframeDataItem.GetTime();const nextTime=nextPropertyKeyframe?nextPropertyKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime){this._lastPropertyKeyframeDataItem=
this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);propertyKeyframeReached=true}}else{this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);propertyKeyframeReached=true}start=this._lastPropertyKeyframeDataItem}if(start)end=start.GetNext();this._sourceAdapter.Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}GetInterpolatedValue(time){if(this._lastPropertyKeyframeDataItem){const timeline=
this.GetTimeline();const nextPropertyKeyframe=this._lastPropertyKeyframeDataItem.GetNext();const lastTime=this._lastPropertyKeyframeDataItem.GetTime();const nextTime=nextPropertyKeyframe?nextPropertyKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem)}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,
this._propertyTrackDataItem);const start=this._lastPropertyKeyframeDataItem;const end=start.GetNext();return this._sourceAdapter.GetInterpolatedValue(time,start,end)}GetInterpolatedValueFast(time,start,end){return this._sourceAdapter.GetInterpolatedValue(time,start,end)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(time,propertyTrack){const propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack._propertyTrackData;
return propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,propertyTrackDataItem)}static GetEndPropertyKeyframeForTime(time,propertyTrack){const propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack._propertyTrackData;return propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,propertyTrackDataItem)}AddPropertyKeyframe(){const propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();const propertyKeyframeDataItem=
propertyKeyframeData.AddEmptyPropertyKeyframeDataItem();this._lastPropertyKeyframeDataItem=null;return propertyKeyframeDataItem}DeletePropertyKeyframes(match){this._lastPropertyKeyframeDataItem=null;const propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();propertyKeyframeData.DeletePropertyKeyframeDataItems(match)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){const difference=this.GetSourceAdapter().CompareInitialStateWithCurrent();if(difference){const propertyKeyframeDataItem=
this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem);const currentState=this.GetSourceAdapter().GetCurrentState();propertyKeyframeDataItem.SetAbsoluteValue(currentState)}}CompareSaveStateWithCurrent(){const difference=this.GetSourceAdapter().CompareSaveStateWithCurrent();if(difference)this.AddPropertyKeyframeAtCurrentTime();this.GetSourceAdapter().ClearSaveState();return difference}AddPropertyKeyframeAtCurrentTime(){const time=this.GetTimeline().GetTime();const sourceAdapter=
this.GetSourceAdapter();const startPropertyKeyframe=C3.PropertyTrackState.GetStartPropertyKeyframeForTime(time,this);const propertyKeyframeDataItem=this.AddPropertyKeyframe();propertyKeyframeDataItem.SetType(startPropertyKeyframe.GetType());propertyKeyframeDataItem.SetTime(time);propertyKeyframeDataItem.SetEase(startPropertyKeyframe.GetEase());propertyKeyframeDataItem.SetEnable(true);propertyKeyframeDataItem.SetValue(sourceAdapter.GetValueAtTime());propertyKeyframeDataItem.SetAbsoluteValue(sourceAdapter.GetCurrentState())}_SaveToJson(){return{"sourceAdapterJson":this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(o){if(!o)return;
this.GetSourceAdapter()._LoadFromJson(o["sourceAdapterJson"])}};

}

// timelines/state/propertySourceAdapters/propertySourceAdapter.js
{
'use strict';const C3=self.C3;const NS=C3.PropertyTrackState;
NS.PropertySourceAdapter=class PropertySourceAdapter{constructor(propertyTrack){this._propertyTrack=propertyTrack;this._propertyAdapter=null;this.GetPropertyAdapter()}Release(){if(this._propertyAdapter){this._propertyAdapter.Release();this._propertyAdapter=null}this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){if(this._propertyAdapter)this._propertyAdapter.TimelineRemoved()}CleanCaches(){if(this._propertyAdapter)this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){if(this._propertyAdapter)return this._propertyAdapter;this._propertyAdapter=
this._CreatePropertyAdapter();return this._propertyAdapter}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetResetState(){this.GetPropertyAdapter().SetResetState()}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){const type=this._propertyTrack.GetPropertyKeyframeType();
let value;switch(type){case "numeric":{value=NS.NumericTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break}case "angle":{value=NS.AngleTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break}case "boolean":{value=NS.BooleanTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break}case "color":{value=NS.ColorTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break}case "text":{value=NS.TextTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break}}this._propertyAdapter.ChangeProperty(time,
value,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}GetInterpolatedValue(time,start,end){switch(this._propertyTrack.GetPropertyKeyframeType()){case "numeric":return NS.NumericTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case "angle":return NS.AngleTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case "boolean":return NS.BooleanTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case "color":return NS.ColorTypeAdapter.Interpolate(time,start,end,this._propertyTrack);
case "text":return NS.TextTypeAdapter.Interpolate(time,start,end,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){const propertyTrack=
this._propertyTrack;const track=propertyTrack.GetTrack();const time=track.GetTimeline().GetTime();const start=NS.GetStartPropertyKeyframeForTime(time,propertyTrack);const end=start.GetNext();const type=propertyTrack.GetPropertyKeyframeType();switch(type){case "numeric":{return NS.NumericTypeAdapter.Interpolate(time,start,end,propertyTrack)}case "angle":{return NS.AngleTypeAdapter.Interpolate(time,start,end,propertyTrack)}case "boolean":{return NS.BooleanTypeAdapter.Interpolate(time,start,end,propertyTrack)}case "color":{return NS.ColorTypeAdapter.Interpolate(time,
start,end,propertyTrack)}case "text":{return NS.TextTypeAdapter.Interpolate(time,start,end,propertyTrack)}}}_CreatePropertyAdapter(){const pt=this._propertyTrack;const type=pt.CanHavePropertyKeyframes()?pt.GetPropertyKeyframeType():"";switch(type){case "combo":case "boolean":case "text":case "string":{return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this)}case "numeric":case "number":case "angle":{if(this._propertyTrack.GetPropertyType()==="combo")return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);
return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}case "color":case "offsetColor":{return new NS.PropertyInterpolationAdapter.ColorInterpolationAdapter(this)}default:{return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}}_SaveToJson(){return{"propertyAdapterJson":this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(o){if(!o)return;this.GetPropertyAdapter()._LoadFromJson(o["propertyAdapterJson"])}};

}

// timelines/state/propertySourceAdapters/instanceVariableSourceAdapter.js
{
'use strict';const C3=self.C3;const INDEX=0;
class InstanceVariableSourceAdapter extends C3.PropertyTrackState.PropertySourceAdapter{constructor(propertyTrack){super(propertyTrack);this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetIndex(){if(this._updatedIndex)return this._updatedIndex;return super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(index){const i=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX];if(i===
index)return;this._updatedIndex=index}Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){if(!this.GetPropertyAdapter().CanChange(start.GetValue()))return;super.Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}GetInterpolatedValue(time,start,end){if(!this.GetPropertyAdapter().CanChange(start.GetValue()))return;return super.GetInterpolatedValue(time,start,end)}_SaveToJson(){return Object.assign(super._SaveToJson(),{"index":this._updatedIndex})}_LoadFromJson(o){if(!o)return;
super._LoadFromJson(o);this._updatedIndex=o["index"]}}C3.PropertyTrackState.InstanceVariableSourceAdapter=InstanceVariableSourceAdapter;

}

// timelines/state/propertySourceAdapters/behaviorSourceAdapter.js
{
'use strict';const C3=self.C3;const SID=0;const INDEX=1;const NAME=2;
class BehaviorSourceAdapter extends C3.PropertyTrackState.PropertySourceAdapter{constructor(propertyTrack){super(propertyTrack);this._sid=NaN}GetEditorIndex(){const dataItem=this._propertyTrack.GetPropertyTrackDataItem();return dataItem.GetSourceAdapterArguments()[INDEX]}GetTarget(){const dataItem=this._propertyTrack.GetPropertyTrackDataItem();const track=this._propertyTrack.GetTrack();const sid=this._sid?this._sid:dataItem.GetSourceAdapterArguments()[SID];const instance=track.GetInstance();const index=
instance.GetBehaviorIndexBySID(sid);const behaviorInstance=instance.GetBehaviorInstances()[index];return behaviorInstance.GetSdkInstance()}GetBehaviorType(objectClass){const dataItem=this._propertyTrack.GetPropertyTrackDataItem();const name=dataItem.GetSourceAdapterArguments()[NAME];return objectClass.GetBehaviorTypeByName(name)}UpdateBehaviorTypeSid(sid){const dataItem=this._propertyTrack.GetPropertyTrackDataItem();if(dataItem.GetSourceAdapterArguments()[SID]===sid)return;this._sid=sid}Interpolate(time,
start,end,setTime,ensureValue,endState,propertyKeyframeReached){const track=this._propertyTrack.GetTrack();const instance=track.GetInstance();if(!this.GetBehaviorType(instance.GetObjectClass()))return;super.Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}GetInterpolatedValue(time,start,end){const track=this._propertyTrack.GetTrack();const instance=track.GetInstance();if(!this.GetBehaviorType(instance.GetObjectClass()))return;return super.GetInterpolatedValue(time,
start,end)}_SaveToJson(){return Object.assign(super._SaveToJson(),{"sid":this._sid})}_LoadFromJson(o){if(!o)return;super._LoadFromJson(o);this._sid=o["sid"]}}C3.PropertyTrackState.BehaviorSourceAdapter=BehaviorSourceAdapter;

}

// timelines/state/propertySourceAdapters/effectSourceAdapter.js
{
'use strict';const C3=self.C3;const NAME=0;const INDEX=1;
class EffectSourceAdapter extends C3.PropertyTrackState.PropertySourceAdapter{constructor(propertyTrack){super(propertyTrack)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){const pTrack=this._propertyTrack;const track=pTrack.GetTrack();const worldInfo=track.GetWorldInfo();const instanceEffectList=worldInfo.GetInstanceEffectList();const effectList=instanceEffectList.GetEffectList();const effectType=this.GetEffectType(effectList);
const effectIndex=effectType.GetIndex();if(instanceEffectList.IsEffectIndexActive(effectIndex))return instanceEffectList.GetEffectParametersForIndex(effectIndex);return null}GetEffectType(effectList){const pTrack=this._propertyTrack;const name=pTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[NAME];return effectList.GetEffectTypeByName(name)}Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){if(!this._IsEffectActive())return;super.Interpolate(time,start,end,
setTime,ensureValue,endState,propertyKeyframeReached)}GetInterpolatedValue(time,start,end){if(!this._IsEffectActive())return;return super.GetInterpolatedValue(time,start,end)}_IsEffectActive(){const pTrack=this._propertyTrack;const track=pTrack.GetTrack();const worldInfo=track.GetWorldInfo();const instanceEffectList=worldInfo.GetInstanceEffectList();const effectList=instanceEffectList.GetEffectList();const effectType=this.GetEffectType(effectList);if(!effectType)return;const effectIndex=effectType.GetIndex();
return instanceEffectList.IsEffectIndexActive(effectIndex)}}C3.PropertyTrackState.EffectSourceAdapter=EffectSourceAdapter;

}

// timelines/state/propertySourceAdapters/pluginSourceAdapter.js
{
'use strict';const C3=self.C3;const INDEX=0;
class PluginSourceAdapter extends C3.PropertyTrackState.PropertySourceAdapter{constructor(propertyTrack){super(propertyTrack)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){const track=this._propertyTrack.GetTrack();const templatePlugin=track.GetObjectClass().GetPlugin();const currentPlugin=
track.GetInstance().GetObjectClass().GetPlugin();if(templatePlugin!==currentPlugin)return;super.Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}GetInterpolatedValue(time,start,end){const track=this._propertyTrack.GetTrack();const templatePlugin=track.GetObjectClass().GetPlugin();const currentPlugin=track.GetInstance().GetObjectClass().GetPlugin();if(templatePlugin!==currentPlugin)return;return super.GetInterpolatedValue(time,start,end)}GetOptionalCallbacks(){const track=
this._propertyTrack.GetTrack();const plugin=track.GetObjectClass().GetPlugin();if(C3.Plugins.Sprite&&plugin instanceof C3.Plugins.Sprite)if(this._propertyTrack.GetPropertyName()==="initial-frame"||this._propertyTrack.GetPropertyName()==="initial-animation")switch(this._propertyTrack.GetResultMode()){case "relative":{return null}case "absolute":{return null}}}}C3.PropertyTrackState.PluginSourceAdapter=PluginSourceAdapter;

}

// timelines/state/propertySourceAdapters/valueSourceAdapter.js
{
'use strict';const C3=self.C3;
class ValueSourceAdapter extends C3.PropertyTrackState.PropertySourceAdapter{constructor(propertyTrack){super(propertyTrack);this._value=0;this._init=false}MayNeedBeforeAndAfterInterpolate(){return false}SetInitialState(){const propertyTrackData=this._propertyTrack.GetPropertyTrackData();let propertyTrackDataItem=this._propertyTrack.GetPropertyTrackDataItem();propertyTrackDataItem=propertyTrackData.GetFirstPropertyKeyframeDataItem(propertyTrackDataItem);this._value=propertyTrackDataItem.GetValueWithResultMode()}SetResumeState(){}GetValue(){if(!this._init)this._propertyTrack.Interpolate(0);return this._value}Interpolate(time,
start,end,setTime,ensureValue,endState,propertyKeyframeReached){this._value=C3.PropertyTrackState.NumericTypeAdapter.Interpolate(time,start,end,this._propertyTrack);this._init=true}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return false}CompareSaveStateWithCurrent(){return false}_SaveToJson(){return{"value":this._value,"init":this._init}}_LoadFromJson(o){if(!o)return;this._value=o["value"];this._init=o.hasOwnProperty("init")?o["init"]:true}}
C3.PropertyTrackState.ValueSourceAdapter=ValueSourceAdapter;

}

// timelines/state/propertySourceAdapters/audioSourceAdapter.js
{
'use strict';const C3=self.C3;const PROJECT_FILE=0;const PROJECT_FILE_NAME=0;const PROJECT_FILE_TYPE=1;const START_OFFSET=1;const AUDIO_DURATION=2;const AUDIO_TAG=3;
class AudioSourceAdapter extends C3.PropertyTrackState.PropertySourceAdapter{constructor(propertyTrack){super(propertyTrack);this._audioPlaybackStarted=false;this._sdkInstance=null;this._actions=null;this._expressions=null;this._timeline=this._propertyTrack.GetTimeline();this._track=this._propertyTrack.GetTrack();this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs();this._fileArgs=this._sourceAdapterArgs[PROJECT_FILE];this._startOffsetTime=this._sourceAdapterArgs[START_OFFSET];if(this._sourceAdapterArgs[AUDIO_TAG])this._audioTag=
this._sourceAdapterArgs[AUDIO_TAG];else this._audioTag=Math.random().toString(36).slice(2);this._pauseTime=NaN;this._pauseVolume=NaN;this._volume=NaN;this._audioSource=null;this._Initialize()}Release(){super.Release();this._sdkInstance=null;this._actions=null;this._expressions=null;this._timeline=null;this._track=null;this._sourceAdapterArgs=null;this._fileArgs=null;this._audioSource=null}_Initialize(){if(!self.C3.Plugins.Audio)return;const runtime=this._propertyTrack.GetRuntime();const audioObjectClass=
runtime.GetSingleGlobalObjectClassByCtor(self.C3.Plugins.Audio);if(audioObjectClass)this._sdkInstance=audioObjectClass.GetSingleGlobalInstance().GetSdkInstance();this._actions=self.C3.Plugins.Audio.Acts;this._expressions=self.C3.Plugins.Audio.Exps}_MaybeSetAudioSource(){if(this._audioSource)return;const track=this._propertyTrack.GetTrack();const audioSourcePropertyTrack=track.GetPropertyTrack("audioSource");if(audioSourcePropertyTrack)this._audioSource=audioSourcePropertyTrack.GetSourceAdapter()}_GetPauseVolume(){const track=
this._propertyTrack.GetTrack();const volumePropertyTrack=track.GetPropertyTrack("volume");if(volumePropertyTrack)return volumePropertyTrack.GetSourceAdapter()._pauseVolume;else return this._pauseVolume}TimelineRemoved(){super.TimelineRemoved();this._audioPlaybackStarted=false;if(this._sdkInstance){if(this._expressions){this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag);this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)}if(this._actions)this._actions.Stop.call(this._sdkInstance,
this._audioTag)}}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(v){this._volume=v}SetInitialState(){super.SetInitialState();this._pauseTime=NaN;this._audioPlaybackStarted=false}SetResumeState(){super.SetResumeState();const timeline=this._propertyTrack.GetTimeline();const time=timeline.GetTime();this._pauseTime=time-this._startOffsetTime;switch(this._propertyTrack.GetPropertyName()){case "audioSource":{break}case "volume":{this._pauseVolume=this._propertyTrack.GetInterpolatedValue(time);
break}}this._audioPlaybackStarted=false}Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){if(!this._sdkInstance)return;switch(this._propertyTrack.GetPropertyName()){case "audioSource":{if(!this._timeline.IsForwardPlayBack())return;if(setTime){if(this._actions)this._actions.Stop.call(this._sdkInstance,this._audioTag);return}if(time<this._startOffsetTime){this._audioPlaybackStarted=false;return}const aPlaybackRate=this._expressions.PlaybackRate.call(this._sdkInstance,
this._audioTag);const tPlaybackRate=this._timeline.GetPlaybackRate();if(tPlaybackRate!==aPlaybackRate)this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,tPlaybackRate);if(this._audioPlaybackStarted)return;if(!this._propertyTrack.GetTimeline().IsPlaying())return;this._audioPlaybackStarted=true;if(isNaN(this._pauseTime)){const thenTime=self["performance"].now();const startDeltaTime=time-this._startOffsetTime;const state=this._sdkInstance.GetAudioContextState();if(state==="suspended"){this._audioPlaybackStarted=
false;return}const nowTime=self["performance"].now();const postToDOMDeltaTime=(nowTime-thenTime)/1E3;const startPlaybackOffset=startDeltaTime+postToDOMDeltaTime;if(this._actions){let startVolume=this.GetVolume();if(isNaN(startVolume)){this.SetVolume(0);startVolume=0}else this.SetVolume(startVolume);this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,startVolume,this._audioTag,startPlaybackOffset)}}else{const startTime=this._pauseTime;this._pauseTime=NaN;const startVolume=this._GetPauseVolume();
this._pauseVolume=NaN;const state=this._sdkInstance.GetAudioContextState();if(state==="suspended"){this._audioPlaybackStarted=false;return}if(this._actions){this.SetVolume(startVolume);this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,startVolume,this._audioTag,startTime)}}break}case "volume":{this._MaybeSetAudioSource();super.Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}}}GetInterpolatedValue(time,start,end){if(!this._sdkInstance)return;switch(this._propertyTrack.GetPropertyName()){case "audioSource":{return}case "volume":{this._MaybeSetAudioSource();
return super.GetInterpolatedValue(time,start,end)}}}Getter(wi,track){if(this._audioSource)return this._audioSource.GetVolume();return 0}Setter(wi,value,track,interpolationAdapter){if(this._audioSource)this._audioSource.SetVolume(this.Getter()+value);if(this._actions&&this._audioSource)this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(wi,value,track){if(this._audioSource)this._audioSource.SetVolume(value);if(this._actions&&
this._audioSource)this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return true}_SaveToJson(){return{"audioPlaybackStarted":this._audioPlaybackStarted,"audioTag":this._audioTag,"pauseTime":this._pauseTime,"pauseVolume":this._pauseVolume,"volume":this._volume}}_LoadFromJson(o){if(!o)return;this._audioPlaybackStarted=o["audioPlaybackStarted"];this._audioTag=o["audioTag"];this._pauseTime=o["pauseTime"];this._pauseVolume=o["pauseVolume"];
this._volume=o["volume"];this._Initialize()}}C3.PropertyTrackState.AudioSourceAdapter=AudioSourceAdapter;

}

// timelines/state/propertyInterpolationAdapters/propertyInterpolationAdapter.js
{
'use strict';const C3=self.C3;
C3.PropertyTrackState.PropertyInterpolationAdapter=class PropertyInterpolationAdapter{constructor(sourceAdapter){this._sourceAdapter=sourceAdapter;this._propertyTrack=sourceAdapter.GetPropertyTrack();this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo();this._property=this._propertyTrack.GetPropertyName();this._firstAbsoluteUpdate=false;this._saveState=null;this._target=null}Release(){this._sourceAdapter=null;this._propertyTrack=null;this._worldInfo=null;this._saveState=null;this._target=
null}MayNeedBeforeAndAfterInterpolate(){return false}TimelineRemoved(){}CleanCaches(){this._worldInfo=null;this._saveState=null;this._target=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){if(this._worldInfo)return this._worldInfo;this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo();return this._worldInfo}SetFirstAbsoluteUpdate(f){this._firstAbsoluteUpdate=!!f}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetResetState(){}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=
this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(value){const targetType=typeof this._Getter();const newType=typeof value;return targetType===newType}BeforeChangeProperty(){}ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){}AfterChangeProperty(){}_FirstKeyframeGetter(){const propertyKeyframeDataItem=this._PickTimelinePlaybackMode(()=>{const propertyTrackDataItem=
this._propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=this._propertyTrack.GetPropertyTrackData();return propertyTrackData.GetFirstPropertyKeyframeDataItem(propertyTrackDataItem)},()=>{const propertyTrackDataItem=this._propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=this._propertyTrack.GetPropertyTrackData();return propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem)});return propertyKeyframeDataItem.GetAbsoluteValue()}_CurrentKeyframeGetter(){const timeline=
this._propertyTrack.GetTimeline();const time=timeline.GetTime()-this._propertyTrack.GetTrack().GetStartOffset();const propertyKeyframe=this._PickTimelinePlaybackMode(()=>{const propertyTrackDataItem=this._propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=this._propertyTrack.GetPropertyTrackData();return propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,propertyTrackDataItem)},()=>{const propertyTrackDataItem=this._propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=
this._propertyTrack.GetPropertyTrackData();const ret=propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,propertyTrackDataItem);if(!ret)return propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return ret});return propertyKeyframe.GetAbsoluteValue()}_PickTimelinePlaybackMode(forwardFunc,backwardFunc){const timeline=this._propertyTrack.GetTimeline();return timeline.IsForwardPlayBack()?forwardFunc():backwardFunc()}_PickResultMode(relativeFunc,absoluteFunc){const resultMode=
this._propertyTrack.GetResultMode();return resultMode==="relative"?relativeFunc():absoluteFunc()}_PickFirstAbsoluteUpdate(firstFunc,otherFunc){if(this.GetFirstAbsoluteUpdate()){this.SetFirstAbsoluteUpdate(false);return firstFunc()}else return otherFunc()}_GetAbsoluteInitialValue(keyframeValue){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){if(this._target)return this._target;this._target=this._sourceAdapter.GetTarget();return this._target}_PickSource(bFunc,eFunc,ivFunc,pFunc,wiFunc,
aFunc){const id=this._propertyTrack.GetSourceAdapterId();switch(id){case "behavior":return bFunc();case "effect":return eFunc();case "instance-variable":return ivFunc();case "plugin":return pFunc();case "world-instance":return wiFunc();case "audio":return aFunc()}}_SaveToJson(){return{"firstAbsoluteUpdate":this._firstAbsoluteUpdate,"saveState":this._saveState}}_LoadFromJson(o){if(!o)return;this._firstAbsoluteUpdate=o["firstAbsoluteUpdate"];this._saveState=o["saveState"]}_GetPropertyKeyframeStubs(propertyTracks,
firstOnly=false){const ret=[];for(const propertyTrack of propertyTracks){const startOffset=propertyTrack.GetTrack().GetStartOffset();for(const propertyKeyframeDataItem of propertyTrack.GetPropertyKeyframeDataItems())if(firstOnly&&propertyKeyframeDataItem.GetTime()===0)ret.push({time:startOffset+propertyKeyframeDataItem.GetTime(),value:propertyKeyframeDataItem.GetAbsoluteValue()});else if(!firstOnly)ret.push({time:startOffset+propertyKeyframeDataItem.GetTime(),value:propertyKeyframeDataItem.GetAbsoluteValue()})}return ret.sort((f,
s)=>f.time-s.time)}_GetLastPropertyKeyframeStub(timeline,time,propertyKeyframeStubs){return this._GetPropertyKeyframeStubLowerThanPlayhead(time,propertyKeyframeStubs)}_GetPropertyKeyframeStubLowerThanPlayhead(time,propertyKeyframeStubs){for(let i=propertyKeyframeStubs.length-1;i>=0;i--){const stubTime=propertyKeyframeStubs[i].time;if(stubTime<=time)return propertyKeyframeStubs[i]}return null}};

}

// timelines/state/propertyInterpolationAdapters/colorInterpolationAdapter.js
{
'use strict';const C3=self.C3;const TMP_COLORS_MAP=new Map;const TMP_COLOR=[0,0,0];
class ColorInterpolationAdapter extends C3.PropertyTrackState.PropertyInterpolationAdapter{constructor(sourceAdapter){super(sourceAdapter)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){const id=this._propertyTrack.GetSourceAdapterId();const target=this._GetTarget();const index=this._GetIndex();switch(id){case "behavior":return this._ToColorArray(target.GetPropertyValueByIndex(index));case "effect":return this._ToColorArray(target[index]);case "plugin":return this._ToColorArray(target.GetPropertyValueByIndex(index));
case "world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){const firstKeyframeColor=this._FirstKeyframeGetter();return!this._CompareColors(firstKeyframeColor,this._Getter())}CompareSaveStateWithCurrent(){if(C3.IsNullOrUndefined(this._saveState))return false;return!this._CompareColors(this._saveState,this._Getter())}_CompareColors(fColor,sColor){fColor=this._GetColorFromArray(fColor);sColor=this._GetColorFromArray(sColor);return fColor.equalsIgnoringAlpha(sColor)}_FirstKeyframeGetter(){const color=
super._FirstKeyframeGetter();return this._GetColorFromArray(color)}_CurrentKeyframeGetter(){const color=super._CurrentKeyframeGetter();return this._GetColorFromArray(color)}_GetAbsoluteInitialValue(value){}_ToColorArray(color){if(C3.IsInstanceOf(color,C3.Color))return color.toArray().slice(0,3);return color.slice(0,3)}_GetColorFromArray(color){if(C3.IsInstanceOf(color,C3.Color))return color;return new C3.Color(color[0],color[1],color[2],1)}CanChange(value){return true}MayNeedBeforeAndAfterInterpolate(){return true}BeforeChangeProperty(){const timeline=
this._propertyTrack.GetTimeline();const instance=this._propertyTrack.GetInstance();const sourceAdapter=this._propertyTrack.GetSourceAdapter();const propertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,this._property,this._propertyTrack);if(propertyTracks&&propertyTracks.length>1){if(!TMP_COLORS_MAP.has(instance))TMP_COLORS_MAP.set(instance,new Map);const instanceMap=TMP_COLORS_MAP.get(instance);const id=this._propertyTrack.GetSourceAdapterId();if(!instanceMap.has(id))instanceMap.set(id,
new Map);const sourceMap=instanceMap.get(id);if(!sourceMap.has(this._property))sourceMap.set(this._property,{used:false,color:new C3.Color(0,0,0,1)})}}_GetTmpColor(instance,sourceId,propertyName){const tmpColorObj=TMP_COLORS_MAP.get(instance).get(sourceId).get(propertyName);tmpColorObj.used=true;return tmpColorObj.color}ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){const timeline=this._propertyTrack.GetTimeline();const track=this._propertyTrack.GetTrack();
const instance=this._propertyTrack.GetInstance();const sourceAdapter=this._propertyTrack.GetSourceAdapter();const sourceAdapterId=this._propertyTrack.GetSourceAdapterId();const property=this._property;const propertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,property,this._propertyTrack);if(propertyTracks&&propertyTracks.length>1){const propertyKeyframeStubs=this._GetPropertyKeyframeStubs(propertyTracks,true);const stub=this._GetLastPropertyKeyframeStub(timeline,timeline.GetTime(),
propertyKeyframeStubs);if(stub){const startOffset=track.GetStartOffset();const t=stub.time-startOffset;if(t===0)this._GetTmpColor(instance,sourceAdapterId,this._property).addRgb(value[0],value[1],value[2]);else{if(t<0)return;const r=value[0];const g=value[1];const b=value[2];const v=this._propertyTrack.Interpolate(t,false,true);const dr=C3.Color.DiffChannel(r,v[0]);const dg=C3.Color.DiffChannel(g,v[1]);const db=C3.Color.DiffChannel(b,v[2]);this._GetTmpColor(instance,sourceAdapterId,this._property).addRgb(dr,
dg,db)}}}else this._Setter(value[0],value[1],value[2])}AfterChangeProperty(){const instance=this._propertyTrack.GetInstance();if(!TMP_COLORS_MAP.has(instance))return;const instanceMap=TMP_COLORS_MAP.get(instance);const id=this._propertyTrack.GetSourceAdapterId();if(!instanceMap.has(id))return;const sourceMap=instanceMap.get(id);if(!sourceMap.has(this._property))return;const tmpColorObj=sourceMap.get(this._property);const used=tmpColorObj.used;const color=tmpColorObj.color;if(used)this._Setter(color.getR(),
color.getG(),color.getB());if(sourceMap.size===0)instanceMap.delete(id);if(instanceMap.size===0)TMP_COLORS_MAP.delete(instance)}_Getter(){const id=this._propertyTrack.GetSourceAdapterId();const target=this._GetTarget();const index=this._GetIndex();switch(id){case "behavior":return this._GetColorFromArray(target.GetPropertyValueByIndex(index));case "effect":return target[index].clone();case "plugin":return this._GetColorFromArray(target.GetPropertyValueByIndex(index));case "world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(r,
g,b){const id=this._propertyTrack.GetSourceAdapterId();const target=this._GetTarget();const index=this._GetIndex();switch(id){case "behavior":TMP_COLOR[0]=r;TMP_COLOR[1]=g;TMP_COLOR[2]=b;target.SetPropertyValueByIndex(index,TMP_COLOR);break;case "effect":target[index].setRgb(r,g,b);break;case "plugin":TMP_COLOR[0]=r;TMP_COLOR[1]=g;TMP_COLOR[2]=b;target.SetPropertyValueByIndex(index,TMP_COLOR);break;case "world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(r,g,b);break}}_SaveToJson(){}_LoadFromJson(o){}}
C3.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=ColorInterpolationAdapter;

}

// timelines/state/propertyInterpolationAdapters/noInterpolationAdapter.js
{
'use strict';const C3=self.C3;const NS=C3.PropertyTrackState;
class NoInterpolationAdapter extends C3.PropertyTrackState.PropertyInterpolationAdapter{constructor(sourceAdapter){super(sourceAdapter)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){const firstKeyframeValue=this._FirstKeyframeGetter();return firstKeyframeValue!==this.GetCurrentState()}CompareSaveStateWithCurrent(){if(C3.IsNullOrUndefined(this._saveState))return false;return this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return false}ChangeProperty(time,
value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){const propertyTrack=this._propertyTrack;const track=propertyTrack.GetTrack();const id=propertyTrack.GetSourceAdapterId();const timeline=propertyTrack.GetTimeline();const instance=track.GetInstance();const sourceAdapter=propertyTrack.GetSourceAdapter();const property=this._property;const propertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,property,propertyTrack);if(propertyTracks&&propertyTracks.length>1){const propertyKeyframeStubs=
this._GetPropertyKeyframeStubs(propertyTracks);const t=time+track.GetStartOffset();const stub=this._GetLastPropertyKeyframeStub(timeline,t,propertyKeyframeStubs);if(stub)value=stub.value}const type=propertyTrack.GetPropertyKeyframeType();switch(type){case "numeric":{if(!NS.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break}case "angle":{if(!NS.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break}case "boolean":{if(!NS.BooleanTypeAdapter.WillChange(this._GetIndex(),
this._GetTarget(),value,id))return;break}case "color":{if(!NS.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break}case "text":{if(!NS.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break}}this._Setter(value)}_Getter(){const id=this._propertyTrack.GetSourceAdapterId();const target=this._GetTarget();const index=this._GetIndex();switch(id){case "behavior":return target.GetPropertyValueByIndex(index);case "effect":return target[index];
case "instance-variable":return target.GetInstanceVariableValue(index);case "plugin":return target.GetPropertyValueByIndex(index)}}_Setter(value){const id=this._propertyTrack.GetSourceAdapterId();const target=this._GetTarget();const index=this._GetIndex();switch(id){case "behavior":target.SetPropertyValueByIndex(index,value);break;case "effect":target[index]=value;break;case "instance-variable":target.SetInstanceVariableValue(index,value);break;case "plugin":target.SetPropertyValueByIndex(index,value);
break}}}C3.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=NoInterpolationAdapter;

}

// timelines/state/propertyInterpolationAdapters/numericInterpolationAdapter.js
{
'use strict';const C3=self.C3;const NS=C3.PropertyTrackState.PropertyInterpolationAdapter;const INSTANCE_FUNC_MAP=new Map;const add=(prop,setter,absolute_setter,getter,round,fRound=false,init=null,reset=null)=>{INSTANCE_FUNC_MAP.set(prop,{setter,absolute_setter,getter,round,fRound,init,reset})};add("offsetX",(wi,v,t,a)=>{if(a._propertyTrack.GetResultMode()==="relative")wi.OffsetX(v,t.GetTimeline().GetTransformWithSceneGraph());else wi.OffsetX(v)},(wi,v)=>wi.SetX(v),wi=>wi.GetX(),true);
add("offsetY",(wi,v,t,a)=>{if(a._propertyTrack.GetResultMode()==="relative")wi.OffsetY(v,t.GetTimeline().GetTransformWithSceneGraph());else wi.OffsetY(v)},(wi,v)=>wi.SetY(v),wi=>wi.GetY(),true);
add("offsetWidth",(wi,v,t,a,noChanges)=>{if(v===0)return;const isRelative=a._propertyTrack.GetResultMode()==="relative";const isTween=a._typeAdapter.GetType()===1;if((isRelative||isTween)&&wi.HasParent()&&wi.GetTransformWithParentWidth()){if(isNaN(a._absoluteToFactor)){const parents=[];let parent=wi.GetParent();while(parent){parents.push(parent);parent=parent.GetParent()}parents.reverse();const get_track=(wi,t)=>{return t.GetTimeline().GetTrackFromInstance(wi.GetInstance())};const get_original_size=
(wi,t)=>{const track=get_track(wi,t);if(track)return track.GetOriginalWidth();const sdki=wi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())return sdki.GetOriginalWidth();return wi._GetSceneGraphInfo()._GetStartWidth()};const get_last_property_keyframe_value=(wi,t,propertyName,defaultValue=0)=>{const track=get_track(wi,t);if(!track)return defaultValue;const propertyTrack=track.GetPropertyTrack(propertyName);if(!propertyTrack)return defaultValue;const parentPropertyKeyframeData=propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData();
if(!parentPropertyKeyframeData)return defaultValue;const parentLastPropertyKeyframeDataItem=parentPropertyKeyframeData.GetLastPropertyKeyframeDataItem();if(!parentLastPropertyKeyframeDataItem)return defaultValue;return parentLastPropertyKeyframeDataItem.GetValue()};let absoluteToFactor;if(isTween){let p=parents[parents.length-1];absoluteToFactor=p.GetWidth()}else{let p=parents[0];const ownStartSize=p._GetSceneGraphInfo()._GetStartWidth();const ownStartScale=p._GetSceneGraphInfo().GetStartScaleX();
absoluteToFactor=ownStartSize*ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(p,t,"offsetWidth");absoluteToFactor+=get_original_size(p,t)*get_last_property_keyframe_value(p,t,"offsetScaleX");for(let i=1;i<parents.length;i++){p=parents[i];const ownStartScale=p._GetSceneGraphInfo().GetStartScaleX();absoluteToFactor*=ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(p,t,"offsetWidth");absoluteToFactor+=get_original_size(p,t)*get_last_property_keyframe_value(p,t,"offsetScaleX")}}a._absoluteToFactor=
absoluteToFactor===0?Number.EPSILON:absoluteToFactor}if(noChanges)return;wi.OffsetWidth(v/a._absoluteToFactor,true)}else wi.OffsetWidth(v)},(wi,v)=>wi.SetWidth(v),wi=>wi.GetWidth(),true);
add("offsetHeight",(wi,v,t,a,noChanges)=>{if(v===0)return;const isRelative=a._propertyTrack.GetResultMode()==="relative";const isTween=a._typeAdapter.GetType()===1;if((isRelative||isTween)&&wi.HasParent()&&wi.GetTransformWithParentHeight()){if(isNaN(a._absoluteToFactor)){const parents=[];let parent=wi.GetParent();while(parent){parents.push(parent);parent=parent.GetParent()}parents.reverse();const get_track=(wi,t)=>{return t.GetTimeline().GetTrackFromInstance(wi.GetInstance())};const get_original_size=
(wi,t)=>{const track=get_track(wi,t);if(track)return track.GetOriginalHeight();const sdki=wi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())return sdki.GetOriginalHeight();return wi._GetSceneGraphInfo()._GetStartHeight()};const get_last_property_keyframe_value=(wi,t,propertyName,defaultValue=0)=>{const track=t.GetTimeline().GetTrackFromInstance(wi.GetInstance());if(!track)return defaultValue;const propertyTrack=track.GetPropertyTrack(propertyName);if(!propertyTrack)return defaultValue;
const parentPropertyKeyframeData=propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!parentPropertyKeyframeData)return defaultValue;const parentLastPropertyKeyframeDataItem=parentPropertyKeyframeData.GetLastPropertyKeyframeDataItem();if(!parentLastPropertyKeyframeDataItem)return defaultValue;return parentLastPropertyKeyframeDataItem.GetValue()};let absoluteToFactor;if(isTween){let p=parents[parents.length-1];absoluteToFactor=p.GetHeight()}else{let p=parents[0];const ownStartSize=
p._GetSceneGraphInfo()._GetStartHeight();const ownStartScale=p._GetSceneGraphInfo().GetStartScaleY();absoluteToFactor=ownStartSize*ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(p,t,"offsetHeight");absoluteToFactor+=get_original_size(p,t)*get_last_property_keyframe_value(p,t,"offsetScaleY");for(let i=1;i<parents.length;i++){p=parents[i];const ownStartScale=p._GetSceneGraphInfo().GetStartScaleY();absoluteToFactor*=ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(p,
t);absoluteToFactor+=get_original_size(p,t)*get_last_property_keyframe_value(p,t,"offsetScaleY")}}a._absoluteToFactor=absoluteToFactor===0?Number.EPSILON:absoluteToFactor}if(noChanges)return;wi.OffsetHeight(v/a._absoluteToFactor,true)}else wi.OffsetHeight(v)},(wi,v)=>wi.SetHeight(v),wi=>wi.GetHeight(),true);add("offsetAngle",(wi,v,t,a,noChanges)=>{wi.OffsetAngle(v)},(wi,v)=>wi.SetAngle(v),wi=>wi.GetAngle(),false,true);
add("offsetOpacity",(wi,v,t,a,noChanges)=>{const opacityFactor=a._opacityFactor?a._opacityFactor:1;v/=opacityFactor;const o=wi.GetOpacity();const nv=o+v;const min=0;const max=1;if(a._clampAccumulator===0){if(nv>max)a._clampAccumulator+=nv-max;else if(nv<min)a._clampAccumulator+=nv;wi.OffsetOpacity(v)}else{const nv=wi.GetOpacity()+v;if(v>0&&a._clampAccumulator>0){if(nv>max)a._clampAccumulator+=nv-max}else if(v>0&&a._clampAccumulator<0){a._clampAccumulator+=v;if(a._clampAccumulator>0)a._clampAccumulator=
0}else if(v<0&&a._clampAccumulator>0){a._clampAccumulator+=v;if(a._clampAccumulator<0)a._clampAccumulator=0}else if(v<0&&a._clampAccumulator<0)if(nv<min)a._clampAccumulator+=nv}},(wi,v)=>{wi.SetOpacity(v)},wi=>{return wi.GetOpacity()},false,true,(a,wi,t)=>{a._clampAccumulator=0;switch(a._propertyTrack.GetResultMode()){case "relative":{const propertyTrackData=a._propertyTrack.GetPropertyTrackData();const propertyTrackDataItem=a._propertyTrack.GetPropertyTrackDataItem();const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();
const propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();let startingAbsoluteOpacity=a.GetWorldInfo().GetOpacity();let currentAbsoluteOpacity=startingAbsoluteOpacity;for(const propertyKeyframeDataItem of propertyKeyframeDataItems){const time=propertyKeyframeDataItem.GetTime();const currentRelativeOpacity=a._propertyTrack.GetInterpolatedValue(time);currentAbsoluteOpacity=startingAbsoluteOpacity+currentRelativeOpacity;currentAbsoluteOpacity=C3.clamp(currentAbsoluteOpacity,
0,1)}a._totalForewardOpacityDelta=startingAbsoluteOpacity-currentAbsoluteOpacity;a._totalForewardOpacityDelta=Math.round((a._totalForewardOpacityDelta+Number.EPSILON)*100)/100;currentAbsoluteOpacity=startingAbsoluteOpacity;for(let i=propertyKeyframeDataItems.length-1;i>=0;i--){const time=propertyKeyframeDataItems[i].GetTime();const currentRelativeOpacity=a._propertyTrack.GetInterpolatedValue(time);currentAbsoluteOpacity-=currentRelativeOpacity;currentAbsoluteOpacity=C3.clamp(currentAbsoluteOpacity,
0,1)}a._totalBackwardOpacityDelta=currentAbsoluteOpacity;a._totalBackwardOpacityDelta=Math.round((a._totalBackwardOpacityDelta+Number.EPSILON)*100)/100;break}case "absolute":{break}}const isRelative=a._propertyTrack.GetResultMode()==="relative";const isTween=a._typeAdapter.GetType()===1;if((isRelative||isTween)&&wi.HasParent()&&wi.GetTransformWithParentOpacity()){const parents=[];let parent=wi.GetParent();while(parent){parents.push(parent);parent=parent.GetParent()}parents.reverse();const get_last_property_keyframe_value=
(wi,t,propertyName)=>{const track=t.GetTimeline().GetTrackFromInstance(wi.GetInstance());if(!track)return 0;const propertyTrack=track.GetPropertyTrack(propertyName);if(!propertyTrack)return 0;const parentPropertyKeyframeData=propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!parentPropertyKeyframeData)return 0;const parentLastPropertyKeyframeDataItem=parentPropertyKeyframeData.GetLastPropertyKeyframeDataItem();if(!parentLastPropertyKeyframeDataItem)return 0;return parentLastPropertyKeyframeDataItem.GetValue()};
let opacityFactor=parents[0]._GetSceneGraphInfo().GetStartOpacity();opacityFactor+=get_last_property_keyframe_value(parents[0],t,"offsetOpacity");for(let i=1;i<parents.length;i++)opacityFactor+=get_last_property_keyframe_value(parents[i],t,"offsetOpacity");a._opacityFactor=opacityFactor===0?1:opacityFactor}},a=>{switch(a._propertyTrack.GetResultMode()){case "relative":{a._clampAccumulator=0;const wi=a.GetWorldInfo();let currentOpacity=wi.GetOpacity();currentOpacity=Math.round((currentOpacity+Number.EPSILON)*
100)/100;if(a._propertyTrack.GetTimeline().IsForwardPlayBack()){wi.SetOpacity(currentOpacity+a._totalForewardOpacityDelta);a._lastValue=0}else{wi.SetOpacity(currentOpacity-a._totalBackwardOpacityDelta);a._lastValue=a.GetSourceAdapter().GetValueAtTime()}break}case "absolute":{break}}});add("offsetOriginX",(wi,v)=>wi.OffsetOriginX(v),(wi,v)=>wi.SetOriginX(v),wi=>wi.GetOriginX(),false);add("offsetOriginY",(wi,v)=>wi.OffsetOriginY(v),(wi,v)=>wi.SetOriginY(v),wi=>wi.GetOriginY(),false);
add("offsetZElevation",(wi,v)=>wi.OffsetZElevation(v),(wi,v)=>wi.SetZElevation(v),wi=>wi.GetZElevation(),true);
add("offsetScaleX",(wi,v,t,a)=>{if(v===0)return;const mirrorFactor=wi.GetWidth()<0?-1:1;if(a._propertyTrack.GetResultMode()==="relative"&&wi.HasParent()&&wi.GetTransformWithParentWidth()){const value=t.GetOriginalWidth()*mirrorFactor*v;if(isNaN(a._absoluteToFactor))INSTANCE_FUNC_MAP.get("offsetWidth").setter(wi,1,t,a,true);wi.OffsetWidth(value/a._absoluteToFactor,true)}else wi.OffsetWidth(t.GetOriginalWidth()*mirrorFactor*v)},(wi,v,t)=>{wi.SetWidth(t.GetOriginalWidth()*v)},(wi,t)=>{const mirrorFactor=
wi.GetWidth()<0?-1:1;if(wi.GetTransformWithParentWidth()){const parentWi=wi.GetParent();const parentTrack=t.GetTimeline().GetTrackFromInstance(parentWi.GetInstance());let parentScale=NaN;if(parentTrack)parentScale=parentWi.GetWidth()/parentTrack.GetOriginalWidth();else{const sdki=parentWi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())parentScale=parentWi.GetWidth()/sdki.GetOriginalWidth();else parentScale=1}return wi.GetWidth()*mirrorFactor/(t.GetOriginalWidth()*parentScale)}else return wi.GetWidth()*
mirrorFactor/t.GetOriginalWidth()},false);
add("offsetScaleY",(wi,v,t,a)=>{if(v===0)return;const flipFactor=wi.GetHeight()<0?-1:1;if(a._propertyTrack.GetResultMode()==="relative"&&wi.HasParent()&&wi.GetTransformWithParentHeight()){const value=t.GetOriginalHeight()*flipFactor*v;if(isNaN(a._absoluteToFactor))INSTANCE_FUNC_MAP.get("offsetHeight").setter(wi,1,t,a,true);wi.OffsetHeight(value/a._absoluteToFactor,true)}else wi.OffsetHeight(t.GetOriginalHeight()*flipFactor*v)},(wi,v,t)=>{wi.SetHeight(t.GetOriginalHeight()*v)},(wi,t)=>{const flipFactor=
wi.GetHeight()<0?-1:1;if(wi.GetTransformWithParentHeight()){const parentWi=wi.GetParent();const parentTrack=t.GetTimeline().GetTrackFromInstance(parentWi.GetInstance());let parentScale=NaN;if(parentTrack)parentScale=parentWi.GetHeight()/parentTrack.GetOriginalHeight();else{const sdki=parentWi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())parentScale=parentWi.GetHeight()/sdki.GetOriginalHeight();else parentScale=1}return wi.GetHeight()*flipFactor/(t.GetOriginalHeight()*parentScale)}else return wi.GetHeight()*
flipFactor/t.GetOriginalHeight()},false);
class NumericInterpolationAdapter extends C3.PropertyTrackState.PropertyInterpolationAdapter{constructor(sourceAdapter){super(sourceAdapter);this._lastValue=0;this._clampAccumulator=0;this._totalForewardOpacityDelta=0;this._totalBackwardOpacityDelta=0;this._opacityFactor=NaN;this._absoluteToFactor=NaN;this._angleReflectMirrorOrFlip=undefined;this._angleReflectMirrorAndFlip=undefined;this._instance_getter=null;this._instance_setter=null;this._instance_absolute_setter=null;this._reset_action=null;this._init_action=
null;this._source_adapter_getter=null;this._source_adapter_setter=null;this._source_adapter_absolute_setter=null;this._round=false;this._fRound=false;if(C3.IsInstanceOf(this._propertyTrack.GetTimeline(),C3.TweenState))this._typeAdapter=new C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this);else this._typeAdapter=new C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);const property=this._propertyTrack.GetPropertyName();
switch(this._propertyTrack.GetSourceAdapterId()){case "world-instance":{const p=INSTANCE_FUNC_MAP.get(property);this._instance_getter=p.getter;this._instance_setter=p.setter;this._instance_absolute_setter=p.absolute_setter;this._round=p.round;this._fRound=p.fRound;this._init_action=p.init;this._reset_action=p.reset;break}case "audio":{this._source_adapter_getter=sourceAdapter.Getter;this._source_adapter_setter=sourceAdapter.Setter;this._source_adapter_absolute_setter=sourceAdapter.AbsoluteSetter;
this._round=!!sourceAdapter.DoesRounding();this._fRound=false;break}}}Release(){this._typeAdapter=null;this._instance_getter=null;this._instance_setter=null;this._instance_absolute_setter=null;this._reset_action=null;this._init_action=null;this._source_adapter_getter=null;this._source_adapter_setter=null;this._source_adapter_absolute_setter=null;super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(v){this._lastValue=
v}SetResetState(){if(this._reset_action)this._reset_action(this)}SetInitialState(){const initValue=this._typeAdapter.SetInitialState();if(typeof initValue==="number")this._lastValue=initValue;if(this._init_action){const wi=this.GetWorldInfo();const track=this._propertyTrack.GetTrack();this._init_action(this,wi,track)}}SetResumeState(){const resumeValue=this._typeAdapter.SetResumeState();if(typeof resumeValue==="number")this._lastValue=resumeValue}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){const firstKeyframeValue=
this._FirstKeyframeGetter();return firstKeyframeValue!==this.GetCurrentState()}CompareSaveStateWithCurrent(){if(C3.IsNullOrUndefined(this._saveState))return false;return this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){return this._typeAdapter.ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){const target=
this._GetTarget();const index=this._GetIndex();const wi=this.GetWorldInfo();const track=this._propertyTrack.GetTrack();const id=this._propertyTrack.GetSourceAdapterId();switch(id){case "behavior":return target.GetPropertyValueByIndex(index);case "effect":return target[index];case "instance-variable":return target.GetInstanceVariableValue(index);case "plugin":return target.GetPropertyValueByIndex(index);case "world-instance":return this._instance_getter(wi,track);case "audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),
wi,track)}}_Setter(value,start,end){const target=this._GetTarget();const index=this._GetIndex();const wi=this.GetWorldInfo();const track=this._propertyTrack.GetTrack();const id=this._propertyTrack.GetSourceAdapterId();switch(id){case "behavior":target.OffsetPropertyValueByIndex(index,value);break;case "effect":target[index]+=value;break;case "instance-variable":target.SetInstanceVariableOffset(index,value);break;case "plugin":target.OffsetPropertyValueByIndex(index,value,this.GetSourceAdapter().GetOptionalCallbacks());
break;case "world-instance":this._instance_setter(wi,value,track,this);break;case "audio":this._source_adapter_setter.call(this.GetSourceAdapter(),wi,value,track,this);break}}_SetterAbsolute(value,propertyKeyframeReached,endState){let mode=this._propertyTrack.GetInterpolationMode();mode=mode==="default"?"continuous":mode;if(mode==="discrete"&&!propertyKeyframeReached)return;if(mode==="discrete"&&endState){const timeline=this._propertyTrack.GetTimeline();const time=timeline.GetTime();const propertyKeyframeDataItem=
this._propertyTrack.GetPropertyKeyFrameDataItemAtTime(time);if(!propertyKeyframeDataItem)return}const target=this._GetTarget();const index=this._GetIndex();const wi=this.GetWorldInfo();const track=this._propertyTrack.GetTrack();const id=this._propertyTrack.GetSourceAdapterId();switch(id){case "behavior":target.SetPropertyValueByIndex(index,value);break;case "effect":target[index]=value;break;case "instance-variable":target.SetInstanceVariableValue(index,value);break;case "plugin":target.SetPropertyValueByIndex(index,
value,this.GetSourceAdapter().GetOptionalCallbacks());break;case "world-instance":this._instance_absolute_setter(wi,value,track);break;case "audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),wi,value,track);break}}_MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue,forceEndValue,endState){this._typeAdapter._MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue,forceEndValue,endState)}_AddDelta(value,start,end,forceEndValue,endState){switch(this._propertyTrack.GetPropertyType()){case "angle":{value=
C3.toDegrees(value);break}default:{value=value;break}}const stringValue=value.toString();const decimalsString=stringValue.split(".")[1]||"";const decimalPlaces=decimalsString.length;const v=this._Getter();let rv;if(decimalPlaces===0)if(this._round)rv=Math.round(v);else if(this._fRound)switch(this._propertyTrack.GetPropertyType()){case "angle":{rv=C3.toRadians(Math.round(C3.toDegrees(v)));break}default:{rv=Number(C3.toFixed(v,2));break}}else rv=v;else if(this._round)rv=Number(C3.toFixed(v,decimalPlaces));
else if(this._fRound)rv=v;else rv=v;this._Setter(rv-v,start,end);switch(this._propertyTrack.GetPropertyName()){case "offsetWidth":case "offsetScaleX":{const wi=this.GetWorldInfo();const ov=wi.GetWidth();const nv=Number(C3.toFixed(ov,2));wi.OffsetWidth(nv-ov);break}case "offsetHeight":case "offsetScaleY":{const wi=this.GetWorldInfo();const ov=wi.GetHeight();const nv=Number(C3.toFixed(ov,2));wi.OffsetHeight(nv-ov);break}}}_SaveToJson(){return Object.assign(super._SaveToJson(),{"v":this._lastValue,"a":this._clampAccumulator,
"fod":this._totalForewardOpacityDelta,"bod":this._totalBackwardOpacityDelta,"of":this._opacityFactor,"sf":this._absoluteToFactor,"armorf":this._angleReflectMirrorOrFlip,"armandf":this._angleReflectMirrorAndFlip})}_LoadFromJson(o){if(!o)return;super._LoadFromJson(o);this._lastValue=o["v"];this._clampAccumulator=o["a"];this._totalForewardOpacityDelta=C3.IsFiniteNumber(o["fod"])?o["fod"]:0;this._totalBackwardOpacityDelta=C3.IsFiniteNumber(o["bod"])?o["bod"]:0;this._opacityFactor=C3.IsFiniteNumber(o["of"])?
o["of"]:NaN;this._absoluteToFactor=C3.IsFiniteNumber(o["sf"])?o["sf"]:NaN;this._angleReflectMirrorOrFlip=C3.IsFiniteNumber(o["armorf"])?o["armorf"]:undefined;this._angleReflectMirrorAndFlip=C3.IsFiniteNumber(o["armandf"])?o["armandf"]:undefined}}C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=NumericInterpolationAdapter;

}

// timelines/state/propertyInterpolationAdapters/numericInterpolationAdapterForTimeline.js
{
'use strict';const C3=self.C3;
class AbsoluteValueObject{constructor(propertyTracks){this._used=false;this._value=0;this._propertyKeyframeReached=false;this._endState=false;this._propertyTracks=propertyTracks;for(let i=0,l=this._propertyTracks.length;i<l;i++)this._propertyTracks[i].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=true}GetUsed(){return this._used}SetValue(v){this._value=v}GetValue(){return this._value}SetPropertyKeyframeReached(v){this._propertyKeyframeReached=v}GetPropertyKeyframeReached(){return this._propertyKeyframeReached}SetEndState(v){this._endState=
v}GetEndState(){return this._endState}Reset(){this._used=false;this._value=0;this._propertyKeyframeReached=false;this._endState=false}}
class NumericInterpolationAdapterForTimeline{constructor(numericInterpolationAdapter){this._numericInterpolationAdapter=numericInterpolationAdapter}Release(){this._numericInterpolationAdapter=null}GetType(){return 0}SetInitialState(){const adapter=this._numericInterpolationAdapter;const propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();return adapter._PickResultMode(()=>{return adapter._PickTimelinePlaybackMode(()=>0,()=>adapter.GetSourceAdapter().GetValueAtTime())},()=>{})}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){const adapter=
this._numericInterpolationAdapter;const propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();switch(propertyTrack.GetResultMode()){case "relative":{return false}case "absolute":{return true}}}BeforeChangeProperty(){const adapter=this._numericInterpolationAdapter;const propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();const property=propertyTrack.GetPropertyName();switch(propertyTrack.GetResultMode()){case "relative":{break}case "absolute":{if(propertyTrack.HasAbsoluteValueObject()){const valueObj=
propertyTrack.GetAbsoluteValueObject();valueObj.Reset()}else{const timeline=propertyTrack.GetTimeline();const instance=propertyTrack.GetInstance();const sourceAdapter=propertyTrack.GetSourceAdapter();const similarPropertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,property,propertyTrack);if(similarPropertyTracks&&similarPropertyTracks.length>1)new AbsoluteValueObject(similarPropertyTracks)}break}}}ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){const adapter=
this._numericInterpolationAdapter;const propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();switch(propertyTrack.GetResultMode()){case "relative":{const lastValue=adapter.GetLastValue();adapter._Setter(value-lastValue,start,end);if(ensureValue)this._MaybeEnsureValue(time,start,end,setTime,lastValue,value);adapter.SetLastValue(value);break}case "absolute":{const timeline=propertyTrack.GetTimeline();const track=propertyTrack.GetTrack();const instance=propertyTrack.GetInstance();const sourceAdapter=
propertyTrack.GetSourceAdapter();if(propertyTrack.HasAbsoluteValueObject()){const absoluteValueObject=propertyTrack.GetAbsoluteValueObject();const similarpropertyTracks=absoluteValueObject.GetPropertyTracks();const propertyKeyframeStubs=adapter._GetPropertyKeyframeStubs(similarpropertyTracks,true);const stub=adapter._GetLastPropertyKeyframeStub(timeline,timeline.GetTime(),propertyKeyframeStubs);if(stub){const startOffset=track.GetStartOffset();const t=stub.time-startOffset;if(t===0){absoluteValueObject.SetEndState(endState);
absoluteValueObject.SetPropertyKeyframeReached(propertyKeyframeReached);absoluteValueObject.SetUsed();absoluteValueObject.SetValue(absoluteValueObject.GetValue()+value)}else{if(t<0)return;const v=propertyTrack.GetInterpolatedValue(t);absoluteValueObject.SetEndState(endState);absoluteValueObject.SetPropertyKeyframeReached(propertyKeyframeReached);absoluteValueObject.SetUsed();absoluteValueObject.SetValue(absoluteValueObject.GetValue()+(value-v))}}}else adapter._SetterAbsolute(value,propertyKeyframeReached,
endState);break}}}AfterChangeProperty(){const adapter=this._numericInterpolationAdapter;const propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();switch(propertyTrack.GetResultMode()){case "relative":{break}case "absolute":{if(propertyTrack.HasAbsoluteValueObject()){const absoluteValueObject=propertyTrack.GetAbsoluteValueObject();if(absoluteValueObject.GetUsed())adapter._SetterAbsolute(absoluteValueObject.GetValue(),absoluteValueObject.GetPropertyKeyframeReached(),absoluteValueObject.GetEndState())}break}}}_MaybeEnsureValue(time,
start,end,setTime,lastValue,currentValue){const adapter=this._numericInterpolationAdapter;if(setTime)return;if(start&&time===start.GetTime())adapter._AddDelta(start.GetValueWithResultMode(),start,end);else if(end&&time===end.GetTime())adapter._AddDelta(end.GetValueWithResultMode(),start,end);else if(currentValue-lastValue===0)adapter._AddDelta(start.GetValueWithResultMode(),start,end)}}C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=NumericInterpolationAdapterForTimeline;

}

// timelines/state/propertyInterpolationAdapters/numericInterpolationAdapterForTween.js
{
'use strict';const C3=self.C3;
class NumericInterpolationAdapterForTween{constructor(numericInterpolationAdapter){this._numericInterpolationAdapter=numericInterpolationAdapter}Release(){this._numericInterpolationAdapter=null}GetType(){return 1}SetInitialState(){const adapter=this._numericInterpolationAdapter;adapter.SetFirstAbsoluteUpdate(true);return this._GetAbsoluteInitialValue(adapter._FirstKeyframeGetter())}SetResumeState(){const adapter=this._numericInterpolationAdapter;if(adapter._FirstKeyframeGetter()===adapter._CurrentKeyframeGetter())return;
adapter.SetFirstAbsoluteUpdate(true);return this._GetAbsoluteInitialValue(adapter._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return false}BeforeChangeProperty(){}ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){const adapter=this._numericInterpolationAdapter;const lastValue=adapter.GetLastValue();switch(adapter.GetPropertyTrack().GetResultMode()){case "relative":{adapter._Setter(value-lastValue,start,end);if(ensureValue)this._MaybeEnsureValue(time,
start,end,setTime,lastValue,value,false,endState);break}case "absolute":{if(adapter.GetFirstAbsoluteUpdate()){adapter.SetFirstAbsoluteUpdate(false);adapter._Setter(lastValue,start,end)}else if(time===0&&adapter.GetPropertyTrack().GetTimeline().GetTotalTime()===0)adapter._SetterAbsolute(value,true,false);else{adapter._Setter(value-lastValue,start,end);if(ensureValue)this._MaybeEnsureValue(time,start,end,setTime,lastValue,value,this._ForceEndValue(),endState)}break}}adapter.SetLastValue(value)}AfterChangeProperty(){}_GetAbsoluteInitialValue(keyframeValue){const adapter=
this._numericInterpolationAdapter;return keyframeValue-adapter.GetCurrentState()}_ForceEndValue(){const adapter=this._numericInterpolationAdapter;const inst=adapter.GetWorldInfo().GetInstance();const runtime=adapter.GetPropertyTrack().GetRuntime();const timelineManager=runtime.GetTimelineManager();let activeTimelineCount=0;for(const timeline of timelineManager.GetPlayingTimelines())if(timeline.GetType()===0){if(timeline.HasTrackInstance(inst))activeTimelineCount++}else if(timeline.GetType()===1)if(timeline.GetInstance()===
inst)activeTimelineCount++;return activeTimelineCount<=1}_MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue,forceEndValue,endState){const adapter=this._numericInterpolationAdapter;if(setTime)if(start&&time===start.GetTime())adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState);else if(end&&time===end.GetTime())adapter._AddDelta(end.GetValueWithResultMode(),start,end,forceEndValue,endState);else{if(!end)adapter._AddDelta(start.GetValueWithResultMode(),start,
end,forceEndValue,endState)}else if(start&&time===start.GetTime())adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState);else if(end&&time===end.GetTime())adapter._AddDelta(end.GetValueWithResultMode(),start,end,forceEndValue,endState);else if(currentValue-lastValue===0)adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState)}}C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=NumericInterpolationAdapterForTween;

}

// timelines/state/propertyTypeAdapters/numericTypeAdapter.js
{
'use strict';const C3=self.C3;const Ease=self.Ease;
C3.PropertyTrackState.NumericTypeAdapter=class NumericTypeAdapter{constructor(){}static WillChange(index,source,newValue,type){let oldValue;switch(type){case "behavior":oldValue=source.GetPropertyValueByIndex(index);break;case "effect":oldValue=source[index];break;case "instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case "plugin":oldValue=source.GetPropertyValueByIndex(index);break}if(oldValue===newValue)return false;return true}static Interpolate(time,start,end,propertyTrack){if(!end){let propertyTrackDataItem=
propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode()}let mode=propertyTrack.GetInterpolationMode();if(mode==="default")mode="continuous";if(propertyTrack.GetPropertyType()==="combo")mode="discrete";if(mode==="discrete")return start.GetValueWithResultMode();else if(mode==="continuous"||mode==="step"){const step=
propertyTrack.GetTimeline().GetStep();if(mode==="step"&&step!==0){const s=1/step;time=Math.floor(time*s)/s}const sv=start.GetValueWithResultMode();const ev=end.GetValueWithResultMode();const startAddon=start.GetAddOn("cubic-bezier");const endAddon=end.GetAddOn("cubic-bezier");const doCubicBezier=startAddon&&startAddon.GetStartEnable()&&endAddon&&endAddon.GetEndEnable();if(!doCubicBezier&&sv===ev)return sv;const st=start.GetTime();const et=end.GetTime();if(mode==="step"&&step!==0)time=C3.clamp(time,
st,et);const n=C3.normalize(time,st,et);const e=start.GetEase();let ret;if(doCubicBezier){const dt=et-st;ret=Ease.GetRuntimeEase(e)(dt*n,0,1,dt);ret=Ease.GetRuntimeEase("cubicbezier")(ret,sv,sv+startAddon.GetStartAnchor(),ev+endAddon.GetEndAnchor(),ev)}else ret=Ease.GetRuntimeEase(e)((et-st)*n,sv,ev-sv,et-st);if(propertyTrack.GetPropertyType()==="integer")return Math.floor(ret);return ret}}};

}

// timelines/state/propertyTypeAdapters/angleTypeAdapter.js
{
'use strict';const C3=self.C3;
C3.PropertyTrackState.AngleTypeAdapter=class AngleTypeAdapter{constructor(){}static WillChange(index,source,newValue,type){let oldValue;switch(type){case "behavior":oldValue=source.GetPropertyValueByIndex(index);break;case "effect":oldValue=source[index];break;case "instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case "plugin":oldValue=source.GetPropertyValueByIndex(index);break}if(oldValue===newValue)return false;return true}static Interpolate(time,start,end,propertyTrack){if(!end){let propertyTrackDataItem=
propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode()}let mode=propertyTrack.GetInterpolationMode();if(mode==="default")mode="continuous";if(propertyTrack.GetPropertyType()==="combo")mode="discrete";if(mode==="discrete")return start.GetValueWithResultMode();else if(mode==="continuous"||mode==="step"){const step=
propertyTrack.GetTimeline().GetStep();if(mode==="step"&&step!==0){const s=1/step;time=Math.floor(time*s)/s}const st=start.GetTime();const et=end.GetTime();const sv=start.GetValueWithResultMode();const ev=end.GetValueWithResultMode();if(mode==="step"&&step!==0)time=C3.clamp(time,st,et);const angleAddon=start.GetAddOn("angle");if(angleAddon){const revolutions=angleAddon.GetRevolutions();if(sv===ev&&revolutions===0)return sv;const n=C3.normalize(time,st,et);const easeFunc=self.Ease.GetRuntimeEase(start.GetEase());
const easeRes=easeFunc(n,0,1,1);switch(angleAddon.GetDirection()){case "closest":return C3.angleLerp(sv,ev,easeRes,revolutions);case "clockwise":return C3.angleLerpClockwise(sv,ev,easeRes,revolutions);case "anti-clockwise":return C3.angleLerpAntiClockwise(sv,ev,easeRes,revolutions)}}else{if(sv===ev)return sv;const n=C3.normalize(time,st,et);const easeFunc=self.Ease.GetRuntimeEase(start.GetEase());return C3.angleLerp(sv,ev,easeFunc(n,0,1,1))}}}};

}

// timelines/state/propertyTypeAdapters/booleanTypeAdapter.js
{
'use strict';const C3=self.C3;
C3.PropertyTrackState.BooleanTypeAdapter=class BooleanTypeAdapter{constructor(){}static WillChange(index,source,newValue,type){let oldValue;switch(type){case "behavior":oldValue=source.GetPropertyValueByIndex(index);break;case "effect":oldValue=source[index];break;case "instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case "plugin":oldValue=source.GetPropertyValueByIndex(index);break}if(!!oldValue===!!newValue)return false;return true}static Interpolate(time,start,end,propertyTrack){if(!end){let propertyTrackDataItem=
propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode()?1:0}return start.GetValueWithResultMode()?1:0}};

}

// timelines/state/propertyTypeAdapters/colorTypeAdapter.js
{
'use strict';const C3=self.C3;const TEMP_COLOR_ARRAY=[0,0,0];const TEMP_COLOR_ARRAY_2=[0,0,0];const TEMP_COLOR_ARRAY_3=[0,0,0];
C3.PropertyTrackState.ColorTypeAdapter=class ColorTypeAdapter{constructor(){}static WillChange(index,source,newValue,type){let oldValue;switch(type){case "behavior":oldValue=source.GetPropertyValueByIndex(index);break;case "effect":oldValue=source[index];break;case "instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case "plugin":oldValue=source.GetPropertyValueByIndex(index);break}if(Array.isArray(newValue)){TEMP_COLOR_ARRAY[0]=newValue[0];TEMP_COLOR_ARRAY[1]=newValue[1];TEMP_COLOR_ARRAY[2]=
newValue[2]}else{TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(newValue);TEMP_COLOR_ARRAY[0]=Math.floor(TEMP_COLOR_ARRAY_3.getR()*255);TEMP_COLOR_ARRAY[1]=Math.floor(TEMP_COLOR_ARRAY_3.getG()*255);TEMP_COLOR_ARRAY[2]=Math.floor(TEMP_COLOR_ARRAY_3.getB()*255)}if(Array.isArray(oldValue)){TEMP_COLOR_ARRAY_2[0]=oldValue[0];TEMP_COLOR_ARRAY_2[1]=oldValue[1];TEMP_COLOR_ARRAY_2[2]=oldValue[2]}else{TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(oldValue);TEMP_COLOR_ARRAY_2[0]=Math.floor(TEMP_COLOR_ARRAY_3.getR()*
255);TEMP_COLOR_ARRAY_2[1]=Math.floor(TEMP_COLOR_ARRAY_3.getG()*255);TEMP_COLOR_ARRAY_2[2]=Math.floor(TEMP_COLOR_ARRAY_3.getB()*255)}if(TEMP_COLOR_ARRAY[0]!==TEMP_COLOR_ARRAY_2[0])return true;if(TEMP_COLOR_ARRAY[1]!==TEMP_COLOR_ARRAY_2[1])return true;if(TEMP_COLOR_ARRAY[2]!==TEMP_COLOR_ARRAY_2[2])return true;return false}static Interpolate(time,start,end,propertyTrack){if(!end){let propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack.GetPropertyTrackData();
propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);const color=propertyTrackDataItem.GetValueWithResultMode();TEMP_COLOR_ARRAY[0]=color[0];TEMP_COLOR_ARRAY[1]=color[1];TEMP_COLOR_ARRAY[2]=color[2];return TEMP_COLOR_ARRAY}let mode=propertyTrack.GetInterpolationMode();if(mode==="default")mode="continuous";if(mode==="discrete"){const color=start.GetValueWithResultMode();TEMP_COLOR_ARRAY[0]=color[0];TEMP_COLOR_ARRAY[1]=color[1];TEMP_COLOR_ARRAY[2]=color[2];
return TEMP_COLOR_ARRAY}else if(mode==="continuous"||mode==="step"){const step=propertyTrack.GetTimeline().GetStep();if(mode==="step"&&step!==0){const s=1/step;time=Math.floor(time*s)/s}const st=start.GetTime();const et=end.GetTime();const sv=start.GetValueWithResultMode();const ev=end.GetValueWithResultMode();if(mode==="step"&&step!==0)time=C3.clamp(time,st,et);const n=C3.normalize(time,st,et);const e=start.GetEase();const sr=sv[0];const sg=sv[1];const sb=sv[2];const er=ev[0];const eg=ev[1];const eb=
ev[2];const easeFunc=self.Ease.GetRuntimeEase(e);const d=et-st;const dn=d*n;if(sr===er)TEMP_COLOR_ARRAY[0]=sr;else TEMP_COLOR_ARRAY[0]=easeFunc(dn,sr,er-sr,d);if(sg===eg)TEMP_COLOR_ARRAY[1]=sg;else TEMP_COLOR_ARRAY[1]=easeFunc(dn,sg,eg-sg,d);if(sb===eb)TEMP_COLOR_ARRAY[2]=sb;else TEMP_COLOR_ARRAY[2]=easeFunc(dn,sb,eb-sb,d);return TEMP_COLOR_ARRAY}}};

}

// timelines/state/propertyTypeAdapters/textTypeAdapter.js
{
'use strict';const C3=self.C3;
C3.PropertyTrackState.TextTypeAdapter=class TextTypeAdapter{constructor(){}static WillChange(index,source,newValue,type){let oldValue;switch(type){case "behavior":oldValue=source.GetPropertyValueByIndex(index);break;case "effect":oldValue=source[index];break;case "instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case "plugin":oldValue=source.GetPropertyValueByIndex(index);break}if(oldValue===newValue)return false;return true}static Interpolate(time,start,end,propertyTrack){if(!end){let propertyTrackDataItem=
propertyTrack.GetPropertyTrackDataItem();const propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode()}return start.GetValueWithResultMode()}};

}

// timelines/data/timelineDataManager.js
{
'use strict';const C3=self.C3;
C3.TimelineDataManager=class TimelineDataManager{constructor(){this._timelineDataItems=new Map}Release(){for(const timelineDataItem of this._timelineDataItems.values())timelineDataItem.Release();this._timelineDataItems.clear();this._timelineDataItems=null}Add(data){const timelineDataItem=new C3.TimelineDataItem(data);const name=timelineDataItem.GetName();this._timelineDataItems.set(name,timelineDataItem)}Get(name){return this._timelineDataItems.get(name)}GetNameId(){return 0}static _CreateDataItems(items,jsonItems,
dataItemConstructor,dataContainer){if(!jsonItems)return;for(const jsonItem of jsonItems)C3.TimelineDataManager._CreateDataItem("create",jsonItem,items,dataItemConstructor,dataContainer)}static _CreateDataItemsIncludingDisabled(items,jsonItems,dataItemConstructor,dataContainer){if(!jsonItems)return;for(const jsonItem of jsonItems)C3.TimelineDataManager._CreateDataItem("create-including-disabled",jsonItem,items,dataItemConstructor,dataContainer)}static _LoadDataItemsFromJson(items,jsonItems,dataItemConstructor,
dataContainer){if(items.length)jsonItems.forEach((jsonItem,index)=>{items[index]._LoadFromJson(jsonItem)});else jsonItems.forEach(jsonItem=>{C3.TimelineDataManager._CreateDataItem("load",jsonItem,items,dataItemConstructor,dataContainer)})}static _CreateDataItem(mode,json,items,dataItemConstructor,dataContainer){let dataItem;if(typeof dataItemConstructor==="function")switch(mode){case "load":dataItem=new dataItemConstructor(null,dataContainer);break;case "create":dataItem=new dataItemConstructor(json,
dataContainer);break;case "create-including-disabled":dataItem=new dataItemConstructor(json,dataContainer);break}else if(typeof dataItemConstructor==="object"){const prop=dataItemConstructor.prop;const value=json[prop];const cnstrctr=dataItemConstructor.map.get(value);switch(mode){case "load":dataItem=new cnstrctr(null,dataContainer);break;case "create":dataItem=new cnstrctr(json,dataContainer);break;case "create-including-disabled":dataItem=new cnstrctr(json,dataContainer);break}}switch(mode){case "load":dataItem._LoadFromJson(json);
items.push(dataItem);break;case "create":if(typeof dataItem.GetEnable==="function"&&!dataItem.GetEnable())return dataItem.Release();items.push(dataItem);break;case "create-including-disabled":items.push(dataItem);break}}};

}

// timelines/data/timelineData.js
{
'use strict';const C3=self.C3;const NAME=0;const TOTAL_TIME=1;const STEP=2;const INTERPOLATION_MODE=3;const RESULT_MODE=4;const TRACKS=5;const LOOP=6;const PING_PONG=7;const REPEAT_COUNT=8;const START_ON_LAYOUT=9;const TRANSFORM_WITH_SCENE_GRAPH=10;const USE_SYSTEM_TIMESCALE=11;
C3.TimelineDataItem=class TimelineDataItem{constructor(timelineDataJson){this._name="";this._totalTime=NaN;this._step=0;this._interpolationMode="default";this._resultMode="default";this._loop=false;this._pingPong=false;this._repeatCount=1;this._trackData=null;this._startOnLayout="";this._transformWithSceneGraph=false;this._useSystemTimescale=true;if(!timelineDataJson)return;this._name=timelineDataJson[NAME];this._totalTime=timelineDataJson[TOTAL_TIME];this._step=timelineDataJson[STEP];this._interpolationMode=
timelineDataJson[INTERPOLATION_MODE];this._resultMode=timelineDataJson[RESULT_MODE];this._loop=!!timelineDataJson[LOOP];this._pingPong=!!timelineDataJson[PING_PONG];this._repeatCount=timelineDataJson[REPEAT_COUNT];this._startOnLayout=timelineDataJson[START_ON_LAYOUT];this._transformWithSceneGraph=!!timelineDataJson[TRANSFORM_WITH_SCENE_GRAPH];this._useSystemTimescale=!!timelineDataJson[USE_SYSTEM_TIMESCALE];this._trackData=new C3.TrackData(timelineDataJson[TRACKS],this)}Release(){this._trackData.Release();
this._trackData=null}GetTrackData(){if(!this._trackData)this._trackData=new C3.TrackData(null,this);return this._trackData}GetName(){return this._name}SetName(n){this._name=n}GetTotalTime(){return this._totalTime}SetTotalTime(tt){this._totalTime=tt}GetStep(){return this._step}SetStep(s){this._step=s}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(im){this._interpolationMode=im}GetResultMode(){return this._resultMode}SetResultMode(rm){this._resultMode=rm}GetLoop(){return this._loop}SetLoop(l){this._loop=
l}GetPingPong(){return this._pingPong}SetPingPong(p){this._pingPong=p}GetRepeatCount(){return this._repeatCount}SetRepeatCount(rc){this._repeatCount=rc}GetStartOnLayout(){return this._startOnLayout}GetTransformWithSceneGraph(){return this._transformWithSceneGraph}GetUseSystemTimescale(){return this._useSystemTimescale}_SaveToJson(){return{"trackDataJson":this._trackData._SaveToJson(),"name":this._name,"totalTime":this._totalTime,"step":this._step,"interpolationMode":this._interpolationMode,"resultMode":this._resultMode,
"loop":this._loop,"pingPong":this._pingPong,"repeatCount":this._repeatCount,"startOnLayout":this._startOnLayout,"transformWithSceneGraph":!!this._transformWithSceneGraph,"useSystemTimescale":this._useSystemTimescale}}_LoadFromJson(o){if(!o)return;this.GetTrackData()._LoadFromJson(o["trackDataJson"]);this._name=o["name"];this._totalTime=o["totalTime"];this._step=o["step"];this._interpolationMode=o["interpolationMode"];this._resultMode=o["resultMode"];this._loop=o["loop"];this._pingPong=o["pingPong"];
this._repeatCount=o["repeatCount"];this._startOnLayout=o["startOnLayout"];this._transformWithSceneGraph=!!o["transformWithSceneGraph"];this._useSystemTimescale=!!o["useSystemTimescale"]}};

}

// timelines/data/trackData.js
{
'use strict';const C3=self.C3;const WI_DATA=0;const OC_INDEX=1;const WI_UID=2;const INTERPOLATION_MODE=1;const RESULT_MODE=2;const ENABLED=3;const KEYFRAMES=4;const PROPERTY_TRACKS=5;const ID=6;const NESTED_DATA=7;const START_OFFSET=0;const LOCAL_TOTAL_TIME=1;const WI_ADDITIONAL_DATA=8;const ORIGINAL_WIDTH=0;const ORIGINAL_HEIGHT=1;const TRACK_TYPE=9;const TRACK_NAME=10;
class TrackDataItem{constructor(trackDataJson,trackData){this._trackData=trackData;this._instanceData=null;this._additionalInstanceData=null;this._instanceUid=NaN;this._objectClassIndex=NaN;this._interpolationMode="default";this._resultMode="default";this._enabled=false;this._keyframeData=null;this._propertyTrackData=null;this._id="";this._nestedData=null;this._startOffset=0;this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime();this._type=0;this._name="";if(!trackDataJson)return;
if(trackDataJson[WI_DATA]){this._instanceData=trackDataJson[WI_DATA];this._instanceUid=trackDataJson[WI_DATA][WI_UID];this._objectClassIndex=trackDataJson[WI_DATA][OC_INDEX]}this._interpolationMode=trackDataJson[INTERPOLATION_MODE];this._resultMode=trackDataJson[RESULT_MODE];this._enabled=!!trackDataJson[ENABLED];if(trackDataJson[ID])this._id=trackDataJson[ID];if(trackDataJson[NESTED_DATA]){this._nestedData=trackDataJson[NESTED_DATA];this._startOffset=trackDataJson[NESTED_DATA][START_OFFSET];this._localTotalTime=
trackDataJson[NESTED_DATA][LOCAL_TOTAL_TIME]}if(trackDataJson[WI_ADDITIONAL_DATA])this._additionalInstanceData=trackDataJson[WI_ADDITIONAL_DATA];if(trackDataJson[WI_ADDITIONAL_DATA])this._additionalInstanceData=trackDataJson[WI_ADDITIONAL_DATA];if(trackDataJson[TRACK_TYPE])this._type=trackDataJson[TRACK_TYPE];if(trackDataJson[TRACK_NAME])this._name=trackDataJson[TRACK_NAME];this._keyframeData=new C3.KeyframeData(trackDataJson[KEYFRAMES],this);this._propertyTrackData=new C3.PropertyTrackData(trackDataJson[PROPERTY_TRACKS],
this)}Release(){this._instanceData=null;this._trackData=null;if(this._keyframeData){this._keyframeData.Release();this._keyframeData=null}if(this._propertyTrackData){this._propertyTrackData.Release();this._propertyTrackData=null}this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){if(!this._keyframeData)this._keyframeData=new C3.KeyframeData(null,this);return this._keyframeData}GetPropertyTrackData(){if(!this._propertyTrackData)this._propertyTrackData=new C3.PropertyTrackData(null,
this);return this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(index){this._objectClassIndex=index}GetInstanceUID(){return this._instanceUid}SetInstanceUID(uid){this._instanceUid=uid}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(im){this._interpolationMode=im}GetResultMode(){return this._resultMode}SetResultMode(rm){this._resultMode=rm}GetEnable(){return this._enabled}SetEnable(e){this._enabled=
!!e}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(t){this._localTotalTime=t}GetOriginalWidth(){return this._additionalInstanceData[ORIGINAL_WIDTH]}SetOriginalWidth(w){if(!this._additionalInstanceData)this._additionalInstanceData=[];this._additionalInstanceData[ORIGINAL_WIDTH]=w}GetOriginalHeight(){if(!this._additionalInstanceData)this._additionalInstanceData=[];return this._additionalInstanceData[ORIGINAL_HEIGHT]}SetOriginalHeight(h){if(!this._additionalInstanceData)this._additionalInstanceData=
[];this._additionalInstanceData[ORIGINAL_HEIGHT]=h}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{"keyframeDataJson":this._keyframeData._SaveToJson(),"propertyTrackDataJson":this._propertyTrackData._SaveToJson(),"instanceData":this._instanceData,"additionalInstanceData":this._additionalInstanceData,"instanceUid":this._instanceUid,"objectClassIndex":this._objectClassIndex,"interpolationMode":this._interpolationMode,"resultMode":this._resultMode,"enabled":this._enabled,
"id":this._id,"nestedData":this._nestedData,"type":this._type,"name":this._name}}_LoadFromJson(o){if(!o)return;this._instanceData=o["instanceData"];this._instanceUid=o["instanceUid"];this._objectClassIndex=o["objectClassIndex"];this._interpolationMode=o["interpolationMode"];this._resultMode=o["resultMode"];this._enabled=o["enabled"];this._id=o["id"];this._type=o["type"]?o["type"]:0;this._name=o["name"]?o["name"]:"";this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime();if(o["nestedData"]){this._nestedData=
o["nestedData"];this._startOffset=this._nestedData[START_OFFSET];this._localTotalTime=this._nestedData[LOCAL_TOTAL_TIME]}if(o["additionalInstanceData"])this._additionalInstanceData=o["additionalInstanceData"];this.GetKeyframeData()._LoadFromJson(o["keyframeDataJson"]);this.GetPropertyTrackData()._LoadFromJson(o["propertyTrackDataJson"])}}
C3.TrackData=class TrackData{constructor(tracksDataJson,timelineDataItem){this._timelineDataItem=timelineDataItem;this._trackDataItems=[];C3.TimelineDataManager._CreateDataItems(this._trackDataItems,tracksDataJson,TrackDataItem,this)}Release(){this._timelineDataItem=null;for(const trackDataItem of this._trackDataItems)trackDataItem.Release();C3.clearArray(this._trackDataItems);this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){const trackDataItem=
new TrackDataItem(null,this);this._trackDataItems.push(trackDataItem);return trackDataItem}GetFirstKeyframeDataItem(trackDataItem){return trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(trackDataItem){const keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();return keyframeDataItems.at(-1)}GetKeyFrameDataItemAtTime(time,trackDataItem){const keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();const l=keyframeDataItems.length;
for(let i=0;i<l;i++){const keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()===time)return keyframeDataItem}}GetFirstKeyFrameDataItemHigherThan(time,trackDataItem){const keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();const l=keyframeDataItems.length;for(let i=0;i<l;i++){const keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()>time)return keyframeDataItem}}GetFirstKeyFrameDataItemHigherOrEqualThan(time,trackDataItem){const keyframeDataItems=
trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();const l=keyframeDataItems.length;for(let i=0;i<l;i++){const keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()>=time)return keyframeDataItem}}GetFirstKeyFrameDataItemLowerOrEqualThan(time,trackDataItem){const keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();for(let i=keyframeDataItems.length-1;i>=0;i--){const keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()<=time)return keyframeDataItem}}*trackDataItems(){for(const trackDataItem of this._trackDataItems)yield trackDataItem}_SaveToJson(){return{"trackDataItemsJson":this._trackDataItems.map(trackDataItem=>
trackDataItem._SaveToJson())}}_LoadFromJson(o){if(!o)return;C3.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,o["trackDataItemsJson"],TrackDataItem,this)}};

}

// timelines/data/propertyTrackData.js
{
'use strict';const C3=self.C3;const SOURCE_DATA=0;const SOURCE=0;const PROPERTY=1;const TYPE=2;const MIN=3;const MAX=4;const INTERPOLATION_MODE=5;const RESULT_MODE=6;const ENABLED=7;const PROPERTY_KEYFRAMES=8;const CAN_HAVE_PROPERTY_KEYFRAMES=9;
class PropertyTrackDataItem{constructor(propertyTrackDataJson,propertyTrackData){this._propertyTrackData=propertyTrackData;this._sourceAdapterId="";this._sourceAdapterArguments=null;this._property=null;this._type=null;this._min=NaN;this._max=NaN;this._interpolationMode="default";this._resultMode="default";this._enabled=false;this._propertyKeyframeData=null;this._canHavePropertyKeyframes=true;if(!propertyTrackDataJson)return;this._sourceAdapterId=propertyTrackDataJson[SOURCE_DATA][SOURCE];this._sourceAdapterArguments=
propertyTrackDataJson[SOURCE_DATA].slice(1);this._property=propertyTrackDataJson[PROPERTY];this._type=propertyTrackDataJson[TYPE];this._min=propertyTrackDataJson[MIN];this._max=propertyTrackDataJson[MAX];this._interpolationMode=propertyTrackDataJson[INTERPOLATION_MODE];this._resultMode=propertyTrackDataJson[RESULT_MODE];this._enabled=!!propertyTrackDataJson[ENABLED];this._propertyKeyframeData=new C3.PropertyKeyframeData(propertyTrackDataJson[PROPERTY_KEYFRAMES],this);this._canHavePropertyKeyframes=
propertyTrackDataJson[CAN_HAVE_PROPERTY_KEYFRAMES]}Release(){this._propertyKeyframeData.Release();this._propertyKeyframeData=null;this._propertyTrackData=null;this._sourceAdapterArguments=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){if(!this._propertyKeyframeData)this._propertyKeyframeData=new C3.PropertyKeyframeData(null,this);return this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(said){this._sourceAdapterId=
said}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(sargs){this._sourceAdapterArguments=sargs}GetProperty(){return this._property}SetProperty(p){this._property=p}GetType(){return this._type}SetType(t){this._type=t}GetMin(){return this._min}SetMin(min){this._min=min}GetMax(){return this._max}SetMax(max){this._max=max}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(im){this._interpolationMode=im}GetResultMode(){return this._resultMode}SetResultMode(rm){this._resultMode=
rm}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{"propertyKeyframeDataJson":this._propertyKeyframeData._SaveToJson(),"sourceAdapterId":this._sourceAdapterId,"sourceAdapterArguments":this._sourceAdapterArguments,"property":this._property,"type":this._type,"min":this._min,"max":this._max,"interpolationMode":this._interpolationMode,"resultMode":this._resultMode,"enabled":this._enabled,"canHavePropertyKeyframes":this._canHavePropertyKeyframes}}_LoadFromJson(o){if(!o)return;
this._sourceAdapterId=o["sourceAdapterId"];this._sourceAdapterArguments=o["sourceAdapterArguments"];this._property=o["property"];this._type=o["type"];this._min=o["min"];this._max=o["max"];this._interpolationMode=o["interpolationMode"];this._resultMode=o["resultMode"];this._enabled=o["enabled"];this._canHavePropertyKeyframes=o["canHavePropertyKeyframes"];this.GetPropertyKeyframeData()._LoadFromJson(o["propertyKeyframeDataJson"])}}
C3.PropertyTrackData=class PropertyTrackData{constructor(propertyTracksDataJson,trackDataItem){this._trackDataItem=trackDataItem;this._propertyTrackDataItems=[];C3.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,propertyTracksDataJson,PropertyTrackDataItem,this)}Release(){this._trackDataItem=null;for(const propertyTrackDataItem of this._propertyTrackDataItems)propertyTrackDataItem.Release();C3.clearArray(this._propertyTrackDataItems);this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){const propertyTrackDataItem=
new PropertyTrackDataItem(null,this);this._propertyTrackDataItems.push(propertyTrackDataItem);return propertyTrackDataItem}GetFirstPropertyKeyframeDataItem(propertyTrackDataItem){const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();return propertyKeyframeData.GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(propertyTrackDataItem){const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();const propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();
return propertyKeyframeDataItems.at(-1)}GetPropertyKeyFrameDataItemAtTime(time,propertyTrackDataItem){const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();const propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();const l=propertyKeyframeDataItems.length;for(let i=0;i<l;i++){const propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()===time)return propertyKeyframeDataItem}}GetFirstPropertyKeyFrameDataItemHigherThan(time,
propertyTrackDataItem){const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();const propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();const l=propertyKeyframeDataItems.length;for(let i=0;i<l;i++){const propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()>time)return propertyKeyframeDataItem}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,propertyTrackDataItem){const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();
const propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();const l=propertyKeyframeDataItems.length;for(let i=0;i<l;i++){const propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()>=time)return propertyKeyframeDataItem}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,propertyTrackDataItem){const propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();const propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();
for(let i=propertyKeyframeDataItems.length-1;i>=0;i--){const propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()<=time)return propertyKeyframeDataItem}}*propertyTrackDataItems(){for(const propertyTrackDataItem of this._propertyTrackDataItems)yield propertyTrackDataItem}_SaveToJson(){return{"propertyTrackDataItemsJson":this._propertyTrackDataItems.map(propertyTrackDataItem=>propertyTrackDataItem._SaveToJson())}}_LoadFromJson(o){if(!o)return;C3.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,
o["propertyTrackDataItemsJson"],PropertyTrackDataItem,this)}};

}

// timelines/data/keyframeData.js
{
'use strict';const C3=self.C3;const TIME=0;const EASE=1;const ENABLE=2;const TAGS=3;
class KeyframeDataItem{constructor(keyframeDataJson,keyframeData){this._keyframeData=keyframeData;this._time=-1;this._ease="noease";this._enable=false;this._tags=null;this._lowerTags=null;if(!keyframeDataJson)return;this._time=keyframeDataJson[TIME];this._ease=keyframeDataJson[EASE];this._enable=!!keyframeDataJson[ENABLE];const tagStr=keyframeDataJson[TAGS];this._tags=tagStr?tagStr.split(" "):[];this._lowerTags=new Set(this._tags.map(t=>t.toLowerCase()));this._next=null}Release(){this._keyframeData=
null;C3.clearArray(this._tags);this._tags=null;this._lowerTags.clear();this._lowerTags=null;this._next=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(next){this._next=next}GetTime(){return this._time}SetTime(t){this._time=t;this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetTags(){return this._tags}SetTags(t){this._tags=t?t.split(" "):[];this._lowerTags=
new Set(this._tags.map(t=>t.toLowerCase()))}GetLowerTags(){return this._lowerTags}HasTag(tag){return this._lowerTags.has(tag.toLowerCase())}_SaveToJson(){return{"time":this._time,"ease":this._ease,"enable":this._enable,"tags":this._tags}}_LoadFromJson(o){if(!o)return;this._time=o["time"];this._ease=o["ease"];this._enable=o["enable"];this._tags=o["tags"];this._lowerTags=new Set(this._tags.map(t=>t.toLowerCase()))}}
C3.KeyframeData=class KeyframeData{constructor(keyframesDataJson,trackDataItem){this._trackDataItem=trackDataItem;this._keyframeDataItems=[];C3.TimelineDataManager._CreateDataItems(this._keyframeDataItems,keyframesDataJson,KeyframeDataItem,this);this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(const keyframeDataItem of this._keyframeDataItems)keyframeDataItem.Release();C3.clearArray(this._keyframeDataItems);this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort((first,
second)=>first.GetTime()-second.GetTime());for(let i=0;i<this._keyframeDataItems.length;i++){const current=this._keyframeDataItems[i];current.SetNext(this._keyframeDataItems[i+1])}}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){const keyframeDataItem=new KeyframeDataItem(null,this);this._keyframeDataItems.push(keyframeDataItem);this._LinkKeyframeDataItems();
return keyframeDataItem}DeleteKeyframeDataItems(match){for(const keyframeDataItem of this._keyframeDataItems){if(!match(keyframeDataItem))continue;const index=this._keyframeDataItems.indexOf(keyframeDataItem);if(index===-1)continue;keyframeDataItem.Release();this._keyframeDataItems.splice(index,1)}this.SortKeyframeDataItems();this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort((a,b)=>a.GetTime()-b.GetTime())}GetKeyframeDataItemIndex(keyframeDataItem){return this._keyframeDataItems.indexOf(keyframeDataItem)}GetKeyframeDataItemFromIndex(index){return this._keyframeDataItems[index]}*keyframeDataItems(){for(const keyframeDataItem of this._keyframeDataItems)yield keyframeDataItem}*keyframeDataItemsReverse(){for(let i=
this._keyframeDataItems.length-1;i>=0;i--)yield this._keyframeDataItems[i]}_SaveToJson(){return{"keyframeDataItemsJson":this._keyframeDataItems.map(keyframeDataItem=>keyframeDataItem._SaveToJson())}}_LoadFromJson(o){if(!o)return;C3.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,o["keyframeDataItemsJson"],KeyframeDataItem,this);this._LinkKeyframeDataItems()}};

}

// timelines/data/propertyKeyframeData.js
{
'use strict';const C3=self.C3;const VALUE_DATA=0;const VALUE_DATA_VALUE=0;const VALUE_DATA_ABSOLUTE_VALUE=1;const VALUE_DATA_TYPE=2;const TIME=1;const EASE=2;const ENABLE=3;const ADDONS=4;const PATH_MODE=5;
class PropertyKeyframeDataItem{constructor(propertyKeyframeDataJson,propertyKeyframeData){this._propertyKeyframeData=propertyKeyframeData;this._value=null;this._aValue=null;this._type="";this._time=NaN;this._ease="noease";this._enable=false;this._addonData=null;this._addonInstance=undefined;this._pathMode="line";if(!propertyKeyframeDataJson)return;this._value=propertyKeyframeDataJson[VALUE_DATA][VALUE_DATA_VALUE];this._aValue=propertyKeyframeDataJson[VALUE_DATA][VALUE_DATA_ABSOLUTE_VALUE];this._type=
propertyKeyframeDataJson[VALUE_DATA][VALUE_DATA_TYPE];this._time=propertyKeyframeDataJson[TIME];this._ease=propertyKeyframeDataJson[EASE];this._enable=!!propertyKeyframeDataJson[ENABLE];this._pathMode=propertyKeyframeDataJson[PATH_MODE];this._addonData=null;if(!!propertyKeyframeDataJson[ADDONS])this._addonData=new C3.AddonData(propertyKeyframeDataJson[ADDONS],this);this._next=null;this._prev=null}Release(){this._propertyKeyframeData=null;if(this._addonData){this._addonData.Release();this._addonData=
null}this._next=null;this._prev=null}GetAddonData(){return this._addonData}SetNext(next){this._next=next}GetNext(){return this._next}SetPrevious(prev){this._prev=prev}GetPrevious(){return this._prev}GetValue(){return this._value}SetValue(value){if(this._type==="color"&&C3.IsFiniteNumber(value)){this._value[0]=C3.GetRValue(value);this._value[1]=C3.GetGValue(value);this._value[2]=C3.GetBValue(value)}else this._value=value}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(aValue){if(this._type===
"color"&&C3.IsFiniteNumber(aValue)){this._aValue[0]=C3.GetRValue(aValue);this._aValue[1]=C3.GetGValue(aValue);this._aValue[2]=C3.GetBValue(aValue)}else this._aValue=aValue}GetValueWithResultMode(){const rm=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();if(rm==="relative")return this.GetValue();else if(rm==="absolute")return this.GetAbsoluteValue()}GetType(){return this._type}SetType(t){this._type=t}GetTime(){return this._time}SetTime(t){this._time=t;this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=
e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetPathMode(){return this._pathMode}GetAddOn(id){if(!this._addonData)return;if(this._addonInstance||this._addonInstance===null)return this._addonInstance;const addonArray=this._addonData.GetAddDataItemArray();if(!addonArray){this._addonInstance=null;return this._addonInstance}const len=addonArray.length;for(let i=0;i<len;i++){const addon=addonArray[i];if(addon.GetId()===id){this._addonInstance=addon;return this._addonInstance}}this._addonInstance=
null;return this._addonInstance}_SaveToJson(){const aData=this._addonData;return{"addonDataJson":aData?aData._SaveToJson():aData,"value":this._value,"aValue":this._aValue,"type":this._type,"time":this._time,"ease":this._ease,"enable":this._enable}}_LoadFromJson(o){if(!o)return;if(o["addonDataJson"])this._addonData._SetFromJson(o["addonDataJson"]);this._value=o["value"];this._aValue=o["aValue"];this._type=o["type"];this._time=o["time"];this._ease=o["ease"];this._enable=o["enable"]}}
C3.PropertyKeyframeData=class PropertyKeyframeData{constructor(propertyKeyframesDataJson,propertyTrackDataItem){this._propertyTrackDataItem=propertyTrackDataItem;this._propertyKeyframeDataItems=[];this._propertyKeyframeDataItemsIncludingDisabled=[];C3.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,propertyKeyframesDataJson,PropertyKeyframeDataItem,this);C3.TimelineDataManager._CreateDataItemsIncludingDisabled(this._propertyKeyframeDataItemsIncludingDisabled,propertyKeyframesDataJson,
PropertyKeyframeDataItem,this);this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=null;for(const propertyKeyframeDataItem of this._propertyKeyframeDataItems)propertyKeyframeDataItem.Release();C3.clearArray(this._propertyKeyframeDataItems);this._propertyKeyframeDataItems=null;for(const propertyKeyframeDataItem of this._propertyKeyframeDataItemsIncludingDisabled)propertyKeyframeDataItem.Release();C3.clearArray(this._propertyKeyframeDataItemsIncludingDisabled);this._propertyKeyframeDataItemsIncludingDisabled=
null}_LinkPropertyKeyframeDataItems(){let dataItems=this._propertyKeyframeDataItems;dataItems.sort((first,second)=>first.GetTime()-second.GetTime());for(let i=0;i<dataItems.length;i++){const current=dataItems[i];if(i+1<dataItems.length)current.SetNext(dataItems[i+1]);if(i-1>=0)current.SetPrevious(dataItems[i-1])}dataItems=this._propertyKeyframeDataItemsIncludingDisabled;dataItems.sort((first,second)=>first.GetTime()-second.GetTime());for(let i=0;i<dataItems.length;i++){const current=dataItems[i];
if(i+1<dataItems.length)current.SetNext(dataItems[i+1]);if(i-1>=0)current.SetPrevious(dataItems[i-1])}}AddEmptyPropertyKeyframeDataItem(){const propertyKeyframeDataItem=new PropertyKeyframeDataItem(null,this);this._propertyKeyframeDataItems.push(propertyKeyframeDataItem);this._LinkPropertyKeyframeDataItems();return propertyKeyframeDataItem}DeletePropertyKeyframeDataItems(match){for(const propertyKeyframeDataItem of this._propertyKeyframeDataItems){if(!match(propertyKeyframeDataItem))continue;const index=
this._propertyKeyframeDataItems.indexOf(propertyKeyframeDataItem);if(index===-1)continue;propertyKeyframeDataItem.Release();this._propertyKeyframeDataItems.splice(index,1)}this.SortPropertyKeyFrameDataItems();this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort((a,b)=>a.GetTime()-b.GetTime())}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-
1]}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyKeyframeDataItemsIncludingDisabled}*propertyKeyframeDataItems(){for(const propertyKeyframeDataItem of this._propertyKeyframeDataItems)yield propertyKeyframeDataItem}*propertyKeyframeDataItemsReverse(){for(let i=this._propertyKeyframeDataItems.length-1;i>=0;i--)yield this._propertyKeyframeDataItems[i]}_SaveToJson(){const propertyKeyframeDataItems=this._propertyKeyframeDataItems;
const propertyKeyframeDataItemsIncludingDisabled=this._propertyKeyframeDataItemsIncludingDisabled;return{"propertyKeyframeDataItemsJson":propertyKeyframeDataItems.map(propertyTrackDataItem=>{return propertyTrackDataItem._SaveToJson()}),"propertyKeyframeDataItemsIncludingDisabledJson":propertyKeyframeDataItemsIncludingDisabled.map(propertyTrackDataItem=>{return propertyTrackDataItem._SaveToJson()})}}_LoadFromJson(o){if(!o)return;C3.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,
o["propertyKeyframeDataItemsJson"],PropertyKeyframeDataItem,this);C3.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItemsIncludingDisabled,o["propertyKeyframeDataItemsIncludingDisabledJson"],PropertyKeyframeDataItem,this);this._LinkPropertyKeyframeDataItems()}};

}

// timelines/data/propertyKeyframeAddonData.js
{
'use strict';const C3=self.C3;const ADDON_ID=0;const ADDON_DATA=1;class AddonDataItem{constructor(addonDataJson,addonData){this._addonData=addonData;this._id=addonDataJson[ADDON_ID];this._data=addonDataJson[ADDON_DATA]}Release(){this._addonData=null;this._data=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{"id":this._id,"data":this._data}}_LoadFromJson(o){if(!o)return;this._id=o["id"];this._data=o["data"]}}const START_ANCHOR=0;const START_ENABLE=1;
const END_ANCHOR=2;const END_ENABLE=3;
class AddonDataCubicBezierItem extends AddonDataItem{constructor(addonDataJson,addonData){super(addonDataJson,addonData);this._startAnchor=this._data[START_ANCHOR];this._startEnable=!!this._data[START_ENABLE];this._endAnchor=this._data[END_ANCHOR];this._endEnable=!!this._data[END_ENABLE]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{"startAnchor":this._startAnchor,
"startEnable":!!this._startEnable,"endAnchor":this._endAnchor,"endEnable":!!this._endEnable})}_LoadFromJson(o){if(!o)return;super._LoadFromJson(o);this._startAnchor=o["startAnchor"];this._startEnable=!!o["startEnable"];this._endAnchor=o["endAnchor"];this._endEnable=!!o["endEnable"]}}const DIRECTION=0;const REVOLUTIONS=1;
class AddonDataAngleItem extends AddonDataItem{constructor(addonDataJson,addonData){super(addonDataJson,addonData);this._direction=this._data[DIRECTION];this._revolutions=this._data[REVOLUTIONS]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{"direction":this._direction,"revolutions":this._revolutions})}_LoadFromJson(o){if(!o)return;super._LoadFromJson(o);this._direction=o["direction"];
this._revolutions=o["revolutions"]}}
C3.AddonData=class AddonData{constructor(addonsDataJson,propertyKeyframeDataItem){this._propertyKeyframeDataItem=propertyKeyframeDataItem;this._addonDataItems=[];C3.TimelineDataManager._CreateDataItems(this._addonDataItems,addonsDataJson,{prop:0,map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}Release(){this._propertyKeyframeDataItem=null;for(const addonDataItem of this._addonDataItems)addonDataItem.Release();C3.clearArray(this._addonDataItems);this._addonDataItems=
null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(const addonDataItem of this._addonDataItems)yield addonDataItem}_SaveToJson(){return{"addonDataItemsJson":this._addonDataItems.map(addonDataItem=>addonDataItem._SaveToJson())}}_LoadFromJson(o){if(!o)return;C3.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,o["addonDataItemsJson"],{prop:"id",map:new Map([["cubic-bezier",AddonDataCubicBezierItem],
["angle",AddonDataAngleItem]])},this)}};

}

// timelines/tweens/tweenState.js
{
'use strict';const C3=self.C3;const INITIAL_VALUE_MODE_START_VALUE="start-value";const INITIAL_VALUE_MODE_CURRENT_STATE="current-state";const PING_PONG_BEGIN=0;const PING_PONG_END=1;let createdTweens=0;
C3.TweenState=class Tween extends C3.TimelineState{constructor(tweenDataItem,timelineManager){super(`tween-${createdTweens++}`,tweenDataItem,timelineManager);this._id="";this._destroyInstanceOnComplete=false;this._initialValueMode=INITIAL_VALUE_MODE_START_VALUE;this._instance=null;this._on_completed_callbacks=null;this._on_started_callbacks=null;this._track=null;this._iTweenState=null}FireReleaseEvent(dispatcher){const event=C3.New(C3.Event,"tweenstatereleased");event.tweenState=this;dispatcher.dispatchEvent(event)}GetType(){return 1}CreateTrackStates(){for(const trackDataItem of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(C3.TweenTrackState.Create(this,
trackDataItem));this._track=this._tracks[0]}AddTrack(){const trackDataItem=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();const track=C3.TweenTrackState.Create(this,trackDataItem);this._tracks.push(track);this._CacheTrack();return track}_CacheTrack(){this._track=this._tracks[0]}GetPropertyTrack(propertyName){return this._track.GetPropertyTracks()[0]}SetPropertyType(type){this._propertyType=type}GetInstance(){const tracks=this.GetTracks();if(!tracks||!tracks.length)return;const track=
tracks[0];this._track=track;if(!track)return;const instance=track.GetInstance();return track.IsInstanceValid()?instance:undefined}AddStartedCallback(c){if(!this._on_started_callbacks)this._on_started_callbacks=[];this._on_started_callbacks.push(c)}AddCompletedCallback(c){if(!this._on_completed_callbacks)this._on_completed_callbacks=[];this._on_completed_callbacks.push(c)}RemoveStartedCallback(c){if(!this._on_started_callbacks)return;const index=this._on_started_callbacks.indexOf(c);if(index!==-1)this._on_started_callbacks.splice(index,
1)}RemoveCompletedCallback(c){if(!this._on_completed_callbacks)return;const index=this._on_completed_callbacks.indexOf(c);if(index!==-1)this._on_completed_callbacks.splice(index,1)}SetStartValue(startValue,propertyName){for(const track of this._tracks)for(const propertyTrack of track._propertyTracks){if(propertyTrack.GetPropertyName()!==propertyName)continue;const propertyTrackData=propertyTrack.GetPropertyTrackData();const propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();const propertyKeyframeDataItem=
propertyTrackData.GetFirstPropertyKeyframeDataItem(propertyTrackDataItem);propertyKeyframeDataItem.SetValue(startValue);propertyKeyframeDataItem.SetAbsoluteValue(startValue)}}_GetPropertyTrackState(propertyName){for(const track of this._tracks)for(const propertyTrack of track._propertyTracks)if(propertyTrack.GetPropertyName()===propertyName)return propertyTrack}BeforeSetEndValues(properties){for(const propertyName of properties){const propertyTrackState=this._GetPropertyTrackState(propertyName);this.SetStartValue(propertyTrackState.GetCurrentState(),
propertyName)}if(this.IsForwardPlayBack()){const newTotalTime=this.GetTotalTime()-this.GetTime();this.SetTotalTime(newTotalTime);for(const track of this._tracks)track.SetLocalTotalTime(newTotalTime);this._SetTime(0)}else{const newTotalTime=this.GetTime();this.SetTotalTime(newTotalTime);for(const track of this._tracks)track.SetLocalTotalTime(newTotalTime);this._SetTime(newTotalTime)}this.SetInitialStateFromSetTime()}SetEndValue(endValue,propertyName){const propertyTrackState=this._GetPropertyTrackState(propertyName);
const propertyTrackData=propertyTrackState.GetPropertyTrackData();const propertyTrackDataItem=propertyTrackState.GetPropertyTrackDataItem();const propertyKeyframeDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);propertyKeyframeDataItem.SetTime(this.GetTotalTime());propertyKeyframeDataItem.SetValue(endValue);propertyKeyframeDataItem.SetAbsoluteValue(endValue)}SetId(id){this._id=id}GetId(){return this._id}SetInitialValueMode(initialValueMode){this._initialValueMode=
initialValueMode}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(releaseOnComplete){this._destroyInstanceOnComplete=releaseOnComplete}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(const c of this._on_started_callbacks)c(this);if(this.IsComplete())return;for(const track of this._tracks)track.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(this._finishedTriggers)return;
this._finishedTriggers=true;if(this._on_completed_callbacks)for(const c of this._on_completed_callbacks)c(this)}SetTime(time){this._DeleteIntermediateKeyframes();super.SetTime(time)}_SetTimeAndReset(time){if(!C3.IsFiniteNumber(time))time=this.GetTotalTime();if(time<0)this._playheadTime=0;else if(time>=this.GetTotalTime())this._playheadTime=this.GetTotalTime();else this._playheadTime=time;this._track.SetResetState()}SetInitialState(fromSetTime){if(!this.InitialStateSet()&&this.GetInitialValueMode()===
INITIAL_VALUE_MODE_CURRENT_STATE)for(const track of this._tracks)track.CompareInitialStateWithCurrent();super.SetInitialState(fromSetTime)}Stop(completed=false){super.Stop(completed);if(this.IsComplete())return;for(const track of this._tracks)track.SaveState()}Reset(render=true,beforeChangeLayout=false){this._DeleteIntermediateKeyframes();super.Reset(render,beforeChangeLayout)}_DeleteIntermediateKeyframes(){for(const track of this._tracks){const del=kf=>{const time=kf.GetTime();const totalTime=this.GetTotalTime();
return time!==0&&time!==totalTime};track.DeleteKeyframes(del);track.DeletePropertyKeyframes(del)}}_OnBeforeChangeLayout(){if(this.IsReleased())return true;const instance=this.GetInstance();if(instance&&instance.GetObjectClass().IsGlobal())return false;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this);this.ResetBeforeChangeLayout();return true}Tick(deltaTime,timeScale,deltaTime1){if(!this._instance)this._instance=this.GetInstance();if(!this._instance||this._instance.IsDestroyed()){this.Stop(true);
this.OnCompleted();return}const instanceTimeScale=this._instance.GetTimeScale();if(instanceTimeScale!==-1)deltaTime=deltaTime1*instanceTimeScale;if(deltaTime===0&&this._lastDelta===0)return;this._lastDelta=deltaTime;const lastTime=this._playheadTime+this._overshoot;const newDeltaTime=deltaTime*this._playbackRate;const newTime=lastTime+newDeltaTime;const totalTime=this._timelineDataItem._totalTime;if(newTime<0){this._playheadTime=0;this._overshoot=-newTime}else if(newTime>=totalTime){this._playheadTime=
totalTime;this._overshoot=this._playheadTime-newTime}else{this._playheadTime=newTime;this._overshoot=0}let complete=false;let ensureValue=false;const loop=this.GetLoop();const pingPong=this.GetPingPong();if(!loop&&!pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(0);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);
ensureValue=true}else{this._SetTime(totalTime);complete=true}}else{if(this._playheadTime<=0)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(totalTime);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);ensureValue=true}else{this._SetTime(0);complete=true}}else if(loop&&!pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTimeAndReset(0);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);
this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);ensureValue=true}}else{if(this._playheadTime<=0){this._SetTimeAndReset(totalTime);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);ensureValue=true}}else if(!loop&&pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_END)if(this._currentRepeatCount<
this.GetRepeatCount()){this._currentRepeatCount++;this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong);this._pingPongState=PING_PONG_BEGIN}else{this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong);complete=true}else if(this._pingPongState===PING_PONG_BEGIN){this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);
this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong);this._pingPongState=PING_PONG_END}}}else{if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_END)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);
this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong);this._pingPongState=PING_PONG_BEGIN}else{complete=true;this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong)}else if(this._pingPongState===PING_PONG_BEGIN){this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong);this._pingPongState=PING_PONG_END}}}else if(loop&&pingPong)if(this._playbackRate>0){if(this._playheadTime>=
totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_BEGIN){this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong)}if(this._pingPongState===PING_PONG_END){this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong)}this._pingPongState++;
this._pingPongState=C3.wrap(this._pingPongState,0,2)}}else if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_BEGIN){this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong)}if(this._pingPongState===PING_PONG_END){this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensLoop);this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnAnyTweenPingPong);
this._TweenTrigger(C3.Behaviors.Tween.Cnds.OnTweensPingPong)}this._pingPongState++;this._pingPongState=C3.wrap(this._pingPongState,0,2)}if(complete){this._track.SetEndState();this.Stop(true);this.OnCompleted();return}this._track.Interpolate(this._playheadTime,true,false,ensureValue,this._firstTick,false);if(this._firstTick)this._firstTick=false}_TweenTrigger(method){const inst=this.GetInstance();const behInst=inst.GetBehaviorSdkInstanceFromCtor(C3.Behaviors.Tween);behInst.PushTriggerTween(this);this._runtime.Trigger(method,
inst,behInst.GetBehaviorType());behInst.PopTriggerTween()}_SaveToJson(){const ret=super._SaveToJson();const tweenDataItem=this.GetTimelineDataItem();return Object.assign(ret,{"tweenDataItemJson":tweenDataItem._SaveToJson(),"id":this._id,"destroyInstanceOnComplete":this._destroyInstanceOnComplete,"initialValueMode":this._initialValueMode})}_LoadFromJson(o){if(!o)return;const tweenDataItem=this.GetTimelineDataItem();tweenDataItem._LoadFromJson(o["tweenDataItemJson"]);super._LoadFromJson(o);this._id=
o["id"];this._destroyInstanceOnComplete=o["destroyInstanceOnComplete"];this._initialValueMode=o["initialValueMode"];this._CacheTrack()}static IsPlaying(tween){return tween.IsPlaying()}static IsPaused(tween){return tween.IsPaused()}static IsPing(tween){if(!tween.GetPingPong())return false;return tween.GetPingPongState()===PING_PONG_BEGIN}static IsPong(tween){if(!tween.GetPingPong())return false;return tween.GetPingPongState()===PING_PONG_END}static Build(config){const timelineManager=config.runtime.GetTimelineManager();
const tweenDataItem=new C3.TimelineDataItem;if(config.json){tweenDataItem._LoadFromJson(config.json["tweenDataItemJson"]);const tween=new C3.TweenState(tweenDataItem,timelineManager);tween._LoadFromJson(config.json);return tween}else{const tween=new C3.TweenState(tweenDataItem,timelineManager);if(!C3.IsArray(config.propertyTracksConfig))config.propertyTracksConfig=[config.propertyTracksConfig];tween.SetId(config.id);tween.SetTags(config.tags);tween.SetInitialValueMode(config.initialValueMode);tween.SetDestroyInstanceOnComplete(config.releaseOnComplete);
tween.SetLoop(config.loop);tween.SetPingPong(config.pingPong);tween.SetTotalTime(config.time);tween.SetStep(0);tween.SetInterpolationMode("default");tween.SetResultMode(config.propertyTracksConfig[0].resultMode);tween.SetRepeatCount(config.repeatCount);const track=tween.AddTrack();track.SetInstanceUID(config.instance.GetUID());track.SetInterpolationMode("default");track.SetResultMode(config.propertyTracksConfig[0].resultMode);track.SetEnable(true);track.SetObjectClassIndex(config.instance.GetObjectClass().GetIndex());
const sdkIntance=config.instance.GetSdkInstance();const w=sdkIntance.IsOriginalSizeKnown()?sdkIntance.GetOriginalWidth():config.instance.GetWorldInfo().GetWidth();const h=sdkIntance.IsOriginalSizeKnown()?sdkIntance.GetOriginalHeight():config.instance.GetWorldInfo().GetHeight();track.SetOriginalWidth(w);track.SetOriginalHeight(h);const startKeyframeDataItem=track.AddKeyframe();startKeyframeDataItem.SetTime(0);startKeyframeDataItem.SetEase("noease");startKeyframeDataItem.SetEnable(true);startKeyframeDataItem.SetTags("");
const endKeyframeDataItem=track.AddKeyframe();endKeyframeDataItem.SetTime(config.time);endKeyframeDataItem.SetEase("noease");endKeyframeDataItem.SetEnable(true);endKeyframeDataItem.SetTags("");for(const propertyTrackConfig of config.propertyTracksConfig){const propertyTrack=track.AddPropertyTrack();propertyTrack.SetSourceAdapterId(propertyTrackConfig.sourceId);propertyTrack.SetSourceAdapterArgs(propertyTrackConfig.sourceArgs);propertyTrack.SetPropertyName(propertyTrackConfig.property);propertyTrack.SetPropertyType(propertyTrackConfig.type);
propertyTrack.SetMin(NaN);propertyTrack.SetMax(NaN);propertyTrack.SetInterpolationMode("default");propertyTrack.SetResultMode(propertyTrackConfig.resultMode);propertyTrack.SetEnable(true);const startPropertyKeyframeDataItem=propertyTrack.AddPropertyKeyframe();startPropertyKeyframeDataItem.SetType(propertyTrackConfig.valueType);startPropertyKeyframeDataItem.SetTime(0);startPropertyKeyframeDataItem.SetEase(propertyTrackConfig.ease);startPropertyKeyframeDataItem.SetEnable(true);startPropertyKeyframeDataItem.SetValue(propertyTrackConfig.startValue);
startPropertyKeyframeDataItem.SetAbsoluteValue(propertyTrackConfig.startValue);const endPropertyKeyframeDataItem=propertyTrack.AddPropertyKeyframe();endPropertyKeyframeDataItem.SetType(propertyTrackConfig.valueType);endPropertyKeyframeDataItem.SetTime(config.time);endPropertyKeyframeDataItem.SetEase(propertyTrackConfig.ease);endPropertyKeyframeDataItem.SetEnable(true);endPropertyKeyframeDataItem.SetValue(propertyTrackConfig.endValue);endPropertyKeyframeDataItem.SetAbsoluteValue(propertyTrackConfig.endValue);
propertyTrack.GetSourceAdapter()}return tween}}static SetInstanceUID(tween,uid){if(!isNaN(uid))for(const tweenTrackState of tween.GetTracks())tweenTrackState.SetInstanceUID(uid)}GetITweenState(behInst,opts){if(!this._iTweenState)this._iTweenState=C3.New(self.ITweenState,this,behInst,opts);return this._iTweenState}};

}

// timelines/tweens/tweenTrackState.js
{
'use strict';const C3=self.C3;
C3.TweenTrackState=class TweenTrack extends C3.TrackState{constructor(timeline,trackDataItem){super(timeline,trackDataItem);this._firstPropertyTrack=null;this._secondPropertyTrack=null}static Create(timeline,trackDataItem){return C3.New(C3.TweenTrackState,timeline,trackDataItem)}_CachePropertyTracks(){if(this._propertyTracks.length===1)this._firstPropertyTrack=this._propertyTracks[0];else{this._firstPropertyTrack=this._propertyTracks[0];this._secondPropertyTrack=this._propertyTracks[1]}}CreatePropertyTrackStates(){for(const propertyTrackDataItem of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C3.TweenPropertyTrackState.Create(this,propertyTrackDataItem));
this._CachePropertyTracks()}AddPropertyTrack(){const propertyTrackData=this._trackDataItem.GetPropertyTrackData();const propertyTrackDataItem=propertyTrackData.AddEmptyPropertyTrackDataItem();const propertyTrack=C3.TweenPropertyTrackState.Create(this,propertyTrackDataItem);this._propertyTracks.push(propertyTrack);this._CachePropertyTracks();return propertyTrack}SetInitialState(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;const timeline=this.GetTimeline();const isForwardPlayBack=
timeline.IsForwardPlayBack();const time=isForwardPlayBack?0:this.GetLocalTotalTime();for(const propertyTrack of this._propertyTracks){propertyTrack.SetInitialState(time);if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1}this._needsBeforeAndAfter=0;const nba=this._propertyTracks.some(pt=>pt.GetNeedsBeforeAndAfter());if(nba)this._needsBeforeAndAfter=1;this._lastKeyframeDataItem=
this._GetLastKeyFrameBeforeTime(time);this._initialStateOfNestedSet=false;this._endStateOfNestedSet=false;this.Interpolate(time)}BeforeInterpolate(){}Interpolate(time,isTicking=false,setTime=false,ensureValue=false,firstTick=false,ignoreGlobals=false,endState=false){if(!this._instance)this.GetInstance();if(!this._instance)return;const instanceValid=!this._instance.IsDestroyed();if(!instanceValid)return false;if(ignoreGlobals&&this.GetObjectClass().IsGlobal())return false;if(this._secondPropertyTrack){this._firstPropertyTrack.Interpolate(time,
setTime,ensureValue,endState);this._secondPropertyTrack.Interpolate(time,setTime,ensureValue,endState)}else this._firstPropertyTrack.Interpolate(time,setTime,ensureValue,endState);if(this._firstPropertyTrack.GetWorldInfoChange()!==0){if(!this._worldInfo)this._worldInfo=this._instance.GetWorldInfo();if(this._worldInfo)this._worldInfo.SetBboxChanged()}}AfterInterpolate(){}_LoadFromJson(o){super._LoadFromJson(o);this._CachePropertyTracks()}};

}

// timelines/tweens/tweenPropertyTrackState.js
{
'use strict';const C3=self.C3;
C3.TweenPropertyTrackState=class TweenPropertyTrackState extends C3.PropertyTrackState{constructor(track,propertyTrackDataItem){super(track,propertyTrackDataItem);this._basic=false}static Create(track,propertyTrackDataItem){return C3.New(C3.TweenPropertyTrackState,track,propertyTrackDataItem)}Interpolate(time,setTime=false,ensureValue=false,endState=false){let start;let end;if(this._basic){start=this._propertyKeyframeDataItems[0];end=this._propertyKeyframeDataItems[1]}else if(setTime){start=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,
this._propertyTrackDataItem);end=start.GetNext()}else{if(this._lastPropertyKeyframeDataItem){const timeline=this.GetTimeline();const nextPropertyKeyframe=this._lastPropertyKeyframeDataItem.GetNext();const lastTime=this._lastPropertyKeyframeDataItem.GetTime();const nextTime=nextPropertyKeyframe?nextPropertyKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem)}else this._lastPropertyKeyframeDataItem=
this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);start=this._lastPropertyKeyframeDataItem;end=start.GetNext()}this._sourceAdapter.Interpolate(time,start,end,setTime,ensureValue,endState)}AddPropertyKeyframe(){const propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();const propertyKeyframeDataItem=propertyKeyframeData.AddEmptyPropertyKeyframeDataItem();this._lastPropertyKeyframeDataItem=null;this._basic=this.GetPropertyKeyframeDataItems().length<=
2;return propertyKeyframeDataItem}DeletePropertyKeyframes(match){this._lastPropertyKeyframeDataItem=null;const propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();propertyKeyframeData.DeletePropertyKeyframeDataItems(match);this._basic=this.GetPropertyKeyframeDataItems().length<=2}_SaveToJson(){return{"sourceAdapterJson":this.GetSourceAdapter()._SaveToJson(),"basic":this._basic}}_LoadFromJson(o){if(!o)return;this.GetSourceAdapter()._LoadFromJson(o["sourceAdapterJson"]);this._basic=
o["basic"]}};

}

// timelines/transitions/transition.js
{
'use strict';const C3=self.C3;const Ease=self.Ease;const NAME=0;const TRANSITION_KEYFRAMES=1;const LINEAR=2;
C3.Transition=class Transition extends C3.DefendedBase{constructor(data,addCustomEase=true){super();this._name=data[NAME];this._linear=data[LINEAR];this._transitionKeyframes=[];for(const transitionKeyframeData of data[TRANSITION_KEYFRAMES]){const transitionKeyframe=C3.TransitionKeyframe.Create(this,transitionKeyframeData);this._transitionKeyframes.push(transitionKeyframe)}for(let i=0;i<this._transitionKeyframes.length;i++){const current=this._transitionKeyframes[i];const next=this._transitionKeyframes[i+
1];const prev=this._transitionKeyframes[i-1];current.SetNext(next);current.SetPrevious(prev)}this._precalculatedSamples=new Map;this._transitionKeyframeCache=new Map;this._PreCalcSamples();if(addCustomEase)Ease.AddCustomEase(this._name,(t,sv,dv,tt)=>this.Interpolate(t,sv,dv,tt),null,{transition:this})}static Create(data){return C3.New(C3.Transition,data)}Release(){for(const transitionKeyframe of this._transitionKeyframes)transitionKeyframe.Release();C3.clearArray(this._transitionKeyframes);this._transitionKeyframes=
null;this._precalculatedSamples.clear();this._precalculatedSamples=null;this._transitionKeyframeCache.clear();this._transitionKeyframeCache=null}MakeLinear(linear){this._linear=!!linear}GetTransitionKeyFrameAt(x){const transitionKeyframe=this._transitionKeyframeCache.get(x);if(transitionKeyframe)return transitionKeyframe;for(const transitionKeyframe of this._transitionKeyframes)if(transitionKeyframe.GetValueX()===x){this._transitionKeyframeCache.set(x,transitionKeyframe);return transitionKeyframe}}GetFirstTransitionKeyFrameLowerOrEqualThan(x){for(let i=
this._transitionKeyframes.length-1;i>=0;i--){const transitionKeyframe=this._transitionKeyframes[i];const vx=transitionKeyframe.GetValueX();if(vx<=x){let ret=transitionKeyframe;if(vx<x)return ret;if(vx===x){while(ret){const prev=ret.GetPrevious();if(!prev)break;if(prev.GetValueX()!==ret.GetValueX())break;ret=prev}return ret}}}}Interpolate(time,startValue,deltaValue,totalTime){let n=time/totalTime;if(this._linear){const first=this.GetTransitionKeyFrameAt(0);const end=this.GetTransitionKeyFrameAt(1);
const sv=startValue+(startValue+deltaValue)*first.GetValueY();const ev=(startValue+deltaValue)*end.GetValueY();const dv=ev-sv;if(totalTime===0)return sv+dv;return Ease.NoEase(time,sv,dv,totalTime)}if(totalTime===0)n=1;let start=this.GetFirstTransitionKeyFrameLowerOrEqualThan(n);let end=start.GetNext();if(!end){const newStart=start.GetPrevious();const newEnd=start;start=newStart;end=newEnd}const delta=end.GetValueX()-start.GetValueX();const nn=C3.mapToRange(n,start.GetValueX(),end.GetValueX(),0,delta);
if(start.IsSegmentLinear()||delta===0){const sv=startValue+(startValue+deltaValue)*start.GetValueY();const ev=(startValue+deltaValue)*end.GetValueY();const dv=ev-sv;if(delta===0)if(nn===1)return sv+dv;else return sv;else return Ease.NoEase(nn,sv,dv,delta)}const startX=start.GetValueX();const startY=start.GetValueY();const anchor1X=start.GetValueX()+start.GetStartAnchorX();const anchor1Y=start.GetValueY()+start.GetStartAnchorY();const anchor2X=end.GetValueX()+end.GetEndAnchorX();const anchor2Y=end.GetValueY()+
end.GetEndAnchorY();const endX=end.GetValueX();const endY=end.GetValueY();let ret=Ease.GetRuntimeEase("spline")(nn,startX,startY,anchor1X,anchor1Y,anchor2X,anchor2Y,endX,endY,this._precalculatedSamples.get(start));ret+=start.GetValueY();return(1-ret)*startValue+ret*(startValue+deltaValue)}_PreCalcSamples(){this._precalculatedSamples.clear();for(let i=0;i<this._transitionKeyframes.length-1;i++){const transitionKeyframe=this._transitionKeyframes[i];if(!transitionKeyframe.GetStartEnable())continue;const start=
transitionKeyframe;const end=this._transitionKeyframes[i+1];if(!end.GetEndEnable())continue;const startValue=start.GetValueX();const anchor1Value=start.GetValueX()+start.GetStartAnchorX();const anchor2Value=end.GetValueX()+end.GetEndAnchorX();const endValue=end.GetValueX();this._precalculatedSamples.set(start,Ease.GetBezierSamples(startValue,anchor1Value,anchor2Value,endValue))}}};

}

// timelines/transitions/transitionKeyframe.js
{
'use strict';const C3=self.C3;const VALUE_X=0;const VALUE_Y=1;const START_ANCHOR_X=2;const START_ANCHOR_Y=3;const END_ANCHOR_X=4;const END_ANCHOR_Y=5;const START_ENABLE=6;const END_ENABLE=7;const SEGMENT_MODE=8;
C3.TransitionKeyframe=class TransitionKeyframe extends C3.DefendedBase{constructor(transition,data){super();this._transition=transition;this._valueX=data[VALUE_X];this._valueY=data[VALUE_Y];this._startAnchorX=data[START_ANCHOR_X];this._startAnchorY=data[START_ANCHOR_Y];this._endAnchorX=data[END_ANCHOR_X];this._endAnchorY=data[END_ANCHOR_Y];this._startEnable=data[START_ENABLE];this._endEnable=data[END_ENABLE];this._segmentMode=data[SEGMENT_MODE];this._next=null;this._prev=null}Release(){this._transition=
null}static Create(transition,data){return C3.New(C3.TransitionKeyframe,transition,data)}SetNext(transitionKeyframe){this._next=transitionKeyframe}GetNext(){return this._next}SetPrevious(transitionKeyframe){this._prev=transitionKeyframe}GetPrevious(){return this._prev}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}IsSegmentLinear(){return this._segmentMode===
"linear"}IsSegmentCubic(){return this._segmentMode==="cubic"}};

}

// timelines/transitions/transitionManager.js
{
'use strict';const C3=self.C3;C3.TransitionManager=class TransitionManager extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._transitions=[]}Release(){for(const transition of this._transitions)transition.Release();C3.clearArray(this._transitions);this._transitions=null}Create(transitionData){this._transitions.push(C3.Transition.Create(transitionData))}};

}

// templates/templateManager.js
{
'use strict';const C3=self.C3;
C3.TemplateManager=class TemplateManager extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._templateDataMap=null;this._instanceToTemplateNameMap=null;this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance)}Release(){this.RemoveRuntimeListeners();if(this._templateDataMap){for(const objectClassTemplatesMap of this._templateDataMap.values())objectClassTemplatesMap.clear();this._templateDataMap.clear()}this._templateDataMap=null;this._runtime=null}Create(templateInstanceData){if(!this._templateDataMap)this._templateDataMap=
new Map;if(!templateInstanceData)return;const templateData=templateInstanceData[0][16];const templateName=templateData[0];const objectClassIndex=templateInstanceData[1];if(!this._templateDataMap.has(objectClassIndex))this._templateDataMap.set(objectClassIndex,new Map);const objectClassTemplatesMap=this._templateDataMap.get(objectClassIndex);objectClassTemplatesMap.set(templateName,templateInstanceData)}AddRuntimeListeners(){const dispatcher=this._runtime.Dispatcher();if(dispatcher)dispatcher.addEventListener("instancedestroy",
this._instanceDestroy)}RemoveRuntimeListeners(){const dispatcher=this._runtime.Dispatcher();if(dispatcher)dispatcher.removeEventListener("instancedestroy",this._instanceDestroy)}HasTemplates(){if(!this._templateDataMap)return false;return this._templateDataMap.size!==0}GetTemplateData(objectClass_or_index,templateName){let index=0;if(objectClass_or_index instanceof C3.ObjectClass)index=objectClass_or_index.GetIndex();else index=objectClass_or_index;if(!this._templateDataMap.has(index))return;const ret=
this._templateDataMap.get(index).get(templateName);if(ret)return JSON.parse(JSON.stringify(ret));return undefined}MapInstanceToTemplateName(inst,templateName){if(!this._instanceToTemplateNameMap)this._instanceToTemplateNameMap=new WeakMap;if(this._instanceToTemplateNameMap.has(inst))return;this._instanceToTemplateNameMap.set(inst,templateName)}GetInstanceTemplateName(inst){if(!this._instanceToTemplateNameMap)return"";const ret=this._instanceToTemplateNameMap.get(inst);if(ret)return ret;return""}_OnInstanceDestroy(inst){if(!this._instanceToTemplateNameMap)return;
if(!this._instanceToTemplateNameMap.has(inst))return;this._instanceToTemplateNameMap.delete(inst)}};

}

// flowcharts/flowchartManager.js
{
'use strict';const C3=self.C3;C3.FlowchartManager=class FlowchartManager{constructor(runtime){this._runtime=runtime;this._flowchartDataManager=new C3.FlowchartDataManager}Release(){this._flowchartDataManager.Release();this._flowchartDataManager=null;this._runtime=null}GetRuntime(){return this._runtime}Create(flowchartData){this._flowchartDataManager.Add(flowchartData)}GetFlowchartDataItemByName(flowchartName){return this._flowchartDataManager.Get(flowchartName)}HasFlowcharts(){return this._flowchartDataManager.HasFlowcharts()}};

}

// flowcharts/state/flowchartState.js
{
'use strict';const C3=self.C3;
C3.FlowchartState=class Flowchart{constructor(flowchartName,tag,startNodeTag,flowchartDataItem,flowchartManager,pluginInstance,pluginUID){this._runtime=flowchartManager.GetRuntime();this._flowchartManager=flowchartManager;this._flowchartName=flowchartName;this._startNodeTag=startNodeTag;this._flowchartDataItem=flowchartDataItem;this._tag=tag;this._pluginInstance=pluginInstance;this._pluginUID=pluginUID?pluginUID:pluginInstance.GetInstance().GetUID();this._SetStartFlowchartNode();this._currentFlowchartNodeId=
this._startFlowchartNode.GetFlowchartId();this._previousFlowchartNodeIds=[];this._previousFlowchartState=null;this._previousFlowchartStateStartNodeId=NaN;this._referenceFlowchartStates=null;this._currentReferenceFlowchartState=null;this._rootFlowchartState=null;this._previousFlowchartStateTag="";this._referenceFlowchartStatesJson=null;this._currentReferenceFlowchartStateTag="";this._rootFlowchartStateTag="";this._triggerCount=0;this._markForRelease=false;this._released=false}Release(){if(this._released)return;
C3.clearArray(this._previousFlowchartNodeIds);this._previousFlowchartNodeIds=null;this._runtime=null;this._flowchartManager=null;this._flowchartDataItem=null;this._pluginInstance=null;this._previousFlowchartState=null;this._previousFlowchartStateStartNodeId=NaN;if(this._referenceFlowchartStates)this._referenceFlowchartStates.clear();this._referenceFlowchartStates=null;this._currentReferenceFlowchartState=null;this._rootFlowchartState=null;this._previousFlowchartStateTag="";this._referenceFlowchartStatesJson=
null;this._currentReferenceFlowchartStateTag="";this._rootFlowchartStateTag="";this._released=true}WasReleased(){return this._released}GetFlowchartManager(){return this._flowchartManager}GetRuntime(){return this._runtime}GetName(){return this._flowchartName}GetFlowchartDataItem(){return this._flowchartDataItem}GetTag(){return this._tag}GetPluginInstance(){if(!this._pluginInstance)this._pluginInstance=this._runtime.GetInstanceByUID(this._pluginUID).GetSdkInstance();return this._pluginInstance}GetCurrentNode(){return this.GetFlowchartElementById(this._currentFlowchartNodeId)}GetCurrentNodeTag(){const currentFlowchartNode=
this.GetCurrentNode();if(!currentFlowchartNode)return"";return currentFlowchartNode.GetTag()}GetCurrentNodeParent(indexOrTag){const currentFlowchartNode=this.GetCurrentNode();if(C3.IsFiniteNumber(indexOrTag)){const parentFlowchartIds=currentFlowchartNode.GetParentFlowchartIds();const newFlowchartNodeId=parentFlowchartIds?parentFlowchartIds[indexOrTag]:undefined;if(C3.IsFiniteNumber(newFlowchartNodeId))return this.GetFlowchartElementById(newFlowchartNodeId)}if(typeof indexOrTag==="string")for(const parentFlowchartId of currentFlowchartNode.GetParentFlowchartIds()){const parentFlowchartNode=
this.GetFlowchartElementById(parentFlowchartId);if(parentFlowchartNode.GetTag()===indexOrTag)return this.GetFlowchartElementById(parentFlowchartNode.GetFlowchartId())}}GetCurrentNodeParentTag(index){const currentParentFlowchartNode=this.GetCurrentNodeParent(index);if(!currentParentFlowchartNode)return"";return currentParentFlowchartNode.GetTag()}GetCurrentNodeParentIndex(tag){const currentParentFlowchartNode=this.GetCurrentNodeParent(tag);if(!currentParentFlowchartNode)return-1;const parentFlowchartIds=
currentParentFlowchartNode.GetParentFlowchartIds();if(!parentFlowchartIds)return-1;return parentFlowchartIds.indexOf(currentParentFlowchartNode.GetFlowchartId())}GetFlowchartElementById(flowchartElementId){return this._flowchartDataItem.GetFlowchartElementById(flowchartElementId)}Reset(){const rootFlowchartState=this._GetRootFlowchartState();rootFlowchartState._Reset(true)}_Reset(setFlowchart){if(this._GetReferenceFlowchartStates()){for(const [flowchartName,flowchartState]of this._GetReferenceFlowchartStates().entries())flowchartState._Reset(false);
this._GetReferenceFlowchartStates().clear()}this._referenceFlowchartStates=null;this._previousFlowchartState=null;this._previousFlowchartStateStartNode=null;this._currentReferenceFlowchartState=null;this._previousFlowchartStateTag="";this._referenceFlowchartStatesJson=null;this._currentReferenceFlowchartStateTag="";this._rootFlowchartStateTag="";this._previousFlowchartNodeIds=[];if(setFlowchart){this._flowchartManager.SetCurrentFlowchartState(this);const startFlowchartId=this._startFlowchartNode.GetFlowchartId();
if(startFlowchartId!==this._currentFlowchartNodeId)this._GotoFlowchartNode(startFlowchartId)}else this._currentFlowchartNodeId=this._startFlowchartNode.GetFlowchartId()}GetCurrentNodeOutputCount(){const flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemCount()}GetCurrentNodeOutputNameAt(index){const flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputAt(index);
if(!flowchartNodeOutputDataItem)return"";return flowchartNodeOutputDataItem.GetName()}GetCurrentNodeOutputValueAt(indexOrName){let flowchartNodeOutputDataItem;if(C3.IsFiniteNumber(indexOrName))flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputAt(indexOrName);if(typeof indexOrName==="string")flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputByName(indexOrName);if(typeof indexOrName!=="number"&&typeof indexOrName!=="string")console.warn("[Flowcharts] unexpected argument type in GetCurrentNodeOutputValueAt expression");
if(!flowchartNodeOutputDataItem)return"";return flowchartNodeOutputDataItem.GetValue()}GotoNextFlowchartNode(indexOrName){let flowchartNodeOutputDataItem;if(C3.IsFiniteNumber(indexOrName))flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputAt(indexOrName);if(typeof indexOrName==="string")flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputByName(indexOrName);const newFlowchartNodeId=flowchartNodeOutputDataItem.GetConnectedFlowchartNodeFlowchartId();if(!C3.IsFiniteNumber(newFlowchartNodeId))return;
this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId);this._GotoFlowchartNode(newFlowchartNodeId)}GotoAnyFlowchartNode(nodeTag){const flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartNodeByTag(nodeTag);if(!flowchartNodeDataItem)return;const newFlowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(flowchartNodeDataItem.GetFlowchartId());if(!newFlowchartNodeDataItem)return;this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId);this._GotoFlowchartNode(newFlowchartNodeDataItem.GetFlowchartId())}GotoPreviousFlowchartNode(){const previousFlowchartNodeId=
this._previousFlowchartNodeIds.pop();if(C3.IsFiniteNumber(previousFlowchartNodeId))this._GotoFlowchartNode(previousFlowchartNodeId);else if(this._GetPreviousFlowchartState()){this._flowchartManager.SetCurrentFlowchartState(this._GetPreviousFlowchartState(),true,false,false);this._GetPreviousFlowchartState()._GotoFlowchartNode(this._GetPreviousFlowchartStateStartNodeId());this._GetRootFlowchartState()._SetCurrentReferenceFlowchart(this._GetPreviousFlowchartState())}}GotoParentFlowchartNode(indexOrTag){const currentFlowchartNode=
this.GetCurrentNode();const flowchartNodeId=currentFlowchartNode.GetFlowchartId();const parentFlowchartNode=this.GetCurrentNodeParent(indexOrTag);if(parentFlowchartNode){this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId);this._GotoFlowchartNode(parentFlowchartNode.GetFlowchartId())}}HasOutput(outputIndexOrName){if(C3.IsFiniteNumber(outputIndexOrName)){const flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);const flowchartNodeOutputDataItems=
flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();return!!flowchartNodeOutputDataItems[outputIndexOrName]}if(typeof outputIndexOrName==="string"){const flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);const flowchartNodeOutputDataItems=flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();for(let i=0;i<flowchartNodeOutputDataItems.length;i++)if(flowchartNodeOutputDataItems[i].GetName()===
outputIndexOrName)return true;return false}return false}MarkForRelease(){this._markForRelease=true}IsInTriggerState(){return this._triggerCount>0}PushIsTriggerState(){this._triggerCount++}PopIsTriggerState(){this._triggerCount--;if(this._triggerCount===0&&this._markForRelease)this._flowchartManager.RemoveFlowchartState(this)}_GotoFlowchartNode(newFlowchartNodeId){const previousFlowchartNodeId=this._currentFlowchartNodeId;const inst=this.GetPluginInstance().GetInstance();this.PushIsTriggerState();
this._flowchartManager.PushFlowchartState(this);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChange,inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChange,inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChangeInFlowchart,inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChangeInFlowchart,inst);this._currentFlowchartNodeId=newFlowchartNodeId;this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnAnyNodeChange,inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnTaggedNodeChange,
inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnAnyNodeChangeInFlowchart,inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnTaggedNodeChangeInFlowchart,inst);this._flowchartManager.PopFlowchartState();this.PopIsTriggerState();const currentFlowchartNodeElement=this.GetFlowchartElementById(this._currentFlowchartNodeId);if(currentFlowchartNodeElement.GetType()==="reference"){const flowchartName=currentFlowchartNodeElement.GetReferenceFlowchartName();if(this._HasReferenceFlowchartState(currentFlowchartNodeElement)){this._previousFlowchartNodeIds.pop();
const referenceFlowchartState=this._GetReferenceFlowchartState(currentFlowchartNodeElement);this._flowchartManager.SetCurrentFlowchartState(referenceFlowchartState,true,true,false);referenceFlowchartState._SetPreviousFlowchart(this,previousFlowchartNodeId);const rootFlowchartState=this._GetRootFlowchartState();rootFlowchartState._SetCurrentReferenceFlowchart(referenceFlowchartState)}else{const flowchartStartNode=currentFlowchartNodeElement.GetReferenceFlowchartStartNodeTag();if(flowchartName){this._previousFlowchartNodeIds.pop();
let flowchartTag=currentFlowchartNodeElement.GetReferenceFlowchartTag();if(!flowchartTag){flowchartTag=`${flowchartName}-ref`;let flowchartState=this._flowchartManager.GetFlowchartState(flowchartTag);while(flowchartState){flowchartTag=C3.IncrementNumberAtEndOf(flowchartTag);flowchartState=this._flowchartManager.GetFlowchartState(flowchartTag)}}else{let flowchartState=this._flowchartManager.GetFlowchartState(flowchartTag);while(flowchartState){flowchartTag=C3.IncrementNumberAtEndOf(flowchartTag);flowchartState=
this._flowchartManager.GetFlowchartState(flowchartTag)}}const flowchartState=this._flowchartManager.AddFlowchartState(flowchartName,flowchartStartNode,flowchartTag,this._pluginInstance,true);flowchartState._SetPreviousFlowchart(this,previousFlowchartNodeId);this._SetReferenceFlowchartState(currentFlowchartNodeElement,flowchartState);const rootFlowchartState=this._GetRootFlowchartState();flowchartState._SetRootFlowchartState(rootFlowchartState);rootFlowchartState._SetCurrentReferenceFlowchart(flowchartState)}}}}_GetFlowchartNodeOutputAt(index){const flowchartNodeDataItem=
this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);if(!flowchartNodeDataItem)return null;const flowchartNodeOutputDataItems=flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();if(!flowchartNodeOutputDataItems)return null;const flowchartNodeOutputDataItem=flowchartNodeOutputDataItems[index];if(!flowchartNodeOutputDataItem)return null;return flowchartNodeOutputDataItem}_GetFlowchartNodeOutputByName(outputName){const flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);
if(!flowchartNodeDataItem)return null;const flowchartNodeOutputDataItem=flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemByName(outputName);if(!flowchartNodeOutputDataItem)return null;return flowchartNodeOutputDataItem}_SetStartFlowchartNode(startNodeId){if(typeof startNodeId==="number"){let startFlowchartNode=this.GetFlowchartElementById(startNodeId);if(!startFlowchartNode)startFlowchartNode=this._flowchartDataItem.GetFlowchartStartNode();this._startFlowchartNode=
startFlowchartNode}else{let startFlowchartNode=this._flowchartDataItem.GetFlowchartNodeByTag(this._startNodeTag);if(!startFlowchartNode)startFlowchartNode=this._flowchartDataItem.GetFlowchartStartNode();this._startFlowchartNode=startFlowchartNode}}_SaveToJson(){if(this._markForRelease)return null;return{"flowchartName":this._flowchartName,"flowchartTag":this._tag,"startNodeTag":this._startNodeTag,"currentNodeId":this._currentFlowchartNodeId,"previousNodeIds":this._previousFlowchartNodeIds,"pluginUID":this._pluginInstance.GetInstance().GetUID(),
"reference":{"previousFlowchartTag":this._GetPreviousFlowchartState()?this._GetPreviousFlowchartState().GetTag():"","previousStartNodeId":C3.IsFiniteNumber(this._GetPreviousFlowchartStateStartNodeId())?this._GetPreviousFlowchartStateStartNodeId():NaN,"referencesJson":this._GetFlowchartReferencesJson(),"currentReferenceFlowchartTag":this.GetCurrentReferenceFlowchart()?this.GetCurrentReferenceFlowchart().GetTag():"","rootFlowchartTag":this._GetRootFlowchartState()?this._GetRootFlowchartState().GetTag():
""}}}_GetFlowchartReferencesJson(){if(!this._HasReferenceFlowchartStates())return null;const ret=[];for(const [flowchartNodeElement,flowchartState]of this._GetReferenceFlowchartStates().entries())ret.push({"flowchartElementId":flowchartNodeElement.GetFlowchartId(),"flowchartStateTag":flowchartState.GetTag()});if(!ret.length)return null;return ret}_LoadFromJson(o){if(!o)return;this._flowchartName=o["flowchartName"];this._tag=o["flowchartTag"];this._startNodeTag=o["startNodeTag"];this._currentFlowchartNodeId=
o["currentNodeId"];this._previousFlowchartNodeIds=o["previousNodeIds"];this._pluginUID=o["pluginUID"];if(o.hasOwnProperty("reference")){const referenceJson=o["reference"];this._previousFlowchartStateTag=referenceJson["previousFlowchartTag"];this._previousFlowchartStateStartNodeId=referenceJson["previousStartNodeId"];this._referenceFlowchartStatesJson=referenceJson["referencesJson"];this._currentReferenceFlowchartStateTag=referenceJson["currentReferenceFlowchartTag"];this._rootFlowchartStateTag=referenceJson["rootFlowchartTag"]}this._SetStartFlowchartNode()}_GetPreviousFlowchartState(){if(typeof this._previousFlowchartStateTag===
"string"&&this._previousFlowchartStateTag){this._previousFlowchartState=this._flowchartManager.GetFlowchartState(this._previousFlowchartStateTag);this._previousFlowchartStateTag=""}return this._previousFlowchartState}_GetPreviousFlowchartStateStartNodeId(){return this._previousFlowchartStateStartNodeId}_SetPreviousFlowchart(previousFlowchartState,previousFlowchartStartNode){this._previousFlowchartState=previousFlowchartState;this._previousFlowchartStateStartNodeId=previousFlowchartStartNode}GetCurrentReferenceFlowchart(){if(typeof this._currentReferenceFlowchartStateTag===
"string"&&this._currentReferenceFlowchartStateTag){this._currentReferenceFlowchartState=this._flowchartManager.GetFlowchartState(this._currentReferenceFlowchartStateTag);this._currentReferenceFlowchartStateTag=""}return this._currentReferenceFlowchartState}_SetCurrentReferenceFlowchart(referenceFlowchartState){this._currentReferenceFlowchartState=referenceFlowchartState;if(this._currentReferenceFlowchartState===this)this._currentReferenceFlowchartState=null}_GetRootFlowchartState(){if(typeof this._rootFlowchartStateTag===
"string"&&this._rootFlowchartStateTag){this._rootFlowchartState=this._flowchartManager.GetFlowchartState(this._rootFlowchartStateTag);this._rootFlowchartStateTag=""}if(this._rootFlowchartState)return this._rootFlowchartState;return this}_SetRootFlowchartState(rootFlowchartState){this._rootFlowchartState=rootFlowchartState}_HasReferenceFlowchartStates(){this._RebuildReferenceFlowchartStates();return!!this._referenceFlowchartStates}_HasReferenceFlowchartState(flowchartNodeElement){this._RebuildReferenceFlowchartStates();
return this._referenceFlowchartStates&&this._referenceFlowchartStates.has(flowchartNodeElement)}_RebuildReferenceFlowchartStates(){if(this._referenceFlowchartStatesJson){if(this._referenceFlowchartStates)this._referenceFlowchartStates.clear();if(!this._referenceFlowchartStates)this._referenceFlowchartStates=new Map;for(const referenceFlowchartStateJson of this._referenceFlowchartStatesJson){const flowchartState=this._flowchartManager.GetFlowchartState(referenceFlowchartStateJson["flowchartStateTag"]);
const flowchartElement=flowchartState.GetFlowchartElementById(referenceFlowchartStateJson["flowchartElementId"]);this._referenceFlowchartStates.set(flowchartElement,flowchartState)}this._referenceFlowchartStatesJson=null}}_GetReferenceFlowchartStates(){this._RebuildReferenceFlowchartStates();return this._referenceFlowchartStates}_GetReferenceFlowchartState(flowchartNodeElement){this._RebuildReferenceFlowchartStates();return this._referenceFlowchartStates.get(flowchartNodeElement)}_SetReferenceFlowchartState(flowchartNodeElement,
flowchartState){if(!this._referenceFlowchartStates)this._referenceFlowchartStates=new Map;this._referenceFlowchartStates.set(flowchartNodeElement,flowchartState)}};

}

// flowcharts/state/flowchartStateManager.js
{
'use strict';const C3=self.C3;
C3.FlowchartStateManager=class FlowchartStateManager{constructor(runtime){this._runtime=runtime;this._flowchartStates=new Map;this._currentFlowchartState=null;this._flowchartStateStack=[]}Release(){C3.clearArray(this._flowchartStateStack);this._flowchartStateStack=null;this._flowchartStates.clear();this._flowchartStates=null;this._currentFlowchartState=null;this._runtime=null}GetRuntime(){return this._runtime}AddFlowchartState(flowchartName,startNodeTag,flowchartTag,pluginInstance,setAsCurrent,pluginUID){const flowchartDataItem=
this._runtime.GetFlowchartManager().GetFlowchartDataItemByName(flowchartName);if(!flowchartDataItem){console.warn(`[Flowcharts] no flowchart found with name '${flowchartName}'`);return}if(this._flowchartStates.has(flowchartTag)){console.warn(`[Flowcharts] there already is a flowchart with the tag '${flowchartTag}'`);return}const flowchartState=new C3.FlowchartState(flowchartName,flowchartTag,startNodeTag,flowchartDataItem,this,pluginInstance,pluginUID);this._flowchartStates.set(flowchartTag,flowchartState);
if(setAsCurrent)this.SetCurrentFlowchartState(flowchartState,true);return flowchartState}RemoveFlowchartState(flowchartState){flowchartState.MarkForRelease();if(flowchartState.IsInTriggerState())return;const flowchartTag=flowchartState.GetTag();this._flowchartStates.delete(flowchartTag);flowchartState.Release();if(this._currentFlowchartState===flowchartState)this._currentFlowchartState=null}ResetFlowchartState(flowchartState){flowchartState.Reset()}GetFlowchartState(flowchartTag){return this._flowchartStates.get(flowchartTag)}PushFlowchartState(flowchartState){this._flowchartStateStack.push(flowchartState)}PopFlowchartState(){this._flowchartStateStack.pop()}SetCurrentFlowchartState(flowchartState,
triggerNodeChange=false,setStartNode=false,gotoCurrentReference=true){if(gotoCurrentReference){const currentReferenceFlowchartState=flowchartState.GetCurrentReferenceFlowchart();flowchartState=currentReferenceFlowchartState?currentReferenceFlowchartState:flowchartState}if(flowchartState===this._currentFlowchartState)return;this._TriggerBeforeFlowchartChange();this._TriggerAfterFlowchartChange(flowchartState,triggerNodeChange,setStartNode)}GetCurrentFlowchartState(tag){if(typeof tag==="string")return this.GetFlowchartState(tag);
else if(this._flowchartStateStack.length)return this._flowchartStateStack[this._flowchartStateStack.length-1];else return this._currentFlowchartState}_TriggerBeforeFlowchartChange(){if(!this._currentFlowchartState)return;if(this._currentFlowchartState.WasReleased())return;const inst=this._currentFlowchartState.GetPluginInstance().GetInstance();this._currentFlowchartState.PushIsTriggerState();this.PushFlowchartState(this._currentFlowchartState);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnBeforeFlowchartChange,
inst);this.PopFlowchartState();this._currentFlowchartState.PopIsTriggerState()}_TriggerAfterFlowchartChange(flowchartState,triggerNodeChange=false,setStartNode=false){this._currentFlowchartState=flowchartState;if(!this._currentFlowchartState)return;if(this._currentFlowchartState.WasReleased())return;const inst=this._currentFlowchartState.GetPluginInstance().GetInstance();this._currentFlowchartState.PushIsTriggerState();this.PushFlowchartState(this._currentFlowchartState);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnFlowchartChange,
inst);if(setStartNode===true||typeof setStartNode==="number")this._currentFlowchartState._SetStartFlowchartNode(setStartNode);if(triggerNodeChange){this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnAnyNodeChange,inst);this._runtime.Trigger(C3.Plugins.Flowchart.Cnds.OnTaggedNodeChange,inst)}this.PopFlowchartState();this._currentFlowchartState.PopIsTriggerState()}_SaveToJson(){return{"flowchartJsonObjects":[...this._flowchartStates.values()].map(fs=>fs._SaveToJson()),"currentFlowchartTag":this._currentFlowchartState?
this._currentFlowchartState.GetTag():null}}_LoadFromJson(o){if(!o)return;const newFlowchartStates=new Map;for(const flowchartJsonObject of o["flowchartJsonObjects"]){const flowchartTag=flowchartJsonObject["flowchartTag"];if(this._flowchartStates.has(flowchartTag)){const flowchartState=this._flowchartStates.get(flowchartTag);flowchartState._LoadFromJson(flowchartJsonObject);newFlowchartStates.set(flowchartTag,flowchartState)}else{const flowchartState=this.AddFlowchartState(flowchartJsonObject["flowchartName"],
flowchartJsonObject["startNodeTag"],flowchartJsonObject["flowchartTag"],null,false,flowchartJsonObject["pluginUID"]);flowchartState._LoadFromJson(flowchartJsonObject);newFlowchartStates.set(flowchartJsonObject["flowchartTag"],flowchartState)}}for(const [tag,state]of this._flowchartStates.entries()){if(newFlowchartStates.has(tag))continue;state.Release()}this._flowchartStates.clear();this._flowchartStates=newFlowchartStates;const currentFlowchartTag=this._flowchartStates.get(o["currentFlowchartTag"]);
if(currentFlowchartTag)this.SetCurrentFlowchartState(currentFlowchartTag,true)}};

}

// flowcharts/data/flowchartDataManager.js
{
'use strict';const C3=self.C3;
C3.FlowchartDataManager=class FlowchartDataManager{constructor(){this._flowchartDataItems=new Map}Release(){for(const flowchartDataItem of this._flowchartDataItems.values())flowchartDataItem.Release();this._flowchartDataItems.clear();this._flowchartDataItems=null}Add(data){const flowchartDataItem=new C3.FlowchartDataItem(data);const name=flowchartDataItem.GetName();this._flowchartDataItems.set(name,flowchartDataItem)}Get(name){return this._flowchartDataItems.get(name)}HasFlowcharts(){return!!this._flowchartDataItems.size}static CreateDataItems(items,jsonItems,
dataItemConstructor,dataContainer){if(!jsonItems)return;for(const jsonItem of jsonItems){const dataItem=new dataItemConstructor(jsonItem,dataContainer);items.push(dataItem)}}};

}

// flowcharts/data/flowchartData.js
{
'use strict';const C3=self.C3;const NAME=0;const NODES=1;C3.FlowchartDataItem=class FlowchartDataItem{constructor(flowchartDataJson){this._name=flowchartDataJson[NAME];this._flowchartNodeData=new C3.FlowchartNodeData(flowchartDataJson[NODES],this)}Release(){this._flowchartNodeData.Release();this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartElementById(id){return this._flowchartNodeData.GetFlowchartElementById(id)}GetFlowchartNodeByTag(tag){return this._flowchartNodeData.GetFlowchartNodeByTag(tag)}GetFlowchartStartNode(){return this._flowchartNodeData.GetFlowchartStartNode()}GetName(){return this._name}};

}

// flowcharts/data/flowchartNodeData.js
{
'use strict';const C3=self.C3;const FLOWCHART_ID=0;const TAG=1;const PARENT_FLOWCHART_IDS=2;const PARENT_OUTPUT_FLOWCHART_IDS=3;const CHILDREN_FLOWCHART_IDS=4;const OUTPUTS=5;const IS_START=6;const TYPE=7;const REFERENCE_FLOWCHART=8;const REFERENCE_FLOWCHART_START_NODE=9;const REFERENCE_FLOWCHART_TAG=10;
class FlowchartNodeDataItem{constructor(flowchartNodeJson,flowchartNodeData){this._flowchartNodeData=flowchartNodeData;this._type=flowchartNodeJson[TYPE];this._flowchartId=flowchartNodeJson[FLOWCHART_ID];this._tag=flowchartNodeJson[TAG];this._parentFlowchartIds=flowchartNodeJson[PARENT_FLOWCHART_IDS];this._parentOutputFlowchartIds=null;this._childrenFlowchartIds=null;if(this._type==="dictionary"){this._parentOutputFlowchartIds=flowchartNodeJson[PARENT_OUTPUT_FLOWCHART_IDS];this._childrenFlowchartIds=
flowchartNodeJson[CHILDREN_FLOWCHART_IDS]}this._isStart=flowchartNodeJson[IS_START];this._referenceFlowchartName=null;this._referenceFlowchartStartNodeTag=null;this._referenceFlowchartTag=null;if(this._type==="reference"){this._referenceFlowchartName=flowchartNodeJson[REFERENCE_FLOWCHART];this._referenceFlowchartStartNodeTag=flowchartNodeJson[REFERENCE_FLOWCHART_START_NODE];this._referenceFlowchartTag=flowchartNodeJson[REFERENCE_FLOWCHART_TAG]}this._flowchartNodeOutputData=new C3.FlowchartNodeOutputData(flowchartNodeJson[OUTPUTS],
this)}Release(){this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetTag(){return this._tag}GetIsStart(){return this._isStart}GetParentFlowchartIds(){return this._parentFlowchartIds}GetParentOutputFlowchartIds(){return this._parentOutputFlowchartIds}GetChildrenFlowchartIds(){return this._childrenFlowchartIds}GetType(){return this._type}GetReferenceFlowchartName(){return this._referenceFlowchartName}GetReferenceFlowchartStartNodeTag(){return this._referenceFlowchartStartNodeTag}GetReferenceFlowchartTag(){return this._referenceFlowchartTag}}
C3.FlowchartNodeData=class FlowchartNodeData{constructor(flowchartNodesDataJson,flowchartDataItem){this._flowchartDataItem=flowchartDataItem;this._flowchartNodeItems=[];this._flowchartNodeItemsIdMap=new Map;this._flowchartNodeItemsTagMap=new Map;this._flowchartNodeStartItem=null;C3.FlowchartDataManager.CreateDataItems(this._flowchartNodeItems,flowchartNodesDataJson,FlowchartNodeDataItem,this);for(const flowchartNodeItem of this._flowchartNodeItems){const flowchartId=flowchartNodeItem.GetFlowchartId();
const tag=flowchartNodeItem.GetTag();const isStart=flowchartNodeItem.GetIsStart();this._flowchartNodeItemsIdMap.set(flowchartId,flowchartNodeItem);if(tag)this._flowchartNodeItemsTagMap.set(tag,flowchartNodeItem);if(isStart)this._flowchartNodeStartItem=flowchartNodeItem;const flowchartNodeOutputData=flowchartNodeItem.GetFlowchartNodeOutputData();for(const flowchartNodeOutputDataItem of flowchartNodeOutputData.flowchartNodeOutputDataItems()){const flowchartId=flowchartNodeOutputDataItem.GetFlowchartId();
this._flowchartNodeItemsIdMap.set(flowchartId,flowchartNodeOutputDataItem)}}}Release(){this._flowchartDataItem=null;for(const flowchartNodeDataItem of this._flowchartNodeItems)flowchartNodeDataItem.Release();C3.clearArray(this._flowchartNodeItems);this._flowchartNodeItems=null}GetFlowchartDataItem(){return this._flowchartDataItem}GetFlowchartElementById(id){return this._flowchartNodeItemsIdMap.get(id)}GetFlowchartNodeByTag(tag){return this._flowchartNodeItemsTagMap.get(tag)}GetFlowchartStartNode(){return this._flowchartNodeStartItem}*flowchartNodeDataItems(){for(const flowchartNodeDataItem of this._flowchartNodeItems)yield flowchartNodeDataItem}};

}

// flowcharts/data/flowchartNodeOutputData.js
{
'use strict';const C3=self.C3;const FLOWCHART_ID=0;const NAME=1;const VALUE=2;const CONNECTED_FLOWCHART_NODE_FLOWCHART_ID=3;
class FlowchartNodeDataOutputItem{constructor(flowchartNodeOutputJson,flowchartNodeOutputData){this._flowchartNodeOutputData=flowchartNodeOutputData;this._flowchartId=flowchartNodeOutputJson[FLOWCHART_ID];this._name=flowchartNodeOutputJson[NAME];this._value=flowchartNodeOutputJson[VALUE];this._connectedFlowchartNodeFlowchartId=flowchartNodeOutputJson[CONNECTED_FLOWCHART_NODE_FLOWCHART_ID]}Release(){this._flowchartNodeOutputData=null}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetName(){return this._name}GetValue(){return this._value}GetConnectedFlowchartNodeFlowchartId(){return this._connectedFlowchartNodeFlowchartId}}
C3.FlowchartNodeOutputData=class FlowchartNodeOutputData{constructor(flowchartNodeOuputsDataJson,flowchartDataNodeItem){this._flowchartDataNodeItem=flowchartDataNodeItem;this._flowchartNodeOutputItems=[];this._flowchartNodeOutputItemsNameMap=new Map;C3.FlowchartDataManager.CreateDataItems(this._flowchartNodeOutputItems,flowchartNodeOuputsDataJson,FlowchartNodeDataOutputItem,this);for(const flowchartNodeOutputItem of this._flowchartNodeOutputItems)this._flowchartNodeOutputItemsNameMap.set(flowchartNodeOutputItem.GetName(),
flowchartNodeOutputItem)}Release(){this._flowchartDataNodeItem=null;for(const flowchartNodeDataItem of this._flowchartNodeOutputItems)flowchartNodeDataItem.Release();C3.clearArray(this._flowchartNodeOutputItems);this._flowchartNodeOutputItems=null}GetFlowchartNodeDataItem(){return this._flowchartDataNodeItem}GetFlowchartNodeOutputDataItemCount(){return this._flowchartNodeOutputItems.length}GetFlowchartNodeOutputDataItems(){return this._flowchartNodeOutputItems}GetFlowchartNodeOutputDataItemByName(outputName){return this._flowchartNodeOutputItemsNameMap.get(outputName)}*flowchartNodeOutputDataItems(){for(const flowchartNodeDataItem of this._flowchartNodeOutputItems)yield flowchartNodeDataItem}};

}

// events/stacks/solStack.js
{
'use strict';const C3=self.C3;
C3.SolStack=class SolStack extends C3.DefendedBase{constructor(objectClass){super();this._objectClass=objectClass;this._stack=[];this._stack.push(C3.New(C3.Sol,this));this._index=0;this._current=this._stack[0]}Release(){for(const s of this._stack)s.Release();C3.clearArray(this._stack);this._current=null;this._objectClass=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}GetOneBelowCurrentSol(){return this._stack[this._index-1]}Clear(){this.GetCurrentSol().Clear()}PushClean(){const stack=this._stack;
const index=++this._index;if(index===stack.length){const sol=C3.New(C3.Sol,this);stack.push(sol);this._current=sol}else{const sol=stack[index];sol.Reset();this._current=sol}}PushCopy(){const stack=this._stack;const index=++this._index;if(index===stack.length)stack.push(C3.New(C3.Sol,this));const sol=stack[index];sol.Copy(stack[index-1]);this._current=sol}Pop(){this._current=this._stack[--this._index]}RemoveInstances(s){const stack=this._stack;for(let i=0,len=stack.length;i<len;++i)stack[i].RemoveInstances(s)}};

}

// events/stacks/sol.js
{
'use strict';const C3=self.C3;
C3.Sol=class Sol extends C3.DefendedBase{constructor(stack){super();this._stack=stack;this._objectClass=this._stack.GetObjectClass();this._eventStack=this._objectClass.GetRuntime().GetEventStack();this._selectAll=true;this._instances=[];this._elseInstances=[]}Release(){this.ClearArrays();this._stack=null;this._objectClass=null;this._eventStack=null}ClearArrays(){C3.clearArray(this._instances);C3.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){if(this._selectAll)return!!this._objectClass.GetInstanceCount();else return!!this._instances.length}GetInstances(){if(this._selectAll)return this._objectClass.GetInstances();
else return this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){const ret=this.GetInstances();if(ret.length)return ret;else return this._elseInstances}Reset(){this._selectAll=true;C3.clearArray(this._elseInstances)}Clear(){this._selectAll=true}Copy(sol){if(sol.IsSelectAll())this.Reset();else{this._selectAll=false;C3.shallowAssignArray(this._instances,sol._instances);C3.clearArray(this._elseInstances)}}_PushInstance(inst){this._instances.push(inst)}_PushElseInstance(inst){this._elseInstances.push(inst)}_SetSelectAll(s){this._selectAll=
!!s}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(inst){this._selectAll=false;C3.clearArray(this._instances);this._instances.push(inst)}SetArrayPicked(arr){this._selectAll=false;C3.shallowAssignArray(this._instances,arr)}SetSetPicked(set){this._selectAll=false;C3.clearArray(this._instances);for(const item of set)this._instances.push(item)}AddElseInstances(setOfPicked,arrayOfAllPicked){for(const inst of arrayOfAllPicked)if(!setOfPicked.has(inst))this._elseInstances.push(inst)}TransferElseInstancesToOwn(setOfPicked){for(const inst of setOfPicked)this._instances.push(inst);
C3.arrayRemoveAllInSet(this._elseInstances,setOfPicked)}ClearElseInstances(){C3.clearArray(this._elseInstances)}PickOne(inst){if(!inst)return;if(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()){if(this.IsSelectAll()){C3.clearArray(this._instances);C3.shallowAssignArray(this._elseInstances,inst.GetObjectClass().GetInstances());this._selectAll=false}const i=this._elseInstances.indexOf(inst);if(i!==-1){this._instances.push(this._elseInstances[i]);this._elseInstances.splice(i,1)}}else this.SetSinglePicked(inst)}RemoveInstances(s){C3.arrayRemoveAllInSet(this._instances,
s);C3.arrayRemoveAllInSet(this._elseInstances,s)}};

}

// events/stacks/eventStack.js
{
'use strict';const C3=self.C3;
C3.EventStack=class EventStack extends C3.DefendedBase{constructor(eventSheetManager){super();this._eventSheetManager=eventSheetManager;this._runtime=this._eventSheetManager.GetRuntime();this._stack=[];this._stack.push(C3.New(C3.EventStackFrame,this,null));this._index=0;this._expFuncStack=[]}Release(){for(const e of this._stack)e.Release();C3.clearArray(this._stack);C3.clearArray(this._expFuncStack);this._eventSheetManager=null;this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}GetAllStackFrames(){return this._stack}GetCurrentStackFrameIndex(){return this._index}Push(currentEvent){const stack=this._stack;
const index=++this._index;if(index===stack.length){const ret=C3.New(C3.EventStackFrame,this,currentEvent);stack.push(ret);return ret}else{const ret=stack[index];ret.Reset(currentEvent);return ret}}Pop(){--this._index}PushExpFunc(frame){this._expFuncStack.push(frame)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){const expFuncStack=this._expFuncStack;if(expFuncStack.length===0)return null;else return expFuncStack.at(-1)}};

}

// events/stacks/eventStackFrame.js
{
'use strict';const C3=self.C3;
C3.EventStackFrame=class EventStackFrame extends C3.DefendedBase{constructor(stack,currentEvent){super();this._stack=stack;this._runtime=this._stack.GetRuntime();this._currentEvent=currentEvent;this._cndIndex=0;this._actIndex=0;this._lastEventTrue=false;this._elseBranchRan=false;this._expressionObjectClass=null;this._functionReturnType=0;this._functionReturnValue=0;this._dynamicSolModifiers=null}Release(){this.Reset(null);this._stack=null;this._runtime=null}Reset(currentEvent){this._currentEvent=currentEvent;
this._cndIndex=0;this._actIndex=0;this._lastEventTrue=false;this._elseBranchRan=false;this._dynamicSolModifiers=null}_Restore(currentEvent,actIndex){this._currentEvent=currentEvent;this._cndIndex=0;this._actIndex=actIndex}ResetQuick(){this._cndIndex=0;this._actIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(currentEvent){this._currentEvent=currentEvent}GetConditionIndex(){return this._cndIndex}SetConditionIndex(i){this._cndIndex=i}GetActionIndex(){return this._actIndex}SetActionIndex(i){this._actIndex=
i}SetLastEventTrue(t){this._lastEventTrue=!!t}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(r){this._elseBranchRan=!!r}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(objectClass){this._expressionObjectClass=objectClass}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(returnType,defaultReturnValue){this._functionReturnType=returnType;this._functionReturnValue=defaultReturnValue}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(v){this._functionReturnValue=
v}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){const currentEvent=this._currentEvent;if(currentEvent.IsSolWriterAfterCnds())return true;if(this._cndIndex<currentEvent.GetConditionCount()-1)return!!currentEvent.GetSolModifiers().length;return false}SetDynamicSolModifiers(solModifiers){this._dynamicSolModifiers=solModifiers}GetDynamicSolModifiers(){return this._dynamicSolModifiers}};

}

// events/stacks/localVarStack.js
{
'use strict';const C3=self.C3;
C3.LocalVarStack=class LocalVarStack extends C3.DefendedBase{constructor(eventSheetManager){super();this._eventSheetManager=eventSheetManager;this._runtime=this._eventSheetManager.GetRuntime();this._stack=[];this._index=-1;this._current=null;this._initialValues=[]}Release(){C3.clearArray(this._stack);this._eventSheetManager=null;this._runtime=null}_SetInitialValues(initialValues){this._initialValues=initialValues;const arr=this._initialValues.slice(0);this._stack.push(arr);this._index=0;this._current=
arr}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){const index=++this._index;const stack=this._stack;if(index===stack.length)stack.push(this._initialValues.slice(0));else C3.shallowAssignArray(stack[index],this._initialValues);this._current=stack[index]}Pop(){this._current=this._stack[--this._index]}};

}

// events/stacks/loopStack.js
{
'use strict';const C3=self.C3;
C3.LoopStack=class LoopStack extends C3.DefendedBase{constructor(eventSheetManager){super();this._eventSheetManager=eventSheetManager;this._runtime=this._eventSheetManager.GetRuntime();this._stack=[];this._index=-1}Release(){C3.clearArray(this._stack);this._eventSheetManager=null;this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return this._index>=0}GetCurrent(){return this._stack[this._index]}Push(){++this._index;if(this._index===
this._stack.length){const ret=C3.New(C3.Loop,this);this._stack.push(ret);return ret}else{const ret=this._stack[this._index];ret.Reset();return ret}}Pop(){--this._index}FindByName(name){const stack=this._stack;for(let i=this._index;i>=0;--i){const loop=stack[i];if(loop.GetName()===name)return loop}return null}_GetStack(){return this._stack.slice(0,this._index+1)}};

}

// events/stacks/loop.js
{
'use strict';const C3=self.C3;C3.Loop=class Loop extends C3.DefendedBase{constructor(loopStack){super();this._loopStack=loopStack;this._name="";this._index=0;this._isStopped=false;this._end=NaN}Reset(){this._name="";this._index=0;this._isStopped=false;this._end=NaN}SetName(name){this._name=name}GetName(){return this._name}SetIndex(i){this._index=i}GetIndex(){return this._index}Stop(){this._isStopped=true}IsStopped(){return this._isStopped}SetEnd(e){this._end=e}GetEnd(){return this._end}};

}

// events/stacks/arrayStack.js
{
'use strict';const C3=self.C3;C3.ArrayStack=class ArrayStack extends C3.DefendedBase{constructor(){super();this._stack=[];this._index=-1}Release(){C3.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){++this._index;if(this._index===this._stack.length){const ret=[];this._stack.push(ret);return ret}else return this._stack[this._index]}Pop(){--this._index}};

}

// events/eventSheetManager.js
{
'use strict';const C3=self.C3;const assert=self.assert;function SortSolArray(a,b){return a.GetIndex()-b.GetIndex()}function IsSolArrayIdentical(a,b){for(let i=0,len=a.length;i<len;++i)if(a[i]!==b[i])return false;return true}
C3.EventSheetManager=class EventSheetManager extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._allSheets=[];this._sheetsByName=new Map;this._allGroups=[];this._groupsByName=new Map;this._blocksBySid=new Map;this._cndsBySid=new Map;this._actsBySid=new Map;this._allUniqueSolModifiers=new Map;this._eventVarsBySid=new Map;this._nextLocalVarIndex=0;this._allGlobalVars=[];this._allLocalVars=[];this._localVarInitialValues=[];this._functionBlocksByName=new Map;this._customActionBlocksMap=
new Map;this._eventStack=C3.New(C3.EventStack,this);this._localVarStack=C3.New(C3.LocalVarStack,this);this._loopStack=C3.New(C3.LoopStack,this);this._triggersToPostInit=[];this._queuedTriggers=[];this._queuedDebugTriggers=[];this._runningEventsDepth=0;this._executingTriggerDepth=0;this._blockFlushingDepth=0;this._scheduledWaits=[];this._asyncActionPromises=[];self["c3_callFunction"]=(name,params)=>this._InvokeFunctionFromJS(name,params)}Release(){this.ClearAllScheduledWaits();this._eventStack.Release();
this._eventStack=null;this._localVarStack.Release();this._localVarStack=null;C3.clearArray(this._queuedTriggers);C3.clearArray(this._queuedDebugTriggers);this._runtime=null;C3.clearArray(this._allSheets);this._sheetsByName.clear()}Create(eventSheetData){const eventSheet=C3.New(C3.EventSheet,this,eventSheetData);this._allSheets.push(eventSheet);this._sheetsByName.set(eventSheet.GetName().toLowerCase(),eventSheet)}_AddTriggerToPostInit(trig){this._triggersToPostInit.push(trig)}_PostInit(){for(const customActionBlock of this._customActionBlocksMap.values())customActionBlock._CheckOverrideState();
for(const functionBlock of this._functionBlocksByName.values())functionBlock._PostInit();for(const customActionBlock of this._customActionBlocksMap.values())customActionBlock._PostInit();for(const sheet of this._allSheets)sheet._PostInit();for(const sheet of this._allSheets)sheet._UpdateDeepIncludes();for(const trig of this._triggersToPostInit)trig._PostInit(false);C3.clearArray(this._triggersToPostInit);this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(name){return this._sheetsByName.get(name.toLowerCase())||
null}_RegisterGroup(group){this._allGroups.push(group);this._groupsByName.set(group.GetGroupName(),group)}_RegisterEventBlock(eventBlock){this._blocksBySid.set(eventBlock.GetSID(),eventBlock)}_RegisterCondition(condition){this._cndsBySid.set(condition.GetSID(),condition)}_RegisterAction(action){this._actsBySid.set(action.GetSID(),action)}_RegisterFunctionBlock(functionBlock){switch(functionBlock.GetFunctionType()){case 0:this._functionBlocksByName.set(functionBlock.GetFunctionName().toLowerCase(),
functionBlock);break;case 1:this._customActionBlocksMap.set(functionBlock.GetFunctionName().toLowerCase(),functionBlock);break;default:}}_RegisterEventVariable(ev){this._eventVarsBySid.set(ev.GetSID(),ev);if(ev.IsGlobal())this._allGlobalVars.push(ev);else this._allLocalVars.push(ev)}_DeduplicateSolModifierList(arr){if(arr.length>=2)arr.sort(SortSolArray);let candidateList=this._allUniqueSolModifiers.get(arr.length);if(!candidateList){candidateList=[];this._allUniqueSolModifiers.set(arr.length,candidateList)}for(let i=
0,len=candidateList.length;i<len;++i){const candidate=candidateList[i];if(IsSolArrayIdentical(arr,candidate))return candidate}candidateList.push(arr);return arr}_GetNextLocalVarIndex(eventVar){this._localVarInitialValues.push(eventVar.GetInitialValue());return this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){const frame=
this.GetCurrentEventStackFrame();const event=frame.GetCurrentEvent();return event.GetConditionAt(frame.GetConditionIndex())}GetCurrentAction(){const frame=this.GetCurrentEventStackFrame();const event=frame.GetCurrentEvent();return event.GetActionAt(frame.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(fromRow){const ret=[];fromRow=fromRow.GetScopeParent();while(fromRow){C3.appendArray(ret,fromRow._GetAllLocalVariablesInScope());
fromRow=fromRow.GetScopeParent()}return ret}_GetLocalVariablesScriptInterface(fromRow){const localVarDescriptors={};for(const v of this.GetAllLocalVariablesInScope(fromRow))localVarDescriptors[v.GetJsPropName()]=v._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,localVarDescriptors)}GetEventVariableBySID(sid){return this._eventVarsBySid.get(sid)||null}GetEventBlockBySID(sid){return this._blocksBySid.get(sid)||null}GetConditionBySID(sid){return this._cndsBySid.get(sid)||null}GetActionBySID(sid){return this._actsBySid.get(sid)||
null}GetFunctionBlockByName(name){return this._functionBlocksByName.get(name.toLowerCase())||null}GetCustomActionBlockByName(objectClass,name){let ret=this._customActionBlocksMap.get((objectClass.GetName()+"."+name).toLowerCase());if(ret)return ret;if(!objectClass.IsFamily())for(const family of objectClass.GetFamilies()){ret=this._customActionBlocksMap.get((family.GetName()+"."+name).toLowerCase());if(ret)return ret}return null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(includeStatic){for(const ev of this._allGlobalVars)ev.ResetToInitialValue();
if(includeStatic)for(const ev of this._allLocalVars)if(ev.IsStatic())ev.ResetToInitialValue()}GetEventGroupByName(name){return this._groupsByName.get(name.toLowerCase())||null}GetEventGroupBySID(sid){const group=this._blocksBySid.get(sid);if(group&&group.IsGroup())return group;else return null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(const group of this._allGroups)group.ResetInitialActivation()}_ResetAllHasRunFlags(){for(const sheet of this._allSheets)sheet._ResetHasRunFlag()}RunEvents(layoutManager){this._ResetAllHasRunFlags();
this._runningEventsDepth++;for(const layout of layoutManager.runningLayouts()){const eventSheet=layout.GetEventSheet();if(!eventSheet)continue;this._runtime.PushCurrentLayout(layout);eventSheet.Run();this._runtime.PopCurrentLayout()}this._runningEventsDepth--}async DebugRunEvents(layoutManager){this._ResetAllHasRunFlags();this._runningEventsDepth++;for(const breakEventObject of this._DebugRunEventsGen(layoutManager))await this._runtime.DebugBreak(breakEventObject);this._runningEventsDepth--}*_DebugRunEventsGen(layoutManager){for(const layout of layoutManager.runningLayouts()){const eventSheet=
layout.GetEventSheet();if(!eventSheet)continue;this._runtime.PushCurrentLayout(layout);yield*eventSheet.DebugRun();this._runtime.PopCurrentLayout()}}_Trigger(layoutManager,method,inst,behaviorType){let ret=false;if(!layoutManager.GetMainRunningLayout())return this.QueueTrigger(method,inst,behaviorType);this._executingTriggerDepth++;for(const layout of layoutManager.runningLayouts()){const eventSheet=layout.GetEventSheet();if(!eventSheet)continue;this._runtime.PushCurrentLayout(layout);for(const includeSheet of eventSheet.deepIncludes()){const result=
includeSheet._Trigger(method,inst,behaviorType);ret=ret||result}const result2=eventSheet._Trigger(method,inst,behaviorType);ret=ret||result2;this._runtime.PopCurrentLayout()}this._executingTriggerDepth--;return ret}*_DebugTrigger(layoutManager,method,inst,behaviorType){let ret=false;if(!layoutManager.GetMainRunningLayout())return this.QueueTrigger(method,inst,behaviorType);this._executingTriggerDepth++;for(const layout of layoutManager.runningLayouts()){const eventSheet=layout.GetEventSheet();if(!eventSheet)continue;
this._runtime.PushCurrentLayout(layout);for(const includeSheet of eventSheet.deepIncludes()){const result=yield*includeSheet._DebugTrigger(method,inst,behaviorType);ret=ret||result}const result2=yield*eventSheet._DebugTrigger(method,inst,behaviorType);ret=ret||result2;this._runtime.PopCurrentLayout()}this._executingTriggerDepth--;return ret}QueueTrigger(method,inst,behaviorType){this._queuedTriggers.push([method,inst,behaviorType]);return false}QueueDebugTrigger(method,inst,behaviorType){let resolve=
null;const ret=new Promise(r=>resolve=r);this._queuedDebugTriggers.push([method,inst,behaviorType,resolve]);return ret}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw new Error("should not be in breakpoint");const layoutManager=this._runtime.GetLayoutManager();while(this._queuedDebugTriggers.length){const [method,inst,behaviorType,resolve]=this._queuedDebugTriggers.shift();const ret=yield*this._DebugTrigger(layoutManager,method,inst,behaviorType);resolve(ret)}}async RunQueuedDebugTriggersAsync(){for(const breakEventObject of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(breakEventObject)}_FastTrigger(layoutManager,
method,inst,value){let ret=false;const layout=layoutManager.GetMainRunningLayout();const eventSheet=layout.GetEventSheet();if(!eventSheet)return;this._executingTriggerDepth++;this._runtime.PushCurrentLayout(layout);const deepIncludes=eventSheet.deepIncludes();for(let i=0,len=deepIncludes.length;i<len;++i){const result=deepIncludes[i]._FastTrigger(method,inst,value);ret=ret||result}const result2=eventSheet._FastTrigger(method,inst,value);ret=ret||result2;this._runtime.PopCurrentLayout();this._executingTriggerDepth--;
return ret}*_DebugFastTrigger(layoutManager,method,inst,value){let ret=false;const layout=layoutManager.GetMainRunningLayout();const eventSheet=layout.GetEventSheet();if(!eventSheet)return;this._executingTriggerDepth++;this._runtime.PushCurrentLayout(layout);const deepIncludes=eventSheet.deepIncludes();for(let i=0,len=deepIncludes.length;i<len;++i){const result=yield*deepIncludes[i]._DebugFastTrigger(method,inst,value);ret=ret||result}const result2=yield*eventSheet._DebugFastTrigger(method,inst,value);
ret=ret||result2;this._runtime.PopCurrentLayout();this._executingTriggerDepth--;return ret}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return this.GetTriggerDepth()>0}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return this._runningEventsDepth>0}IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger()}_RunQueuedTriggers(layoutManager){for(const [method,inst,behaviorType]of this._queuedTriggers)this._Trigger(layoutManager,
method,inst,behaviorType);C3.clearArray(this._queuedTriggers)}BlockFlushingInstances(e){if(e)this._blockFlushingDepth++;else this._blockFlushingDepth--}IsFlushingBlocked(){return this._blockFlushingDepth>0}ClearSol(solModifiers){for(let i=0,len=solModifiers.length;i<len;++i)solModifiers[i].GetSolStack().Clear()}PushCleanSol(solModifiers){for(let i=0,len=solModifiers.length;i<len;++i)solModifiers[i].GetSolStack().PushClean()}PushCopySol(solModifiers){for(let i=0,len=solModifiers.length;i<len;++i)solModifiers[i].GetSolStack().PushCopy()}PopSol(solModifiers){for(let i=
0,len=solModifiers.length;i<len;++i)solModifiers[i].GetSolStack().Pop()}GetDynamicSolModifiersSet(skipSet){const ret=new Set;const allStackFrames=this._eventStack.GetAllStackFrames();const stackIndex=this._eventStack.GetCurrentStackFrameIndex();for(let i=0;i<=stackIndex;++i){const dynamicSolModifiers=allStackFrames[i].GetDynamicSolModifiers();if(dynamicSolModifiers)for(const t of dynamicSolModifiers)if(!skipSet||!skipSet.has(t))ret.add(t)}return ret}PushCleanSolDynamic(existingSolModifiers){const existingSet=
new Set([...existingSolModifiers]);const pushSet=this.GetDynamicSolModifiersSet(existingSet);if(pushSet.size>0){for(const t of pushSet)t.GetSolStack().PushClean();return[...pushSet]}else return null}AddScheduledWait(){const w=C3.New(C3.ScheduledWait,this);this._scheduledWaits.push(w);return w}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(!this._scheduledWaits.length)return;const frame=this.GetCurrentEventStackFrame();let didAnyRun=false;this._runningEventsDepth++;for(let i=0,
len=this._scheduledWaits.length;i<len;++i){const w=this._scheduledWaits[i];if(w._ShouldRun())w._Run(frame);if(w.ShouldRelease())didAnyRun=true}if(didAnyRun){this._FilterScheduledWaitsToRelease();frame.Reset(null)}this._runningEventsDepth--}async DebugRunScheduledWaits(){if(!this._scheduledWaits.length)return;const frame=this.GetCurrentEventStackFrame();let didAnyRun=false;this._runningEventsDepth++;for(let i=0,len=this._scheduledWaits.length;i<len;++i){const w=this._scheduledWaits[i];if(w._ShouldRun())await w._DebugRun(frame);
if(w.ShouldRelease())didAnyRun=true}if(didAnyRun){this._FilterScheduledWaitsToRelease();frame.Reset(null)}this._runningEventsDepth--}_FilterScheduledWaitsToRelease(){const toRelease=C3.arrayFilterOut(this._scheduledWaits,w=>w.ShouldRelease());for(const w of toRelease)w.Release()}ClearAllScheduledWaits(){for(const w of this._scheduledWaits)w.Release();C3.clearArray(this._scheduledWaits)}RemoveInstancesFromScheduledWaits(s){for(const w of this._scheduledWaits)w.RemoveInstances(s)}AddAsyncActionPromise(p){this._asyncActionPromises.push(p)}ClearAsyncActionPromises(){C3.clearArray(this._asyncActionPromises)}GetPromiseForAllAsyncActions(){const ret=
Promise.all(this._asyncActionPromises);this._asyncActionPromises=[];return ret}_SaveToJson(){return{"groups":this._SaveGroupsToJson(),"cnds":this._SaveCndsToJson(),"acts":this._SaveActsToJson(),"vars":this._SaveVarsToJson(),"waits":this._SaveScheduledWaitsToJson()}}_LoadFromJson(o){this._LoadGroupsFromJson(o["groups"]);this._LoadCndsFromJson(o["cnds"]);this._LoadActsFromJson(o["acts"]);this._LoadVarsFromJson(o["vars"]);this._LoadScheduledWaitsFromJson(o["waits"])}_SaveGroupsToJson(){const o={};for(const group of this.GetAllGroups())o[group.GetSID().toString()]=
group.IsGroupActive();return o}_LoadGroupsFromJson(o){for(const [sidStr,data]of Object.entries(o)){const sid=parseInt(sidStr,10);const group=this.GetEventGroupBySID(sid);if(group)group.SetGroupActive(data)}}_SaveCndsToJson(){const o={};for(const [sid,cnd]of this._cndsBySid){const data=cnd._SaveToJson();if(data)o[sid.toString()]=data}return o}_LoadCndsFromJson(o){const map=new Map;for(const [sidStr,data]of Object.entries(o))map.set(parseInt(sidStr,10),data);for(const [sid,cnd]of this._cndsBySid)cnd._LoadFromJson(map.get(sid)||
null)}_SaveActsToJson(){const o={};for(const [sid,act]of this._actsBySid){const data=act._SaveToJson();if(data)o[sid.toString()]=data}return o}_LoadActsFromJson(o){const map=new Map;for(const [sidStr,data]of Object.entries(o))map.set(parseInt(sidStr,10),data);for(const [sid,act]of this._actsBySid)act._LoadFromJson(map.get(sid)||null)}_SaveVarsToJson(){const o={};for(const [sid,eventVar]of this._eventVarsBySid)if(!eventVar.IsConstant()&&(eventVar.IsGlobal()||eventVar.IsStatic()))o[sid.toString()]=
eventVar.GetValue();return o}_LoadVarsFromJson(o){for(const [sidStr,data]of Object.entries(o)){const sid=parseInt(sidStr,10);const eventVar=this.GetEventVariableBySID(sid);if(eventVar)eventVar.SetValue(data)}}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter(w=>!w.IsPromise()).map(w=>w._SaveToJson())}_LoadScheduledWaitsFromJson(arr){this.ClearAllScheduledWaits();for(const data of arr){const sw=C3.ScheduledWait._CreateFromJson(this,data);if(sw)this._scheduledWaits.push(sw)}}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map(l=>
l.GetEventSheet()).filter(eventSheet=>eventSheet).map(e=>e._GetPerfRecord())}FindFirstFunctionBlockParent(parent){while(parent){const scopeParent=parent.GetScopeParent();if(scopeParent instanceof C3.FunctionBlock)return scopeParent;parent=scopeParent}return null}_InvokeFunctionFromJS(name,params){if(!Array.isArray(params))params=[];const functionBlock=this.GetFunctionBlockByName(name.toLowerCase());if(!functionBlock)return null;if(!functionBlock.IsEnabled())return functionBlock.GetDefaultReturnValue();
const functionParameters=functionBlock.GetFunctionParameters();if(params.length<functionParameters.length){params=params.slice(0);do params.push(functionParameters[params.length].GetInitialValue());while(params.length<functionParameters.length)}const callEventBlock=functionBlock.GetEventBlock();return callEventBlock.RunAsExpressionFunctionCall(callEventBlock.GetSolModifiersIncludingParents(),false,functionBlock.GetReturnType(),functionBlock.GetDefaultReturnValue(),...params)}};

}

// events/eventSheet.js
{
'use strict';const C3=self.C3;
C3.EventSheet=class EventSheet extends C3.DefendedBase{constructor(eventSheetManager,data){super();this._eventSheetManager=eventSheetManager;this._runtime=eventSheetManager.GetRuntime();this._name=data[0];this._events=[];this._triggers=new Map;this._fastTriggers=new Map;this._eventsByDisplayNumber=new Map;this._hasRun=false;this._shallowIncludes=[];this._deepIncludes=[];this._alreadyIncludedSheets=new Set;for(const eventData of data[1])this._CreateEvent(eventData,null,this._events);this._perfRecord=
this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,children:[]}:null}Release(){this._eventSheetManager=null;this._runtime=null}_CreateEvent(eventData,parent,nontriggers){switch(eventData[0]){case 0:case 3:this._CreateEventBlock(eventData,parent,nontriggers);break;case 1:this._CreateEventVariable(eventData,parent,nontriggers);break;case 2:this._CreateInclude(eventData,parent,nontriggers);break;case 4:this._CreateFunctionBlock(eventData,parent);break;case 5:this._CreateScriptBlock(eventData,
parent,nontriggers);break;case 6:this._CreateCustomACEBlock(eventData,parent);break;default:throw new Error("invalid event type");}}_CreateEventBlock(data,parent,nontriggers){const eventBlock=C3.EventBlock.Create(this,parent,data);if(eventBlock.IsOrBlock()){nontriggers.push(eventBlock);const conditions=eventBlock.GetConditions();for(let i=0,len=conditions.length;i<len;++i)if(conditions[i].IsTrigger())this._InitTrigger(eventBlock,i)}else if(eventBlock.IsTrigger())this._InitTrigger(eventBlock,0);else nontriggers.push(eventBlock)}_CreateFunctionBlock(data,
parent){const functionBlock=C3.FunctionBlock.CreateFunctionBlock(this,parent,data);this._eventSheetManager._RegisterFunctionBlock(functionBlock)}_CreateCustomACEBlock(data,parent){const customAceBlock=C3.FunctionBlock.CreateCustomACEBlock(this,parent,data);this._eventSheetManager._RegisterFunctionBlock(customAceBlock)}_CreateEventVariable(data,parent,nontriggers){const v=C3.EventVariable.Create(this,parent,data);nontriggers.push(v)}_CreateInclude(data,parent,nontriggers){const include=C3.EventInclude.Create(this,
parent,data);nontriggers.push(include)}_CreateScriptBlock(data,parent,nontriggers){const scriptBlock=C3.EventScript.Create(this,parent,data);nontriggers.push(scriptBlock)}_InitTrigger(eventBlock,i){if(!eventBlock.IsOrBlock())this._eventSheetManager._AddTriggerToPostInit(eventBlock);const cnd=eventBlock.GetConditionAt(i);const func=cnd._GetFunc();const objectClass=cnd.GetObjectClass();if(cnd.IsFastTrigger()){let methodMap=this._fastTriggers.get(objectClass);if(!methodMap){methodMap=new Map;this._fastTriggers.set(objectClass,
methodMap)}const value=cnd.GetFastTriggerValue().toLowerCase();let valueMap=methodMap.get(func);if(!valueMap){valueMap=new Map;methodMap.set(func,valueMap)}let triggerArr=valueMap.get(value);if(!triggerArr){triggerArr=[];valueMap.set(value,triggerArr)}triggerArr.push([eventBlock,i])}else{let ocInfo=this._triggers.get(objectClass);if(!ocInfo){ocInfo={methodMap:new Map,behaviors:new Map};this._triggers.set(objectClass,ocInfo)}const behaviorType=cnd.GetBehaviorType();let methodMap;if(behaviorType){methodMap=
ocInfo.behaviors.get(behaviorType);if(!methodMap){methodMap=new Map;ocInfo.behaviors.set(behaviorType,methodMap)}}else methodMap=ocInfo.methodMap;let triggerArr=methodMap.get(func);if(!triggerArr){triggerArr=[];methodMap.set(func,triggerArr)}triggerArr.push([eventBlock,i])}}_PostInit(){const events=this._events;for(let i=0,len=events.length;i<len;++i){const hasElseBlock=i<len-1&&events[i+1]instanceof C3.EventBlock&&events[i+1].IsElseBlock();events[i]._PostInit(hasElseBlock)}}_AddShallowInclude(include){this._shallowIncludes.push(include)}_UpdateDeepIncludes(){C3.clearArray(this._deepIncludes);
this._AddDeepIncludes(this);this._alreadyIncludedSheets.clear()}_AddDeepIncludes(rootSheet){const deepIncludes=rootSheet._deepIncludes;const alreadyIncludedSheets=rootSheet._alreadyIncludedSheets;for(const include of this._shallowIncludes){const sheet=include.GetIncludeSheet();if(!include.IsActive()||rootSheet===sheet||alreadyIncludedSheets.has(sheet))continue;alreadyIncludedSheets.add(sheet);sheet._AddDeepIncludes(rootSheet);deepIncludes.push(sheet)}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(eventBlock,
displayNumber){this._eventsByDisplayNumber.set(displayNumber,eventBlock)}_GetEventByDisplayNumber(displayNumber){return this._eventsByDisplayNumber.get(displayNumber)||null}_ResetHasRunFlag(){this._hasRun=false}Run(){if(this._hasRun)return;const runtime=this._runtime;const profile=runtime.IsCPUProfiling();const startTime=profile?performance.now():0;this._hasRun=true;const eventSheetManager=this.GetEventSheetManager();const frame=eventSheetManager.GetCurrentEventStackFrame();for(const e of this._events){e.Run(frame);
eventSheetManager.ClearSol(e.GetSolModifiers());eventSheetManager.ClearAsyncActionPromises();runtime.FlushPendingInstances()}frame.Reset(null);if(profile)this._perfRecord.totalTimeCounter+=performance.now()-startTime}*DebugRun(){if(this._hasRun)return;this._hasRun=true;const runtime=this._runtime;const eventSheetManager=this.GetEventSheetManager();const frame=eventSheetManager.GetCurrentEventStackFrame();for(const e of this._events){yield*e.DebugRun(frame);eventSheetManager.ClearSol(e.GetSolModifiers());
eventSheetManager.ClearAsyncActionPromises();runtime.FlushPendingInstances()}frame.Reset(null)}_Trigger(method,inst,behaviorType){if(inst){const objectClass=inst.GetObjectClass();let ret=false;let r=this._TriggerForClass(method,inst,objectClass,behaviorType);ret=ret||r;for(const family of objectClass.GetFamilies()){r=this._TriggerForClass(method,inst,family,behaviorType);ret=ret||r}}else return this._TriggerForClass(method,inst,null,null)}_TriggerForClass(method,inst,objectClass,behaviorType){const ocInfo=
this._triggers.get(objectClass);if(!ocInfo)return false;const methodMap=behaviorType?ocInfo.behaviors.get(behaviorType):ocInfo.methodMap;if(!methodMap)return false;const triggerList=methodMap.get(method);if(!triggerList)return false;let ret=false;for(const [trigger,index]of triggerList){const r=this._ExecuteTrigger(inst,trigger,index);ret=ret||r}return ret}*_DebugTrigger(method,inst,behaviorType){if(inst){const objectClass=inst.GetObjectClass();let ret=false;let r=yield*this._DebugTriggerForClass(method,
inst,objectClass,behaviorType);ret=ret||r;for(const family of objectClass.GetFamilies()){r=yield*this._DebugTriggerForClass(method,inst,family,behaviorType);ret=ret||r}}else return yield*this._DebugTriggerForClass(method,inst,null,null)}*_DebugTriggerForClass(method,inst,objectClass,behaviorType){const ocInfo=this._triggers.get(objectClass);if(!ocInfo)return false;const methodMap=behaviorType?ocInfo.behaviors.get(behaviorType):ocInfo.methodMap;if(!methodMap)return false;const triggerList=methodMap.get(method);
if(!triggerList)return false;let ret=false;for(const [trigger,index]of triggerList){let r;if(trigger.DebugCanRunFast())r=this._ExecuteTrigger(inst,trigger,index);else r=yield*this._DebugExecuteTrigger(inst,trigger,index);ret=ret||r}return ret}_FastTrigger(method,inst,value){const objectClass=inst.GetObjectClass();const methodMap=this._fastTriggers.get(objectClass);if(!methodMap)return false;const valueMap=methodMap.get(method);if(!valueMap)return false;const triggerList=valueMap.get(value);if(!triggerList)return false;
let ret=false;for(let i=0,len=triggerList.length;i<len;++i){const t=triggerList[i];const r=this._ExecuteTrigger(null,t[0],t[1]);ret=ret||r}return ret}*_DebugFastTrigger(method,inst,value){const objectClass=inst.GetObjectClass();const methodMap=this._fastTriggers.get(objectClass);if(!methodMap)return false;const valueMap=methodMap.get(method);if(!valueMap)return false;const triggerList=valueMap.get(value);if(!triggerList)return false;let ret=false;for(let i=0,len=triggerList.length;i<len;++i){const t=
triggerList[i];const trigger=t[0];const index=t[1];let r;if(trigger.DebugCanRunFast())r=this._ExecuteTrigger(null,trigger,index);else r=yield*this._DebugExecuteTrigger(null,trigger,index);ret=ret||r}return ret}_ExecuteTrigger(inst,trigger,index){const runtime=this._runtime;const eventSheetManager=this._eventSheetManager;const currentEvent=eventSheetManager.GetCurrentEvent();const eventStack=eventSheetManager.GetEventStack();const triggerDepth=eventSheetManager.GetTriggerDepth();let ret=false;if(currentEvent)eventSheetManager.PushCleanSol(currentEvent.GetSolModifiersIncludingParents());
eventSheetManager.PushCleanSol(trigger.GetSolModifiersIncludingParents());const isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();const frame=eventStack.Push(trigger);if(inst){const objectClass=trigger.GetConditions()[index].GetObjectClass();const sol=objectClass.GetCurrentSol();sol.SetSinglePicked(inst);if(inst.IsInContainer())inst.SetSiblingsSinglePicked()}let okToRun=true;if(trigger.GetParent()){const parents=trigger.GetTriggerParents();for(let i=0,len=parents.length;i<
len;++i)if(!parents[i].RunPreTrigger(frame)){okToRun=false;break}}if(okToRun){if(trigger.IsOrBlock())trigger.RunOrBlockTrigger(frame,index);else trigger.Run(frame);ret=frame.GetLastEventTrue()}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();eventSheetManager.PopSol(trigger.GetSolModifiersIncludingParents());if(currentEvent)eventSheetManager.PopSol(currentEvent.GetSolModifiersIncludingParents());if(!currentEvent&&triggerDepth===1){eventSheetManager.ClearAsyncActionPromises();
if(!eventSheetManager.IsFlushingBlocked())runtime.FlushPendingInstances()}return ret}*_DebugExecuteTrigger(inst,trigger,index){const runtime=this._runtime;const eventSheetManager=this._eventSheetManager;const currentEvent=eventSheetManager.GetCurrentEvent();const eventStack=eventSheetManager.GetEventStack();const triggerDepth=eventSheetManager.GetTriggerDepth();let ret=false;if(currentEvent)eventSheetManager.PushCleanSol(currentEvent.GetSolModifiersIncludingParents());eventSheetManager.PushCleanSol(trigger.GetSolModifiersIncludingParents());
const isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();const frame=eventStack.Push(trigger);if(inst){const objectClass=trigger.GetConditions()[index].GetObjectClass();const sol=objectClass.GetCurrentSol();sol.SetSinglePicked(inst);if(inst.IsInContainer())inst.SetSiblingsSinglePicked()}let okToRun=true;if(trigger.GetParent()){const parents=trigger.GetTriggerParents();for(let i=0,len=parents.length;i<len;++i)if(!(yield*parents[i].DebugRunPreTrigger(frame))){okToRun=
false;break}}if(okToRun){if(trigger.IsOrBlock())yield*trigger.DebugRunOrBlockTrigger(frame,index);else yield*trigger.DebugRun(frame);ret=frame.GetLastEventTrue()}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();eventSheetManager.PopSol(trigger.GetSolModifiersIncludingParents());if(currentEvent)eventSheetManager.PopSol(currentEvent.GetSolModifiersIncludingParents());if(!currentEvent&&triggerDepth===1){eventSheetManager.ClearAsyncActionPromises();if(!eventSheetManager.IsFlushingBlocked())runtime.FlushPendingInstances()}return ret}_GetPerfRecord(){return this._perfRecord}};

}

// events/eventBlock.js
{
'use strict';const C3=self.C3;const EMPTY_ARRAY=[];function NoActions(frame,index){return true}function*DebugNoActions(frame,index){return true}
C3.EventBlock=class EventBlock extends C3.DefendedBase{constructor(eventSheet,parent,data){super();this._eventSheet=eventSheet;this._runtime=eventSheet.GetRuntime();this._parent=parent;this._scopeParent=null;this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._solModifiers=[];this._solModifiersIncludingParents=[];this._hasGotSolModifiersIncludingParents=false;this._isSolWriterAfterCnds=false;this._isTopLevelGroup=false;this._hasElseBlock=false;this._isOrBlock=!!data[2];this._isElseBlock=
false;this._triggerParents=null;this._conditions=[];this._actions=[];this._subEvents=[];this._RunActions=NoActions;this._DebugRunActions=DebugNoActions;this._isGroup=false;this._isInitiallyActive=false;this._groupName="";this._isGroupActive=false;this._containedIncludes=null;this._perfRecord=null;this._sid=data[4];this._displayNumber=data[5];this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber);this._debugData=this._runtime.IsDebug()?{isBreakpoint:data[3][0],isBreakable:data[3][1],
canRunAllConditionsFast:false,canRunAllActionsFast:false,canRunAllSubEventsFast:false,canRunSelfFast:false}:null;this.GetEventSheetManager()._RegisterEventBlock(this);if(data[0]===3)this._InitGroup(data[1]);let index=0;for(const cndData of data[6]){const condition=C3.Condition.Create(this,cndData,index++);this._conditions.push(condition);this._AddSolModifier(condition.GetObjectClass())}index=0;for(const actData of data[7]){const action=C3.Action.Create(this,actData,index++);this._actions.push(action)}if(data.length===
9){const subEventsData=data[8];for(const eventData of subEventsData)this._eventSheet._CreateEvent(eventData,this,this._subEvents)}if(this._conditions.length)this._isElseBlock=this._conditions[0].GetObjectClass()===null&&this._conditions[0]._GetFunc()===C3.Plugins.System.Cnds.Else;if(this._conditions.length===0)this._conditions=EMPTY_ARRAY;if(this._actions.length===0)this._actions=EMPTY_ARRAY;if(this._subEvents.length===0)this._subEvents=EMPTY_ARRAY}static Create(eventSheet,parent,data){return C3.New(C3.EventBlock,
eventSheet,parent,data)}_InitGroup(groupData){this._isGroup=true;this._isInitiallyActive=!!groupData[0];this._isGroupActive=this._isInitiallyActive;this._groupName=groupData[1].toLowerCase();this._containedIncludes=[];this.GetEventSheetManager()._RegisterGroup(this);if(this._runtime.IsDebug())this._perfRecord={type:"group",name:groupData[1],totalTimeCounter:0,children:[]}}_AddContainedInclude(include){this._containedIncludes.push(include)}_AddContainerSolModifierToList(objectClass,arr){for(const containerType of objectClass.GetContainer().objectTypes())if(!arr.includes(containerType))arr.push(containerType)}_AddSolModifierToList(objectClass,
arr){if(!objectClass)return;if(!arr.includes(objectClass))arr.push(objectClass);if(objectClass.IsFamily())for(const familyMember of objectClass.GetFamilyMembers()){if(familyMember.IsInContainer())this._AddContainerSolModifierToList(familyMember,arr)}else if(objectClass.IsInContainer())this._AddContainerSolModifierToList(objectClass,arr)}_AddSolModifier(objectClass){this._AddSolModifierToList(objectClass,this._solModifiers)}_AddParentSolModifier(objectClass){this._AddSolModifierToList(objectClass,
this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(hasElse){this._hasElseBlock=!!hasElse;this._IdentifyTopLevelGroup();this._IdentifyTriggerParents();for(const c of this._conditions)c._PostInit();if(this._actions.length>0){let hasAnyActionWithReturnType=false;for(const a of this._actions){a._PostInit();if(a.HasReturnType())hasAnyActionWithReturnType=true}if(hasAnyActionWithReturnType){this._RunActions=this._RunActions_ReturnValue;
this._DebugRunActions=this._DebugRunActions_ReturnValue}else{this._RunActions=this._RunActions_Fast;this._DebugRunActions=this._DebugRunActions_Fast}}const subEvents=this._subEvents;for(let i=0,len=subEvents.length;i<len;++i){const hasElseBlock=i<len-1&&subEvents[i+1]instanceof C3.EventBlock&&subEvents[i+1].IsElseBlock();subEvents[i]._PostInit(hasElseBlock)}if(this._debugData)this._UpdateCanRunFast();if(this._perfRecord)this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let p=
this.GetParent();while(p){if(p.IsGroup())return p;p=p.GetParent()}return this._eventSheet}_UpdateCanRunFast(){const dd=this._debugData;dd.canRunAllConditionsFast=this._conditions.every(c=>c.DebugCanRunFast());dd.canRunAllActionsFast=this._actions.every(a=>a.DebugCanRunFast());dd.canRunAllSubEventsFast=this._subEvents.every(s=>s.DebugCanRunFast());dd.canRunSelfFast=dd.canRunAllConditionsFast&&dd.canRunAllActionsFast&&dd.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let e=this;do{e._UpdateCanRunFast();
e=e.GetParent()}while(e)}_IdentifyTopLevelGroup(){if(!this.IsGroup())return;let p=this.GetParent();this._isTopLevelGroup=true;while(p){if(!p.IsGroup()){this._isTopLevelGroup=false;break}p=p.GetParent()}}_IdentifySolModifiersIncludingParents(){const allObjectClasses=this._runtime.GetAllObjectClasses();if(this._solModifiers===allObjectClasses)this._solModifiersIncludingParents=allObjectClasses;else{this._solModifiersIncludingParents=C3.cloneArray(this._solModifiers);let p=this.GetParent();while(p){for(const o of p._solModifiers)this._AddParentSolModifier(o);
p=p.GetParent()}const eventSheetManager=this.GetEventSheetManager();this._solModifiers=eventSheetManager._DeduplicateSolModifierList(this._solModifiers);this._solModifiersIncludingParents=eventSheetManager._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(!this.HasAnyTriggeredCondition())return;this._triggerParents=[];let p=this.GetParent();while(p){this._triggerParents.push(p);p=p.GetParent()}this._triggerParents.reverse()}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=
true;if(this._parent)this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){if(!this._hasGotSolModifiersIncludingParents){this._hasGotSolModifiersIncludingParents=true;this._IdentifySolModifiersIncludingParents()}return this._solModifiersIncludingParents}HasSolModifier(objectClass){return this._solModifiers.includes(objectClass)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(p){this._scopeParent=
p}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(b){this._debugData.isBreakpoint=!!b;this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(a){a=
!!a;if(!this._isGroup)throw new Error("not a group");if(this._isGroupActive===a)return;this._isGroupActive=a;for(const include of this._containedIncludes)include.UpdateActive();if(this._containedIncludes.length){const currentLayout=this._runtime.GetCurrentLayout();const mainEventSheet=currentLayout.GetEventSheet();if(mainEventSheet)mainEventSheet._UpdateDeepIncludes()}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&
this._scopeParent instanceof C3.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some(c=>c.IsTrigger())}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(i){i=Math.floor(i);if(i<0||i>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[i]}GetConditionByDebugIndex(i){return this.GetConditionAt(i)}IsFirstConditionOfType(cnd){let i=cnd.GetIndex();if(i===0)return true;
--i;const objectClass=cnd.IsSystemOrSingleGlobalCondition()?cnd.GetFirstObjectParameterObjectClass():cnd.GetObjectClass();for(;i>=0;--i){const c=this._conditions[i];if(objectClass===c.GetObjectClass()||c.IsSystemOrSingleGlobalCondition()&&c.GetFirstObjectParameterObjectClass()===objectClass)return false}return true}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(i){i=Math.floor(i);if(i<0||i>=this._actions.length)throw new RangeError("invalid action index");
return this._actions[i]}GetActionByDebugIndex(i){i=Math.floor(i);const ret=this._actions.find(a=>a.GetDebugIndex()===i);if(!ret)throw new RangeError("invalid action debug index");return ret}_HasActionIndex(i){i=Math.floor(i);return i>=0&&i<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter(e=>e instanceof C3.EventVariable)}RunPreTrigger(frame){frame.SetCurrentEvent(this);const conditions=this._conditions;let isAnyTrue=conditions.length===
0;for(let i=0,len=conditions.length;i<len;++i){const c=conditions[i];frame.SetConditionIndex(i);if(c.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");if(c.Run())isAnyTrue=true;else if(!this._isOrBlock)return false}return this._isOrBlock?isAnyTrue:true}RunOrBlockTrigger(frame,index){frame.SetCurrentEvent(this);frame.SetConditionIndex(index);if(this._conditions[index].Run()){if(this._RunActions(frame,0))this._RunSubEvents(frame);frame.SetLastEventTrue(true)}}*DebugRunPreTrigger(frame){frame.SetCurrentEvent(this);
const conditions=this._conditions;let isAnyTrue=conditions.length===0;for(let i=0,len=conditions.length;i<len;++i){const c=conditions[i];frame.SetConditionIndex(i);if(c.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");let ret;if(c.DebugCanRunFast())ret=c.Run();else ret=yield*c.DebugRun();if(ret)isAnyTrue=true;else if(!this._isOrBlock)return false}return this._isOrBlock?isAnyTrue:true}*DebugRunOrBlockTrigger(frame,index){frame.SetCurrentEvent(this);frame.SetConditionIndex(index);
const c=this._conditions[index];let ret;if(c.DebugCanRunFast())ret=c.Run();else ret=yield*c.DebugRun();if(ret){let actRet;if(this.DebugCanRunActionsFast())actRet=this._RunActions(frame,0);else actRet=yield*this._DebugRunActions(frame,0);if(actRet)if(this.DebugCanRunSubEventsFast())this._RunSubEvents();else yield*this._DebugRunSubEvents();frame.SetLastEventTrue(true)}}Run(frame){frame.SetCurrentEvent(this);if(!this._isElseBlock)frame.SetElseBranchRan(false);if(this._isOrBlock)this._RunOrBlock(frame);
else this._RunAndBlock(frame)}*DebugRun(frame){if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;frame.SetCurrentEvent(this);if(!this._isElseBlock)frame.SetElseBranchRan(false);if(this._isOrBlock)yield*this._DebugRunOrBlock(frame);else yield*this._DebugRunAndBlock(frame)}_RunOrBlock(frame){const conditions=this._conditions;let isAnyTrue=conditions.length===0;for(let i=0,len=conditions.length;i<len;++i){const c=conditions[i];if(c.IsTrigger())continue;frame.SetConditionIndex(i);
const result=c.Run();isAnyTrue=isAnyTrue||result}frame.SetLastEventTrue(isAnyTrue);if(isAnyTrue){if(this._RunActions(frame,0))this._RunSubEvents(frame);if(this._hasElseBlock)frame.SetElseBranchRan(true)}}*_DebugRunOrBlock(frame){const conditions=this._conditions;let isAnyTrue=conditions.length===0;for(let i=0,len=conditions.length;i<len;++i){const c=conditions[i];if(c.IsTrigger())continue;frame.SetConditionIndex(i);let ret;if(c.DebugCanRunFast())ret=c.Run();else ret=yield*c.DebugRun();isAnyTrue=isAnyTrue||
ret}frame.SetLastEventTrue(isAnyTrue);if(isAnyTrue){let actRet;if(this.DebugCanRunActionsFast())actRet=this._RunActions(frame,0);else actRet=yield*this._DebugRunActions(frame,0);if(actRet)if(this.DebugCanRunSubEventsFast())this._RunSubEvents();else yield*this._DebugRunSubEvents();if(this._hasElseBlock)frame.SetElseBranchRan(true)}}_RunAndBlock(frame){const conditions=this._conditions;for(let i=0,len=conditions.length;i<len;++i){const c=conditions[i];frame.SetConditionIndex(i);const result=c.Run();
if(!result){frame.SetLastEventTrue(false);return}}frame.SetLastEventTrue(true);if(this._RunActions(frame,0))this._RunSubEvents(frame);if(frame.GetLastEventTrue()&&this._hasElseBlock)frame.SetElseBranchRan(true)}*_DebugRunAndBlock(frame){const conditions=this._conditions;for(let i=0,len=conditions.length;i<len;++i){const c=conditions[i];frame.SetConditionIndex(i);let ret;if(c.DebugCanRunFast())ret=c.Run();else ret=yield*c.DebugRun();if(!ret){frame.SetLastEventTrue(false);return}}frame.SetLastEventTrue(true);
let actRet;if(this.DebugCanRunActionsFast())actRet=this._RunActions(frame,0);else actRet=yield*this._DebugRunActions(frame,0);if(actRet)if(this.DebugCanRunSubEventsFast())this._RunSubEvents();else yield*this._DebugRunSubEvents();if(frame.GetLastEventTrue()&&this._hasElseBlock)frame.SetElseBranchRan(true)}_RunActions_Fast(frame,startIndex){const actions=this._actions;for(let i=startIndex,len=actions.length;i<len;++i){const a=actions[i];frame.SetActionIndex(i);a.Run()}return true}*_DebugRunActions_Fast(frame,
startIndex){const actions=this._actions;for(let i=startIndex,len=actions.length;i<len;++i){const a=actions[i];frame.SetActionIndex(i);if(a.DebugCanRunFast())a.Run();else yield*a.DebugRun()}return true}_RunActions_ReturnValue(frame,startIndex){const eventSheetManager=this.GetEventSheetManager();const actions=this._actions;for(let i=startIndex,len=actions.length;i<len;++i){const a=actions[i];frame.SetActionIndex(i);const ret=a.Run();if(a.CanBailOut()&&ret===true)return false;else if(a.IsAsync()&&ret instanceof
Promise)eventSheetManager.AddAsyncActionPromise(ret)}return true}*_DebugRunActions_ReturnValue(frame,startIndex){const eventSheetManager=this.GetEventSheetManager();const actions=this._actions;for(let i=startIndex,len=actions.length;i<len;++i){const a=actions[i];frame.SetActionIndex(i);let ret;if(a.DebugCanRunFast())ret=a.Run();else ret=yield*a.DebugRun();if(a.CanBailOut()&&ret===true)return false;else if(a.IsAsync()&&ret instanceof Promise)eventSheetManager.AddAsyncActionPromise(ret)}return true}_ResumeActionsAndSubEvents(frame){if(this._RunActions(frame,
frame.GetActionIndex()))this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(frame){if(yield*this._DebugRunActions(frame,frame.GetActionIndex()))yield*this._DebugRunSubEvents()}_RunSubEvents(){if(!this._subEvents.length)return;const profile=this.IsGroup()&&this._runtime.IsCPUProfiling();const startTime=profile?performance.now():0;const eventStack=this._eventStack;const frame=eventStack.Push(this);if(this._isSolWriterAfterCnds)this._RunSubEvents_SolWriterAfterCnds(frame);else this._RunSubEvents_Fast(frame);
eventStack.Pop();if(profile)this._perfRecord.totalTimeCounter+=performance.now()-startTime}_RunSubEvents_SolWriterAfterCnds(frame){const isGroup=this._isGroup;const isTopLevelGroup=this._isTopLevelGroup;const eventSheetManager=this.GetEventSheetManager();const subEvents=this._subEvents;for(let i=0,len=subEvents.length,last=len-1;i<len;++i){const e=subEvents[i];const solModifiers=e.GetSolModifiers();const copySol=!isTopLevelGroup||!isGroup&&i<last;if(copySol)eventSheetManager.PushCopySol(solModifiers);
e.Run(frame);if(copySol)eventSheetManager.PopSol(solModifiers);else eventSheetManager.ClearSol(solModifiers)}}_RunSubEvents_Fast(frame){const subEvents=this._subEvents;for(let i=0,len=subEvents.length;i<len;++i)subEvents[i].Run(frame)}*_DebugRunSubEvents(){if(!this._subEvents.length)return;const eventStack=this._eventStack;const frame=eventStack.Push(this);if(this._isSolWriterAfterCnds)yield*this._DebugRunSubEvents_SolWriterAfterCnds(frame);else yield*this._DebugRunSubEvents_Fast(frame);eventStack.Pop()}*_DebugRunSubEvents_SolWriterAfterCnds(frame){const isGroup=
this._isGroup;const isTopLevelGroup=this._isTopLevelGroup;const eventSheetManager=this.GetEventSheetManager();const subEvents=this._subEvents;for(let i=0,len=subEvents.length,last=len-1;i<len;++i){const e=subEvents[i];const solModifiers=e.GetSolModifiers();const copySol=!isTopLevelGroup||!isGroup&&i<last;if(copySol)eventSheetManager.PushCopySol(solModifiers);yield*e.DebugRun(frame);if(copySol)eventSheetManager.PopSol(solModifiers);else eventSheetManager.ClearSol(solModifiers)}}*_DebugRunSubEvents_Fast(frame){const subEvents=
this._subEvents;for(let i=0,len=subEvents.length;i<len;++i)yield*subEvents[i].DebugRun(frame)}Retrigger(oldFrame,newFrame){newFrame.ResetQuick();const conditions=this._conditions;if(!this.IsOrBlock())for(let i=oldFrame.GetConditionIndex()+1,len=conditions.length;i<len;++i){const c=conditions[i];newFrame.SetConditionIndex(i);const result=c.Run();if(!result)return false}if(this._RunActions(newFrame,0))this._RunSubEvents(newFrame);return true}*DebugRetrigger(oldFrame,newFrame){newFrame.ResetQuick();
const conditions=this._conditions;if(!this.IsOrBlock())for(let i=oldFrame.GetConditionIndex()+1,len=conditions.length;i<len;++i){const c=conditions[i];newFrame.SetConditionIndex(i);let ret;if(c.DebugCanRunFast())ret=c.Run();else ret=yield*c.DebugRun();if(!ret)return false}let actRet;if(this.DebugCanRunActionsFast())actRet=this._RunActions(newFrame,0);else actRet=yield*this._DebugRunActions(newFrame,0);if(actRet)if(this.DebugCanRunSubEventsFast())this._RunSubEvents();else yield*this._DebugRunSubEvents();
return true}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(frame){if(this.GetParent()){const parents=this.GetTriggerParents();for(let i=0,len=parents.length;i<len;++i)if(!parents[i].RunPreTrigger(frame))return false}return true}*_DebugCheckParentsOKToRun(frame){if(this.GetParent()){const parents=
this.GetTriggerParents();for(let i=0,len=parents.length;i<len;++i)if(!(yield*parents[i].DebugRunPreTrigger(frame)))return false}return true}_EvaluateFunctionCallParameters(eventSheetManager,parameters,isRecursive){if(parameters.length>0)if(isRecursive){const paramResults=parameters.map(p=>p.Get(0));eventSheetManager.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(paramResults)}else this._scopeParent.EvaluateFunctionParameters(parameters);else if(isRecursive)eventSheetManager.GetLocalVarStack().Push()}RunAsFunctionCall(combinedSolModifiers,
parameters,isCopyPicked,pickInfo){let ret;let asyncId;const hasAnySolModifiers=combinedSolModifiers.length>0;let extraPopSolModifiers=null;const runtime=this._runtime;const eventStack=this._eventStack;const eventSheetManager=runtime.GetEventSheetManager();const triggerDepth=eventSheetManager._IncTriggerDepth();const isRecursive=triggerDepth>1;this._EvaluateFunctionCallParameters(eventSheetManager,parameters,isRecursive);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(combinedSolModifiers);
else eventSheetManager.PushCleanSol(combinedSolModifiers);if(pickInfo!==null){if(pickInfo.copyFromObjectClass){const copyFromSol=isCopyPicked?pickInfo.copyFromObjectClass.GetCurrentSol():pickInfo.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol();const copyToSol=pickInfo.copyToObjectClass.GetCurrentSol();copyToSol.SetArrayPicked(copyFromSol.GetInstances());copyToSol.ClearElseInstances();if(!isCopyPicked)pickInfo.copyToObjectClass.ApplySolToContainer()}else if(pickInfo.pickObjectClass){const objectClassSol=
pickInfo.pickObjectClass.GetCurrentSol();objectClassSol.SetArrayPicked(pickInfo.pickInstances);objectClassSol.ClearElseInstances()}if(pickInfo.pushCleanSolDynamic)extraPopSolModifiers=eventSheetManager.PushCleanSolDynamic(combinedSolModifiers)}const frame=eventStack.Push(this);if(isCopyPicked)frame.SetDynamicSolModifiers(combinedSolModifiers);if(this._CheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);const isAsync=this._scopeParent.IsAsync();if(isAsync)[asyncId,ret]=this._scopeParent.StartAsyncFunctionCall();
this._RunAndBlock(frame);if(isAsync)this._scopeParent.MaybeFinishAsyncFunctionCall(asyncId)}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(extraPopSolModifiers!==null)eventSheetManager.PopSol(extraPopSolModifiers);if(hasAnySolModifiers)eventSheetManager.PopSol(combinedSolModifiers);eventSheetManager._DecTriggerDepth();return ret}*DebugRunAsFunctionCall(combinedSolModifiers,parameters,isCopyPicked,pickInfo){let ret;let asyncId;if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;
const hasAnySolModifiers=combinedSolModifiers.length>0;let extraPopSolModifiers=null;const runtime=this._runtime;const eventStack=this._eventStack;const eventSheetManager=runtime.GetEventSheetManager();const triggerDepth=eventSheetManager._IncTriggerDepth();const isRecursive=triggerDepth>1;this._EvaluateFunctionCallParameters(eventSheetManager,parameters,isRecursive);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(combinedSolModifiers);else eventSheetManager.PushCleanSol(combinedSolModifiers);
if(pickInfo!==null){if(pickInfo.copyFromObjectClass){const copyFromSol=isCopyPicked?pickInfo.copyFromObjectClass.GetCurrentSol():pickInfo.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol();const copyToSol=pickInfo.copyToObjectClass.GetCurrentSol();copyToSol.SetArrayPicked(copyFromSol.GetInstances());copyToSol.ClearElseInstances();if(!isCopyPicked)pickInfo.copyToObjectClass.ApplySolToContainer()}else if(pickInfo.pickObjectClass){const objectClassSol=pickInfo.pickObjectClass.GetCurrentSol();
objectClassSol.SetArrayPicked(pickInfo.pickInstances);objectClassSol.ClearElseInstances()}if(pickInfo.pushCleanSolDynamic)extraPopSolModifiers=eventSheetManager.PushCleanSolDynamic(combinedSolModifiers)}const frame=eventStack.Push(this);if(isCopyPicked)frame.SetDynamicSolModifiers(combinedSolModifiers);if(yield*this._DebugCheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);const isAsync=this._scopeParent.IsAsync();if(isAsync)[asyncId,ret]=this._scopeParent.StartAsyncFunctionCall();yield*this._DebugRunAndBlock(frame);
if(isAsync)this._scopeParent.MaybeFinishAsyncFunctionCall(asyncId)}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(extraPopSolModifiers!==null)eventSheetManager.PopSol(extraPopSolModifiers);if(hasAnySolModifiers)eventSheetManager.PopSol(combinedSolModifiers);eventSheetManager._DecTriggerDepth();return ret}RunAsMappedFunctionCall(paramResults,isCopyPicked){const solModifiers=this.GetSolModifiersIncludingParents();const hasAnySolModifiers=solModifiers.length>0;const runtime=
this._runtime;const eventStack=this._eventStack;const eventSheetManager=runtime.GetEventSheetManager();const triggerDepth=eventSheetManager._IncTriggerDepth();const isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(paramResults);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);const frame=eventStack.Push(this);if(this._CheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);
this._RunAndBlock(frame)}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);eventSheetManager._DecTriggerDepth()}*DebugRunAsMappedFunctionCall(paramResults,isCopyPicked){if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;const solModifiers=this.GetSolModifiersIncludingParents();const hasAnySolModifiers=solModifiers.length>0;const runtime=this._runtime;const eventStack=this._eventStack;const eventSheetManager=
runtime.GetEventSheetManager();const triggerDepth=eventSheetManager._IncTriggerDepth();const isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(paramResults);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);const frame=eventStack.Push(this);if(yield*this._DebugCheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);yield*this._DebugRunAndBlock(frame)}eventStack.Pop();
if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);eventSheetManager._DecTriggerDepth()}RunAsExpressionFunctionCall(combinedSolModifiers,isCopyPicked,returnType,defaultReturnValue,...paramResults){let ret;let asyncId;const hasAnySolModifiers=combinedSolModifiers.length>0;const runtime=this._runtime;const eventStack=this._eventStack;const eventSheetManager=runtime.GetEventSheetManager();const triggerDepth=eventSheetManager._IncTriggerDepth();
const isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();if(paramResults.length>0)this._scopeParent.SetFunctionParameters(paramResults);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(combinedSolModifiers);else eventSheetManager.PushCleanSol(combinedSolModifiers);const frame=eventStack.Push(this);frame.InitCallFunctionExpression(returnType,defaultReturnValue);eventStack.PushExpFunc(frame);runtime.SetDebuggingEnabled(false);if(this._CheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);
const isAsync=this._scopeParent.IsAsync();if(isAsync)[asyncId,ret]=this._scopeParent.StartAsyncFunctionCall();this._RunAndBlock(frame);if(isAsync)this._scopeParent.MaybeFinishAsyncFunctionCall(asyncId)}runtime.SetDebuggingEnabled(true);eventStack.Pop();eventStack.PopExpFunc();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(hasAnySolModifiers)eventSheetManager.PopSol(combinedSolModifiers);eventSheetManager._DecTriggerDepth();return ret||frame.GetFunctionReturnValue()}};

}

// events/eventScript.js
{
'use strict';const C3=self.C3;const EMPTY_SOL_MODIFIERS=[];let hadUserScriptException=false;
C3.EventScript=class EventScript extends C3.DefendedBase{constructor(eventSheet,parent,data){super();const runtime=eventSheet.GetRuntime();const eventSheetManager=eventSheet.GetEventSheetManager();this._eventSheet=eventSheet;this._eventSheetManager=eventSheetManager;this._runtime=eventSheet.GetRuntime();this._parent=parent;const userMethod=runtime.GetObjectReference(data[1]);this._func=userMethod;this._displayNumber=data[2];this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber);
this._debugData=runtime.IsDebug()?{isBreakpoint:data[3][0],isBreakable:data[3][1]}:null}static Create(eventSheet,parent,data){return C3.New(C3.EventScript,eventSheet,parent,data)}_PostInit(){const userMethod=this._func;const localVars=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=userMethod.bind(null,this._runtime.GetIRuntime(),localVars)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&
this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(b){this._debugData.isBreakpoint=!!b}IsElseBlock(){return false}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetSolModifiersIncludingParents(){if(this._parent)return this._parent.GetSolModifiersIncludingParents();else return EMPTY_SOL_MODIFIERS}Run(frame){frame.SetCurrentEvent(this);this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(err){console.error(`Unhandled exception running script %c${this.GetEventSheet().GetName()}, event ${this.GetDisplayNumber()}:`,
"font-size: 1.2em; font-weight: bold;",err);if(self.C3Debugger)self.C3Debugger._SetLastErrorScript(this);if(!hadUserScriptException){console.info(`%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()`,"font-weight: bold; text-decoration: underline","","font-weight: bold");hadUserScriptException=true}}}*DebugRun(frame){frame.SetCurrentEvent(this);if(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())yield this;this.Run(frame)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&
!this._runtime.DebugBreakNext()}static HadUserScriptException(){return hadUserScriptException}static SetHadUserScriptException(){hadUserScriptException=true}};

}

// events/functionBlock.js
{
'use strict';const C3=self.C3;const assert=self.assert;
C3.FunctionBlock=class FunctionBlock extends C3.DefendedBase{constructor(eventSheet,parent,data){super();this._eventSheet=eventSheet;this._runtime=eventSheet.GetRuntime();this._parent=parent;this._functionType=0;this._functionName="";this._returnType=0;this._functionParameters=[];this._isEnabled=true;this._aceName="";this._objectClass=null;this._hasOverrides=false;this._innerLocalVariables=[];this._isCopyPicked=false;this._isAsync=false;this._nextAsyncId=0;this._currentAsyncId=-1;this._asyncMap=new Map;
this._eventBlock=C3.EventBlock.Create(eventSheet,parent,data);this._eventBlock._SetScopeParent(this)}InitFunctionBlock(funcData){this._functionType=0;this._functionName=funcData[0];this._returnType=funcData[1];this._functionParameters=funcData[2].map(paramData=>C3.EventVariable.Create(this._eventSheet,this,paramData));this._isEnabled=funcData[3];this._isAsync=funcData[4];this._isCopyPicked=funcData[5]}InitCustomACEBlock(funcData){this._functionType=1;this._aceName=funcData[1];this._objectClass=this._runtime.GetObjectClassByIndex(funcData[2]);
this._eventBlock._AddSolModifier(this._objectClass);this._functionName=this._objectClass.GetName()+"."+this._aceName;this._returnType=funcData[3];this._functionParameters=funcData[4].map(paramData=>C3.EventVariable.Create(this._eventSheet,this,paramData));this._isEnabled=funcData[5];this._isAsync=funcData[6];this._isCopyPicked=funcData[7];this._objectClass.AddCustomAction(this)}static CreateFunctionBlock(eventSheet,parent,data){const ret=C3.New(C3.FunctionBlock,eventSheet,parent,data);const funcData=
data[1];ret.InitFunctionBlock(funcData);return ret}static CreateCustomACEBlock(eventSheet,parent,data){const ret=C3.New(C3.FunctionBlock,eventSheet,parent,data);const funcData=data[1];ret.InitCustomACEBlock(funcData);return ret}_CheckOverrideState(){if(this._objectClass&&this._objectClass.IsFamily())for(const objectType of this._objectClass.GetFamilyMembers())if(objectType.HasOwnCustomActionByName(this._aceName)){this._hasOverrides=true;break}}_PostInit(){for(const fp of this._functionParameters)fp._PostInit();
this._eventBlock._PostInit(false)}GetFunctionType(){return this._functionType}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(localVariable){this._innerLocalVariables.push(localVariable)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(parameters){const functionParameters=this._functionParameters;for(let i=
0,len=functionParameters.length;i<len;++i)functionParameters[i].SetValue(parameters[i].Get(0))}SetFunctionParameters(paramResults){const functionParameters=this._functionParameters;for(let i=0,len=functionParameters.length;i<len;++i)functionParameters[i].SetValue(paramResults[i])}CaptureFunctionParameters(){return this._functionParameters.map(p=>p.GetValue())}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetACEName(){return this._aceName}HasCustomACEOverrides(){return this._hasOverrides}GetReturnType(){return this._returnType}GetObjectClass(){return this._objectClass}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;
case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsCopyPicked(){return this._isCopyPicked}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){const asyncId=this._nextAsyncId++;this._currentAsyncId=asyncId;let resolve;const promise=new Promise(r=>resolve=r);this._asyncMap.set(asyncId,{resolve,pauseCount:0});return[asyncId,promise]}MaybeFinishAsyncFunctionCall(asyncId){const info=this._asyncMap.get(asyncId);if(info.pauseCount===0){info.resolve();this._asyncMap.delete(asyncId)}this._currentAsyncId=
-1}PauseCurrentAsyncFunction(){const info=this._asyncMap.get(this._currentAsyncId);info.pauseCount++;return this._currentAsyncId}ResumeAsyncFunction(asyncId){this._currentAsyncId=asyncId;const info=this._asyncMap.get(asyncId);info.pauseCount--}RunAsFamilyCustomActionWithOverrides(combinedSolModifiers,parameters){const objectTypeMap=new Map;const familyInstances=[];for(const inst of this._objectClass.GetCurrentSol().GetInstances()){const objectType=inst.GetObjectClass();if(objectType.HasOwnCustomActionByName(this._aceName)){const arr=
objectTypeMap.get(objectType);if(Array.isArray(arr))arr.push(inst);else objectTypeMap.set(objectType,[inst])}else familyInstances.push(inst)}if(familyInstances.length>0)this._eventBlock.RunAsFunctionCall(combinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:familyInstances});if(objectTypeMap.size>0)for(const [objectType,arr]of objectTypeMap){const eventBlock=objectType.GetOwnCustomActionByName(this._aceName).GetEventBlock();const allCombinedSolModifiers=
[...(new Set([...combinedSolModifiers,...eventBlock.GetSolModifiers()]))];eventBlock.RunAsFunctionCall(allCombinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:objectType,pickInstances:arr})}}*DebugRunAsFamilyCustomActionWithOverrides(combinedSolModifiers,parameters){const objectTypeMap=new Map;const familyInstances=[];for(const inst of this._objectClass.GetCurrentSol().GetInstances()){const objectType=inst.GetObjectClass();if(objectType.HasOwnCustomActionByName(this._aceName)){const arr=
objectTypeMap.get(objectType);if(Array.isArray(arr))arr.push(inst);else objectTypeMap.set(objectType,[inst])}else familyInstances.push(inst)}if(familyInstances.length>0)yield*this._eventBlock.DebugRunAsFunctionCall(combinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:familyInstances});if(objectTypeMap.size>0)for(const [objectType,arr]of objectTypeMap){const eventBlock=objectType.GetOwnCustomActionByName(this._aceName).GetEventBlock();const allCombinedSolModifiers=
[...(new Set([...combinedSolModifiers,...eventBlock.GetSolModifiers()]))];yield*eventBlock.DebugRunAsFunctionCall(allCombinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:objectType,pickInstances:arr})}}};

}

// events/eventVariable.js
{
'use strict';const C3=self.C3;const EMPTY_SOL_MODIFIERS=[];
C3.EventVariable=class EventVariable extends C3.DefendedBase{constructor(eventSheet,parent,data){super();const eventSheetManager=eventSheet.GetEventSheetManager();this._eventSheet=eventSheet;this._eventSheetManager=eventSheetManager;this._runtime=eventSheet.GetRuntime();this._parent=parent;this._localVarStack=eventSheetManager.GetLocalVarStack();this._name=data[1];this._type=data[2];this._initialValue=data[3];this._isStatic=!!data[4];this._isConstant=!!data[5];this._isFunctionParameter=parent instanceof
C3.FunctionBlock;this._sid=data[6];this._jsPropName=this._runtime.GetJsPropName(data[8]);this._scriptSetter=v=>this.SetValue(v);this._scriptGetter=()=>this.GetValue();this._hasSingleValue=!this._parent||this._isStatic||this._isConstant;this._value=this._initialValue;this._localIndex=-1;if(this.IsBoolean())this._value=this._value?1:0;if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant())this._localIndex=eventSheetManager._GetNextLocalVarIndex(this);eventSheetManager._RegisterEventVariable(this)}static Create(eventSheet,
parent,data){return C3.New(C3.EventVariable,eventSheet,parent,data)}_PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&!this.IsFunctionParameter()){const functionBlock=this._eventSheetManager.FindFirstFunctionBlockParent(this);if(functionBlock)functionBlock._RegisterLocalVariable(this)}}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return this._type===
0}IsString(){return this._type===1}IsBoolean(){return this._type===2}IsElseBlock(){return false}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}Run(frame){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant())this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return true}*DebugRun(frame){this.Run(frame)}SetValue(v){if(this.IsNumber()){if(typeof v!=="number")v=parseFloat(v)}else if(this.IsString()){if(typeof v!=="string")v=v.toString()}else if(this.IsBoolean())v=
v?1:0;if(this._hasSingleValue)this._value=v;else this._localVarStack.GetCurrent()[this._localIndex]=v}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let ret=this.GetValue();if(this.IsBoolean())ret=!!ret;return ret}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:false,enumerable:true,get:this._scriptGetter,set:this._scriptSetter}}};

}

// events/eventInclude.js
{
'use strict';const C3=self.C3;const assert=self.assert;const EMPTY_SOL_MODIFIERS=[];
C3.EventInclude=class EventInclude extends C3.DefendedBase{constructor(eventSheet,parent,data){super();const eventSheetManager=eventSheet.GetEventSheetManager();this._eventSheet=eventSheet;this._eventSheetManager=eventSheetManager;this._runtime=eventSheet.GetRuntime();this._parent=parent;this._includeSheet=null;this._includeSheetName=data[1];this._isActive=true}static Create(eventSheet,parent,data){return C3.New(C3.EventInclude,eventSheet,parent,data)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName);
this._eventSheet._AddShallowInclude(this);let p=this.GetParent();while(p){if(p instanceof C3.EventBlock&&p.IsGroup())p._AddContainedInclude(this);p=p.GetParent()}this.UpdateActive();if(this._runtime.IsDebug())this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetIncludeSheet(){return this._includeSheet}Run(frame){const pushSol=!!this.GetParent();const allObjectClasses=this._runtime.GetAllObjectClasses();
if(pushSol)this._eventSheetManager.PushCleanSol(allObjectClasses);this._includeSheet.Run();if(pushSol)this._eventSheetManager.PopSol(allObjectClasses)}*DebugRun(frame){const pushSol=!!this.GetParent();const allObjectClasses=this._runtime.GetAllObjectClasses();if(pushSol)this._eventSheetManager.PushCleanSol(allObjectClasses);yield*this._includeSheet.DebugRun();if(pushSol)this._eventSheetManager.PopSol(allObjectClasses)}DebugCanRunFast(){return false}IsActive(){return this._isActive}UpdateActive(){let p=
this.GetParent();while(p){if(p instanceof C3.EventBlock&&p.IsGroup()&&!p.IsGroupActive()){this._isActive=false;return}p=p.GetParent()}this._isActive=true}};

}

// events/expNode.js
{
'use strict';const C3=self.C3;const assert=self.assert;C3.ExpNode=class ExpNode extends C3.DefendedBase{constructor(owner){super();this._owner=owner;this._runtime=owner.GetRuntime()}_PostInit(){}static CreateNode(owner,data){const type=data[0];const Classes=[BehaviorExpressionNode,ObjectExpressionNode,InstVarExpressionNode,EventVarExpNode,SystemExpressionExpNode,CallFunctionExpressionExpNode];return C3.New(Classes[type],owner,data)}};
class SystemExpressionExpNode extends C3.ExpNode{constructor(owner,data){super(owner);this._systemPlugin=this._runtime.GetSystemPlugin();this._func=this._runtime.GetObjectReference(data[1]);if(this._func===C3.Plugins.System.Exps.random||this._func===C3.Plugins.System.Exps.choose)this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}
class CallFunctionExpressionExpNode extends C3.ExpNode{constructor(owner,data){super(owner);this._functionBlock=null;this._functionName=data[1];this._owner.SetVariesPerInstance()}_PostInit(){const eventSheetManager=this._runtime.GetEventSheetManager();this._functionBlock=eventSheetManager.GetFunctionBlockByName(this._functionName);this._functionName=null;const myEventBlock=this._owner.GetEventBlock();const callEventBlock=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...(new Set([...myEventBlock.GetSolModifiersIncludingParents(),
...callEventBlock.GetSolModifiersIncludingParents()]))];this._combinedSolModifiers=eventSheetManager._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){const functionBlock=this._functionBlock;if(functionBlock.IsEnabled()){const callEventBlock=functionBlock.GetEventBlock();return C3.EventBlock.prototype.RunAsExpressionFunctionCall.bind(callEventBlock,this._combinedSolModifiers,functionBlock.IsCopyPicked(),functionBlock.GetReturnType(),functionBlock.GetDefaultReturnValue())}else{const defaultReturnValue=
functionBlock.GetDefaultReturnValue();return()=>defaultReturnValue}}}function WrapIndex(index,len){if(index>=len)return index%len;else if(index<0){if(index<=-len)index%=len;if(index<0)index+=len;return index}else return index}
class ObjectExpressionNode extends C3.ExpNode{constructor(owner,data){super(owner);this._objectClass=this._runtime.GetObjectClassByIndex(data[1]);this._func=this._runtime.GetObjectReference(data[2]);this._returnsString=!!data[3];this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...args){const objectClass=
this._objectClass;const instances=objectClass.GetCurrentSol().GetExpressionInstances();const len=instances.length;if(len===0)return this._returnsString?"":0;const index=WrapIndex(this._owner.GetSolIndex(),len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);return this._func.apply(instances[index].GetSdkInstance(),args)}ExpObject_InstExpr(instIndex,...args){const objectClass=this._objectClass;const instances=objectClass.GetInstances();const len=instances.length;if(len===
0)return this._returnsString?"":0;const index=WrapIndex(instIndex,len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);return this._func.apply(instances[index].GetSdkInstance(),args)}}
class InstVarExpressionNode extends C3.ExpNode{constructor(owner,data){super(owner);this._objectClass=this._runtime.GetObjectClassByIndex(data[1]);this._varIndex=data[3];this._returnsString=!!data[2];this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){const instances=this._objectClass.GetCurrentSol().GetExpressionInstances();const len=instances.length;if(len===0)return this._returnsString?"":0;const index=WrapIndex(this._owner.GetSolIndex(),len);return instances[index]._GetInstanceVariableValueUnchecked(this._varIndex)}ExpInstVar_Family(){const objectClass=
this._objectClass;const instances=objectClass.GetCurrentSol().GetExpressionInstances();const len=instances.length;if(len===0)return this._returnsString?"":0;const index=WrapIndex(this._owner.GetSolIndex(),len);const inst=instances[index];const offset=inst.GetObjectClass().GetFamilyInstanceVariableOffset(objectClass.GetFamilyIndex());return inst._GetInstanceVariableValueUnchecked(this._varIndex+offset)}ExpInstVar_InstExpr(instIndex){const objectClass=this._objectClass;const instances=objectClass.GetInstances();
const len=instances.length;if(len===0)return this._returnsString?"":0;const index=WrapIndex(instIndex,len);const inst=instances[index];let offset=0;if(objectClass.IsFamily())offset=inst.GetObjectClass().GetFamilyInstanceVariableOffset(objectClass.GetFamilyIndex());return inst._GetInstanceVariableValueUnchecked(this._varIndex+offset)}}
class BehaviorExpressionNode extends C3.ExpNode{constructor(owner,data){super(owner);this._objectClass=this._runtime.GetObjectClassByIndex(data[1]);this._behaviorType=this._objectClass.GetBehaviorTypeByName(data[2]);this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(data[2]);this._func=this._runtime.GetObjectReference(data[3]);this._returnsString=!!data[4];this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...args){const objectClass=
this._objectClass;const instances=objectClass.GetCurrentSol().GetExpressionInstances();const len=instances.length;if(len===0)return this._returnsString?"":0;const index=WrapIndex(this._owner.GetSolIndex(),len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);const inst=instances[index];let offset=0;if(objectClass.IsFamily())offset=inst.GetObjectClass().GetFamilyBehaviorOffset(objectClass.GetFamilyIndex());return this._func.apply(inst.GetBehaviorInstances()[this._behaviorIndex+
offset].GetSdkInstance(),args)}ExpBehavior_InstExpr(instIndex,...args){const objectClass=this._objectClass;const instances=objectClass.GetInstances();const len=instances.length;if(len===0)return this._returnsString?"":0;const index=WrapIndex(instIndex,len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);const inst=instances[index];let offset=0;if(objectClass.IsFamily())offset=inst.GetObjectClass().GetFamilyBehaviorOffset(objectClass.GetFamilyIndex());return this._func.apply(inst.GetBehaviorInstances()[this._behaviorIndex+
offset].GetSdkInstance(),args)}}class EventVarExpNode extends C3.ExpNode{constructor(owner,data){super(owner);this._eventVar=null;this._eventVarSid=data[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}};

}

// events/parameter.js
{
'use strict';const C3=self.C3;const assert=self.assert;
C3.Parameter=class Parameter extends C3.DefendedBase{constructor(owner,type,index){super();this._owner=owner;this._index=index;this._type=type;this.Get=null;this._variesPerInstance=false;this._isConstant=false}static Create(owner,data,index){const type=data[0];const Classes=[ExpressionParameter,StringExpressionParameter,FileParameter,ComboParameter,ObjectParameter,LayerExpressionParameter,LayoutParameter,ExpressionParameter,ComboParameter,ComboParameter,InstVarParameter,EventVarParameter,FileParameter,
VariadicParameter,StringExpressionParameter,TimelineParameter,BooleanParameter,FunctionParameter,EaseParameter,TilemapBrushParameter,TemplateExpressionParameter,FlowchartParameter];return C3.New(Classes[type],owner,type,index,data)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=true}_MaybeVaryFor(objectClass){if(this._variesPerInstance)return;if(!objectClass)return;if(!objectClass.GetPlugin().IsSingleGlobal())this._variesPerInstance=true}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}IsObjectParameter(){return this._type===
4}};function GetExpressionFunc(number){const ret=self.C3_ExpressionFuncs[number];if(!ret)throw new Error("invalid expression number");return ret}
class ExpressionParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._solIndex=0;const expData=data[1];this._expressionNumber=expData[0];this._numberedNodes=[];this._expressionFunc=null;for(let i=1,len=expData.length;i<len;++i)this._numberedNodes.push(C3.ExpNode.CreateNode(this,expData[i]));if(this._numberedNodes.length)this.Get=this.GetExpression;else{this.Get=GetExpressionFunc(this._expressionNumber);this._isConstant=true}}_GetNode(i){if(i<0||i>=this._numberedNodes.length)throw new RangeError("invalid numbered node");
return this._numberedNodes[i]}_PostInit(){for(const node of this._numberedNodes)node._PostInit();const func=GetExpressionFunc(this._expressionNumber);if(this._numberedNodes.length)this._expressionFunc=func(this);else this._expressionFunc=func}GetSolIndex(){return this._solIndex}GetExpression(solIndex){this._solIndex=solIndex;return this._expressionFunc()}}
class StringExpressionParameter extends ExpressionParameter{constructor(owner,type,index,data){super(owner,type,index,data);this.Get=this.GetStringExpression;if(type===14){this.GetEventBlock().SetAllSolModifiers();if(this._owner instanceof C3.Action)this.GetEventBlock().SetSolWriterAfterCnds()}}GetStringExpression(solIndex){this._solIndex=solIndex;const ret=this._expressionFunc();if(typeof ret==="string")return ret;else return""}_GetFastTriggerValue(){return GetExpressionFunc(this._expressionNumber)()}}
class LayerExpressionParameter extends ExpressionParameter{constructor(owner,type,index,data){super(owner,type,index,data);if(owner.GetImplementationSdkVersion()>=2)this.Get=this.GetILayer;else this.Get=this.GetLayer;this._isConstant=false}GetLayer(solIndex){this._solIndex=solIndex;const ret=this._expressionFunc();const layout=this.GetRuntime().GetCurrentLayout();return layout.GetLayer(ret)}GetILayer(solIndex){const layer=this.GetLayer();return layer?layer.GetILayer():null}}
class ComboParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._combo=data[1];this.Get=this.GetCombo;this._isConstant=true}GetCombo(){return this._combo}}class BooleanParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._bool=data[1];this.Get=this.GetBoolean;this._isConstant=true}GetBoolean(){return this._bool}}
class ObjectParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._objectClass=this.GetRuntime().GetObjectClassByIndex(data[1]);if(owner.GetImplementationSdkVersion()>=2)this.Get=this.GetIObjectClass;else this.Get=this.GetObjectClass;const eventBlock=this.GetEventBlock();eventBlock._AddSolModifier(this._objectClass);if(this._owner instanceof C3.Action)eventBlock.SetSolWriterAfterCnds();else if(eventBlock.GetParent())eventBlock.GetParent().SetSolWriterAfterCnds();
this._isConstant=true}GetObjectClass(){return this._objectClass}GetIObjectClass(){return this._objectClass?this._objectClass.GetIObjectClass():null}}
class LayoutParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(data[1]);if(owner.GetImplementationSdkVersion()>=2)this.Get=this.GetILayout;else this.Get=this.GetLayout;this._isConstant=true}GetLayout(){return this._layout}GetILayout(){return this._layout?this._layout.GetILayout():null}}
class TimelineParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(data[1]);if(owner.GetImplementationSdkVersion()>=2)this.Get=this.GetITimelineState;else this.Get=this.GetTimeline;this._isConstant=true}GetTimeline(){return this._timeline}GetITimelineState(){return this._timeline?this._timeline.GetITimelineState():null}}
class FileParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._fileInfo=data[1];this.Get=this.GetFile;this._isConstant=true}GetFile(){return this._fileInfo}}
class InstVarParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._instVarIndex=data[1];const ownerObjectClass=this._owner.GetObjectClass();if(this._owner instanceof C3.Condition&&this._owner.IsStatic()){this.Get=this.GetInstanceVariable;this._isConstant=true}else if(ownerObjectClass&&ownerObjectClass.IsFamily()){this.Get=this.GetFamilyInstanceVariable;this.SetVariesPerInstance()}else{this.Get=this.GetInstanceVariable;this._isConstant=true}}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(solIndex){solIndex=
solIndex||0;const familyType=this._owner.GetObjectClass();const sol=familyType.GetCurrentSol();const instances=sol.GetInstances();let realType=null;if(instances.length)realType=instances[solIndex%instances.length].GetObjectClass();else if(sol.HasAnyElseInstances()){const elseInstances=sol.GetElseInstances();realType=elseInstances[solIndex%elseInstances.length].GetObjectClass()}else if(familyType.GetInstanceCount()>0){const familyInstances=familyType.GetInstances();realType=familyInstances[solIndex%
familyInstances.length].GetObjectClass()}else return 0;return this._instVarIndex+realType.GetFamilyInstanceVariableOffset(familyType.GetFamilyIndex())}}
class EventVarParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._eventVarSid=data[1];this._eventVar=null;if(owner.GetImplementationSdkVersion()>=2)this.Get=this.GetIEventVariable;else this.Get=this.GetEventVariable;this._isConstant=true}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}GetIEventVariable(){return null}}
class FunctionParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._functionBlockName=data[1];this._functionBlock=null;if(owner.GetImplementationSdkVersion()>=2)this.Get=this.GetIFunction;else this.Get=this.GetFunction;this._isConstant=true}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName);this._functionBlockName=null}GetFunction(){return this._functionBlock}GetIFunction(){return null}}
class VariadicParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._subParams=[];this._variadicRet=[];this._isConstant=true;for(let i=1,len=data.length;i<len;++i){const subParam=C3.Parameter.Create(this._owner,data[i],0);this._subParams.push(subParam);this._variadicRet.push(0);if(!subParam.IsConstant())this._isConstant=false}this.Get=this.GetVariadic}_PostInit(){for(const subParam of this._subParams)subParam._PostInit()}GetVariadic(){const subParams=this._subParams;
const variadicRet=this._variadicRet;for(let i=0,len=subParams.length;i<len;++i)variadicRet[i]=subParams[i].Get(0);return variadicRet}}class EaseParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._easeIndex=data[1];this.Get=this.GetEase;this._isConstant=true}GetEase(){return this._easeIndex}}
class TilemapBrushParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._brushIndex=data[1];this.Get=this.GetTilemapBrush;this._isConstant=true}GetTilemapBrush(){return this._brushIndex}}class TemplateExpressionParameter extends ExpressionParameter{constructor(owner,type,index,data){super(owner,type,index,data);this.Get=this.GetTemplateName;this._isConstant=false}GetTemplateName(){return this._expressionFunc()}}
class FlowchartParameter extends C3.Parameter{constructor(owner,type,index,data){super(owner,type,index);this._flowchartDataItem=this.GetRuntime().GetFlowchartManager().GetFlowchartDataItemByName(data[1]);this.Get=this.GetFlowchartName;this._isConstant=true}GetFlowchartName(){return this._flowchartDataItem.GetName()}};

}

// events/condition.js
{
'use strict';const C3=self.C3;const assert=self.assert;function EvalParams(parameters,results){for(let i=0,len=parameters.length;i<len;++i)results[i]=parameters[i].Get(0)}const EMPTY_PARAMS_ARRAY=[];const noop=function(){};
C3.Condition=class Condition extends C3.DefendedBase{constructor(eventBlock,data,index){super();this._eventBlock=eventBlock;this._runtime=eventBlock.GetRuntime();this._index=index;this._func=this._runtime.GetObjectReference(data[1]);this._isTrigger=data[3]>0;this._isFastTrigger=data[3]===2;this._isLooping=!!data[4];this._isInverted=!!data[5];this._isStatic=!!data[6];this._sid=data[7];this._isInOrBlock=this._eventBlock.IsOrBlock();this._objectClass=null;this._behaviorType=null;this._behaviorIndex=
-1;this._systemPlugin=null;this.Run=noop;this.DebugRun=noop;this._parameters=[];this._results=[];this._anyParamVariesPerInstance=false;this._savedData=null;this._unsavedData=null;this._debugData=this._runtime.IsDebug()?{isBreakpoint:data[8][0],canDebug:data[8][1]}:null;if(data[0]===-1)this._systemPlugin=this._runtime.GetSystemPlugin();else{this._objectClass=this._runtime.GetObjectClassByIndex(data[0]);if(data[2]){this._behaviorType=this._objectClass.GetBehaviorTypeByName(data[2]);this._behaviorIndex=
this._objectClass.GetBehaviorIndexByName(data[2])}if(this._eventBlock.GetParent())this._eventBlock.GetParent().SetSolWriterAfterCnds()}if(data.length===10){let paramData=data[9];for(let data of paramData){this._parameters.push(C3.Parameter.Create(this,data,this._parameters.length));this._results.push(0)}}if(this._parameters.length===0){this._parameters=EMPTY_PARAMS_ARRAY;this._results=EMPTY_PARAMS_ARRAY}this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(eventBlock,data,
index){return C3.New(C3.Condition,eventBlock,data,index)}_PostInit(){for(const param of this._parameters){param._PostInit();if(param.VariesPerInstance())this._anyParamVariesPerInstance=true}if(this._isFastTrigger){this.Run=this._RunFastTrigger;this.DebugRun=this._DebugRunFastTrigger}else if(this._systemPlugin){this._SetSystemRunMethod();this.DebugRun=this._DebugRunSystem}else if(this._objectClass.GetPlugin().IsSingleGlobal()){this._SetSingleGlobalRunMethod();this.DebugRun=this._DebugRunSingleGlobal}else if(this._isStatic){this.Run=
this._RunStatic;this.DebugRun=this._DebugRunStatic}else{this.Run=this._RunObject;this.DebugRun=this._DebugRunObject}}_SetSystemRunMethod(){const plugin=this._systemPlugin;const bindThis=this._systemPlugin;this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSystem)}_SetSingleGlobalRunMethod(){const plugin=this._objectClass.GetPlugin();const bindThis=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(plugin,
bindThis,fallbackMethod){const func=this._func;const isInverted=this._isInverted;const parameters=this._parameters;if(parameters.length===0){const boundFunc=plugin._GetBoundACEMethod(func,bindThis);if(isInverted)this.Run=function RunSingleCnd_0param(){return C3.xor(boundFunc(),isInverted)};else this.Run=boundFunc}else if(parameters.length===1){const param0=parameters[0];if(!isInverted&&param0.IsConstant())this.Run=plugin._GetBoundACEMethod_1param(func,bindThis,param0.Get(0));else{const boundFunc=
plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleCnd_1param(){return C3.xor(boundFunc(param0.Get(0)),isInverted)}}}else if(parameters.length===2){const param0=parameters[0];const param1=parameters[1];if(!isInverted&&param0.IsConstant()&&param1.IsConstant())this.Run=plugin._GetBoundACEMethod_2params(func,bindThis,param0.Get(0),param1.Get(0));else{const boundFunc=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleCnd_2params(){return C3.xor(boundFunc(param0.Get(0),
param1.Get(0)),isInverted)}}}else if(parameters.length===3){const param0=parameters[0];const param1=parameters[1];const param2=parameters[2];if(!isInverted&&param0.IsConstant()&&param1.IsConstant()&&param2.IsConstant())this.Run=plugin._GetBoundACEMethod_3params(func,bindThis,param0.Get(0),param1.Get(0),param2.Get(0));else{const boundFunc=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleCnd_3params(){return C3.xor(boundFunc(param0.Get(0),param1.Get(0),param2.Get(0)),isInverted)}}}else this.Run=
fallbackMethod}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetImplementationAddon(){if(this._behaviorType)return this._behaviorType.GetBehavior();else if(this._objectClass)return this._objectClass.GetPlugin();else return null}GetImplementationSdkVersion(){const addon=this.GetImplementationAddon();return addon?addon.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsStatic(){return this._isStatic}IsBreakpoint(){return this._debugData.isBreakpoint}IsSystemCondition(){return!!this._systemPlugin}IsSystemOrSingleGlobalCondition(){return this.IsSystemCondition()||
this._objectClass.GetPlugin().IsSingleGlobal()}GetFirstObjectParameterObjectClass(){for(const p of this._parameters)if(p.IsObjectParameter())return p.GetObjectClass();return null}_SetBreakpoint(b){this._debugData.isBreakpoint=!!b;this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){if(!this._savedData)this._savedData=new Map;
return this._savedData}GetUnsavedDataMap(){if(!this._unsavedData)this._unsavedData=new Map;return this._unsavedData}_RunSystem(){const results=this._results;EvalParams(this._parameters,results);return C3.xor(this._func.apply(this._systemPlugin,results),this._isInverted)}*_DebugRunSystem(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=this._results;EvalParams(this._parameters,results);let ret=this._func.apply(this._systemPlugin,results);
if(C3.IsIterator(ret))ret=yield*ret;return C3.xor(ret,this._isInverted)}else return this.Run()}_RunSingleGlobal(){const results=this._results;EvalParams(this._parameters,results);const inst=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return C3.xor(this._func.apply(inst,results),this._isInverted)}*_DebugRunSingleGlobal(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=this._results;EvalParams(this._parameters,results);
const inst=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();let ret=this._func.apply(inst,results);if(C3.IsIterator(ret))ret=yield*ret;return C3.xor(ret,this._isInverted)}else return this.Run()}_RunFastTrigger(){return true}*_DebugRunFastTrigger(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;return true}_GetStaticConditionThis(){if(this._behaviorType)if(this._behaviorType.GetBehavior().GetSdkVersion()>=2)throw new Error("not yet implemented");else return this._behaviorType;
else if(this._objectClass.GetPlugin().GetSdkVersion()>=2)return this._objectClass.GetIObjectClass();else return this._objectClass}_RunStatic(){const results=this._results;EvalParams(this._parameters,results);const ret=this._func.apply(this._GetStaticConditionThis(),results);this._objectClass.ApplySolToContainer();return ret}*_DebugRunStatic(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=this._results;EvalParams(this._parameters,
results);let ret=this._func.apply(this._GetStaticConditionThis(),results);if(C3.IsIterator(ret))ret=yield*ret;this._objectClass.ApplySolToContainer();return ret}else return this.Run()}_RunObject(){const parameters=this._parameters;const results=this._results;const sol=this._objectClass.GetCurrentSol();for(let i=0,len=parameters.length;i<len;++i){const p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0)}if(sol.IsSelectAll())return this._RunObject_FirstFilter(sol);else return this._RunObject_NextFilter(sol)}*_DebugRunObject(){if(this.IsBreakpoint()||
this._runtime.DebugBreakNext())yield this;return this._RunObject()}_EvaluateVaryingParameters(solIndex){const parameters=this._parameters;const results=this._results;for(let i=0,len=parameters.length;i<len;++i){const p=parameters[i];if(p.VariesPerInstance())results[i]=p.Get(solIndex)}}_RunObject_FirstFilter(sol){const objectClass=this._objectClass;const isFamily=objectClass.IsFamily();const familyIndex=objectClass.GetFamilyIndex();const behaviorIndex=this._behaviorIndex;const isBehavior=behaviorIndex>=
0;const allInstances=objectClass.GetInstances();const paramsVary=this._anyParamVariesPerInstance;const results=this._results;const func=this._func;const isInverted=this._isInverted;const isInOrBlock=this._isInOrBlock&&!this._isTrigger;sol.ClearArrays();for(let i=0,len=allInstances.length;i<len;++i){const inst=allInstances[i];if(paramsVary)this._EvaluateVaryingParameters(i);let ret;if(isBehavior){const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;ret=func.apply(inst.GetBehaviorInstances()[behaviorIndex+
offset].GetSdkInstance(),results)}else ret=func.apply(inst.GetSdkInstance(),results);if(C3.xor(ret,isInverted))sol._PushInstance(inst);else if(isInOrBlock)sol._PushElseInstance(inst)}objectClass.FinishCondition(true);sol._SetSelectAll(false);objectClass.ApplySolToContainer();return sol.HasAnyInstances()}_RunObject_NextFilter(sol){const objectClass=this._objectClass;const isFamily=objectClass.IsFamily();const familyIndex=objectClass.GetFamilyIndex();const isInContainer=objectClass.IsInContainer();
const behaviorIndex=this._behaviorIndex;const isBehavior=behaviorIndex>=0;const paramsVary=this._anyParamVariesPerInstance;const results=this._results;const func=this._func;const isInverted=this._isInverted;const isInOrBlock=this._isInOrBlock&&!this._isTrigger;const solInstances=sol._GetOwnInstances();const solElseInstances=sol._GetOwnElseInstances();const isUsingElseInstances=isInOrBlock&&!this._eventBlock.IsFirstConditionOfType(this);const arr=isUsingElseInstances?solElseInstances:solInstances;
let k=0;let isAnyTrue=false;for(let i=0,len=arr.length;i<len;++i){const inst=arr[i];if(paramsVary)this._EvaluateVaryingParameters(i);let ret;if(isBehavior){const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;ret=func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results)}else ret=func.apply(inst.GetSdkInstance(),results);if(C3.xor(ret,isInverted)){isAnyTrue=true;if(isUsingElseInstances){solInstances.push(inst);if(isInContainer)inst._PushSiblingsToSolInstances()}else{arr[k]=
inst;if(isInContainer)inst._SetSiblingsToSolInstancesIndex(k);++k}}else if(isUsingElseInstances){arr[k]=inst;if(isInContainer)inst._SetSiblingsToSolElseInstancesIndex(k);++k}else if(isInOrBlock){solElseInstances.push(inst);if(isInContainer)inst._PushSiblingsToSolElseInstances()}}C3.truncateArray(arr,k);if(isInContainer)objectClass._TruncateContainerSols(isUsingElseInstances,k);const pickInFinish=isAnyTrue;if(isUsingElseInstances&&!isAnyTrue)isAnyTrue=this._OrBlockCheckInstances(solInstances);objectClass.FinishCondition(pickInFinish||
isInOrBlock);return isInOrBlock?isAnyTrue:sol.HasAnyInstances()}_OrBlockCheckInstances(solInstances){const objectClass=this._objectClass;const isFamily=objectClass.IsFamily();const familyIndex=objectClass.GetFamilyIndex();const paramsVary=this._anyParamVariesPerInstance;const behaviorIndex=this._behaviorIndex;const isBehavior=behaviorIndex>=0;const results=this._results;const func=this._func;const isInverted=this._isInverted;for(let i=0,len=solInstances.length;i<len;++i){const inst=solInstances[i];
if(paramsVary)this._EvaluateVaryingParameters(i);let ret;if(isBehavior){const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;ret=func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results)}else ret=func.apply(inst.GetSdkInstance(),results);if(C3.xor(ret,isInverted))return true}return false}ReevaluateParameter(paramIndex,solIndex){return this._parameters[paramIndex].Get(solIndex)}GetFastTriggerValue(){const parameters=this._parameters;if(!parameters.length)throw new Error("no parameters");
return parameters[0]._GetFastTriggerValue()}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;const ex={};for(const [k,v]of this._savedData.entries()){let saveVal=v;if(k==="collmemory")saveVal=[...v.entries()].map(arr=>[arr[0].GetUID(),arr[1].GetUID(),arr[2]]);ex[k]=saveVal}return{"ex":ex}}_LoadFromJson(o){if(this._savedData){this._savedData.clear();this._savedData=null}if(!o)return;const runtime=this._runtime;const ex=o["ex"];if(ex){const map=this.GetSavedDataMap();map.clear();
for(const [k,v]of Object.entries(ex)){let loadVal=v;if(k==="collmemory")loadVal=C3.New(C3.PairMap,v.map(arr=>[runtime.GetInstanceByUID(arr[0]),runtime.GetInstanceByUID(arr[1]),arr[2]]).filter(arr=>arr[0]&&arr[1]));map.set(k,loadVal)}}}};

}

// events/action.js
{
'use strict';const C3=self.C3;const assert=self.assert;function EvalParams(parameters,results){for(let i=0,len=parameters.length;i<len;++i)results[i]=parameters[i].Get(0)}const EMPTY_PARAMS_ARRAY=[];const noop=function(){};const noopGenerator=function*(){};const FLAG_CANPICKANYOBJECTCLASS=1;const FLAG_COPYPICKED=2;const FLAG_CUSTOM_ACE=4;const FLAG_IS_ASYNC=8;
C3.Action=class Action extends C3.DefendedBase{constructor(eventBlock,data,index){super();this._eventBlock=eventBlock;const runtime=eventBlock.GetRuntime();this._runtime=runtime;this._index=index;this._sid=data.length>=4?data[3]:-1;this._actionType=data.length>=5?data[4]&255:0;this._flags=data.length>=5?data[4]>>8:0;this._func=null;this._objectClass=null;this._behaviorType=null;this._behaviorIndex=-1;this._systemPlugin=null;this._callFunctionName="";this._callCustomAceObjectClass=null;this._callEventBlock=
null;this.Run=noop;this.DebugRun=noop;this._parameters=[];this._results=[];this._anyParamVariesPerInstance=false;this._savedData=null;this._unsavedData=null;const isScript=data[0]===-3;const debugInfo=isScript?data[2]:data[5];this._debugData=runtime.IsDebug()||isScript?{isBreakpoint:debugInfo[0],canDebug:debugInfo[1],index:debugInfo[2]}:null;if(data[0]===-1){this._systemPlugin=runtime.GetSystemPlugin();this._func=runtime.GetObjectReference(data[1])}else if(data[0]===-2)this._callFunctionName=data[1];
else if(isScript){const userMethod=runtime.GetObjectReference(data[1]);this._func=userMethod;this.Run=this.RunUserScript;this.DebugRun=this.DebugRunUserScript;this._flags|=FLAG_IS_ASYNC}else{this._objectClass=runtime.GetObjectClassByIndex(data[0]);if(this._flags&FLAG_CUSTOM_ACE){this._callFunctionName=data[1];this._callCustomAceObjectClass=runtime.GetObjectClassByIndex(data[2])}else{if(data[2]){this._behaviorType=this._objectClass.GetBehaviorTypeByName(data[2]);this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(data[2])}this._func=
runtime.GetObjectReference(data[1])}}if(data.length===7){const paramData=data[6];for(const data of paramData){this._parameters.push(C3.Parameter.Create(this,data,this._parameters.length));this._results.push(0)}}if(this._parameters.length===0){this._parameters=EMPTY_PARAMS_ARRAY;this._results=EMPTY_PARAMS_ARRAY}if(this.CanPickAnyObjectClass()){this._eventBlock.SetAllSolModifiers();this._eventBlock.SetSolWriterAfterCnds()}this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(eventBlock,
data,index){return C3.New(C3.Action,eventBlock,data,index)}_PostInit(){for(const param of this._parameters){param._PostInit();if(param.VariesPerInstance())this._anyParamVariesPerInstance=true}if(this._systemPlugin){this._SetSystemRunMethod();this.DebugRun=this._DebugRunSystem}else if(this._callFunctionName){if(this._flags&FLAG_CUSTOM_ACE)this._SetCallCustomActionRunMethod();else this._SetCallFunctionRunMethod();this._callFunctionName="";this._callCustomAceObjectClass=null}else if(this.Run===this.RunUserScript){const userMethod=
this._func;const localVars=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=userMethod.bind(null,this._runtime.GetIRuntime(),localVars)}else if(this._behaviorType)if(this.IsAsync()){this.Run=this._RunBehavior_Async;this.DebugRun=this._DebugRunBehavior_Async}else{this.Run=this._RunBehavior;this.DebugRun=this._DebugRunBehavior}else if(this._objectClass.GetPlugin().IsSingleGlobal()){this._SetSingleGlobalRunMethod();this.DebugRun=this._DebugRunSingleGlobal}else if(this.IsStatic()){this.Run=
this._RunObject_Static;this.DebugRun=this._DebugRunObject_Static}else if(this.IsAsync()){this.Run=this._RunObject_Async;this.DebugRun=this._DebugRunObject_Async}else if(this.CallBeforeAfterHooks()){this.Run=this._RunObject_BeforeAfterHooks;this.DebugRun=this._DebugRunObject_BeforeAfterHooks}else if(!this._parameters.length){this.Run=this._RunObject_ParamsConst;this.DebugRun=this._DebugRunObject_ParamsConst}else if(this._parameters.every(p=>p.VariesPerInstance())){this.Run=this._RunObject_AllParamsVary;
this.DebugRun=this._DebugRunObject_AllParamsVary}else if(this._anyParamVariesPerInstance){this.Run=this._RunObject_SomeParamsVary;this.DebugRun=this._DebugRunObject_SomeParamsVary}else if(this._parameters.every(p=>p.IsConstant())){EvalParams(this._parameters,this._results);this.Run=this._RunObject_ParamsConst;this.DebugRun=this._DebugRunObject_ParamsConst}else{this.Run=this._RunObject_ParamsDontVary;this.DebugRun=this._DebugRunObject_ParamsDontVary}}_SetSystemRunMethod(){const plugin=this._systemPlugin;
const bindThis=this._systemPlugin;this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSystem)}_SetSingleGlobalRunMethod(){const plugin=this._objectClass.GetPlugin();const bindThis=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){const eventSheetManager=this._eventBlock.GetEventSheetManager();const functionBlock=eventSheetManager.GetFunctionBlockByName(this._callFunctionName);if(functionBlock.IsEnabled()){const isCopyPicked=
(this._flags&FLAG_COPYPICKED)!==0;this._callEventBlock=functionBlock.GetEventBlock();let combinedSolModifiers=[...(new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents()]))];combinedSolModifiers=eventSheetManager._DeduplicateSolModifierList(combinedSolModifiers);const pickInfo=!functionBlock.IsCopyPicked()&&this._HasCopyPickedParent()?{pushCleanSolDynamic:true}:null;this.Run=C3.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,
combinedSolModifiers,this._parameters,isCopyPicked,pickInfo);if(this._runtime.IsDebug()){const thiz=this;this.DebugRun=function*DebugRunCallFunction(){if(thiz.IsBreakpoint()||thiz._runtime.DebugBreakNext())yield thiz;const ret=yield*thiz._callEventBlock.DebugRunAsFunctionCall(combinedSolModifiers,thiz._parameters,isCopyPicked,pickInfo);return ret}}else this.DebugRun=noopGenerator}else{this.Run=noop;this.DebugRun=noopGenerator}}_SetCallCustomActionRunMethod(){const eventSheetManager=this._eventBlock.GetEventSheetManager();
const customAceBlock=eventSheetManager.GetCustomActionBlockByName(this._callCustomAceObjectClass,this._callFunctionName);if(customAceBlock.IsEnabled()){const isCopyPicked=(this._flags&FLAG_COPYPICKED)!==0;this._callEventBlock=customAceBlock.GetEventBlock();let combinedSolModifiers=[...(new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents(),this._objectClass,customAceBlock.GetObjectClass()]))];combinedSolModifiers=eventSheetManager._DeduplicateSolModifierList(combinedSolModifiers);
const isOTtoOT=!this._objectClass.IsFamily()&&!customAceBlock.GetObjectClass().IsFamily();const isOTtoFamily=!this._objectClass.IsFamily()&&customAceBlock.GetObjectClass().IsFamily();const isFamilyToFamily=this._objectClass.IsFamily();let pickInfo=null;if(!customAceBlock.IsCopyPicked()&&this._HasCopyPickedParent()){pickInfo=pickInfo||{};pickInfo.pushCleanSolDynamic=true}if(isOTtoFamily||!isCopyPicked){pickInfo=pickInfo||{};pickInfo.copyFromObjectClass=this._objectClass;pickInfo.copyToObjectClass=
customAceBlock.GetObjectClass()}if(isOTtoOT||isOTtoFamily||isFamilyToFamily&&!customAceBlock.HasCustomACEOverrides())this.Run=C3.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,combinedSolModifiers,this._parameters,isCopyPicked,pickInfo);else if(isFamilyToFamily)this.Run=C3.FunctionBlock.prototype.RunAsFamilyCustomActionWithOverrides.bind(customAceBlock,combinedSolModifiers,this._parameters);else;if(this._runtime.IsDebug()){const thiz=this;if(isOTtoOT||isOTtoFamily||isFamilyToFamily&&
!customAceBlock.HasCustomACEOverrides())this.DebugRun=function*DebugRunCustomAction(){if(thiz.IsBreakpoint()||thiz._runtime.DebugBreakNext())yield thiz;const ret=yield*thiz._callEventBlock.DebugRunAsFunctionCall(combinedSolModifiers,thiz._parameters,isCopyPicked,pickInfo);return ret};else if(isFamilyToFamily)this.DebugRun=function*DebugRunCustomAction(){if(thiz.IsBreakpoint()||thiz._runtime.DebugBreakNext())yield thiz;const ret=yield*customAceBlock.DebugRunAsFamilyCustomActionWithOverrides(combinedSolModifiers,
thiz._parameters);return ret}}else this.DebugRun=noopGenerator}else{this.Run=noop;this.DebugRun=noopGenerator}}_SetRunMethodForBoundFunc(plugin,bindThis,fallbackMethod){const func=this._func;const parameters=this._parameters;if(parameters.length===0)this.Run=plugin._GetBoundACEMethod(func,bindThis);else if(parameters.length===1){const param0=parameters[0];if(param0.IsConstant())this.Run=plugin._GetBoundACEMethod_1param(func,bindThis,param0.Get(0));else{const boundFunc=plugin._GetBoundACEMethod(func,
bindThis);this.Run=function RunSingleAct_1param(){return boundFunc(param0.Get(0))}}}else if(parameters.length===2){const param0=parameters[0];const param1=parameters[1];if(param0.IsConstant()&&param1.IsConstant())this.Run=plugin._GetBoundACEMethod_2params(func,bindThis,param0.Get(0),param1.Get(0));else{const boundFunc=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleAct_2params(){return boundFunc(param0.Get(0),param1.Get(0))}}}else if(parameters.length===3){const param0=parameters[0];
const param1=parameters[1];const param2=parameters[2];if(param0.IsConstant()&&param1.IsConstant()&&param2.IsConstant())this.Run=plugin._GetBoundACEMethod_3params(func,bindThis,param0.Get(0),param1.Get(0),param2.Get(0));else{const boundFunc=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleAct_3params(){return boundFunc(param0.Get(0),param1.Get(0),param2.Get(0))}}}else this.Run=fallbackMethod}GetSID(){return this._sid}IsAsync(){return(this._flags&FLAG_IS_ASYNC)!==0}CanBailOut(){return this._actionType===
1}CallBeforeAfterHooks(){return this._actionType===2}IsStatic(){return this._actionType===3}CanPickAnyObjectClass(){return(this._flags&FLAG_CANPICKANYOBJECTCLASS)!==0}HasReturnType(){return this.IsAsync()||this.CanBailOut()}GetObjectClass(){return this._objectClass}GetImplementationAddon(){if(this._behaviorType)return this._behaviorType.GetBehavior();else if(this._objectClass)return this._objectClass.GetPlugin();else return null}GetImplementationSdkVersion(){const addon=this.GetImplementationAddon();
return addon?addon.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}_HasCopyPickedParent(){let parent=this._eventBlock;do{if(parent instanceof C3.FunctionBlock&&parent.IsCopyPicked())return true;parent=parent.GetScopeParent()}while(parent);return false}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(b){this._debugData.isBreakpoint=!!b;this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&
!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){if(!this._savedData)this._savedData=new Map;return this._savedData}GetUnsavedDataMap(){if(!this._unsavedData)this._unsavedData=new Map;return this._unsavedData}_RunSystem(){const results=this._results;EvalParams(this._parameters,results);return this._func.apply(this._systemPlugin,results)}*_DebugRunSystem(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=
this._results;EvalParams(this._parameters,results);const ret=yield*this._func.apply(this._systemPlugin,results);return ret}else return this.Run()}_RunSingleGlobal(){const results=this._results;EvalParams(this._parameters,results);return this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),results)}*_DebugRunSingleGlobal(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=this._results;EvalParams(this._parameters,
results);const ret=yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),results);return ret}else return this.Run()}_RunObject_ParamsConst(){const results=this._results;const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,len=instances.length;i<len;++i)this._func.apply(instances[i].GetSdkInstance(),results)}*_DebugRunObject_ParamsConst(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=
this._results;const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,len=instances.length;i<len;++i)yield*this._func.apply(instances[i].GetSdkInstance(),results)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){const results=this._results;EvalParams(this._parameters,results);const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,len=instances.length;i<len;++i)this._func.apply(instances[i].GetSdkInstance(),results)}*_DebugRunObject_ParamsDontVary(){if(this.IsBreakpoint()||
this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=this._results;EvalParams(this._parameters,results);const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,len=instances.length;i<len;++i)yield*this._func.apply(instances[i].GetSdkInstance(),results)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){const parameters=this._parameters;const results=this._results;const func=this._func;const instances=this._objectClass.GetCurrentSol().GetInstances();
for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);func.apply(inst.GetSdkInstance(),results)}}*_DebugRunObject_AllParamsVary(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const parameters=this._parameters;const results=this._results;const func=this._func;const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,len=instances.length;i<
len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);yield*func.apply(inst.GetSdkInstance(),results)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){const parameters=this._parameters;const results=this._results;const func=this._func;const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,len=parameters.length;i<len;++i){const p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0)}for(let i=0,len=
instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j){const p=parameters[j];if(p.VariesPerInstance())results[j]=p.Get(i)}func.apply(inst.GetSdkInstance(),results)}}*_DebugRunObject_SomeParamsVary(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const parameters=this._parameters;const results=this._results;const func=this._func;const instances=this._objectClass.GetCurrentSol().GetInstances();for(let i=
0,len=parameters.length;i<len;++i){const p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0)}for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j){const p=parameters[j];if(p.VariesPerInstance())results[j]=p.Get(i)}yield*func.apply(inst.GetSdkInstance(),results)}}else this._RunObject_SomeParamsVary()}_RunObject_BeforeAfterHooks(){const parameters=this._parameters;const results=this._results;const func=this._func;const objectClass=
this._objectClass;const sdkType=objectClass.GetSdkType();const instances=objectClass.GetCurrentSol().GetInstances();sdkType.BeforeRunAction(func);for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);func.apply(inst.GetSdkInstance(),results)}sdkType.AfterRunAction(func)}*_DebugRunObject_BeforeAfterHooks(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const parameters=
this._parameters;const results=this._results;const func=this._func;const objectClass=this._objectClass;const sdkType=objectClass.GetSdkType();const instances=objectClass.GetCurrentSol().GetInstances();sdkType.BeforeRunAction(func);for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);yield*func.apply(inst.GetSdkInstance(),results)}sdkType.AfterRunAction(func)}else this._RunObject_BeforeAfterHooks()}_RunObject_Static(){const results=
this._results;EvalParams(this._parameters,results);return this._func.apply(this._behaviorType||this._objectClass,results)}*_DebugRunObject_Static(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const results=this._results;EvalParams(this._parameters,results);let ret=this._func.apply(this._behaviorType||this._objectClass,results);if(C3.IsIterator(ret))ret=yield*ret;return ret}else return this._RunObject_Static()}_RunBehavior(){const objectClass=
this._objectClass;const isFamily=objectClass.IsFamily();const familyIndex=objectClass.GetFamilyIndex();const parameters=this._parameters;const paramsVary=this._anyParamVariesPerInstance;const results=this._results;const func=this._func;const behaviorIndex=this._behaviorIndex;const instances=objectClass.GetCurrentSol().GetInstances();for(let i=0,len=parameters.length;i<len;++i){const p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0)}for(let i=0,len=instances.length;i<len;++i){const inst=
instances[i];if(paramsVary)for(let j=0,lenj=parameters.length;j<lenj;++j){const p=parameters[j];if(p.VariesPerInstance())results[j]=p.Get(i)}const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results)}}*_DebugRunBehavior(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const objectClass=this._objectClass;const isFamily=objectClass.IsFamily();
const familyIndex=objectClass.GetFamilyIndex();const parameters=this._parameters;const paramsVary=this._anyParamVariesPerInstance;const results=this._results;const func=this._func;const behaviorIndex=this._behaviorIndex;const instances=objectClass.GetCurrentSol().GetInstances();for(let i=0,len=parameters.length;i<len;++i){const p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0)}for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];if(paramsVary)for(let j=0,lenj=parameters.length;j<
lenj;++j){const p=parameters[j];if(p.VariesPerInstance())results[j]=p.Get(i)}const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;yield*func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results)}}else this._RunBehavior()}_RunObject_Async(){const parameters=this._parameters;const results=this._results;const func=this._func;const instances=this._objectClass.GetCurrentSol().GetInstances();const promises=[];for(let i=0,len=instances.length;i<len;++i){const inst=
instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);promises.push(func.apply(inst.GetSdkInstance(),results))}return Promise.all(promises)}*_DebugRunObject_Async(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;if(this._DebugReturnsGenerator()){const parameters=this._parameters;const results=this._results;const func=this._func;const instances=this._objectClass.GetCurrentSol().GetInstances();const promises=[];for(let i=0,len=instances.length;i<
len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);promises.push(yield*func.apply(inst.GetSdkInstance(),results))}return Promise.all(promises)}else return this._RunObject_Async()}_RunBehavior_Async(){const objectClass=this._objectClass;const isFamily=objectClass.IsFamily();const familyIndex=objectClass.GetFamilyIndex();const parameters=this._parameters;const results=this._results;const func=this._func;const behaviorIndex=this._behaviorIndex;
const instances=objectClass.GetCurrentSol().GetInstances();const promises=[];for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;promises.push(func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results))}return Promise.all(promises)}*_DebugRunBehavior_Async(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;
if(this._DebugReturnsGenerator()){const objectClass=this._objectClass;const isFamily=objectClass.IsFamily();const familyIndex=objectClass.GetFamilyIndex();const parameters=this._parameters;const results=this._results;const func=this._func;const behaviorIndex=this._behaviorIndex;const instances=objectClass.GetCurrentSol().GetInstances();const promises=[];for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];for(let j=0,lenj=parameters.length;j<lenj;++j)results[j]=parameters[j].Get(i);
const offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;promises.push(yield*func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results))}return Promise.all(promises)}else return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(err){console.error(`Unhandled exception running script %c${this._eventBlock.GetEventSheet().GetName()}, event ${this._eventBlock.GetDisplayNumber()}, action ${this.GetDebugIndex()+1}:`,"font-size: 1.2em; font-weight: bold;",
err);if(self.C3Debugger)self.C3Debugger._SetLastErrorScript(this);if(!C3.EventScript.HadUserScriptException()){console.info(`%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()`,"font-weight: bold; text-decoration: underline","","font-weight: bold");C3.EventScript.SetHadUserScriptException()}}}*DebugRunUserScript(){if(this.IsBreakpoint()||this._runtime.DebugBreakNext())yield this;return this.RunUserScript()}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;
return{"ex":C3.ToSuperJSON(this._savedData)}}_LoadFromJson(o){if(this._savedData){this._savedData.clear();this._savedData=null}if(!o)return;const ex=o["ex"];if(ex)this._savedData=C3.FromSuperJSON(ex)}};

}

// events/commonACEs.js
{
'use strict';const C3=self.C3;const tempColor=new C3.Color;let runtime=null;C3.CommonACES_SetRuntime=function CommonACES_SetRuntime(runtime_){runtime=runtime_};function GetInst(inst){if(inst instanceof self.IInstance)return runtime._UnwrapScriptInterface(inst);else return inst.GetInstance()}function GetWorldInfo(inst){return GetInst(inst).GetWorldInfo()}function CompareX(cmp,x){return C3.compare(GetWorldInfo(this).GetX(),cmp,x)}
function CompareY(cmp,y){return C3.compare(GetWorldInfo(this).GetY(),cmp,y)}function IsOnScreen(){return GetWorldInfo(this).IsInViewport2()}function IsOutsideLayout(){const wi=GetWorldInfo(this);const layout=wi.GetLayout();const bbox=wi.GetBoundingBox();return bbox.getRight()<0||bbox.getBottom()<0||bbox.getLeft()>layout.GetWidth()||bbox.getTop()>layout.GetHeight()}
function PickDistance(which,x,y){const sol=this.GetCurrentSol();const instances=sol.GetInstances();if(!instances.length)return false;let inst=instances[0];let wi=inst.GetWorldInfo();let pickme=inst;let dist2=C3.distanceSquared(wi.GetX(),wi.GetY(),x,y);for(let i=1,len=instances.length;i<len;++i){inst=instances[i];wi=inst.GetWorldInfo();const d2=C3.distanceSquared(wi.GetX(),wi.GetY(),x,y);if(which===0&&d2<dist2||which===1&&d2>dist2){dist2=d2;pickme=inst}}sol.PickOne(pickme);return true}
function SetX(x){const wi=GetWorldInfo(this);if(wi.GetX()===x)return;wi.SetX(x);wi.SetBboxChanged()}function SetY(y){const wi=GetWorldInfo(this);if(wi.GetY()===y)return;wi.SetY(y);wi.SetBboxChanged()}function SetPos(x,y){const wi=GetWorldInfo(this);if(wi.EqualsXY(x,y))return;wi.SetXY(x,y);wi.SetBboxChanged()}
function SetPosToObject(objectClass,imgPt){if(!objectClass)return;const inst=GetInst(this);const otherInst=objectClass.GetPairedInstance(inst);if(!otherInst)return;const [x,y]=otherInst.GetImagePoint(imgPt);const wi=inst.GetWorldInfo();if(wi.GetX()===x&&wi.GetY()===y)return;wi.SetXY(x,y);wi.SetBboxChanged()}function MoveForward(dist){if(dist===0)return;const wi=GetWorldInfo(this);wi.OffsetXY(wi.GetCosAngle()*dist,wi.GetSinAngle()*dist);wi.SetBboxChanged()}
function MoveAtAngle(a,dist){if(dist===0)return;const wi=GetWorldInfo(this);a=C3.toRadians(a);wi.OffsetXY(Math.cos(a)*dist,Math.sin(a)*dist);wi.SetBboxChanged()}function GetX(){return GetWorldInfo(this).GetX()}function GetY(){return GetWorldInfo(this).GetY()}function GetDt(){const inst=GetInst(this);return inst.GetRuntime().GetDt(inst)}function CompareWidth(cmp,w){return C3.compare(GetWorldInfo(this).GetWidth(),cmp,w)}
function CompareHeight(cmp,h){return C3.compare(GetWorldInfo(this).GetHeight(),cmp,h)}function SetWidth(w){const wi=GetWorldInfo(this);if(wi.GetWidth()===w)return;wi.SetWidth(w);wi.SetBboxChanged()}function SetHeight(h){const wi=GetWorldInfo(this);if(wi.GetHeight()===h)return;wi.SetHeight(h);wi.SetBboxChanged()}function SetSize(w,h){const wi=GetWorldInfo(this);if(wi.GetWidth()===w&&wi.GetHeight()===h)return;wi.SetSize(w,h);wi.SetBboxChanged()}
function GetWidth(){return GetWorldInfo(this).GetWidth()}function GetHeight(){return GetWorldInfo(this).GetHeight()}function GetBboxLeft(){return GetWorldInfo(this).GetBoundingBox().getLeft()}function GetBboxTop(){return GetWorldInfo(this).GetBoundingBox().getTop()}function GetBboxRight(){return GetWorldInfo(this).GetBoundingBox().getRight()}function GetBboxBottom(){return GetWorldInfo(this).GetBoundingBox().getBottom()}
function GetBboxMidX(){const bbox=GetWorldInfo(this).GetBoundingBox();return(bbox.getLeft()+bbox.getRight())/2}function GetBboxMidY(){const bbox=GetWorldInfo(this).GetBoundingBox();return(bbox.getTop()+bbox.getBottom())/2}function IsAngleWithin(within,a){return C3.angleDiff(GetWorldInfo(this).GetAngle(),C3.toRadians(a))<=C3.toRadians(within)}function IsAngleClockwiseFrom(a){return C3.angleClockwise(GetWorldInfo(this).GetAngle(),C3.toRadians(a))}
function IsBetweenAngles(a,b){const lower=C3.toRadians(a);const upper=C3.toRadians(b);const angle=GetWorldInfo(this).GetAngle();const obtuse=!C3.angleClockwise(upper,lower);if(obtuse)return!(!C3.angleClockwise(angle,lower)&&C3.angleClockwise(angle,upper));else return C3.angleClockwise(angle,lower)&&!C3.angleClockwise(angle,upper)}
function SetAngle(a){const wi=GetWorldInfo(this);const newAngle=C3.clampAngle(C3.toRadians(a));if(isNaN(newAngle)||wi.GetAngle()===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged()}function RotateClockwise(a){if(isNaN(a)||a===0)return;const wi=GetWorldInfo(this);wi.SetAngle(wi.GetAngle()+C3.toRadians(a));wi.SetBboxChanged()}function RotateCounterclockwise(a){if(isNaN(a)||a===0)return;const wi=GetWorldInfo(this);wi.SetAngle(wi.GetAngle()-C3.toRadians(a));wi.SetBboxChanged()}
function RotateTowardAngle(amt,target){const wi=GetWorldInfo(this);const a=wi.GetAngle();const newAngle=C3.angleRotate(a,C3.toRadians(target),C3.toRadians(amt));if(isNaN(newAngle)||a===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged()}
function RotateTowardPosition(amt,x,y){const wi=GetWorldInfo(this);const a=wi.GetAngle();const dx=x-wi.GetX();const dy=y-wi.GetY();const target=Math.atan2(dy,dx);const newAngle=C3.angleRotate(a,target,C3.toRadians(amt));if(isNaN(newAngle)||a===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged()}
function SetTowardPosition(x,y){const wi=GetWorldInfo(this);const a=wi.GetAngle();const dx=x-wi.GetX();const dy=y-wi.GetY();const newAngle=Math.atan2(dy,dx);if(isNaN(newAngle)||a===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged()}function GetAngle(){return C3.toDegrees(GetWorldInfo(this).GetAngle())}function CompareOpacity(cmp,x){return C3.compare(C3.roundToDp(GetWorldInfo(this).GetOpacity()*100,6),cmp,x)}function IsVisible(){return GetWorldInfo(this).IsVisible()}
function SetVisible(v){const inst=GetInst(this);const wi=inst.GetWorldInfo();if(v===2)v=!wi.IsVisible();else v=v!==0;if(wi.IsVisible()===v)return;wi.SetVisible(v);inst.GetRuntime().UpdateRender()}
function SetOpacity(o){const newOpacity=C3.clamp(o/100,0,1);const inst=GetInst(this);const wi=inst.GetWorldInfo();if(wi.GetTransformWithParentOpacity()){if(wi._GetSceneGraphInfo().GetOwnOpacity()===newOpacity)return}else if(wi.GetOpacity()===newOpacity)return;wi.SetOpacity(newOpacity);inst.GetRuntime().UpdateRender()}
function SetDefaultColor(rgb){tempColor.setFromRgbValue(rgb);const inst=GetInst(this);const wi=inst.GetWorldInfo();if(wi.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor))return;wi.SetUnpremultipliedColor(tempColor);inst.GetRuntime().UpdateRender()}function GetColor(){const c=GetWorldInfo(this).GetUnpremultipliedColor();return C3.PackRGBAEx(c.getR(),c.getG(),c.getB(),c.getA())}function GetOpacity(){return C3.roundToDp(GetWorldInfo(this).GetOpacity()*100,6)}
function IsOnLayer(layer){if(!layer)return false;return GetWorldInfo(this).GetLayer()===layer}
function PickTopBottom(which){const sol=this.GetCurrentSol();const instances=sol.GetInstances();if(!instances.length)return false;let inst=instances[0];let pickme=inst;for(let i=1,len=instances.length;i<len;++i){const inst=instances[i];const instWi=inst.GetWorldInfo();const pickmeWi=pickme.GetWorldInfo();const instLayerIndex=instWi.GetLayer().GetIndex();const pickmeLayerIndex=pickmeWi.GetLayer().GetIndex();if(which===0){if(instLayerIndex>pickmeLayerIndex||instLayerIndex===pickmeLayerIndex&&instWi.GetZIndex()>
pickmeWi.GetZIndex())pickme=inst}else if(instLayerIndex<pickmeLayerIndex||instLayerIndex===pickmeLayerIndex&&instWi.GetZIndex()<pickmeWi.GetZIndex())pickme=inst}sol.PickOne(pickme);return true}function CompareZElevation(which,cmp,value){const wi=GetWorldInfo(this);const z=which===0?wi.GetZElevation():wi.GetTotalZElevation();return C3.compare(z,cmp,value)}function MoveToTop(){GetWorldInfo(this).ZOrderMoveToTop()}function MoveToBottom(){GetWorldInfo(this).ZOrderMoveToBottom()}
function MoveToLayer(layerMove){if(!layerMove)return;GetWorldInfo(this).ZOrderMoveToLayer(layerMove)}function ZMoveToObject(where,objectClass){const isAfter=where===0;if(!objectClass)return;const inst=GetInst(this);const otherInst=objectClass.GetFirstPicked(inst);if(!otherInst)return;inst.GetWorldInfo().ZOrderMoveAdjacentToInstance(otherInst,isAfter)}
function SetZElevation(z){const inst=GetInst(this);const wi=inst.GetWorldInfo();if(wi.GetZElevation()===z)return;wi.SetZElevation(z);inst.GetRuntime().UpdateRender()}function LayerNumber(){return GetWorldInfo(this).GetLayer().GetIndex()}function LayerName(){return GetWorldInfo(this).GetLayer().GetName()}function ZIndex(){return GetWorldInfo(this).GetZIndex()}function ZElevation(){return GetWorldInfo(this).GetZElevation()}function TotalZElevation(){return GetWorldInfo(this).GetTotalZElevation()}
function IsEffectEnabled(effectName){const inst=GetInst(this);const effectType=inst.GetObjectClass().GetEffectList().GetEffectTypeByName(effectName);if(!effectType)return;const effectTypeIndex=effectType.GetIndex();const instFxList=inst.GetWorldInfo().GetInstanceEffectList();return instFxList.IsEffectIndexActive(effectTypeIndex)}
function SetEffectEnabled(enabled,effectName){const inst=GetInst(this);const effectType=inst.GetObjectClass().GetEffectList().GetEffectTypeByName(effectName);if(!effectType)return;const effectTypeIndex=effectType.GetIndex();const e=enabled===1;const instFxList=inst.GetWorldInfo().GetInstanceEffectList();if(instFxList.IsEffectIndexActive(effectTypeIndex)===e)return;instFxList.SetEffectIndexActive(effectTypeIndex,e);instFxList.UpdateActiveEffects();inst.GetRuntime().UpdateRender()}
function SetEffectParam(effectName,paramIndex,value){const inst=GetInst(this);const effectType=inst.GetObjectClass().GetEffectList().GetEffectTypeByName(effectName);if(!effectType)return;paramIndex=Math.floor(paramIndex);const paramType=effectType.GetShaderProgram().GetParameterType(paramIndex);if(!paramType)return;if(paramType==="color"){tempColor.setFromRgbValue(value);value=tempColor}else if(paramType==="percent")value/=100;const effectTypeIndex=effectType.GetIndex();const instFxList=inst.GetWorldInfo().GetInstanceEffectList();
const didChange=instFxList.SetEffectParameter(effectTypeIndex,paramIndex,value);if(didChange&&instFxList.IsEffectIndexActive(effectTypeIndex))inst.GetRuntime().UpdateRender()}const tempRect=C3.New(C3.Rect);const tempCandidates1=[];const tempCandidates2=[];let needsCollisionFinish=false;let rPickType=null;let rPickFromElseInstances=false;const rToPick=new Set;
function CollMemory_Add(collMemory,a,b,tickCount){const a_uid=a.GetUID();const b_uid=b.GetUID();if(a_uid<b_uid)collMemory.Set(a,b,tickCount);else collMemory.Set(b,a,tickCount)}function CollMemory_Remove(collMemory,a,b){const a_uid=a.GetUID();const b_uid=b.GetUID();if(a_uid<b_uid)collMemory.Delete(a,b);else collMemory.Delete(b,a)}function CollMemory_RemoveInstance(collMemory,inst){collMemory.DeleteEither(inst)}
function CollMemory_Get(collMemory,a,b){const a_uid=a.GetUID();const b_uid=b.GetUID();if(a_uid<b_uid)return collMemory.Get(a,b);else return collMemory.Get(b,a)}
function DoOverlapCondition(inst,rtype,offX,offY){if(!rtype)return false;const hasOffset=offX!==0||offY!==0;const wi=inst.GetWorldInfo();const runtime=inst.GetRuntime();const collisionEngine=runtime.GetCollisionEngine();const cnd=runtime.GetCurrentCondition();const isOrBlock=cnd.GetEventBlock().IsOrBlock();const ltype=cnd.GetObjectClass();const isInverted=cnd.IsInverted();const rsol=rtype.GetCurrentSol();const isDifferentTypes=ltype!==rtype;rPickType=rtype;needsCollisionFinish=isDifferentTypes&&!isInverted;
rPickFromElseInstances=false;let rinstances;let oldX=0;let oldY=0;let ret=false;if(rsol.IsSelectAll()){tempRect.copy(wi.GetBoundingBox());tempRect.offset(offX,offY);collisionEngine.GetCollisionCandidates(wi.GetLayer(),rtype,tempRect,tempCandidates2);rinstances=tempCandidates2}else if(isOrBlock)if(runtime.IsCurrentConditionFirst()&&!rsol._GetOwnElseInstances().length&&rsol._GetOwnInstances().length)rinstances=rsol._GetOwnInstances();else{rinstances=rsol._GetOwnElseInstances();rPickFromElseInstances=
true}else rinstances=rsol._GetOwnInstances();if(hasOffset){oldX=wi.GetX();oldY=wi.GetY();wi.OffsetXY(offX,offY);wi.SetBboxChanged()}for(const rinst of rinstances)if(collisionEngine.TestOverlap(inst,rinst)){ret=true;if(isInverted)break;if(isDifferentTypes)rToPick.add(rinst)}if(hasOffset){wi.SetXY(oldX,oldY);wi.SetBboxChanged()}C3.clearArray(tempCandidates2);return ret}
function FinishCollisionConditionPicking(type){const isOrBlock=type.GetRuntime().GetCurrentEvent().IsOrBlock();const sol=rPickType.GetCurrentSol();const solInstances=sol._GetOwnInstances();const solElseInstances=sol._GetOwnElseInstances();if(sol.IsSelectAll()){sol.SetSetPicked(rToPick);if(isOrBlock){C3.clearArray(solElseInstances);sol.AddElseInstances(rToPick,rPickType.GetInstances())}}else if(isOrBlock)if(rPickFromElseInstances)sol.TransferElseInstancesToOwn(rToPick);else{sol.AddElseInstances(rToPick,
solInstances);sol.SetSetPicked(rToPick)}else sol.SetSetPicked(rToPick);rPickType.ApplySolToContainer()}function FinishCollisionCondition(type,doPick){if(!needsCollisionFinish)return;if(doPick)FinishCollisionConditionPicking(type);rToPick.clear();rPickType=null;needsCollisionFinish=false}
function OnCollision(rtype){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,rtype);if(!rtype)return false;const runtime=this._runtime;const collisionEngine=runtime.GetCollisionEngine();const eventSheetManager=runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const cnd=eventSheetManager.GetCurrentCondition();const ltype=cnd.GetObjectClass();const savedData=cnd.GetSavedDataMap();const unsavedData=cnd.GetUnsavedDataMap();const oldFrame=eventStack.GetCurrentStackFrame();
const tickCount=runtime.GetTickCount();const lastTickCount=tickCount-1;const currentEvent=oldFrame.GetCurrentEvent();const newFrame=eventStack.Push(currentEvent);let collMemory=savedData.get("collmemory");if(!collMemory){collMemory=C3.New(C3.PairMap);savedData.set("collmemory",collMemory)}if(!unsavedData.get("collisionCreatedDestroyCallback")){unsavedData.set("collisionCreatedDestroyCallback",true);runtime.Dispatcher().addEventListener("instancedestroy",e=>CollMemory_RemoveInstance(collMemory,e.instance))}const lsol=
ltype.GetCurrentSol();const rsol=rtype.GetCurrentSol();const linstances=lsol.GetInstances();let rinstances=null;for(let l=0;l<linstances.length;++l){const linst=linstances[l];if(rsol.IsSelectAll()){collisionEngine.GetCollisionCandidates(linst.GetWorldInfo().GetLayer(),rtype,linst.GetWorldInfo().GetBoundingBox(),tempCandidates1);rinstances=tempCandidates1;collisionEngine.AddRegisteredCollisionCandidates(linst,rtype,rinstances)}else rinstances=rsol.GetInstances();for(let r=0;r<rinstances.length;++r){const rinst=
rinstances[r];if(collisionEngine.TestOverlap(linst,rinst)||collisionEngine.CheckRegisteredCollision(linst,rinst)){const entry=CollMemory_Get(collMemory,linst,rinst);let entryExists=false;let lastCollTickCount=-2;if(typeof entry==="number"){entryExists=true;lastCollTickCount=entry}const shouldRun=!entryExists||lastCollTickCount<lastTickCount;CollMemory_Add(collMemory,linst,rinst,tickCount);if(shouldRun){const solModifiers=currentEvent.GetSolModifiers();eventSheetManager.PushCopySol(solModifiers);const curlsol=
ltype.GetCurrentSol();const currsol=rtype.GetCurrentSol();curlsol._SetSelectAll(false);currsol._SetSelectAll(false);if(ltype===rtype){const solInstances=curlsol._GetOwnInstances();C3.clearArray(solInstances);solInstances.push(linst);solInstances.push(rinst);ltype.ApplySolToContainer()}else{const lsolInstances=curlsol._GetOwnInstances();const rsolInstances=currsol._GetOwnInstances();C3.clearArray(lsolInstances);C3.clearArray(rsolInstances);lsolInstances.push(linst);rsolInstances.push(rinst);ltype.ApplySolToContainer();
rtype.ApplySolToContainer()}currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}}else CollMemory_Remove(collMemory,linst,rinst)}C3.clearArray(tempCandidates1)}eventStack.Pop();return false}
function*DebugOnCollision(rtype){if(!rtype)return false;const runtime=this._runtime;const collisionEngine=runtime.GetCollisionEngine();const eventSheetManager=runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const cnd=eventSheetManager.GetCurrentCondition();const ltype=cnd.GetObjectClass();const savedData=cnd.GetSavedDataMap();const unsavedData=cnd.GetUnsavedDataMap();const oldFrame=eventStack.GetCurrentStackFrame();const tickCount=runtime.GetTickCount();const lastTickCount=
tickCount-1;const currentEvent=oldFrame.GetCurrentEvent();const newFrame=eventStack.Push(currentEvent);let collMemory=savedData.get("collmemory");if(!collMemory){collMemory=C3.New(C3.PairMap);savedData.set("collmemory",collMemory)}if(!unsavedData.get("collisionCreatedDestroyCallback")){unsavedData.set("collisionCreatedDestroyCallback",true);runtime.Dispatcher().addEventListener("instancedestroy",e=>CollMemory_RemoveInstance(collMemory,e.instance))}const lsol=ltype.GetCurrentSol();const rsol=rtype.GetCurrentSol();
const linstances=lsol.GetInstances();let rinstances=null;for(let l=0;l<linstances.length;++l){const linst=linstances[l];if(rsol.IsSelectAll()){collisionEngine.GetCollisionCandidates(linst.GetWorldInfo().GetLayer(),rtype,linst.GetWorldInfo().GetBoundingBox(),tempCandidates1);rinstances=tempCandidates1;collisionEngine.AddRegisteredCollisionCandidates(linst,rtype,rinstances)}else rinstances=rsol.GetInstances();for(let r=0;r<rinstances.length;++r){const rinst=rinstances[r];if(collisionEngine.TestOverlap(linst,
rinst)||collisionEngine.CheckRegisteredCollision(linst,rinst)){const entry=CollMemory_Get(collMemory,linst,rinst);let entryExists=false;let lastCollTickCount=-2;if(typeof entry==="number"){entryExists=true;lastCollTickCount=entry}const shouldRun=!entryExists||lastCollTickCount<lastTickCount;CollMemory_Add(collMemory,linst,rinst,tickCount);if(shouldRun){const solModifiers=currentEvent.GetSolModifiers();eventSheetManager.PushCopySol(solModifiers);const curlsol=ltype.GetCurrentSol();const currsol=rtype.GetCurrentSol();
curlsol._SetSelectAll(false);currsol._SetSelectAll(false);if(ltype===rtype){const solInstances=curlsol._GetOwnInstances();C3.clearArray(solInstances);solInstances.push(linst);solInstances.push(rinst);ltype.ApplySolToContainer()}else{const lsolInstances=curlsol._GetOwnInstances();const rsolInstances=currsol._GetOwnInstances();C3.clearArray(lsolInstances);C3.clearArray(rsolInstances);lsolInstances.push(linst);rsolInstances.push(rinst);ltype.ApplySolToContainer();rtype.ApplySolToContainer()}yield*currentEvent.DebugRetrigger(oldFrame,
newFrame);eventSheetManager.PopSol(solModifiers)}}else CollMemory_Remove(collMemory,linst,rinst)}C3.clearArray(tempCandidates1)}eventStack.Pop();return false}function IsOverlapping(rtype){return DoOverlapCondition(GetInst(this),rtype,0,0)}function IsOverlappingOffset(rtype,offX,offY){return DoOverlapCondition(GetInst(this),rtype,offX,offY)}function HasParent(){return GetWorldInfo(this).HasParent()}function HasChildren(){return GetWorldInfo(this).HasChildren()}
function PickParent(parentObjectClass,which){const mySol=this.GetCurrentSol();const myInstances=mySol.GetInstances();if(myInstances.length===0)return false;const parentSol=parentObjectClass.GetCurrentSol();let parentInstances=parentSol.GetInstances();if(parentSol.IsSelectAll()){const parentInstsPendingCreate=[...this._runtime.instancesPendingCreateForObjectClass(parentObjectClass)];if(parentInstsPendingCreate.length>0)parentInstances=parentInstances.concat(parentInstsPendingCreate)}if(parentInstances.length===
0)return false;const parentInstancesSet=new Set(parentInstances);const pickParents=new Set;for(let i=0,len=myInstances.length;i<len;++i){const myInst=myInstances[i];if(which===1)for(const parentInst of myInst.parents()){if(parentInst.BelongsToObjectClass(parentObjectClass)&&parentInstancesSet.has(parentInst))pickParents.add(parentInst)}else{let parentInst;if(which===0){parentInst=myInst.GetParent();if(parentInst===null)continue}else parentInst=myInst.GetTopParent();if(parentInst.BelongsToObjectClass(parentObjectClass)&&
parentInstancesSet.has(parentInst))pickParents.add(parentInst)}}if(pickParents.size===0)return false;parentSol.SetSetPicked(pickParents);parentObjectClass.ApplySolToContainer();return true}
function PickChildren(childObjectClass,which){const mySol=this.GetCurrentSol();const myInstances=mySol.GetInstances();if(myInstances.length===0)return false;const childSol=childObjectClass.GetCurrentSol();let childInstances=childSol.GetInstances();if(childSol.IsSelectAll()){const childInstsPendingCreate=[...this._runtime.instancesPendingCreateForObjectClass(childObjectClass)];if(childInstsPendingCreate.length>0)childInstances=childInstances.concat(childInstsPendingCreate)}if(childInstances.length===
0)return false;const childInstancesSet=new Set(childInstances);const pickChildren=new Set;for(let i=0,len=myInstances.length;i<len;++i){const myInst=myInstances[i];if(which===2&&!myInst.HasChildren()&&myInst.BelongsToObjectClass(childObjectClass)&&childInstancesSet.has(myInst))pickChildren.add(myInst);for(const childInst of which===0?myInst.children():myInst.allChildren()){if(which===2&&childInst.HasChildren())continue;if(childInst.BelongsToObjectClass(childObjectClass)&&childInstancesSet.has(childInst))pickChildren.add(childInst)}}if(pickChildren.size===
0)return false;childSol.SetSetPicked(pickChildren);childObjectClass.ApplySolToContainer();return true}
function PickNthChild(childObjectClass,index){const mySol=this.GetCurrentSol();const myInstances=mySol.GetInstances();if(myInstances.length===0)return false;const childSol=childObjectClass.GetCurrentSol();let childInstances=childSol.GetInstances();if(childSol.IsSelectAll()){const childInstsPendingCreate=[...this._runtime.instancesPendingCreateForObjectClass(childObjectClass)];if(childInstsPendingCreate.length>0)childInstances=childInstances.concat(childInstsPendingCreate)}if(childInstances.length===
0)return false;const childInstancesSet=new Set(childInstances);const pickChildren=[];for(let i=0,len=myInstances.length;i<len;++i){const myInst=myInstances[i];const childInst=myInst.GetChildAt(index);if(childInst!==null&&childInst.BelongsToObjectClass(childObjectClass)&&childInstancesSet.has(childInst))pickChildren.push(childInst)}if(pickChildren.length===0)return false;childSol.SetArrayPicked(pickChildren);childObjectClass.ApplySolToContainer();return true}
function CompareChildCount(which,cmp,count){const inst=GetInst(this);switch(which){case 0:default:{return C3.compare(inst.GetChildCount(),cmp,count)}case 1:{return C3.compare(inst.GetAllChildCount(),cmp,count)}}}
function AddChild(childObjectClass,transformX,transformY,transformWidth,transformHeight,transformAngle,transformOpacity,transformZElevation,transformVisibility,destroyWithParent){const inst=GetInst(this);const actObjectClass=inst.GetRuntime().GetCurrentAction().GetObjectClass();for(const child of childObjectClass.allCorrespondingInstances(inst,actObjectClass)){if(!child.GetPlugin().SupportsSceneGraph())return;inst.AddChild(child,{transformX,transformY,transformWidth,transformHeight,transformAngle,
transformOpacity,transformZElevation,transformVisibility,destroyWithParent})}}function RemoveChild(childObjectClass){const inst=GetInst(this);const actObjectClass=inst.GetRuntime().GetCurrentAction().GetObjectClass();for(const child of childObjectClass.allCorrespondingInstances(inst,actObjectClass))inst.RemoveChild(child)}function RemoveFromParent(){const inst=GetInst(this);if(!inst.HasParent())return;const parent=inst.GetParent();parent.RemoveChild(inst)}
function ChildCount(){return GetInst(this).GetChildCount()}function AllChildCount(){return GetInst(this).GetAllChildCount()}function SetMeshSize(cols,rows){cols=Math.floor(cols);rows=Math.floor(rows);const wi=GetWorldInfo(this);if(cols<2||rows<2||!isFinite(cols)||!isFinite(rows)){wi.ReleaseMesh();wi.SetBboxChanged()}else wi.CreateMesh(cols,rows)}
function SetMeshPoint(col,row,mode,posx,posy,zElevation,texu,texv){const wi=GetWorldInfo(this);const didBboxChange=wi.SetMeshPoint(col,row,{mode:mode===0?"absolute":"relative",x:posx,y:posy,zElevation,u:texu,v:texv});if(didBboxChange)wi.SetBboxChanged()}function MeshColumns(){const wi=GetWorldInfo(this);return wi.HasMesh()?wi.GetSourceMesh().GetHSize():0}function MeshRows(){const wi=GetWorldInfo(this);return wi.HasMesh()?wi.GetSourceMesh().GetVSize():0}
function SetElementVisible(v){const wi=GetWorldInfo(this);if(v===2)v=!wi.IsVisible();else v=v!==0;if(wi.IsVisible()===v)return;wi.SetVisible(v)}function SetElementCSSStyle(prop,val){if(this instanceof self.IInstance)this.setElementCSSStyle(prop,val);else this.SetElementCSSStyle(prop,val)}function SetElementAttribute(attribName,value){if(this instanceof self.IInstance)this.setElementAttribute(attribName,""+value);else this.SetElementAttribute(attribName,""+value)}
function RemoveElementAttribute(attribName){if(this instanceof self.IInstance)this.removeElementAttribute(attribName);else this.RemoveElementAttribute(attribName)}function SetElementFocus(){if(this instanceof self.IInstance)this.focusElement();else this.FocusElement()}function SetElementBlur(){if(this instanceof self.IInstance)this.blurElement();else this.BlurElement()}
function IsElementFocused(){if(this instanceof self.IInstance)return this.isElementFocused();else return this.IsElementFocused()}function SetElementEnabled(e){if(this instanceof self.IInstance)this._setEnabled(e!==0);else this._SetEnabled(e!==0)}function IsElementEnabled(){if(this instanceof self.IInstance)return this._isEnabled();else return this._IsEnabled()}function CompareInstanceVar(iv,cmp,val){return C3.compare(GetInst(this).GetInstanceVariableValue(iv),cmp,val)}
function IsBoolInstanceVarSet(iv){return!!GetInst(this).GetInstanceVariableValue(iv)}function TemplateName(){return GetInst(this).GetTemplateName()}
function PickInstVarHiLow(which,iv){const sol=this.GetCurrentSol();const instances=sol.GetInstances();if(!instances.length)return false;const isFamily=this.IsFamily();let pickInst=null;let bestVal=0;for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];const offset=isFamily?inst.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0;const v=inst.GetInstanceVariableValue(offset+iv);if(pickInst===null||which===0&&v<bestVal||which===1&&v>bestVal){bestVal=v;pickInst=inst}}sol.PickOne(pickInst);
return true}function PickByUID(uid){if(this._runtime.GetCurrentCondition().IsInverted())return PickByUID_Inverted(this,uid);else return PickByUID_Normal(this,uid)}
function PickByUID_Normal(objectClass,uid){const inst=objectClass.GetRuntime().GetInstanceByUID(uid);if(!inst)return false;const sol=objectClass.GetCurrentSol();if(!sol.IsSelectAll()&&!sol._GetOwnInstances().includes(inst))return false;if(objectClass.IsFamily()){if(inst.GetObjectClass().BelongsToFamily(objectClass)){sol.PickOne(inst);objectClass.ApplySolToContainer();return true}}else if(inst.GetObjectClass()===objectClass){sol.PickOne(inst);objectClass.ApplySolToContainer();return true}return false}
function PickByUID_Inverted(objectClass,uid){const sol=objectClass.GetCurrentSol();if(sol.IsSelectAll()){sol._SetSelectAll(false);sol.ClearArrays();const instances=objectClass.GetInstances();for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];if(inst.GetUID()===uid)sol._PushElseInstance(inst);else sol._PushInstance(inst)}objectClass.ApplySolToContainer();return!!sol._GetOwnInstances().length}else{const instances=sol._GetOwnInstances();let j=0;for(let i=0,len=instances.length;i<len;++i){const inst=
instances[i];instances[j]=inst;if(inst.GetUID()===uid)sol._PushElseInstance(inst);else++j}C3.truncateArray(instances,j);objectClass.ApplySolToContainer();return!!instances.length}}function Destroy(){const inst=GetInst(this);inst.GetRuntime().DestroyInstance(inst)}function OnCreated(){return true}function OnDestroyed(){return true}function SetInstanceVar(iv,value){GetInst(this).SetInstanceVariableValue(iv,value)}
function AddInstanceVar(iv,value){const inst=GetInst(this);const lastValue=inst.GetInstanceVariableValue(iv);if(typeof lastValue==="number"&&typeof value!=="number")value=parseFloat(value);else if(typeof lastValue==="string"&&typeof value!=="string")value=value.toString();inst.SetInstanceVariableValue(iv,lastValue+value)}
function SubInstanceVar(iv,value){const inst=GetInst(this);const lastValue=inst.GetInstanceVariableValue(iv);if(typeof lastValue!=="number")return;if(typeof value!=="number")value=parseFloat(value);inst.SetInstanceVariableValue(iv,lastValue-value)}function SetBoolInstanceVar(iv,value){GetInst(this).SetInstanceVariableValue(iv,value?1:0)}function ToggleBoolInstanceVar(iv){const inst=GetInst(this);inst.SetInstanceVariableValue(iv,inst.GetInstanceVariableValue(iv)===0?1:0)}
function LoadFromJsonString(str){let o;try{o=JSON.parse(str)}catch(err){console.error("Failed to load from JSON string: ",err);return}const inst=GetInst(this);const mode="state";inst.GetRuntime().ClearIntancesNeedingAfterLoad();inst._OnBeforeLoad(mode);inst.LoadFromJson(o,mode);inst.GetRuntime().DoAfterLoad(mode,{ignoreMissingInstances:true})}function AsJSON(){return JSON.stringify(GetInst(this).SaveToJson("state"))}function ObjectTypeName(){return GetInst(this).GetObjectClass().GetName()}
function Count(){const runtime=GetInst(this).GetRuntime();const expObjectClass=runtime.GetCurrentEventStackFrame().GetExpressionObjectClass();let count=expObjectClass.GetInstanceCount();for(const inst of runtime.instancesPendingCreateForObjectClass(expObjectClass))++count;return count}function PickedCount(){const runtime=GetInst(this).GetRuntime();return runtime.GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length}
function GetIID(){return GetInst(this).GetIID()}function GetUID(){return GetInst(this).GetUID()}
C3.AddCommonACEs=function AddCommonACEs(pluginData,pluginCtor){const isSingleGlobal=pluginData[1];const hasPositionACEs=pluginData[3];const hasSizeACEs=pluginData[4];const hasAngleACEs=pluginData[5];const hasAppearanceACEs=pluginData[6];const hasZOrderACEs=pluginData[7];const hasEffectsACEs=pluginData[8];const hasElementACEs=pluginData[10];const hasElementFocusACEs=pluginData[11];const hasElementEnabledACEs=pluginData[12];const hasSceneGraphACEs=pluginData[13];const hasMeshACEs=pluginData[14];const hasCollisionACEs=
pluginData[15];const hasTemplateACEs=pluginData[16];const Cnds=pluginCtor.Cnds;const Acts=pluginCtor.Acts;const Exps=pluginCtor.Exps;if(hasPositionACEs){Cnds.CompareX=CompareX;Cnds.CompareY=CompareY;Cnds.IsOnScreen=IsOnScreen;Cnds.IsOutsideLayout=IsOutsideLayout;Cnds.PickDistance=PickDistance;Acts.SetX=SetX;Acts.SetY=SetY;Acts.SetPos=SetPos;Acts.SetPosToObject=SetPosToObject;Acts.MoveForward=MoveForward;Acts.MoveAtAngle=MoveAtAngle;Exps.X=GetX;Exps.Y=GetY;Exps.dt=GetDt}if(hasSizeACEs){Cnds.CompareWidth=
CompareWidth;Cnds.CompareHeight=CompareHeight;Acts.SetWidth=SetWidth;Acts.SetHeight=SetHeight;Acts.SetSize=SetSize;Exps.Width=GetWidth;Exps.Height=GetHeight;Exps.BBoxLeft=GetBboxLeft;Exps.BBoxTop=GetBboxTop;Exps.BBoxRight=GetBboxRight;Exps.BBoxBottom=GetBboxBottom;Exps.BBoxMidX=GetBboxMidX;Exps.BBoxMidY=GetBboxMidY}if(hasAngleACEs){Cnds.AngleWithin=IsAngleWithin;Cnds.IsClockwiseFrom=IsAngleClockwiseFrom;Cnds.IsBetweenAngles=IsBetweenAngles;Acts.SetAngle=SetAngle;Acts.RotateClockwise=RotateClockwise;
Acts.RotateCounterclockwise=RotateCounterclockwise;Acts.RotateTowardAngle=RotateTowardAngle;Acts.RotateTowardPosition=RotateTowardPosition;Acts.SetTowardPosition=SetTowardPosition;Exps.Angle=GetAngle}if(hasAppearanceACEs){Cnds.IsVisible=IsVisible;Cnds.CompareOpacity=CompareOpacity;Acts.SetVisible=SetVisible;Acts.SetOpacity=SetOpacity;Acts.SetDefaultColor=SetDefaultColor;Exps.Opacity=GetOpacity;Exps.ColorValue=GetColor}if(hasZOrderACEs){Cnds.IsOnLayer=IsOnLayer;Cnds.PickTopBottom=PickTopBottom;Cnds.CompareZElevation=
CompareZElevation;Acts.MoveToTop=MoveToTop;Acts.MoveToBottom=MoveToBottom;Acts.MoveToLayer=MoveToLayer;Acts.ZMoveToObject=ZMoveToObject;Acts.SetZElevation=SetZElevation;Exps.LayerNumber=LayerNumber;Exps.LayerName=LayerName;Exps.ZIndex=ZIndex;Exps.ZElevation=ZElevation;Exps.TotalZElevation=TotalZElevation}if(hasEffectsACEs){Cnds.IsEffectEnabled=IsEffectEnabled;Acts.SetEffectEnabled=SetEffectEnabled;Acts.SetEffectParam=SetEffectParam}if(hasSceneGraphACEs){Cnds.HasParent=HasParent;Cnds.HasChildren=HasChildren;
Cnds.PickParent=PickParent;Cnds.PickChildren=PickChildren;Cnds.PickNthChild=PickNthChild;Cnds.CompareChildCount=CompareChildCount;Acts.AddChild=AddChild;Acts.RemoveChild=RemoveChild;Acts.RemoveFromParent=RemoveFromParent;Exps.ChildCount=ChildCount;Exps.AllChildCount=AllChildCount}if(hasMeshACEs){Acts.SetMeshSize=SetMeshSize;Acts.SetMeshPoint=SetMeshPoint;Exps.MeshColumns=MeshColumns;Exps.MeshRows=MeshRows}if(hasElementACEs){Cnds.IsVisible=IsVisible;Acts.SetVisible=SetElementVisible;Acts.SetCSSStyle=
SetElementCSSStyle;Acts.SetElemAttribute=SetElementAttribute;Acts.RemoveElemAttribute=RemoveElementAttribute}if(hasElementFocusACEs){Cnds.IsFocused=IsElementFocused;Acts.SetFocus=SetElementFocus;Acts.SetBlur=SetElementBlur}if(hasElementEnabledACEs){Cnds.IsEnabled=IsElementEnabled;Acts.SetEnabled=SetElementEnabled}if(hasCollisionACEs){Cnds.OnCollision=OnCollision;Cnds.IsOverlapping=IsOverlapping;Cnds.IsOverlappingOffset=IsOverlappingOffset;pluginCtor.FinishCollisionCondition=FinishCollisionCondition}if(!isSingleGlobal){Cnds.CompareInstanceVar=
CompareInstanceVar;Cnds.IsBoolInstanceVarSet=IsBoolInstanceVarSet;Cnds.PickInstVarHiLow=PickInstVarHiLow;Cnds.PickByUID=PickByUID;Acts.SetInstanceVar=SetInstanceVar;Acts.AddInstanceVar=AddInstanceVar;Acts.SubInstanceVar=SubInstanceVar;Acts.SetBoolInstanceVar=SetBoolInstanceVar;Acts.ToggleBoolInstanceVar=ToggleBoolInstanceVar;Cnds.OnCreated=OnCreated;Cnds.OnDestroyed=OnDestroyed;Acts.Destroy=Destroy;if(!Acts.LoadFromJsonString)Acts.LoadFromJsonString=LoadFromJsonString;if(!Exps.AsJSON)Exps.AsJSON=
AsJSON;Exps.Count=Count;Exps.PickedCount=PickedCount;Exps.IID=GetIID;Exps.UID=GetUID;Exps.ObjectTypeName=ObjectTypeName}if(hasTemplateACEs)Exps.TemplateName=TemplateName};

}

// events/scheduledWait.js
{
'use strict';const C3=self.C3;
C3.ScheduledWait=class ScheduledWait extends C3.DefendedBase{constructor(eventSheetManager){super();this._eventSheetManager=eventSheetManager;this._type="";this._time=-1;this._signalTag="";this._isSignalled=false;this._event=null;this._actIndex=0;this._solModifiers=[];this._dynamicSolModifiers=null;this._sols=new Map;this._callingFunctionBlock=null;this._asyncId=-1;this._functionParameters=null;this._functionInnerLocalVars=null;this._shouldRelease=false}Release(){this._type="";this._time=-1;this._signalTag=
"";this._event=null;this._callingFunctionBlock=null;this._functionParameters=null;this._functionInnerLocalVars=null;this._asyncId=-1;C3.clearArray(this._solModifiers);if(this._dynamicSolModifiers){this._dynamicSolModifiers.clear();this._dynamicSolModifiers=null}for(const s of this._sols.values())s.Release();this._sols.clear()}_Init(){const eventSheetManager=this._eventSheetManager;const allObjectClasses=eventSheetManager.GetRuntime().GetAllObjectClasses();const frame=eventSheetManager.GetCurrentEventStackFrame();
this._event=frame.GetCurrentEvent();this._actIndex=frame.GetActionIndex()+1;const functionBlock=eventSheetManager.FindFirstFunctionBlockParent(this._event);if(functionBlock){this._callingFunctionBlock=functionBlock;this._functionParameters=functionBlock.CaptureFunctionParameters();this._functionInnerLocalVars=functionBlock._GetAllInnerLocalVariables().map(v=>v.GetValue());if(functionBlock.IsAsync())this._asyncId=functionBlock.PauseCurrentAsyncFunction()}for(const objectClass of allObjectClasses){const sol=
objectClass.GetCurrentSol();if(sol.IsSelectAll()&&!this._event.HasSolModifier(objectClass))continue;this._solModifiers.push(objectClass);this._sols.set(objectClass,C3.New(C3.SolState,sol))}const dynamicSolModifiersSet=eventSheetManager.GetDynamicSolModifiersSet();this._dynamicSolModifiers=dynamicSolModifiersSet.size>0?dynamicSolModifiersSet:null}InitTimer(seconds){this._type="timer";this._Init();this._time=this._eventSheetManager.GetRuntime().GetGameTime()+seconds}InitSignal(tag){this._type="signal";
this._Init();this._signalTag=tag.toLowerCase()}InitPromise(p){this._type="promise";this._Init();p.then(()=>this.SetSignalled()).catch(err=>{console.warn("[C3 runtime] Promise rejected in 'Wait for previous actions to complete': ",err);this.SetSignalled()})}IsTimer(){return this._type==="timer"}IsSignal(){return this._type==="signal"}IsPromise(){return this._type==="promise"}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=true}_ShouldRun(){if(this.IsTimer())return this._time<=
this._eventSheetManager.GetRuntime().GetGameTime();else return this.IsSignalled()}_RestoreState(frame){frame._Restore(this._event,this._actIndex);for(const [objectClass,solState]of this._sols.entries()){const sol=objectClass.GetCurrentSol();solState._Restore(sol)}if(this._dynamicSolModifiers)frame.SetDynamicSolModifiers([...this._dynamicSolModifiers]);const callingFunctionBlock=this._callingFunctionBlock;if(callingFunctionBlock){callingFunctionBlock.SetFunctionParameters(this._functionParameters);
callingFunctionBlock._GetAllInnerLocalVariables().map((v,index)=>v.SetValue(this._functionInnerLocalVars[index]));if(callingFunctionBlock.IsAsync())callingFunctionBlock.ResumeAsyncFunction(this._asyncId)}}_Run(frame){this._RestoreState(frame);this._event._ResumeActionsAndSubEvents(frame);if(this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync())this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId);this._eventSheetManager.ClearSol(this._solModifiers);this._shouldRelease=
true}async _DebugRun(frame){this._RestoreState(frame);for(const breakEventObject of this._event._DebugResumeActionsAndSubEvents(frame))await this._eventSheetManager.GetRuntime().DebugBreak(breakEventObject);if(this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync())this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId);this._eventSheetManager.ClearSol(this._solModifiers);this._shouldRelease=true}ShouldRelease(){return this._shouldRelease}RemoveInstances(s){for(const solState of this._sols.values())solState.RemoveInstances(s)}_SaveToJson(){const sols=
{};const o={"t":this._time,"st":this._signalTag,"s":this._isSignalled,"ev":this._event.GetSID(),"sm":this._solModifiers.map(oc=>oc.GetSID()),"dsm":this._dynamicSolModifiers?[...this._dynamicSolModifiers].map(oc=>oc.GetSID()):null,"sols":sols};if(this._event._HasActionIndex(this._actIndex))o["act"]=this._event.GetActionAt(this._actIndex).GetSID();for(const [objectClass,solState]of this._sols)sols[objectClass.GetSID().toString()]=solState._SaveToJson();return o}static _CreateFromJson(eventSheetManager,
o){const runtime=eventSheetManager.GetRuntime();const event=eventSheetManager.GetEventBlockBySID(o["ev"]);if(!event)return null;let actIndex=0;if(o.hasOwnProperty("act")){const act=eventSheetManager.GetActionBySID(o["act"]);if(!act)return null;actIndex=act.GetIndex()}const sw=C3.New(C3.ScheduledWait,eventSheetManager);sw._time=o["t"];sw._type=sw._time===-1?"signal":"timer";sw._signalTag=o["st"];sw._isSignalled=o["s"];sw._event=event;sw._actIndex=actIndex;for(const sid of o["sm"]){const objectClass=
runtime.GetObjectClassBySID(sid);if(objectClass)sw._solModifiers.push(objectClass)}if(Array.isArray(o["dsm"]))for(const sid of o["dsm"]){const objectClass=runtime.GetObjectClassBySID(sid);if(objectClass){if(!sw._dynamicSolModifiers)sw._dynamicSolModifiers=new Set;sw._dynamicSolModifiers.add(objectClass)}}for(const [sidStr,solData]of Object.entries(o["sols"])){const sid=parseInt(sidStr,10);const objectClass=runtime.GetObjectClassBySID(sid);if(!objectClass)continue;const solState=C3.New(C3.SolState,
null);solState._LoadFromJson(eventSheetManager,solData);sw._sols.set(objectClass,solState)}return sw}};

}

// events/solState.js
{
'use strict';const C3=self.C3;
C3.SolState=class SolState extends C3.DefendedBase{constructor(sol){super();this._objectClass=null;this._isSelectAll=true;this._instances=[];if(sol){this._objectClass=sol.GetObjectClass();this._isSelectAll=sol.IsSelectAll();C3.shallowAssignArray(this._instances,sol._GetOwnInstances())}}Release(){this._objectClass=null;C3.clearArray(this._instances)}_Restore(sol){sol._SetSelectAll(this._isSelectAll);C3.shallowAssignArray(sol._GetOwnInstances(),this._instances)}RemoveInstances(s){C3.arrayRemoveAllInSet(this._instances,s)}_SaveToJson(){return{"sa":this._isSelectAll,
"insts":this._instances.map(inst=>inst.GetUID())}}_LoadFromJson(eventSheetManager,o){const runtime=eventSheetManager.GetRuntime();this._isSelectAll=!!o["sa"];C3.clearArray(this._instances);for(const uid of o["insts"]){const inst=runtime.GetInstanceByUID(uid);if(inst)this._instances.push(inst)}}};

}

// sdk/sdkPluginBase.js
{
'use strict';const C3=self.C3;function GetNextParamMap(paramMap,param){let nextParamMap=paramMap.get(param);if(!nextParamMap){nextParamMap=new Map;paramMap.set(param,nextParamMap)}return nextParamMap}
C3.SDKPluginBase=class SDKPluginBase extends C3.DefendedBase{constructor(opts){super();this._runtime=opts.runtime;this._isSingleGlobal=!!opts.isSingleGlobal;this._isWorldType=!!opts.isWorld;this._isRotatable=!!opts.isRotatable;this._mustPredraw=!!opts.mustPredraw;this._hasEffects=!!opts.hasEffects;this._supportsSceneGraph=!!opts.supportsSceneGraph;this._supportsMesh=!!opts.supportsMesh;this._isHTMLElementType=!!opts.isHTMLElementType;this._is3d=!!opts.is3d;this._sdkVersion=opts.sdkVersion;this._singleGlobalObjectClass=
null;this._boundACEMethodCache=new Map;this._boundACEMethodCache_1param=new Map;this._boundACEMethodCache_2params=new Map;this._boundACEMethodCache_3params=new Map;this._scriptInterfaceClass=opts.scriptInterfaceClass;this._iPlugin=null}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetConstructor(){if(this.GetSdkVersion()>=2)return this._iPlugin.constructor;else return this.constructor}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(allowDefault=false){let Class=
this._scriptInterfaceClass;if(allowDefault&&typeof Class!=="function"&&this.GetSdkVersion()>=2)Class=globalThis.ISDKPluginBase;return Class}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsHTMLElementType(){return this._isHTMLElementType}Is3D(){return this._is3d}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(func,
bindThis){if(!bindThis)throw new Error("missing 'this' binding");let ret=this._boundACEMethodCache.get(func);if(ret)return ret;ret=func.bind(bindThis);this._boundACEMethodCache.set(func,ret);return ret}_GetBoundACEMethod_1param(func,bindThis,param0){if(!bindThis)throw new Error("missing 'this' binding");const param0map=GetNextParamMap(this._boundACEMethodCache_1param,func);let ret=param0map.get(param0);if(ret)return ret;ret=func.bind(bindThis,param0);param0map.set(param0,ret);return ret}_GetBoundACEMethod_2params(func,
bindThis,param0,param1){if(!bindThis)throw new Error("missing 'this' binding");const param0map=GetNextParamMap(this._boundACEMethodCache_2params,func);const param1map=GetNextParamMap(param0map,param0);let ret=param1map.get(param1);if(ret)return ret;ret=func.bind(bindThis,param0,param1);param1map.set(param1,ret);return ret}_GetBoundACEMethod_3params(func,bindThis,param0,param1,param2){if(!bindThis)throw new Error("missing 'this' binding");const param0map=GetNextParamMap(this._boundACEMethodCache_3params,
func);const param1map=GetNextParamMap(param0map,param0);const param2map=GetNextParamMap(param1map,param1);let ret=param2map.get(param2);if(ret)return ret;ret=func.bind(bindThis,param0,param1,param2);param2map.set(param2,ret);return ret}_SetSingleGlobalObjectClass(objectClass){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");this._singleGlobalObjectClass=objectClass}GetSingleGlobalObjectClass(){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");return this._singleGlobalObjectClass}GetSingleGlobalInstance(){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");
return this._singleGlobalObjectClass.GetSingleGlobalInstance()}_InitScriptInterface(){const sdkVersion=this.GetSdkVersion();C3.AddonManager._PushInitObject(this,sdkVersion);const CustomScriptClass=this.GetScriptInterfaceClass(true);if(CustomScriptClass){this._iPlugin=new CustomScriptClass;if(!(this._iPlugin instanceof self.IPlugin))throw new TypeError("plugin class must derive from IPlugin");}else this._iPlugin=new self.IPlugin;C3.AddonManager._PopInitObject(sdkVersion)}GetIPlugin(){return this._iPlugin}};

}

// sdk/sdkDOMPluginBase.js
{
'use strict';const C3=self.C3;
C3.SDKDOMPluginBase=class SDKDOMPluginBase extends C3.SDKPluginBase{constructor(opts,DOM_COMPONENT_ID){super(opts);this._domComponentId=DOM_COMPONENT_ID;this._nextElementId=0;this._instMap=new Map;this.AddElementMessageHandler("elem-focused",sdkInst=>sdkInst._OnElemFocused());this.AddElementMessageHandler("elem-blurred",sdkInst=>{if(sdkInst)sdkInst._OnElemBlurred()})}Release(){super.Release()}_AddElement(sdkInst){const elementId=this._nextElementId++;this._instMap.set(elementId,sdkInst);return elementId}_RemoveElement(elementId){this._instMap.delete(elementId)}AddElementMessageHandler(handler,
func){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,handler,e=>{const sdkInst=this._instMap.get(e["elementId"]);func(sdkInst,e)})}};

}

// sdk/sdkTypeBase.js
{
'use strict';const C3=self.C3;
C3.SDKTypeBase=class SDKTypeBase extends C3.DefendedBase{constructor(objectClass){super();this._objectClass=objectClass;this._runtime=objectClass.GetRuntime();this._plugin=objectClass.GetPlugin()}Release(){this._objectClass=null;this._runtime=null;this._plugin=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}OnCreate(){}FinishCondition(f){}BeforeRunAction(method){}AfterRunAction(method){}LoadTextures(renderer){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(renderer){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}DispatchScriptEvent(name,cancelable,
additionalProperties){const e=C3.New(C3.Event,name,cancelable);e.objectClass=this;if(additionalProperties)Object.assign(e,additionalProperties);this.GetObjectClass().DispatchUserScriptEvent(e)}};

}

// sdk/sdkInstanceBase.js
{
'use strict';const C3=self.C3;
C3.SDKInstanceBase=class SDKInstanceBase extends C3.DefendedBase{constructor(inst,domComponentId){super();this._inst=inst;this._domComponentId=domComponentId;this._wrapperComponentId=null;this._runtime=inst.GetRuntime();this._objectClass=this._inst.GetObjectClass();this._sdkType=this._objectClass.GetSdkType();this._tickFunc=null;this._tick2Func=null;this._isTicking=false;this._isTicking2=false;this._disposables=null;this._wasReleased=false}Release(){this._wasReleased=true;this._StopTicking();this._StopTicking2();
this._tickFunc=null;this._tick2Func=null;if(this._disposables){this._disposables.Release();this._disposables=null}this._inst=null;this._runtime=null;this._objectClass=null;this._sdkType=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(method){return this._runtime.Trigger(method,
this._inst,null)}DebugTrigger(method){return this._runtime.DebugTrigger(method,this._inst,null)}TriggerAsync(method){return this._runtime.TriggerAsync(method,this._inst,null)}FastTrigger(method,value){return this._runtime.FastTrigger(method,this._inst,value)}DebugFastTrigger(method,value){return this._runtime.DebugFastTrigger(method,this._inst,value)}ScheduleTriggers(f){return this._runtime.ScheduleTriggers(f)}AddDOMMessageHandler(handler,func){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,
handler,func)}AddDOMMessageHandlers(list){for(const [handler,func]of list)this.AddDOMMessageHandler(handler,func)}PostToDOM(handler,data){this._runtime.PostComponentMessageToDOM(this._domComponentId,handler,data)}PostToDOMAsync(handler,data){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,handler,data)}_PostToDOMMaybeSync(handler,data){if(this._runtime.IsInWorker())this.PostToDOM(handler,data);else return window["c3_runtimeInterface"]["_OnMessageFromRuntime"]({"type":"event",
"component":this._domComponentId,"handler":handler,"data":data,"responseId":null})}SetWrapperExtensionComponentId(componentId){if(!componentId)throw new Error("cannot set empty component id");this._wrapperComponentId=componentId}IsWrapperExtensionAvailable(){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");return this._runtime.HasWrapperComponentId(this._wrapperComponentId)}AddWrapperExtensionMessageHandler(handler,func){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");
this._runtime.AddWrapperExtensionMessageHandler(this._wrapperComponentId,handler,func)}AddWrapperExtensionMessageHandlers(list){for(const [handler,func]of list)this.AddWrapperExtensionMessageHandler(handler,func)}SendWrapperExtensionMessage(messageId,params){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.SendWrapperExtensionMessage(this._wrapperComponentId,messageId,params)}SendWrapperExtensionMessageAsync(messageId,params){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");
return this._runtime.SendWrapperExtensionMessageAsync(this._wrapperComponentId,messageId,params)}Tick(){}Tick2(){}_StartTicking(){if(this._isTicking)return;if(!this._tickFunc)this._tickFunc=()=>this.Tick();this._runtime.Dispatcher().addEventListener("tick",this._tickFunc);this._isTicking=true}_StopTicking(){if(!this._isTicking)return;this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc);this._isTicking=false}IsTicking(){return this._isTicking}_StartTicking2(){if(this._isTicking2)return;
if(!this._tick2Func)this._tick2Func=()=>this.Tick2();this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func);this._isTicking2=true}_StopTicking2(){if(!this._isTicking2)return;this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func);this._isTicking2=false}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(o){}GetPropertyValueByIndex(index){}SetPropertyValueByIndex(index,value){}OffsetPropertyValueByIndex(index,offset,
opts){if(offset===0)return;const value=this.GetPropertyValueByIndex(index);if(typeof value!=="number")throw new Error("expected number");this.SetPropertyValueByIndex(index,value+offset,opts)}SetPropertyColorOffsetValueByIndex(offset,r,g,b){}CallAction(actMethod,...args){actMethod.call(this,...args)}CallExpression(expMethod,...args){return expMethod.call(this,...args)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(name,cancelable,additionalProperties){if(!this._inst.HasScriptInterface())return;
const scriptInterface=this.GetScriptInterface();const e=C3.New(C3.Event,name,cancelable);e.instance=scriptInterface;if(additionalProperties)Object.assign(e,additionalProperties);scriptInterface.dispatchEvent(e)}MustPreDraw(){return false}};

}

// sdk/sdkWorldInstanceBase.js
{
'use strict';const C3=self.C3;
C3.SDKWorldInstanceBase=class SDKWorldInstanceBase extends C3.SDKInstanceBase{constructor(inst,domComponentId){super(inst,domComponentId);this._worldInfo=inst.GetWorldInfo();this._renderercontextlost_handler=null;this._renderercontextrestored_handler=null}Release(){if(this._renderercontextlost_handler){const dispatcher=this._runtime.Dispatcher();dispatcher.removeEventListener("renderercontextlost",this._renderercontextlost_handler);dispatcher.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler);
this._renderercontextlost_handler=null;this._renderercontextrestored_handler=null}this._worldInfo=null;super.Release()}HandleWebGLContextLoss(){this.HandleRendererContextLoss()}OnWebGLContextLost(){}OnWebGLContextRestored(){}HandleRendererContextLoss(){if(this._renderercontextlost_handler)return;this._renderercontextlost_handler=()=>this.OnRendererContextLost();this._renderercontextrestored_handler=()=>this.OnRendererContextRestored();const dispatcher=this._runtime.Dispatcher();dispatcher.addEventListener("renderercontextlost",
this._renderercontextlost_handler);dispatcher.addEventListener("renderercontextrestored",this._renderercontextrestored_handler)}OnRendererContextLost(){this.OnWebGLContextLost()}OnRendererContextRestored(){this.OnWebGLContextRestored()}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return false}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");const imageInfo=this.GetCurrentImageInfo();if(imageInfo)return imageInfo.GetWidth();else;}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");
const imageInfo=this.GetCurrentImageInfo();if(imageInfo)return imageInfo.GetHeight();else;}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){const imageInfo=this.GetCurrentImageInfo();if(imageInfo){const texture=imageInfo.GetTexture();if(texture)return[texture.GetWidth(),texture.GetHeight()]}return[100,100]}GetCurrentTexRect(){const imageInfo=this.GetCurrentImageInfo();return imageInfo?imageInfo.GetTexRect():null}GetCurrentTexQuad(){const imageInfo=this.GetCurrentImageInfo();return imageInfo?
imageInfo.GetTexQuad():null}IsCurrentTexRotated(){const imageInfo=this.GetCurrentImageInfo();return imageInfo?imageInfo.IsRotated():false}GetImagePoint(nameOrIndex){const wi=this._inst.GetWorldInfo();return[wi.GetX(),wi.GetY(),wi.GetTotalZElevation()]}LoadTilemapData(data,mapWidth,mapHeight){}TestPointOverlapTile(x,y){}RendersToOwnZPlane(){return true}};

}

// sdk/sdkDOMInstanceBase.js
{
'use strict';const C3=self.C3;const tempRect=C3.New(C3.Rect);
C3.SDKDOMInstanceBase=class SDKDOMInstanceBase extends C3.SDKWorldInstanceBase{constructor(inst,domComponentId){super(inst,domComponentId);this._elementId=this.GetPlugin()._AddElement(this);this._isElementShowing=true;this._elemHasFocus=false;this._autoFontSize=false;this._autoFontSizeOffset=-.2;this._lastRect=C3.New(C3.Rect,0,0,-1,-1);const canvasManager=this._runtime.GetCanvasManager();this._lastWindowWidth=canvasManager.GetLastWidth();this._lastWindowHeight=canvasManager.GetLastHeight();this._lastHTMLIndex=
-1;this._lastHTMLZIndex=-1;this._isPendingUpdateState=false;this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId);this.PostToDOMElement("destroy");this._elementId=-1;super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw new Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(handler,data){if(!data)data={};data["elementId"]=this._elementId;this.PostToDOM(handler,data)}_PostToDOMElementMaybeSync(handler,
data){if(!data)data={};data["elementId"]=this._elementId;return this._PostToDOMMaybeSync(handler,data)}PostToDOMElementAsync(handler,data){if(!data)data={};data["elementId"]=this._elementId;return this.PostToDOMAsync(handler,data)}CreateElement(data){if(!data)data={};const wi=this.GetWorldInfo();data["elementId"]=this._elementId;data["isVisible"]=wi.IsVisible();data["htmlIndex"]=wi.GetLayer().GetHTMLIndex();data["htmlZIndex"]=wi.GetHTMLZIndex();Object.assign(data,this.GetElementState());this._isElementShowing=
!!data["isVisible"];this._PostToDOMMaybeSync("create",data);this._UpdatePosition(true)}SetElementVisible(v){v=!!v;if(this._isElementShowing===v)return;this._isElementShowing=v;this.PostToDOMElement("set-visible",{"isVisible":v})}Tick(){this._UpdatePosition(false)}_ShouldPreserveElement(){const fullscreenMode=this._runtime.GetCanvasManager().GetFullscreenMode();return C3.Platform.OS==="Android"&&(fullscreenMode==="scale-inner"||fullscreenMode==="scale-outer"||fullscreenMode==="crop")}_UpdatePosition(first){if(this.GetInstance().IsDestroyed())return;
const wi=this.GetWorldInfo();const layer=wi.GetLayer();const bbox=wi.GetBoundingBox();let [cleft,ctop]=layer.LayerToCanvasCss(bbox.getLeft(),bbox.getTop());let [cright,cbottom]=layer.LayerToCanvasCss(bbox.getRight(),bbox.getBottom());const canvasManager=this._runtime.GetCanvasManager();const rightEdge=canvasManager.GetCssWidth();const bottomEdge=canvasManager.GetCssHeight();if(!wi.IsVisible()||!layer.IsVisible()){this.SetElementVisible(false);return}if(!this._ShouldPreserveElement())if(cright<=0||
cbottom<=0||cleft>=rightEdge||ctop>=bottomEdge){this.SetElementVisible(false);return}tempRect.set(cleft,ctop,cright,cbottom);const curWinWidth=canvasManager.GetLastWidth();const curWinHeight=canvasManager.GetLastHeight();const curHTMLIndex=layer.GetHTMLIndex();const curHTMLZIndex=wi.GetHTMLZIndex();if(!first&&tempRect.equals(this._lastRect)&&this._lastWindowWidth===curWinWidth&&this._lastWindowHeight===curWinHeight&&this._lastHTMLIndex===curHTMLIndex&&this._lastHTMLZIndex===curHTMLZIndex){this.SetElementVisible(true);
return}this._lastRect.copy(tempRect);this._lastWindowWidth=curWinWidth;this._lastWindowHeight=curWinHeight;this._lastHTMLIndex=curHTMLIndex;this._lastHTMLZIndex=curHTMLZIndex;this.SetElementVisible(true);let fontSize=null;if(this._autoFontSize)fontSize=layer.GetDisplayScale()+this._autoFontSizeOffset;this.PostToDOMElement("update-position",{"left":Math.round(this._lastRect.getLeft()),"top":Math.round(this._lastRect.getTop()),"width":Math.round(this._lastRect.width()),"height":Math.round(this._lastRect.height()),
"htmlIndex":curHTMLIndex,"htmlZIndex":curHTMLZIndex,"fontSize":fontSize})}FocusElement(){this._PostToDOMElementMaybeSync("focus",{"focus":true})}BlurElement(){this._PostToDOMElementMaybeSync("focus",{"focus":false})}_OnElemFocused(){this._elemHasFocus=true}_OnElemBlurred(){this._elemHasFocus=false}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(prop,val){this.PostToDOMElement("set-css-style",{"prop":C3.CSSToCamelCase(prop),"val":val})}SetElementAttribute(attribName,value){this.PostToDOMElement("set-attribute",
{"name":attribName,"val":value})}RemoveElementAttribute(attribName){this.PostToDOMElement("remove-attribute",{"name":attribName})}UpdateElementState(){if(this._isPendingUpdateState)return;this._isPendingUpdateState=true;Promise.resolve().then(()=>{this._isPendingUpdateState=false;this.PostToDOMElement("update-state",this.GetElementState())})}GetElementState(){}GetElementId(){return this._elementId}};

}

// sdk/sdkBehaviorBase.js
{
'use strict';const C3=self.C3;const IBehavior=self.IBehavior;
C3.SDKBehaviorBase=class SDKBehaviorBase extends C3.DefendedBase{constructor(opts){super();this._runtime=opts.runtime;this._myObjectClasses=C3.New(C3.ArraySet);this._myInstances=C3.New(C3.ArraySet);this._sdkVersion=opts.sdkVersion;this._scriptInterfaceClass=opts.scriptInterfaceClass;this._iBehavior=null}Release(){this._myInstances.Release();this._myObjectClasses.Release();this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(allowDefault=false){let Class=
this._scriptInterfaceClass;if(allowDefault&&typeof Class!=="function"&&this.GetSdkVersion()>=2)Class=globalThis.ISDKBehaviorBase;return Class}_AddObjectClass(objectClass){this._myObjectClasses.Add(objectClass)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(inst){this._myInstances.Add(inst)}_RemoveInstance(inst){this._myInstances.Delete(inst)}GetInstances(){return this._myInstances.GetArray()}_InitScriptInterface(){const sdkVersion=this.GetSdkVersion();C3.AddonManager._PushInitObject(this,
sdkVersion);const CustomScriptClass=this.GetScriptInterfaceClass(true);if(CustomScriptClass){this._iBehavior=new CustomScriptClass;if(!(this._iBehavior instanceof IBehavior))throw new TypeError("behavior class must derive from IBehavior");}else this._iBehavior=new IBehavior;C3.AddonManager._PopInitObject(sdkVersion)}GetIBehavior(){return this._iBehavior}};

}

// sdk/sdkBehaviorTypeBase.js
{
'use strict';const C3=self.C3;C3.SDKBehaviorTypeBase=class SDKBehaviorTypeBase extends C3.DefendedBase{constructor(behaviorType){super();this._runtime=behaviorType.GetRuntime();this._behaviorType=behaviorType;this._objectClass=behaviorType.GetObjectClass();this._behavior=behaviorType.GetBehavior();this._behavior._AddObjectClass(this._objectClass)}Release(){this._runtime=null;this._behaviorType=null;this._objectClass=null;this._behavior=null}OnCreate(){}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}};

}

// sdk/sdkBehaviorInstanceBase.js
{
'use strict';const C3=self.C3;
C3.SDKBehaviorInstanceBase=class SDKBehaviorInstanceBase extends C3.DefendedBase{constructor(behInst,domComponentId){super();this._behInst=behInst;this._domComponentId=domComponentId;this._inst=behInst.GetObjectInstance();this._runtime=behInst.GetRuntime();this._behaviorType=behInst.GetBehaviorType();this._sdkType=this._behaviorType.GetSdkType();this._isTicking=false;this._isTicking2=false;this._isPostTicking=false;this._disposables=null}Release(){this._StopTicking();this._StopTicking2();this._StopPostTicking();
if(this._disposables){this._disposables.Release();this._disposables=null}this._behInst=null;this._inst=null;this._runtime=null;this._behaviorType=null;this._sdkType=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(method){return this._runtime.Trigger(method,
this._inst,this._behaviorType)}DebugTrigger(method){return this._runtime.DebugTrigger(method,this._inst,this._behaviorType)}TriggerAsync(method){return this._runtime.TriggerAsync(method,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){if(this._isTicking)return;this._runtime._AddBehInstToTick(this);this._isTicking=true}_StopTicking(){if(!this._isTicking)return;this._runtime._RemoveBehInstToTick(this);this._isTicking=false}IsTicking(){return this._isTicking}_StartTicking2(){if(this._isTicking2)return;
this._runtime._AddBehInstToTick2(this);this._isTicking2=true}_StopTicking2(){if(!this._isTicking2)return;this._runtime._RemoveBehInstToTick2(this);this._isTicking2=false}IsTicking2(){return this._isTicking2}_StartPostTicking(){if(this._isPostTicking)return;this._runtime._AddBehInstToPostTick(this);this._isPostTicking=true}_StopPostTicking(){if(!this._isPostTicking)return;this._runtime._RemoveBehInstToPostTick(this);this._isPostTicking=false}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(handler,
func){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,handler,func)}OnSpriteFrameChanged(prevFrame,nextFrame){}SaveToJson(){return null}LoadFromJson(o){}GetPropertyValueByIndex(index){}SetPropertyValueByIndex(index,value){}OffsetPropertyValueByIndex(index,offset){if(offset===0)return;const value=this.GetPropertyValueByIndex(index);if(typeof value!=="number")throw new Error("expected number");this.SetPropertyValueByIndex(index,value+offset)}SetPropertyColorOffsetValueByIndex(index,
offsetR,offsetG,offsetB){}CallAction(actMethod,...args){actMethod.call(this,...args)}CallExpression(expMethod,...args){return expMethod.call(this,...args)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(name,cancelable,additionalProperties){if(!this._behInst.HasScriptInterface())return;const scriptInterface=this.GetScriptInterface();const e=C3.New(C3.Event,name,cancelable);e.behaviorInstance=scriptInterface;e.instance=scriptInterface.instance;if(additionalProperties)Object.assign(e,additionalProperties);
scriptInterface.dispatchEvent(e)}};

}

// objects/addonManager.js
{
'use strict';const C3=self.C3;C3.Plugins={};C3.Behaviors={};const internalApiToken=C3._GetInternalAPIToken();function ValidateInternalAPIToken(token){if(token!==internalApiToken)throw new Error("invalid internal API token");}let initObjectStack=[];let initObjectStack2=[];let initPropertiesStack=[];let originalPushInitObject=null;let originalPopInitObject=null;let originalGetInitObject=null;let originalGetInitObject2=null;const pluginsByCtor=new Map;const behaviorsByCtor=new Map;
C3.AddonManager=class AddonManager extends C3.DefendedBase{constructor(runtime,wrapperComponentIds){super();this._runtime=runtime;this._allPlugins=[];this._systemPlugin=null;this._allBehaviors=[];this._delayCreateBehaviors=new Map;this._solidBehavior=null;this._jumpthruBehavior=null;this._wrapperComponentIds=new Set(wrapperComponentIds)}CreatePlugin(pluginData){const sdkVersion=pluginData[19];const Ctor=this._runtime.GetObjectReference(pluginData[0]);if(!Ctor)throw new Error("missing plugin");C3.AddCommonACEs(pluginData,
Ctor);const PluginClass=sdkVersion>=2?C3.SDKPluginBase:Ctor;const plugin=C3.New(PluginClass,{runtime:this._runtime,isSingleGlobal:pluginData[1],isWorld:pluginData[2],isRotatable:pluginData[5],hasEffects:pluginData[8],mustPredraw:pluginData[9],supportsSceneGraph:pluginData[13],supportsMesh:pluginData[14],isHTMLElementType:pluginData[17],is3d:pluginData[18],sdkVersion,scriptInterfaceClass:sdkVersion>=2?Ctor:null});plugin.OnCreate();this._allPlugins.push(plugin);pluginsByCtor.set(Ctor,plugin)}CreateSystemPlugin(){this._systemPlugin=
C3.New(C3.Plugins.System,{runtime:this._runtime,isSingleGlobal:true});this._systemPlugin.OnCreate()}CreateBehavior(behaviorData){const sdkVersion=behaviorData[1];const Ctor=this._runtime.GetObjectReference(behaviorData[0]);if(!Ctor)throw new Error("missing behavior");this._delayCreateBehaviors.set(Ctor,()=>{const BehaviorClass=sdkVersion>=2?C3.SDKBehaviorBase:Ctor;const behavior=C3.New(BehaviorClass,{runtime:this._runtime,sdkVersion,scriptInterfaceClass:sdkVersion>=2?Ctor:null});behavior.OnCreate();
this._allBehaviors.push(behavior);behaviorsByCtor.set(Ctor,behavior);if(!this._solidBehavior&&C3.Behaviors.solid&&behavior instanceof C3.Behaviors.solid)this._solidBehavior=behavior;else if(!this._jumpthruBehavior&&C3.Behaviors.jumpthru&&behavior instanceof C3.Behaviors.jumpthru)this._jumpthruBehavior=behavior;behavior._InitScriptInterface()})}_DelayCreateBehavior(Ctor){const initFunc=this._delayCreateBehaviors.get(Ctor);if(!initFunc)return;initFunc();this._delayCreateBehaviors.delete(Ctor)}static _PushInitObject(obj,
sdkVersion=1){if(C3.AddonManager._PushInitObject!==originalPushInitObject)throw new Error(`invalid method`);if(sdkVersion===1)initObjectStack.push(obj);initObjectStack2.push(obj)}static _PopInitObject(sdkVersion=1){if(C3.AddonManager._PopInitObject!==originalPopInitObject)throw new Error(`invalid method`);if(sdkVersion===1)initObjectStack.pop();initObjectStack2.pop()}static _GetInitObject(){if(C3.AddonManager._GetInitObject!==originalGetInitObject)throw new Error(`invalid method`);if(initObjectStack.length===
0)throw new Error(`no init object set`);return initObjectStack.at(-1)}static _GetInitObject2(token){if(C3.AddonManager._GetInitObject2!==originalGetInitObject2)throw new Error(`invalid method`);ValidateInternalAPIToken(token);if(initObjectStack2.length===0)throw new Error(`no init object set`);return initObjectStack2.at(-1)}static _PushInitProperties(props){initPropertiesStack.push(props)}static _PopInitProperties(){initPropertiesStack.pop()}static _GetInitProperties(){if(initPropertiesStack.length===
0)throw new Error(`no init properties set`);return initPropertiesStack.at(-1)}_InitAddonScriptInterfaces(){for(const p of this._allPlugins)p._InitScriptInterface()}static GetPluginByConstructorFunction(ctor){return pluginsByCtor.get(ctor)||null}static GetBehaviorByConstructorFunction(ctor){return behaviorsByCtor.get(ctor)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}HasWrapperComponentId(id){return this._wrapperComponentIds.has(id)}};
originalPushInitObject=C3.AddonManager._PushInitObject;originalPopInitObject=C3.AddonManager._PopInitObject;originalGetInitObject=C3.AddonManager._GetInitObject;originalGetInitObject2=C3.AddonManager._GetInitObject2;

}

// objects/imageInfo.js
{
'use strict';const C3=self.C3;const allImageInfos=new Set;
C3.ImageInfo=class ImageInfo extends C3.DefendedBase{constructor(){super();this._generation=0;this._url="";this._size=0;this._offsetX=0;this._offsetY=0;this._width=0;this._height=0;this._isRotated=false;this._hasMetaData=false;this._imageAsset=null;this._textureState="";this._rcTex=C3.New(C3.Rect);this._quadTex=C3.New(C3.Quad);this._blobUrl="";this._iImageInfo=new self.IImageInfo(this);allImageInfos.add(this)}Release(){this.ReleaseTexture();if(this._imageAsset&&this._imageAsset.GetRefCount()===0)this._imageAsset.Release();
this._imageAsset=null;allImageInfos.delete(this);this.ReleaseBlobURL()}static OnRendererContextLost(){for(const imageInfo of allImageInfos){imageInfo._textureState="";imageInfo._rcTex.set(0,0,0,0);imageInfo._quadTex.setFromRect(imageInfo._rcTex)}}LoadData(imageData){this._url=imageData[0];this._size=imageData[1];this._offsetX=imageData[2];this._offsetY=imageData[3];this._width=imageData[4];this._height=imageData[5];this._isRotated=imageData[6];this._hasMetaData=true}LoadDynamicAsset(runtime,url){if(this._imageAsset)throw new Error("already loaded asset");
this._url=url;const opts={};if(C3.IsAbsoluteURL(url))opts.loadPolicy="remote";this.LoadAsset(runtime,opts);return this._imageAsset.Load()}LoadDynamicBlobAsset(runtime,blob){if(this._imageAsset)throw new Error("already loaded asset");this._url="";this._size=blob.size;this._imageAsset=C3.New(C3.ImageAsset,runtime.GetAssetManager(),{blob,size:this._size,loadPolicy:"local"})}ReplaceWith(otherImageInfo){if(otherImageInfo===this)throw new Error("cannot replace with self");this._generation++;this.ReleaseTexture();
this._url=otherImageInfo._url;this._size=otherImageInfo._size;this._offsetX=otherImageInfo._offsetX;this._offsetY=otherImageInfo._offsetY;this._width=otherImageInfo._width;this._height=otherImageInfo._height;this._isRotated=otherImageInfo._isRotated;this._hasMetaData=otherImageInfo._hasMetaData;this._imageAsset=otherImageInfo._imageAsset;this._textureState=otherImageInfo._textureState;this._rcTex=otherImageInfo._rcTex;this._quadTex=otherImageInfo._quadTex;this.ReleaseBlobURL()}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(runtime,
opts){if(this._imageAsset)throw new Error("already got asset");opts=Object.assign({},opts,{url:this.GetURL(),size:this.GetSize()});this._imageAsset=runtime.LoadImage(opts)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(renderer,opts){if(!this._imageAsset)throw new Error("no asset");if(this._textureState)throw new Error("already loaded texture");const startGeneration=this._generation;this._textureState="loading";const texture=await this._imageAsset.LoadStaticTexture(renderer,
opts);if(this._generation!==startGeneration)return null;if(!texture){this._textureState="";return null}this._textureState="loaded";if(!this._hasMetaData){this._width=texture.GetWidth();this._height=texture.GetHeight();this._hasMetaData=true}const wr=this._isRotated?this._height:this._width;const hr=this._isRotated?this._width:this._height;this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+wr,this._offsetY+hr);this._rcTex.divide(texture.GetWidth(),texture.GetHeight());this._quadTex.setFromRect(this._rcTex);
if(this._isRotated)this._quadTex.rotatePointsAnticlockwise();return texture}ReleaseTexture(){if(!this._textureState)return;if(this._imageAsset)this._imageAsset.ReleaseTexture();this._textureState="";this._rcTex.set(0,0,0,0);this._quadTex.setFromRect(this._rcTex)}GetTexture(){return this._imageAsset&&this._textureState==="loaded"?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}GetIImageInfo(){return this._iImageInfo}GetImageAsset(){return this._imageAsset}async ExtractImageToCanvas(drawable){if(!drawable)drawable=
await this._imageAsset.LoadToDrawable();const canvas=C3.CreateCanvas(this._width,this._height);const ctx=canvas.getContext("2d");if(this._isRotated){ctx.rotate(Math.PI/-2);ctx.translate(-this._height,0);ctx.drawImage(drawable,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width)}else ctx.drawImage(drawable,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height);return canvas}async ExtractImageToBlobURL(drawable){if(this._blobUrl)return this._blobUrl;
const canvas=await this.ExtractImageToCanvas(drawable);const blob=await C3.CanvasToBlob(canvas);this._blobUrl=URL.createObjectURL(blob);return this._blobUrl}ReleaseBlobURL(){if(this._blobUrl){URL.revokeObjectURL(this._blobUrl);this._blobUrl=""}}};

}

// objects/animationInfo.js
{
'use strict';const C3=self.C3;
C3.AnimationInfo=class AnimationInfo extends C3.DefendedBase{constructor(animData){super();this._name=animData[0];this._speed=animData[1];this._isLooping=!!animData[2];this._repeatCount=animData[3];this._repeatTo=animData[4];this._isPingPong=!!animData[5];this._sid=animData[6];this._frames=animData[7].map(frameData=>C3.New(C3.AnimationFrameInfo,frameData));this._iAnimation=new self.IAnimation(this)}static CreateDynamic(runtime,name){const ret=C3.New(C3.AnimationInfo,[name,0,false,0,0,false,Math.floor(Math.random()*
1E15),[]]);ret._frames.push(C3.AnimationFrameInfo.CreateDynamic(runtime));return ret}Release(){for(const f of this._frames)f.Release();C3.clearArray(this._frames)}LoadAllAssets(runtime){for(const f of this._frames)f.GetImageInfo().LoadAsset(runtime)}LoadAllTextures(renderer,opts){return Promise.all(this._frames.map(f=>f.GetImageInfo().LoadStaticTexture(renderer,opts)))}ReleaseAllTextures(){for(const f of this._frames)f.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(i){i=
Math.floor(i);if(i<0||i>=this._frames.length)throw new RangeError("invalid frame");return this._frames[i]}InsertFrameAt(frame,i){i=Math.floor(i);if(i<0)this._frames.unshift(frame);else if(i>=this._frames.length)this._frames.push(frame);else this._frames.splice(i,0,frame)}RemoveFrameAt(i){i=Math.floor(i);if(i<0||i>=this._frames.length)throw new RangeError("invalid frame");this._frames[i].Release();this._frames.splice(i,1)}GetFrameIndexByTag(tag){for(let i=0,len=this._frames.length;i<len;++i)if(C3.equalsNoCase(this._frames[i].GetTag(),
tag))return i;return-1}FrameTagOrIndexToIndex(where){if(typeof where==="string"){const index=this.GetFrameIndexByTag(where);if(index===-1)throw new Error(`cannot find animation frame with tag ${where}`);else return index}else return where}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}GetIAnimation(){return this._iAnimation}};

}

// objects/animationFrameInfo.js
{
'use strict';const C3=self.C3;const EMPTY_IMAGE_BLOB=(()=>{const EMPTY_IMAGE_BASE64="iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAANQTFRFAAAAp3o92gAAAAF0Uk5TAEDm2GYAAAATSURBVBgZYxgFo2AUjIJRQFcAAAV4AAHcRQIbAAAAAElFTkSuQmCC";const binStr=atob(EMPTY_IMAGE_BASE64);const uint8arr=new Uint8Array(binStr.length);for(let i=0,len=binStr.length;i<len;++i)uint8arr[i]=binStr.charCodeAt(i);return new Blob([uint8arr],{type:"image/png"})})();
C3.AnimationFrameInfo=class AnimationFrameInfo extends C3.DefendedBase{constructor(frameData){super();this._imageInfo=C3.New(C3.ImageInfo);this._imageInfo.LoadData(frameData);this._duration=frameData[7];this._origin=C3.New(C3.Vector2,frameData[8],frameData[9]);this._imagePoints=frameData[10].map(data=>C3.New(C3.ImagePoint,this,data));this._imagePointsByName=new Map;for(const ip of this._imagePoints)this._imagePointsByName.set(ip.GetName().toLowerCase(),ip);this._collisionPoly=null;const polyPoints=
frameData[11];if(polyPoints.length>=6)this._collisionPoly=C3.New(C3.CollisionPoly,polyPoints);this._tag=frameData[12]?frameData[12]:"";this._iAnimationFrame=new self.IAnimationFrame(this)}static CreateDynamic(runtime){const ret=C3.New(C3.AnimationFrameInfo,["",0,0,0,100,100,false,1,0,0,[],[],""]);ret._imageInfo.LoadDynamicBlobAsset(runtime,EMPTY_IMAGE_BLOB);return ret}Release(){if(this._collisionPoly){this._collisionPoly.Release();this._collisionPoly=null}this._imageInfo.Release();this._imageInfo=
null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(name){return this._imagePointsByName.get(name.toLowerCase())||null}GetImagePointByIndex(index){index=Math.floor(index);if(index<0||index>=this._imagePoints.length)return null;return this._imagePoints[index]}GetImagePointCount(){return this._imagePoints.length}GetTag(){return this._tag}GetIAnimationFrame(){return this._iAnimationFrame}};

}

// objects/imagePoint.js
{
'use strict';const C3=self.C3;C3.ImagePoint=class ImagePoint extends C3.DefendedBase{constructor(afi,data){super();this._afi=afi;this._name=data[0];this._pos=C3.New(C3.Vector2,data[1],data[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}};

}

// objects/objectClass.js
{
'use strict';const C3=self.C3;const C3Debugger=self.C3Debugger;const IObjectClass=self.IObjectClass;const assert=self.assert;
C3.ObjectClass=class ObjectClass extends C3.DefendedBase{constructor(runtime,index,data){super();const PluginCtor=runtime.GetObjectReference(data[1]);this._runtime=runtime;this._plugin=C3.AddonManager.GetPluginByConstructorFunction(PluginCtor);this._sdkType=null;this._instSdkCtor=PluginCtor.Instance;this._index=index;this._sid=data[11];this._name=data[0];this._jsPropName=this._runtime.GetJsPropName(data[14]);this._isGlobal=!!data[9];this._isFamily=!!data[2];this._isOnLoaderLayout=!!data[10];this._instVars=
data[3].map(arr=>({sid:arr[0],type:arr[1],name:arr[2],jsPropName:runtime.GetJsPropName(arr[3])}));this._behaviorsCount=data[4];this._effectsCount=data[5];this._isWorldType=this._plugin.IsWorldType();this._dispatcher=C3.New(C3.Event.Dispatcher);this._effectList=null;const [collisionCellWidth,collisionCellHeight]=runtime.GetCollisionEngine().GetCollisionCellSize();this._collisionGrid=C3.New(C3.SparseGrid,collisionCellWidth,collisionCellHeight);this._anyCollisionCellChanged=true;this._anyInstanceParallaxed=
false;this._familyMembers=null;this._familyMembersSet=null;this._familyIndex=-1;this._families=null;this._familiesSet=null;this._familyInstVarMap=null;this._familyBehaviorMap=null;this._familyEffectMap=null;this._isInContainer=false;this._container=null;this._behaviorTypes=data[8].map(behaviorTypeData=>C3.BehaviorType.Create(this,behaviorTypeData));this._behaviorTypesIncludingInherited=[];this._behaviorsByName=new Map;this._behaviorNameToIndex=new Map;this._usedBehaviorCtors=new Set;this._customActionMap=
new Map;this._solStack=C3.New(C3.SolStack,this);this._defaultInstanceData=null;this._defaultLayerIndex=0;this._isContained=false;this._container=null;this._imageInfo=null;this._animations=null;this._animationsByName=null;this._animationsBySid=null;this._textureRefCount=0;this._savedData=new Map;this._unsavedData=new Map;this._instances=[];this._iidsStale=true;if(this._plugin.HasEffects())this._effectList=C3.New(C3.EffectList,this,data[12]);if(data[6]){this._imageInfo=C3.New(C3.ImageInfo);this._imageInfo.LoadData(data[6])}if(data[7]){this._animations=
data[7].map(animData=>C3.New(C3.AnimationInfo,animData));this._animationsByName=new Map;this._animationsBySid=new Map;for(const anim of this._animations){this._animationsByName.set(anim.GetName().toLowerCase(),anim);this._animationsBySid.set(anim.GetSID(),anim)}}if(this._isFamily){this._familyMembers=[];this._familyMembersSet=new Set;this._familyIndex=this._runtime._GetNextFamilyIndex()}else{this._families=[];this._familiesSet=new Set;this._familyInstVarMap=[];this._familyBehaviorMap=[];this._familyEffectMap=
[]}const sdkVersion=this._plugin.GetSdkVersion();if(sdkVersion<2){this._sdkType=C3.New(PluginCtor.Type,this,data[15]);if(!(this._sdkType instanceof C3.SDKTypeBase))throw new Error("v1 sdk type must derive from SDKTypeBase");}this._iObjectClass=null;this._instanceUserScriptClass=null;this._userScriptDispatcher=C3.New(C3.Event.Dispatcher);C3.AddonManager._PushInitObject(this,sdkVersion);let CustomScriptClass;if(sdkVersion>=2){CustomScriptClass=PluginCtor.Type;if(!CustomScriptClass)CustomScriptClass=
globalThis.ISDKObjectTypeBase}else CustomScriptClass=this._sdkType.GetScriptInterfaceClass();if(CustomScriptClass){this._iObjectClass=new CustomScriptClass(sdkVersion<2?this:null);if(sdkVersion<2&&!(this._iObjectClass instanceof IObjectClass))throw new TypeError("script interface class must derive from IObjectClass");if(sdkVersion>=2&&!(this._iObjectClass instanceof globalThis.ISDKObjectTypeBase))throw new TypeError("script interface class must derive from ISDKObjectTypeBase");}else this._iObjectClass=
new IObjectClass;C3.AddonManager._PopInitObject(sdkVersion);if(data[13]){const tilemapData=data[13];if(tilemapData){const tilePolyData=tilemapData[0];const maxTileIndex=tilemapData[1];const brushData=tilemapData[2];this._sdkType.LoadTilemapData(tilePolyData,maxTileIndex,brushData)}}if(!this._runtime.UsesLoaderLayout()||this._isFamily||this._isOnLoaderLayout||!this._isWorldType)this.OnCreate();if(this._plugin.IsSingleGlobal()){this._plugin._SetSingleGlobalObjectClass(this);this._CreateSingleGlobalInstance(data)}this._loadInstancesJson=
null}static Create(runtime,index,objectClassData){return C3.New(C3.ObjectClass,runtime,index,objectClassData)}Release(){this._dispatcher.Release();this._dispatcher=null;if(this._imageInfo){this._imageInfo.Release();this._imageInfo=null}if(this._animations){for(const a of this._animations)a.Release();C3.clearArray(this._animations);this._animationsByName.clear();this._animationsBySid.clear()}this._loadInstancesJson=null;this._solStack.Release();this._solStack=null;this._savedData.clear();this._unsavedData.clear();
this._container=null;this._runtime=null}_LoadFamily(familyData){for(let i=1,len=familyData.length;i<len;++i){const memberType=this._runtime.GetObjectClassByIndex(familyData[i]);this._familyMembers.push(memberType);this._familyMembersSet.add(memberType);memberType._families.push(this);memberType._familiesSet.add(this)}}_SetContainer(container){this._isInContainer=true;this._container=container}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){let index=
0;if(!this._isFamily)for(const family of this._families)for(const familyBehType of family.GetBehaviorTypes()){const lowerName=familyBehType.GetName().toLowerCase();this._behaviorsByName.set(lowerName,familyBehType);this._behaviorNameToIndex.set(lowerName,index);this._behaviorTypesIncludingInherited.push(familyBehType);++index}for(const behaviorType of this.GetBehaviorTypes()){const lowerName=behaviorType.GetName().toLowerCase();this._behaviorsByName.set(lowerName,behaviorType);this._behaviorNameToIndex.set(lowerName,
index);this._behaviorTypesIncludingInherited.push(behaviorType);++index}for(const behaviorType of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(behaviorType.GetBehavior().constructor);if(!this._isFamily&&this._families.length){const familyCount=this._runtime.GetFamilyCount();C3.extendArray(this._familyInstVarMap,familyCount,0);C3.extendArray(this._familyBehaviorMap,familyCount,0);C3.extendArray(this._familyEffectMap,familyCount,0);const allFx=[];let ivSum=0;let behSum=0;let fxSum=
0;for(const family of this._families){const familyIndex=family.GetFamilyIndex();this._familyInstVarMap[familyIndex]=ivSum;ivSum+=family.GetInstanceVariablesCount();this._familyBehaviorMap[familyIndex]=behSum;behSum+=family.GetBehaviorTypesCount();this._familyEffectMap[familyIndex]=fxSum;fxSum+=family.GetEffectTypesCount();const familyEffectList=family.GetEffectList();if(familyEffectList&&this._effectList)for(const effectType of familyEffectList.GetAllEffectTypes())allFx.push(effectType.Clone(this._effectList))}if(this._effectList)this._effectList.PrependEffectTypes(allFx)}}_CreateSingleGlobalInstance(data){const uid=
this._runtime._GetNewUID();const inst=C3.New(C3.Instance,{runtime:this._runtime,objectType:this,uid:uid});inst._CreateSdkInstance(data[16],[]);this._runtime._MapInstanceByUID(uid,inst);this._instances.push(inst)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}Dispatcher(){return this._dispatcher}OnCreate(){if(this._isFamily)return;if(this._sdkType)this._sdkType.OnCreate();else this._iObjectClass._onCreate()}HasLoadedTextures(){return this._textureRefCount>0}async LoadTextures(renderer){if(this._isFamily)return;
this._textureRefCount++;if(this._textureRefCount===1)if(this._sdkType)await this._sdkType.LoadTextures(renderer);else await this._iObjectClass._loadTextures(this._runtime.GetCanvasManager().GetIRenderer())}ReleaseTextures(){if(this._isFamily)return;this._textureRefCount--;if(this._textureRefCount<0)throw new Error("released textures too many times");if(this._textureRefCount===0)if(this._sdkType)this._sdkType.ReleaseTextures();else this._iObjectClass._releaseTextures(this._runtime.GetCanvasManager().GetIRenderer())}OnDynamicTextureLoadComplete(){if(this._isFamily)throw new Error("not applicable to family");
if(this._sdkType)this._sdkType.OnDynamicTextureLoadComplete();else this._iObjectClass._onDynamicTextureLoadComplete()}async PreloadTexturesWithInstances(renderer){if(this._isFamily)return;if(this._sdkType)await this._sdkType.PreloadTexturesWithInstances(renderer);else await this._iObjectClass._preloadTexturesWithInstances(this._runtime.GetCanvasManager().GetIRenderer())}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(Ctor){return Ctor&&
this._usedBehaviorCtors.has(Ctor)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map(iv=>iv.sid)}GetInstanceVariableIndexBySID(sid){return this._instVars.findIndex(iv=>iv.sid===sid)}GetInstanceVariableIndexByName(name){return this._instVars.findIndex(iv=>iv.name===name)}_GetAllInstanceVariableNames(){return this._instVars.map(iv=>iv.name)}_GetAllInstanceVariableJsPropNames(){return this._instVars.map(iv=>iv.jsPropName)}GetInstanceVariableType(i){i=
Math.floor(i);if(i<0||i>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[i].type}GetInstanceVariableName(i){i=Math.floor(i);if(i<0||i>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[i].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(name){return this._behaviorsByName.get(name.toLowerCase())||
null}GetBehaviorIndexByName(name){const ret=this._behaviorNameToIndex.get(name.toLowerCase());if(typeof ret==="undefined")return-1;else return ret}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(d){this._defaultInstanceData=d}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(i){this._defaultLayerIndex=
i}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(family){return this._familiesSet.has(family)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(objectType){return this._familyMembersSet.has(objectType)}GetFamilyBehaviorOffset(familyIndex){return this._familyBehaviorMap[familyIndex]}GetFamilyInstanceVariableOffset(familyIndex){return this._familyInstVarMap[familyIndex]}AddCustomAction(customAceBlock){this._customActionMap.set(customAceBlock.GetACEName().toLowerCase(),
customAceBlock)}HasOwnCustomActionByName(name){return!!this.GetOwnCustomActionByName(name)}GetOwnCustomActionByName(name){const ret=this._customActionMap.get(name.toLowerCase());return ret&&ret.IsEnabled()?ret:null}GetAllAnimations(){return this._animations}GetAnimationByName(name){if(!this._animations)throw new Error("no animations");return this._animationsByName.get(name.toLowerCase())||null}GetAnimationBySID(sid){if(!this._animations)throw new Error("no animations");return this._animationsBySid.get(sid)||
null}AddAnimation(name){if(this.GetAnimationByName(name))throw new Error(`animation name '${name}' already exists`);const anim=C3.AnimationInfo.CreateDynamic(this.GetRuntime(),name);this._animations.push(anim);this._animationsByName.set(anim.GetName().toLowerCase(),anim);this._animationsBySid.set(anim.GetSID(),anim);return anim}RemoveAnimation(name){const anim=this.GetAnimationByName(name);if(!anim)throw new Error(`animation name '${name}' does not exist`);if(this._animations.length===1)throw new Error(`cannot remove last animation`);
const i=this._animations.indexOf(anim);this._animations.splice(i,1);this._animationsByName.delete(anim.GetName().toLowerCase());this._animationsBySid.delete(anim.GetSID());anim.Release()}GetFirstAnimation(){if(!this._animations)throw new Error("no animations");return this._animations[0]}GetFirstAnimationFrame(){return this.GetFirstAnimation().GetFrameAt(0)}GetDefaultInstanceSize(){if(this._animations){const firstFrameInfo=this.GetFirstAnimationFrame().GetImageInfo();return[firstFrameInfo.GetWidth(),
firstFrameInfo.GetHeight()]}else if(this._imageInfo)return[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()];else return[100,100]}GetSingleGlobalInstance(){if(!this._plugin.IsSingleGlobal())throw new Error("not a single-global plugin");return this._instances[0]}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances;yield*this._runtime.instancesPendingCreateForObjectClass(this)}GetInstanceCount(){return this._instances.length}_AddInstance(inst){this._instances.push(inst)}_SetIIDsStale(){this._iidsStale=
true}_UpdateIIDs(){if(!this._iidsStale||this._isFamily)return;const instances=this._instances;let i=0;for(let len=instances.length;i<len;++i)instances[i]._SetIID(i);const instancesPendingCreate=this._runtime._GetInstancesPendingCreate();for(const inst of instancesPendingCreate)if(inst.GetObjectClass()===this)inst._SetIID(i++);this._iidsStale=false}GetInstanceByIID(i){const instances=this._instances;if(i<instances.length)return instances[i];i-=instances.length;const instancesPendingCreate=this._runtime._GetInstancesPendingCreate();
for(const inst of instancesPendingCreate)if(inst.GetObjectClass()===this){if(i===0)return inst;--i}return null}GetFirstPicked(fromInst){if(fromInst&&fromInst.IsInContainer()&&fromInst.GetObjectClass()!==this)for(const s of fromInst.siblings())if(s.GetObjectClass()===this)return s;const instances=this.GetCurrentSol().GetInstances();if(instances.length)return instances[0];else return null}GetPairedInstance(inst){const instances=this.GetCurrentSol().GetInstances();if(instances.length>0)return instances[inst.GetIID()%
instances.length];else return null}*allCorrespondingInstances(inst,objectClass){const myInstances=this.GetCurrentSol().GetInstances();const myInstanceCount=myInstances.length;const otherSol=objectClass.GetCurrentSol();const otherInstances=objectClass.GetCurrentSol().GetInstances();const otherInstanceCount=otherInstances.length;let index=inst.GetIID();if(objectClass.IsFamily()||!otherSol.IsSelectAll())index=otherInstances.indexOf(inst);const divisor=Math.ceil(myInstanceCount/otherInstanceCount);const remainder=
myInstanceCount%otherInstanceCount;let startIndex=0;let correspondCount=0;if(remainder===0||index<remainder){startIndex=index*divisor;correspondCount=divisor}else{startIndex=remainder*divisor+(index-remainder)*(divisor-1);correspondCount=divisor-1}for(let i=startIndex,end=startIndex+correspondCount;i<end;++i)yield myInstances[i]}FinishCondition(f){this._sdkType?.FinishCondition(f)}ApplySolToContainer(){if(!this._isInContainer||this._isFamily)return;this._UpdateIIDs();const sol1=this.GetCurrentSol();
const sol1instances=sol1._GetOwnInstances();const selectAll=sol1.IsSelectAll();const es=this._runtime.GetCurrentEventStackFrame();const isOrBlock=es&&es.GetCurrentEvent()&&es.GetCurrentEvent().IsOrBlock();for(const containerType of this._container.objectTypes()){if(containerType===this)continue;containerType._UpdateIIDs();const sol2=containerType.GetCurrentSol();sol2._SetSelectAll(selectAll);if(!selectAll){const sol2instances=sol2._GetOwnInstances();C3.clearArray(sol2instances);for(const inst of sol1instances)sol2instances.push(containerType.GetInstanceByIID(inst.GetIID()));
if(isOrBlock){const sol1elseInstances=sol1._GetOwnElseInstances();const sol2elseInstances=sol2._GetOwnElseInstances();C3.clearArray(sol2elseInstances);for(const inst of sol1elseInstances)sol2elseInstances.push(containerType.GetInstanceByIID(inst.GetIID()))}}}}_TruncateContainerSols(useElseInstances,i){for(const containerType of this.GetContainer().objectTypes()){const sol=containerType.GetCurrentSol();if(useElseInstances)C3.truncateArray(sol._GetOwnElseInstances(),i);else C3.truncateArray(sol._GetOwnInstances(),
i)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(c){this._anyCollisionCellChanged=!!c}_SetAnyInstanceParallaxed(p){this._anyInstanceParallaxed=!!p}IsAnyInstanceParallaxed(){return this._anyInstanceParallaxed}_UpdateAllCollisionCells(){if(!this._anyCollisionCellChanged||!this._isWorldType)return;for(const inst of this._instances)inst.GetWorldInfo()._UpdateCollisionCell();for(const inst of this._runtime._GetInstancesPendingCreate())if(inst.GetObjectClass()===this)inst.GetWorldInfo()._UpdateCollisionCell();
this._anyCollisionCellChanged=false}GetSavedDataMap(){if(!this._savedData)this._savedData=new Map;return this._savedData}GetUnsavedDataMap(){if(!this._unsavedData)this._unsavedData=new Map;return this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(C3.Behaviors.solid)}HasJumpthruBehavior(){return this.UsesBehaviorByCtor(C3.Behaviors.jumpthru)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(C3.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(C3.Behaviors.Persist)}_SaveToJson(){const o=
{"instances":this._instances.map(inst=>inst.SaveToJson())};if(this._savedData&&this._savedData.size)o["ex"]=C3.ToSuperJSON(this._savedData);return o}_LoadFromJson(o){if(this._savedData){this._savedData.clear();this._savedData=null}const ex=o["ex"];if(ex)this._savedData=C3.FromSuperJSON(ex);const existingInstances=this._instances;const loadInstances=o["instances"];for(let i=0,len=Math.min(existingInstances.length,loadInstances.length);i<len;++i)existingInstances[i].LoadFromJson(loadInstances[i]);for(let i=
loadInstances.length,len=existingInstances.length;i<len;++i)this._runtime.DestroyInstance(existingInstances[i]);for(let i=existingInstances.length,len=loadInstances.length;i<len;++i){const data=loadInstances[i];let layer=null;if(this.IsWorldType()){layer=this._runtime.GetMainRunningLayout().GetLayerBySID(data["w"]["l"]);if(!layer)continue}const inst=this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,layer,false,0,0,true);inst.LoadFromJson(data)}this._loadInstancesJson=loadInstances;
this._SetIIDsStale()}_GetLoadInstancesJson(){return this._loadInstancesJson}_ClearLoadInstancesJson(){this._loadInstancesJson=null}_SetupSceneGraphConnectionsOnChangeOfLayout(){for(let i=0,len=this._instances;i<len;++i)this._instances[i]._SetupSceneGraphConnectionsOnChangeOfLayout()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(Class){this._instanceUserScriptClass=
Class}DispatchUserScriptEvent(e){const runtime=this._runtime;const shouldTime=runtime.IsDebug()&&!runtime.GetEventSheetManager().IsInEventEngine();if(shouldTime)C3Debugger.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(e);if(shouldTime)C3Debugger.AddScriptTime()}};

}

// objects/container.js
{
'use strict';const C3=self.C3;C3.Container=class Container extends C3.DefendedBase{constructor(runtime,objectTypes){super();this._runtime=runtime;this._objectTypes=objectTypes;for(const objectType of this._objectTypes)objectType._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some(o=>o.IsWorldType())}};

}

// objects/instance.js
{
'use strict';const C3=self.C3;const C3Debugger=self.C3Debugger;const IInstance=self.IInstance;const originalAddonManager=C3.AddonManager;const EMPTY_ARRAY=[];let nextPuid=0;const savedDataMaps=new WeakMap;const unsavedDataMaps=new WeakMap;const FLAG_DESTROYED=1<<0;const FLAG_TILEMAP=1<<1;const FLAG_MUST_PREDRAW=1<<2;const FLAG_SOLID_ENABLED=1<<3;const FLAG_JUMPTHRU_ENABLED=1<<4;const FLAG_MUST_MITIGATE_Z_FIGHTING=1<<5;const FLAG_IS_DRAWING_WITH_EFFECTS=1<<6;
C3.Instance=class Instance extends C3.DefendedBase{constructor(opts){if(C3.AddonManager!==originalAddonManager)throw new Error(`invalid addon manager`);super();this._runtime=opts.runtime;this._objectType=opts.objectType;this._worldInfo=null;this._sdkInst=null;this._iScriptInterface=null;this._iid=0;this._uid=opts.uid;this._puid=nextPuid++;this._flags=0;this._instVarValues=EMPTY_ARRAY;this._behaviorInstances=EMPTY_ARRAY;const behaviorTypes=this._objectType.GetBehaviorTypesIncludingInherited();if(behaviorTypes.length>
0)this._behaviorInstances=behaviorTypes.map((behaviorType,index)=>C3.New(C3.BehaviorInstance,{runtime:this._runtime,behaviorType:behaviorType,instance:this,index}));this._siblings=this._objectType.IsInContainer()?[]:null;this._timeScale=-1;this._dispatcher=null;const plugin=this.GetPlugin();if(plugin.MustPreDraw())this._flags|=FLAG_MUST_PREDRAW;if(plugin.IsWorldType()){this._worldInfo=C3.New(C3.WorldInfo,this,opts.layer);if(opts.worldData)this._worldInfo.Init(opts.worldData);else{this._worldInfo.InitNoData();
const [width,height]=this._objectType.GetDefaultInstanceSize();this._worldInfo.SetSize(width,height);if(this.GetObjectClass().UsesEffects())this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters()}}if(opts.instVarData)this._LoadInstanceVariableData(opts.instVarData);else this._LoadDefaultInstanceVariables()}Release(){if(this._iScriptInterface){this._iScriptInterface._release();this._iScriptInterface=null}if(this._behaviorInstances.length>0){for(const behInst of this._behaviorInstances)behInst.Release();
C3.clearArray(this._behaviorInstances)}if(this._sdkInst){this._sdkInst.Release();this._sdkInst=null}const savedData=savedDataMaps.get(this);if(savedData){savedData.clear();savedDataMaps.delete(this)}const unsavedData=unsavedDataMaps.get(this);if(unsavedData){unsavedData.clear();unsavedDataMaps.delete(this)}if(this._siblings)C3.clearArray(this._siblings);if(this._dispatcher){this._dispatcher.Release();this._dispatcher=null}this._runtime=null;this._objectType=null;if(this._instVarValues.length>0)C3.clearArray(this._instVarValues);
if(this._worldInfo){this._worldInfo.Release();this._worldInfo=null}}_LoadInstanceVariableData(instVarData){if(instVarData.length>0){this._instVarValues=[];C3.shallowAssignArray(this._instVarValues,instVarData)}}_LoadDefaultInstanceVariables(){const len=this._objectType.GetInstanceVariablesCount();if(len===0)return;this._instVarValues=[];const typeToInitValue=[0,0,""];for(let i=0;i<len;++i)this._instVarValues.push(typeToInitValue[this._objectType.GetInstanceVariableType(i)])}_CreateSdkInstance(properties,
behInstProperties){if(this._sdkInst)throw new Error("already got sdk instance");for(let i=0,len=this._behaviorInstances.length;i<len;++i){const behInst=this._behaviorInstances[i];behInst._CreateSdkInstance(behInstProperties?behInstProperties[i]:null)}const sdkVersion=this.GetPlugin().GetSdkVersion();if(sdkVersion<2){this._sdkInst=C3.New(this._objectType.GetInstanceSdkCtor(),this,properties);if(!(this._sdkInst instanceof C3.SDKInstanceBase))throw new Error("sdk type must derive from SDKInstanceBase");
if(!this.GetPlugin().IsWorldType()&&this._objectType._GetUserScriptInstanceClass())this.GetInterfaceClass()}else{const PluginCtor=this.GetPlugin().GetScriptInterfaceClass();this._InitUserScriptInterface(PluginCtor.Instance,properties)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){const ts=this._timeScale;if(ts===-1)return this.GetRuntime().GetTimeScale();
else return ts}SetTimeScale(ts){ts=+ts;if(ts<0||!isFinite(ts))ts=0;this._timeScale=ts;if(this.GetObjectClass().UsesEffects())this._runtime._SetTrackingInstanceTime(this,true)}RestoreTimeScale(){this._timeScale=-1;if(this.GetObjectClass().UsesEffects())this._runtime._SetTrackingInstanceTime(this,false)}GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this)}Dispatcher(){if(!this._dispatcher)this._dispatcher=C3.New(C3.Event.Dispatcher);return this._dispatcher}Draw(renderer){if(this._sdkInst)this._sdkInst.Draw(renderer);
else this._iScriptInterface._draw(this._runtime.GetCanvasManager().GetIRenderer())}OnCreate(properties){this._sdkInst.OnCreate(properties)}_SetHasTilemap(){this._flags|=FLAG_TILEMAP}HasTilemap(){return(this._flags&FLAG_TILEMAP)!==0}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}IsDestroyed(){return(this._flags&FLAG_DESTROYED)!==0}MustPreDraw(){return(this._flags&FLAG_MUST_PREDRAW)!==0||this._sdkInst.MustPreDraw()}SetMustMitigateZFighting(){this._flags|=FLAG_MUST_MITIGATE_Z_FIGHTING}MustMitigateZFighting(){return(this._flags&
FLAG_MUST_MITIGATE_Z_FIGHTING)!==0}_IsSolidEnabled(){return(this._flags&FLAG_SOLID_ENABLED)!==0}_SetSolidEnabled(e){if(e)this._flags|=FLAG_SOLID_ENABLED;else this._flags&=~FLAG_SOLID_ENABLED}_IsJumpthruEnabled(){return(this._flags&FLAG_JUMPTHRU_ENABLED)!==0}_SetJumpthruEnabled(e){if(e)this._flags|=FLAG_JUMPTHRU_ENABLED;else this._flags&=~FLAG_JUMPTHRU_ENABLED}_IsDrawingWithEffects(){return(this._flags&FLAG_IS_DRAWING_WITH_EFFECTS)!==0}_SetIsDrawingWithEffects(e){if(e)this._flags|=FLAG_IS_DRAWING_WITH_EFFECTS;
else this._flags&=~FLAG_IS_DRAWING_WITH_EFFECTS}SetFlag(bit,enable){bit<<=16;if(enable)this._flags|=bit;else this._flags&=~bit}GetFlag(bit){return(this._flags&bit<<16)!==0}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(nameOrIndex){return this._sdkInst.GetImagePoint(nameOrIndex)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(objectClass){if(objectClass.IsFamily())return objectClass.FamilyHasMember(this.GetObjectClass());
else return this.GetObjectClass()===objectClass}CollectInstancesToPick(pickMap,createdObjectClass,includeHierarchy){const addInst=(inst,objectClass_)=>{const objectClass=objectClass_||inst.GetObjectClass();const instSet=pickMap.get(objectClass);if(instSet)instSet.add(inst);else pickMap.set(objectClass,new Set([inst]))};addInst(this,createdObjectClass);if(this.IsInContainer())for(const s of this.siblings())addInst(s);if(includeHierarchy)for(const c of this.allChildren())addInst(c)}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw new Error("object does not support scene graph");
}HasParent(){return this.GetParent()!==null}GetParent(){const wi=this.GetWorldInfo();if(!wi)return null;const parentWi=wi.GetParent();return parentWi?parentWi.GetInstance():null}GetTopParent(){const wi=this.GetWorldInfo();if(!wi)return null;const parentWi=wi.GetTopParent();return parentWi?parentWi.GetInstance():null}*parents(){const wi=this.GetWorldInfo();if(!wi)return;for(const parentWi of wi.parents())yield parentWi.GetInstance()}HasChild(child){if(!child)return false;for(const c of this.children())if(c===
child)return true;return false}HasChildren(){const wi=this.GetWorldInfo();return wi?wi.HasChildren():false}GetChildrenOfObjectClass(objectClass){const wi=this.GetWorldInfo();if(!wi)return[];const objectClassName=objectClass.GetName();return wi.GetChildren().map(wi=>wi.GetInstance()).filter(i=>i.GetObjectClass().GetName()===objectClassName)}GetChildren(){const wi=this.GetWorldInfo();if(!wi)return[];return wi.GetChildren().map(wi=>wi.GetInstance())}*children(){const wi=this.GetWorldInfo();if(!wi)return;
for(const childWi of wi.children())yield childWi.GetInstance()}*allChildren(){const wi=this.GetWorldInfo();if(!wi)return;for(const childWi of wi.allChildren())yield childWi.GetInstance()}GetChildCount(){const wi=this.GetWorldInfo();return wi?wi.GetChildCount():0}GetParentCount(){return[...this.parents()].length}GetAllChildCount(){const wi=this.GetWorldInfo();return wi?wi.GetAllChildCount():0}GetChildAt(index){const wi=this.GetWorldInfo();if(!wi)return null;const childWi=wi.GetChildAt(index);return childWi?
childWi.GetInstance():null}GetIndexInParent(){const wi=this.GetWorldInfo();if(!wi)return NaN;const p=wi.GetParent();if(!p)return NaN;return p.GetChildIndex(wi)}AddChild(childInst,opts){this.VerifySupportsSceneGraph();childInst.VerifySupportsSceneGraph();this.GetWorldInfo().AddChild(childInst.GetWorldInfo(),opts||{})}RemoveChild(childInst){const wi=this.GetWorldInfo();if(!wi)return;wi.RemoveChild(childInst.GetWorldInfo())}GetDestroyWithParent(){const wi=this.GetWorldInfo();return wi?wi.GetDestroyWithParent():
false}SetupInitialSceneGraphConnections(){const wi=this.GetWorldInfo();if(!wi)return;const childrenData=wi.GetSceneGraphChildrenExportData();if(!childrenData)return;for(const childData of childrenData){const child=this._runtime.GetInstanceByUID(childData[2]);if(child){const flags=childData[3];this.AddChild(child,{transformX:!!(flags>>0&1),transformY:!!(flags>>1&1),transformWidth:!!(flags>>2&1),transformHeight:!!(flags>>3&1),transformAngle:!!(flags>>4&1),destroyWithParent:!!(flags>>5&1),transformZElevation:!!(flags>>
6&1),transformOpacity:!!(flags>>7&1),transformVisibility:!!(flags>>8&1)})}}}SetupPersistedSceneGraphConnections(instanceToPersistedDataMap,persistedIndexToInstanceMap){const persistedData=instanceToPersistedDataMap.get(this);if(!persistedData)return;for(const persistedChildData of persistedData["sceneGraphJson"]["children"]){const child=persistedIndexToInstanceMap.get(persistedChildData["index"]);if(!child)continue;const flags=persistedChildData["flags"];this.AddChild(child,{transformX:!!(flags>>
0&1),transformY:!!(flags>>1&1),transformWidth:!!(flags>>2&1),transformHeight:!!(flags>>3&1),transformAngle:!!(flags>>4&1),destroyWithParent:!!(flags>>5&1),transformZElevation:!!(flags>>6&1),transformOpacity:!!(flags>>7&1),transformVisibility:!!(flags>>8&1)})}}GetTemplateName(){const templateManager=this._runtime.GetTemplateManager();return templateManager?templateManager.GetInstanceTemplateName(this):""}IsInContainer(){return this._siblings!==null}_AddSibling(inst){this._siblings.push(inst)}GetSiblings(){return this._siblings}HasSibling(objectClass){return!!this.GetSibling(objectClass)}GetSibling(objectClass){const siblings=
this.siblings();if(siblings===null||siblings.length===0)return false;for(const s of siblings)if(s.GetObjectClass()===objectClass)return s;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(const s of this.siblings())s.GetObjectClass().GetCurrentSol().SetSinglePicked(s)}_PushSiblingsToSolInstances(){for(const s of this.siblings())s.GetObjectClass().GetCurrentSol()._PushInstance(s)}_SetSiblingsToSolInstancesIndex(i){for(const s of this.siblings())s.GetObjectClass().GetCurrentSol()._GetOwnInstances()[i]=
s}_PushSiblingsToSolElseInstances(){for(const s of this.siblings())s.GetObjectClass().GetCurrentSol()._PushElseInstance(s)}_SetSiblingsToSolElseInstancesIndex(i){for(const s of this.siblings())s.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[i]=s}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(i){this._iid=i}GetIID(){this._objectType._UpdateIIDs();return this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(ctor){if(!ctor)return null;
for(const behInst of this._behaviorInstances)if(behInst.GetBehavior()instanceof ctor)return behInst;return null}GetBehaviorSdkInstanceFromCtor(ctor){if(!ctor)return null;const behInst=this.GetBehaviorInstanceFromCtor(ctor);if(behInst)return behInst.GetSdkInstance();else return null}GetBehaviorIndexBySID(sid){const behaviorInstances=this._behaviorInstances;for(let i=0,len=behaviorInstances.length;i<len;++i)if(behaviorInstances[i].GetBehaviorType().GetSID()===sid)return i;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(index){index=
index|0;const instVarValues=this._instVarValues;if(index<0||index>=instVarValues.length)throw new RangeError("invalid instance variable");return instVarValues[index]}_GetInstanceVariableValueUnchecked(index){return this._instVarValues[index]}_GetInstanceVariableTypedValue(index){const ret=this._instVarValues[index];if(this._objectType.GetInstanceVariableType(index)===0)return!!ret;else return ret}SetInstanceVariableValue(index,value){index=index|0;const instVarValues=this._instVarValues;if(index<
0||index>=instVarValues.length)throw new RangeError("invalid instance variable");const type=this._objectType.GetInstanceVariableType(index);switch(type){case 0:instVarValues[index]=value?1:0;break;case 1:instVarValues[index]=typeof value==="number"?value:parseFloat(value);break;case 2:instVarValues[index]=typeof value==="string"?value:value.toString();break;default:throw new Error("unknown instance variable type");}}SetInstanceVariableOffset(index,offset){if(offset===0)return;index=index|0;const instVarValues=
this._instVarValues;if(index<0||index>=instVarValues.length)throw new RangeError("invalid instance variable");const lastValue=instVarValues[index];if(typeof lastValue==="number")if(typeof offset==="number")instVarValues[index]+=offset;else instVarValues[index]+=parseFloat(offset);else if(typeof lastValue==="boolean")throw new Error("can not set offset of boolean variable");else if(typeof lastValue==="string")throw new Error("can not set offset of string variable");else throw new Error("unknown instance variable type");
}GetSavedDataMap(){let ret=savedDataMaps.get(this);if(ret)return ret;ret=new Map;savedDataMaps.set(this,ret);return ret}GetUnsavedDataMap(){let ret=unsavedDataMaps.get(this);if(ret)return ret;ret=new Map;unsavedDataMaps.set(this,ret);return ret}_HasAnyCreateDestroyHandler(name){const objectType=this.GetObjectClass();if(objectType.UserScriptDispatcher().HasAnyHandlerFor(name))return true;for(const family of objectType.GetFamilies())if(family.UserScriptDispatcher().HasAnyHandlerFor(name))return true;
if(this._runtime.UserScriptDispatcher().HasAnyHandlerFor(name))return true;return false}_TriggerOnCreatedOnSelfAndRelated(){const instancesToTriggerOnCreated=new Set;instancesToTriggerOnCreated.add(this);const wi=this.GetWorldInfo();if(wi&&wi.HasChildren())for(const c of this.allChildren()){instancesToTriggerOnCreated.add(c);if(!c.IsInContainer())continue;for(const s of c.siblings())instancesToTriggerOnCreated.add(s)}if(this.IsInContainer())for(const s of this.siblings())instancesToTriggerOnCreated.add(s);
for(const instance of instancesToTriggerOnCreated.values())instance._TriggerOnCreated()}_TriggerOnCreated(){if(this._objectType._GetUserScriptInstanceClass())this.GetInterfaceClass();for(const bInst of this._behaviorInstances)bInst.PostCreate();if(this._HasAnyCreateDestroyHandler("instancecreate")){const objectType=this.GetObjectClass();const instCreateEvent=new C3.Event("instancecreate");instCreateEvent.instance=this.GetInterfaceClass();objectType.DispatchUserScriptEvent(instCreateEvent);for(const family of objectType.GetFamilies())family.DispatchUserScriptEvent(instCreateEvent);
this._runtime.DispatchUserScriptEvent(instCreateEvent)}this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(isEndingLayout){if(this._iScriptInterface){const e=new C3.Event("destroy");e.isEndingLayout=isEndingLayout;this.DispatchUserScriptEvent(e)}if(!this._HasAnyCreateDestroyHandler("instancedestroy"))return;const objectType=this.GetObjectClass();
const instDestroyEvent=new C3.Event("instancedestroy");instDestroyEvent.instance=this.GetInterfaceClass();instDestroyEvent.isEndingLayout=isEndingLayout;objectType.DispatchUserScriptEvent(instDestroyEvent);for(const family of objectType.GetFamilies())family.DispatchUserScriptEvent(instDestroyEvent);this._runtime.DispatchUserScriptEvent(instDestroyEvent)}_GetDebuggerProperties(){if(this._sdkInst)return this._sdkInst.GetDebuggerProperties();else return this._iScriptInterface.getDebuggerProperties()}SaveToJson(mode=
"full",opts=null){const o={};if(mode==="full")o["uid"]=this.GetUID();else o["c3"]=true;if(mode!=="visual-state"){const savedData=savedDataMaps.get(this);if(savedData&&savedData.size)o["ex"]=C3.ToSuperJSON(savedData);if(this.GetTimeScale()!==-1)o["mts"]=this.GetTimeScale();if(this._objectType.GetInstanceVariablesCount()>0){const ivs={};const ivSids=this._objectType.GetInstanceVariableSIDs();for(let i=0,len=this._instVarValues.length;i<len;++i)ivs[ivSids[i].toString()]=this._instVarValues[i];o["ivs"]=
ivs}if(this._behaviorInstances.length){const behs={};for(const behInst of this._behaviorInstances){const data=behInst.SaveToJson(mode);if(data)behs[behInst.GetBehaviorType().GetSID().toString()]=data}o["behs"]=behs}}if(this._worldInfo)o["w"]=this._worldInfo._SaveToJson(mode,opts);const ownData=this._sdkInst?this._sdkInst.SaveToJson():this._iScriptInterface._saveToJson();if(ownData)o["data"]=ownData;return o}_OnBeforeLoad(mode="full"){if(this._worldInfo)this._worldInfo._OnBeforeLoad(mode)}_OnAfterLoad(o,
mode="full",opts=null){if(this._worldInfo)this._worldInfo._OnAfterLoad(o,mode,opts)}_OnAfterLoad2(o,mode="full",opts=null){if(this._worldInfo)this._worldInfo._OnAfterLoad2(o,mode,opts)}_SetupSceneGraphConnectionsOnChangeOfLayout(){if(!this.GetPlugin().IsWorldType())return;this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout()}LoadFromJson(o,mode="full"){if(mode==="full")this._uid=o["uid"];else if(!o["c3"])return;if(mode!=="visual-state"){let savedData=savedDataMaps.get(this);if(savedData){savedData.clear();
savedDataMaps.delete(this)}const ex=o["ex"];if(ex){savedData=C3.FromSuperJSON(ex);savedDataMaps.set(this,savedData)}this._timeScale=o.hasOwnProperty("mts")?o["mts"]:-1;const ivs=o["ivs"];if(ivs)for(const [sidStr,value]of Object.entries(ivs)){const sid=parseInt(sidStr,10);const index=this._objectType.GetInstanceVariableIndexBySID(sid);if(index<0||index>=this._instVarValues.length)continue;let v=value;if(v===null)v=NaN;this._instVarValues[index]=v}}if(this.GetPlugin().IsWorldType()){const worldData=
o["w"];if(worldData){const layerSid=worldData["l"];if(this._worldInfo.GetLayer().GetSID()!==layerSid){const oldLayer=this._worldInfo.GetLayer();const newLayer=oldLayer.GetLayout().GetLayerBySID(layerSid);if(newLayer){this._worldInfo._SetLayer(newLayer);oldLayer._RemoveInstance(this,true);newLayer._AddInstance(this,true);newLayer.SetZIndicesChanged(this);this._worldInfo.SetBboxChanged()}else if(mode==="full")this._runtime.DestroyInstance(this)}this._worldInfo._LoadFromJson(worldData,mode)}}if(mode!==
"visual-state"){const behs=o["behs"];if(behs)for(const [sidStr,data]of Object.entries(behs)){const sid=parseInt(sidStr,10);const index=this.GetBehaviorIndexBySID(sid);if(index<0||index>=this._behaviorInstances.length)continue;this._behaviorInstances[index].LoadFromJson(data,mode)}}const ownData=o["data"];if(ownData)if(this._sdkInst)this._sdkInst.LoadFromJson(ownData,mode);else this._iScriptInterface._loadFromJson(ownData)}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}_InitUserScriptInterface(AddonSdkScriptClass,
properties){const DefaultScriptClass=this._worldInfo?AddonSdkScriptClass?self.ISDKWorldInstanceBase:self.IWorldInstance:AddonSdkScriptClass?self.ISDKInstanceBase:self.IInstance;const SdkScriptClass=AddonSdkScriptClass||this._sdkInst.GetScriptInterfaceClass();const UserScriptClass=this._objectType._GetUserScriptInstanceClass();const ScriptInterfaceClass=UserScriptClass||SdkScriptClass||DefaultScriptClass;const sdkVersion=this.GetPlugin().GetSdkVersion();C3.AddonManager._PushInitObject(this,sdkVersion);
C3.AddonManager._PushInitProperties(properties);this._iScriptInterface=new ScriptInterfaceClass;C3.AddonManager._PopInitProperties();C3.AddonManager._PopInitObject(sdkVersion);if(SdkScriptClass&&!(this._iScriptInterface instanceof DefaultScriptClass))throw new TypeError(`script interface class '${SdkScriptClass.name}' does not extend the right base class '${DefaultScriptClass.name}'`);if(UserScriptClass){const ExpectedBaseClass=SdkScriptClass||DefaultScriptClass;if(!(this._iScriptInterface instanceof
ExpectedBaseClass))throw new TypeError(`setInstanceClass(): class '${UserScriptClass.name}' does not extend the right base class - check it extends the right class, e.g. globalThis.InstanceType.MyObjectName`);}return this._iScriptInterface}_GetInstVarsScriptDescriptor(instDescriptors){if(this._instVarValues.length===0)return;const varDescriptors={};const instVarJsPropNames=this._objectType._GetAllInstanceVariableJsPropNames();for(let i=0,len=instVarJsPropNames.length;i<len;++i)varDescriptors[instVarJsPropNames[i]]=
{configurable:false,enumerable:true,get:C3.Instance.prototype._GetInstanceVariableTypedValue.bind(this,i),set:C3.Instance.prototype.SetInstanceVariableValue.bind(this,i)};const instVarsObj=Object.create(Object.prototype,varDescriptors);instDescriptors.instVars={value:instVarsObj,writable:false}}_GetBehaviorsScriptDescriptor(instDescriptors){const behaviorInstances=this._behaviorInstances;if(behaviorInstances.length===0)return;const behDescriptors={};for(const behInst of behaviorInstances)behDescriptors[behInst.GetBehaviorType().GetJsPropName()]=
{value:behInst.GetScriptInterface(),writable:false};const behaviorsObj=Object.create(Object.prototype,behDescriptors);instDescriptors.behaviors={value:behaviorsObj,writable:false}}DispatchUserScriptEvent(e){if(!this.HasScriptInterface())return;const scriptInterface=this.GetInterfaceClass();e.instance=scriptInterface;const runtime=this._runtime;const shouldTime=runtime.IsDebug()&&!runtime.GetEventSheetManager().IsInEventEngine();if(shouldTime)C3Debugger.StartMeasuringScriptTime();scriptInterface.dispatchEvent(e);
if(shouldTime)C3Debugger.AddScriptTime()}};

}

// objects/sceneGraphInfo.js
{
'use strict';const C3=self.C3;
C3.SceneGraphInfo=class SceneGraphInfo extends C3.DefendedBase{constructor(owner){super();this._owner=owner;this._parent=null;this._children=[];this._startWidth=owner.GetWidth();this._startHeight=owner.GetHeight();this._startScaleX=1;this._startScaleY=1;this._parentStartAngle=0;this._ownOpacity=1;this._startOpacity=owner.GetOpacity();this._tmpSceneGraphChildren=null;this._tmpSceneGraphChildrenIndexes=null;this._indexInParent=NaN}Release(){this._parent=null;this._tmpSceneGraphChildren=null;this._tmpSceneGraphChildrenIndexes=
null;this._indexInParent=NaN;C3.clearArray(this._children)}SetParent(parent){this._ownOpacity=this._owner.GetOpacity();this._startOpacity=this._ownOpacity;this._parent=parent;this._parentStartAngle=parent?parent.GetAngle():0}GetParent(){return this._parent}HasChildren(){return this._children.length>0}GetChildren(){return this._children}_MaybeSortChildren(){if(!this.HasChildren())return;if(this._children.length===1)return;if(this._tmpSceneGraphChildrenIndexes)this._children.sort((f,s)=>{const fIndex=
this._tmpSceneGraphChildrenIndexes.get(f.GetInstance());const sIndex=this._tmpSceneGraphChildrenIndexes.get(s.GetInstance());if(C3.IsFiniteNumber(fIndex)&&C3.IsFiniteNumber(sIndex))return fIndex-sIndex;return 0});else this._children.sort((f,s)=>{const fIndex=f._GetSceneGraphInfo()._GetIndexInParent();const sIndex=s._GetSceneGraphInfo()._GetIndexInParent();if(C3.IsFiniteNumber(fIndex)&&C3.IsFiniteNumber(sIndex))return fIndex-sIndex;return 0})}_GetIndexInParent(){return this._indexInParent}GetStartScaleX(){return this._startScaleX}SetStartScaleX(sx){this._startScaleX=
sx}GetStartScaleY(){return this._startScaleY}SetStartScaleY(sy){this._startScaleY=sy}GetStartOpacity(){return this._startOpacity}GetOwnOpacity(){return this._ownOpacity}SetOwnOpacity(ownOpacity){this._ownOpacity=ownOpacity}_GetStartWidth(){if(this._startWidth===0)return Number.EPSILON;return this._startWidth}_GetStartHeight(){if(this._startHeight===0)return Number.EPSILON;return this._startHeight}GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){const p=this._parent;let cw=p.GetWidth();
let sw=p._GetSceneGraphInfo()._GetStartWidth();if(cw===0)cw=Number.EPSILON;if(sw===Number.EPSILON&&cw===Number.EPSILON)return 1;if(sw===Number.EPSILON&&cw!==Number.EPSILON){const sdkIntance=p.GetInstance().GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return 1+cw/sdkIntance.GetOriginalWidth()}return cw/sw}return 1}GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){const p=this._parent;let ch=p.GetHeight();let sh=p._GetSceneGraphInfo()._GetStartHeight();if(ch===0)ch=Number.EPSILON;
if(sh===Number.EPSILON&&ch===Number.EPSILON)return 1;if(sh===Number.EPSILON&&ch!==Number.EPSILON){const sdkIntance=p.GetInstance().GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return 1+ch/sdkIntance.GetOriginalHeight()}return ch/sh}return 1}GetParentStartAngle(){return this._parentStartAngle}_SaveToJsonProperties(){return{"sw":this._startWidth,"sh":this._startHeight,"sx":this._startScaleX,"sy":this._startScaleY,"psa":this._parentStartAngle,"oo":this._ownOpacity,"so":this._startOpacity,"pi":this._owner.GetInstance().GetIndexInParent()}}_SaveToJson(mode,
opts=null){const jsonProperties=this._SaveToJsonProperties();if(opts&&opts["selfOnly"])return Object.assign(jsonProperties,{"p":null,"c":[]});else return Object.assign(jsonProperties,{"p":this._GetParentJson(mode),"c":this._GetChildrenJson(mode)})}_GetFlagsString(wi){let flagsStr="";if(wi.GetTransformWithParentX())flagsStr+="x";if(wi.GetTransformWithParentY())flagsStr+="y";if(wi.GetTransformWithParentWidth())flagsStr+="w";if(wi.GetTransformWithParentHeight())flagsStr+="h";if(wi.GetTransformWithParentAngle())flagsStr+=
"a";if(wi.GetTransformWithParentZElevation())flagsStr+="z";if(wi.GetDestroyWithParent())flagsStr+="d";if(wi.GetTransformWithParentOpacity())flagsStr+="o";if(wi.GetTransformWithParentVisibility())flagsStr+="v";return flagsStr}_GetParentJson(mode){if(!this._parent)return null;if(!this._parent.GetInstance()||this._parent.GetInstance().IsDestroyed())return null;return this._GetInstanceJson(this._parent,this._owner,mode)}_GetChildrenJson(mode){return this._children.map(c=>this._GetInstanceJson(c,c,mode)).filter(json=>
json)}_GetInstanceJson(wi,flagsSource,mode){const inst=wi.GetInstance();if(inst&&inst.IsDestroyed())return null;const ret={};ret["uid"]=inst.GetUID();ret["f"]=this._GetFlagsString(flagsSource);ret["offsets"]=flagsSource._SaveSceneGraphPropertiesToJson();ret["data"]=C3.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(inst);ret["oci"]=inst.GetObjectClass().GetIndex();if(mode==="state"){ret["inst"]=inst.SaveToJson("full",{"selfOnly":true});ret["instIndex"]=NaN}else{ret["instIndex"]=inst.GetObjectClass().GetInstances().indexOf(inst);
ret["inst"]=null}return ret}_LoadFromJson(o){this._startWidth=o["sw"];this._startHeight=o["sh"];this._startScaleX=o["sx"];this._startScaleY=o["sy"];this._parentStartAngle=o["psa"];this._ownOpacity=o["oo"];this._startOpacity=o["so"];this._indexInParent=C3.IsFiniteNumber(o["pi"])?o["pi"]:NaN}_SetTmpSceneGraphChildren(tmpSceneGraphChildren,tmpSceneGraphChildrenIndexes){if(!tmpSceneGraphChildren&&!tmpSceneGraphChildrenIndexes)if(this._tmpSceneGraphChildren)for(const inst of this._tmpSceneGraphChildren)if(!inst.IsDestroyed()&&
!inst.HasParent())inst.GetRuntime().DestroyInstance(inst);this._tmpSceneGraphChildren=tmpSceneGraphChildren;this._tmpSceneGraphChildrenIndexes=tmpSceneGraphChildrenIndexes}_OnAfterLoad(o,opts){const owner=this._owner;const runtime=owner.GetRuntime();const processedExistingWis=new Set;if(o["p"]&&!this._parent){const parentUid=o["p"]["uid"];const parentInst=runtime.GetInstanceByUID(parentUid);if(opts&&!opts.ignoreMissingInstances);if(parentInst){const parentWi=parentInst.GetWorldInfo();if(parentInst.HasChild(this._owner.GetInstance()))this._parent=
parentWi;else{parentInst.AddChild(this._owner.GetInstance(),this._GetFlagsObj(o["p"]["f"]));if(!processedExistingWis.has(this._owner)){this._owner._LoadSceneGraphPropertiesFromJson(o["p"]["offsets"]);this._LoadInstancePropertiesFromJson(this._owner.GetInstance(),o["p"])}processedExistingWis.add(this._owner);const pwi=parentInst.GetWorldInfo();pwi._GetSceneGraphInfo()._MaybeSortChildren()}}else if(C3.IsFiniteNumber(o["p"]["oci"])){const objectClass=runtime.GetObjectClassByIndex(o["p"]["oci"]);const system=
runtime.GetSystemPlugin();const parentInstance=runtime.CreateInstance(objectClass,owner.GetLayer(),0,0,true);if(opts&&!opts.ignoreMissingInstances);if(parentInstance){const instData=this._GetInstanceData(o["p"],runtime);parentInstance.LoadFromJson(instData);const parentWi=parentInstance.GetWorldInfo();parentWi.GetLayer().SortAndAddInstancesByZIndex(parentInstance);parentInstance.AddChild(owner.GetInstance(),this._GetFlagsObj(o["p"]["f"]));const pwi=parentInstance.GetWorldInfo();pwi._GetSceneGraphInfo()._MaybeSortChildren()}}}const childInstances=
[];for(const childData of o["c"]){const childUid=childData["uid"];const childInst=runtime.GetInstanceByUID(childUid);if(childInst)childInstances.push(childInst)}let childIndex=0;for(const childData of o["c"]){const childUid=childData["uid"];const childInst=runtime.GetInstanceByUID(childUid);if(opts&&!opts.ignoreMissingInstances);if(childInst){if(this._tmpSceneGraphChildren)if(this._tmpSceneGraphChildren.includes(childInst)){const existingChildIntance=childInst;if(existingChildIntance.GetObjectClass()!==
childInst.GetObjectClass()){childIndex++;continue}if(existingChildIntance.IsDestroyed()){childIndex++;continue}const newChildData=o["c"][childIndex];this._AddAndSetChildInstance(existingChildIntance.GetWorldInfo(),newChildData,processedExistingWis,true);childIndex++;continue}else if(this._tmpSceneGraphChildren[childIndex]){const existingChildIntance=this._tmpSceneGraphChildren[childIndex];if(existingChildIntance.GetObjectClass()!==childInst.GetObjectClass()){childIndex++;continue}if(existingChildIntance.IsDestroyed()){childIndex++;
continue}const newChildData=o["c"][childIndex];this._AddAndSetChildInstance(existingChildIntance.GetWorldInfo(),newChildData,processedExistingWis,true);childIndex++;continue}const objectClass=childInst.GetObjectClass();const childrenCount=this._GetInstancesOfObjectClassCount(childInstances,objectClass);const childrenOfClassCount=owner.GetInstance().GetChildrenOfObjectClass(objectClass).length;if(childrenCount===childrenOfClassCount){const existingChild=owner.GetInstance().GetChildAt(childIndex);if(existingChild){const existingChildWi=
existingChild.GetWorldInfo();if(existingChildWi){if(!processedExistingWis.has(existingChildWi)){existingChildWi._LoadSceneGraphPropertiesFromJson(childData["offsets"]);this._LoadInstancePropertiesFromJson(existingChild,childData)}processedExistingWis.add(existingChildWi)}}childIndex++;continue}if(childInst.HasParent()){const childWi=this._CreateNewChildInstance(childData,opts);this._AddAndSetChildInstance(childWi,childData,processedExistingWis);childIndex++;continue}this._AddAndSetChildInstance(childInst.GetWorldInfo(),
childData,processedExistingWis)}else if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[childIndex]){const existingChildIntance=this._tmpSceneGraphChildren[childIndex];const objectClass=runtime.GetObjectClassByIndex(this._GetObjectClassIndex(childData));if(existingChildIntance.GetObjectClass()!==objectClass){childIndex++;continue}if(existingChildIntance.IsDestroyed()){childIndex++;continue}const newChildData=o["c"][childIndex];this._AddAndSetChildInstance(existingChildIntance.GetWorldInfo(),
newChildData,processedExistingWis)}else{const childWi=this._CreateNewChildInstance(childData,opts);this._AddAndSetChildInstance(childWi,childData,processedExistingWis)}childIndex++}}_GetFlagsObj(flagsString){const opts={};opts.transformX=flagsString.includes("x");opts.transformY=flagsString.includes("y");opts.transformWidth=flagsString.includes("w");opts.transformHeight=flagsString.includes("h");opts.transformAngle=flagsString.includes("a");opts.transformZElevation=flagsString.includes("z");opts.destroyWithParent=
flagsString.includes("d");opts.transformOpacity=flagsString.includes("o");opts.transformVisibility=flagsString.includes("v");return opts}_GetObjectClassIndex(childData){if(C3.IsFiniteNumber(childData["oci"]))return childData["oci"];return childData[1]}_CreateNewChildInstance(childData,opts){if(!C3.IsFiniteNumber(childData["oci"]))return;const owner=this._owner;const runtime=owner.GetRuntime();let childInstance;if(childData["data"])childInstance=runtime.CreateInstanceFromData(childData["data"],owner.GetLayer(),
false,0,0,false,true);else{const objectClass=runtime.GetObjectClassByIndex(childData["oci"]);childInstance=runtime.CreateInstance(objectClass,owner.GetLayer(),0,0,true)}if(opts&&!opts.ignoreMissingInstances);if(!childInstance)return;const instData=this._GetInstanceData(childData,runtime);childInstance.LoadFromJson(instData);const childWi=childInstance.GetWorldInfo();childWi.GetLayer().SortAndAddInstancesByZIndex(childInstance,true);return childWi}_AddAndSetChildInstance(childWi,childData,processedExistingWis,
setJson=true){const owner=this._owner;const added=owner.AddChild(childWi,this._GetFlagsObj(childData["f"]));if(added&&setJson){if(!processedExistingWis.has(childWi)){childWi._LoadSceneGraphPropertiesFromJson(childData["offsets"]);this._LoadInstancePropertiesFromJson(childWi.GetInstance(),childData)}processedExistingWis.add(childWi)}this._MaybeSortChildren()}_LoadInstancePropertiesFromJson(instance,childData){let instData=this._GetInstanceData(childData,this._owner.GetRuntime());if(!instData)return;
instData=JSON.parse(JSON.stringify(instData));instData["w"]=null;instance.LoadFromJson(instData)}_GetInstancesOfObjectClassCount(instances,objectClass){return instances.filter(i=>i.GetObjectClass().GetName()===objectClass.GetName()).length}_GetInstanceData(json,runtime){if(C3.IsFiniteNumber(json["instIndex"])){const objectClass=runtime.GetObjectClassByIndex(json["oci"]);const instancesJson=objectClass._GetLoadInstancesJson();return instancesJson[json["instIndex"]]}else if(C3.IsString(json["inst"]))return JSON.parse(json["inst"]);
else if(json["inst"])return json["inst"]}static GetSceneGraphInstanceDataFromInstance(sourceInstance){let instData=sourceInstance.GetWorldInfo().GetLayer().GetInitialInstanceData(sourceInstance.GetUID());if(!instData)return null;instData=JSON.parse(JSON.stringify(instData));const newSgiData=[];for(const child of[...sourceInstance.GetChildren()]){const childWi=child.GetWorldInfo();newSgiData.push([childWi.GetLayout().GetSID(),childWi.GetLayer().GetIndex(),child.GetUID(),C3.SceneGraphInfo._GetFlagsNumber(childWi),
child.GetObjectClass().IsInContainer()?1:0,childWi.GetZIndex(),C3.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(child)])}if(C3.IsArray(instData[0][14]))instData[0][14][1]=newSgiData;else{instData[0][14]=[];instData[0][14][0]=C3.SceneGraphInfo._GetDefaultFlagsNumber();instData[0][14][1]=newSgiData;instData[0][14][2]=sourceInstance.GetWorldInfo().GetZIndex()}return instData}static _GetFlagsNumber(wi){let flagsNumber=0;flagsNumber|=Number(wi.GetTransformWithParentVisibility())<<8;flagsNumber|=
Number(wi.GetTransformWithParentOpacity())<<7;flagsNumber|=Number(wi.GetTransformWithParentZElevation())<<6;flagsNumber|=Number(wi.GetDestroyWithParent())<<5;flagsNumber|=Number(wi.GetTransformWithParentAngle())<<4;flagsNumber|=Number(wi.GetTransformWithParentHeight())<<3;flagsNumber|=Number(wi.GetTransformWithParentWidth())<<2;flagsNumber|=Number(wi.GetTransformWithParentY())<<1;flagsNumber|=Number(wi.GetTransformWithParentX())<<0;return flagsNumber}static _GetDefaultFlagsNumber(wi){let flagsNumber=
0;flagsNumber|=1<<8;flagsNumber|=1<<7;flagsNumber|=1<<6;flagsNumber|=1<<5;flagsNumber|=1<<4;flagsNumber|=1<<3;flagsNumber|=1<<2;flagsNumber|=1<<1;flagsNumber|=1<<0;return flagsNumber}};

}

// objects/worldInfo.js
{
'use strict';const C3=self.C3;const glMatrix=self.glMatrix;const vec3=glMatrix.vec3;const vec4=glMatrix.vec4;const tempRect=C3.New(C3.Rect);const tempQuad=C3.New(C3.Quad);const bboxChangeEvent=C3.New(C3.Event,"bboxchange",false);const tempColor=C3.New(C3.Color,0,0,0,0);const tempCollisionPoly=C3.New(C3.CollisionPoly);const DEFAULT_COLOR=C3.New(C3.Color,1,1,1,1);const DEFAULT_RENDER_CELLS=C3.New(C3.Rect,0,0,-1,-1);const DEFAULT_COLLISION_CELLS=C3.New(C3.Rect,0,0,-1,-1);
const VALID_SET_MESH_POINT_MODES=new Set(["absolute","relative"]);const EMPTY_ARRAY=[];let enableUpdateRendererStateGroup=true;const FLAG_IS_VISIBLE=1<<0;const FLAG_BBOX_CHANGED=1<<1;const FLAG_ENABLE_BBOX_CHANGED_EVENT=1<<2;const FLAG_COLLISION_ENABLED=1<<3;const FLAG_COLLISION_CELL_CHANGED=1<<4;const FLAG_SOLID_FILTER_INCLUSIVE=1<<5;const FLAG_HAS_ANY_ACTIVE_EFFECT=1<<6;const FLAG_IS_ROTATABLE=1<<7;const FLAG_DESTROYED=1<<8;const FLAG_DESTROY_WITH_PARENT=1<<9;
const FLAG_TRANSFORM_WITH_PARENT_X=1<<10;const FLAG_TRANSFORM_WITH_PARENT_Y=1<<11;const FLAG_TRANSFORM_WITH_PARENT_W=1<<12;const FLAG_TRANSFORM_WITH_PARENT_H=1<<13;const FLAG_TRANSFORM_WITH_PARENT_A=1<<14;const FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION=1<<15;const FLAG_TRANSFORM_WITH_PARENT_OPACITY=1<<22;const FLAG_TRANSFORM_WITH_PARENT_VISIBILITY=1<<23;
const MASK_ALL_SCENE_GRAPH_FLAGS=FLAG_DESTROY_WITH_PARENT|FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y|FLAG_TRANSFORM_WITH_PARENT_W|FLAG_TRANSFORM_WITH_PARENT_H|FLAG_TRANSFORM_WITH_PARENT_A|FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION|FLAG_TRANSFORM_WITH_PARENT_OPACITY|FLAG_TRANSFORM_WITH_PARENT_VISIBILITY;const FLAG_MESH_CHANGED=1<<16;const FLAG_PHYSICS_BODY_CHANGED=1<<17;const FLAG_SIN_COS_ANGLE_CHANGED=1<<18;const FLAG_USE_POINTS_SHADER_PROGRAM=1<<19;const FLAG_DRAW_BACK_FACE_ONLY=1<<20;
const FLAG_DRAW_NON_BACK_FACES_ONLY=1<<21;const FLAG_BLEND_MODE_BIT_OFFSET=26;const FLAG_BLEND_MODE_MASK=31<<FLAG_BLEND_MODE_BIT_OFFSET;const sceneGraphExportDataMap=new WeakMap;const sceneGraphZIndexMap=new WeakMap;
C3.WorldInfo=class WorldInfo extends C3.DefendedBase{constructor(inst,layer){super();this._inst=inst;this._objectClass=inst.GetObjectClass();this._runtime=inst.GetRuntime();this._layer=layer;this._zIndex=-1;this._htmlZIndex=-1;this._flags=FLAG_IS_VISIBLE|FLAG_BBOX_CHANGED|FLAG_COLLISION_ENABLED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED|FLAG_PHYSICS_BODY_CHANGED;if(this._objectClass.GetPlugin().IsRotatable())this._flags|=FLAG_IS_ROTATABLE;this._x=NaN;this._y=NaN;this._zElevation=NaN;this._w=NaN;
this._h=NaN;this._depth=NaN;this._a=NaN;this._sinA=NaN;this._cosA=NaN;this._ox=NaN;this._oy=NaN;this._boundingBox=C3.New(C3.Rect);this._boundingQuad=C3.New(C3.Quad);this._collisionCells=DEFAULT_COLLISION_CELLS;this._renderCells=DEFAULT_RENDER_CELLS;this._sourceCollisionPoly=null;this._transformedPolyInfo=null;this._solidFilterTags=null;this._color=DEFAULT_COLOR;this._colorPremultiplied=DEFAULT_COLOR;this._stateGroup=null;this._instanceEffectList=null;if(this._inst.GetObjectClass().UsesEffects())this._instanceEffectList=
C3.New(C3.InstanceEffectList,this._inst,this);this._sceneGraphInfo=null;this._tmpSceneGraphChildren=null;this._tmpSceneGraphChildrenIndexes=null;this._tmpHierarchyPosition=-1;this._meshInfo=null}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}Release(){if(this._stateGroup){this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup);this._stateGroup=null}this._sourceCollisionPoly=null;if(this._transformedPolyInfo){this._transformedPolyInfo.poly.Release();this._transformedPolyInfo=null}if(this._solidFilterTags){this._solidFilterTags.clear();
this._solidFilterTags=null}this.ReleaseMesh();if(this._instanceEffectList)this._instanceEffectList.Release();if(this.HasParent())this.GetParent().RemoveChild(this);if(this.HasChildren()){const childrenToRelease=[...this.GetChildren()];for(const child of childrenToRelease)this.RemoveChild(child)}this._ReleaseSceneGraphInfo();this._ReleaseTmpSceneGraphInfo();sceneGraphExportDataMap.delete(this);sceneGraphZIndexMap.delete(this);this._inst=null;this._objectClass=null;this._runtime=null;this._layer=null}Init(data){enableUpdateRendererStateGroup=
false;this.SetXY(data[0],data[1]);this.SetZElevation(data[2]);this.SetSize(data[3],data[4]);this._depth=0;if(this.IsRotatable())this.SetAngle(data[6]);else this._a=0;tempColor.setFromJSON(data[7]);this._SetColor(tempColor);this.SetOriginX(data[8]);this.SetOriginY(data[9]);this.SetBlendMode(data[10]);if(this._instanceEffectList)this._instanceEffectList._LoadEffectParameters(data[12]);if(data[14])sceneGraphExportDataMap.set(this,{childrenData:data[14][1],zIndexData:data[14][2]});if(data[15]){const meshData=
data[15];this.CreateMesh(meshData[0],meshData[1]);const sourceMesh=this.GetSourceMesh();const meshRows=meshData[2];for(let y=0,lenY=meshRows.length;y<lenY;++y){const rowData=meshRows[y];for(let x=0,lenX=rowData.length;x<lenX;++x){const d=rowData[x];const pt=sourceMesh.GetMeshPointAt(x,y);pt.SetX(d[0]);pt.SetY(d[1]);pt.SetZElevation(d[2]);pt.SetU(d[3]);pt.SetV(d[4])}}}if(data[16]){const templateName=data[16][0];const sourceTemplateName=data[16][1];const isReplica=!!sourceTemplateName;const isTemplate=
!isReplica;const templateManager=this._runtime.GetTemplateManager();if(isReplica&&templateManager)templateManager.MapInstanceToTemplateName(this.GetInstance(),sourceTemplateName);if(isTemplate&&templateManager)templateManager.MapInstanceToTemplateName(this.GetInstance(),templateName)}enableUpdateRendererStateGroup=true;this._UpdateRendererStateGroup()}InitNoData(){this._x=0;this._y=0;this._zElevation=0;this._w=0;this._h=0;this._depth=0;this._a=0;this._sinA=0;this._cosA=1;this._ox=0;this._oy=0;this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){if(this.GetTransformWithParentAngle())return this._MaybeReflectAngleForMirrorFlip(this.GetParent()._GetAngleNoReflect()-
this._sceneGraphInfo.GetParentStartAngle());return 0}SetX(x){x=+x;if(this.GetTransformWithParentX()){const sgi=this._sceneGraphInfo;const dx=x-this.GetX();const da=-this._GetParentOffsetAngle();if(da===0)this._x+=dx/sgi.GetParentScaleX();else{this._x+=Math.cos(da)*dx/sgi.GetParentScaleX();if(this.GetTransformWithParentY())this._y+=Math.sin(da)*dx/sgi.GetParentScaleY()}}else this._x=x}OffsetX(x,transformWithSceneGraph=false){x=+x;if(transformWithSceneGraph)this._x+=x;else if(this.GetTransformWithParentX())this.SetX(this.GetX()+
x);else this._x+=x}GetX(){if(this.GetTransformWithParentX()){let x=this._x;const sgi=this._sceneGraphInfo;const parent=this.GetParent();const da=this._GetParentOffsetAngle();if(da===0)x*=sgi.GetParentScaleX();else{x=x*sgi.GetParentScaleX()*Math.cos(da);if(this.GetTransformWithParentY())x-=this._y*sgi.GetParentScaleY()*Math.sin(da)}return parent.GetX()+x}else return this._x}SetY(y){y=+y;if(this.GetTransformWithParentY()){const sgi=this._sceneGraphInfo;const dy=y-this.GetY();const da=-this._GetParentOffsetAngle();
if(da===0)this._y+=dy/sgi.GetParentScaleY();else{if(this.GetTransformWithParentX())this._x-=Math.sin(da)*dy/sgi.GetParentScaleX();this._y+=Math.cos(da)*dy/sgi.GetParentScaleY()}}else this._y=y}OffsetY(y,transformWithSceneGraph=false){y=+y;if(transformWithSceneGraph)this._y+=y;else if(this.GetTransformWithParentY())this.SetY(this.GetY()+y);else this._y+=y}GetY(){if(this.GetTransformWithParentY()){let y=this._y;const sgi=this._sceneGraphInfo;const parent=this.GetParent();const da=this._GetParentOffsetAngle();
if(da===0)y*=sgi.GetParentScaleY();else{y=y*sgi.GetParentScaleY()*Math.cos(da);if(this.GetTransformWithParentX())y+=this._x*sgi.GetParentScaleX()*Math.sin(da)}return parent.GetY()+y}else return this._y}SetXY(x,y){x=+x;y=+y;if(this.GetTransformWithParentXOrY()){const isTransformX=this.GetTransformWithParentX();const isTransformY=this.GetTransformWithParentY();const sgi=this._sceneGraphInfo;const dx=x-this.GetX();const dy=y-this.GetY();const da=-this._GetParentOffsetAngle();if(da===0){if(isTransformX)this._x+=
dx/sgi.GetParentScaleX();else this._x=x;if(isTransformY)this._y+=dy/sgi.GetParentScaleY();else this._y=y}else{const sinDa=Math.sin(da);const cosDa=Math.cos(da);if(isTransformX)if(isTransformY)this._x+=(cosDa*dx-sinDa*dy)/sgi.GetParentScaleX();else this._x+=cosDa*dx/sgi.GetParentScaleX();else this._x=x;if(isTransformY)if(isTransformX)this._y+=(sinDa*dx+cosDa*dy)/sgi.GetParentScaleY();else this._y+=cosDa*dy/sgi.GetParentScaleY();else this._y=y}}else{this._x=x;this._y=y}}GetXY(){return[this.GetX(),this.GetY()]}OffsetXY(x,
y){x=+x;y=+y;if(this.GetTransformWithParentXOrY())this.SetXY(this.GetX()+x,this.GetY()+y);else{this._x+=x;this._y+=y}}EqualsXY(x,y){return this.GetX()===x&&this.GetY()===y}SetZElevation(z){z=+z;if(this.GetTransformWithParentZElevation())z-=this.GetParent().GetZElevation();if(this._zElevation===z)return;this._zElevation=z;this._UpdateZElevation();const layer=this.GetLayer();if(this._zElevation!==0)layer._SetAnyInstanceZElevated();layer.SetZIndicesChanged(this)}_UpdateZElevation(){this._UpdateRendererStateGroup();
if(this.HasChildren()){const children=this.GetChildren();for(let i=0,len=children.length;i<len;i++){const child=children[i];if(child.GetTransformWithParentZElevation())child._UpdateZElevation()}}}OffsetZElevation(z){this.SetZElevation(this.GetZElevation()+z)}GetZElevation(){if(this.GetTransformWithParentZElevation())return this.GetParent().GetZElevation()+this._zElevation;else return this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}SetWidth(w){w=+w;
if(this.GetTransformWithParentWidth()){const ownWidth=this.GetWidth();if(ownWidth===0)this._w=Number.EPSILON;else this._w*=w/ownWidth}else this._w=w;this._MarkSinCosAngleChanged()}OffsetWidth(w,transformWithSceneGraph){w=+w;if(transformWithSceneGraph)this._w+=w;else if(this.GetTransformWithParentWidth())this.SetWidth(this.GetWidth()+w);else this._w+=w;this._MarkSinCosAngleChanged()}GetWidth(){if(this.GetTransformWithParentWidth()){const parent=this.GetParent();const pw=parent.GetWidth();const psw=
parent._GetSceneGraphInfo()._GetStartWidth();if(psw===Number.EPSILON)return(this._GetSceneGraphInfo()._GetStartWidth()+pw)*this._w;return pw*this._w}else return this._w}SetHeight(h){h=+h;if(this.GetTransformWithParentHeight()){const ownHeight=this.GetHeight();if(ownHeight===0)this._h=Number.EPSILON;else this._h*=h/ownHeight}else this._h=h;this._MarkSinCosAngleChanged()}OffsetHeight(h,transformWithSceneGraph){h=+h;if(transformWithSceneGraph)this._h+=h;else if(this.GetTransformWithParentHeight())this.SetHeight(this.GetHeight()+
h);else this._h+=h;this._MarkSinCosAngleChanged()}GetHeight(){if(this.GetTransformWithParentHeight()){const parent=this.GetParent();const ph=parent.GetHeight();const psh=parent._GetSceneGraphInfo()._GetStartHeight();if(psh===Number.EPSILON)return(this._GetSceneGraphInfo()._GetStartHeight()+ph)*this._h;return ph*this._h}else return this._h}SetSize(w,h){w=+w;h=+h;if(this.GetTransformWithParentWidth()){const ownWidth=this.GetWidth();if(ownWidth===0)this._w=Number.EPSILON;else this._w*=w/ownWidth}else this._w=
w;if(this.GetTransformWithParentHeight()){const ownHeight=this.GetHeight();if(ownHeight===0)this._h=Number.EPSILON;else this._h*=h/ownHeight}else this._h=h;this._MarkSinCosAngleChanged()}GetSize(){return[this.GetWidth(),this.GetHeight()]}GetDepth(){return this._depth}SetDepth(d){if(d<0)throw new RangeError("invalid depth");this._depth=d}GetSceneGraphScale(){if(this.HasParent()){const sgi=this._sceneGraphInfo;return Math.min(sgi.GetParentScaleX(),sgi.GetParentScaleY())}else return 1}IsRotatable(){return(this._flags&
FLAG_IS_ROTATABLE)!==0}SetAngle(a){a=+a;if(!this.IsRotatable())return;if(this.GetTransformWithParentAngle())a-=this.GetParent().GetAngle();a=C3.clampAngle(a);if(this._a===a)return;this._a=a;this._MarkSinCosAngleChanged()}OffsetAngle(a){a=+a;if(a===0||!this.IsRotatable())return;this._a=C3.clampAngle(this._a+a);this._MarkSinCosAngleChanged()}_MarkSinCosAngleChanged(){this._flags|=FLAG_SIN_COS_ANGLE_CHANGED;if(this.HasChildren()){const children=this.GetChildren();for(let i=0,len=children.length;i<len;i++)children[i]._MarkSinCosAngleChanged()}}GetAngle(){if(this.GetTransformWithParentAngle()&&
this.IsRotatable())return this._MaybeReflectAngleForMirrorFlip(C3.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a));else return this._a}_GetAngleNoReflect(){if(this.GetTransformWithParentAngle()&&this.IsRotatable())return C3.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a);else return this._a}_MaybeReflectAngleForMirrorFlip(a){if(this.GetTransformWithParentWidth()&&this.GetTopParent().GetWidth()<0)a=C3.clampAngle(C3.angleReflect(a,this.GetTopParent().GetAngle()+Math.PI));if(this.GetTransformWithParentHeight()&&
this.GetTopParent().GetHeight()<0)a=C3.angleReflect(a,this.GetTopParent().GetAngle());return a}_NeedsReflectAngleForMirrorOrFlip(){const p=this.GetParent();if(this.GetTransformWithParentWidth()&&p.GetWidth()<0)return true;if(this.GetTransformWithParentHeight()&&p.GetHeight()<0)return true;return false}_NeedsReflectAngleForMirrorAndFlip(){const p=this.GetParent();if(this.GetTransformWithParentWidth()&&p.GetWidth()<0&&(this.GetTransformWithParentHeight()&&p.GetHeight()<0))return true;return false}_MaybeUpdateSinCosAngle(){const flags=
this._flags;if((flags&FLAG_SIN_COS_ANGLE_CHANGED)===0)return;const a=this.GetAngle();this._sinA=Math.sin(a);this._cosA=Math.cos(a);this._flags=flags&~FLAG_SIN_COS_ANGLE_CHANGED}GetSinAngle(){this._MaybeUpdateSinCosAngle();return this._sinA}GetCosAngle(){this._MaybeUpdateSinCosAngle();return this._cosA}SetOriginX(x){this._ox=+x}OffsetOriginX(x){this._ox+=+x}GetOriginX(){return this._ox}SetOriginY(y){this._oy=+y}OffsetOriginY(y){this._oy+=+y}GetOriginY(){return this._oy}_SetColor(c){if(this._color.equals(c))return;
if(this._color===DEFAULT_COLOR){this._color=C3.New(C3.Color,c);this._colorPremultiplied=C3.New(C3.Color,c);this._colorPremultiplied.premultiply()}else if(c.equalsRgba(1,1,1,1)){this._color=DEFAULT_COLOR;this._colorPremultiplied=DEFAULT_COLOR}else{this._color.set(c);this._colorPremultiplied.set(c);this._colorPremultiplied.premultiply()}this._UpdateRendererStateGroup()}SetOpacity(o){o=C3.clamp(+o,0,1);if(this.GetTransformWithParentOpacity()){if(this._GetSceneGraphInfo().GetOwnOpacity()===o)return;this._GetSceneGraphInfo().SetOwnOpacity(o);
o=this.GetOpacity()}else if(this._color.a===o)return;this._SetColorWithOpacity(o)}_SetOpacityOfChildren(){if(!this.HasChildren())return;const children=this.GetChildren();for(let i=0,len=children.length;i<len;i++){const child=children[i];child._SetColorWithOpacity(child.GetOpacity())}}_SetColorWithOpacity(o){tempColor.copyRgb(this._color);tempColor.a=o;this._SetColor(tempColor);this._SetOpacityOfChildren()}OffsetOpacity(o){if(this.GetTransformWithParentOpacity())this.SetOpacity(this._GetSceneGraphInfo().GetOwnOpacity()+
o);else this.SetOpacity(this.GetOpacity()+o)}GetOpacity(){if(this.GetTransformWithParentOpacity())return this.GetParent().GetOpacity()*this._GetSceneGraphInfo().GetOwnOpacity();else return this._color.a}SetUnpremultipliedColor(c){if(this._color.equalsIgnoringAlpha(c))return;tempColor.copyRgb(c);tempColor.a=this.GetOpacity();this._SetColor(tempColor)}SetUnpremultipliedColorRGB(r,g,b){tempColor.setRgb(r,g,b);this.SetUnpremultipliedColor(tempColor)}OffsetUnpremultipliedColorRGB(r,g,b){if(r===0&&g===
0&&b===0)return;tempColor.copyRgb(this._color);tempColor.r+=r;tempColor.g+=g;tempColor.b+=b;this.SetUnpremultipliedColor(tempColor)}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return(this._flags&FLAG_DESTROY_WITH_PARENT)!==0}SetDestroyWithParent(d){this._SetFlag(FLAG_DESTROY_WITH_PARENT,d)}GetTransformWithParentX(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_X)!==0}SetTransformWithParentX(tpx){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_X,
tpx)}GetTransformWithParentY(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_Y)!==0}GetTransformWithParentXOrY(){return(this._flags&(FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y))!==0}SetTransformWithParentY(tpx){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Y,tpx)}GetTransformWithParentWidth(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_W)!==0}SetTransformWithParentWidth(tpw){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_W,tpw)}GetTransformWithParentHeight(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_H)!==
0}SetTransformWithParentHeight(tph){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_H,tph)}GetTransformWithParentAngle(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_A)!==0}SetTransformWithParentAngle(tpa){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_A,tpa)}GetTransformWithParentZElevation(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION)!==0}SetTransformWithParentZElevation(tpz){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,tpz)}GetTransformWithParentOpacity(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_OPACITY)!==
0}SetTransformWithParentOpacity(tpo){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_OPACITY,tpo)}GetTransformWithParentVisibility(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_VISIBILITY)!==0}SetTransformWithParentVisibility(tpv){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,tpv)}_ClearAllSceneGraphFlags(){this._flags&=~MASK_ALL_SCENE_GRAPH_FLAGS}AddChild(child,opts){if(child===this)return false;if(child.HasParent())return false;if(this._HasChildRecursive(child))return false;if(this._HasAnyParent(child))return false;
const absX=child.GetX();const absY=child.GetY();const absW=child.GetWidth();const absH=child.GetHeight();const absA=child.GetAngle();const absZElevation=child.GetZElevation();const absOpacity=child.GetOpacity();child._SetParent(this);child.SetTransformWithParentX(opts.transformX);child.SetTransformWithParentY(opts.transformY);child.SetTransformWithParentWidth(opts.transformWidth);child.SetTransformWithParentHeight(opts.transformHeight);child.SetTransformWithParentAngle(opts.transformAngle);child.SetTransformWithParentZElevation(opts.transformZElevation);
child.SetTransformWithParentOpacity(opts.transformOpacity);child.SetTransformWithParentVisibility(opts.transformVisibility);child.SetDestroyWithParent(opts.destroyWithParent);if(opts.transformX){child._x=absX-this.GetX();if(opts.transformWidth){const scaleFactor=this.GetWidth()/this._sceneGraphInfo._GetStartWidth();if(scaleFactor!==0)child._x/=scaleFactor}}if(opts.transformY){child._y=absY-this.GetY();if(opts.transformHeight){const scaleFactor=this.GetHeight()/this._sceneGraphInfo._GetStartHeight();
if(scaleFactor!==0)child._y/=scaleFactor}}if(opts.transformWidth){const pw=this.GetWidth();if(pw===0||pw===Number.EPSILON){child._w=1;child._sceneGraphInfo.SetStartScaleX(1)}else{child._w=absW/this.GetWidth();child._sceneGraphInfo.SetStartScaleX(child._w)}}if(opts.transformHeight){const ph=this.GetHeight();if(ph===0||ph===Number.EPSILON){child._h=1;child._sceneGraphInfo.SetStartScaleY(1)}else{child._h=absH/this.GetHeight();child._sceneGraphInfo.SetStartScaleY(child._h)}}if(opts.transformAngle)child._a=
absA-this.GetAngle();if(opts.transformZElevation)child._zElevation=absZElevation-this.GetZElevation();if(opts.transformOpacity)child._sceneGraphInfo.SetOwnOpacity(absOpacity);if(opts.transformVisibility)child.SetVisible(this.IsVisible());this._AddChildToSceneGraphInfo(child);this.SetBboxChanged();this._SetOpacityOfChildren();return true}RemoveChild(child){if(child.GetParent()!==this)return;const absX=child.GetX();const absY=child.GetY();const absW=child.GetWidth();const absH=child.GetHeight();const absA=
child.GetAngle();const absZElevation=child.GetZElevation();const absOpacity=child.GetOpacity();child._SetParent(null);child._ClearAllSceneGraphFlags();child.SetXY(absX,absY);child.SetSize(absW,absH);child.SetAngle(absA);child.SetZElevation(absZElevation);child.SetOpacity(absOpacity);this._RemoveChildFromSceneGraphInfo(child);this.SetBboxChanged();return}GetTmpHierarchyPosition(){return this._tmpHierarchyPosition}_ResetAllSceneGraphState(){this._BuildTmpSceneGraphData();const children=[...this.children()];
for(const c of children)this.RemoveChild(c);const parent=this.GetParent();if(parent)parent.RemoveChild(this);this._ClearAllSceneGraphFlags()}_BuildTmpSceneGraphData(){this._SetTmpHierarchyPosition();if(!this._tmpSceneGraphChildren){const children=[...this.children()];if(children.length){this._tmpSceneGraphChildren=[];this._tmpSceneGraphChildrenIndexes=new WeakMap}let index=0;for(const c of children){const inst=c.GetInstance();this._tmpSceneGraphChildren.push(inst);this._tmpSceneGraphChildrenIndexes.set(inst,
index);index++}}const parent=this.GetParent();if(parent)parent._BuildTmpSceneGraphData()}_SetTmpHierarchyPosition(){if(this._tmpHierarchyPosition!==-1)return;const parents=[...this.parents()];this._tmpHierarchyPosition=parents.length;for(const p of parents)p._SetTmpHierarchyPosition();const children=[...this.children()];for(const c of children)c._SetTmpHierarchyPosition()}_ReleaseTmpSceneGraphInfo(){if(this._tmpSceneGraphChildren)this._tmpSceneGraphChildren.length=0;this._tmpSceneGraphChildren=null;
this._tmpSceneGraphChildrenIndexes=null;const parent=this.GetParent();if(parent)parent._ReleaseTmpSceneGraphInfo();this._tmpHierarchyPosition=-1}HasParent(){return this.GetParent()!==null}GetParent(){const sgi=this._sceneGraphInfo;return sgi!==null?sgi.GetParent():null}GetTopParent(){let p=this;while(p.HasParent())p=p.GetParent();return p}*parents(){let parent=this.GetParent();while(parent){yield parent;parent=parent.GetParent()}}HasChild(child){return this.GetChildren().includes(child)}HasChildren(){const sgi=
this._sceneGraphInfo;return sgi!==null?sgi.HasChildren():false}GetChildren(){const sgi=this._sceneGraphInfo;return sgi!==null?sgi.GetChildren():EMPTY_ARRAY}children(){return this.GetChildren()}*allChildren(){for(const child of this.children()){yield child;yield*child.allChildren()}}GetChildCount(){return this.GetChildren().length}GetAllChildCount(){return[...this.allChildren()].length}GetChildAt(index){const children=this.GetChildren();index=Math.floor(+index);if(index<0||index>=children.length)return null;
return children[index]}GetChildIndex(child){if(!child)return NaN;const children=this.GetChildren();if(!children)return NaN;for(let i=0;i<children.length;i++)if(child===children[i])return i;return NaN}_CreateSceneGraphInfo(parent){if(!this._sceneGraphInfo)this._sceneGraphInfo=C3.New(C3.SceneGraphInfo,this);if(parent)this._sceneGraphInfo.SetParent(parent)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){if(!this._sceneGraphInfo)return;this._sceneGraphInfo.Release();this._sceneGraphInfo=
null}_SetParent(parent){if(parent){parent._CreateSceneGraphInfo(null);this._CreateSceneGraphInfo(parent)}else{if(this._sceneGraphInfo)this._sceneGraphInfo.SetParent(null);if(!this.HasChildren())this._ReleaseSceneGraphInfo()}}_HasAnyParent(child){if(!this.HasParent())return false;const parent=this.GetParent();if(parent===child)return true;return parent._HasAnyParent(child)}_HasChildRecursive(child){if(this.HasChild(child))return true;for(const c of this.GetChildren())if(c._HasChildRecursive(child))return true;
return false}_AddChildToSceneGraphInfo(child){this._sceneGraphInfo.GetChildren().push(child)}_RemoveChildFromSceneGraphInfo(child){const children=this._sceneGraphInfo.GetChildren();const index=children.indexOf(child);if(index!==-1)children.splice(index,1);if(children.length===0&&!this.HasParent())this._ReleaseSceneGraphInfo();if(!child.HasChildren())child._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){const data=sceneGraphExportDataMap.get(this);return data?data.childrenData:null}GetSceneGraphZIndexExportData(){const data=
sceneGraphExportDataMap.get(this);return data?data.zIndexData:NaN}GetSceneGraphZIndex(){const sceneGraphZIndex=sceneGraphZIndexMap.get(this);return C3.IsFiniteNumber(sceneGraphZIndex)?sceneGraphZIndex:NaN}SetSceneGraphZIndex(z){sceneGraphZIndexMap.set(this,z)}SetUsePointsShaderProgram(){this._SetFlag(FLAG_USE_POINTS_SHADER_PROGRAM,true);this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(!enableUpdateRendererStateGroup)return;const renderer=this._runtime.GetRenderer();if(this._stateGroup)renderer.ReleaseStateGroup(this._stateGroup);
let shaderProgram;if((this._flags&FLAG_USE_POINTS_SHADER_PROGRAM)!==0)shaderProgram=renderer.GetPointsRenderingProgram()||"<point>";else shaderProgram=renderer.GetTextureFillShaderProgram()||"<default>";this._stateGroup=renderer.AcquireStateGroup(shaderProgram,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===DEFAULT_COLOR}SetBlendMode(bm){bm=bm|0;if(bm<0||bm>31)throw new RangeError("invalid blend mode");
if(this.GetBlendMode()===bm)return;this._flags=this._flags&~FLAG_BLEND_MODE_MASK|bm<<FLAG_BLEND_MODE_BIT_OFFSET;this._UpdateRendererStateGroup()}GetBlendMode(){return(this._flags&FLAG_BLEND_MODE_MASK)>>FLAG_BLEND_MODE_BIT_OFFSET}_SetLayer(layer,updateRenderCell){const doUpdateRenderCell=updateRenderCell&&this._layer!==layer;if(doUpdateRenderCell)this._RemoveFromRenderCells();this._layer=layer;if(doUpdateRenderCell)this._UpdateRenderCell();if(this.GetZElevation()!==0)this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(z){this._zIndex=
z|0}GetZIndex(){this._layer._UpdateZIndices();return this._zIndex}_SetHTMLZIndex(z){this._htmlZIndex=z|0}GetHTMLZIndex(){this._layer._UpdateHTMLZIndices();return this._htmlZIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(bit,enable){if(enable)this._flags|=bit;else this._flags&=~bit}IsVisible(){return(this._flags&FLAG_IS_VISIBLE)!==0}SetVisible(v){this._SetFlag(FLAG_IS_VISIBLE,v);if(!this.HasChildren())return;for(const child of this.GetChildren())if(child.GetTransformWithParentVisibility())child.SetVisible(v)}IsCollisionEnabled(){return(this._flags&
FLAG_COLLISION_ENABLED)!==0}SetCollisionEnabled(e){e=!!e;if(this.IsCollisionEnabled()===e)return;this._SetFlag(FLAG_COLLISION_ENABLED,e);if(e)this.SetBboxChanged();else this._RemoveFromCollisionCells()}SetSolidCollisionFilter(isInclusive,tags){this._SetFlag(FLAG_SOLID_FILTER_INCLUSIVE,isInclusive);if(this._solidFilterTags)this._solidFilterTags.clear();if(!tags.trim()){this._solidFilterTags=null;return}if(!this._solidFilterTags)this._solidFilterTags=new Set;for(const tag of tags.split(" "))if(tag)this._solidFilterTags.add(tag.toLowerCase())}IsSolidCollisionAllowed(solidTagSet){const isInclusive=
(this._flags&FLAG_SOLID_FILTER_INCLUSIVE)!==0;const filterTags=this._solidFilterTags;if(!solidTagSet||!filterTags)return!isInclusive;for(const tag of filterTags)if(solidTagSet.has(tag))return isInclusive;return!isInclusive}SetBboxChanged(){this._flags|=FLAG_BBOX_CHANGED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED;this._objectClass._SetAnyCollisionCellChanged(true);this._runtime.UpdateRender();if(this._layer.UsesRenderCells()){this.CalculateBbox(this._boundingBox,this._boundingQuad,true);this._flags&=
~FLAG_BBOX_CHANGED;this._UpdateRenderCell()}if((this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)!==0)this._inst.Dispatcher().dispatchEvent(bboxChangeEvent);if(this._sceneGraphInfo!==null){const children=this._sceneGraphInfo.GetChildren();for(let i=0,len=children.length;i<len;++i)children[i].SetBboxChanged()}}CalculateBbox(bbox,bquad,includeMesh){const x=this.GetX();const y=this.GetY();const w=this.GetWidth();const h=this.GetHeight();const a=this.GetAngle();bbox.setWH(x-this._ox*w,y-this._oy*h,w,h);if(includeMesh&&
this.HasMesh())this._ExpandBboxForMesh(bbox);if(a===0)bquad.setFromRect(bbox);else{bbox.offset(-x,-y);bquad.setFromRotatedRectPrecalc(bbox,this.GetSinAngle(),this.GetCosAngle());bquad.offset(x,y);bquad.getBoundingBox(bbox)}bbox.normalize()}_UpdateBbox(){const flags=this._flags;if((flags&FLAG_BBOX_CHANGED)!==0){this.CalculateBbox(this._boundingBox,this._boundingQuad,true);this._flags=flags&~FLAG_BBOX_CHANGED}}GetBoundingBox(){this._UpdateBbox();return this._boundingBox}GetBoundingQuad(){this._UpdateBbox();
return this._boundingQuad}PixelRoundQuad(quad){const x=this.GetX();const y=this.GetY();const ox=Math.round(x)-x;const oy=Math.round(y)-y;if(ox===0&&oy===0)return quad;else{tempQuad.copy(quad);tempQuad.offset(ox,oy);return tempQuad}}OverwriteBoundingBox(box){this._boundingBox.copy(box);this._boundingQuad.setFromRect(this._boundingBox);this._flags&=~FLAG_BBOX_CHANGED;this._UpdateCollisionCell();this._UpdateRenderCell()}SetBboxChangeEventEnabled(e){this._SetFlag(FLAG_ENABLE_BBOX_CHANGED_EVENT,e)}IsBboxChangeEventEnabled(){return(this._flags&
FLAG_ENABLE_BBOX_CHANGED_EVENT)!==0}IsInViewport(viewport,hasVanishingPointOutsideViewport,isOrthographic){if(hasVanishingPointOutsideViewport&&this.GetDepth()!==0)return this.IsInViewport3D(this.GetLayer()._GetViewFrustum());else return this.GetZElevation()===0||isOrthographic?viewport.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){const layer=this.GetLayer();const totalZElevation=this.GetTotalZElevation();if(totalZElevation>=layer.GetCameraZ())return false;
layer.GetViewportForZ(totalZElevation,tempRect);return tempRect.intersectsRect(this.GetBoundingBox())}IsInViewport3D(viewFrustum){const bbox=this.GetBoundingBox();const minX=bbox.getLeft();const maxX=bbox.getRight();const minY=bbox.getTop();const maxY=bbox.getBottom();const minZ=this.GetTotalZElevation();const maxZ=minZ+this.GetDepth();return viewFrustum.ContainsAABB(minX,minY,minZ,maxX,maxY,maxZ)}IsInViewport2(){const layer=this.GetLayer();if(layer.Has3DCamera())return this.IsInViewport3D(layer._GetViewFrustum());
else{const layout=layer.GetLayout();return this.IsInViewport(layer.GetViewport(),layout.HasVanishingPointOutsideViewport(),layout.IsOrthographicProjection())}}_SetDrawBackFaceOnly(e){this._SetFlag(FLAG_DRAW_BACK_FACE_ONLY,e)}_SetDrawNonBackFacesOnly(e){this._SetFlag(FLAG_DRAW_NON_BACK_FACES_ONLY,e)}IsDrawBackFaceOnly(){return(this._flags&FLAG_DRAW_BACK_FACE_ONLY)!==0}IsDrawNonBackFacesOnly(){return(this._flags&FLAG_DRAW_NON_BACK_FACES_ONLY)!==0}SetSourceCollisionPoly(poly){this._sourceCollisionPoly=
poly;this._DiscardTransformedCollisionPoly();if(this.HasMesh())this._meshInfo.meshPoly=null}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return this._sourceCollisionPoly!==null||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(w,h,a){let sina=0;let cosa=1;if(a!==0){sina=Math.sin(a);cosa=Math.cos(a)}return this._GetCustomTransformedCollisionPolyPrecalc(w,
h,a,sina,cosa)}_GetCustomTransformedCollisionPolyPrecalc(w,h,a,sinA,cosA){let tpi=this._transformedPolyInfo;if(tpi===null){tpi={poly:C3.New(C3.CollisionPoly),width:NaN,height:NaN,angle:NaN};this._transformedPolyInfo=tpi}const transformedPoly=tpi.poly;if(tpi.width===w&&tpi.height===h&&tpi.angle===a)return transformedPoly;const sourcePoly=this._sourceCollisionPoly;if(this.HasMesh()){const ox=this.GetOriginX();const oy=this.GetOriginY();const sourceMesh=this.GetSourceMesh();let meshPoly=this._meshInfo.meshPoly;
if(!meshPoly){if(sourcePoly){tempCollisionPoly.copy(sourcePoly);tempCollisionPoly.offset(ox,oy)}else tempCollisionPoly.setDefaultPoints();meshPoly=sourceMesh.InsertPolyMeshVertices(tempCollisionPoly);this._meshInfo.meshPoly=meshPoly}sourceMesh.TransformCollisionPoly(meshPoly,transformedPoly);transformedPoly.offset(-ox,-oy);transformedPoly.transformPrecalc(w,h,sinA,cosA)}else if(sourcePoly){transformedPoly.copy(sourcePoly);transformedPoly.transformPrecalc(w,h,sinA,cosA)}else transformedPoly.setFromQuad(this.GetBoundingQuad(),
-this.GetX(),-this.GetY());tpi.width=w;tpi.height=h;tpi.angle=a;return transformedPoly}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(true);const tpi=this._transformedPolyInfo;if(tpi===null)return;tpi.width=NaN}CreateMesh(hsize,vsize){hsize=Math.floor(hsize);vsize=Math.floor(vsize);if(!this.GetInstance().GetPlugin().SupportsMesh())throw new Error("object does not support mesh");this.ReleaseMesh();this._meshInfo={sourceMesh:C3.New(C3.Gfx.Mesh,hsize,vsize),transformedMesh:C3.New(C3.Gfx.Mesh,
hsize,vsize),meshPoly:null}}HasMesh(){return this._meshInfo!==null}GetSourceMesh(){if(!this.HasMesh())throw new Error("no mesh");return this._meshInfo.sourceMesh}GetTransformedMesh(){if(!this.HasMesh())throw new Error("no mesh");return this._meshInfo.transformedMesh}SetMeshChanged(e){this._SetFlag(FLAG_MESH_CHANGED,e)}IsMeshChanged(){return(this._flags&FLAG_MESH_CHANGED)!==0}SetPhysicsBodyChanged(e){this._SetFlag(FLAG_PHYSICS_BODY_CHANGED,e)}IsPhysicsBodyChanged(){return(this._flags&FLAG_PHYSICS_BODY_CHANGED)!==
0}_ExpandBboxForMesh(bbox){const sourceMesh=this._meshInfo.sourceMesh;const minX=Math.min(sourceMesh.GetMinX(),0);const minY=Math.min(sourceMesh.GetMinY(),0);const maxX=Math.max(sourceMesh.GetMaxX(),1);const maxY=Math.max(sourceMesh.GetMaxY(),1);const w=bbox.width();const h=bbox.height();bbox.offsetLeft(minX*w);bbox.offsetTop(minY*h);bbox.offsetRight((maxX-1)*w);bbox.offsetBottom((maxY-1)*h);this._depth=sourceMesh.GetMaxZ()}ReleaseMesh(){if(!this._meshInfo)return;this._meshInfo.sourceMesh.Release();
this._meshInfo.transformedMesh.Release();this._meshInfo=null;this._DiscardTransformedCollisionPoly()}SetMeshPoint(col,row,opts){col=Math.floor(col);row=Math.floor(row);const mode=opts.mode||"absolute";if(!VALID_SET_MESH_POINT_MODES.has(mode))throw new Error("invalid mode");const isRelative=mode==="relative";let posx=opts.x;let posy=opts.y;const zElevation=opts.zElevation;let texu=typeof opts.u==="number"?opts.u:isRelative?0:-1;let texv=typeof opts.v==="number"?opts.v:isRelative?0:-1;if(!this.HasMesh())return false;
const sourceMesh=this.GetSourceMesh();const p=sourceMesh.GetMeshPointAt(col,row);if(p===null)return false;let ret=false;if(typeof zElevation==="number"&&p.GetZElevation()!==zElevation){p.SetZElevation(zElevation);ret=true}if(isRelative){posx+=col/(sourceMesh.GetHSize()-1);posy+=row/(sourceMesh.GetVSize()-1)}if(texu===-1&&!isRelative)texu=p.GetU();else{if(isRelative)texu+=col/(sourceMesh.GetHSize()-1);texu=C3.clamp(texu,0,1)}if(texv===-1&&!isRelative)texv=p.GetV();else{if(isRelative)texv+=row/(sourceMesh.GetVSize()-
1);texv=C3.clamp(texv,0,1)}if(p.GetX()===posx&&p.GetY()===posy&&p.GetU()===texu&&p.GetV()===texv)return ret;p.SetX(posx);p.SetY(posy);p.SetU(texu);p.SetV(texv);this._DiscardTransformedCollisionPoly();return true}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(x,y){if(!this.GetBoundingBox().containsPoint(x,y))return false;if(!this.GetBoundingQuad().containsPoint(x,y))return false;if(this.HasTilemap())return this._inst.GetSdkInstance().TestPointOverlapTile(x,y);if(!this.HasOwnCollisionPoly())return true;
return this.GetTransformedCollisionPoly().containsPoint(x-this.GetX(),y-this.GetY())}_IsCollisionCellChanged(){return(this._flags&FLAG_COLLISION_CELL_CHANGED)!==0}_UpdateCollisionCell(){if(!this._IsCollisionCellChanged()||!this.IsCollisionEnabled()||(this._flags&FLAG_DESTROYED)!==0)return;const bbox=this.GetBoundingBox();const grid=this._objectClass._GetCollisionCellGrid();const collisionCells=this._collisionCells;tempRect.set(grid.XToCell(bbox.getLeft()),grid.YToCell(bbox.getTop()),grid.XToCell(bbox.getRight()),
grid.YToCell(bbox.getBottom()));if(collisionCells.equals(tempRect))return;const inst=this._inst;if(collisionCells===DEFAULT_COLLISION_CELLS){grid.Update(inst,null,tempRect);this._collisionCells=C3.New(C3.Rect,tempRect)}else{grid.Update(inst,collisionCells,tempRect);collisionCells.copy(tempRect)}this._flags&=~FLAG_COLLISION_CELL_CHANGED}_SetCollisionCellChanged(){this._flags|=FLAG_COLLISION_CELL_CHANGED}_RemoveFromCollisionCells(){const collisionCells=this._collisionCells;if(collisionCells===DEFAULT_COLLISION_CELLS)return;
this._objectClass._GetCollisionCellGrid().Update(this._inst,collisionCells,null);this._collisionCells=DEFAULT_COLLISION_CELLS}_UpdateRenderCell(){const layer=this.GetLayer();if(!layer.UsesRenderCells()||(this._flags&FLAG_DESTROYED)!==0)return;const renderGrid=layer.GetRenderGrid();const bbox=this.GetBoundingBox();const renderCells=this._renderCells;tempRect.set(renderGrid.XToCell(bbox.getLeft()),renderGrid.YToCell(bbox.getTop()),renderGrid.XToCell(bbox.getRight()),renderGrid.YToCell(bbox.getBottom()));
if(renderCells.equals(tempRect))return;const inst=this._inst;if(renderCells===DEFAULT_RENDER_CELLS){renderGrid.Update(inst,null,tempRect);this._renderCells=C3.New(C3.Rect,tempRect)}else{renderGrid.Update(inst,renderCells,tempRect);renderCells.copy(tempRect)}layer.SetRenderListStale()}_RemoveFromRenderCells(){const renderCells=this._renderCells;if(renderCells===DEFAULT_RENDER_CELLS)return;this.GetLayer().GetRenderGrid().Update(this._inst,renderCells,null);this._renderCells=DEFAULT_RENDER_CELLS}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){const inst=
this._inst;const layer=this._layer;const layerInstances=layer._GetInstances();if(layerInstances.length&&layerInstances.at(-1)===inst)return;layer._RemoveInstance(inst,false);layer._AddInstance(inst,false);this._runtime.UpdateRender()}ZOrderMoveToBottom(){const inst=this._inst;const layer=this._layer;const layerInstances=layer._GetInstances();if(layerInstances.length&&layerInstances[0]===inst)return;layer._RemoveInstance(inst,false);layer._PrependInstance(inst,false);this._runtime.UpdateRender()}ZOrderMoveToLayer(layerMove){const inst=
this._inst;const curLayer=this._layer;if(curLayer.GetLayout()!==layerMove.GetLayout())throw new Error("layer from different layout");if(layerMove===curLayer)return;curLayer._RemoveInstance(inst,true);this._SetLayer(layerMove);layerMove._AddInstance(inst,true);this._runtime.UpdateRender()}ZOrderMoveAdjacentToInstance(otherInst,isAfter){const inst=this._inst;let didChangeLayer=false;const curLayer=this._layer;if(otherInst.GetUID()===inst.GetUID())return;const otherWi=otherInst.GetWorldInfo();if(!otherWi)throw new Error("expected world instance");
const otherLayer=otherWi.GetLayer();if(curLayer.GetIndex()!==otherLayer.GetIndex()){curLayer._RemoveInstance(inst,true);this._SetLayer(otherLayer);otherLayer._AddInstance(inst,true);didChangeLayer=true}const didChangeZOrder=otherLayer.MoveInstanceAdjacent(inst,otherInst,!!isAfter);if(didChangeLayer||didChangeZOrder)this._runtime.UpdateRender()}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(e){this._SetFlag(FLAG_HAS_ANY_ACTIVE_EFFECT,e)}HasAnyActiveEffect(){return(this._flags&
FLAG_HAS_ANY_ACTIVE_EFFECT)!==0}_SaveToJson(mode,opts=null){const o={"x":this.GetX(),"y":this.GetY(),"w":this.GetWidth(),"h":this.GetHeight(),"l":this.GetLayer().GetSID(),"zi":this.GetZIndex()};if(this.GetZElevation()!==0)o["ze"]=this.GetZElevation();if(this.GetAngle()!==0)o["a"]=this._GetAngleNoReflect();if(!this.HasDefaultColor())o["c"]=this._color.toJSON();if(this.GetOriginX()!==.5)o["oX"]=this.GetOriginX();if(this.GetOriginY()!==.5)o["oY"]=this.GetOriginY();if(this.GetBlendMode()!==0)o["bm"]=
this.GetBlendMode();if(!this.IsVisible())o["v"]=this.IsVisible();if(!this.IsCollisionEnabled())o["ce"]=this.IsCollisionEnabled();if(this.IsBboxChangeEventEnabled())o["be"]=this.IsBboxChangeEventEnabled();if(this._instanceEffectList)o["fx"]=this._instanceEffectList._SaveToJson();const isSolidFilterInclusive=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE)!==0;if(isSolidFilterInclusive)o["sfi"]=isSolidFilterInclusive;if(this._solidFilterTags)o["sft"]=[...this._solidFilterTags].join(" ");if(this._sceneGraphInfo&&
mode!=="visual-state"){o["sgi"]=this._sceneGraphInfo._SaveToJson(mode,opts);if(sceneGraphExportDataMap.has(this)){o["sgcd"]=sceneGraphExportDataMap.get(this).childrenData;o["sgzid"]=sceneGraphExportDataMap.get(this).zIndexData}}if(this.HasMesh())o["mesh"]=this.GetSourceMesh().SaveToJson();return o}_SaveSceneGraphPropertiesToJson(){return{"x":this._x,"y":this._y,"z":this._zElevation,"w":this._w,"h":this._h,"a":this._a,"sgi":this._GetSceneGraphInfo()?this._GetSceneGraphInfo()._SaveToJsonProperties():
null}}_LoadSceneGraphPropertiesFromJson(o){if(!o)return;this._x=o["x"];this._y=o["y"];this._zElevation=o["z"];this._w=o["w"];this._h=o["h"];this._a=o["a"];if(o["sgi"]&&this._GetSceneGraphInfo())this._GetSceneGraphInfo()._LoadFromJson(o["sgi"]);this._MarkSinCosAngleChanged();this.SetBboxChanged()}_SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo();this._ResetAllSceneGraphState();this._CreateSceneGraphInfo(null);if(this._sceneGraphInfo)this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,
this._tmpSceneGraphChildrenIndexes)}_OnBeforeLoad(mode){if(mode!=="visual-state")this._ResetAllSceneGraphState()}_OnAfterLoad(o,mode="full",opts=null){if(o.hasOwnProperty("sgi")&&mode!=="visual-state"){if((this._flags&FLAG_DESTROYED)!==0)return;this._sceneGraphInfo._OnAfterLoad(o["sgi"],opts)}}_OnAfterLoad2(o,mode="full",opts=null){if(o.hasOwnProperty("sgi")&&mode!=="visual-state"){if((this._flags&FLAG_DESTROYED)!==0)return;this._sceneGraphInfo._SetTmpSceneGraphChildren(null,null);this._ReleaseTmpSceneGraphInfo();
this.SetBboxChanged()}}_LoadFromJson(o,mode){enableUpdateRendererStateGroup=false;this.SetX(o["x"]);this.SetY(o["y"]);this.SetWidth(o["w"]);this.SetHeight(o["h"]);this._SetZIndex(o["zi"]);this.SetZElevation(o.hasOwnProperty("ze")?o["ze"]:0);this.SetAngle(o.hasOwnProperty("a")?o["a"]:0);if(o.hasOwnProperty("c"))tempColor.setFromJSON(o["c"]);else if(o.hasOwnProperty("o")){tempColor.copyRgb(this._color);tempColor.a=o["o"]}else tempColor.setRgba(1,1,1,1);this._SetColor(tempColor);this.SetOriginX(o.hasOwnProperty("oX")?
o["oX"]:.5);this.SetOriginY(o.hasOwnProperty("oY")?o["oY"]:.5);this.SetBlendMode(o.hasOwnProperty("bm")?o["bm"]:0);this.SetVisible(o.hasOwnProperty("v")?o["v"]:true);this.SetCollisionEnabled(o.hasOwnProperty("ce")?o["ce"]:true);this.SetBboxChangeEventEnabled(o.hasOwnProperty("be")?o["be"]:false);this.SetSolidCollisionFilter(o.hasOwnProperty("sfi")?o["sfi"]:false,o.hasOwnProperty("sft")?o["sft"]:"");if(this._instanceEffectList&&o.hasOwnProperty("fx"))this._instanceEffectList._LoadFromJson(o["fx"]);
if(!o.hasOwnProperty("sgi")&&mode!=="visual-state")if(this._tmpSceneGraphChildren)for(const inst of this._tmpSceneGraphChildren){if(inst.IsDestroyed())continue;this._runtime.DestroyInstance(inst)}if(o.hasOwnProperty("sgi")&&mode!=="visual-state"){this._CreateSceneGraphInfo(null);const sgi=this._sceneGraphInfo;const sgiData=o["sgi"];sgi._LoadFromJson(sgiData);sgi._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes);if(o["sgcd"]&&C3.IsFiniteNumber(o["sgzid"]))sceneGraphExportDataMap.set(this,
{childrenData:o["sgcd"],zIndexData:o["sgzid"]})}if(o.hasOwnProperty("mesh")){const meshData=o["mesh"];this.CreateMesh(meshData["cols"],meshData["rows"]);this.GetSourceMesh().LoadFromJson(meshData)}else this.ReleaseMesh();this.SetBboxChanged();enableUpdateRendererStateGroup=true;this._UpdateRendererStateGroup();if(mode!=="visual-state")this._runtime.AddInstanceNeedingAfterLoad(this.GetInstance(),o)}};

}

// objects/behaviorType.js
{
'use strict';const C3=self.C3;
C3.BehaviorType=class BehaviorType extends C3.DefendedBase{constructor(objectClass,data){super();const runtime=objectClass.GetRuntime();const BehaviorCtor=runtime.GetObjectReference(data[1]);runtime.GetAddonManager()._DelayCreateBehavior(BehaviorCtor);this._runtime=runtime;this._objectClass=objectClass;this._behavior=C3.AddonManager.GetBehaviorByConstructorFunction(BehaviorCtor);this._sdkType=null;this._iBehaviorType=null;this._instSdkCtor=BehaviorCtor.Instance;this._sid=data[2];this._name=data[0];
this._jsPropName=this._runtime.GetJsPropName(data[3]);const sdkVersion=this._behavior.GetSdkVersion();if(sdkVersion<2){this._sdkType=C3.New(BehaviorCtor.Type,this);if(!(this._sdkType instanceof C3.SDKBehaviorTypeBase))throw new Error("v1 sdk type must derive from SDKBehaviorBase");}C3.AddonManager._PushInitObject(this,sdkVersion);if(sdkVersion>=2){const BehaviorTypeClass=BehaviorCtor.Type??globalThis.ISDKBehaviorTypeBase;this._iBehaviorType=new BehaviorTypeClass;if(!(this._iBehaviorType instanceof
globalThis.ISDKBehaviorTypeBase))throw new Error("script interface class must derive from ISDKBehaviorTypeBase");}else this._iBehaviorType=new globalThis.IBehaviorType;C3.AddonManager._PopInitObject(sdkVersion);this.OnCreate()}static Create(objectClass,behaviorTypeData){return C3.New(C3.BehaviorType,objectClass,behaviorTypeData)}Release(){this._runtime=null;this._behavior=null;if(this._sdkType){this._sdkType.Release();this._sdkType=null}this._instSdkCtor=null}GetSdkType(){return this._sdkType}OnCreate(){if(this._sdkType)this._sdkType.OnCreate();
else if(this._iBehaviorType)this._iBehaviorType._onCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetIBehaviorType(){return this._iBehaviorType}GetJsPropName(){return this._jsPropName}};

}

// objects/behaviorInstance.js
{
'use strict';const C3=self.C3;const IBehaviorInstance=self.IBehaviorInstance;
C3.BehaviorInstance=class BehaviorInstance extends C3.DefendedBase{constructor(opts){super();this._runtime=opts.runtime;this._behaviorType=opts.behaviorType;this._behavior=this._behaviorType.GetBehavior();this._inst=opts.instance;this._index=opts.index;this._sdkInst=null;this._iScriptInterface=null;this._behavior._AddInstance(this._inst)}Release(){if(this._iScriptInterface){this._iScriptInterface._release();this._iScriptInterface=null}this._behavior._RemoveInstance(this._inst);if(this._sdkInst){this._sdkInst.Release();
this._sdkInst=null}this._runtime=null;this._behaviorType=null;this._behavior=null;this._inst=null}_CreateSdkInstance(properties){if(this._sdkInst)throw new Error("already got sdk instance");const sdkVersion=this.GetBehavior().GetSdkVersion();if(sdkVersion<2){this._sdkInst=C3.New(this._behaviorType.GetInstanceSdkCtor(),this,properties);if(!(this._sdkInst instanceof C3.SDKBehaviorInstanceBase))throw new Error("v1 sdk type must derive from SDKBehaviorInstanceBase");}else{const BehaviorCtor=this.GetBehavior().GetScriptInterfaceClass();
this._InitScriptInterface(BehaviorCtor.Instance,properties)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){if(this._sdkInst)this._sdkInst.PostCreate();else this._iScriptInterface._postCreate()}OnSpriteFrameChanged(prevFrame,nextFrame){if(this._sdkInst)this._sdkInst.OnSpriteFrameChanged(prevFrame,
nextFrame)}_GetDebuggerProperties(){if(this._sdkInst)return this._sdkInst.GetDebuggerProperties();else return this._iScriptInterface._getDebuggerProperties()}SaveToJson(mode="full"){if(this._sdkInst)return this._sdkInst.SaveToJson(mode);else return this._iScriptInterface._saveToJson(mode)}LoadFromJson(o,mode="full"){if(this._sdkInst)return this._sdkInst.LoadFromJson(o,mode);else this._iScriptInterface._loadFromJson(o,mode)}static SortByTickSequence(runtime,a,b){const ISDKBehaviorInstanceBase=globalThis.ISDKBehaviorInstanceBase;
let behInstA;let behInstB;if(a instanceof ISDKBehaviorInstanceBase)behInstA=runtime._UnwrapScriptInterface(a);else behInstA=a.GetBehaviorInstance();if(b instanceof ISDKBehaviorInstanceBase)behInstB=runtime._UnwrapScriptInterface(b);else behInstB=b.GetBehaviorInstance();const instA=behInstA.GetObjectInstance();const instB=behInstB.GetObjectInstance();const typeIndexA=instA.GetObjectClass().GetIndex();const typeIndexB=instB.GetObjectClass().GetIndex();if(typeIndexA!==typeIndexB)return typeIndexA-typeIndexB;
const seqA=instA.GetPUID();const seqB=instB.GetPUID();if(seqA!==seqB)return seqA-seqB;return behInstA._GetIndex()-behInstB._GetIndex()}_InitScriptInterface(AddonSdkScriptClass,properties){const DefaultScriptClass=IBehaviorInstance;const SdkScriptClass=AddonSdkScriptClass??this._sdkInst.GetScriptInterfaceClass();const ScriptInterfaceClass=SdkScriptClass||DefaultScriptClass;const sdkVersion=this.GetBehavior().GetSdkVersion();C3.AddonManager._PushInitObject(this,sdkVersion);C3.AddonManager._PushInitProperties(properties);
this._iScriptInterface=new ScriptInterfaceClass;C3.AddonManager._PopInitProperties();C3.AddonManager._PopInitObject(sdkVersion);if(SdkScriptClass&&!(this._iScriptInterface instanceof DefaultScriptClass))throw new TypeError(`script interface class '${SdkScriptClass.name}' does not extend the right base class '${DefaultScriptClass.name}'`);return this._iScriptInterface}GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}};

}

// objects/effectList.js
{
'use strict';const C3=self.C3;
C3.EffectList=class EffectList extends C3.DefendedBase{constructor(owner,data){super();this._owner=owner;this._allEffectTypes=[];this._activeEffectTypes=[];this._effectTypesByName=new Map;this._effectParams=[];this._effectParamBuffers=[];this._allInstanceEffectLists=new Set;this._preservesOpaqueness=true;for(const d of data){const et=C3.New(C3.EffectType,this,d,this._allEffectTypes.length);this._allEffectTypes.push(et);this._effectTypesByName.set(et.GetName().toLowerCase(),et);if(d.length>=3)this._effectParams.push(this._LoadSingleEffectParameters(et,
d[2]))}this.GetRuntime()._AddEffectList(this)}Release(){this.GetRuntime()._RemoveEffectList(this);for(const cpb of this._effectParamBuffers)cpb.Release();C3.clearArray(this._effectParamBuffers);C3.clearArray(this._allEffectTypes);C3.clearArray(this._activeEffectTypes);this._effectTypesByName.clear();C3.clearArray(this._effectParams);this._owner=null}_AddInstanceEffectList(iel){this._allInstanceEffectLists.add(iel)}_RemoveInstanceEffectList(iel){this._allInstanceEffectLists.delete(iel)}_InitRenderer(renderer){if(renderer.IsWebGPU()){this._effectParamBuffers=
this._allEffectTypes.map(et=>{const shaderProgram=et.GetShaderProgram();if(shaderProgram.GetCustomParametersByteSize()>0)return C3.New(C3.Gfx.WebGPUEffectCustomParamsBuffer,shaderProgram);else return null});this._UpdateAllEffectParamBuffers()}for(const iel of this._allInstanceEffectLists)iel._InitRenderer(renderer)}PrependEffectTypes(arr){if(!arr.length)return;this._allEffectTypes=arr.concat(this._allEffectTypes);for(const et of arr)this._effectTypesByName.set(et.GetName().toLowerCase(),et);for(let i=
0,len=this._allEffectTypes.length;i<len;++i)this._allEffectTypes[i]._SetIndex(i)}_LoadSingleEffectParameters(effectType,arr){effectType.SetActive(arr[0]);const ret=arr.slice(1);for(let i=0,len=ret.length;i<len;++i){const p=ret[i];if(Array.isArray(p)){const c=C3.New(C3.Color);c.setFromJSON(p);ret[i]=c}}return ret}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){C3.clearArray(this._activeEffectTypes);let preservesOpaqueness=true;for(const et of this._allEffectTypes)if(et.IsActive()){this._activeEffectTypes.push(et);
if(!et.GetShaderProgram().PreservesOpaqueness())preservesOpaqueness=false}this._preservesOpaqueness=preservesOpaqueness}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return this._allEffectTypes.length>0}GetEffectTypeByName(name){return this._effectTypesByName.get(name.toLowerCase())||null}GetEffectTypeByIndex(index){index=Math.floor(+index);if(index<0||index>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[index]}IsEffectIndexActive(index){return this.GetEffectTypeByIndex(index).IsActive()}SetEffectIndexActive(index,
a){this.GetEffectTypeByIndex(index).SetActive(a)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return this._activeEffectTypes.length>0}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(index){return this._effectParams[index]}_GetEffectChainShaderParametersForIndex(index){if(index<this._effectParamBuffers.length)return this._effectParamBuffers[index];else return this._effectParams[index]}GetEffectParameter(effectIndex,paramIndex){if(effectIndex<
0||effectIndex>=this._effectParams.length)return null;const effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return null;return effectParams[paramIndex]}SetEffectParameter(effectIndex,paramIndex,value){if(effectIndex<0||effectIndex>=this._effectParams.length)return false;const effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return false;const oldValue=effectParams[paramIndex];if(oldValue instanceof C3.Color){if(oldValue.equalsIgnoringAlpha(value))return false;
oldValue.copyRgb(value)}else{if(oldValue===value)return false;effectParams[paramIndex]=value}if(effectIndex<this._effectParamBuffers.length)this._effectParamBuffers[effectIndex].SetParameterValue(paramIndex,value);return true}_UpdateAllEffectParamBuffers(){const effectParams=this._effectParams;const effectParamBuffers=this._effectParamBuffers;for(let i=0,len=Math.min(effectParams.length,effectParamBuffers.length);i<len;++i){const paramsBuf=effectParamBuffers[i];const params=effectParams[i];for(let j=
0,lenj=params.length;j<lenj;++j)paramsBuf.SetParameterValue(j,params[j])}}static SaveFxParamToJson(param){if(param&&param instanceof C3.Color)return{"t":"color","v":param.toJSON()};else return param}static LoadFxParamFromJson(o){if(o===null)return NaN;else if(typeof o==="object"){const type=o["t"];if(type==="color"){const color=C3.New(C3.Color);color.setFromJSON(o["v"]);return color}else throw new Error("invalid effect parameter type");}else return o}static SaveFxParamsToJson(params){return params.map(C3.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(arr){return arr.map(C3.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map(et=>
({"name":et.GetName(),"active":et.IsActive(),"params":C3.EffectList.SaveFxParamsToJson(this._effectParams[et.GetIndex()])}))}LoadFromJson(arr){for(const o of arr){const et=this.GetEffectTypeByName(o["name"]);if(!et)continue;et.SetActive(o["active"]);this._effectParams[et.GetIndex()]=C3.EffectList.LoadFxParamsFromJson(o["params"])}this.UpdateActiveEffects();this._UpdateAllEffectParamBuffers()}};

}

// objects/effectType.js
{
'use strict';const C3=self.C3;
C3.EffectType=class EffectType extends C3.DefendedBase{constructor(effectList,data,index){super();this._effectList=effectList;this._id=data[0];this._name=data[1];this._index=index;this._shaderProgram=null;this._isActive=true}Release(){this._effectList=null;this._shaderProgram=null}Clone(effectListOwner){const ret=C3.New(C3.EffectType,effectListOwner,[this._id,this._name],-1);ret._shaderProgram=this._shaderProgram;ret._isActive=this._isActive;return ret}_InitRenderer(renderer){const shaderProgram=renderer.GetShaderProgramByName(this._id);
if(!shaderProgram)throw new Error("failed to find shader program '"+this._id+"'");this._shaderProgram=shaderProgram}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(i){this._index=i}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(a){this._isActive=!!a}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){const ret=[];for(let i=0,
len=this._shaderProgram.GetParameterCount();i<len;++i){const type=this._shaderProgram.GetParameterType(i);if(type==="float"||type==="percent")ret.push(0);else if(type==="color")ret.push(C3.New(C3.Color,1,1,1,1));else throw new TypeError("unknown effect parameter type");}return ret}};

}

// objects/instanceEffectList.js
{
'use strict';const C3=self.C3;
C3.InstanceEffectList=class InstanceEffectList extends C3.DefendedBase{constructor(inst,wi){super();this._inst=inst;this._wi=wi;this._effectList=inst.GetObjectClass().GetEffectList();this._needsRebuildSteps=true;this._wasDefaultColor=true;this._was3D=false;this._wasRotatedOrNegativeSize=false;this._wasTexRotated=false;this._wasMustPreDraw=false;this._effectChain=C3.New(C3.Gfx.EffectChain,inst.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(renderer,effectChain)=>{const inst=
effectChain.GetContentObject();const wi=inst.GetWorldInfo();renderer.SetColor(wi.GetPremultipliedColor());renderer.SetCurrentZ(wi.GetTotalZElevation());inst.Draw(renderer);renderer.SetCurrentZ(0)},getSourceTextureInfo:inst=>{const srcTexRect=inst.GetCurrentTexRect();const [srcWidth,srcHeight]=inst.GetCurrentSurfaceSize();return{srcTexRect,srcWidth,srcHeight}},getShaderParameters:index=>this._GetEffectChainShaderParametersForIndex(index)});this._activeEffectFlags=[];this._activeEffectTypes=[];this._preservesOpaqueness=
true;this._effectParams=[];this._effectParamBuffers=[];this._InitRenderer(inst.GetRuntime().GetRenderer());for(let i=0,len=this._effectList.GetAllEffectTypes().length;i<len;++i)this._activeEffectFlags.push(true);this.UpdateActiveEffects();this._effectList._AddInstanceEffectList(this)}Release(){this._effectList._RemoveInstanceEffectList(this);for(const cpb of this._effectParamBuffers)if(cpb)cpb.Release();C3.clearArray(this._effectParamBuffers);this._effectChain.Release();this._effectChain=null;C3.clearArray(this._activeEffectFlags);
C3.clearArray(this._activeEffectTypes);C3.clearArray(this._effectParams);this._inst=null;this._effectList=null}_InitRenderer(renderer){if(renderer.IsWebGPU())this._effectParamBuffers=this._effectList.GetAllEffectTypes().map(et=>{const shaderProgram=et.GetShaderProgram();if(shaderProgram.GetCustomParametersByteSize()>0)return C3.New(C3.Gfx.WebGPUEffectCustomParamsBuffer,shaderProgram);else return null})}_LoadEffectParameters(data){let index=0;for(const e of data){this._effectParams.push(this._LoadSingleEffectParameters(index,
e));++index}this._UpdateAllEffectParamBuffers();this.UpdateActiveEffects()}_LoadSingleEffectParameters(index,arr){this._activeEffectFlags[index]=arr[0];const ret=arr.slice(1);for(let i=0,len=ret.length;i<len;++i){const p=ret[i];if(Array.isArray(p)){const c=C3.New(C3.Color);c.setFromJSON(p);ret[i]=c}}return ret}LoadDefaultEffectParameters(){for(const effectType of this._effectList.GetAllEffectTypes())this._effectParams.push(effectType.GetDefaultParameterValues());this._UpdateAllEffectParamBuffers()}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){this._MaybeRebuildEffectChainSteps();
return this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){C3.clearArray(this._activeEffectTypes);const wi=this._wi;const allEffectTypes=this._effectList.GetAllEffectTypes();const activeEffectTypes=this._activeEffectTypes;const activeEffectFlags=this._activeEffectFlags;let preservesOpaqueness=true;for(let i=0,len=allEffectTypes.length;i<len;++i)if(activeEffectFlags[i]){const et=allEffectTypes[i];activeEffectTypes.push(et);if(!et.GetShaderProgram().PreservesOpaqueness())preservesOpaqueness=
false}this._preservesOpaqueness=preservesOpaqueness;wi._SetHasAnyActiveEffect(!!activeEffectTypes.length);this._needsRebuildSteps=true}_MaybeRebuildEffectChainSteps(){const inst=this._inst;const wi=this._wi;const isDefaultColor=wi.HasDefaultColor();const is3D=inst.GetPlugin().Is3D();const isRotatedOrNegativeSizeInstance=wi.GetAngle()!==0||wi.GetLayer().GetAngle()!==0||wi.GetWidth()<0||wi.GetHeight()<0;const isTexRotated=inst.IsCurrentTexRotated();const isMustPreDraw=inst.MustPreDraw();if(!this._needsRebuildSteps&&
isDefaultColor===this._wasDefaultColor&&is3D===this._was3D&&isRotatedOrNegativeSizeInstance===this._wasRotatedOrNegativeSize&&isTexRotated===this._wasTexRotated&&isMustPreDraw===this._wasMustPreDraw&&!this._effectChain.NeedsRebuild())return;this._effectChain.BuildSteps(this._activeEffectTypes.map(e=>e.GetShaderProgram()),{indexMap:this._activeEffectTypes.map(e=>e.GetIndex()),forcePreDraw:!isDefaultColor||isMustPreDraw,is3D,isSourceTextureRotated:isTexRotated,isRotatedOrNegativeSizeInstance});this._needsRebuildSteps=
false;this._wasDefaultColor=isDefaultColor;this._was3D=is3D;this._wasRotatedOrNegativeSize=isRotatedOrNegativeSizeInstance;this._wasTexRotated=isTexRotated;this._wasMustPreDraw=isMustPreDraw}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(index){return this._effectParams[index]}_GetEffectChainShaderParametersForIndex(index){if(index<this._effectParamBuffers.length)return this._effectParamBuffers[index];else return this._effectParams[index]}GetEffectParameter(effectIndex,
paramIndex){if(effectIndex<0||effectIndex>=this._effectParams.length)return null;const effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return null;return effectParams[paramIndex]}SetEffectParameter(effectIndex,paramIndex,value){if(effectIndex<0||effectIndex>=this._effectParams.length)return false;const effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return false;const oldValue=effectParams[paramIndex];if(oldValue instanceof
C3.Color){if(oldValue.equalsIgnoringAlpha(value))return false;oldValue.copyRgb(value)}else{if(oldValue===value)return false;effectParams[paramIndex]=value}if(effectIndex<this._effectParamBuffers.length)this._effectParamBuffers[effectIndex].SetParameterValue(paramIndex,value);return true}_UpdateAllEffectParamBuffers(){const effectParams=this._effectParams;const effectParamBuffers=this._effectParamBuffers;for(let i=0,len=effectParamBuffers.length;i<len;++i){const paramsBuf=effectParamBuffers[i];const params=
effectParams[i];for(let j=0,lenj=params.length;j<lenj;++j)paramsBuf.SetParameterValue(j,params[j])}}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some(et=>et.GetShaderProgram().BlendsBackground())}IsEffectIndexActive(i){return this._activeEffectFlags[i]}SetEffectIndexActive(i,e){this._activeEffectFlags[i]=!!e}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map(et=>
({"name":et.GetName(),"active":this._activeEffectFlags[et.GetIndex()],"params":C3.EffectList.SaveFxParamsToJson(this._effectParams[et.GetIndex()])}))}_LoadFromJson(arr){for(const o of arr){const et=this._effectList.GetEffectTypeByName(o["name"]);if(!et)continue;this._activeEffectFlags[et.GetIndex()]=o["active"];this._effectParams[et.GetIndex()]=C3.EffectList.LoadFxParamsFromJson(o["params"])}this.UpdateActiveEffects();this._UpdateAllEffectParamBuffers()}};

}

// collisions/collisionEngine.js
{
'use strict';const C3=self.C3;const tempCandidates=[];const tileCollRectCandidates=[];const tempJumpthruRet=[];const tempPolyA=C3.New(C3.CollisionPoly);const tempPolyB=C3.New(C3.CollisionPoly);const tempQuad=C3.New(C3.Quad);const tempRect=C3.New(C3.Rect);const tempRect2=C3.New(C3.Rect);let tempPolyC=null;let tempRect3=null;let tempQuadB=null;
C3.CollisionEngine=class CollisionEngine extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._collisionCellWidth=0;this._collisionCellHeight=0;this._registeredCollisions=[];this._collisionCheckCount=0;this._collisionCheckSec=0;this._polyCheckCount=0;this._polyCheckSec=0;this._iCollisionEngine=new self.ICollisionEngine(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetICollisionEngine(){return this._iCollisionEngine}_Update1sStats(){this._collisionCheckSec=
this._collisionCheckCount;this._collisionCheckCount=0;this._polyCheckSec=this._polyCheckCount;this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(a,b){const aw=a.GetWorldInfo();const bw=b.GetWorldInfo();if(!aw||!bw)return;if(!aw.IsCollisionEnabled()||!bw.IsCollisionEnabled())return;this._registeredCollisions.push([a,b])}AddRegisteredCollisionCandidates(inst,otherType,arr){for(const [a,b]of this._registeredCollisions){let otherInst=
null;if(inst===a)otherInst=b;else if(inst===b)otherInst=a;else continue;if(!otherInst.BelongsToObjectClass(otherType))continue;if(!arr.includes(otherInst))arr.push(otherInst)}}CheckRegisteredCollision(a,b){if(!this._registeredCollisions.length)return false;for(const [c,d]of this._registeredCollisions)if(a===c&&b===d||a===d&&b===c)return true;return false}ClearRegisteredCollisions(){C3.clearArray(this._registeredCollisions)}TestOverlap(a,b){if(!a||!b||a===b)return false;const aw=a.GetWorldInfo();const bw=
b.GetWorldInfo();if(!aw.IsCollisionEnabled()||!bw.IsCollisionEnabled())return false;this._collisionCheckCount++;const layerA=aw.GetLayer();const layerB=bw.GetLayer();const areLayerTransformsCompatible=layerA.IsTransformCompatibleWith(layerB);if(areLayerTransformsCompatible)return this._TestOverlap_SameLayers(aw,bw);else return this._TestOverlap_DifferentLayers(aw,bw)}_TestOverlap_SameLayers(aw,bw){if(!aw.GetBoundingBox().intersectsRect(bw.GetBoundingBox()))return false;this._polyCheckCount++;if(!aw.GetBoundingQuad().intersectsQuad(bw.GetBoundingQuad()))return false;
if(aw.HasTilemap()&&bw.HasTilemap())return false;if(aw.HasTilemap())return this.TestTilemapOverlap(aw,bw);else if(bw.HasTilemap())return this.TestTilemapOverlap(bw,aw);if(!aw.HasOwnCollisionPoly()&&!bw.HasOwnCollisionPoly())return true;const polyA=aw.GetTransformedCollisionPoly();const polyB=bw.GetTransformedCollisionPoly();return polyA.intersectsPoly(polyB,bw.GetX()-aw.GetX(),bw.GetY()-aw.GetY())}_TestOverlap_DifferentLayers(aw,bw){const aIsTileMap=aw.HasTilemap();const bIsTileMap=bw.HasTilemap();
if(aIsTileMap&&!bIsTileMap)return this.TestTilemapOverlapDifferentLayers(aw,bw);else if(bIsTileMap&&!aIsTileMap)return this.TestTilemapOverlapDifferentLayers(bw,aw);else if(!bIsTileMap&&!aIsTileMap){const layerA=aw.GetLayer();const layerB=bw.GetLayer();tempPolyA.copy(aw.GetTransformedCollisionPoly());tempPolyB.copy(bw.GetTransformedCollisionPoly());const ptsArrA=tempPolyA.pointsArr();for(let i=0,len=ptsArrA.length;i<len;i+=2){const j=i+1;const x=ptsArrA[i];const y=ptsArrA[j];const [lx,ly]=layerA.LayerToCanvasCss(x+
aw.GetX(),y+aw.GetY());ptsArrA[i]=lx;ptsArrA[j]=ly}const ptsArrB=tempPolyB.pointsArr();for(let i=0,len=ptsArrB.length;i<len;i+=2){const j=i+1;const x=ptsArrB[i];const y=ptsArrB[j];const [lx,ly]=layerB.LayerToCanvasCss(x+bw.GetX(),y+bw.GetY());ptsArrB[i]=lx;ptsArrB[j]=ly}tempPolyA.setBboxChanged();tempPolyB.setBboxChanged();this._polyCheckCount++;return tempPolyA.intersectsPoly(tempPolyB,0,0)}else return false}TestTilemapOverlapDifferentLayers(tilemapWi,nonTilemapWi){const tilemapLayer=tilemapWi.GetLayer();
const nonTilemapLayer=nonTilemapWi.GetLayer();if(!tempPolyC)tempPolyC=C3.New(C3.CollisionPoly);if(!tempRect3)tempRect3=C3.New(C3.Rect);if(!tempQuadB)tempQuadB=C3.New(C3.Quad);const nonTilemapX=nonTilemapWi.GetX();const nonTilemapY=nonTilemapWi.GetY();const [lx,ly]=nonTilemapLayer.LayerToCanvasCss(nonTilemapX,nonTilemapY);const [nonTilemapTransformedX,nonTilemapTransformedY]=tilemapLayer.CanvasCssToLayer(lx,ly);const deltaX=nonTilemapTransformedX-nonTilemapX;const deltaY=nonTilemapTransformedY-nonTilemapY;
tempRect3.copy(nonTilemapWi.GetBoundingBox());tempRect3.offset(deltaX,deltaY);if(!tilemapWi.GetBoundingBox().intersectsRect(tempRect3))return false;tempQuadB.copy(nonTilemapWi.GetBoundingQuad());tempQuadB.offset(deltaX,deltaY);this._polyCheckCount++;if(!tilemapWi.GetBoundingQuad().intersectsQuad(tempQuadB))return false;tempPolyC.copy(nonTilemapWi.GetTransformedCollisionPoly());const ptsArrB=tempPolyC.pointsArr();for(let i=0,len=ptsArrB.length;i<len;i+=2){const j=i+1;ptsArrB[i]+=deltaX;ptsArrB[j]+=
deltaY}tempPolyC.setBboxChanged();return this.TestTilemapOverlap(tilemapWi,nonTilemapWi,nonTilemapTransformedX,nonTilemapTransformedY,tempPolyC,tempRect3,tempQuadB)}TestTilemapOverlap(tmWi,wi,transformedWiX,transformedWiY,transformedCollisionPoly,transformedBoundingBox,transformedBoundingQuad){const bbox=transformedBoundingBox!==undefined?transformedBoundingBox:wi.GetBoundingBox();const tmX=tmWi.GetX();const tmY=tmWi.GetY();const tmSdkInst=tmWi.GetInstance().GetSdkInstance();const instX=transformedWiX!==
undefined?transformedWiX:wi.GetX();const instY=transformedWiY!==undefined?transformedWiY:wi.GetY();const instHasPoly=wi.HasOwnCollisionPoly();const instQuad=transformedBoundingQuad!==undefined?transformedBoundingQuad:wi.GetBoundingQuad();const collRects=tileCollRectCandidates;tmSdkInst.GetCollisionRectCandidates(bbox,collRects);for(let i=0,len=collRects.length;i<len;++i){const c=collRects[i];const rc=c.GetRect();this._collisionCheckCount++;if(bbox.intersectsRectOffset(rc,tmX,tmY)){tempQuad.setFromRect(rc);
tempQuad.offset(tmX,tmY);if(tempQuad.intersectsQuad(instQuad))if(instHasPoly){const instPoly=transformedCollisionPoly!==undefined?transformedCollisionPoly:wi.GetTransformedCollisionPoly();let instOffX=instX;let instOffY=instY;if(transformedCollisionPoly!==undefined){instOffX=wi.GetX();instOffY=wi.GetY()}const tilePoly=c.GetPoly();if(tilePoly){this._polyCheckCount++;if(tilePoly.intersectsPoly(instPoly,instOffX-(tmX+rc.getLeft()),instOffY-(tmY+rc.getTop()))){C3.clearArray(collRects);return true}}else{tempPolyA.setFromQuad(tempQuad,
0,0);if(tempPolyA.intersectsPoly(instPoly,instOffX,instOffY)){C3.clearArray(collRects);return true}}}else{const tilePoly=c.GetPoly();if(tilePoly){tempPolyA.setFromQuad(instQuad,0,0);if(tilePoly.intersectsPoly(tempPolyA,-(tmX+rc.getLeft()),-(tmY+rc.getTop()))){C3.clearArray(collRects);return true}}else{C3.clearArray(collRects);return true}}}}C3.clearArray(collRects);return false}TestAndSelectCanvasPointOverlap(objectClass,ptsArr,isInverted){const sol=objectClass.GetCurrentSol();const currentEvent=
this._runtime.GetCurrentEvent();if(!currentEvent)throw new Error("cannot call outside event");const isOrBlock=currentEvent.IsOrBlock();const interactiveLayersCache=new Map;const isLayerInteractive=layer=>{let ret=interactiveLayersCache.get(layer);if(typeof ret==="undefined"){ret=layer.IsSelfAndParentsInteractive();interactiveLayersCache.set(layer,ret)}return ret};if(sol.IsSelectAll()){if(!isInverted){sol._SetSelectAll(false);C3.clearArray(sol._GetOwnInstances())}if(isOrBlock)C3.clearArray(sol._GetOwnElseInstances());
for(const inst of objectClass.GetInstances()){const wi=inst.GetWorldInfo();const layer=wi.GetLayer();let containsPoint=false;if(isLayerInteractive(layer)&&wi.IsInViewport2())containsPoint=ptsArr.some(([ptx,pty])=>{const [lx,ly]=layer.CanvasCssToLayer(ptx,pty,wi.GetTotalZElevation());return wi.ContainsPoint(lx,ly)});if(containsPoint)if(isInverted)return false;else sol._PushInstance(inst);else if(isOrBlock)sol._PushElseInstance(inst)}}else{let arr;let isPickingElseInstances=false;if(isOrBlock&&!currentEvent.IsFirstConditionOfType(this._runtime.GetCurrentCondition()))if(this._runtime.IsCurrentConditionFirst()&&
!sol._GetOwnElseInstances().length&&sol._GetOwnInstances().length)arr=sol._GetOwnInstances();else{arr=sol._GetOwnElseInstances();isPickingElseInstances=true}else arr=sol._GetOwnInstances();let j=0;for(let i=0,len=arr.length;i<len;++i){const inst=arr[i];const wi=inst.GetWorldInfo();const layer=wi.GetLayer();let containsPoint=false;if(isLayerInteractive(layer)&&wi.IsInViewport2())containsPoint=ptsArr.some(([ptx,pty])=>{const [lx,ly]=layer.CanvasCssToLayer(ptx,pty,wi.GetTotalZElevation());return wi.ContainsPoint(lx,
ly)});if(containsPoint)if(isInverted)return false;else if(isPickingElseInstances)sol._PushInstance(inst);else arr[j++]=inst;else if(isPickingElseInstances)arr[j++]=inst;else if(isOrBlock)sol._PushElseInstance(inst)}if(!isInverted)arr.length=j}objectClass.ApplySolToContainer();interactiveLayersCache.clear();if(isInverted)return true;else return sol.HasAnyInstances()}GetCollisionCandidates(layer,rtype,bbox,candidates){const isParallaxed=layer?layer.GetParallaxX()!==1||layer.GetParallaxY()!==1:false;
if(rtype.IsFamily())for(const memberType of rtype.GetFamilyMembers())if(isParallaxed||memberType.IsAnyInstanceParallaxed())C3.appendArray(candidates,memberType.GetInstances());else{memberType._UpdateAllCollisionCells();memberType._GetCollisionCellGrid().QueryRange(bbox,candidates)}else if(isParallaxed||rtype.IsAnyInstanceParallaxed())C3.appendArray(candidates,rtype.GetInstances());else{rtype._UpdateAllCollisionCells();rtype._GetCollisionCellGrid().QueryRange(bbox,candidates)}}GetObjectClassesCollisionCandidates(layer,
objectClasses,bbox,candidates){for(const objectClass of objectClasses)this.GetCollisionCandidates(layer,objectClass,bbox,candidates)}GetSolidCollisionCandidates(layer,bbox,candidates){const solidBehavior=this._runtime.GetSolidBehavior();if(!solidBehavior)return;this.GetObjectClassesCollisionCandidates(layer,solidBehavior.GetObjectClasses(),bbox,candidates)}GetJumpthruCollisionCandidates(layer,bbox,candidates){const jumpthruBehavior=this._runtime.GetJumpthruBehavior();if(!jumpthruBehavior)return;this.GetObjectClassesCollisionCandidates(layer,
jumpthruBehavior.GetObjectClasses(),bbox,candidates)}IsSolidCollisionAllowed(solidInst,inst){return solidInst._IsSolidEnabled()&&(!inst||inst.GetWorldInfo().IsSolidCollisionAllowed(solidInst.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(inst){const wi=inst.GetWorldInfo();this.GetSolidCollisionCandidates(wi.GetLayer(),wi.GetBoundingBox(),tempCandidates);for(const s of tempCandidates){if(!this.IsSolidCollisionAllowed(s,inst))continue;if(this.TestOverlap(inst,s)){C3.clearArray(tempCandidates);
return s}}C3.clearArray(tempCandidates);return null}TestRectOverlapSolid(rect,inst){this.GetSolidCollisionCandidates(null,rect,tempCandidates);for(const s of tempCandidates){if(!this.IsSolidCollisionAllowed(s,inst))continue;if(this.TestRectOverlap(rect,s)){C3.clearArray(tempCandidates);return s}}C3.clearArray(tempCandidates);return null}TestOverlapJumpthru(inst,all){let ret=null;if(all){ret=tempJumpthruRet;C3.clearArray(ret)}const wi=inst.GetWorldInfo();this.GetJumpthruCollisionCandidates(wi.GetLayer(),
wi.GetBoundingBox(),tempCandidates);for(const j of tempCandidates){if(!j._IsJumpthruEnabled())continue;if(this.TestOverlap(inst,j))if(all)ret.push(j);else{C3.clearArray(tempCandidates);return j}}C3.clearArray(tempCandidates);return ret}PushOut(inst,xdir,ydir,dist,otherInst){dist=dist||50;const wi=inst.GetWorldInfo();const oldX=wi.GetX();const oldY=wi.GetY();for(let i=0;i<dist;++i){wi.SetXY(oldX+xdir*i,oldY+ydir*i);wi.SetBboxChanged();if(!this.TestOverlap(inst,otherInst))return true}wi.SetXY(oldX,
oldY);wi.SetBboxChanged();return false}PushOutSolid(inst,xdir,ydir,dist,includeJumpthrus,specificJumpthru){dist=dist||50;const wi=inst.GetWorldInfo();const oldX=wi.GetX();const oldY=wi.GetY();let lastOverlapped=null;let secondLastOverlapped=null;for(let i=0;i<dist;++i){wi.SetXY(oldX+xdir*i,oldY+ydir*i);wi.SetBboxChanged();if(!this.TestOverlap(inst,lastOverlapped)){lastOverlapped=this.TestOverlapSolid(inst);if(lastOverlapped)secondLastOverlapped=lastOverlapped;else{if(includeJumpthrus){if(specificJumpthru)lastOverlapped=
this.TestOverlap(inst,specificJumpthru)?specificJumpthru:null;else lastOverlapped=this.TestOverlapJumpthru(inst);if(lastOverlapped)secondLastOverlapped=lastOverlapped}if(!lastOverlapped){if(secondLastOverlapped)this.PushInFractional(inst,xdir,ydir,secondLastOverlapped,16,true);return true}}}}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false}PushOutSolidAxis(inst,xdir,ydir,dist){dist=dist||50;const wi=inst.GetWorldInfo();const oldX=wi.GetX();const oldY=wi.GetY();let lastOverlapped=null;let secondLastOverlapped=
null;for(let i=0;i<dist;++i)for(let which=0;which<2;++which){const sign=which*2-1;wi.SetXY(oldX+xdir*i*sign,oldY+ydir*i*sign);wi.SetBboxChanged();if(!this.TestOverlap(inst,lastOverlapped)){lastOverlapped=this.TestOverlapSolid(inst);if(lastOverlapped)secondLastOverlapped=lastOverlapped;else{if(secondLastOverlapped)this.PushInFractional(inst,xdir*sign,ydir*sign,secondLastOverlapped,16,true);return true}}}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false}PushInFractional(inst,xdir,ydir,otherInst,
limit,includeAnySolid){let divisor=2;let forward=false;let overlapping=false;const wi=inst.GetWorldInfo();let bestX=wi.GetX();let bestY=wi.GetY();while(divisor<=limit){const frac=1/divisor;divisor*=2;wi.OffsetXY(xdir*frac*(forward?1:-1),ydir*frac*(forward?1:-1));wi.SetBboxChanged();if(this.TestOverlap(inst,otherInst)||includeAnySolid&&this.TestOverlapSolid(inst)){forward=true;overlapping=true}else{forward=false;overlapping=false;bestX=wi.GetX();bestY=wi.GetY()}}if(overlapping){wi.SetXY(bestX,bestY);
wi.SetBboxChanged()}}PushOutSolidNearest(inst,maxDist=100){let dist=0;const wi=inst.GetWorldInfo();const oldX=wi.GetX();const oldY=wi.GetY();let dir=0;let lastOverlapped=this.TestOverlapSolid(inst);if(!lastOverlapped)return true;while(dist<=maxDist){let dx=0;let dy=0;switch(dir){case 0:dx=0;dy=-1;dist++;break;case 1:dx=1;dy=-1;break;case 2:dx=1;dy=0;break;case 3:dx=1;dy=1;break;case 4:dx=0;dy=1;break;case 5:dx=-1;dy=1;break;case 6:dx=-1;dy=0;break;case 7:dx=-1;dy=-1;break}dir=(dir+1)%8;wi.SetXY(Math.floor(oldX+
dx*dist),Math.floor(oldY+dy*dist));wi.SetBboxChanged();if(!this.TestOverlap(inst,lastOverlapped)){lastOverlapped=this.TestOverlapSolid(inst);if(!lastOverlapped)return true}}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false}CalculateBounceAngle(inst,startX,startY,otherInst){const wi=inst.GetWorldInfo();const oldX=wi.GetX();const oldY=wi.GetY();const radius=Math.max(10,C3.distanceTo(startX,startY,oldX,oldY));const startAngle=C3.angleTo(startX,startY,oldX,oldY);const firstInst=otherInst||this.TestOverlapSolid(inst);
if(!firstInst)return C3.clampAngle(startAngle+Math.PI);let curInst=firstInst;let anticlockwiseFreeAngle=0;let clockwiseFreeAngle=0;const increment=C3.toRadians(5);let i;for(i=1;i<36;++i){const curAngle=startAngle-i*increment;wi.SetXY(startX+Math.cos(curAngle)*radius,startY+Math.sin(curAngle)*radius);wi.SetBboxChanged();if(!this.TestOverlap(inst,curInst)){curInst=otherInst?null:this.TestOverlapSolid(inst);if(!curInst){anticlockwiseFreeAngle=curAngle;break}}}if(i===36)anticlockwiseFreeAngle=C3.clampAngle(startAngle+
Math.PI);curInst=firstInst;for(i=1;i<36;++i){const curAngle=startAngle+i*increment;wi.SetXY(startX+Math.cos(curAngle)*radius,startY+Math.sin(curAngle)*radius);wi.SetBboxChanged();if(!this.TestOverlap(inst,curInst)){curInst=otherInst?null:this.TestOverlapSolid(inst);if(!curInst){clockwiseFreeAngle=curAngle;break}}}if(i===36)clockwiseFreeAngle=C3.clampAngle(startAngle+Math.PI);wi.SetXY(oldX,oldY);wi.SetBboxChanged();if(clockwiseFreeAngle===anticlockwiseFreeAngle)return clockwiseFreeAngle;const halfDiff=
C3.angleDiff(clockwiseFreeAngle,anticlockwiseFreeAngle)/2;let normal;if(C3.angleClockwise(clockwiseFreeAngle,anticlockwiseFreeAngle))normal=C3.clampAngle(anticlockwiseFreeAngle+halfDiff+Math.PI);else normal=C3.clampAngle(clockwiseFreeAngle+halfDiff);const vx=Math.cos(startAngle);const vy=Math.sin(startAngle);const nx=Math.cos(normal);const ny=Math.sin(normal);const v_dot_n=vx*nx+vy*ny;const rx=vx-2*v_dot_n*nx;const ry=vy-2*v_dot_n*ny;return C3.angleTo(0,0,rx,ry)}TestSegmentOverlap(x1,y1,x2,y2,inst){if(!inst)return false;
const wi=inst.GetWorldInfo();if(!wi.IsCollisionEnabled())return false;this._collisionCheckCount++;tempRect.set(Math.min(x1,x2),Math.min(y1,y2),Math.max(x1,x2),Math.max(y1,y2));if(!wi.GetBoundingBox().intersectsRect(tempRect))return false;if(inst.HasTilemap())return this._TestSegmentOverlapTilemap(x1,y1,x2,y2,inst,wi);this._polyCheckCount++;if(!wi.GetBoundingQuad().intersectsSegment(x1,y1,x2,y2))return false;if(!wi.HasOwnCollisionPoly())return true;const poly=wi.GetTransformedCollisionPoly();return poly.intersectsSegment(wi.GetX(),
wi.GetY(),x1,y1,x2,y2)}_TestSegmentOverlapTilemap(x1,y1,x2,y2,inst,wi){const tmX=wi.GetX();const tmY=wi.GetY();const sdkInst=inst.GetSdkInstance();const collRects=tileCollRectCandidates;tempRect2.set(x1,y1,x2,y2);tempRect2.normalize();sdkInst.GetCollisionRectCandidates(tempRect2,collRects);for(let i=0,len=collRects.length;i<len;++i){const c=collRects[i];const tileRc=c.GetRect();this._collisionCheckCount++;if(tempRect.intersectsRectOffset(tileRc,tmX,tmY)){tempQuad.setFromRect(tileRc);tempQuad.offset(tmX,
tmY);if(tempQuad.intersectsSegment(x1,y1,x2,y2)){const tilePoly=c.GetPoly();if(tilePoly){this._polyCheckCount++;if(tilePoly.intersectsSegment(tmX+tileRc.getLeft(),tmY+tileRc.getTop(),x1,y1,x2,y2)){C3.clearArray(collRects);return true}}else{C3.clearArray(collRects);return true}}}}C3.clearArray(collRects);return false}TestRectOverlap(rect,inst){if(!inst)return false;const wi=inst.GetWorldInfo();if(!wi.IsCollisionEnabled())return false;this._collisionCheckCount++;if(!wi.GetBoundingBox().intersectsRect(rect))return false;
if(inst.HasTilemap())return this._TestRectOverlapTilemap(rect,inst,wi);this._polyCheckCount++;tempQuad.setFromRect(rect);if(!wi.GetBoundingQuad().intersectsQuad(tempQuad))return false;if(!wi.HasOwnCollisionPoly())return true;const polyA=tempPolyA;polyA.setFromRect(rect,wi.GetX(),wi.GetY());const polyB=wi.GetTransformedCollisionPoly();return polyA.intersectsPoly(polyB,0,0)}_TestRectOverlapTilemap(rect,inst,wi){const tmX=wi.GetX();const tmY=wi.GetY();const sdkInst=inst.GetSdkInstance();const collRects=
tileCollRectCandidates;sdkInst.GetCollisionRectCandidates(rect,collRects);for(let i=0,len=collRects.length;i<len;++i){const c=collRects[i];const tileRc=c.GetRect();this._collisionCheckCount++;if(rect.intersectsRectOffset(tileRc,tmX,tmY)){const tilePoly=c.GetPoly();if(tilePoly){this._polyCheckCount++;tempPolyA.setFromRect(rect,0,0);if(tilePoly.intersectsPoly(tempPolyA,-(tmX+tileRc.getLeft()),-(tmY+tileRc.getTop()))){C3.clearArray(collRects);return true}}else{C3.clearArray(collRects);return true}}}C3.clearArray(collRects);
return false}TestRayIntersectsInstance(inst,ray){if(!inst)return;const wi=inst.GetWorldInfo();if(!wi.IsCollisionEnabled())return;this._collisionCheckCount++;if(!wi.GetBoundingBox().intersectsRect(ray.rect))return;if(inst.HasTilemap()){this._TestRayIntersectsTilemap(inst,wi,ray);return}this._polyCheckCount++;if(wi.HasOwnCollisionPoly())ray.TestInstancePoly(inst,wi.GetX(),wi.GetY(),wi.GetTransformedCollisionPoly());else ray.TestInstanceQuad(inst,wi.GetBoundingQuad())}_TestRayIntersectsTilemap(inst,
wi,ray){const xOffset=wi.GetX();const yOffset=wi.GetY();const collRects=tileCollRectCandidates;inst.GetSdkInstance().GetCollisionRectCandidates(ray.rect,collRects);for(let i=0,l=collRects.length;i<l;i++){const c=collRects[i];const tileRc=c.GetRect();this._collisionCheckCount++;if(ray.rect.intersectsRectOffset(tileRc,xOffset,yOffset)){const tilePoly=c.GetPoly();this._polyCheckCount++;if(tilePoly)ray.TestInstancePoly(inst,xOffset+tileRc.getLeft(),yOffset+tileRc.getTop(),tilePoly);else ray.TestInstanceRect(inst,
wi.GetX(),wi.GetY(),tileRc)}}C3.clearArray(collRects)}SetCollisionCellSize(width,height){if(width===this._collisionCellWidth&&height===this._collisionCellHeight)return;this._collisionCellWidth=width;this._collisionCellHeight=height;const allObjectClasses=this._runtime.GetAllObjectClasses();for(const objectClass of allObjectClasses){if(!objectClass.IsWorldType())continue;for(const inst of objectClass.instancesIncludingPendingCreate())inst.GetWorldInfo()._RemoveFromCollisionCells();objectClass._GetCollisionCellGrid().SetCellSize(width,
height);objectClass._SetAnyCollisionCellChanged();for(const inst of objectClass.instancesIncludingPendingCreate()){const wi=inst.GetWorldInfo();wi._SetCollisionCellChanged();wi._UpdateCollisionCell()}}}GetCollisionCellSize(){return[this._collisionCellWidth,this._collisionCellHeight]}_InitCollisionCellSize(width,height){this._collisionCellWidth=width;this._collisionCellHeight=height}};

}

// collisions/sparseGrid.js
{
'use strict';const C3=self.C3;
C3.SparseGrid=class SparseGrid extends C3.DefendedBase{constructor(cellWidth,cellHeight){super();this._cellWidth=cellWidth;this._cellHeight=cellHeight;this._cells=C3.New(C3.PairMap)}Release(){this._cells.Release();this._cells=null}SetCellSize(cellWidth,cellHeight){if(!this._cells.IsEmpty())throw new Error("grid not empty");this._cellWidth=cellWidth;this._cellHeight=cellHeight}GetCell(x,y,createIfMissing){let ret=this._cells.Get(x,y);if(ret)return ret;else if(createIfMissing){ret=C3.New(C3.GridCell,
this,x,y);this._cells.Set(x,y,ret);return ret}else return null}XToCell(x){const ret=Math.floor(x/this._cellWidth);return isFinite(ret)?ret:0}YToCell(y){const ret=Math.floor(y/this._cellHeight);return isFinite(ret)?ret:0}Update(inst,oldRange,newRange){if(oldRange)for(let x=oldRange.getLeft(),lenx=oldRange.getRight();x<=lenx;++x)for(let y=oldRange.getTop(),leny=oldRange.getBottom();y<=leny;++y){if(newRange&&newRange.containsPoint(x,y))continue;const cell=this.GetCell(x,y,false);if(!cell)continue;cell.Remove(inst);
if(cell.IsEmpty())this._cells.Delete(x,y)}if(newRange)for(let x=newRange.getLeft(),lenx=newRange.getRight();x<=lenx;++x)for(let y=newRange.getTop(),leny=newRange.getBottom();y<=leny;++y){if(oldRange&&oldRange.containsPoint(x,y))continue;this.GetCell(x,y,true).Insert(inst)}}QueryRange(rc,result){let x=this.XToCell(rc.getLeft());const ystart=this.YToCell(rc.getTop());const lenx=this.XToCell(rc.getRight());const leny=this.YToCell(rc.getBottom());if(!isFinite(lenx)||!isFinite(leny))return;for(;x<=lenx;++x)for(let y=
ystart;y<=leny;++y){const cell=this.GetCell(x,y,false);if(!cell)continue;cell.Dump(result)}}};

}

// collisions/gridCell.js
{
'use strict';const C3=self.C3;C3.GridCell=class GridCell extends C3.DefendedBase{constructor(grid,x,y){super();this._grid=grid;this._x=x;this._y=y;this._instances=C3.New(C3.ArraySet)}Release(){this._instances.Release();this._instances=null;this._grid=null}IsEmpty(){return this._instances.IsEmpty()}Insert(inst){this._instances.Add(inst)}Remove(inst){this._instances.Delete(inst)}Dump(result){C3.appendArray(result,this._instances.GetArray())}};

}

// collisions/ray.js
{
'use strict';const C3=self.C3;const PADDING=1E-6;const NO_HIT=2;
C3.Ray=class Ray{constructor(){this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.dx=0;this.dy=0;this.rect=new C3.Rect;this.hitFraction=NO_HIT;this.hitUid=null;this.hitNormal=0;this.hitNormalDx=0;this.hitNormalDy=0;this.hitX=0;this.hitY=0;this.distance=0;this.normalX=1;this.normalY=0;this.reflectionX=1;this.reflectionY=0}DidCollide(){return this.hitFraction<1+PADDING}Reset(){this.hitFraction=NO_HIT}Set(x1,y1,x2,y2){this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;this.dx=x2-x1;this.dy=y2-y1;this.rect.set(x1,
y1,x2,y2);this.rect.normalize();this.hitFraction=NO_HIT;this.hitUid=null;this.hitNormal=0;this.hitNormalDx=0;this.hitNormalDy=0;this.hitX=0;this.hitY=0;this.distance=0;this.normalX=1;this.normalY=0;this.reflectionX=1;this.reflectionY=0;return this}Complete(){if(this.DidCollide()===false)return;const dx=this.dx*this.hitFraction;const dy=this.dy*this.hitFraction;const length=Math.hypot(dx,dy);const dirx=dx/length;const diry=dy/length;this.distance=length-PADDING;this.hitX=this.x1+dirx*this.distance;
this.hitY=this.y1+diry*this.distance;this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2;this.normalX=Math.cos(this.hitNormal);this.normalY=Math.sin(this.hitNormal);const dot=dirx*this.normalX+diry*this.normalY;this.reflectionX=dirx-2*this.normalX*dot;this.reflectionY=diry-2*this.normalY*dot;if(dot>0){const PI=Math.PI;this.hitNormal=C3.clampAngle(this.hitNormal+PI);this.normalX=-this.normalX;this.normalY=-this.normalY}}TestInstanceSegment(inst,sx1,sy1,sx2,sy2){const t=C3.rayIntersect(this.x1,
this.y1,this.x2,this.y2,sx1,sy1,sx2,sy2);if(t>=0&&t<this.hitFraction){this.hitFraction=t;this.hitUid=inst.GetUID();this.hitNormalDx=sx1-sx2;this.hitNormalDy=sy1-sy2}}TestInstanceRect(inst,offX,offY,rect){const lt=offX+rect.getLeft(),rt=offX+rect.getRight(),tp=offY+rect.getTop(),bm=offY+rect.getBottom();this.TestInstanceSegment(inst,lt,tp,rt,tp);this.TestInstanceSegment(inst,rt,tp,rt,bm);this.TestInstanceSegment(inst,rt,bm,lt,bm);this.TestInstanceSegment(inst,lt,bm,lt,tp)}TestInstanceQuad(inst,quad){const tlX=
quad.getTlx(),tlY=quad.getTly(),trX=quad.getTrx(),trY=quad.getTry(),brX=quad.getBrx(),brY=quad.getBry(),blX=quad.getBlx(),blY=quad.getBly();this.TestInstanceSegment(inst,tlX,tlY,trX,trY);this.TestInstanceSegment(inst,trX,trY,brX,brY);this.TestInstanceSegment(inst,brX,brY,blX,blY);this.TestInstanceSegment(inst,blX,blY,tlX,tlY)}TestInstancePoly(inst,offX,offY,poly){const points=poly.pointsArr();for(let i=0,l=points.length;i<l;i+=2){const ii=(i+2)%l;const x1=points[i]+offX;const y1=points[i+1]+offY;
const x2=points[ii]+offX;const y2=points[ii+1]+offY;this.TestInstanceSegment(inst,x1,y1,x2,y2)}}};

}

// canvasManager.js
{
'use strict';const C3=self.C3;const VALID_FULLSCREEN_MODES=new Set(["off","crop","scale-inner","scale-outer","letterbox-scale","letterbox-integer-scale"]);const VALID_FULLSCREEN_SCALING_QUALITIES=new Set(["high","low"]);const glMatrix=self.glMatrix;const mat4=glMatrix.mat4;const vec3=glMatrix.vec3;const tempProjection=mat4.create();const PERCENTTEXT_WIDTH=300;const PERCENTTEXT_HEIGHT=200;const PROGRESSBAR_WIDTH=120;const PROGRESSBAR_HEIGHT=8;const tempQuad=C3.New(C3.Quad);const tempRect=C3.New(C3.Rect);
const SPLASH_MIN_DISPLAY_TIME=3E3;const SPLASH_AFTER_FADEOUT_WAIT_TIME=200;const SPLASH_FADE_DURATION=300;
C3.CanvasManager=class CanvasManager extends C3.DefendedBase{constructor(runtime){super();this._runtime=runtime;this._canvasLayers=[];this._isWebGPUEnabled=false;this._webglRenderer=null;this._webgpuRenderer=null;this._iRenderer=null;this._gpuPreference="high-performance";this._isLimitedToWebGL1=false;this._windowInnerWidth=0;this._windowInnerHeight=0;this._cssDisplayMode="";this._canvasCssWidth=0;this._canvasCssHeight=0;this._canvasDeviceWidth=0;this._canvasDeviceHeight=0;this._canvasCssOffsetX=
0;this._canvasCssOffsetY=0;this._zAxisScale="normalized";this._initFieldOfView=0;this._zNear=1;this._zFar=1E4;this._enableMipmaps=true;this._textureAnisotropy=0;this._drawWidth=0;this._drawHeight=0;this._fullscreenMode="letterbox-scale";this._documentFullscreenMode="letterbox-scale";this._deviceTransformOffX=0;this._deviceTransformOffY=0;this._defaultProjectionMatrix=mat4.create();this._wantFullscreenScalingQuality="high";this._fullscreenScalingQuality=this._wantFullscreenScalingQuality;this._isDocumentFullscreen=
false;this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets=new Set;this._shaderData=self["C3_Shaders"];this._effectChainManager=C3.New(C3.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:rt=>this.ReleaseEffectCompositorRenderTarget(rt),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()});this._gpuTimeStartFrame=0;this._gpuTimeEndFrame=
0;this._gpuLastUtilisation=NaN;this._gpuFrameTimingsBuffer=null;this._layersGpuProfile=new Map;this._gpuCurUtilisation=NaN;this._webgpuFrameTimings=new Map;this._snapshotFormat="";this._snapshotQuality=1;this._snapshotArea=C3.New(C3.Rect);this._snapshotUrl="";this._snapshotPromise=null;this._snapshotResolve=null;this._isPastingToDrawingCanvas=0;this._loaderStartTime=0;this._rafId=-1;this._loadingProgress=0;this._loadingprogress_handler=e=>this._loadingProgress=e.progress;this._percentText=null;this._splashTextures=
{logo:null,powered:null,website:null};this._splashFrameNumber=0;this._splashFadeInFinishTime=0;this._splashFadeOutStartTime=0;this._splashState="fade-in";this._splashDoneResolve=null;this._splashDonePromise=new Promise(resolve=>this._splashDoneResolve=resolve)}_SetGPUPowerPreference(pref){this._gpuPreference=pref}_SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e}_SetZAxisScale(s){this._zAxisScale=s}GetZAxisScale(){return this._zAxisScale}_SetInitFieldOfView(f){this._initFieldOfView=f}_SetZDistances(zNear,
zFar){this._zNear=zNear;this._zFar=zFar}_SetLimitedToWebGL1(l){this._isLimitedToWebGL1=!!l}async CreateCanvas(opts){let mainCanvas=opts["canvas"];this._canvasLayers.push({canvas:mainCanvas,ctx:null});this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",e=>this._OnWindowResize(e));this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",e=>this._OnFullscreenChange(e));this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",e=>this._OnFullscreenError(e));
mainCanvas.addEventListener("webglcontextlost",e=>this._OnWebGLContextLost(e));mainCanvas.addEventListener("webglcontextrestored",e=>this._OnWebGLContextRestored(e));this._isDocumentFullscreen=!!opts["isFullscreen"];this._cssDisplayMode=opts["cssDisplayMode"];const useWebGPU=navigator["gpu"]&&this._isWebGPUEnabled;let hasMajorPerformanceCaveat=false;if(useWebGPU)try{await this._InitWebGPUContext(true)}catch(err){this._MaybeLogRendererError("WebGPU",err);this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(true)}catch(err){this._MaybeLogRendererError("WebGL",
err);this._webglRenderer=null}if(!this.GetRenderer())hasMajorPerformanceCaveat=true;if(!this.GetRenderer()&&useWebGPU)try{await this._InitWebGPUContext(false)}catch(err){this._MaybeLogRendererError("WebGPU",err);this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(false)}catch(err){this._MaybeLogRendererError("WebGL",err);this._webglRenderer=null}const renderer=this.GetRenderer();if(!renderer)throw new Error("failed to acquire a renderer - check WebGL or WebGPU is supported");
renderer.SetHasMajorPerformanceCaveat(hasMajorPerformanceCaveat);if(this._webgpuRenderer){this._webgpuRenderer.ondevicelost=()=>this._OnWebGPUDeviceLost();this._webgpuRenderer.ondevicerestored=()=>this._OnWebGPUDeviceRestored()}if(this._zAxisScale==="normalized")renderer.SetZAxisScaleNormalized();else{renderer.SetZAxisScaleRegular();renderer.SetFovY(this._initFieldOfView)}this.SetSize(opts["windowInnerWidth"],opts["windowInnerHeight"],true);await this._InitRenderer()}_MaybeLogRendererError(rendererType,
err){if(err&&typeof err.message==="string"&&err.message.startsWith("renderer-unavailable"))return;console.error(`Error creating ${rendererType} renderer: `,err)}async _InitWebGPUContext(failIfMajorPerformanceCaveat){const ctorOpts={nearZ:this._zNear,farZ:this._zFar};const rendererOpts={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),
canSampleDepth:this._runtime.UsesAnyDepthSampling()};this._webgpuRenderer=C3.New(C3.Gfx.WebGPURenderer,ctorOpts);await this._webgpuRenderer.Create(this._canvasLayers[0].canvas,rendererOpts)}async _InitWebGLContext(failIfMajorPerformanceCaveat){const rendererOpts={alpha:true,powerPreference:this._gpuPreference,enableGpuProfiling:this._runtime.GetExportType()!=="xbox-uwp-webview2",depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat,nearZ:this._zNear,
farZ:this._zFar};if(this._isLimitedToWebGL1)rendererOpts.maxWebGLVersion=1;this._webglRenderer=C3.New(C3.Gfx.WebGLRenderer,this._canvasLayers[0].canvas,rendererOpts);await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){const promises=[];for(const [id,data]of Object.entries(this._shaderData)){data.src=data.wgsl;const vertexSrc=C3.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();promises.push(this._webgpuRenderer.CreateShaderProgram(Object.assign({vertexSrc,name:id},
data)))}await Promise.all(promises)}}async _InitWebGL(){if(this._shaderData){const promises=[];for(const [id,data]of Object.entries(this._shaderData)){let vertexSrc;if(data.glslWebGL2&&this._webglRenderer.GetWebGLVersionNumber()>=2){data.src=data.glslWebGL2;vertexSrc=C3.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2()}else{if(!data.glsl)throw new Error(`shader '${id}' does not support WebGL 1`);data.src=data.glsl;vertexSrc=C3.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource()}promises.push(this._webglRenderer.CreateShaderProgram(Object.assign({vertexSrc,
name:id},data)))}await Promise.all(promises);this._webglRenderer.ResetLastProgram();this._webglRenderer.SetTextureFillMode()}if(this._webglRenderer.SupportsGPUProfiling())this._gpuFrameTimingsBuffer=C3.New(C3.Gfx.WebGLQueryResultBuffer,this._webglRenderer)}async _InitRenderer(){if(this._webgpuRenderer)await this._InitWebGPU();else if(this._webglRenderer)await this._InitWebGL();const renderer=this.GetRenderer();renderer.SetMipmapsEnabled(this._enableMipmaps);if(renderer.SupportsGPUProfiling())this._gpuLastUtilisation=
0;for(const effectList of this._runtime._GetAllEffectLists()){for(const effectType of effectList.GetAllEffectTypes())effectType._InitRenderer(renderer);effectList._InitRenderer(renderer);effectList.UpdateActiveEffects()}this._iRenderer=new self.IRenderer(this._runtime,renderer)}Release(){this._runtime=null;this._webglRenderer=null;this._canvasLayers.length=0}IsInWorker(){return this._runtime.IsInWorker()}_OnWindowResize(e){const runtime=this._runtime;if(runtime.IsExportToVideo())return;const dpr=
e["devicePixelRatio"];if(this.IsInWorker())self.devicePixelRatio=dpr;runtime._SetDevicePixelRatio(dpr);this._isDocumentFullscreen=!!e["isFullscreen"];this._cssDisplayMode=e["cssDisplayMode"];this.SetSize(e["innerWidth"],e["innerHeight"]);runtime.UpdateRender();const ev=new C3.Event("window-resize");ev.data=e;runtime.Dispatcher().dispatchEventAndWaitAsyncSequential(ev);const ev2=new C3.Event("resize");ev2.cssWidth=this.GetCssWidth();ev2.cssHeight=this.GetCssHeight();ev2.deviceWidth=this.GetDeviceWidth();
ev2.deviceHeight=this.GetDeviceHeight();runtime.DispatchUserScriptEvent(ev2);if(runtime.IsDebug()&&(runtime.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused()))runtime.Render()}_OnFullscreenChange(e){this._isDocumentFullscreen=!!e["isFullscreen"];this.SetSize(e["innerWidth"],e["innerHeight"],true);this._runtime.UpdateRender()}_OnFullscreenError(e){this._isDocumentFullscreen=!!e["isFullscreen"];this.SetSize(e["innerWidth"],e["innerHeight"],true);this._runtime.UpdateRender()}SetSize(availableWidth,
availableHeight,force=false){availableWidth=Math.floor(availableWidth);availableHeight=Math.floor(availableHeight);if(availableWidth<=0||availableHeight<=0)throw new Error("invalid size");if(this._windowInnerWidth===availableWidth&&this._windowInnerHeight===availableHeight&&!force)return;this._windowInnerWidth=availableWidth;this._windowInnerHeight=availableHeight;const fullscreenMode=this.GetCurrentFullscreenMode();if(fullscreenMode==="letterbox-scale")this._CalculateLetterboxScale(availableWidth,
availableHeight);else if(fullscreenMode==="letterbox-integer-scale")this._CalculateLetterboxIntegerScale(availableWidth,availableHeight);else if(fullscreenMode==="off")this._CalculateFixedSizeCanvas(availableWidth,availableHeight);else this._CalculateFullsizeCanvas(availableWidth,availableHeight);this._UpdateFullscreenScalingQuality(fullscreenMode);for(const {canvas}of this._canvasLayers){canvas.width=this._canvasDeviceWidth;canvas.height=this._canvasDeviceHeight}this._runtime.PostComponentMessageToDOM("canvas",
"update-size",{"marginLeft":this._canvasCssOffsetX,"marginTop":this._canvasCssOffsetY,"styleWidth":this._canvasCssWidth,"styleHeight":this._canvasCssHeight,"displayScale":this.GetDisplayScale()});const renderer=this.GetRenderer();renderer.SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,true);for(const rt of this._availableAdditionalRenderTargets)renderer.DeleteRenderTarget(rt);C3.clearArray(this._availableAdditionalRenderTargets);this.UpdateDefaultProjectionMatrix();const layoutManager=this._runtime.GetLayoutManager();
layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged()}UpdateDefaultProjectionMatrix(){this.GetRenderer().CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight())}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(availableWidth,availableHeight){const dpr=this._runtime.GetDevicePixelRatio();const originalViewportWidth=this._runtime.GetOriginalViewportWidth();const originalViewportHeight=this._runtime.GetOriginalViewportHeight();
const originalAspectRatio=originalViewportWidth/originalViewportHeight;const availableAspectRatio=availableWidth/availableHeight;if(availableAspectRatio>originalAspectRatio){const letterboxedWidth=availableHeight*originalAspectRatio;this._canvasCssWidth=Math.round(letterboxedWidth);this._canvasCssHeight=availableHeight;this._canvasCssOffsetX=Math.floor((availableWidth-this._canvasCssWidth)/2);this._canvasCssOffsetY=0}else{const letterboxedHeight=availableWidth/originalAspectRatio;this._canvasCssWidth=
availableWidth;this._canvasCssHeight=Math.round(letterboxedHeight);this._canvasCssOffsetX=0;this._canvasCssOffsetY=Math.floor((availableHeight-this._canvasCssHeight)/2)}this._canvasDeviceWidth=Math.round(this._canvasCssWidth*dpr);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*dpr);this._runtime.SetViewportSize(originalViewportWidth,originalViewportHeight)}_CalculateLetterboxIntegerScale(availableWidth,availableHeight){const dpr=this._runtime.GetDevicePixelRatio();if(dpr!==1){availableWidth+=
1;availableHeight+=1}const originalViewportWidth=this._runtime.GetOriginalViewportWidth();const originalViewportHeight=this._runtime.GetOriginalViewportHeight();const originalAspectRatio=originalViewportWidth/originalViewportHeight;const availableAspectRatio=availableWidth/availableHeight;let intScale;if(availableAspectRatio>originalAspectRatio){const letterboxedWidth=availableHeight*originalAspectRatio;intScale=letterboxedWidth*dpr/originalViewportWidth}else{const letterboxedHeight=availableWidth/
originalAspectRatio;intScale=letterboxedHeight*dpr/originalViewportHeight}if(intScale>1)intScale=Math.floor(intScale);else if(intScale<1)intScale=1/Math.ceil(1/intScale);this._canvasDeviceWidth=Math.round(originalViewportWidth*intScale);this._canvasDeviceHeight=Math.round(originalViewportHeight*intScale);this._canvasCssWidth=this._canvasDeviceWidth/dpr;this._canvasCssHeight=this._canvasDeviceHeight/dpr;this._canvasCssOffsetX=Math.max(Math.floor((availableWidth-this._canvasCssWidth)/2),0);this._canvasCssOffsetY=
Math.max(Math.floor((availableHeight-this._canvasCssHeight)/2),0);this._runtime.SetViewportSize(originalViewportWidth,originalViewportHeight)}_CalculateFullsizeCanvas(availableWidth,availableHeight){const dpr=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=availableWidth;this._canvasCssHeight=availableHeight;this._canvasDeviceWidth=Math.round(this._canvasCssWidth*dpr);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*dpr);this._canvasCssOffsetX=0;this._canvasCssOffsetY=0;const displayScale=
this.GetDisplayScale();this._runtime.SetViewportSize(this._canvasCssWidth/displayScale,this._canvasCssHeight/displayScale)}_CalculateFixedSizeCanvas(availableWidth,availableHeight){const dpr=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth();this._canvasCssHeight=this._runtime.GetViewportHeight();this._canvasDeviceWidth=Math.round(this._canvasCssWidth*dpr);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*dpr);if(this.IsDocumentFullscreen()){this._canvasCssOffsetX=
Math.floor((availableWidth-this._canvasCssWidth)/2);this._canvasCssOffsetY=Math.floor((availableHeight-this._canvasCssHeight)/2)}else{this._canvasCssOffsetX=0;this._canvasCssOffsetY=0}this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(fullscreenMode){if(this._wantFullscreenScalingQuality==="high"){this._drawWidth=this._canvasDeviceWidth;this._drawHeight=this._canvasDeviceHeight;this._fullscreenScalingQuality="high"}else{let viewportWidth,
viewportHeight;if(this.GetCurrentFullscreenMode()==="off"){viewportWidth=this._runtime.GetViewportWidth();viewportHeight=this._runtime.GetViewportHeight()}else{viewportWidth=this._runtime.GetOriginalViewportWidth();viewportHeight=this._runtime.GetOriginalViewportHeight()}if(this._canvasDeviceWidth<viewportWidth||this._canvasDeviceHeight<viewportHeight){this._drawWidth=this._canvasDeviceWidth;this._drawHeight=this._canvasDeviceHeight;this._fullscreenScalingQuality="high"}else{this._drawWidth=viewportWidth;
this._drawHeight=viewportHeight;this._fullscreenScalingQuality="low";if(fullscreenMode==="scale-inner"){const originalAspectRatio=viewportWidth/viewportHeight;const currentAspectRatio=this._windowInnerWidth/this._windowInnerHeight;if(currentAspectRatio<originalAspectRatio)this._drawWidth=this._drawHeight*currentAspectRatio;else if(currentAspectRatio>originalAspectRatio)this._drawHeight=this._drawWidth/currentAspectRatio}else if(fullscreenMode==="scale-outer"){const originalAspectRatio=viewportWidth/
viewportHeight;const currentAspectRatio=this._windowInnerWidth/this._windowInnerHeight;if(currentAspectRatio>originalAspectRatio)this._drawWidth=this._drawHeight*currentAspectRatio;else if(currentAspectRatio<originalAspectRatio)this._drawHeight=this._drawWidth/currentAspectRatio}}}}GetRuntime(){return this._runtime}GetMainCanvas(){return this._canvasLayers[0].canvas}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}GetCssDisplayMode(){return this._cssDisplayMode}SetFullscreenMode(m){if(!VALID_FULLSCREEN_MODES.has(m))throw new Error("invalid fullscreen mode");
this._fullscreenMode=m;const layoutManager=this._runtime.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(m){if(!VALID_FULLSCREEN_MODES.has(m))throw new Error("invalid fullscreen mode");this._documentFullscreenMode=m;const layoutManager=this._runtime.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){if(this.IsDocumentFullscreen())return this.GetDocumentFullscreenMode();
else return this.GetFullscreenMode()}SetFullscreenScalingQuality(q){if(!VALID_FULLSCREEN_SCALING_QUALITIES.has(q))throw new Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=q;this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(n){switch(n){case 0:return"off";case 1:return"crop";
case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw new Error("invalid fullscreen mode");}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(e){this._enableMipmaps=!!e}_SetTextureAnisotropy(a){this._textureAnisotropy=a}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(e){console.log("[Construct] WebGL context lost");
e.preventDefault();this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets.clear();this._effectChainManager.OnContextLost();this._webglRenderer.OnContextLost();this._runtime._OnRendererContextLost()}_OnWebGPUDeviceLost(){console.log("[Construct] WebGPU device lost");this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets.clear();this._effectChainManager.OnContextLost();this._runtime._OnRendererContextLost()}async _OnWebGLContextRestored(e){await this._webglRenderer.OnContextRestored();
await this._InitRenderer();await this._runtime._OnRendererContextRestored();console.log("[Construct] WebGL context restored")}async _OnWebGPUDeviceRestored(){await this._InitRenderer();await this._runtime._OnRendererContextRestored();console.log("[Construct] WebGPU device restored")}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetIRenderer(){return this._iRenderer}GetRenderScale(){if(this._fullscreenScalingQuality===
"low")return 1/this._runtime.GetDevicePixelRatio();return this.GetDisplayScale()}GetDisplayScale(){const fullscreenMode=this.GetCurrentFullscreenMode();if(fullscreenMode==="off"||fullscreenMode==="crop")return 1;const originalViewportWidth=this._runtime.GetOriginalViewportWidth();const originalViewportHeight=this._runtime.GetOriginalViewportHeight();const originalAspectRatio=originalViewportWidth/originalViewportHeight;const currentAspectRatio=this._canvasDeviceWidth/this._canvasDeviceHeight;if(fullscreenMode!==
"scale-inner"&&currentAspectRatio>originalAspectRatio||fullscreenMode==="scale-inner"&&currentAspectRatio<originalAspectRatio)return this._canvasCssHeight/originalViewportHeight;else return this._canvasCssWidth/originalViewportWidth}GetEffectLayerScaleParam(){if(this.GetCurrentFullscreenScalingQuality()==="low")return 1;else return this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){if(this.GetCurrentFullscreenScalingQuality()==="low")return 1;else return this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(x,
y){this._deviceTransformOffX=x;this._deviceTransformOffY=y}SetDeviceTransform(renderer,w,h,updateProjection=true){w=w||this._drawWidth;h=h||this._drawHeight;const scrollX=w/2+this._deviceTransformOffX;const scrollY=h/2+this._deviceTransformOffY;if(updateProjection){let projectionMatrix=this.GetDefaultProjectionMatrix();if(w!==this._drawWidth||h!==this._drawHeight){renderer.CalculatePerspectiveMatrix(tempProjection,w/h);projectionMatrix=tempProjection}renderer.SetProjectionMatrix(projectionMatrix)}const tempMat4=
renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(h),scrollX,scrollY,0,h);renderer.SetModelViewMatrix(tempMat4)}SetCssTransform(renderer,updateProjection=true){const width=this.GetCssWidth();const height=this.GetCssHeight();const scrollX=width/2;const scrollY=height/2;if(updateProjection)renderer.SetProjectionMatrix(this.GetDefaultProjectionMatrix());const tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(height),scrollX,scrollY,0,height);
renderer.SetModelViewMatrix(tempMat4)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetHTMLLayerCount(){return this._canvasLayers.length}_CanUseImageBitmapRenderingContext(){return typeof OffscreenCanvas!=="undefined"&&this.GetMainCanvas()instanceof OffscreenCanvas&&
(C3.Platform.BrowserEngine!=="Chromium"||C3.Platform.BrowserVersionNumber>=124)}async SetHTMLLayerCount(c,immediate=false){if(c<1)throw new Error("invalid HTML layer count");if(this._canvasLayers.length===c)return;const message={"count":c,"immediate":immediate,"marginLeft":this._canvasCssOffsetX,"marginTop":this._canvasCssOffsetY,"styleWidth":this._canvasCssWidth,"styleHeight":this._canvasCssHeight};let result;if(this.IsInWorker())result=await this._runtime.PostComponentMessageToDOMAsync("canvas",
"set-html-layer-count",message);else result=self["c3_runtimeInterface"]["_OnSetHTMLLayerCount"](message);if(c<this._canvasLayers.length)this._canvasLayers.length=c;else for(const canvas of result["addedCanvases"]){canvas.width=this._canvasDeviceWidth;canvas.height=this._canvasDeviceHeight;const contextName=this._CanUseImageBitmapRenderingContext()?"bitmaprenderer":"2d";const ctx=canvas.getContext(contextName);if(!ctx)throw new Error(`failed to acquire '${contextName}' canvas context`);this._canvasLayers.push({canvas,
ctx})}this._runtime.UpdateRender()}BlitMainCanvasToHTMLLayerCanvas(htmlIndex){if(htmlIndex>=this._canvasLayers.length)return;const mainCanvas=this.GetMainCanvas();const destCtx=this._canvasLayers[htmlIndex].ctx;if(this._CanUseImageBitmapRenderingContext())destCtx["transferFromImageBitmap"](mainCanvas["transferToImageBitmap"]());else{destCtx.globalCompositeOperation="copy";destCtx.drawImage(mainCanvas,0,0)}}GetAdditionalRenderTarget(opts){opts.depth=this._runtime.Uses3DFeatures();const arr=this._availableAdditionalRenderTargets;
const useIndex=arr.findIndex(rt=>rt.IsCompatibleWithOptions(opts));let ret;if(useIndex!==-1){ret=arr[useIndex];arr.splice(useIndex,1)}else ret=this.GetRenderer().CreateRenderTarget(opts);this._usedAdditionalRenderTargets.add(ret);return ret}ReleaseAdditionalRenderTarget(renderTarget){if(!this._usedAdditionalRenderTargets.has(renderTarget))throw new Error("render target not in use");this._usedAdditionalRenderTargets.delete(renderTarget);this._availableAdditionalRenderTargets.push(renderTarget)}GetEffectCompositorRenderTarget(){const opts=
{sampling:this._runtime.GetSampling()};if(this.GetCurrentFullscreenScalingQuality()==="low"){opts.width=this.GetDrawWidth();opts.height=this.GetDrawHeight()}return this.GetAdditionalRenderTarget(opts)}ReleaseEffectCompositorRenderTarget(renderTarget){this.ReleaseAdditionalRenderTarget(renderTarget)}*activeLayersGpuProfiles(){for(const layout of this._runtime.GetLayoutManager().runningLayouts())for(const layer of layout.GetLayers()){const p=this._layersGpuProfile.get(layer);if(p)yield p}}GetLayerTimingsBuffer(layer){if(!this.GetRenderer().SupportsGPUProfiling())return null;
let p=this._layersGpuProfile.get(layer);if(!p){p={layer:layer,name:layer.GetName(),timingsBuffer:C3.New(C3.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastTotalUtilisation:0,lastSelfUtilisation:0};this._layersGpuProfile.set(layer,p)}return p.timingsBuffer}_Update1sFrameRange(){const renderer=this.GetRenderer();if(!renderer.SupportsGPUProfiling())return;if(this._gpuTimeEndFrame===0){this._gpuTimeEndFrame=renderer.GetFrameNumber();this._gpuCurUtilisation=NaN;for(const p of this.activeLayersGpuProfiles())p.curUtilisation=
NaN}}_UpdateTick(){if(this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling())this._UpdateTick_WebGL();if(this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling())this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(!isNaN(this._gpuCurUtilisation))return;this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame);if(isNaN(this._gpuCurUtilisation))return;if(this._runtime.IsDebug())for(const p of this.activeLayersGpuProfiles()){p.curUtilisation=
p.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame);if(isNaN(p.curUtilisation))return}this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame);this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1);if(this._runtime.IsDebug()){const layerTotalTimeMap=new Map;for(const p of this.activeLayersGpuProfiles()){p.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame);p.lastTotalUtilisation=Math.min(p.curUtilisation,1);layerTotalTimeMap.set(p.layer,
p.lastTotalUtilisation)}for(const p of this.activeLayersGpuProfiles()){const layer=p.layer;const totalTime=layerTotalTimeMap.get(layer)||0;const selfTime=totalTime-layer.GetSubLayers().reduce((t,l)=>t+(layerTotalTimeMap.get(l)||0),0);p.lastSelfUtilisation=C3.clamp(selfTime,0,1)}const layout=this._runtime.GetMainRunningLayout();const layoutSelfTime=this._gpuLastUtilisation-layout._GetRootLayers().reduce((t,l)=>t+(layerTotalTimeMap.get(l)||0),0);self.C3Debugger.UpdateGPUProfile(C3.clamp(layoutSelfTime,
0,1),this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame;this._gpuTimeEndFrame=0}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(this._gpuTimeEndFrame===0)return;for(let frameNumber=this._gpuTimeStartFrame;frameNumber<this._gpuTimeEndFrame;++frameNumber){const frameTiming=this._webgpuFrameTimings.get(frameNumber);if(frameTiming&&!frameTiming.HasResult())return}const layout=this._runtime.GetMainRunningLayout();
const profileResults=C3.MakeFilledArray(layout.GetLayerCount()+1,0);let overallGpuTime=0;for(let frameNumber=this._gpuTimeStartFrame;frameNumber<this._gpuTimeEndFrame;++frameNumber){const frameTiming=this._webgpuFrameTimings.get(frameNumber);if(!frameTiming)continue;const results=frameTiming.GetResult();let frameStart64=BigInt(0);let frameEnd64=BigInt(0);const bigZero=BigInt(0);for(let i=0,len=Math.min(profileResults.length,results.length/2);i<len;++i){const start64=results[i*2];const end64=results[i*
2+1];if(start64!==bigZero&&(frameStart64===bigZero||start64<frameStart64))frameStart64=start64;if(end64>frameEnd64)frameEnd64=end64;const diff64=end64-start64;const duration=Number(diff64)/1E9;profileResults[i]+=duration}const frameDiff64=frameEnd64-frameStart64;const frameDuration=Number(frameDiff64)/1E9;overallGpuTime+=frameDuration}this._gpuLastUtilisation=C3.clamp(overallGpuTime,0,1);if(this._runtime.IsDebug()){const layers=layout.GetLayers();const layerSelfTimeMap=new Map;for(let i=0,len=Math.min(layers.length,
profileResults.length-1);i<len;++i){const selfTime=profileResults[i+1];layerSelfTimeMap.set(layers[i],selfTime)}const layerProfiles=[];const layerTotalTimeMap=new Map;for(const [layer,selfTime]of layerSelfTimeMap){const totalTime=[...layer.selfAndAllSubLayers()].reduce((t,l)=>t+(layerSelfTimeMap.get(l)||0),0);layerTotalTimeMap.set(layer,totalTime);layerProfiles.push({name:layer.GetName(),lastSelfUtilisation:C3.clamp(selfTime,0,1),lastTotalUtilisation:C3.clamp(totalTime,0,1)})}const layoutSelfTime=
this._gpuLastUtilisation-layout._GetRootLayers().reduce((t,l)=>t+(layerTotalTimeMap.get(l)||0),0);self.C3Debugger.UpdateGPUProfile(C3.clamp(layoutSelfTime,0,1),this._gpuLastUtilisation,layerProfiles)}for(let frameNumber=this._gpuTimeStartFrame;frameNumber<this._gpuTimeEndFrame;++frameNumber)this._webgpuFrameTimings.delete(frameNumber);this._gpuTimeStartFrame=this._gpuTimeEndFrame;this._gpuTimeEndFrame=0}_AddWebGPUFrameTiming(frameTiming){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),
frameTiming)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(format,quality,x,y,width,height){this._snapshotFormat=format;this._snapshotQuality=quality;this._snapshotArea.setWH(x,y,width,height);if(this._snapshotPromise)return this._snapshotPromise;this._snapshotPromise=new Promise(resolve=>{this._snapshotResolve=resolve});return this._snapshotPromise}_MaybeTakeSnapshot(){if(!this._snapshotFormat)return;let canvas=this.GetMainCanvas();const snapArea=this._snapshotArea;const x=C3.clamp(Math.floor(snapArea.getLeft()),
0,canvas.width);const y=C3.clamp(Math.floor(snapArea.getTop()),0,canvas.height);let w=snapArea.width();if(w===0)w=canvas.width-x;else w=C3.clamp(Math.floor(w),0,canvas.width-x);let h=snapArea.height();if(h===0)h=canvas.height-y;else h=C3.clamp(Math.floor(h),0,canvas.height-y);if((x!==0||y!==0||w!==canvas.width||h!==canvas.height)&&(w>0&&h>0)){const cropCanvas=C3.CreateCanvas(w,h);const ctx=cropCanvas.getContext("2d");ctx.drawImage(canvas,x,y,w,h,0,0,w,h);canvas=cropCanvas}C3.CanvasToBlob(canvas,this._snapshotFormat,
this._snapshotQuality).then(blob=>{if(this._snapshotUrl)URL.revokeObjectURL(this._snapshotUrl);this._snapshotUrl=URL.createObjectURL(blob);this._snapshotPromise=null;this._snapshotResolve(this._snapshotUrl)});this._snapshotFormat="";this._snapshotQuality=1}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(p){if(p)this._isPastingToDrawingCanvas++;else this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return this._isPastingToDrawingCanvas>0}InitLoadingScreen(loaderStyle){const renderer=
this.GetRenderer();if(loaderStyle===2){this._percentText=C3.New(C3.Gfx.RendererText,this.GetRenderer());this._percentText.SetFontName("Arial");this._percentText.SetFontSize(16);this._percentText.SetHorizontalAlignment("center");this._percentText.SetVerticalAlignment("center");this._percentText.SetSize(PERCENTTEXT_WIDTH,PERCENTTEXT_HEIGHT)}else if(loaderStyle===0){const loadingLogoAsset=this._runtime.GetLoadingLogoAsset();if(loadingLogoAsset)loadingLogoAsset.LoadStaticTexture(renderer).catch(err=>
console.warn(`[C3 runtime] Failed to create texture for loading logo: `,err))}else if(loaderStyle===4){this._LoadSvgSplashImage("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIxNzAwLjc5MDA0cHgiIGhlaWdodD0iMTcwMC43OTAwNHB4IiB2aWV3Qm94PSIyODcgMzE3IDExMjUgMTEyNSINCgkgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTcwMC43OTAwNCAxNzAwLjc5MDA0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJsb2dvIj4NCgk8Zz4NCgkJPGc+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0ZGRkZGRiIgZD0iTTM1NC45Nzc1NCwxMTk1LjYyMzA1DQoJCQkJYzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NjI5LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOGwtNC45MzI2Miw4LjU0MTk5DQoJCQkJYy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNjU2LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMzMiwwLDUuOTYxOTEtMC40NDMzNiw4LjcyNjU2LTEuMjY4NTVjNi4yOTQ5Mi0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTczOCw2LjUwMDk4bDQuOTMxNjQsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM4NDgsNS43MzQzOGMtOS4wMDM5MSw1LjYwMTU2LTE5LjYzMTg0LDguODM3ODktMzEuMDE2Niw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzI5Ni4xNTgyLDEyMjEuOTU3MDMsMzIyLjQ5MjE5LDExOTUuNjIzMDUsMzU0Ljk3NzU0LDExOTUuNjIzMDUNCgkJCQlMMzU0Ljk3NzU0LDExOTUuNjIzMDV6IE03MDMuMjE0ODQsMTI1OS4xNzU3OGMtMTQuNTU5NTctOS44MTczOC0yMC4yMDMxMy0yMC4wMzIyMy0yMC4yMDMxMy0zMy4wODAwOA0KCQkJCWMwLTE4LjQ4OTI2LDE1LjcxNDg0LTI5Ljc2MzY3LDM4LjI2NjYtMjkuNzYzNjdjOS42NTcyMywwLDE4LjcyMTY4LDIuNTQyOTcsMjYuNTU5NTcsNi45OTQxNA0KCQkJCWMyLjA0OTgsMS4xNjQwNiwyLjc2MTcyLDMuNzgzMiwxLjU4MzAxLDUuODI0MjJsLTMuNDE3OTcsNS45MTk5MmMtMy4yNDcwNyw1LjYyNDAyLTkuOTA4Miw4LjMzMTA1LTE2LjE1MzMyLDYuNTQ4ODMNCgkJCQljLTIuNzIzNjMtMC43NzYzNy01LjU5ODYzLTEuMTkyMzgtOC41NzEyOS0xLjE5MjM4Yy0xMC40OTAyMywwLTExLjU5ODYzLDkuNTc2MTctNC44NTc0MiwxNC4xMjMwNWwyMy42ODY1MiwxNS45NzY1Ng0KCQkJCWM5Ljk5MDIzLDYuNzM4MjgsMTUuODk1NTEsMTcuMDY2NDEsMTUuODk1NTEsMjguNzE4NzVjMCwxOC43ODYxMy0xNS4wMDY4NCwzMy4zMDc2Mi0zOC4yNjc1OCwzMy4zMDc2Mg0KCQkJCWMtOS41MjI0NiwwLTE4LjU4Nzg5LTEuOTU3MDMtMjYuODE1NDMtNS40OTAyM2MtNy43ODEyNS0zLjMzOTg0LTEwLjkzMzU5LTEyLjc4MjIzLTYuNjk3MjctMjAuMTE4MTZsMy40ODczLTYuMDQxOTkNCgkJCQljMS4yMTM4Ny0yLjA5OTYxLDMuOTMxNjQtMi43NTk3Nyw1Ljk3NDYxLTEuNDU2MDVjNi44NTkzOCw0LjM4MjgxLDE2LjQ5MDIzLDcuNTk0NzMsMjQuNzU4NzksNy41OTQ3Mw0KCQkJCWMxMC41NDU5LDAsMTEuMzI4MTMtOS45NTg5OCwzLjc2NzU4LTE1LjA1NzYyTDcwMy4yMTQ4NCwxMjU5LjE3NTc4TDcwMy4yMTQ4NCwxMjU5LjE3NTc4eiBNOTg0LjYzMDg2LDEyMDIuMDAwOTgNCgkJCQljMC0yLjM0NzY2LDEuOTAzMzItNC4yNTE5NSw0LjI1MTk1LTQuMjUxOTVoOS45MjE4OGM3LjgyNzE1LDAsMTQuMTcyODUsNi4zNDU3LDE0LjE3Mjg1LDE0LjE3MzgzdjU3LjQwMTM3DQoJCQkJYzAsOC42MTAzNSw2Ljk4MDQ3LDE1LjU5MDgyLDE1LjU5MDgyLDE1LjU5MDgyczE1LjU5MDgyLTYuOTgwNDcsMTUuNTkwODItMTUuNTkwODJ2LTU3LjQwMTM3DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoOS45MjA5YzIuMzQ4NjMsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2NjcuMzIzMjQNCgkJCQljMCwyNC4yNjU2My0xOS42NzA5LDQzLjkzNzUtNDMuOTM2NTIsNDMuOTM3NXMtNDMuOTM3NS0xOS42NzE4OC00My45Mzc1LTQzLjkzNzVWMTIwMi4wMDA5OEw5ODQuNjMwODYsMTIwMi4wMDA5OHoNCgkJCQkgTTQ2Ni44NjkxNCwxMTk1LjYyMzA1YzMyLjQ4NDM4LDAsNTguODE4MzYsMjYuMzMzOTgsNTguODE4MzYsNTguODE5MzRjMCwzMi40ODQzOC0yNi4zMzM5OCw1OC44MTkzNC01OC44MTgzNiw1OC44MTkzNA0KCQkJCWMtMzIuNDg2MzMsMC01OC44MTkzNC0yNi4zMzQ5Ni01OC44MTkzNC01OC44MTkzNEM0MDguMDQ5OCwxMjIxLjk1NzAzLDQzNC4zODI4MSwxMTk1LjYyMzA1LDQ2Ni44NjkxNCwxMTk1LjYyMzA1DQoJCQkJTDQ2Ni44NjkxNCwxMTk1LjYyMzA1eiBNNDY2Ljg2OTE0LDEyMjUuMDMzMmMtMTYuMjQzMTYsMC0yOS40MTAxNiwxMy4xNjY5OS0yOS40MTAxNiwyOS40MDkxOA0KCQkJCXMxMy4xNjY5OSwyOS40MDgyLDI5LjQxMDE2LDI5LjQwODJjMTYuMjQxMjEsMCwyOS40MDgyLTEzLjE2NjAyLDI5LjQwODItMjkuNDA4MlM0ODMuMTEwMzUsMTIyNS4wMzMyLDQ2Ni44NjkxNCwxMjI1LjAzMzINCgkJCQlMNDY2Ljg2OTE0LDEyMjUuMDMzMnogTTU1Ni43MzI0MiwxMzExLjEzNDc3Yy0yLjM0NzY2LDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtOTQuOTYxOTENCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzM4My0xNC4xNzM4M2gzLjk1ODk4YzQuNjI1LDAsOC45NTg5OCwyLjI1Njg0LDExLjYxMTMzLDYuMDQ1OWw0MS4xMjIwNyw1OC43NDcwN3YtNTAuNjE5MTQNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2g5LjkyMTg4YzIuMzQ3NjYsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2OTQuOTYwOTQNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3MzgzLDE0LjE3Mjg1aC0zLjk1ODk4Yy00LjYyNSwwLTguOTU4OTgtMi4yNTU4Ni0xMS42MTEzMy02LjA0NDkybC00MS4xMjIwNy01OC43NDYwOXY1MC42MTgxNg0KCQkJCWMwLDcuODI5MS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVINTU2LjczMjQyTDU1Ni43MzI0MiwxMzExLjEzNDc3eiBNMTIxNS4wMjA1MSwxMjExLjkyMjg1DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoNTAuMzE1NDNjMi4zNDg2MywwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyDQoJCQkJYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVoLTYuMDI0NDF2NzUuMTE4MTZjMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMTg4DQoJCQkJYy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtODUuMDQxMDJoLTE1Ljk0NDM0Yy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMzMyLTQuMjUxOTUtNC4yNTE5NVYxMjExLjkyMjg1DQoJCQkJTDEyMTUuMDIwNTEsMTIxMS45MjI4NXogTTc3Ni40NDkyMiwxMjExLjkyMjg1YzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTczODMtMTQuMTczODNoNTAuMzE0NDUNCgkJCQljMi4zNDk2MSwwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcxODgsMTQuMTcyODVoLTYuMDI1Mzl2NzUuMTE4MTYNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMDljLTIuMzQ5NjEsMC00LjI1MTk1LTEuOTAyMzQtNC4yNTE5NS00LjI1di04NS4wNDEwMmgtMTUuOTQ1MzENCgkJCQljLTIuMzQ3NjYsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMTEuOTIyODVMNzc2LjQ0OTIyLDEyMTEuOTIyODV6IE05MjkuNjA0NDksMTI3Mi4wMjI0NmwyNi45NTgwMSwzMi4xMjc5Mw0KCQkJCWMyLjMxNDQ1LDIuNzU3ODEsMC4zNDM3NSw2Ljk4NDM4LTMuMjU2ODQsNi45ODQzOGgtMTkuNzA1MDhjLTQuMTg5NDUsMC04LjE2NTA0LTEuODUxNTYtMTAuODU3NDItNS4wNjA1NWwtMjIuNjgxNjQtMjcuMDMxMjUNCgkJCQl2MjcuODQxOGMwLDIuMzQ3NjYtMS45MDMzMiw0LjI1LTQuMjUxOTUsNC4yNWgtOS45MjA5Yy03LjgyNzE1LDAtMTQuMTcyODUtNi4zNDM3NS0xNC4xNzI4NS0xNC4xNzI4NXYtODUuMDM5MDYNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2gyOS43NjM2N2MyMi43MDAyLDAsNDEuMTAyNTQsMTcuMTMzNzksNDEuMTAyNTQsMzguMjY4NTUNCgkJCQlDOTU2Ljc1NDg4LDEyNTIuNTkwODIsOTQ1LjQzNjUyLDEyNjYuNzAyMTUsOTI5LjYwNDQ5LDEyNzIuMDIyNDZMOTI5LjYwNDQ5LDEyNzIuMDIyNDZ6IE05MDAuMDYxNTIsMTIyMS44NDM3NXYzMi41OTg2M2g4LjUwMzkxDQoJCQkJYzEwLjk1ODk4LDAsMTkuODQyNzctNy4yOTc4NSwxOS44NDI3Ny0xNi4yOTg4M2MwLTkuMDAxOTUtOC44ODM3OS0xNi4yOTk4LTE5Ljg0Mjc3LTE2LjI5OThIOTAwLjA2MTUyTDkwMC4wNjE1MiwxMjIxLjg0Mzc1eg0KCQkJCSBNMTE1OC4zNTkzOCwxMTk1LjYyMzA1YzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NzI3LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOA0KCQkJCWwtNC45MzI2Miw4LjU0MTk5Yy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNTU5LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMyMjMsMCw1Ljk2MDk0LTAuNDQzMzYsOC43MjU1OS0xLjI2ODU1YzYuMjk1OS0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTgzNiw2LjUwMDk4bDQuOTMwNjYsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM3NSw1LjczNDM4Yy05LjAwNDg4LDUuNjAxNTYtMTkuNjMyODEsOC44Mzc4OS0zMS4wMTc1OCw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzEwOTkuNTQwMDQsMTIyMS45NTcwMywxMTI1Ljg3NDAyLDExOTUuNjIzMDUsMTE1OC4zNTkzOCwxMTk1LjYyMzA1eiIvPg0KCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwMEZGREEiIGQ9Ik0xMzE4LjE5NzI3LDEyMDYuMDMyMjMNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2MyMC42NTYyNSwwLDQxLjMxMjUsMCw2MS45Njg3NSwwYzMuNDI5NjksMCw1LjQ1MDIsMy44ODA4NiwzLjQ4MzQsNi42OTA0Mw0KCQkJCWwtMTkuMjk2ODgsMjcuNTY3MzhjMTUuNTQyOTcsOC4zNzU5OCwyNi4xMDY0NSwyNC44MDA3OCwyNi4xMDY0NSw0My42OTUzMWMwLDI3LjM5NzQ2LTIyLjIwODk4LDQ5LjYwNjQ1LTQ5LjYwNjQ1LDQ5LjYwNjQ1DQoJCQkJYy0xNi42ODg0OCwwLTMxLjQ1MTE3LTguMjQwMjMtNDAuNDQzMzYtMjAuODc1OThjLTEuNDUwMi0yLjAzOTA2LTAuODMxMDUtNC44OTk0MSwxLjMzNTk0LTYuMTUyMzRsMTAuOTc3NTQtNi4zMzc4OQ0KCQkJCWM0Ljg4MTg0LTIuODE4MzYsMTAuOTc5NDktMi40NzU1OSwxNS41MTQ2NSwwLjg3MzA1YzMuNTI4MzIsMi42MDU0Nyw3Ljg5MTYsNC4xNDY0OCwxMi42MTUyMyw0LjE0NjQ4DQoJCQkJYzExLjc0MjE5LDAsMjEuMjU5NzctOS41MTg1NSwyMS4yNTk3Ny0yMS4yNTk3N3MtOS41MTc1OC0yMS4yNTk3Ny0yMS4yNTk3Ny0yMS4yNTk3N2gtMTUuMjE3NzcNCgkJCQljLTMuNDI5NjksMC01LjQ1MDItMy44ODA4Ni0zLjQ4NDM4LTYuNjkwNDNsMTguMTM1NzQtMjUuOTA4MmgtMzIuMDA5NzdjLTIuMzQ4NjMsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMDYuMDMyMjN6DQoJCQkJIi8+DQoJCTwvZz4NCgkJPGc+DQoJCQk8Zz4NCgkJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0RBRThGNyIgZD0iTTg1MC4zOTU1MSw4NTcuNTkxOA0KCQkJCQljLTUwLjM1NjQ1LDAtOTQuMzI1Mi0yNy4zNTY0NS0xMTcuODUyNTQtNjguMDIwNTFsLTgwLjAzMDI3LDQ2LjIwNDFjLTQuNjU1MjcsMi42ODk0NS02LjEzMTg0LDguNzE4NzUtMy4yNDkwMiwxMy4yNTU4Ng0KCQkJCQljNDIuMjM3Myw2Ni40ODYzMywxMTYuNTMzMiwxMTAuNjA3NDIsMjAxLjEzMTg0LDExMC42MDc0MmM4OC4xMjU5OCwwLDE2NS4wNzEyOS00Ny44NzUsMjA2LjI0MzE2LTExOS4wMzYxM2wtODAuNDg3My00Ni40Njk3Mw0KCQkJCQljLTQuMzEzNDgtMi40OTAyMy05LjgwMTc2LTEuMjA1MDgtMTIuNTcwMzEsMi45MzU1NUM5MzkuMTc1NzgsODMzLjU2MjUsODk3LjU5MTgsODU3LjU5MTgsODUwLjM5NTUxLDg1Ny41OTE4DQoJCQkJCUw4NTAuMzk1NTEsODU3LjU5MTh6IE0xMTM2LjcyMTY4LDU1Ni4yMTc3N2M0LjYxNDI2LTIuNjYzMDksNi4xMTAzNS04LjYxOTE0LDMuMzEyNS0xMy4xNTEzNw0KCQkJCQljLTU5LjkxNTA0LTk3LjAzMDI3LTE2Ny4yMjQ2MS0xNjEuNjk0MzQtMjg5LjYzODY3LTE2MS42OTQzNGMtMTI1Ljg5MzU1LDAtMjM1LjgxMzQ4LDY4LjM5MjU4LTI5NC42MzM3OSwxNzAuMDQ5OA0KCQkJCQlsODAuMzc2OTUsNDYuNDA2MjVjNC4zOTc0NiwyLjUzOTA2LDEwLjAwMTk1LDEuMTQ5NDEsMTIuNzEwOTQtMy4xNDU1MQ0KCQkJCQljNDIuMTY0MDYtNjYuODUxNTYsMTE2LjY2ODk1LTExMS4yNjM2NywyMDEuNTQ1OS0xMTEuMjYzNjdjODguMTI1OTgsMCwxNjUuMDcxMjksNDcuODc1OTgsMjA2LjI0MzE2LDExOS4wMzYxMw0KCQkJCQlMMTEzNi43MjE2OCw1NTYuMjE3Nzd6Ii8+DQoJCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNBNUJBQzgiIGQ9Ik04NTAuMzk1NTEsOTU5LjYzODY3DQoJCQkJCWMtODQuNTk4NjMsMC0xNTguODk0NTMtNDQuMTIxMDktMjAxLjEzMTg0LTExMC42MDc0MmMtMi44NzY5NS00LjUzMDI3LTEuMzk5NDEtMTAuNTcwMzEsMy4yNDkwMi0xMy4yNTU4Nmw4MC4wMzAyNy00Ni4yMDQxDQoJCQkJCWMtMTEuNTgxMDUtMjAuMDE2Ni0xOC4yMDk5Ni00My4yNTQ4OC0xOC4yMDk5Ni02OC4wNDE5OWMwLTc0Ljc4NTE2LDYwLjU1NzYyLTEzNi4wNjI1LDEzNi4wNjI1LTEzNi4wNjI1DQoJCQkJCWM0Ny4xOTYyOSwwLDg4Ljc4MDI3LDI0LjAyOTMsMTEzLjE4NTU1LDYwLjUyMjQ2YzIuNzY0NjUsNC4xMzM3OSw4LjI2MzY3LDUuNDIxODgsMTIuNTcwMzEsMi45MzU1NWw4MC40ODczLTQ2LjQ2OTczDQoJCQkJCWMtNDEuMTcxODgtNzEuMTYwMTYtMTE4LjExNzE5LTExOS4wMzYxMy0yMDYuMjQzMTYtMTE5LjAzNjEzYy04NC44NzY5NSwwLTE1OS4zODE4NCw0NC40MTIxMS0yMDEuNTQ1OSwxMTEuMjYzNjcNCgkJCQkJYy0yLjcwNjA1LDQuMjkxMDItOC4zMTgzNiw1LjY4MTY0LTEyLjcxMDk0LDMuMTQ1NTFsLTgwLjM3Njk1LTQ2LjQwNjI1DQoJCQkJCWMtMjguOTUyMTUsNTAuMDQwMDQtNDUuNTIzNDQsMTA4LjEzOTY1LTQ1LjUyMzQ0LDE3MC4xMDc0MmMwLDE4Ni45NjM4NywxNTEuMzk0NTMsMzQwLjE1NzIzLDM0MC4xNTcyMywzNDAuMTU3MjMNCgkJCQkJYzEyMi40MTQwNiwwLDIyOS43MjM2My02NC42NjQwNiwyODkuNjM4NjctMTYxLjY5NTMxYzIuNzk0OTItNC41MjYzNywxLjI5NDkyLTEwLjQ5MDIzLTMuMzEyNS0xMy4xNTEzN2wtODAuMDgzMDEtNDYuMjM3Mw0KCQkJCQlDMTAxNS40NjY4LDkxMS43NjM2Nyw5MzguNTIxNDgsOTU5LjYzODY3LDg1MC4zOTU1MSw5NTkuNjM4Njd6Ii8+DQoJCQk8L2c+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzAwRkZEQSIgZD0iTTExMzcuMTg1NTUsNzU4LjExMzI4di03My4xNjc5N2wtNjMuMzY1MjMsMzYuNTgzOTgNCgkJCQlMMTEzNy4xODU1NSw3NTguMTEzMjhMMTEzNy4xODU1NSw3NTguMTEzMjh6IE0xMDI2LjU3NjE3LDcwNS4xNjQwNmwxMjAuMDU4NTktNjkuMzE2NDENCgkJCQljMTIuNTY4MzYtNy4yNTU4NiwyOC4zNDQ3MywxLjg1MjU0LDI4LjM0NTcsMTYuMzY2MjF2MTM4LjYzMDg2Yy0wLjAwMDk4LDE0LjUxMjctMTUuNzc3MzQsMjMuNjIyMDctMjguMzQ1NywxNi4zNjYyMQ0KCQkJCWwtMTIwLjA1ODU5LTY5LjMxNjQxQzEwMTQuMDI4MzIsNzMwLjY0OTQxLDEwMTQuMDI4MzIsNzEyLjQwOTE4LDEwMjYuNTc2MTcsNzA1LjE2NDA2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=").then(tex=>{if(this._splashState==="done")renderer.DeleteTexture(tex);else this._splashTextures.logo=tex}).catch(err=>console.warn("Failed to load splash image: ",err));this._LoadBitmapSplashImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAmd137hFVqjO7zCKIRGZ881JRAAAFZklEQVR42u2aO68SQRTHR3leQeI3wMRo7CDGZyyg0MTEYlFbEylMLC+JsQYfvTZWFpgYKwuImlhqYiyNfgOsbRBYefn4O+ecGdgF0caEMbv/5N6BYRY4vzNzzplZVKxYsWLFihUrViwHVcIBJdoDqAjqvwGwF6LJ6YgDAI5EHQBuRR3AvBZNAENu73pAI8oAVB74GWkA6gOG0QawF2hFGkACKEcaQA7yna804Z9UG5U6A9ys2SfH8Y2vaWNyQrfm8aC8AiBdgX9aOSkGIBIAl6Qq4pcm3L8r6SELfNQmF6E1oI4iDu4CP+w1xuIEtPx6CEC2A61HSvX1lSwPB5UbCgIgQ/d7YDXIFN9Ex/PUyNM7YD1jAEfAALIlqSO6SqsN0igEoAfSsKWS5i3303JzQ6tLoAfRjF3eEm+NqclgovsMn2GNAJwTAPcgOsyjjIIAFq/ngbrJuS3lhpYA0uSVnAecVYU28EZbzm7Kmhl/jeqEl8ATlauweUXtdD1AX0PtCxlWoQGpYysARl11g17Pmu69mCtHtASwA9Tp30P9uMCeLeKBeMuXUPBVqSZbmSvhGwN4w1NDrHoOdFXKM/EhBGBGQbNPMaSDKvXdx0g5oiWAXbKzZ1zTx9CYrPZB5u0HPFb7Tb38kswsmiDZkzbnaZsTZkAmBOApxxDqqshyqmiAjmgBoADyStt8swy56xrG7K0Se7qDsu72a4uAWDRjmzpIilVVTcvvcn70ggA+Smmgx72WCdLRMB2RBfCiQ0EqZR2Xo+m9g+9s13VtGb3U0kiox8THIr6wrSA+TGqq/wabCiH2/g4vp5w7SSC4HfZbKs2z3fooweuh42cwpRjp06KY2jxetgDSNqInMdIDxhsAyMIv8AckgJpyRAEARzng1ezW6KvK0rMUBmnye57+VfDF2vdGALA19q2+6wFfNwJIYmCm2A5myhUtAYx46duQ2Cdfd1DX9o1T3pxi4ZiDu9UBBiAGWg10X3UjgH1kdhNVyaiuyAKYnZRUaPNzj/LgBw4EVdXk5X+eYuQ6gJ0wgIMbAIjfZY309TxxRTYILr5jEMAuqtrwhm7LtCMIAXiwDkBf3PwzAFkHelRDuaI/Akhiqr1V1xAe69lQ/juAv8+APHzKkXXligIA1mNABiPtrZpuv6kOutp1gfxtAWQCZe0fY8Bes8Gop+E7kwRCAFazgCpgkvIm1I5SmHNvdQWA+NTqb1lAXtijHzijMIBCoA44SDWOn8ZPamdpUxRN1wAkAju7v9UBUi8m9SBnFAaQC1aCjOE2u7SJq5iKDWsAssGyTkrFzZWgUq8x7qGqnFEYgN0L2AK+guN4wO1nVHm03w0BEFsvKqt98Gub9wJVDoUDyq7OaAVA30S0Xem+Dw9ldmwbDZnuEgWfl5cAKuaa3CG1YTd42O4GufFLmogzWgGwD3go9f1Y4hbQZbdJcEiV5OAr7U2WAC4Dz6i9job2vKyBZhCAXNOXt0oB+iPdURiAPRFqGkfmgbnxHmoyJfD9o0q0MWwtAGQBvFfqDO8m+r8/EWrJiZCw0YzcURhA6ExQZsKIl7TtKMDogswAVn+5nbQ7gxCAIUSHzerCVLmjMIDQqbAYPjXBcWTznD3hFQCCSXRUHEwatQMAZkJ12DXlgDunIWEAolfBX0tI6RcsAHJi4DvJAqFrvtcWc8SvFwMABnJf4JZ57tBpyBqAtTtDFZOxXi9uZKROaVPLwTQo1+CtfdyhO0MhAKE7Q/spGEZZWXeOxLejvDtH4ttR0qHTkK2ojwcq0urgk4qyEi6dhmxB6Wa0YyAAZ34asRUB8F35ZcBWxDuGKKuIJypWrFixYsX6B/oFRYsi2zOzWJcAAAAASUVORK5CYII=").then(tex=>{if(this._splashState==="done")renderer.DeleteTexture(tex);else this._splashTextures.powered=
tex}).catch(err=>console.warn("Failed to load splash image: ",err));this._LoadBitmapSplashImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAdxHdu4hmVZnuRMwzqiLYE4y2AAAFw0lEQVR42u2Yy+9LQRTHp6Xq0VIkXkFvwkYslAWJiGJj2a6sJJe/oF3YWGElEQmxkYi4ErFWNpatWFmIx9Lm1sJCLKgqraqv82h726l6hOuRzDf53TtnOr+ZOZ+ZOffca5ycnJycnJycnJycnJycnJz+pi7g2G9osxjvzX8qB8ABcAAcgH8XwDa85dspNOiaRDuAR4U0PnHtDuyy7IJRJS6gvVmL6TywVkp4ZxIhulUxFvlaXQTrgEHbnMDH5XRjlXCdb+uAnc2ojWgFFTYBZ8e9tzcaswAk6v/3K4sPfPNRFj87IXj+KXQUS9m2jXoH1lMuLq2DtEcAtNMBT9PjanFq7ySAhbABVEAaeDaAwkk2D7GRqctAMQJIq2sBauLnB/VxCfqKpWrbRhSC1W5SMQ9RTgBUwKpF1ccmAIQ2gCxE+20Au9nSESvDgeIDkJSBMpA9vgyXdsj0H0GORL3n2fbwPOKoSQS4Q2cBOGzSJbQYAHDbZEI+rEuBcyZRlF71fIP/x0wBuIBOw6xH3xu2GQFAP2cegmvSwHkeqBZjECzB46UXD3bg8UKJCT6QYzgDY9uiU7hC11doERq6MAZ2CPJ7ipEulOrteDcB4KOZBpBG7zrV1JGzATzmIdnrl/go3bRiBJBHlZc+6ItjuQQ+yFLz8Gka2LZFRVTFGdoQJQ0LPodHnXkS8AjlRWkBLwKQswAs0PDzGpcsAAMNuG+5WgdqxwjgEcp8qcBjN5oZdPhEvOfhU/hsbJuVloWV6WWgp2IBLxXQNEwLDfKqoMXrEQBjATiFA3qePlgAZJRl+EStdaAQjfgALOC1zfeX8ALV+7S69JdALWjxHGqztmxyMnTD6OOBWvAdGDkn60c6vrI5H4CPnOJsWQDe8G0hIU0MB8ojFx+AFAeqeitLy5FkL3w0yNNcSOx3oDxjjxaH9XxldZluY5NBfwrAQvQbRjQXAO8UqVq5dh6A7HCgWzgdFwBdgOX4lMZbTndkWWkDN07Bk+zItllLdHm1+FkLwBSADNDf8B0AnGOp5gFYgJEexwcgGQx4iyeD9ybFkWsbDZbv0+2Y8XvGtqMpWsUimpMAzA1AUrj5ALjm2wCoONKB+ACYsEeDlU04MMs4imeJQqljslSuD4xl/zgAsx6ku/8DgDwaO9AwFU56qhzOPiXpKCzCpSSdb8v+CQDmXshb99cARAPFCOA1chWaFXlP55yn2FqEgiFvOSzYtmiJzisKB7MxQPS8iO63YsD3AHDv8QPgjR92eKuf9vts1wdZjvZhN4XajD35FNDiR7ln0LYBaILY+OZT4DsA+BkTP4AUrgXkxSJcDFps+72X7EGlx6mBbU/lAbdQjvKA7hSAlSuHxdw0gORsHrAUnXkAUuj+AQAZdHGRp9bShX2ECz1JRSk4zNhRJqj5SZQJfpgCUNS2eRsAP/usTDAxPxFKA834AZgAOM1z6qGgxxpdmUDQNjP25LtAsojxu0AehSkAF6RLXWR/EkAdVYEevQtswVtpMwuAB1JGh2jbxQcgBKrig/qSxTD6o2Nm7fttSY6uUnErV+jb4CJyaArAI5luJkCDOy5HAPISSB5A3wYbhJERahvtPALAAw2EI9Vzsh2TTuk23qEceN9d4vVVv227hNroe0CRi/o9IKTZTQFIAc/M8jwGEiouG2/042u8u25uAuPvAavRH7XhzqcBpICdRpssRa+aNLFoh2JeyBzU08fih/ht20WZXghW34s+/ZQnAKhzojsSH4CC/sjARPKamLXacOfTAIwfNSkCbROLluG9Tm2gdl3PY178tu2SBIpFQ6fHH//2GAvAogCkjtGDEAFQYPsu6DdBqw11bgFIF8dNHsQGIEFRSDOe0RS9YYJk23JMrw+/Cr9bFX0VXmNsACbhA088qXhBrMYAlq8Gjhh//FX4YNSGO7cASO9n9B99AuHk5OTk5OTk5OTk5OTk5OTk5OT0VX0B7+fX+9cwWYYAAAAASUVORK5CYII=").then(tex=>{if(this._splashState==="done")renderer.DeleteTexture(tex);else this._splashTextures.website=tex}).catch(err=>console.warn("Failed to load splash image: ",err))}}async _LoadSvgSplashImage(url){url=(new URL(url,this._runtime.GetRuntimeBaseURL())).toString();const blob=await C3.FetchBlob(url);const drawable=await this._runtime.RasterSvgImage(blob,2048,2048);
return await this.GetRenderer().CreateStaticTextureAsync(drawable,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(url){url=(new URL(url,this._runtime.GetRuntimeBaseURL())).toString();const blob=await C3.FetchBlob(url);return await this.GetRenderer().CreateStaticTextureAsync(blob,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now();this._runtime.Dispatcher().addEventListener("loadingprogress",
this._loadingprogress_handler);this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen());const loaderStyle=this._runtime.GetLoaderStyle();if(loaderStyle!==3)this.HideCordovaSplashScreen()}async EndLoadingScreen(){const renderer=this.GetRenderer();this._loadingProgress=1;const loaderStyle=this._runtime.GetLoaderStyle();if(loaderStyle===4)await this._splashDonePromise;this._splashDoneResolve=null;this._splashDonePromise=null;if(this._rafId!==-1){cancelAnimationFrame(this._rafId);this._rafId=
-1}this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler);this._loadingprogress_handler=null;if(this._percentText){this._percentText.Release();this._percentText=null}this._runtime.ReleaseLoadingLogoAsset();renderer.Start();if(this._splashTextures.logo){renderer.DeleteTexture(this._splashTextures.logo);this._splashTextures.logo=null}if(this._splashTextures.powered){renderer.DeleteTexture(this._splashTextures.powered);this._splashTextures.powered=null}if(this._splashTextures.website){renderer.DeleteTexture(this._splashTextures.website);
this._splashTextures.website=null}renderer.ClearRgba(0,0,0,0);renderer.Finish();this._splashState="done";this._gpuTimeStartFrame=renderer.GetFrameNumber();if(loaderStyle===3)this.HideCordovaSplashScreen()}_DrawLoadingScreen(){if(this._rafId===-1)return;const renderer=this.GetRenderer();renderer.Start();this._rafId=-1;const hasHadError=this._runtime.GetAssetManager().HasHadErrorLoading();const loaderStyle=this._runtime.GetLoaderStyle();if(loaderStyle!==3){this.SetCssTransform(renderer);renderer.ClearRgba(0,
0,0,0);renderer.ResetColor();renderer.SetTextureFillMode();renderer.SetTexture(null)}if(loaderStyle===0)this._DrawProgressBarAndLogoLoadingScreen(hasHadError);else if(loaderStyle===1)this._DrawProgressBarLoadingScreen(hasHadError,PROGRESSBAR_WIDTH,0);else if(loaderStyle===2)this._DrawPercentTextLoadingScreen(hasHadError);else if(loaderStyle===3)C3.noop();else if(loaderStyle===4)this._DrawSplashLoadingScreen(hasHadError);else throw new Error("invalid loader style");renderer.Finish();this._rafId=requestAnimationFrame(()=>
this._DrawLoadingScreen())}_DrawPercentTextLoadingScreen(hasHadError){if(hasHadError)this._percentText.SetColorRgb(1,0,0);else this._percentText.SetColorRgb(.6,.6,.6);this._percentText.SetText(Math.round(this._loadingProgress*100)+"%");const midX=this._canvasCssWidth/2;const midY=this._canvasCssHeight/2;const hw=PERCENTTEXT_WIDTH/2;const hh=PERCENTTEXT_HEIGHT/2;tempQuad.setRect(midX-hw,midY-hh,midX+hw,midY+hh);const renderer=this.GetRenderer();renderer.SetTexture(this._percentText.GetTexture());renderer.Quad3(tempQuad,
this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(hasHadError,width,yOff){const renderer=this.GetRenderer();const height=PROGRESSBAR_HEIGHT;renderer.SetColorFillMode();if(hasHadError)renderer.SetColorRgba(1,0,0,1);else renderer.SetColorRgba(.118,.565,1,1);const midX=this._canvasCssWidth/2;const midY=this._canvasCssHeight/2;const hw=width/2;const hh=height/2;tempRect.setWH(midX-hw,midY-hh+yOff,Math.floor(width*this._loadingProgress),height);renderer.Rect(tempRect);tempRect.setWH(midX-hw,
midY-hh+yOff,width,height);tempRect.offset(-.5,-.5);tempRect.inflate(.5,.5);renderer.SetColorRgba(0,0,0,1);renderer.LineRect2(tempRect);tempRect.inflate(1,1);renderer.SetColorRgba(1,1,1,1);renderer.LineRect2(tempRect)}_DrawProgressBarAndLogoLoadingScreen(hasHadError){const renderer=this.GetRenderer();const loadingLogoAsset=this._runtime.GetLoadingLogoAsset();if(!loadingLogoAsset){this._DrawProgressBarLoadingScreen(hasHadError,PROGRESSBAR_WIDTH,0);return}const logoTexture=loadingLogoAsset.GetTexture();
if(!logoTexture){this._DrawProgressBarLoadingScreen(hasHadError,PROGRESSBAR_WIDTH,0);return}const logoW=logoTexture.GetWidth();const logoH=logoTexture.GetHeight();const midX=this._canvasCssWidth/2;const midY=this._canvasCssHeight/2;const hw=logoW/2;const hh=logoH/2;tempQuad.setRect(midX-hw,midY-hh,midX+hw,midY+hh);renderer.SetTexture(logoTexture);renderer.Quad(tempQuad);this._DrawProgressBarLoadingScreen(hasHadError,logoW,hh+16)}_DrawSplashLoadingScreen(hasHadError){const renderer=this.GetRenderer();
const logoTex=this._splashTextures.logo;const poweredTex=this._splashTextures.powered;const websiteTex=this._splashTextures.website;const nowTime=Date.now();if(this._splashFrameNumber===0)this._loaderStartTime=nowTime;const allowQuickSplash=this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova();const splashAfterFadeOutWait=allowQuickSplash?0:SPLASH_AFTER_FADEOUT_WAIT_TIME;const splashMinDisplayTime=allowQuickSplash?0:SPLASH_MIN_DISPLAY_TIME;let a=1;if(this._splashState===
"fade-in")a=Math.min((nowTime-this._loaderStartTime)/SPLASH_FADE_DURATION,1);else if(this._splashState==="fade-out")a=Math.max(1-(nowTime-this._splashFadeOutStartTime)/SPLASH_FADE_DURATION,0);renderer.SetColorFillMode();renderer.SetColorRgba(.231*a,.251*a,.271*a,a);tempRect.set(0,0,this._canvasCssWidth,this._canvasCssHeight);renderer.Rect(tempRect);const w=Math.ceil(this._canvasCssWidth);const h=Math.ceil(this._canvasCssHeight);let drawW,drawH;if(this._canvasCssHeight>256){renderer.SetColorRgba(.302*
a,.334*a,.365*a,a);drawW=w;drawH=Math.max(h*.005,2);tempRect.setWH(0,h*.8-drawH/2,drawW,drawH);renderer.Rect(tempRect);if(hasHadError)renderer.SetColorRgba(a,0,0,a);else renderer.SetColorRgba(.161*a,.953*a,.816*a,a);drawW=w*this._loadingProgress;tempRect.setWH(w*.5-drawW/2,h*.8-drawH/2,drawW,drawH);renderer.Rect(tempRect);renderer.SetColorRgba(a,a,a,a);renderer.SetTextureFillMode();if(poweredTex){drawW=C3.clamp(h*.22,105,w*.6)*1.5;drawH=drawW/8;tempRect.setWH(w*.5-drawW/2,h*.2-drawH/2,drawW,drawH);
renderer.SetTexture(poweredTex);renderer.Rect(tempRect)}if(logoTex){drawW=Math.min(h*.395,w*.95);drawH=drawW;tempRect.setWH(w*.5-drawW/2,h*.485-drawH/2,drawW,drawH);renderer.SetTexture(logoTex);renderer.Rect(tempRect)}if(websiteTex){drawW=C3.clamp(h*.22,105,w*.6)*1.5;drawH=drawW/8;tempRect.setWH(w*.5-drawW/2,h*.868-drawH/2,drawW,drawH);renderer.SetTexture(websiteTex);renderer.Rect(tempRect)}}else{renderer.SetColorRgba(.302*a,.334*a,.365*a,a);drawW=w;drawH=Math.max(h*.005,2);tempRect.setWH(0,h*.85-
drawH/2,drawW,drawH);renderer.Rect(tempRect);if(hasHadError)renderer.SetColorRgba(a,0,0,a);else renderer.SetColorRgba(.161*a,.953*a,.816*a,a);drawW=w*this._loadingProgress;tempRect.setWH(w*.5-drawW/2,h*.85-drawH/2,drawW,drawH);renderer.Rect(tempRect);renderer.SetColorRgba(a,a,a,a);renderer.SetTextureFillMode();if(logoTex){drawW=h*.55;drawH=drawW;tempRect.setWH(w*.5-drawW/2,h*.45-drawH/2,drawW,drawH);renderer.SetTexture(logoTex);renderer.Rect(tempRect)}}this._splashFrameNumber++;if(this._splashState===
"fade-in"&&nowTime-this._loaderStartTime>=SPLASH_FADE_DURATION&&this._splashFrameNumber>=2){this._splashState="wait";this._splashFadeInFinishTime=nowTime}if(this._splashState==="wait"&&nowTime-this._splashFadeInFinishTime>=splashMinDisplayTime&&this._loadingProgress>=1){this._splashState="fade-out";this._splashFadeOutStartTime=nowTime}if(this._splashState==="fade-out"&&nowTime-this._splashFadeOutStartTime>=SPLASH_FADE_DURATION+splashAfterFadeOutWait||allowQuickSplash&&this._loadingProgress>=1&&nowTime-
this._loaderStartTime<500)this._splashDoneResolve()}};

}

// runtime.js
{
'use strict';const C3=self.C3;const C3Debugger=self.C3Debugger;const assert=self.assert;const DEFAULT_RUNTIME_OPTS={"messagePort":null,"runtimeBaseUrl":"","headless":false,"hasDom":true,"isInWorker":false,"useAudio":true,"projectData":"","exportType":""};let ife=true;
C3.Runtime=class C3Runtime extends C3.DefendedBase{constructor(opts){opts=Object.assign({},DEFAULT_RUNTIME_OPTS,opts);super();this._messagePort=opts["messagePort"];this._runtimeBaseUrl=opts["runtimeBaseUrl"];this._previewUrl=opts["previewUrl"];this._isHeadless=!!opts["headless"];this._hasDom=!!opts["hasDom"];this._isInWorker=!!opts["isInWorker"];ife=opts["ife"];this._useAudio=!!opts["useAudio"];this._exportType=opts["exportType"];this._isiOSCordova=!!opts["isiOSCordova"];this._isiOSWebView=!!opts["isiOSWebView"];
this._isWindowsWebView2=!!opts["isWindowsWebView2"];this._isAnyWebView2Wrapper=!!opts["isAnyWebView2Wrapper"];this._isFBInstantAvailable=!!opts["isFBInstantAvailable"];this._opusWasmScriptUrl=opts["opusWasmScriptUrl"];this._opusWasmBinaryUrl=opts["opusWasmBinaryUrl"];this._isDebug=!!(this._exportType==="preview"&&opts["isDebug"]);this._breakpointsEnabled=this._isDebug;this._isDebugging=this._isDebug;this._debuggingDisabled=0;this._additionalLoadPromises=[];this._additionalCreatePromises=[];this._isUsingCreatePromises=
false;this._projectName="";this._projectVersion="";this._projectUniqueId="";this._appId="";this._originalViewportWidth=0;this._originalViewportHeight=0;this._devicePixelRatio=self.devicePixelRatio;this._parallaxXorigin=0;this._parallaxYorigin=0;this._viewportWidth=0;this._viewportHeight=0;this._loaderStyle=0;this._usesLoaderLayout=false;this._isLoading=true;this._usesAnyBackgroundBlending=false;this._usesAnyCrossSampling=false;this._usesAnyDepthSampling=false;this._loadingLogoAsset=null;this._assetManager=
C3.New(C3.AssetManager,this,opts);this._layoutManager=C3.New(C3.LayoutManager,this);this._eventSheetManager=C3.New(C3.EventSheetManager,this);this._addonManager=C3.New(C3.AddonManager,this,opts["wrapperComponentIds"]);this._collisionEngine=C3.New(C3.CollisionEngine,this);this._timelineManager=C3.New(C3.TimelineManager,this);this._transitionManager=C3.New(C3.TransitionManager,this);this._templateManager=C3.New(C3.TemplateManager,this);this._flowchartManager=C3.New(C3.FlowchartManager,this);this._textIconManager=
C3.New(C3.TextIconManager,{getIconSetMeta:iconSource=>this._GetTextIconSetMeta(iconSource),getIconSetContent:iconSource=>this._GetTextIconSetContent(iconSource)});this._iconChangeHandlers=new Map;this._allObjectClasses=[];this._objectClassesByName=new Map;this._objectClassesBySid=new Map;this._familyCount=0;this._allContainers=[];this._allEffectLists=new Set;this._currentLayoutStack=[];this._instancesPendingCreate=[];this._instancesPendingDestroy=new Map;this._hasPendingInstances=false;this._isFlushingPendingInstances=
false;this._objectCount=0;this._nextUid=0;this._instancesByUid=new Map;this._instancesPendingRelease=new Set;this._instancesPendingReleaseAffectedObjectClasses=new Set;this._objectReferenceTable=[];this._jsPropNameTable=[];this._canvasManager=null;this._uses3dFeatures=false;this._framerateMode="vsync";this._sampling="trilinear";this._isPixelRoundingEnabled=false;this._needRender=true;this._pauseOnBlur=false;this._isPausedOnBlur=false;this._exportToVideo=null;this._tickCallbacks={normal:timestamp=>
{this._rafId=-1;this._ruafId=-1;this.Tick(timestamp)},tickOnly:timestamp=>{this._ruafId=-1;this.Tick(timestamp,false,"skip-render")},renderOnly:()=>{this._rafId=-1;this.Render()}};this._rafId=-1;this._ruafId=-1;this._tickCount=0;this._tickCountNoSave=0;this._hasStarted=false;this._isInTick=false;this._hasStartedTicking=false;this._isLayoutFirstTick=true;this._suspendCount=0;this._scheduleTriggersThrottle=new C3.PromiseThrottle(1);this._randomNumberCallback=()=>Math.random();this._startTime=0;this._lastTickTime=
0;this._dtRaw=0;this._dt1=0;this._dt=0;this._timeScale=1;this._maxDt=1/30;this._minDt=0;this._gameTime=C3.New(C3.KahanSum);this._gameTimeRaw=C3.New(C3.KahanSum);this._wallTime=C3.New(C3.KahanSum);this._instanceTimes=new Map;this._fpsFrameCount=-1;this._fpsLastTime=0;this._fps=0;this._tpsTickCount=-1;this._tps=0;this._mainThreadTimeCounter=0;this._mainThreadTime=0;this._isLoadingState=false;this._saveToSlotName="";this._loadFromSlotName="";this._loadFromJson=null;this._lastSaveJson="";this._projectStorage=
null;this._savegamesStorage=null;this._dispatcher=C3.New(C3.Event.Dispatcher);this._domEventHandlers=new Map;this._pendingResponsePromises=new Map;this._nextDomResponseId=0;this._didRequestDeviceOrientationEvent=false;this._didRequestDeviceMotionEvent=false;this._isReadyToHandleEvents=false;this._waitingToHandleEvents=[];this._eventObjects={"pretick":C3.New(C3.Event,"pretick",false),"tick":C3.New(C3.Event,"tick",false),"tick2":C3.New(C3.Event,"tick2",false),"instancedestroy":C3.New(C3.Event,"instancedestroy",
false),"beforelayoutchange":C3.New(C3.Event,"beforelayoutchange",false),"layoutchange":C3.New(C3.Event,"layoutchange",false)};this._eventObjects["instancedestroy"].instance=null;this._userScriptDispatcher=C3.New(C3.Event.Dispatcher);this._userScriptEventObjects=null;const behInstSortFunc=(a,b)=>C3.BehaviorInstance.SortByTickSequence(this,a,b);this._behInstsToTick=C3.New(C3.RedBlackSet,behInstSortFunc);this._behInstsToPostTick=C3.New(C3.RedBlackSet,behInstSortFunc);this._behInstsToTick2=C3.New(C3.RedBlackSet,
behInstSortFunc);this._jobScheduler=C3.New(C3.JobSchedulerRuntime,this,opts["jobScheduler"]);if(opts["canvas"])this._canvasManager=C3.New(C3.CanvasManager,this);this._messagePort.onmessage=e=>this["_OnMessageFromDOM"](e.data);this.AddDOMComponentMessageHandler("runtime","visibilitychange",e=>this._OnVisibilityChange(e));this.AddDOMComponentMessageHandler("runtime","wrapper-extension-message",e=>this._OnWrapperExtensionMessage(e));this.AddDOMComponentMessageHandler("runtime","opus-decode",e=>this._WasmDecodeWebMOpus(e["arrayBuffer"]));
this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",()=>this._GetRemotePreviewStatusInfo());this.AddDOMComponentMessageHandler("runtime","js-invoke-function",e=>this._InvokeFunctionFromJS(e));this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self["goToLastErrorScript"]);this.AddDOMComponentMessageHandler("runtime","offline-audio-render-completed",e=>this._OnOfflineAudioRenderCompleted(e));this._dispatcher.addEventListener("window-blur",e=>this._OnWindowBlur(e));
this._dispatcher.addEventListener("window-focus",()=>this._OnWindowFocus());this._timelineManager.AddRuntimeListeners();this._templateManager.AddRuntimeListeners();this._iRuntime=null;this._interfaceMap=new WeakMap;this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null,timelineController:null,platformInfo:null};this._instancesNeedingAfterLoadMap=new WeakMap;this._instancesNeedingAfterLoadArray=[]}static Create(opts){return C3.New(C3.Runtime,opts)}Release(){C3.clearArray(this._allObjectClasses);
this._objectClassesByName.clear();this._objectClassesBySid.clear();this._layoutManager.Release();this._layoutManager=null;this._eventSheetManager.Release();this._eventSheetManager=null;this._addonManager.Release();this._addonManager=null;this._assetManager.Release();this._assetManager=null;this._collisionEngine.Release();this._collisionEngine=null;this._timelineManager.Release();this._timelineManager=null;this._transitionManager.Release();this._transitionManager=null;this._templateManager.Release();
this._templateManager=null;this._flowchartManager.Release();this._flowchartManager=null;this._textIconManager.Release();this._textIconManager=null;if(this._canvasManager){this._canvasManager.Release();this._canvasManager=null}this._dispatcher.Release();this._dispatcher=null;this._tickEvent=null}["_OnMessageFromDOM"](data){const type=data["type"];if(type==="event")this._OnEventFromDOM(data);else if(type==="result")this._OnResultFromDOM(data);else throw new Error(`unknown message '${type}'`);}_OnEventFromDOM(e){if(!this._isReadyToHandleEvents){this._waitingToHandleEvents.push(e);
return}const component=e["component"];const handler=e["handler"];const data=e["data"];const dispatchOpts=e["dispatchOpts"];const dispatchRuntimeEvent=!!(dispatchOpts&&dispatchOpts["dispatchRuntimeEvent"]);const dispatchUserScriptEvent=!!(dispatchOpts&&dispatchOpts["dispatchUserScriptEvent"]);const responseId=e["responseId"];if(component==="runtime"){if(dispatchRuntimeEvent){const event=new C3.Event(handler);event.data=data;this._dispatcher.dispatchEventAndWaitAsyncSequential(event)}if(dispatchUserScriptEvent){const event=
new C3.Event(handler,true);for(const [key,value]of Object.entries(data))event[key]=value;this.DispatchUserScriptEvent(event)}}const handlerMap=this._domEventHandlers.get(component);if(!handlerMap){if(!dispatchRuntimeEvent&&!dispatchUserScriptEvent)console.warn(`[Runtime] No DOM event handlers for component '${component}'`);return}const func=handlerMap.get(handler);if(!func){if(!dispatchRuntimeEvent&&!dispatchUserScriptEvent)console.warn(`[Runtime] No DOM handler '${handler}' for component '${component}'`);
return}let ret=null;try{ret=func(data)}catch(err){console.error(`Exception in '${component}' handler '${handler}':`,err);if(responseId!==null)this._PostResultToDOM(responseId,false,""+err);return}if(responseId!==null)if(ret&&ret.then)ret.then(result=>this._PostResultToDOM(responseId,true,result)).catch(err=>{console.error(`Rejection from '${component}' handler '${handler}':`,err);this._PostResultToDOM(responseId,false,""+err)});else this._PostResultToDOM(responseId,true,ret)}_PostResultToDOM(responseId,
isOk,result){this._messagePort.postMessage({"type":"result","responseId":responseId,"isOk":isOk,"result":result})}_OnResultFromDOM(data){const responseId=data["responseId"];const isOk=data["isOk"];const result=data["result"];const pendingPromise=this._pendingResponsePromises.get(responseId);if(isOk)pendingPromise.resolve(result);else pendingPromise.reject(result);this._pendingResponsePromises.delete(responseId)}AddDOMComponentMessageHandler(component,handler,func){let handlerMap=this._domEventHandlers.get(component);
if(!handlerMap){handlerMap=new Map;this._domEventHandlers.set(component,handlerMap)}if(handlerMap.has(handler))throw new Error(`[Runtime] Component '${component}' already has handler '${handler}'`);handlerMap.set(handler,func)}PostComponentMessageToDOM(component,handler,data,transfer){this._messagePort.postMessage({"type":"event","component":component,"handler":handler,"data":data,"responseId":null},transfer)}PostComponentMessageToDOMAsync(component,handler,data,transfer){const responseId=this._nextDomResponseId++;
const ret=new Promise((resolve,reject)=>{this._pendingResponsePromises.set(responseId,{resolve,reject})});this._messagePort.postMessage({"type":"event","component":component,"handler":handler,"data":data,"responseId":responseId},transfer);return ret}SendWrapperExtensionMessage(componentId,messageId,params,asyncId=-1){this.PostComponentMessageToDOM("runtime","send-wrapper-extension-message",{"componentId":componentId,"messageId":messageId,"params":params,"asyncId":asyncId})}SendWrapperExtensionMessageAsync(componentId,
messageId,params){const responseId=this._nextDomResponseId++;const ret=new Promise((resolve,reject)=>{this._pendingResponsePromises.set(responseId,{resolve,reject})});this.SendWrapperExtensionMessage(componentId,messageId,params,responseId);return ret}_OnWrapperExtensionMessage(data){if(data["asyncId"]!==-1){const responseId=data["asyncId"];const pendingPromise=this._pendingResponsePromises.get(responseId);pendingPromise.resolve(data["params"]);this._pendingResponsePromises.delete(responseId)}else this._OnEventFromDOM({"component":"wrapper-extension:"+
data["componentId"],"handler":data["messageId"],"data":data["params"],"responseId":null})}AddWrapperExtensionMessageHandler(componentId,messageId,func){this.AddDOMComponentMessageHandler("wrapper-extension:"+componentId,messageId,func)}HasWrapperComponentId(id){return this._addonManager.HasWrapperComponentId(id)}PostToDebugger(data){if(!this.IsDebug())throw new Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",data)}async Init(opts){C3.CommonACES_SetRuntime(this);
if(this.IsDebug())await C3Debugger.Init(this);else if(self.C3Debugger)self.C3Debugger.InitPreview(this);const [o]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);await this._LoadDataJson(o);await this._InitialiseCanvas(opts);if(!this.IsPreview())console.info("Made with Construct, the game and app creator :: https://www.construct.net");if(this.GetWebGLRenderer()){const webglRenderer=this.GetWebGLRenderer();console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?
"worker":"DOM"}, rendering with WebGL ${webglRenderer.GetWebGLVersionNumber()} [${webglRenderer.GetUnmaskedRenderer()}]`)}else if(this.GetWebGPURenderer())console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGPU [${this.GetWebGPURenderer().GetAdapterInfoString()}]`);if(this.GetRenderer().HasMajorPerformanceCaveat())console.warn("[C3 runtime] The renderer indicates a major performance caveat. Software rendering may be in use. This can result in significantly degraded performance.");
this._isReadyToHandleEvents=true;for(const e of this._waitingToHandleEvents)this._OnEventFromDOM(e);C3.clearArray(this._waitingToHandleEvents);if(this._canvasManager)this._canvasManager.StartLoadingScreen();for(const f of opts["runOnStartupFunctions"])this._additionalLoadPromises.push(this._RunOnStartupFunction(f));await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]);C3.clearArray(this._additionalLoadPromises);if(this._assetManager.HasHadErrorLoading()){if(this._canvasManager)this._canvasManager.HideCordovaSplashScreen();
return}if(this._canvasManager)await this._canvasManager.EndLoadingScreen();await this._dispatcher.dispatchEventAndWaitAsync(new C3.Event("beforeruntimestart"));await this.Start();this._messagePort.postMessage({"type":"runtime-ready"});return this}async _RunOnStartupFunction(f){try{await f(this._iRuntime)}catch(err){console.error("[C3 runtime] Error in runOnStartup function: ",err)}}async _LoadDataJson(o){const projectData=o["project"];this._projectName=projectData[0];this._projectVersion=projectData[16];
this._projectUniqueId=projectData[31];this._appId=projectData[38];const loadingLogoFilename=projectData[39]||"loading-logo.png";this._isPixelRoundingEnabled=!!projectData[9];this._originalViewportWidth=this._viewportWidth=projectData[10];this._originalViewportHeight=this._viewportHeight=projectData[11];this._collisionEngine._InitCollisionCellSize(this._originalViewportWidth,this._originalViewportHeight);this._parallaxXorigin=this._originalViewportWidth/2;this._parallaxYorigin=this._originalViewportHeight/
2;this._framerateMode=projectData[37];this._uses3dFeatures=!!projectData[40];this._sampling=projectData[14];this._usesAnyBackgroundBlending=projectData[15];this._usesAnyCrossSampling=projectData[42];this._usesAnyDepthSampling=projectData[17];this._usesLoaderLayout=!!projectData[18];this._loaderStyle=projectData[19];this._nextUid=projectData[21];this._pauseOnBlur=projectData[22];const assetManager=this._assetManager;assetManager._SetFileStructure(projectData[45]);assetManager._SetAudioFiles(projectData[7],
projectData[25]);assetManager._SetMediaSubfolder(projectData[8]);assetManager._SetFontsSubfolder(projectData[32]);assetManager._SetIconsSubfolder(projectData[28]);assetManager._SetWebFonts(projectData[29]);if(this._loaderStyle===0){let url="";if(this.IsPreview()){if(assetManager._HasLocalUrlBlob(loadingLogoFilename))url=assetManager.GetLocalUrlAsBlobUrl(loadingLogoFilename)}else if(assetManager.GetFileStructure()==="flat")url=assetManager.GetIconsSubfolder()+loadingLogoFilename;else url=loadingLogoFilename;
if(url)this._loadingLogoAsset=assetManager.LoadImage({url})}if(this._canvasManager){this._canvasManager.SetFullscreenMode(C3.CanvasManager._FullscreenModeNumberToString(projectData[12]));this._canvasManager.SetFullscreenScalingQuality(projectData[23]?"high":"low");this._canvasManager.SetMipmapsEnabled(projectData[24]!==0);this._canvasManager._SetGPUPowerPreference(projectData[34]);this._canvasManager._SetTextureAnisotropy(projectData[41]);this._canvasManager._SetWebGPUEnabled(projectData[13]);this._canvasManager._SetZAxisScale(projectData[30]);
this._canvasManager._SetZDistances(projectData[46],projectData[47]);this._canvasManager._SetInitFieldOfView(projectData[26]);this._canvasManager._SetLimitedToWebGL1(projectData[48])}const exportToVideoOpts=projectData[43];if(exportToVideoOpts)await this._LoadExportToVideoData(exportToVideoOpts);this._InitScriptInterfaces();this._addonManager.CreateSystemPlugin();this._objectReferenceTable=self.C3_GetObjectRefTable();const addonData=projectData[2];for(const behaviorData of addonData[1])this._addonManager.CreateBehavior(behaviorData);
for(const pluginData of addonData[0])this._addonManager.CreatePlugin(pluginData);this._objectReferenceTable=self.C3_GetObjectRefTable();this._LoadJsPropNameTable();this._addonManager._InitAddonScriptInterfaces();for(const objectClassData of projectData[3]){const objectClass=C3.ObjectClass.Create(this,this._allObjectClasses.length,objectClassData);this._allObjectClasses.push(objectClass);this._objectClassesByName.set(objectClass.GetName().toLowerCase(),objectClass);this._objectClassesBySid.set(objectClass.GetSID(),
objectClass)}for(const familyData of projectData[4]){const familyType=this._allObjectClasses[familyData[0]];familyType._LoadFamily(familyData)}for(const containerData of projectData[27]){const containerTypes=containerData.map(index=>this._allObjectClasses[index]);this._allContainers.push(C3.New(C3.Container,this,containerTypes))}this._InitObjectsScriptInterface();for(const objectClass of this._allObjectClasses)objectClass._OnAfterCreate();for(const layoutData of projectData[5])this._layoutManager.Create(layoutData);
const firstLayoutName=projectData[1];if(firstLayoutName){const firstLayout=this._layoutManager.GetLayoutByName(firstLayoutName);if(firstLayout)this._layoutManager.SetFirstLayout(firstLayout)}for(const transitionData of projectData[35])this._transitionManager.Create(transitionData);for(const timelineData of projectData[33])this._timelineManager.Create(timelineData);for(const templateInstanceData of projectData[44])this._templateManager.Create(templateInstanceData);if(!this._templateManager.HasTemplates()){this._templateManager.Release();
this._templateManager=null}for(const flowchartData of projectData[49])this._flowchartManager.Create(flowchartData);if(!this._flowchartManager.HasFlowcharts()){this._flowchartManager.Release();this._flowchartManager=null}for(const eventSheetData of projectData[6])this._eventSheetManager.Create(eventSheetData);this._eventSheetManager._PostInit();this._InitGlobalVariableScriptInterface();C3.clearArray(this._objectReferenceTable);this.FlushPendingInstances();let targetOrientation="any";const orientations=
projectData[20];if(orientations===1)targetOrientation="portrait";else if(orientations===2)targetOrientation="landscape";this.PostComponentMessageToDOM("runtime","set-target-orientation",{"targetOrientation":targetOrientation})}async _LoadExportToVideoData(exportToVideoOpts){const format=exportToVideoOpts["format"];if(format==="image-sequence")this._exportToVideo=new self.C3ExportToImageSequence(this,exportToVideoOpts);else if(format==="image-sequence-gif")this._exportToVideo=new self.C3ExportToGIF(this,
exportToVideoOpts);else if(format==="webm")this._exportToVideo=new self.C3ExportToWebMVideo(this,exportToVideoOpts);else if(format==="mp4")this._exportToVideo=new self.C3ExportToMP4Video(this,exportToVideoOpts);else;this._framerateMode="unlimited-frame";this._canvasManager.SetFullscreenMode("off");this._devicePixelRatio=1;self.devicePixelRatio=1;await this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{"message":this._exportToVideo.GetExportingMessageForPercent(0),"duration":this._exportToVideo.GetDuration()})}GetLoaderStyle(){return this._loaderStyle}IsExportToVideo(){return this._exportToVideo!==
null}GetExportVideoDuration(){return this._exportToVideo.GetDuration()}GetExportVideoFramerate(){return this._exportToVideo.GetFramerate()}_InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),height:this._canvasManager.GetDeviceHeight()})}_ExportToVideoAddFrame(){const time=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetMainCanvas(),time)}_ExportToVideoAddKeyframe(){if(this._exportToVideo)this._exportToVideo.AddKeyframe()}_OnOfflineAudioRenderCompleted(e){this._exportToVideo.OnOfflineAudioRenderCompleted(e)}_ExportToVideoFinish(){return this._exportToVideo.Finish()}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(promise){this._additionalLoadPromises.push(promise)}SetUsingCreatePromises(e){this._isUsingCreatePromises=
!!e}AddCreatePromise(promise){if(!this._isUsingCreatePromises)return;this._additionalCreatePromises.push(promise)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(el){this._allEffectLists.add(el)}_RemoveEffectList(el){this._allEffectLists.delete(el)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(opts){if(!this._canvasManager)return;await this._canvasManager.CreateCanvas(opts);
this._canvasManager.InitLoadingScreen(this._loaderStyle)}async _MaybeLoadOpusDecoder(){if(this._assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"))return;let wasmBlob=null;let wasmBuffer=null;try{if(this.IsiOSCordova()&&this._assetManager.IsFileProtocol())wasmBuffer=await this._assetManager.CordovaFetchLocalFileAsArrayBuffer(this._opusWasmBinaryUrl);else wasmBuffer=await this._assetManager.FetchArrayBuffer(this._opusWasmBinaryUrl)}catch(err){console.info("Failed to fetch Opus decoder WASM; assuming project has no Opus audio.",
err);return}if(wasmBuffer)this.AddJobWorkerBuffer(wasmBuffer,"opus-decoder-wasm");else this.AddJobWorkerBlob(wasmBlob,"opus-decoder-wasm");await this.AddJobWorkerScripts([this._opusWasmScriptUrl])}async _WasmDecodeWebMOpus(arrayBuffer){const result=await this.AddJob("OpusDecode",{"arrayBuffer":arrayBuffer},[arrayBuffer]);return result}async Start(){this._hasStarted=true;this._startTime=Date.now();let layoutStartedResolve=null;const layoutStartedPromise=new Promise(resolve=>layoutStartedResolve=resolve);
if(this._usesLoaderLayout){for(const objectClass of this._allObjectClasses)if(!objectClass.IsFamily()&&!objectClass.IsOnLoaderLayout()&&objectClass.IsWorldType())objectClass.OnCreate();(async()=>{await this._assetManager.WaitForAllToLoad();await layoutStartedPromise;this._isLoading=false;this._OnLoadFinished()})()}else this._isLoading=false;this._assetManager.SetInitialLoadFinished();if(this.IsDebug())C3Debugger.RuntimeInit(ife);for(const layout of this._layoutManager.GetAllLayouts())layout._CreateGlobalNonWorlds();
if(this.IsExportToVideo())await this._InitExportToVideo();const firstLayout=this._layoutManager.GetFirstLayout();await firstLayout._Load(null,this.GetRenderer());await firstLayout._StartRunning(true);this._fpsLastTime=performance.now();layoutStartedResolve();if(!this._usesLoaderLayout)this._OnLoadFinished();const state=await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking");if(state["isSuspended"]&&!this.IsExportToVideo())this._suspendCount++;else this.Tick()}_OnLoadFinished(){this.Trigger(C3.Plugins.System.Cnds.OnLoadFinished,
null,null);this.PostComponentMessageToDOM("runtime","register-sw")}GetObjectReference(index){index=Math.floor(index);const objRefTable=this._objectReferenceTable;if(index<0||index>=objRefTable.length)throw new Error("invalid object reference");return objRefTable[index]}_LoadJsPropNameTable(){for(const entry of self.C3_JsPropNameTable){const propName=C3.first(Object.keys(entry));this._jsPropNameTable.push(propName)}}GetJsPropName(index){index=Math.floor(index);const jsPropNameTable=this._jsPropNameTable;
if(index<0||index>=jsPropNameTable.length)throw new Error("invalid prop reference");return jsPropNameTable[index]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetRuntimeBaseURL(){return this._runtimeBaseUrl}GetPreviewURL(){return this._previewUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return this.GetCurrentEventStackFrame().GetConditionIndex()===
0}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetAddonManager(){return this._addonManager}GetSystemPlugin(){return this._addonManager.GetSystemPlugin()}GetObjectClassByIndex(i){i=Math.floor(i);if(i<0||i>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[i]}GetObjectClassByName(name){return this._objectClassesByName.get(name.toLowerCase())||null}GetObjectClassBySID(sid){return this._objectClassesBySid.get(sid)||null}GetSingleGlobalObjectClassByCtor(ctor){const plugin=
C3.AddonManager.GetPluginByConstructorFunction(ctor);if(!plugin)return null;return plugin.GetSingleGlobalObjectClass()}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(const objectClass of this._allObjectClasses){if(objectClass.IsFamily())continue;yield*objectClass.instances()}}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();const shouldTime=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();
if(shouldTime)C3Debugger.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(e);if(shouldTime)C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){e.runtime=this.GetIRuntime();return this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(w,h){if(this._originalViewportWidth===w&&this._originalViewportHeight===h)return;this._originalViewportWidth=
w;this._originalViewportHeight=h;const layoutManager=this.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged()}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(w,h){if(this._viewportWidth===w&&this._viewportHeight===h)return;this._viewportWidth=w;this._viewportHeight=h;const layoutManager=this.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged()}_SetDevicePixelRatio(r){if(this.IsExportToVideo())return;
this._devicePixelRatio=r}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){if(!this._canvasManager)return this._viewportWidth;return this._canvasManager.GetDrawWidth()}GetDrawHeight(){if(!this._canvasManager)return this._viewportHeight;return this._canvasManager.GetDrawHeight()}GetRenderScale(){if(!this._canvasManager)return 1;return this._canvasManager.GetRenderScale()}GetDisplayScale(){if(!this._canvasManager)return 1;
return this._canvasManager.GetDisplayScale()}GetEffectLayerScaleParam(){if(!this._canvasManager)return 1;return this._canvasManager.GetEffectLayerScaleParam()}GetEffectDevicePixelRatioParam(){if(!this._canvasManager)return 1;return this._canvasManager.GetEffectDevicePixelRatioParam()}GetCanvasClientX(){if(!this._canvasManager)return 0;return this._canvasManager.GetCanvasClientX()}GetCanvasClientY(){if(!this._canvasManager)return 0;return this._canvasManager.GetCanvasClientY()}GetCanvasCssWidth(){if(!this._canvasManager)return 0;
return this._canvasManager.GetCssWidth()}GetCanvasCssHeight(){if(!this._canvasManager)return 0;return this._canvasManager.GetCssHeight()}GetFullscreenMode(){if(!this._canvasManager)return"off";return this._canvasManager.GetFullscreenMode()}GetAdditionalRenderTarget(opts){if(!this._canvasManager)return null;return this._canvasManager.GetAdditionalRenderTarget(opts)}ReleaseAdditionalRenderTarget(renderTarget){if(!this._canvasManager)return;this._canvasManager.ReleaseAdditionalRenderTarget(renderTarget)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyCrossSampling(){return this._usesAnyCrossSampling}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){if(!this._canvasManager)return NaN;
return this._canvasManager.GetGPUUtilisation()}IsLinearSampling(){return this.GetSampling()!=="nearest"}GetFramerateMode(){return this._framerateMode}_SetFramerateMode(m){if(this._framerateMode===m)return;this._framerateMode=m;if(this._rafId!==-1||this._ruafId!==-1){this._CancelAnimationFrame();this._RequestAnimationFrame()}}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){if(this._loadingLogoAsset){this._loadingLogoAsset.ReleaseTexture();
this._loadingLogoAsset.Release();this._loadingLogoAsset=null}}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetTemplateManager(){return this._templateManager}GetFlowchartManager(){return this._flowchartManager}GetAssetManager(){return this._assetManager}LoadImage(opts){return this._assetManager.LoadImage(opts)}CreateInstance(objectClass,
layer,x,y,createHierarchy,templateName){if(templateName&&this._templateManager){const templateData=this._templateManager.GetTemplateData(objectClass,templateName);if(templateData){const inst=this.CreateInstanceFromData(templateData,layer,false,x,y,false,createHierarchy,undefined,createHierarchy);this._templateManager.MapInstanceToTemplateName(inst,templateName);return inst}}return this.CreateInstanceFromData(objectClass,layer,false,x,y,false,createHierarchy,undefined,createHierarchy)}CreateInstanceFromData(instData_or_objectClass,
layer,isStartupInstance,x,y,skipSiblings,createHierarchy,previousInstance,creatingHierarchy){let instData=null;let objectClass=null;if(instData_or_objectClass instanceof C3.ObjectClass){objectClass=instData_or_objectClass;if(objectClass.IsFamily()){const members=objectClass.GetFamilyMembers();const i=Math.floor(this.Random()*members.length);objectClass=members[i]}instData=objectClass.GetDefaultInstanceData()}else{instData=instData_or_objectClass;objectClass=this.GetObjectClassByIndex(instData[1])}const isWorld=
objectClass.GetPlugin().IsWorldType();if(this._isLoading&&isWorld&&!objectClass.IsOnLoaderLayout())return null;const originalLayer=layer;if(!isWorld)layer=null;let uid;if(isStartupInstance&&!skipSiblings&&instData&&!this._instancesByUid.has(instData[2]))uid=instData[2];else uid=this._nextUid++;const worldData=instData?instData[0]:null;const inst=C3.New(C3.Instance,{runtime:this,objectType:objectClass,layer:layer,worldData,instVarData:instData?instData[3]:null,uid:uid});this._instancesByUid.set(uid,
inst);let wi=null;if(isWorld){wi=inst.GetWorldInfo();if(typeof x!=="undefined"&&typeof y!=="undefined"){wi.SetX(x);wi.SetY(y)}objectClass._SetAnyCollisionCellChanged(true)}if(layer){if(!creatingHierarchy)layer._AddInstance(inst,true);if(layer.GetParallaxX()!==1||layer.GetParallaxY()!==1)objectClass._SetAnyInstanceParallaxed(true);layer.GetLayout().MaybeLoadTexturesFor(objectClass)}this._objectCount++;let needsSiblingCreation=true;if(previousInstance){const previousObjectClass=previousInstance.GetObjectClass();
if(previousObjectClass.IsInContainer()&&objectClass.IsInContainer()){const container=objectClass.GetContainer();const previousContainer=previousObjectClass.GetContainer();if(container===previousContainer)needsSiblingCreation=false}}if(objectClass.IsInContainer()&&!isStartupInstance&&!skipSiblings&&needsSiblingCreation){for(const containerType of objectClass.GetContainer().objectTypes()){if(containerType===objectClass)continue;const siblingInst=this.CreateInstanceFromData(containerType,originalLayer,
false,wi?wi.GetX():x,wi?wi.GetY():y,true,false,undefined,creatingHierarchy);inst._AddSibling(siblingInst)}for(const s of inst.siblings()){s._AddSibling(inst);for(const s2 of inst.siblings())if(s!==s2)s._AddSibling(s2)}}if(isWorld&&!isStartupInstance&&!!createHierarchy)this._CreateChildInstancesFromData(inst,worldData,wi,layer,x,y,creatingHierarchy);if(objectClass.IsInContainer()&&!isStartupInstance&&!skipSiblings&&!!createHierarchy)for(const sibling of inst.siblings()){const swi=sibling.GetWorldInfo();
if(!swi)continue;const siblingPlugin=sibling.GetPlugin();const sWorldData=sibling.GetObjectClass().GetDefaultInstanceData()[0];if(siblingPlugin.IsWorldType())this._CreateChildInstancesFromData(sibling,sWorldData,swi,layer,swi.GetX(),swi.GetY(),creatingHierarchy);else this._CreateChildInstancesFromData(sibling,sWorldData,swi,layer,undefined,undefined,creatingHierarchy)}if(!skipSiblings&&!!createHierarchy){if(typeof x==="undefined")x=worldData[0];if(typeof y==="undefined")y=worldData[1];const pwi=wi.GetTopParent();
const newX=x-wi.GetX()+pwi.GetX();const newY=y-wi.GetY()+pwi.GetY();pwi.SetXY(newX,newY)}objectClass._SetIIDsStale();const instPropertyData=instData?C3.cloneArray(instData[5]):null;const behPropertyData=instData?instData[4].map(bp=>C3.cloneArray(bp)):null;const hasTilemap=isWorld&&worldData&&worldData[13];if(hasTilemap)inst._SetHasTilemap();inst._CreateSdkInstance(instPropertyData,behPropertyData);if(hasTilemap){const tilemapData=worldData[13];inst.GetSdkInstance().LoadTilemapData(tilemapData[2],
tilemapData[0],tilemapData[1])}this._instancesPendingCreate.push(inst);this._hasPendingInstances=true;if(this.IsDebug())C3Debugger.InstanceCreated(inst);return inst}_CreateChildInstancesFromData(parentInstance,parentWorldData,parentWorldInfo,layer,x,y,creatingHierarchy){const parentZIndex=parentWorldInfo.GetSceneGraphZIndexExportData();const childrenData=parentWorldInfo.GetSceneGraphChildrenExportData();parentInstance.GetWorldInfo().SetSceneGraphZIndex(parentZIndex);if(!childrenData)return;if(typeof x===
"undefined")x=parentWorldData[0];if(typeof y==="undefined")y=parentWorldData[1];const sceneGraphSiblings=new Set;const parentX=parentWorldData[0];const parentY=parentWorldData[1];for(const childData of childrenData){const childLayoutSID=childData[0];const childLayerIndex=childData[1];const childUID=childData[2];const childFlags=childData[3];const childIsInContainer=!!childData[4];const childZIndex=childData[5];const uniqueInstanceData=childData[6];let childInstData;if(uniqueInstanceData)childInstData=
uniqueInstanceData;else{const layout=this._layoutManager.GetLayoutBySID(childLayoutSID);const l=layout.GetLayer(childLayerIndex);childInstData=l.GetInitialInstanceData(childUID)}const childObjectClass=this.GetObjectClassByIndex(childInstData[1]);const hasSibling=parentInstance.HasSibling(childObjectClass);const siblingProcessed=sceneGraphSiblings.has(childObjectClass);if(hasSibling&&!siblingProcessed&&childIsInContainer){const childInst=parentInstance.GetSibling(childObjectClass);childInst.GetWorldInfo().Init(childInstData[0]);
const childX=x+childInstData[0][0]-parentX;const childY=y+childInstData[0][1]-parentY;childInst.GetWorldInfo().SetXY(childX,childY);childInst.GetWorldInfo().SetSceneGraphZIndex(childZIndex);parentInstance.AddChild(childInst,{transformX:!!(childFlags>>0&1),transformY:!!(childFlags>>1&1),transformWidth:!!(childFlags>>2&1),transformHeight:!!(childFlags>>3&1),transformAngle:!!(childFlags>>4&1),destroyWithParent:!!(childFlags>>5&1),transformZElevation:!!(childFlags>>6&1),transformOpacity:!!(childFlags>>
7&1),transformVisibility:!!(childFlags>>8&1)});sceneGraphSiblings.add(childObjectClass)}else{const childX=x+childInstData[0][0]-parentX;const childY=y+childInstData[0][1]-parentY;const childInst=this.CreateInstanceFromData(childInstData,layer,false,childX,childY,false,true,parentInstance,creatingHierarchy);childInst.GetWorldInfo().SetSceneGraphZIndex(childZIndex);parentInstance.AddChild(childInst,{transformX:!!(childFlags>>0&1),transformY:!!(childFlags>>1&1),transformWidth:!!(childFlags>>2&1),transformHeight:!!(childFlags>>
3&1),transformAngle:!!(childFlags>>4&1),destroyWithParent:!!(childFlags>>5&1),transformZElevation:!!(childFlags>>6&1),transformOpacity:!!(childFlags>>7&1),transformVisibility:!!(childFlags>>8&1)})}}}DestroyInstance(inst){if(this._instancesPendingRelease.has(inst))return;const objectClass=inst.GetObjectClass();let s=this._instancesPendingDestroy.get(objectClass);if(s){if(s.has(inst))return;s.add(inst)}else{s=new Set;s.add(inst);this._instancesPendingDestroy.set(objectClass,s)}if(this.IsDebug())C3Debugger.InstanceDestroyed(inst);
inst._MarkDestroyed();this._hasPendingInstances=true;if(inst.IsInContainer())for(const s of inst.siblings())this.DestroyInstance(s);for(const c of inst.children())if(c.GetDestroyWithParent())this.DestroyInstance(c);if(!this._layoutManager.IsEndingLayout()&&!this._isLoadingState){const eventSheetManager=this.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnDestroyed();eventSheetManager.BlockFlushingInstances(false)}inst._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}FlushPendingInstances(){if(!this._hasPendingInstances)return;
this._isFlushingPendingInstances=true;this._FlushInstancesPendingCreate();this._FlushInstancesPendingDestroy();this._isFlushingPendingInstances=false;this._hasPendingInstances=false;this.UpdateRender()}_FlushInstancesPendingCreate(){for(const inst of this._instancesPendingCreate){const objectType=inst.GetObjectClass();objectType._AddInstance(inst);for(const family of objectType.GetFamilies()){family._AddInstance(inst);family._SetIIDsStale()}}C3.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(true);
for(const [objectClass,s]of this._instancesPendingDestroy.entries()){this._FlushInstancesPendingDestroyForObjectClass(objectClass,s);s.clear()}this._instancesPendingDestroy.clear();this._dispatcher.SetDelayRemoveEventsEnabled(false)}_FlushInstancesPendingDestroyForObjectClass(objectClass,s){for(const inst of s){const instanceDestroyEvent=this._eventObjects["instancedestroy"];instanceDestroyEvent.instance=inst;this._dispatcher.dispatchEvent(instanceDestroyEvent);this._instancesByUid.delete(inst.GetUID());
this._instanceTimes.delete(inst);const wi=inst.GetWorldInfo();if(wi){wi._RemoveFromCollisionCells();wi._RemoveFromRenderCells();wi._MarkDestroyed()}this._instancesPendingRelease.add(inst);this._objectCount--}C3.arrayRemoveAllInSet(objectClass.GetInstances(),s);objectClass._SetIIDsStale();this._instancesPendingReleaseAffectedObjectClasses.add(objectClass);if(objectClass.GetInstances().length===0)objectClass._SetAnyInstanceParallaxed(false);for(const family of objectClass.GetFamilies()){C3.arrayRemoveAllInSet(family.GetInstances(),
s);family._SetIIDsStale();this._instancesPendingReleaseAffectedObjectClasses.add(family)}if(objectClass.GetPlugin().IsWorldType()){const layers=new Set([...s].map(i=>i.GetWorldInfo().GetLayer()));for(const layer of layers)layer._RemoveAllInstancesInSet(s)}}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(objectClass){for(const inst of this._GetInstancesPendingCreate())if(objectClass.IsFamily()){if(inst.GetObjectClass().BelongsToFamily(objectClass))yield inst}else if(inst.GetObjectClass()===
objectClass)yield inst}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(uid,inst){this._instancesByUid.set(uid,inst)}_OnRendererContextLost(){this._dispatcher.dispatchEvent(C3.New(C3.Event,"renderercontextlost"));this.SetSuspended(true);for(const objectClass of this._allObjectClasses)if(!objectClass.IsFamily()&&objectClass.HasLoadedTextures())objectClass.ReleaseTextures();const runningLayout=this.GetMainRunningLayout();if(runningLayout)runningLayout._OnRendererContextLost();C3.ImageInfo.OnRendererContextLost();
C3.ImageAsset.OnRendererContextLost()}async _OnRendererContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetRenderer());this._dispatcher.dispatchEvent(C3.New(C3.Event,"renderercontextrestored"));this.SetSuspended(false);this.UpdateRender()}_OnVisibilityChange(e){const isHidden=e["hidden"];this.SetSuspended(isHidden);if(!isHidden)this.UpdateRender()}_OnWindowBlur(e){if(!this.IsPreview()||!this._pauseOnBlur||C3.Platform.IsMobile)return;if(!e.data["parentHasFocus"]){this.SetSuspended(true);
this._isPausedOnBlur=true}}_OnWindowFocus(){if(!this._isPausedOnBlur)return;this.SetSuspended(false);this._isPausedOnBlur=false}_RequestAnimationFrame(){const tickCallbacks=this._tickCallbacks;if(this._framerateMode==="vsync"){if(this._rafId===-1)this._rafId=self.requestAnimationFrame(tickCallbacks.normal)}else if(this._framerateMode==="unlimited-tick"){if(this._ruafId===-1)this._ruafId=C3.RequestUnlimitedAnimationFrame(tickCallbacks.tickOnly);if(this._rafId===-1)this._rafId=self.requestAnimationFrame(tickCallbacks.renderOnly)}else if(this._ruafId===
-1)this._ruafId=C3.RequestUnlimitedAnimationFrame(tickCallbacks.normal)}_CancelAnimationFrame(){if(this._rafId!==-1){self.cancelAnimationFrame(this._rafId);this._rafId=-1}if(this._ruafId!==-1){C3.CancelUnlimitedAnimationFrame(this._ruafId);this._ruafId=-1}}IsSuspended(){return this._suspendCount>0}SetSuspended(s){if(this.IsExportToVideo())return;const wasSuspended=this.IsSuspended();this._suspendCount+=s?1:-1;if(this._suspendCount<0)this._suspendCount=0;const isSuspended=this.IsSuspended();if(!wasSuspended&&
isSuspended){console.log("[Construct] Suspending");this._CancelAnimationFrame();this._dispatcher.dispatchEvent(C3.New(C3.Event,"suspend"));this.Trigger(C3.Plugins.System.Cnds.OnSuspend,null,null)}else if(wasSuspended&&!isSuspended){console.log("[Construct] Resuming");const now=performance.now();this._lastTickTime=now;this._fpsLastTime=now;this._fpsFrameCount=0;this._fps=0;this._tpsTickCount=0;this._tps=0;this._mainThreadTime=0;this._mainThreadTimeCounter=0;this._dispatcher.dispatchEvent(C3.New(C3.Event,
"resume"));this.Trigger(C3.Plugins.System.Cnds.OnResume,null,null);if(!this.HitBreakpoint())this.Tick(now)}}_AddBehInstToTick(behSdkInst){this._behInstsToTick.Add(behSdkInst)}_AddBehInstToPostTick(behSdkInst){this._behInstsToPostTick.Add(behSdkInst)}_AddBehInstToTick2(behSdkInst){this._behInstsToTick2.Add(behSdkInst)}_RemoveBehInstToTick(behSdkInst){this._behInstsToTick.Remove(behSdkInst)}_RemoveBehInstToPostTick(behSdkInst){this._behInstsToPostTick.Remove(behSdkInst)}_RemoveBehInstToTick2(behSdkInst){this._behInstsToTick2.Remove(behSdkInst)}_BehaviorTick(){const ISDKBehaviorInstanceBase=
globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(true);for(const bi of this._behInstsToTick)if(bi instanceof ISDKBehaviorInstanceBase)bi._tick();else bi.Tick();this._behInstsToTick.SetQueueingEnabled(false)}_BehaviorPostTick(){const ISDKBehaviorInstanceBase=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(true);for(const bi of this._behInstsToPostTick)if(bi instanceof ISDKBehaviorInstanceBase)bi._postTick();else bi.PostTick();this._behInstsToPostTick.SetQueueingEnabled(false)}_BehaviorTick2(){const ISDKBehaviorInstanceBase=
globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(true);for(const bi of this._behInstsToTick2)if(bi instanceof ISDKBehaviorInstanceBase)bi._tick2();else bi.Tick2();this._behInstsToTick2.SetQueueingEnabled(false)}*_DebugBehaviorTick(){const ISDKBehaviorInstanceBase=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(true);for(const bi of this._behInstsToTick){let ret;if(bi instanceof ISDKBehaviorInstanceBase)ret=bi._tick();else ret=bi.Tick();if(C3.IsIterator(ret))yield*ret}this._behInstsToTick.SetQueueingEnabled(false)}*_DebugBehaviorPostTick(){const ISDKBehaviorInstanceBase=
globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(true);for(const bi of this._behInstsToPostTick){let ret;if(bi instanceof ISDKBehaviorInstanceBase)ret=bi._postTick();else ret=bi.PostTick();if(C3.IsIterator(ret))yield*ret}this._behInstsToPostTick.SetQueueingEnabled(false)}*_DebugBehaviorTick2(){const ISDKBehaviorInstanceBase=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(true);for(const bi of this._behInstsToTick2){let ret;if(bi instanceof
ISDKBehaviorInstanceBase)ret=bi._tick2();else ret=bi.Tick2();if(C3.IsIterator(ret))yield*ret}this._behInstsToTick2.SetQueueingEnabled(false)}async Tick(timestamp,isDebugStep,mode){this._hasStartedTicking=true;const isBackgroundWake=mode==="background-wake";const shouldRender=mode!=="background-wake"&&mode!=="skip-render";const layoutManager=this.GetLayoutManager();const canvasManager=this.GetCanvasManager();if(!this._hasStarted||this.IsSuspended()&&!isDebugStep&&!isBackgroundWake)return;const startTime=
performance.now();this._isInTick=true;this._MeasureDt(timestamp||0);this._tpsTickCount++;this._ReleasePendingInstances();const beforePreTickRet=this.Step_BeforePreTick();if(this.IsDebugging())await beforePreTickRet;const pretickRet=this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects["pretick"]);if(pretickRet instanceof Promise)await pretickRet;const afterPreTickRet=this.Step_AfterPreTick();if(this.IsDebugging())await afterPreTickRet;if(this._NeedsHandleSaveOrLoad())await this._HandleSaveOrLoad();
if(layoutManager.IsPendingChangeMainLayout())await this._MaybeChangeLayout();const runEventsRet=this.Step_RunEventsEtc();if(this.IsDebugging())await runEventsRet;const layout=layoutManager.GetMainRunningLayout();const pendingSetHTMLLayerCount=layout._GetPendingSetHTMLLayerCount();let needCleanUpHTMLLayers=false;if(pendingSetHTMLLayerCount!==-1){layout._ResetPendingHTMLLayerCount();if(canvasManager.GetHTMLLayerCount()!==pendingSetHTMLLayerCount){const updatePromise=this.GetCanvasManager().SetHTMLLayerCount(pendingSetHTMLLayerCount);
if(this.IsInWorker()){needCleanUpHTMLLayers=true;await updatePromise}}}if(shouldRender)this.Render();if(needCleanUpHTMLLayers)this.PostComponentMessageToDOM("canvas","cleanup-html-layers");if(this.IsExportToVideo()){await this._ExportToVideoAddFrame();if(this.GetGameTime()>=this.GetExportVideoDuration()){this._ExportToVideoFinish();return}}if(!this.IsSuspended()&&!isBackgroundWake)this._RequestAnimationFrame();this._tickCount++;this._tickCountNoSave++;this._isInTick=false;this._mainThreadTimeCounter+=
performance.now()-startTime}async Step_BeforePreTick(){const eventSheetManager=this._eventSheetManager;const isDebug=this.IsDebug();this.FlushPendingInstances();eventSheetManager.BlockFlushingInstances(true);this.PushCurrentLayout(this.GetMainRunningLayout());if(isDebug)C3Debugger.StartMeasuringTime();if(this.IsDebugging())await eventSheetManager.DebugRunScheduledWaits();else eventSheetManager.RunScheduledWaits();if(isDebug)C3Debugger.AddEventsTime();this.PopCurrentLayout();eventSheetManager.BlockFlushingInstances(false);
this.FlushPendingInstances();eventSheetManager.BlockFlushingInstances(true)}async Step_AfterPreTick(){const isDebug=this.IsDebug();const isDebugging=this.IsDebugging();const dispatcher=this._dispatcher;const eventObjects=this._eventObjects;const userScriptEventObjects=this._userScriptEventObjects;if(isDebug)C3Debugger.StartMeasuringTime();if(isDebugging)await this.DebugIterateAndBreak(this._DebugBehaviorTick());else this._BehaviorTick();if(isDebugging)await this.DebugIterateAndBreak(this._DebugBehaviorPostTick());
else this._BehaviorPostTick();if(isDebug)C3Debugger.AddBehaviorTickTime();if(isDebug)C3Debugger.StartMeasuringTime();if(isDebugging)await this.DebugFireGeneratorEventAndBreak(eventObjects["tick"]);else dispatcher.dispatchEvent(eventObjects["tick"]);if(isDebug)C3Debugger.AddPluginTickTime();this._eventSheetManager.BlockFlushingInstances(false);this.DispatchUserScriptEvent(userScriptEventObjects["tick"])}async Step_RunEventsEtc(){const eventSheetManager=this._eventSheetManager;const dispatcher=this._dispatcher;
const eventObjects=this._eventObjects;const isDebug=this.IsDebug();const isDebugging=this.IsDebugging();if(isDebug)C3Debugger.StartMeasuringTime();if(isDebugging)await eventSheetManager.DebugRunEvents(this._layoutManager);else eventSheetManager.RunEvents(this._layoutManager);if(isDebug)C3Debugger.AddEventsTime();this._collisionEngine.ClearRegisteredCollisions();this._ReleasePendingInstances();this._isLayoutFirstTick=false;eventSheetManager.BlockFlushingInstances(true);if(isDebug)C3Debugger.StartMeasuringTime();
if(isDebugging)await this.DebugIterateAndBreak(this._DebugBehaviorTick2());else this._BehaviorTick2();if(isDebug)C3Debugger.AddBehaviorTickTime();if(isDebug)C3Debugger.StartMeasuringTime();if(isDebugging)await this.DebugFireGeneratorEventAndBreak(eventObjects["tick2"]);else dispatcher.dispatchEvent(eventObjects["tick2"]);if(isDebug)C3Debugger.AddPluginTickTime();eventSheetManager.BlockFlushingInstances(false);if(isDebugging)await eventSheetManager.RunQueuedDebugTriggersAsync()}_ReleasePendingInstances(){if(this._instancesPendingRelease.size===
0)return;const dispatcher=this._dispatcher;dispatcher.SetDelayRemoveEventsEnabled(true);for(const objectClass of this._instancesPendingReleaseAffectedObjectClasses)objectClass.GetSolStack().RemoveInstances(this._instancesPendingRelease);this._instancesPendingReleaseAffectedObjectClasses.clear();this._eventSheetManager.RemoveInstancesFromScheduledWaits(this._instancesPendingRelease);for(const inst of this._instancesPendingRelease)inst.Release();this._instancesPendingRelease.clear();dispatcher.SetDelayRemoveEventsEnabled(false)}async _MaybeChangeLayout(){const layoutManager=
this.GetLayoutManager();let i=0;while(layoutManager.IsPendingChangeMainLayout()&&i++<10)await this._DoChangeLayout(layoutManager.GetPendingChangeMainLayout())}_MeasureDt(timestamp){let dtRaw=0;if(this.IsExportToVideo()){dtRaw=1/this.GetExportVideoFramerate();this._dtRaw=dtRaw;this._dt1=dtRaw}else if(this._lastTickTime!==0){const msDiff=Math.max(timestamp-this._lastTickTime,0);dtRaw=msDiff/1E3;if(dtRaw>.5)dtRaw=0;this._dtRaw=dtRaw;this._dt1=C3.clamp(dtRaw,this._minDt,this._maxDt)}this._lastTickTime=
timestamp;this._dt=this._dt1*this._timeScale;this._gameTime.Add(this._dt);this._gameTimeRaw.Add(dtRaw*this._timeScale);this._wallTime.Add(this._dt1);for(const [inst,instTime]of this._instanceTimes)instTime.Add(this._dt1*inst.GetTimeScale());if(this._canvasManager)this._canvasManager._UpdateTick();if(timestamp-this._fpsLastTime>=1E3){this._fpsLastTime+=1E3;if(timestamp-this._fpsLastTime>=1E3)this._fpsLastTime=timestamp;this._fps=this._fpsFrameCount;this._fpsFrameCount=0;this._tps=this._tpsTickCount;
this._tpsTickCount=0;this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1E3,1);this._mainThreadTimeCounter=0;if(this._canvasManager)this._canvasManager._Update1sFrameRange();this._collisionEngine._Update1sStats();if(this.IsDebug())C3Debugger.Update1sPerfStats()}}_SetTrackingInstanceTime(inst,enable){if(enable){if(!this._instanceTimes.has(inst)){const instTime=C3.New(C3.KahanSum);instTime.Copy(this._gameTime);this._instanceTimes.set(inst,instTime)}}else this._instanceTimes.delete(inst)}_GetInstanceGameTime(inst){const instTime=
this._instanceTimes.get(inst);return instTime?instTime.Get():this.GetGameTime()}async _DoChangeLayout(changeToLayout){const dispatcher=this._dispatcher;const layoutManager=this.GetLayoutManager();const prevLayout=layoutManager.GetMainRunningLayout();await prevLayout._StopRunning();prevLayout._Unload(changeToLayout,this.GetRenderer());if(prevLayout===changeToLayout)this._eventSheetManager.ClearAllScheduledWaits();this._collisionEngine.ClearRegisteredCollisions();this._ReleasePendingInstances();dispatcher.dispatchEvent(this._eventObjects["beforelayoutchange"]);
C3.Asyncify.SetHighThroughputMode(true);await changeToLayout._Load(prevLayout,this.GetRenderer());C3.Asyncify.SetHighThroughputMode(false);await changeToLayout._StartRunning(false);dispatcher.dispatchEvent(this._eventObjects["layoutchange"]);this.UpdateRender();this._isLayoutFirstTick=true;this.FlushPendingInstances();this._ExportToVideoAddKeyframe()}UpdateRender(){this._needRender=true}GetWebGLRenderer(){if(!this._canvasManager)return null;return this._canvasManager.GetWebGLRenderer()}GetWebGPURenderer(){if(!this._canvasManager)return null;
return this._canvasManager.GetWebGPURenderer()}GetRenderer(){if(!this._canvasManager)return null;return this._canvasManager.GetRenderer()}Render(){const canvasManager=this._canvasManager;if(!canvasManager||canvasManager.IsRendererContextLost())return;const renderer=this.GetRenderer();const supportsGPUProfiling=renderer.SupportsGPUProfiling();const isWebGLProfiling=supportsGPUProfiling&&renderer.IsWebGL();const isWebGPUProfiling=supportsGPUProfiling&&renderer.IsWebGPU();if(isWebGLProfiling)renderer.CheckForQueryResults();
if(!this._needRender&&!this.IsExportToVideo()){renderer.IncrementFrameNumber();return}const layout=this._layoutManager.GetMainRunningLayout();this._fpsFrameCount++;renderer.Start();const isDebug=this.IsDebug();if(isDebug)C3Debugger.StartMeasuringTime();this._needRender=false;let webglFrameQuery=null;if(isWebGLProfiling){webglFrameQuery=canvasManager.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery();renderer.StartQuery(webglFrameQuery)}let webgpuFrameTimings=null;if(isWebGPUProfiling){webgpuFrameTimings=
renderer.StartFrameTiming((1+layout.GetLayerCount())*2);renderer.StartMeasuringRenderPassTime(0,1)}if(this.Uses3DFeatures()&&canvasManager.GetCurrentFullscreenScalingQuality()==="low")renderer.SetFixedSizeDepthBuffer(canvasManager.GetDrawWidth(),canvasManager.GetDrawHeight());else renderer.SetAutoSizeDepthBuffer();this._Render(this.GetRenderer(),layout);if(webglFrameQuery)renderer.EndQuery(webglFrameQuery);if(isWebGPUProfiling){renderer.StopMeasuringRenderPassTime();this._canvasManager._AddWebGPUFrameTiming(webgpuFrameTimings)}renderer.Finish();
if(isDebug){C3Debugger.AddDrawCallsTime();C3Debugger.UpdateInspectHighlight()}if(canvasManager)canvasManager._MaybeTakeSnapshot()}_NeedsHTMLLayerCompositing(renderer){return this.GetCanvasManager().GetCurrentFullscreenScalingQuality()==="low"||renderer.IsWebGL()&&(this.UsesAnyBackgroundBlending()||this.Uses3DFeatures())}_Render(renderer,layout){renderer.SetTextureFillMode();renderer.SetAlphaBlend();renderer.SetColorRgba(1,1,1,1);renderer.SetRenderTarget(null);renderer.SetTexture(null);renderer.SetDepthEnabled(this.Uses3DFeatures());
if(this._NeedsHTMLLayerCompositing(renderer))layout._MaybeStartDrawToOwnTexture(renderer);const htmlLayerCount=layout.GetHTMLLayerCount();for(let i=1;i<htmlLayerCount;++i){layout.DrawForHTMLLayerIndex(renderer,i);if(renderer.IsWebGPU())renderer.Restart()}if(!this._NeedsHTMLLayerCompositing(renderer))layout._MaybeStartDrawToOwnTexture(renderer);layout.DrawMain(renderer)}Trigger(method,inst,behaviorType){if(!this._hasStarted)return false;const isTopLevel=!this._isInTick&&!this._eventSheetManager.IsInTrigger();
let startTime=0;if(isTopLevel)startTime=performance.now();const isDebug=this.IsDebug();if(isDebug)this.SetDebuggingEnabled(false);const ret=this._eventSheetManager._Trigger(this._layoutManager,method,inst,behaviorType);if(isTopLevel){const triggerTime=performance.now()-startTime;this._mainThreadTimeCounter+=triggerTime;if(isDebug)C3Debugger.AddTriggersTime(triggerTime)}if(isDebug)this.SetDebuggingEnabled(true);return ret}DebugTrigger(method,inst,behaviorType){if(!this.IsDebugging())return this.Trigger(method,
inst,behaviorType);if(this.HitBreakpoint())throw new Error("called DebugTrigger() while stopped on breakpoint");if(!this._isInTick&&!this._eventSheetManager.IsInTrigger())throw new Error("called DebugTrigger() outside of event code - use TriggerAsync() instead");return this._eventSheetManager._DebugTrigger(this._layoutManager,method,inst,behaviorType)}async TriggerAsync(method,inst,behaviorType){if(!this.IsDebugging())return this.Trigger(method,inst,behaviorType);if(!this._hasStarted)return false;
if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(method,inst,behaviorType);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(method,inst,behaviorType);const startTime=performance.now();const iter=this._eventSheetManager._DebugTrigger(this._layoutManager,method,inst,behaviorType);let result=iter.next();while(!result.done){await this.DebugBreak(result.value);result=iter.next()}if(!this.IsSuspended()&&!this._eventSheetManager.IsInTrigger()){await this._eventSheetManager.RunQueuedDebugTriggersAsync();
if(this._hasStartedTicking&&!this._isInTick)this._RequestAnimationFrame()}this._mainThreadTimeCounter+=performance.now()-startTime;return result.value}FastTrigger(method,inst,value){const isDebug=this.IsDebug();if(isDebug)this.SetDebuggingEnabled(false);const ret=this._eventSheetManager._FastTrigger(this._layoutManager,method,inst,value);if(isDebug)this.SetDebuggingEnabled(true);return ret}DebugFastTrigger(method,inst,value){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,method,
inst,value)}ScheduleTriggers(f){return this._scheduleTriggersThrottle.Add(f)}PushCurrentLayout(layout){this._currentLayoutStack.push(layout)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw new Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){if(!this._currentLayoutStack.length)return this.GetMainRunningLayout();return this._currentLayoutStack.at(-1)}GetDt(inst){if(!inst||inst.GetTimeScale()===-1)return this._dt;return this._dt1*inst.GetTimeScale()}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetDtRaw(){return this._dtRaw}GetTimeScale(){return this._timeScale}SetTimeScale(ts){if(isNaN(ts)||
ts<0)ts=0;this._timeScale=ts}SetMinDt(dt){this._minDt=Math.max(dt,0)}GetMinDt(){return this._minDt}SetMaxDt(dt){this._maxDt=Math.max(dt,0)}GetMaxDt(){return this._maxDt}GetFramesPerSecond(){return this._fps}GetTicksPerSecond(){return this._tps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(uid){if(this._isLoadingState)throw new Error("cannot call while loading state - wait until afterload event");
return this._instancesByUid.get(uid)||null}_RefreshUidMap(){this._instancesByUid.clear();for(const objectClass of this._allObjectClasses){if(objectClass.IsFamily())continue;for(const inst of objectClass.GetInstances())this._instancesByUid.set(inst.GetUID(),inst)}}IsPreview(){return this._exportType==="preview"}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsCordova(){return this._exportType==="cordova"}IsAndroidWebView(){return C3.Platform.OS==="Android"&&(this._exportType===
"cordova"||this._exportType==="playable-ad"||this._exportType==="instant-games")}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}IsWindowsWebView2(){return this._isWindowsWebView2}IsAnyWebView2Wrapper(){return this._isAnyWebView2Wrapper}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._addonManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._addonManager.GetJumpthruBehavior()}Uses3DFeatures(){return this._uses3dFeatures}GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight())}GetDefaultCameraZ(viewH){return this.GetRenderer().GetDefaultCameraZ(viewH||
this.GetViewportHeight())}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(e){e=!!e;if(this._isPixelRoundingEnabled===e)return;this._isPixelRoundingEnabled=e;this.GetLayoutManager().SetAllLayerMVChanged();this.UpdateRender()}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}GetTextIconSet(iconSource){if(!this._iconChangeHandlers.has(iconSource)){const changeHandler=()=>this.DeleteTextIconSet(iconSource);this._iconChangeHandlers.set(iconSource,changeHandler);iconSource.Dispatcher().addEventListener("animationframeimagechange",
changeHandler)}const iconSet=this._textIconManager.GetIconSet(iconSource);if(!iconSet.HasLoaded())iconSet.LoadContent().then(()=>this.UpdateRender());return iconSet}DeleteTextIconSet(iconSource){this._textIconManager.DeleteIconSet(iconSource)}_GetTextIconSetMeta(iconSource){const icons=[];for(const animation of iconSource.GetAnimations())for(const frame of animation.GetFrames()){const imageInfo=frame.GetImageInfo();icons.push({source:frame,width:imageInfo.GetWidth(),height:imageInfo.GetHeight(),tag:frame.GetTag()})}return{icons}}async _GetTextIconSetContent(iconSource){const promiseThrottle=
C3.New(C3.PromiseThrottle);const assetDrawablePromises=[];const assetDrawableMap=new Map;for(const animation of iconSource.GetAnimations())for(const frame of animation.GetFrames()){const imageAsset=frame.GetImageInfo().GetImageAsset();if(assetDrawableMap.has(imageAsset))continue;assetDrawableMap.set(imageAsset,null);assetDrawablePromises.push(promiseThrottle.Add(async()=>{const drawable=await imageAsset.LoadToDrawable();assetDrawableMap.set(imageAsset,drawable)}))}await Promise.all(assetDrawablePromises);
const extractPromises=[];for(const animation of iconSource.GetAnimations())for(const frame of animation.GetFrames())extractPromises.push(promiseThrottle.Add(async()=>{const imageInfo=frame.GetImageInfo();const imageAssetDrawable=assetDrawableMap.get(imageInfo.GetImageAsset());const canvas=await imageInfo.ExtractImageToCanvas(imageAssetDrawable);const imageBitmap=await createImageBitmap(canvas);return{drawable:imageBitmap}}));const iconsArr=await Promise.all(extractPromises);for(const drawable of assetDrawableMap.values())if(drawable instanceof
ImageBitmap&&drawable["close"])drawable["close"]();return{icons:iconsArr}}SaveToSlot(slotName){this._saveToSlotName=slotName}LoadFromSlot(slotName){this._loadFromSlotName=slotName}LoadFromJsonString(str){this._loadFromJson=str}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!!(this._saveToSlotName||this._loadFromSlotName||this._loadFromJson!==null)}async _HandleSaveOrLoad(){if(this._saveToSlotName){this.FlushPendingInstances();await this._DoSaveToSlot(this._saveToSlotName);
this._ClearSaveOrLoad()}if(this._loadFromSlotName){await this._DoLoadFromSlot(this._loadFromSlotName);this._ClearSaveOrLoad();if(this.IsDebug())C3Debugger.StepIfPausedInDebugger()}if(this._loadFromJson!==null){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson);this._lastSaveJson=this._loadFromJson;await this.TriggerAsync(C3.Plugins.System.Cnds.OnLoadComplete,null);this._lastSaveJson=""}catch(err){console.error("[Construct] Failed to load state from JSON string: ",
err);await this.TriggerAsync(C3.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._saveToSlotName="";this._loadFromSlotName="";this._loadFromJson=null}_GetProjectStorage(){if(!this._projectStorage)this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()});return this._projectStorage}_GetSavegamesStorage(){if(!this._savegamesStorage)this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+
this.GetProjectUniqueId(),description:this.GetProjectName()});return this._savegamesStorage}async _DoSaveToSlot(slotName){const saveJson=await this._SaveToJsonString();try{await this._GetSavegamesStorage().setItem(slotName,saveJson);console.log("[Construct] Saved state to storage ("+saveJson.length+" chars)");this._lastSaveJson=saveJson;await this.TriggerAsync(C3.Plugins.System.Cnds.OnSaveComplete,null);this._lastSaveJson=""}catch(err){console.error("[Construct] Failed to save state to storage: ",
err);await this.TriggerAsync(C3.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(slotName){try{const loadJson=await this._GetSavegamesStorage().getItem(slotName);if(!loadJson)throw new Error("empty slot");console.log("[Construct] Loaded state from storage ("+loadJson.length+" chars)");await this._DoLoadFromJsonString(loadJson);this._lastSaveJson=loadJson;await this.TriggerAsync(C3.Plugins.System.Cnds.OnLoadComplete,null);this._lastSaveJson=""}catch(err){console.error("[Construct] Failed to load state from storage: ",
err);await this.TriggerAsync(C3.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){const o={"c3save":true,"version":1,"rt":{"time":this.GetGameTime(),"timeRaw":this.GetGameTimeRaw(),"walltime":this.GetWallTime(),"timescale":this.GetTimeScale(),"tickcount":this.GetTickCount(),"next_uid":this._nextUid,"running_layout":this.GetMainRunningLayout().GetSID(),"start_time_offset":Date.now()-this._startTime},"types":{},"layouts":{},"events":this._eventSheetManager._SaveToJson(),"timelines":this._timelineManager._SaveToJson(),
"user_script_data":null};for(const objectClass of this._allObjectClasses){if(objectClass.IsFamily()||objectClass.HasNoSaveBehavior())continue;o["types"][objectClass.GetSID().toString()]=objectClass._SaveToJson()}for(const layout of this._layoutManager.GetAllLayouts())o["layouts"][layout.GetSID().toString()]=layout._SaveToJson();const saveEvent=this._CreateUserScriptEvent("save");saveEvent.saveData=null;await this.DispatchUserScriptEventAsyncWait(saveEvent);o["user_script_data"]=saveEvent.saveData;
return JSON.stringify(o)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(jsonStr){const layoutManager=this.GetLayoutManager();const o=JSON.parse(jsonStr);if(o["c2save"])throw new Error("C2 saves are incompatible with C3 runtime");if(!o["c3save"])throw new Error("not valid C3 save data");if(o["version"]>1)throw new Error("C3 save data from future version");this.ClearIntancesNeedingAfterLoad();this._dispatcher.dispatchEvent(C3.New(C3.Event,"beforeload"));for(const inst of this.allInstances()){const objectClass=
inst.GetObjectClass();if(objectClass.HasNoSaveBehavior())continue;inst._OnBeforeLoad()}const rt=o["rt"];this._gameTime.Set(rt["time"]);if(rt.hasOwnProperty("timeRaw"))this._gameTimeRaw.Set(rt["timeRaw"]);this._wallTime.Set(rt["walltime"]);this._timeScale=rt["timescale"];this._tickCount=rt["tickcount"];this._startTime=Date.now()-rt["start_time_offset"];const layoutSid=rt["running_layout"];this._isLoadingState=true;let changedLayout=false;if(layoutSid!==this.GetMainRunningLayout().GetSID()){const changeToLayout=
layoutManager.GetLayoutBySID(layoutSid);if(changeToLayout){await this._DoChangeLayout(changeToLayout);changedLayout=true}else return}for(const [sidStr,data]of Object.entries(o["layouts"])){const sid=parseInt(sidStr,10);const layout=layoutManager.GetLayoutBySID(sid);if(!layout)continue;layout._LoadFromJson(data)}for(const [sidStr,data]of Object.entries(o["types"])){const sid=parseInt(sidStr,10);const objectClass=this.GetObjectClassBySID(sid);if(!objectClass||objectClass.IsFamily()||objectClass.HasNoSaveBehavior())continue;
objectClass._LoadFromJson(data)}for(const layout of this._layoutManager.GetAllLayouts())for(const layer of layout.allLayers())layer._LoadFromJsonAfterInstances();this.FlushPendingInstances();this._RefreshUidMap();this._isLoadingState=false;if(changedLayout){for(const inst of this.allInstances())inst.SetupInitialSceneGraphConnections();for(const [sidStr,data]of Object.entries(o["types"])){const sid=parseInt(sidStr,10);const objectClass=this.GetObjectClassBySID(sid);if(!objectClass||objectClass.IsFamily()||
objectClass.HasNoSaveBehavior())continue;objectClass._SetupSceneGraphConnectionsOnChangeOfLayout(data)}}this._nextUid=rt["next_uid"];this._eventSheetManager._LoadFromJson(o["events"]);for(const objectClass of this._allObjectClasses){if(objectClass.IsFamily()||!objectClass.IsInContainer())continue;for(const inst of objectClass.GetInstances()){const iid=inst.GetIID();for(const otherType of objectClass.GetContainer().objectTypes()){if(otherType===objectClass)continue;const otherInstances=otherType.GetInstances();
if(iid<0||iid>=otherInstances.length)throw new Error("missing sibling instance");inst._AddSibling(otherInstances[iid])}}}this._timelineManager._LoadFromJson(o["timelines"]);layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();this._dispatcher.dispatchEvent(C3.New(C3.Event,"afterload"));this.DispatchUserScriptEvent(this._CreateUserScriptEvent("afterload"));this.DoAfterLoad();for(const [sidStr,data]of Object.entries(o["types"])){const sid=parseInt(sidStr,10);const objectClass=
this.GetObjectClassBySID(sid);if(objectClass)objectClass._ClearLoadInstancesJson()}const loadEvent=this._CreateUserScriptEvent("load");loadEvent.saveData=o["user_script_data"];await this.DispatchUserScriptEventAsyncWait(loadEvent);this.UpdateRender()}SortOnTmpHierarchyPosition(f,s){return f.GetWorldInfo().GetTmpHierarchyPosition()-s.GetWorldInfo().GetTmpHierarchyPosition()}AddInstanceNeedingAfterLoad(inst,data){if(!inst.GetWorldInfo())return;this._instancesNeedingAfterLoadMap.set(inst,data);this._instancesNeedingAfterLoadArray.push(inst)}ClearIntancesNeedingAfterLoad(){this._instancesNeedingAfterLoadMap=
new WeakMap;C3.clearArray(this._instancesNeedingAfterLoadArray)}DoAfterLoad(mode="full",opts=null){this._instancesNeedingAfterLoadArray.sort(this.SortOnTmpHierarchyPosition);for(const wi of this._instancesNeedingAfterLoadArray)wi._OnAfterLoad(this._instancesNeedingAfterLoadMap.get(wi),mode,opts);for(const wi of this._instancesNeedingAfterLoadArray)wi._OnAfterLoad2(this._instancesNeedingAfterLoadMap.get(wi),mode,opts);this.ClearIntancesNeedingAfterLoad()}async AddJobWorkerScripts(scripts){const loadUrls=
await Promise.all(scripts.map(async url=>{const isCrossOrigin=C3.IsAbsoluteURL(url)&&(new URL(url)).origin!==location.origin;const isCordovaFileProtocol=this.IsCordova()&&this._assetManager.IsFileProtocol();if(isCrossOrigin||isCordovaFileProtocol||this.IsPreview()||this.GetExportType()==="playable-ad"){const blob=await this._assetManager.FetchBlob(url);return URL.createObjectURL(blob)}else if(C3.IsRelativeURL(url))return(new URL(url,this._runtimeBaseUrl)).toString();else return url}));this._jobScheduler.ImportScriptsToJobWorkers(loadUrls)}AddJobWorkerBlob(blob,
id){this._jobScheduler.SendBlobToJobWorkers(blob,id)}AddJobWorkerBuffer(buffer,id){this._jobScheduler.SendBufferToJobWorkers(buffer,id)}AddJob(type,params,transferables,maxWorkerNum){return this._jobScheduler.AddJob(type,params,transferables,null,null,maxWorkerNum)}BroadcastJob(type,params,transferables,maxWorkerNum){return this._jobScheduler.BroadcastJob(type,params,transferables,maxWorkerNum)}GetMaxNumJobWorkers(){return this._jobScheduler.GetMaxNumWorkers()}InvokeDownload(url,filename){this.PostComponentMessageToDOM("runtime",
"invoke-download",{"url":url,"filename":filename})}async RasterSvgImage(blob,imageWidth,imageHeight,surfaceWidth,surfaceHeight,imageBitmapOpts){surfaceWidth=surfaceWidth||imageWidth;surfaceHeight=surfaceHeight||imageHeight;if(this.IsInWorker()){const result=await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{"blob":blob,"imageWidth":imageWidth,"imageHeight":imageHeight,"surfaceWidth":surfaceWidth,"surfaceHeight":surfaceHeight,"imageBitmapOpts":imageBitmapOpts});return result["imageBitmap"]}else{const canvas=
await self["C3_RasterSvgImageBlob"](blob,imageWidth,imageHeight,surfaceWidth,surfaceHeight);if(imageBitmapOpts)return await self.createImageBitmap(canvas,imageBitmapOpts);else return canvas}}async GetSvgImageSize(blob){if(this.IsInWorker())return await this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{"blob":blob});else return await self["C3_GetSvgImageSize"](blob)}RequestDeviceOrientationEvent(){if(this._didRequestDeviceOrientationEvent)return;this._didRequestDeviceOrientationEvent=
true;this.PostComponentMessageToDOM("runtime","enable-device-orientation")}RequestDeviceMotionEvent(){if(this._didRequestDeviceMotionEvent)return;this._didRequestDeviceMotionEvent=true;this.PostComponentMessageToDOM("runtime","enable-device-motion")}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(f){this._randomNumberCallback=f}_GetRemotePreviewStatusInfo(){const renderer=this.GetRenderer();return{"fps":this.GetFramesPerSecond(),"tps":this.GetTicksPerSecond(),"cpu":this.GetMainThreadTime(),
"gpu":this.GetGPUUtilisation(),"layout":this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"","renderer":renderer.IsWebGL()?renderer.GetUnmaskedRenderer():renderer.GetAdapterInfoString()}}HitBreakpoint(){if(!this.IsDebug())return false;return C3Debugger.HitBreakpoint()}DebugBreak(eventObject){if(!this.IsDebugging())return Promise.resolve();return C3Debugger.DebugBreak(eventObject)}DebugBreakNext(){if(!this.IsDebugging())return false;return C3Debugger.BreakNext()}SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=
!!e;this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(d){if(d)this._debuggingDisabled--;else this._debuggingDisabled++;this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&this._debuggingDisabled===0}IsCPUProfiling(){return this.IsDebug()&&C3Debugger.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&
C3Debugger.IsGPUProfiling()}async DebugIterateAndBreak(iter){if(!iter)return;for(const breakEventObject of iter)await this.DebugBreak(breakEventObject)}DebugFireGeneratorEventAndBreak(event){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(event))}_InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e["name"],e["params"])}_GetHTMLLayerWrapElement(index){if(this.IsInWorker())throw new Error("not supported in worker mode");return self["c3_runtimeInterface"]["_GetHTMLWrapElement"](index)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(name){const e=
C3.New(C3.Event,name,false);e.runtime=this._iRuntime;return e}_InitScriptInterfaces(){this._iRuntime=new self.IRuntime(this);this._userScriptEventObjects={"tick":this._CreateUserScriptEvent("tick")}}_InitObjectsScriptInterface(){const objectDescriptors={};for(const objectClass of this._allObjectClasses)objectDescriptors[objectClass.GetJsPropName()]={value:objectClass.GetIObjectClass(),enumerable:true,writable:false};this._iRuntime._InitObjects(objectDescriptors)}_InitGlobalVariableScriptInterface(){const globalVarDescriptors=
{};for(const globalVar of this.GetEventSheetManager().GetAllGlobalVariables())globalVarDescriptors[globalVar.GetJsPropName()]=globalVar._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(globalVarDescriptors)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(interface_,class_){this._interfaceMap.set(interface_,class_)}_UnwrapScriptInterface(interface_){return this._interfaceMap.get(interface_)}_UnwrapIObjectClass(iObjectClass){if(!(iObjectClass instanceof
self.IObjectClass))throw new TypeError("expected IObjectClass");const objectClass=this._UnwrapScriptInterface(iObjectClass);if(!objectClass||!(objectClass instanceof C3.ObjectClass))throw new Error("invalid IObjectClass");return objectClass}_UnwrapIInstance(iinst){if(!(iinst instanceof self.IInstance))throw new TypeError("expected IInstance");const inst=this._UnwrapScriptInterface(iinst);if(!inst||!(inst instanceof C3.Instance))throw new Error("invalid IInstance");return inst}_UnwrapIWorldInstance(iinst){if(!(iinst instanceof
self.IWorldInstance))throw new TypeError("expected IWorldInstance");const inst=this._UnwrapScriptInterface(iinst);if(!inst||!(inst instanceof C3.Instance))throw new Error("invalid IInstance");return inst}};self["C3_CreateRuntime"]=C3.Runtime.Create;self["C3_InitRuntime"]=(runtime,opts)=>runtime.Init(opts);

}

// workers/jobSchedulerRuntime.js
{
'use strict';const C3=self.C3;
C3.JobSchedulerRuntime=class JobSchedulerRuntime extends C3.DefendedBase{constructor(runtime,data){super();this._runtime=runtime;this._jobPromises=new Map;this._nextJobId=0;this._inputPort=data["inputPort"];data["outputPort"].onmessage=e=>this._OnJobWorkerMessage(e);this._maxNumWorkers=data["maxNumWorkers"];this._jobWorkerCount=1;this._isCreatingWorker=false;this._hadErrorCreatingWorker=false}async Init(){}GetMaxNumWorkers(){return this._maxNumWorkers}ImportScriptsToJobWorkers(scripts){this._inputPort.postMessage({"type":"_import_scripts","scripts":scripts})}SendBlobToJobWorkers(blob,
id){this._inputPort.postMessage({"type":"_send_blob","blob":blob,"id":id})}SendBufferToJobWorkers(buffer,id){this._inputPort.postMessage({"type":"_send_buffer","buffer":buffer,"id":id},[buffer])}AddJob(type,params,transferables,progressHandler,abortDisposable,maxWorkerNum){if(!transferables)transferables=[];if(typeof maxWorkerNum==="number"){maxWorkerNum=Math.floor(maxWorkerNum);if(maxWorkerNum<=0)throw new Error("invalid maxWorkerNum");}const jobId=this._nextJobId++;const job={"type":type,"isBroadcast":false,
"maxWorkerNum":maxWorkerNum,"jobId":jobId,"params":params,"transferables":transferables};const promise=new Promise((resolve,reject)=>{this._jobPromises.set(jobId,{resolve:resolve,progress:progressHandler,reject:reject,cancelled:false,maxWorkerNum})});if(abortDisposable)abortDisposable.SetAction(()=>this._CancelJob(jobId));this._inputPort.postMessage(job,transferables);this._MaybeCreateExtraWorker();return promise}BroadcastJob(type,params,transferables,maxWorkerNum){if(!transferables)transferables=
[];if(typeof maxWorkerNum==="number"){maxWorkerNum=Math.floor(maxWorkerNum);if(maxWorkerNum<=0)throw new Error("invalid maxWorkerNum");}const jobId=this._nextJobId++;const job={"type":type,"isBroadcast":true,"maxWorkerNum":maxWorkerNum,"jobId":jobId,"params":params,"transferables":transferables};this._inputPort.postMessage(job,transferables)}_CancelJob(jobId){const job=this._jobPromises.get(jobId);if(job){job.cancelled=true;job.resolve=null;job.progress=null;job.reject=null;this._inputPort.postMessage({"type":"_cancel",
"jobId":jobId})}}_OnJobWorkerMessage(e){const msg=e.data;const type=msg["type"];const id=msg["jobId"];switch(type){case "result":this._OnJobResult(id,msg["result"]);break;case "progress":this._OnJobProgress(id,msg["progress"]);break;case "error":this._OnJobError(id,msg["error"]);break;case "ready":this._OnJobWorkerReady();break;default:throw new Error(`unknown message from worker '${type}'`);}}_OnJobResult(jobId,result){const p=this._jobPromises.get(jobId);if(!p)throw new Error("invalid job ID");
if(!p.cancelled)p.resolve(result);this._jobPromises.delete(jobId)}_OnJobProgress(jobId,progress){const p=this._jobPromises.get(jobId);if(!p)throw new Error("invalid job ID");if(!p.cancelled&&p.progress)p.progress(progress)}_OnJobError(jobId,error){const p=this._jobPromises.get(jobId);if(!p)throw new Error("invalid job ID");if(!p.cancelled)p.reject(error);this._jobPromises.delete(jobId)}_OnJobWorkerReady(){if(!this._isCreatingWorker)return;this._isCreatingWorker=false;this._jobWorkerCount++;if(this._jobWorkerCount<
this._maxNumWorkers)this._MaybeCreateExtraWorker();else this._inputPort.postMessage({"type":"_no_more_workers"})}_GetWorkerCountNeededForPendingJobs(){let needWorkerCount=0;const sortedJobList=[...this._jobPromises.values()].sort((a,b)=>{const an=a.maxWorkerNum||Infinity;const bn=b.maxWorkerNum||Infinity;return an-bn});for(const job of sortedJobList){const maxWorkerNum=job.maxWorkerNum||Infinity;if(needWorkerCount<maxWorkerNum)needWorkerCount++}return needWorkerCount}async _MaybeCreateExtraWorker(){if(this._jobWorkerCount>=
this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._GetWorkerCountNeededForPendingJobs()<=this._jobWorkerCount)return;try{this._isCreatingWorker=true;const result=await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker");result["outputPort"].onmessage=e=>this._OnJobWorkerMessage(e)}catch(err){this._hadErrorCreatingWorker=true;this._isCreatingWorker=false;console.error(`[Construct] Failed to create job worker; stopping creating any more (created ${this._jobWorkerCount} so far)`,
err)}}};

}

{
self["C3_Shaders"] = {};

}

{
'use strict';{const C3=self.C3;let cacheRegex=null;let lastRegex="";let lastFlags="";let regexMatches=[];let lastMatchesStr="";let lastMatchesRegex="";let lastMatchesFlags="";const forEachStack=C3.New(C3.ArrayStack);function ForEachOrdered_SortInstances(a,b){const va=a[1];const vb=b[1];if(typeof va==="number"&&typeof vb==="number")return va-vb;else{const sa=""+va;const sb=""+vb;if(sa<sb)return-1;else if(sa>sb)return 1;else return 0}}C3.Plugins.System=class SystemPlugin extends C3.SDKPluginBase{constructor(opts){super(opts);
this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack();this._eventStack=this._runtime.GetEventSheetManager().GetEventStack();this._imagesLoadingTotal=0;this._imagesLoadingComplete=0;this._functionMaps=new Map;this._signalTags=[]}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(method){this._runtime.Trigger(method,null,null)}GetRegex(regex,flags){if(!cacheRegex||regex!==lastRegex||flags!==lastFlags){cacheRegex=new RegExp(regex,flags);lastRegex=regex;lastFlags=
flags}cacheRegex.lastIndex=0;return cacheRegex}GetRegexMatches(str,regex,flags){if(str===lastMatchesStr&&regex===lastMatchesRegex&&flags===lastMatchesFlags)return regexMatches;const cacheRegex=this.GetRegex(regex,flags);regexMatches=str.match(cacheRegex);lastMatchesStr=str;lastMatchesRegex=regex;lastMatchesFlags=flags;return regexMatches}async _LoadTexturesForObjectClasses(layout,objectClasses){if(!objectClasses.length)return;this._imagesLoadingTotal+=objectClasses.length;const promises=[];for(const oc of objectClasses)promises.push(layout.MaybeLoadTexturesFor(oc));
await C3.PromiseAllWithProgress(promises,()=>{this._imagesLoadingComplete++});this._imagesLoadingComplete++;if(this._imagesLoadingComplete===this._imagesLoadingTotal){this._imagesLoadingComplete=0;this._imagesLoadingTotal=0;this._runtime.Trigger(C3.Plugins.System.Cnds.OnImageLoadingComplete,null,null)}}_UnloadTexturesForObjectClasses(layout,objectClasses){for(const oc of objectClasses)if(oc.GetInstanceCount()===0)layout.MaybeUnloadTexturesFor(oc)}_GetForEachStack(){return forEachStack}_Repeat(count){const eventSheetManager=
this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();loop.SetEnd(count);if(isSolModifierAfterCnds)for(let i=0;i<count&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);
loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else for(let i=0;i<count&&!loop.IsStopped();++i){loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame)}eventStack.Pop();loopStack.Pop();return false}*_DebugRepeat(count){const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();
const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();loop.SetEnd(count);if(isSolModifierAfterCnds)for(let i=0;i<count&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else for(let i=0;i<count&&!loop.IsStopped();++i){loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,
newFrame)}eventStack.Pop();loopStack.Pop();return false}_While(){const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();
if(isSolModifierAfterCnds)for(let i=0;!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);if(!currentEvent.Retrigger(oldFrame,newFrame))loop.Stop();eventSheetManager.PopSol(solModifiers)}else for(let i=0;!loop.IsStopped();++i){loop.SetIndex(i);if(!currentEvent.Retrigger(oldFrame,newFrame))loop.Stop()}eventStack.Pop();loopStack.Pop();return false}*_DebugWhile(){const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();
const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();if(isSolModifierAfterCnds)for(let i=0;!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);const ret=yield*currentEvent.DebugRetrigger(oldFrame,
newFrame);if(!ret)loop.Stop();eventSheetManager.PopSol(solModifiers)}else for(let i=0;!loop.IsStopped();++i){loop.SetIndex(i);const ret=yield*currentEvent.DebugRetrigger(oldFrame,newFrame);if(!ret)loop.Stop()}eventStack.Pop();loopStack.Pop();return false}_For(name,start,end){const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=
currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();loop.SetName(name);loop.SetEnd(end);if(end<start)if(isSolModifierAfterCnds)for(let i=start;i>=end&&!loop.IsStopped();--i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else for(let i=start;i>=
end&&!loop.IsStopped();--i){loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame)}else if(isSolModifierAfterCnds)for(let i=start;i<=end&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else for(let i=start;i<=end&&!loop.IsStopped();++i){loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame)}eventStack.Pop();loopStack.Pop();return false}*_DebugFor(name,start,end){const eventSheetManager=
this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();loop.SetName(name);loop.SetEnd(end);if(end<start)if(isSolModifierAfterCnds)for(let i=
start;i>=end&&!loop.IsStopped();--i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else for(let i=start;i>=end&&!loop.IsStopped();--i){loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame)}else if(isSolModifierAfterCnds)for(let i=start;i<=end&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame);
eventSheetManager.PopSol(solModifiers)}else for(let i=start;i<=end&&!loop.IsStopped();++i){loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame)}eventStack.Pop();loopStack.Pop();return false}_ForEach(objectClass){const sol=objectClass.GetCurrentSol();const iterInstances=sol.GetInstances();if(iterInstances.length===0)return false;const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();
const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();const isInContainer=objectClass.IsInContainer();const instances=forEachStack.Push();C3.shallowAssignArray(instances,iterInstances);loop.SetEnd(instances.length);if(isSolModifierAfterCnds)for(let i=0,len=instances.length;i<
len&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);const inst=instances[i];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else{sol._SetSelectAll(false);const solInstances=sol._GetOwnInstances();C3.clearArray(solInstances);solInstances.push(null);for(let i=0,len=instances.length;i<len&&!loop.IsStopped();++i){const inst=instances[i];
solInstances[0]=inst;if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame)}}eventStack.Pop();loopStack.Pop();C3.clearArray(instances);forEachStack.Pop();return false}*_DebugForEach(objectClass){const sol=objectClass.GetCurrentSol();const iterInstances=sol.GetInstances();if(iterInstances.length===0)return false;const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();
const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();const isInContainer=objectClass.IsInContainer();const instances=forEachStack.Push();C3.shallowAssignArray(instances,iterInstances);loop.SetEnd(instances.length);if(isSolModifierAfterCnds)for(let i=0,len=instances.length;i<
len&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);const inst=instances[i];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else{sol._SetSelectAll(false);const solInstances=sol._GetOwnInstances();C3.clearArray(solInstances);solInstances.push(null);for(let i=0,len=instances.length;i<len&&!loop.IsStopped();++i){const inst=
instances[i];solInstances[0]=inst;if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame)}}eventStack.Pop();loopStack.Pop();C3.clearArray(instances);forEachStack.Pop();return false}_ForEachOrdered(objectClass,order){const sol=objectClass.GetCurrentSol();const iterInstances=sol.GetInstances();if(iterInstances.length===0)return false;const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();
const cnd=eventSheetManager.GetCurrentCondition();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();const isInContainer=objectClass.IsInContainer();const instancesData=forEachStack.Push();C3.clearArray(instancesData);loop.SetEnd(iterInstances.length);
for(let i=0,len=iterInstances.length;i<len;++i)instancesData.push([iterInstances[i],cnd.ReevaluateParameter(1,i)]);instancesData.sort(ForEachOrdered_SortInstances);if(order===1)instancesData.reverse();if(isSolModifierAfterCnds)for(let i=0,len=instancesData.length;i<len&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);const inst=instancesData[i][0];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);currentEvent.Retrigger(oldFrame,
newFrame);eventSheetManager.PopSol(solModifiers)}else{sol._SetSelectAll(false);const solInstances=sol._GetOwnInstances();C3.clearArray(solInstances);solInstances.push(null);for(let i=0,len=instancesData.length;i<len&&!loop.IsStopped();++i){const inst=instancesData[i][0];solInstances[0]=inst;if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame)}}eventStack.Pop();loopStack.Pop();C3.clearArray(instancesData);forEachStack.Pop();return false}*_DebugForEachOrdered(objectClass,
order){const sol=objectClass.GetCurrentSol();const iterInstances=sol.GetInstances();if(iterInstances.length===0)return false;const eventSheetManager=this._runtime.GetEventSheetManager();const eventStack=eventSheetManager.GetEventStack();const cnd=eventSheetManager.GetCurrentCondition();const oldFrame=eventStack.GetCurrentStackFrame();const currentEvent=oldFrame.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();const newFrame=
eventStack.Push(currentEvent);const loopStack=eventSheetManager.GetLoopStack();const loop=loopStack.Push();const isInContainer=objectClass.IsInContainer();const instancesData=forEachStack.Push();C3.clearArray(instancesData);loop.SetEnd(iterInstances.length);for(let i=0,len=iterInstances.length;i<len;++i)instancesData.push([iterInstances[i],cnd.ReevaluateParameter(1,i)]);instancesData.sort(ForEachOrdered_SortInstances);if(order===1)instancesData.reverse();if(isSolModifierAfterCnds)for(let i=0,len=
instancesData.length;i<len&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);const inst=instancesData[i][0];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}else{sol._SetSelectAll(false);const solInstances=sol._GetOwnInstances();C3.clearArray(solInstances);solInstances.push(null);for(let i=0,len=instancesData.length;i<len&&
!loop.IsStopped();++i){const inst=instancesData[i][0];solInstances[0]=inst;if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);yield*currentEvent.DebugRetrigger(oldFrame,newFrame)}}eventStack.Pop();loopStack.Pop();C3.clearArray(instancesData);forEachStack.Pop();return false}_GetFunctionMap(name,createIfMissing){let ret=this._functionMaps.get(name);if(ret)return ret;if(!createIfMissing)return null;ret={defaultFunc:null,strMap:new Map};this._functionMaps.set(name,ret);return ret}_DoCallMappedFunction(eventSheetManager,
functionBlock,paramResults,hasAnySolModifiers,solModifiers){functionBlock.GetEventBlock().RunAsMappedFunctionCall(paramResults,functionBlock.IsCopyPicked());if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers)}*_DebugDoCallMappedFunction(eventSheetManager,functionBlock,paramResults,hasAnySolModifiers,solModifiers){yield*functionBlock.GetEventBlock().DebugRunAsMappedFunctionCall(paramResults,functionBlock.IsCopyPicked());if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers)}}}
{const C3=self.C3;C3.Plugins.System.Type=class SystemType extends C3.DefendedBase{constructor(objectClass){super();this._objectClass=objectClass;this._runtime=objectClass.GetRuntime();this._plugin=objectClass.GetPlugin()}OnCreate(){}Release(){this._objectClass=null;this._runtime=null;this._plugin=null}}}
{const C3=self.C3;C3.Plugins.System.Instance=class SystemInstance extends C3.DefendedBase{constructor(inst,properties){super();this._inst=inst;this._objectClass=this._inst.GetObjectClass();this._sdkType=this._objectClass.GetSdkType();this._runtime=this._inst.GetRuntime()}Release(){this._inst=null;this._objectClass=null;this._sdkType=null;this._runtime=null}}}
{const C3=self.C3;const tmpPickArray=[];C3.Plugins.System.Cnds={EveryTick(){return true},OnLayoutStart(){return true},OnLayoutEnd(){return true},OnSuspend(){return true},OnResume(){return true},IsSuspended(){return this._runtime.IsSuspended()},Else(){const frame=this._runtime.GetCurrentEventStackFrame();if(frame.GetElseBranchRan())return false;else return!frame.GetLastEventTrue()},TriggerOnce(){const cnd=this._runtime.GetCurrentCondition();const cndSavedData=cnd.GetSavedDataMap();let lastTick=cndSavedData.get("TriggerOnce_lastTick");
if(typeof lastTick==="undefined"){lastTick=-1;cndSavedData.set("TriggerOnce_lastTick",-1)}const curTick=this._runtime.GetTickCount();cndSavedData.set("TriggerOnce_lastTick",curTick);return this._runtime.IsLayoutFirstTick()||lastTick!==curTick-1},Every(seconds){const cnd=this._runtime.GetCurrentCondition();const cndSavedData=cnd.GetSavedDataMap();const lastTime=cndSavedData.get("Every_lastTime")||0;const curTime=this._runtime.GetGameTime();if(!cndSavedData.has("Every_seconds"))cndSavedData.set("Every_seconds",
seconds);const thisSeconds=cndSavedData.get("Every_seconds");if(curTime>=lastTime+thisSeconds){cndSavedData.set("Every_lastTime",lastTime+thisSeconds);if(curTime>=cndSavedData.get("Every_lastTime")+.04)cndSavedData.set("Every_lastTime",curTime);cndSavedData.set("Every_seconds",seconds);return true}else if(curTime<lastTime-.1)cndSavedData.set("Every_lastTime",curTime);return false},IsGroupActive(groupName){const eventGroup=this._runtime.GetEventSheetManager().GetEventGroupByName(groupName);return eventGroup&&
eventGroup.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile(){return C3.Platform.IsMobile},OnLoadFinished(){return true},OnCanvasSnapshot(){return true},EffectsSupported(){return true},OnSaveComplete(){return true},OnSaveFailed(){return true},OnLoadComplete(){return true},OnLoadFailed(){return true},ObjectUIDExists(uid){return!!this._runtime.GetInstanceByUID(uid)},IsOnPlatform(p){switch(p){case 0:return C3.Platform.Context==="browser";case 1:return C3.Platform.OS==="iOS";case 2:return C3.Platform.OS===
"Android";case 8:return C3.Platform.Context==="cordova";case 9:return this._runtime.GetExportType()==="scirra-arcade";case 10:return C3.Platform.Context==="nwjs";case 13:return this._runtime.GetExportType()==="windows-uwp";default:return false}},RegexTest(str,regex,flags){const cacheRegex=this.GetRegex(regex,flags);return cacheRegex.test(str)},Compare(x,cmp,y){return C3.compare(x,cmp,y)},CompareBetween(x,a,b){return x>=a&&x<=b},CompareVar(ev,cmp,val){return C3.compare(ev.GetValue(),cmp,val)},CompareBoolVar(ev){return!!ev.GetValue()},
CompareTime(cmp,t){const gameTime=this._runtime.GetGameTime();if(cmp===0){const cnd=this._runtime.GetCurrentCondition();const cndSavedData=cnd.GetSavedDataMap();if(!cndSavedData.get("CompareTime_executed"))if(gameTime>=t){cndSavedData.set("CompareTime_executed",true);return true}return false}else return C3.compare(gameTime,cmp,t)},IsNaN(n){return isNaN(n)},AngleWithin(a1,within,a2){return C3.angleDiff(C3.toRadians(a1),C3.toRadians(a2))<=C3.toRadians(within)},IsClockwiseFrom(a1,a2){return C3.angleClockwise(C3.toRadians(a1),
C3.toRadians(a2))},IsBetweenAngles(a,la,ua){let angle=C3.toRadians(a);let lower=C3.toRadians(la);let upper=C3.toRadians(ua);let obtuse=!C3.angleClockwise(upper,lower);if(obtuse)return!(!C3.angleClockwise(angle,lower)&&C3.angleClockwise(angle,upper));else return C3.angleClockwise(angle,lower)&&!C3.angleClockwise(angle,upper)},IsValueType(v,t){if(typeof v==="number")return t===0;else return t===1},EvaluateExpression(v){return!!v},OnSignal(tag){return tag.toLowerCase()===this._signalTags.at(-1)},PickByComparison(objectClass,
exp,cmp,val){if(!objectClass)return false;const forEachStack=this._GetForEachStack();const tempInstances=forEachStack.Push();const sol=objectClass.GetCurrentSol();C3.shallowAssignArray(tempInstances,sol.GetInstances());if(sol.IsSelectAll())C3.clearArray(sol._GetOwnElseInstances());const cnd=this._runtime.GetCurrentCondition();let k=0;for(let i=0,len=tempInstances.length;i<len;++i){const inst=tempInstances[i];tempInstances[k]=inst;exp=cnd.ReevaluateParameter(1,i);val=cnd.ReevaluateParameter(3,i);if(C3.compare(exp,
cmp,val))++k;else sol._PushElseInstance(inst)}C3.truncateArray(tempInstances,k);sol.SetArrayPicked(tempInstances);const ret=!!tempInstances.length;C3.clearArray(tempInstances);forEachStack.Pop();objectClass.ApplySolToContainer();return ret},PickByEvaluate(objectClass,exp){if(!objectClass)return false;const forEachStack=this._GetForEachStack();const tempInstances=forEachStack.Push();const sol=objectClass.GetCurrentSol();C3.shallowAssignArray(tempInstances,sol.GetInstances());if(sol.IsSelectAll())C3.clearArray(sol._GetOwnElseInstances());
const cnd=this._runtime.GetCurrentCondition();let k=0;for(let i=0,len=tempInstances.length;i<len;++i){const inst=tempInstances[i];tempInstances[k]=inst;exp=cnd.ReevaluateParameter(1,i);if(exp)++k;else sol._PushElseInstance(inst)}C3.truncateArray(tempInstances,k);sol.SetArrayPicked(tempInstances);const ret=!!tempInstances.length;C3.clearArray(tempInstances);forEachStack.Pop();objectClass.ApplySolToContainer();return ret},PickByHighestLowestValue(objectClass,which,exp){if(!objectClass)return false;
const sol=objectClass.GetCurrentSol();const instances=sol.GetInstances();if(instances.length===0)return false;const cnd=this._runtime.GetCurrentCondition();let pickInst=null;let bestVal=0;for(let i=0,len=instances.length;i<len;++i){const inst=instances[i];exp=cnd.ReevaluateParameter(2,i);if(pickInst===null||which===0&&exp<bestVal||which===1&&exp>bestVal){bestVal=exp;pickInst=inst}}sol.PickOne(pickInst);objectClass.ApplySolToContainer();return true},PickNth(objectClass,index){if(!objectClass)return false;
const sol=objectClass.GetCurrentSol();const instances=sol.GetInstances();index=Math.floor(index);if(index>=instances.length)return false;const inst=instances[index];sol.PickOne(inst);objectClass.ApplySolToContainer();return true},PickRandom(objectClass){if(!objectClass)return false;const sol=objectClass.GetCurrentSol();const instances=sol.GetInstances();const index=Math.floor(this._runtime.Random()*instances.length);if(index>=instances.length)return false;const inst=instances[index];sol.PickOne(inst);
objectClass.ApplySolToContainer();return true},PickAll(objectClass){if(!objectClass)return false;if(!objectClass.GetInstanceCount())return false;const sol=objectClass.GetCurrentSol();sol._SetSelectAll(true);objectClass.ApplySolToContainer();return true},PickOverlappingPoint(objectClass,x,y){if(!objectClass)return false;const sol=objectClass.GetCurrentSol();const instances=sol.GetInstances();const currentEvent=this._runtime.GetCurrentEvent();const isOrBlock=currentEvent.IsOrBlock();const isInverted=
this._runtime.GetCurrentCondition().IsInverted();if(sol.IsSelectAll()){C3.shallowAssignArray(tmpPickArray,instances);sol.ClearArrays();sol._SetSelectAll(false)}else if(isOrBlock){C3.shallowAssignArray(tmpPickArray,sol._GetOwnElseInstances());C3.clearArray(sol._GetOwnElseInstances())}else{C3.shallowAssignArray(tmpPickArray,sol._GetOwnInstances());C3.clearArray(sol._GetOwnInstances())}for(let i=0,len=tmpPickArray.length;i<len;++i){const inst=tmpPickArray[i];if(C3.xor(inst.GetWorldInfo().ContainsPoint(x,
y),isInverted))sol._PushInstance(inst);else sol._PushElseInstance(inst)}objectClass.ApplySolToContainer();return C3.xor(!!sol._GetOwnInstances().length,isInverted)},PickLastCreated(objectClass){if(!objectClass)return false;const isFamily=objectClass.IsFamily();let pick=null;const instancesPendingCreate=this._runtime._GetInstancesPendingCreate();for(let i=instancesPendingCreate.length-1;i>=0;--i){const inst=instancesPendingCreate[i];if(isFamily){if(inst.GetObjectClass().BelongsToFamily(objectClass)){pick=
inst;break}}else if(inst.GetObjectClass()===objectClass){pick=inst;break}}if(!pick){const instances=objectClass.GetInstances();if(instances.length)pick=instances.at(-1)}if(!pick)return false;const sol=objectClass.GetCurrentSol();sol.PickOne(pick);objectClass.ApplySolToContainer();return true},Repeat(count){if(this._runtime.IsDebugging())return this._DebugRepeat(count);else return this._Repeat(count)},While(){if(this._runtime.IsDebugging())return this._DebugWhile();else return this._While()},For(name,
start,end){if(this._runtime.IsDebugging())return this._DebugFor(name,start,end);else return this._For(name,start,end)},ForEach(objectClass){if(this._runtime.IsDebugging())return this._DebugForEach(objectClass);else return this._ForEach(objectClass)},ForEachOrdered(objectClass,expression,order){if(this._runtime.IsDebugging())return this._DebugForEachOrdered(objectClass,order);else return this._ForEachOrdered(objectClass,order)},LayerVisible(layer){return layer?layer.IsVisible():false},LayerInteractive(layer){return layer?
layer.IsSelfAndParentsInteractive():false},LayerIsHTML(layer){return layer?layer.IsHTMLElementsLayer():false},LayerEmpty(layer){return layer?!layer.GetInstanceCount():false},LayerCmpOpacity(layer,cmp,o){if(!layer)return false;return C3.compare(layer.GetOpacity()*100,cmp,o)},LayerNameExists(nameStr){const layout=this._runtime.GetMainRunningLayout();return layout?layout.HasLayerByName(nameStr):false},OnImageLoadingComplete(){return true},IsLoadingImages(){return this._imagesLoadingTotal>0},TemplateExists(objectClass,
template){const templateManager=this._runtime.GetTemplateManager();if(!templateManager)return false;if(!template)return false;return!!templateManager.GetTemplateData(objectClass,template)}}}
{const C3=self.C3;function SortZOrderList(a,b){const layerA=a[0];const layerB=b[0];const diff=layerA-layerB;if(diff!==0)return diff;const indexA=a[1];const indexB=b[1];return indexA-indexB}function SortInstancesByValue(a,b){return a[1]-b[1]}const tempZOrderList=[];const tempInstValues=[];const tempRect=C3.New(C3.Rect);const tempColor=C3.New(C3.Color);C3.Plugins.System.Acts={SetVar(ev,x){ev.SetValue(x)},AddVar(ev,x){if(ev.IsNumber()&&typeof x!=="number")x=parseFloat(x);ev.SetValue(ev.GetValue()+x)},
SubVar(ev,x){if(!ev.IsNumber())return;ev.SetValue(ev.GetValue()-x)},SetBoolVar(ev,x){ev.SetValue(!!x)},ToggleBoolVar(ev){ev.SetValue(!ev.GetValue())},ResetEventVar(ev){ev.SetValue(ev.GetInitialValue())},ResetGlobals(includeStatic){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue(includeStatic)},CreateObject(objectClass,layer,x,y,createHierarchy,template){if(!objectClass||!layer)return;const inst=this._runtime.CreateInstance(objectClass,layer,x,y,createHierarchy,template);if(!inst)return;
if(createHierarchy)layer.SortAndAddInstancesByZIndex(inst);const eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);const pickMap=new Map;inst.CollectInstancesToPick(pickMap,objectClass,createHierarchy);for(const [pickObjectClass,instSet]of pickMap)pickObjectClass.GetCurrentSol().SetSetPicked(instSet)},CreateObjectByName(objectClassName,layer,x,y,createHierarchy,
template){if(!objectClassName||!layer)return;const objectClass=this._runtime.GetObjectClassByName(objectClassName);if(!objectClass)return;C3.Plugins.System.Acts.CreateObject.call(this,objectClass,layer,x,y,createHierarchy,template)},RecreateInitialObjects(objectClass,x1,y1,x2,y2,sourceLayoutName,sourceLayerParam,offsetX,offsetY,createHierarchy){if(!objectClass)return;let sourceLayout=this._runtime.GetCurrentLayout();if(sourceLayoutName){const lookupLayout=this._runtime.GetLayoutManager().GetLayoutByName(sourceLayoutName);
if(lookupLayout)sourceLayout=lookupLayout;else return}let sourceLayer=null;if(typeof sourceLayerParam!=="number"||sourceLayerParam>=0){sourceLayer=sourceLayout.GetLayer(sourceLayerParam);if(!sourceLayer)return}tempRect.set(x1,y1,x2,y2);const allCreatedInstances=sourceLayout.RecreateInitialObjects(objectClass,tempRect,sourceLayer,offsetX,offsetY,createHierarchy);objectClass.GetCurrentSol().SetArrayPicked(allCreatedInstances);objectClass.ApplySolToContainer()},StopLoop(){const loopStack=this._loopStack;
if(!loopStack.IsInLoop())return;loopStack.GetCurrent().Stop()},SetGroupActive(groupName,a){const group=this._runtime.GetEventSheetManager().GetEventGroupByName(groupName);if(!group)return;if(a===0)group.SetGroupActive(false);else if(a===1)group.SetGroupActive(true);else group.SetGroupActive(!group.IsGroupActive())},SetTimescale(ts){this._runtime.SetTimeScale(ts)},SetObjectTimescale(objectClass,ts){if(ts<0)ts=0;if(!objectClass)return;const sol=objectClass.GetCurrentSol();const instances=sol.GetInstances();
for(const inst of instances)inst.SetTimeScale(ts)},RestoreObjectTimescale(objectClass){if(!objectClass)return;const sol=objectClass.GetCurrentSol();const instances=sol.GetInstances();for(const inst of instances)inst.RestoreTimeScale()},Wait(seconds){if(seconds<0)return;this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(seconds);return true},WaitForSignal(tag){this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(tag);return true},WaitForPreviousActions(){const eventSheetManager=
this._runtime.GetEventSheetManager();eventSheetManager.AddScheduledWait().InitPromise(eventSheetManager.GetPromiseForAllAsyncActions());return true},Signal(tag){const lowerTag=tag.toLowerCase();this._signalTags.push(lowerTag);this._runtime.Trigger(C3.Plugins.System.Cnds.OnSignal,null);this._signalTags.pop();for(const w of this._runtime.GetEventSheetManager().scheduledWaits())if(w.IsSignal()&&w.GetSignalTag()===lowerTag)w.SetSignalled()},async SnapshotCanvas(format,quality,x,y,width,height){const canvasManager=
this._runtime.GetCanvasManager();if(!canvasManager)return;this.UpdateRender();await canvasManager.SnapshotCanvas(format===0?"image/png":"image/jpeg",quality/100,x,y,width,height);await this._runtime.TriggerAsync(C3.Plugins.System.Cnds.OnCanvasSnapshot,null)},SetCanvasSize(w,h){if(w<=0||h<=0)return;this._runtime.SetViewportSize(w,h);this._runtime.GetCurrentLayout().BoundScrolling();const canvasManager=this._runtime.GetCanvasManager();if(!canvasManager)return;if(canvasManager.GetCurrentFullscreenMode()===
"off")canvasManager.SetSize(canvasManager.GetLastWidth(),canvasManager.GetLastHeight(),true);else{this._runtime.SetOriginalViewportSize(w,h);canvasManager.SetSize(canvasManager.GetLastWidth(),canvasManager.GetLastHeight(),true)}this._runtime.UpdateRender()},SetFullscreenQuality(q){const canvasManager=this._runtime.GetCanvasManager();if(!canvasManager)return;if(canvasManager.GetCurrentFullscreenMode()==="off")return;canvasManager.SetFullscreenScalingQuality(q!==0?"high":"low");canvasManager.SetSize(canvasManager.GetLastWidth(),
canvasManager.GetLastHeight(),true)},SaveState(slot){this._runtime.SaveToSlot(slot)},LoadState(slot){this._runtime.LoadFromSlot(slot)},LoadStateJSON(jsonStr){this._runtime.LoadFromJsonString(jsonStr)},SetHalfFramerateMode(m){},ResetPersisted(){for(const layout of this._runtime.GetLayoutManager().GetAllLayouts())layout.ResetPersistData()},SetPixelRounding(m){this._runtime.SetPixelRoundingEnabled(m!==0)},SetFramerateMinMax(minFps,maxFps){this._runtime.SetMaxDt(1/minFps);this._runtime.SetMinDt(1/maxFps)},
SetDeltaTimeMinMax(minDt,maxDt){this._runtime.SetMinDt(minDt);this._runtime.SetMaxDt(maxDt)},SetFramerateMode(m){const modes=["vsync","unlimited-tick","unlimited-frame"];this._runtime._SetFramerateMode(modes[m])},SortZOrderByInstVar(objectClass,instVar){if(!objectClass)return;const sol=objectClass.GetCurrentSol();const pickedInstances=sol.GetInstances();const zOrderList=tempZOrderList;const instValues=tempInstValues;const layout=this._runtime.GetCurrentLayout();const isFamily=objectClass.IsFamily();
const familyIndex=objectClass.GetFamilyIndex();for(let i=0,len=pickedInstances.length;i<len;++i){const inst=pickedInstances[i];const wi=inst.GetWorldInfo();if(!wi)continue;let value;if(isFamily)value=inst.GetInstanceVariableValue(instVar+inst.GetObjectClass().GetFamilyInstanceVariableOffset(familyIndex));else value=inst.GetInstanceVariableValue(instVar);zOrderList.push([wi.GetLayer().GetIndex(),wi.GetZIndex()]);instValues.push([inst,value])}if(!zOrderList.length)return;zOrderList.sort(SortZOrderList);
instValues.sort(SortInstancesByValue);let anyChanged=false;for(let i=0,len=zOrderList.length;i<len;++i){const inst=instValues[i][0];const layer=layout.GetLayerByIndex(zOrderList[i][0]);const toZ=zOrderList[i][1];const layerInstances=layer._GetInstances();if(layerInstances[toZ]!==inst){layerInstances[toZ]=inst;inst.GetWorldInfo()._SetLayer(layer,true);layer.SetZIndicesChanged(inst);anyChanged=true}}if(anyChanged)this._runtime.UpdateRender();C3.clearArray(tempZOrderList);C3.clearArray(tempInstValues)},
SetCollisionCellSize(width,height){width=Math.floor(width);height=Math.floor(height);if(width<=0||height<=0||!Number.isFinite(width)||!Number.isFinite(height))return;this._runtime.GetCollisionEngine().SetCollisionCellSize(width,height)},GoToLayout(layout){if(this._runtime.IsLoading())return;const layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;layoutManager.ChangeMainLayout(layout)},GoToLayoutByName(layoutName){if(this._runtime.IsLoading())return;
const layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;const toLayout=layoutManager.GetLayoutByName(layoutName);if(toLayout)layoutManager.ChangeMainLayout(toLayout)},NextPrevLayout(prev){if(this._runtime.IsLoading())return;const layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;const allLayouts=layoutManager.GetAllLayouts();const index=allLayouts.indexOf(layoutManager.GetMainRunningLayout());if(prev&&
index===0)return;if(!prev&&index===allLayouts.length-1)return;const toLayout=allLayouts[index+(prev?-1:1)];layoutManager.ChangeMainLayout(toLayout)},RestartLayout(){if(this._runtime.IsLoading())return;const layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;layoutManager.ChangeMainLayout(layoutManager.GetMainRunningLayout());this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation()},SetLayerVisible(layer,v){if(!layer)return;layer.SetVisible(v)},
SetLayerInteractive(layer,i){if(!layer)return;layer.SetInteractive(i)},SetLayerHTML(layer,isHtml){if(!layer)return;layer.SetIsHTMLElementsLayer(isHtml)},SetLayerOpacity(layer,o){if(!layer)return;layer.SetOpacity(o/100)},SetLayerScale(layer,s){if(!layer)return;layer.SetOwnScale(s)},SetLayerScaleRate(layer,r){if(!layer)return;layer.SetScaleRate(r)},SetLayerAngle(layer,a){if(!layer)return;layer.SetAngle(C3.toRadians(+a))},SetLayerScroll(layer,scrollX,scrollY){if(!layer)return;layer.SetOwnScrollPositionEnabled(true);
layer.SetScrollX(scrollX);layer.SetScrollY(scrollY)},RestoreLayerScroll(layer){if(!layer)return;layer.SetOwnScrollPositionEnabled(false)},SetLayerParallax(layer,px,py){if(!layer)return;layer.SetParallax(px/100,py/100)},SetLayerZElevation(layer,z){if(!layer)return;layer.SetZElevation(+z)},SetLayerBackground(layer,rgb){if(!layer)return;tempColor.setFromRgbValue(rgb);tempColor.clamp();const layerBgColor=layer.GetBackgroundColor();if(layerBgColor.equalsIgnoringAlpha(tempColor))return;layerBgColor.copyRgb(tempColor);
this.UpdateRender()},SetLayerTransparent(layer,t){if(!layer)return;layer.SetTransparent(t)},SetLayerBlendMode(layer,bm){if(!layer)return;layer.SetBlendMode(bm)},SetLayerEffectEnabled(layer,enabled,effectName){if(!layer)return;const effectList=layer.GetEffectList();const effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;const e=enabled===1;if(effectType.IsActive()===e)return;effectType.SetActive(e);layer.UpdateActiveEffects();this._runtime.UpdateRender()},SetLayerEffectParam(layer,
effectName,paramIndex,value){if(!layer)return;const effectList=layer.GetEffectList();const effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;paramIndex=Math.floor(paramIndex);const paramType=effectType.GetShaderProgram().GetParameterType(paramIndex);if(!paramType)return;if(paramType==="color"){tempColor.setFromRgbValue(value);value=tempColor}else if(paramType==="percent")value/=100;const didChange=effectList.SetEffectParameter(effectType.GetIndex(),paramIndex,value);if(didChange&&
effectType.IsActive())this._runtime.UpdateRender()},SetLayerForceOwnTexture(layer,f){if(!layer)return;layer.SetForceOwnTexture(f)},SetLayoutScale(s){this._runtime.GetCurrentLayout().SetScale(+s)},SetLayoutAngle(a){this._runtime.GetCurrentLayout().SetAngle(C3.toRadians(+a))},SetLayoutEffectEnabled(enabled,effectName){const layout=this._runtime.GetCurrentLayout();const effectList=layout.GetEffectList();const effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;const e=enabled===
1;if(effectType.IsActive()===e)return;effectType.SetActive(e);layout.UpdateActiveEffects();this._runtime.UpdateRender()},SetLayoutEffectParam(effectName,paramIndex,value){const layout=this._runtime.GetCurrentLayout();const effectList=layout.GetEffectList();const effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;paramIndex=Math.floor(paramIndex);const paramType=effectType.GetShaderProgram().GetParameterType(paramIndex);if(!paramType)return;if(paramType==="color"){tempColor.setFromRgbValue(value);
value=tempColor}else if(paramType==="percent")value/=100;const didChange=effectList.SetEffectParameter(effectType.GetIndex(),paramIndex,value);if(didChange&&effectType.IsActive())this._runtime.UpdateRender()},SetLayoutVanishingPoint(vpX,vpY){const layout=this._runtime.GetCurrentLayout();layout.SetVanishingPointXY(vpX/100,vpY/100)},SetLayoutProjection(p){const layout=this._runtime.GetCurrentLayout();if(p===0)layout.SetPerspectiveProjection();else layout.SetOrthographicProjection()},ScrollX(x){const layout=
this._runtime.GetCurrentLayout();layout.SetScrollX(x)},ScrollY(y){const layout=this._runtime.GetCurrentLayout();layout.SetScrollY(y)},Scroll(x,y){const layout=this._runtime.GetCurrentLayout();layout.SetScrollX(x);layout.SetScrollY(y)},ScrollToObject(objectClass){if(!objectClass)return;const inst=objectClass.GetFirstPicked();if(!inst)return;const wi=inst.GetWorldInfo();if(!wi)return;const layout=this._runtime.GetCurrentLayout();layout.SetScrollX(wi.GetX());layout.SetScrollY(wi.GetY())},AddLayer(layerName,
insertBy,where){const layout=this._runtime.GetCurrentLayout();try{layout.AddLayer(layerName,insertBy,where)}catch(err){console.warn(`[Construct] Cannot add layer: `,err)}},MoveLayer(layer,insertBy,where){if(!layer)return;const layout=this._runtime.GetCurrentLayout();try{layout.MoveLayer(layer,insertBy,where)}catch(err){console.warn(`[Construct] Cannot move layer: `,err)}},RemoveLayer(layer){if(!layer)return;const layout=this._runtime.GetCurrentLayout();layout.RemoveLayer(layer)},RemoveAllDynamicLayers(){this._runtime.GetCurrentLayout().RemoveAllDynamicLayers()},
async LoadObjectTextures(objectClass){const layout=this._runtime.GetMainRunningLayout();if(!layout||!objectClass||this._runtime.IsLoading())return;const objectClasses=objectClass.IsFamily()?objectClass.GetFamilyMembers():[objectClass];await this._LoadTexturesForObjectClasses(layout,objectClasses)},async LoadObjectTexturesByName(objectClassName){await C3.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(objectClassName))},UnloadObjectTextures(objectClass){const layout=
this._runtime.GetMainRunningLayout();if(!layout||!objectClass)return;const objectClasses=objectClass.IsFamily()?objectClass.GetFamilyMembers():[objectClass];this._UnloadTexturesForObjectClasses(layout,objectClasses)},UnloadObjectTexturesByName(objectClassName){C3.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(objectClassName))},UnloadUnusedTextures(){const layout=this._runtime.GetMainRunningLayout();if(!layout)return;const objectClasses=layout._GetTextureLoadedObjectTypes();
this._UnloadTexturesForObjectClasses(layout,objectClasses)},async LoadLayoutTextures(loadLayout){const curLayout=this._runtime.GetMainRunningLayout();if(!loadLayout||!curLayout||this._runtime.IsLoading())return;await this._LoadTexturesForObjectClasses(curLayout,loadLayout._GetInitialObjectClasses())},async LoadLayoutTexturesByName(layoutName){const curLayout=this._runtime.GetMainRunningLayout();const loadLayout=this._runtime.GetLayoutManager().GetLayoutByName(layoutName);if(!loadLayout||!curLayout||
this._runtime.IsLoading())return;await this._LoadTexturesForObjectClasses(curLayout,loadLayout._GetInitialObjectClasses())},SetFunctionReturnValue(v){const frame=this._eventStack.GetCurrentExpFuncStackFrame();if(!frame)return;switch(frame.GetFunctionReturnType()){case 1:if(typeof v==="number")frame.SetFunctionReturnValue(v);break;case 2:if(typeof v==="string")frame.SetFunctionReturnValue(v);break;case 3:frame.SetFunctionReturnValue(v);break}},MapFunction(name,str,functionBlock){const mapEntry=this._GetFunctionMap(name.toLowerCase(),
true);const strMap=mapEntry.strMap;const lowerStr=str.toLowerCase();if(strMap.has(lowerStr))console.warn(`[Construct] Function map '${name}' string '${str}' already in map; overwriting entry`);const firstFunctionBlock=C3.first(strMap.values())||mapEntry.defaultFunc;if(firstFunctionBlock){const firstReturnsValue=firstFunctionBlock.GetReturnType()!==0;const curReturnsValue=functionBlock.GetReturnType()!==0;if(firstReturnsValue!==curReturnsValue){console.error(`[Construct] Function map '${name}' string '${str}' function return type not compatible with other functions in the map; entry ignored`);
return}}strMap.set(lowerStr,functionBlock)},MapFunctionDefault(name,functionBlock){const mapEntry=this._GetFunctionMap(name.toLowerCase(),true);if(mapEntry.defaultFunc)console.warn(`[Construct] Function map '${name}' already has a default; overwriting entry`);const firstFunctionBlock=C3.first(mapEntry.strMap.values())||mapEntry.defaultFunc;if(firstFunctionBlock){const firstReturnsValue=firstFunctionBlock.GetReturnType()!==0;const curReturnsValue=functionBlock.GetReturnType()!==0;if(firstReturnsValue!==
curReturnsValue){console.error(`[Construct] Function map '${name}' default: function return type not compatible with other functions in the map; entry ignored`);return}}mapEntry.defaultFunc=functionBlock},CallMappedFunction(name,str,forwardParams){forwardParams=Math.floor(forwardParams);const mapEntry=this._GetFunctionMap(name.toLowerCase(),false);if(!mapEntry){console.warn(`[Construct] Call mapped function: map name '${name}' not found; call ignored`);return}let functionBlock=mapEntry.strMap.get(str.toLowerCase());
if(!functionBlock)if(mapEntry.defaultFunc){functionBlock=mapEntry.defaultFunc;forwardParams=0}else{console.warn(`[Construct] Call mapped function: no function associated with map '${name}' string '${str}'; call ignored (consider setting a default)`);return}if(!functionBlock.IsEnabled())return;if(functionBlock.GetReturnType()!==0){console.warn(`[Construct] Call mapped function: map '${name}' string '${str}' has a return type so cannot be called`);return}const runtime=this._runtime;const eventSheetManager=
runtime.GetEventSheetManager();const currentEvent=eventSheetManager.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiersIncludingParents();const hasAnySolModifiers=solModifiers.length>0;if(hasAnySolModifiers)if(functionBlock.IsCopyPicked())eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);const paramResults=[];const callerFunctionBlock=eventSheetManager.FindFirstFunctionBlockParent(currentEvent);if(callerFunctionBlock){const callerParameters=
callerFunctionBlock.GetFunctionParameters();for(let i=forwardParams,len=callerParameters.length;i<len;++i)paramResults.push(callerParameters[i].GetValue())}const calleeParameters=functionBlock.GetFunctionParameters();for(let i=paramResults.length,len=calleeParameters.length;i<len;++i)paramResults.push(calleeParameters[i].GetInitialValue());if(runtime.IsDebugging())return this._DebugDoCallMappedFunction(eventSheetManager,functionBlock,paramResults,hasAnySolModifiers,solModifiers);else return this._DoCallMappedFunction(eventSheetManager,
functionBlock,paramResults,hasAnySolModifiers,solModifiers)}}}
{const C3=self.C3;C3.Plugins.System.Exps={int:function(x){if(typeof x==="string"){x=parseInt(x,10);if(isNaN(x))x=0}return Math.floor(x)},float:function(x){if(typeof x==="string"){x=parseFloat(x);if(isNaN(x))x=0}return x},str(x){return x.toString()},len(x){if(typeof x==="string")return x.length;else return 0},random(a,b){if(typeof b==="undefined")return this._runtime.Random()*a;else return this._runtime.Random()*(b-a)+a},choose(...args){const index=Math.floor(this._runtime.Random()*args.length);return args[index]},
chooseindex(index,...args){if(typeof index!=="number")index=0;index=C3.clamp(Math.floor(index),0,args.length-1);return args[index]},pi(){return Math.PI},infinity(){return Infinity},sqrt(v){return Math.sqrt(v)},abs(v){return Math.abs(v)},round(v){return Math.round(v)},roundtodp(v,dp){dp=Math.max(Math.floor(dp),0);const m=Math.pow(10,dp);return Math.round((v+Number.EPSILON)*m)/m},floor(v){return Math.floor(v)},ceil(v){return Math.ceil(v)},sign(v){return Math.sign(v)},sin(x){return Math.sin(C3.toRadians(x))},
cos(x){return Math.cos(C3.toRadians(x))},tan(x){return Math.tan(C3.toRadians(x))},asin(x){return C3.toDegrees(Math.asin(x))},acos(x){return C3.toDegrees(Math.acos(x))},atan(x){return C3.toDegrees(Math.atan(x))},exp(x){return Math.exp(x)},ln(x){return Math.log(x)},log10(x){return Math.log10(x)},max(...args){let ret=args[0];if(typeof ret!=="number")ret=0;for(let i=1,len=args.length;i<len;++i){let n=args[i];if(typeof n!=="number")continue;if(ret<n)ret=n}return ret},min(...args){let ret=args[0];if(typeof ret!==
"number")ret=0;for(let i=1,len=args.length;i<len;++i){let n=args[i];if(typeof n!=="number")continue;if(ret>n)ret=n}return ret},clamp(x,l,u){return C3.clamp(x,l,u)},distance(x1,y1,x2,y2){return C3.distanceTo(x1,y1,x2,y2)},angle(x1,y1,x2,y2){return C3.toDegrees(C3.angleTo(x1,y1,x2,y2))},lerp(a,b,x){return C3.lerp(a,b,x)},unlerp(a,b,y){return C3.unlerp(a,b,y)},qarp(a,b,c,x){return C3.qarp(a,b,c,x)},cubic(a,b,c,d,x){return C3.cubic(a,b,c,d,x)},cosp(a,b,x){return C3.cosp(a,b,x)},anglediff(a,b){return C3.toDegrees(C3.angleDiff(C3.toRadians(a),
C3.toRadians(b)))},anglelerp(a,b,x){return C3.toDegrees(C3.angleLerp(C3.toRadians(a),C3.toRadians(b),x))},anglerotate(a,b,c){return C3.toDegrees(C3.angleRotate(C3.toRadians(a),C3.toRadians(b),C3.toRadians(c)))},setbit(n,b,v){n=n|0;b=b|0;v=v!==0?1:0;return n&~(1<<b)|v<<b},togglebit(n,b){n=n|0;b=b|0;return n^1<<b},getbit(n,b){n=n|0;b=b|0;return n&1<<b?1:0},newline(){return"\n"},uppercase(s){return typeof s==="string"?s.toUpperCase():""},lowercase(s){return typeof s==="string"?s.toLowerCase():""},left(text,
n){return typeof text==="string"?text.substr(0,n):""},mid(text,index,count){if(typeof text!=="string")return"";if(count<0)return text.substr(index);else return text.substr(index,count)},right(text,n){return typeof text==="string"?text.substr(Math.max(text.length-n,0)):""},trim(text){return typeof text==="string"?text.trim():""},tokenat(text,index,sep){if(typeof text!=="string"||typeof sep!=="string")return"";let arr=text.split(sep);index=Math.floor(index);if(index<0||index>=arr.length)return"";return arr[index]},
tokencount(text,sep){if(typeof text!=="string"||typeof sep!=="string"||!text.length)return 0;return text.split(sep).length},find(text,searchStr){if(typeof text==="string"&&typeof searchStr==="string")return text.search(new RegExp(C3.EscapeRegex(searchStr),"i"));else return-1},findcase(text,searchStr){if(typeof text==="string"&&typeof searchStr==="string")return text.search(new RegExp(C3.EscapeRegex(searchStr),""));else return-1},replace(text,find,replace){if(typeof text==="string"&&typeof find===
"string"&&typeof replace==="string")return text.replace(new RegExp(C3.EscapeRegex(find),"gi"),replace);else return typeof text==="string"?text:""},stringsub(str,...subs){let ret=str;for(let i=0,len=subs.length;i<len;++i)ret=ret.replaceAll(`{${i}}`,subs[i].toString());return ret},regexsearch(text,regex,flags){const cacheRegex=this.GetRegex(regex,flags);return text?text.search(cacheRegex):-1},regexreplace(text,regex,flags,replace){const cacheRegex=this.GetRegex(regex,flags);return text?text.replace(cacheRegex,
replace):""},regexmatchcount(text,regex,flags){const matches=this.GetRegexMatches(text.toString(),regex,flags);return matches?matches.length:0},regexmatchat(text,regex,flags,index){index=Math.floor(index);const matches=this.GetRegexMatches(text.toString(),regex,flags);if(!matches||index<0||index>=matches.length)return"";else return matches[index]},zeropad(n,d){let s=n<0?"-":"";if(n<0)n=-n;const zeroes=d-n.toString().length;s+="0".repeat(Math.max(zeroes,0));return s+n.toString()},urlencode(s){return encodeURIComponent(s)},
urldecode(s){return decodeURIComponent(s)},dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1E3},unixtime(){return Date.now()},time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFramesPerSecond()},cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},
windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},
scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return C3.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},vanishingpointx(){return this._runtime.GetCurrentLayout().GetVanishingPointX()*100},vanishingpointy(){return this._runtime.GetCurrentLayout().GetVanishingPointY()*
100},viewportleft(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getLeft():0},viewporttop(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getTop():0},viewportright(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getRight():0},viewportbottom(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);
return layer?layer.GetViewport3D().getBottom():0},viewportwidth(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().width():0},viewportheight(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().height():0},viewportmidx(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);if(layer){const vp=layer.GetViewport3D();return(vp.getLeft()+vp.getRight())/2}else return 0},
viewportmidy(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);if(layer){const vp=layer.GetViewport3D();return(vp.getTop()+vp.getBottom())/2}else return 0},canvastolayerx(layerParam,x,y){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.CanvasCssToLayer(x,y)[0]:0},canvastolayery(layerParam,x,y){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.CanvasCssToLayer(x,y)[1]:0},layertocanvasx(layerParam,x,y){const layer=
this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.LayerToCanvasCss(x,y)[0]:0},layertocanvasy(layerParam,x,y){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.LayerToCanvasCss(x,y)[1]:0},layertolayerx(fromLayerParam,toLayerParam,x,y){const layout=this._runtime.GetCurrentLayout();const fromLayer=layout.GetLayer(fromLayerParam);const toLayer=layout.GetLayer(toLayerParam);if(!fromLayer||!toLayer||fromLayer===toLayer)return x;const [canvasX,canvasY]=
fromLayer.LayerToCanvasCss(x,y);return toLayer.CanvasCssToLayer(canvasX,canvasY)[0]},layertolayery(fromLayerParam,toLayerParam,x,y){const layout=this._runtime.GetCurrentLayout();const fromLayer=layout.GetLayer(fromLayerParam);const toLayer=layout.GetLayer(toLayerParam);if(!fromLayer||!toLayer||fromLayer===toLayer)return y;const [canvasX,canvasY]=fromLayer.LayerToCanvasCss(x,y);return toLayer.CanvasCssToLayer(canvasX,canvasY)[1]},layerscale(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);
return layer?layer.GetOwnScale():0},layerangle(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?C3.toDegrees(layer.GetOwnAngle()):0},layeropacity(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetOpacity()*100:0},layerscalerate(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetScaleRate():0},layerscrollx(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);
return layer?layer.GetScrollX():0},layerscrolly(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetScrollY():0},layerparallaxx(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetParallaxX()*100:0},layerparallaxy(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetParallaxY()*100:0},layerzelevation(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);
return layer?layer.GetZElevation():0},layerindex(layerParam){const layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetIndex():-1},canvassnapshot(){const canvasManager=this._runtime.GetCanvasManager();if(!canvasManager)return"";return canvasManager.GetCanvasSnapshotUrl()},loopindex(name){const loopStack=this._loopStack;if(!loopStack.IsInLoop())return 0;if(name){const loop=loopStack.FindByName(name);return loop?loop.GetIndex():0}else return loopStack.GetCurrent().GetIndex()},
savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(name,str,...paramResults){const mapEntry=this._GetFunctionMap(name.toLowerCase(),false);if(!mapEntry){console.warn(`[Construct] Call mapped function: map name '${name}' not found; returning 0`);return 0}let functionBlock=mapEntry.strMap.get(str.toLowerCase());if(!functionBlock)if(mapEntry.defaultFunc)functionBlock=mapEntry.defaultFunc;else{console.warn(`[Construct] Call mapped function: no function associated with map '${name}' string '${str}'; returning 0 (consider setting a default)`);
return 0}const returnType=functionBlock.GetReturnType();const defaultReturnValue=functionBlock.GetDefaultReturnValue();if(returnType===0){console.warn(`[Construct] Call mapped function: map '${name}' string '${str}' has no return type so cannot be called from an expression; returning 0`);return 0}if(!functionBlock.IsEnabled())return defaultReturnValue;const runtime=this._runtime;const eventSheetManager=runtime.GetEventSheetManager();const currentEvent=eventSheetManager.GetCurrentEvent();const solModifiers=
currentEvent.GetSolModifiersIncludingParents();const hasAnySolModifiers=solModifiers.length>0;if(hasAnySolModifiers)if(functionBlock.IsCopyPicked())eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);const calleeParameters=functionBlock.GetFunctionParameters();for(let i=paramResults.length,len=calleeParameters.length;i<len;++i)paramResults.push(calleeParameters[i].GetInitialValue());const callEventBlock=functionBlock.GetEventBlock();const returnValue=callEventBlock.RunAsExpressionFunctionCall(callEventBlock.GetSolModifiersIncludingParents(),
functionBlock.IsCopyPicked(),returnType,defaultReturnValue,...paramResults);if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);return returnValue},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},imageloadingprogress(){if(this._imagesLoadingTotal===0)return 1;return this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){if(this._runtime.GetWebGPURenderer())return"webgpu";else return"webgl"},rendererdetail(){if(this._runtime.GetWebGPURenderer())return this._runtime.GetWebGPURenderer().GetAdapterInfoString();
else return this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){let ret=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*ret/(1024*1024))/100},rgb(r,g,b){return C3.PackRGB(r,g,b)},rgbex(r,g,b){return C3.PackRGBEx(r/100,g/100,b/100)},rgba(r,g,b,a){return C3.PackRGBAEx(r/100,g/100,b/100,a/100)},rgbex255(r,g,b){return C3.PackRGBEx(r/255,g/255,b/255)},rgba255(r,g,b,a){return C3.PackRGBAEx(r/255,g/255,b/255,a/255)},projectname(){return this._runtime.GetProjectName()},
projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}}};

}

{
'use strict';{const C3=self.C3;C3.Plugins.TiledBg=class TiledBgPlugin extends C3.SDKPluginBase{constructor(opts){super(opts)}Release(){super.Release()}}}
{const C3=self.C3;function WrapModeToStr(wrapMode){switch(wrapMode){case 0:return"clamp-to-edge";case 1:return"repeat";case 2:return"mirror-repeat"}return"repeat"}C3.Plugins.TiledBg.Type=class TiledBgType extends C3.SDKTypeBase{constructor(objectClass,exportData){super(objectClass);this._wrapX="repeat";this._wrapY="repeat";if(exportData){this._wrapX=WrapModeToStr(exportData[0]);this._wrapY=WrapModeToStr(exportData[1])}}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(renderer){return this.GetImageInfo().LoadStaticTexture(renderer,
{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}
{const C3=self.C3;const C3X=self.C3X;const INITIALLY_VISIBLE=0;const ORIGIN=1;const IMAGE_OFFSET_X=4;const IMAGE_OFFSET_Y=5;const IMAGE_SCALE_X=6;const IMAGE_SCALE_Y=7;const IMAGE_ANGLE=8;const ENABLE_TILE_RANDOMIZATION=9;const TILE_XRANDOM=10;const TILE_YRANDOM=11;const TILE_ANGLERANDOM=12;const TILE_BLENDMARGINX=13;const TILE_BLENDMARGINY=14;const tempRect=C3.New(C3.Rect);const tempQuad=C3.New(C3.Quad);const rcTex=C3.New(C3.Rect);const qTex=C3.New(C3.Quad);C3.Plugins.TiledBg.Instance=class TiledBgInstance extends C3.SDKWorldInstanceBase{constructor(inst,
properties){super(inst);this._imageOffsetX=0;this._imageOffsetY=0;this._imageScaleX=1;this._imageScaleY=1;this._imageAngle=0;this._enableTileRandomization=false;this._tileXRandom=0;this._tileYRandom=0;this._tileAngleRandom=0;this._tileBlendMarginX=0;this._tileBlendMarginY=0;this._ownImageInfo=null;if(properties){this.GetWorldInfo().SetVisible(!!properties[INITIALLY_VISIBLE]);this._imageOffsetX=properties[IMAGE_OFFSET_X];this._imageOffsetY=properties[IMAGE_OFFSET_Y];this._imageScaleX=properties[IMAGE_SCALE_X];
this._imageScaleY=properties[IMAGE_SCALE_Y];this._imageAngle=C3.toRadians(properties[IMAGE_ANGLE]);this._enableTileRandomization=!!properties[ENABLE_TILE_RANDOMIZATION];this._tileXRandom=properties[TILE_XRANDOM];this._tileYRandom=properties[TILE_YRANDOM];this._tileAngleRandom=properties[TILE_ANGLERANDOM];this._tileBlendMarginX=properties[TILE_BLENDMARGINX];this._tileBlendMarginY=properties[TILE_BLENDMARGINY]}}Release(){this._ReleaseOwnImage();super.Release()}_ReleaseOwnImage(){if(this._ownImageInfo){this._ownImageInfo.Release();
this._ownImageInfo=null}}CalculateTextureCoordsFor3DFace(areaWidth,areaHeight,outQuad){const imageInfo=this.GetCurrentImageInfo();const imageWidth=imageInfo.GetWidth();const imageHeight=imageInfo.GetHeight();const imageOffsetX=this._imageOffsetX/imageWidth;const imageOffsetY=this._imageOffsetY/imageHeight;const imageAngle=this._imageAngle;rcTex.set(0,0,areaWidth/(imageWidth*this._imageScaleX),areaHeight/(imageHeight*this._imageScaleY));rcTex.offset(-imageOffsetX,-imageOffsetY);if(imageAngle===0)outQuad.setFromRect(rcTex);
else outQuad.setFromRotatedRect(rcTex,-imageAngle)}SetTilingShaderProgram(renderer,setTextureFill=true){if(this._enableTileRandomization){const imageInfo=this.GetCurrentImageInfo();renderer.SetTileRandomizationMode();renderer.SetTileRandomizationInfo(imageInfo.GetWidth()*this._imageScaleX,imageInfo.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,this._tileBlendMarginY)}else if(setTextureFill)renderer.SetTextureFillMode()}Draw(renderer){const imageInfo=
this.GetCurrentImageInfo();const texture=imageInfo.GetTexture();if(texture===null)return;this.SetTilingShaderProgram(renderer);renderer.SetTexture(texture);const imageWidth=imageInfo.GetWidth();const imageHeight=imageInfo.GetHeight();const imageOffsetX=this._imageOffsetX/imageWidth;const imageOffsetY=this._imageOffsetY/imageHeight;const wi=this.GetWorldInfo();rcTex.set(0,0,wi.GetWidth()/(imageWidth*this._imageScaleX),wi.GetHeight()/(imageHeight*this._imageScaleY));rcTex.offset(-imageOffsetX,-imageOffsetY);
if(wi.HasMesh())this._DrawMesh(wi,renderer);else this._DrawStandard(wi,renderer)}_DrawStandard(wi,renderer){let quad=wi.GetBoundingQuad();if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);if(this._imageAngle===0)renderer.Quad3(quad,rcTex);else{qTex.setFromRotatedRect(rcTex,-this._imageAngle);renderer.Quad4(quad,qTex)}}_DrawMesh(wi,renderer){const transformedMesh=wi.GetTransformedMesh();if(wi.IsMeshChanged()){wi.CalculateBbox(tempRect,tempQuad,false);let quad=tempQuad;if(this._runtime.IsPixelRoundingEnabled())quad=
wi.PixelRoundQuad(quad);let texCoords=rcTex;if(this._imageAngle!==0){qTex.setFromRotatedRect(rcTex,-this._imageAngle);texCoords=qTex}transformedMesh.CalculateTransformedMesh(wi.GetSourceMesh(),quad,texCoords);wi.SetMeshChanged(false)}transformedMesh.Draw(renderer)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return true}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(true)}_SetImageOffsetX(x){if(this._imageOffsetX===
x)return;this._imageOffsetX=x;this._runtime.UpdateRender();this._SetMeshChanged()}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(y){if(this._imageOffsetY===y)return;this._imageOffsetY=y;this._runtime.UpdateRender();this._SetMeshChanged()}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(x){if(this._imageScaleX===x)return;this._imageScaleX=x;this._runtime.UpdateRender();this._SetMeshChanged()}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(y){if(this._imageScaleY===
y)return;this._imageScaleY=y;this._runtime.UpdateRender();this._SetMeshChanged()}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(a){if(this._imageAngle===a)return;this._imageAngle=a;this._runtime.UpdateRender();this._SetMeshChanged()}_GetImageAngle(){return this._imageAngle}_SetTileRandomizationEnabled(e){e=!!e;if(this._enableTileRandomization===e)return;this._enableTileRandomization=e;this._runtime.UpdateRender()}_IsTileRandomizationEnabled(){return this._enableTileRandomization}_SetTileXRandom(x){if(this._tileXRandom===
x)return;this._tileXRandom=x;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender()}_GetTileXRandom(){return this._tileXRandom}_SetTileYRandom(y){if(this._tileYRandom===y)return;this._tileYRandom=y;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender()}_GetTileYRandom(){return this._tileYRandom}_SetTileAngleRandom(a){if(this._tileAngleRandom===a)return;this._tileAngleRandom=a;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender()}_GetTileAngleRandom(){return this._tileAngleRandom}_SetTileBlendMarginX(x){if(this._tileBlendMarginX===
x)return;this._tileBlendMarginX=x;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender()}_GetTileBlendMarginX(){return this._tileBlendMarginX}_SetTileBlendMarginY(y){if(this._tileBlendMarginY===y)return;this._tileBlendMarginY=y;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender()}_GetTileBlendMarginY(){return this._tileBlendMarginY}SaveToJson(){const ret={};if(this._imageOffsetX!==0)ret["iox"]=this._imageOffsetX;if(this._imageOffsetY!==0)ret["ioy"]=this._imageOffsetY;if(this._imageScaleX!==
1)ret["isx"]=this._imageScaleX;if(this._imageScaleY!==1)ret["isy"]=this._imageScaleY;if(this._imageAngle!==0)ret["ia"]=this._imageAngle;if(this._enableTileRandomization)ret["tr"]=true;if(this._tileXRandom!==1)ret["trx"]=this._tileXRandom;if(this._tileYRandom!==1)ret["try"]=this._tileYRandom;if(this._tileAngleRandom!==1)ret["tra"]=this._tileAngleRandom;if(this._tileBlendMarginX!==.1)ret["trbmx"]=this._tileBlendMarginX;if(this._tileBlendMarginY!==.1)ret["trbmy"]=this._tileBlendMarginY;return ret}LoadFromJson(o){this._imageOffsetX=
o["iox"]||0;this._imageOffsetY=o["ioy"]||0;this._imageScaleX=o.hasOwnProperty("isx")?o["isx"]:1;this._imageScaleY=o.hasOwnProperty("isy")?o["isy"]:1;this._imageAngle=o["ia"]||0;this._enableTileRandomization=!!o["tr"];this._tileXRandom=o.hasOwnProperty("trx")?o["trx"]:1;this._tileYRandom=o.hasOwnProperty("try")?o["try"]:1;this._tileAngleRandom=o.hasOwnProperty("tra")?o["tra"]:1;this._tileBlendMarginX=o.hasOwnProperty("trbmx")?o["trbmx"]:.1;this._tileBlendMarginY=o.hasOwnProperty("trbmy")?o["trbmy"]:
.1}GetDebuggerProperties(){const propsPrefix="plugins.tiledbg.properties";return[{title:propsPrefix+".image-transform.name",properties:[{name:propsPrefix+".image-offset-x.name",value:this._GetImageOffsetX(),onedit:v=>this._SetImageOffsetX(v)},{name:propsPrefix+".image-offset-y.name",value:this._GetImageOffsetY(),onedit:v=>this._SetImageOffsetY(v)},{name:propsPrefix+".image-scale-x.name",value:this._GetImageScaleX()*100,onedit:v=>this._SetImageScaleX(v/100)},{name:propsPrefix+".image-scale-y.name",
value:this._GetImageScaleY()*100,onedit:v=>this._SetImageScaleY(v/100)},{name:propsPrefix+".image-angle.name",value:C3.toDegrees(this._GetImageAngle()),onedit:v=>this._SetImageAngle(C3.toRadians(v))}]},{title:propsPrefix+".tile-randomization.name",properties:[{name:propsPrefix+".enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:v=>this._SetTileRandomizationEnabled(v)},{name:propsPrefix+".x-random.name",value:this._GetTileXRandom()*100,onedit:v=>this._SetTileXRandom(v/
100)},{name:propsPrefix+".y-random.name",value:this._GetTileYRandom()*100,onedit:v=>this._SetTileYRandom(v/100)},{name:propsPrefix+".angle-random.name",value:this._GetTileAngleRandom()*100,onedit:v=>this._SetTileAngleRandom(v/100)},{name:propsPrefix+".blend-margin-x.name",value:this._GetTileBlendMarginX()*100,onedit:v=>this._SetTileBlendMarginX(v/100)},{name:propsPrefix+".blend-margin-y.name",value:this._GetTileBlendMarginY()*100,onedit:v=>this._SetTileBlendMarginY(v/100)}]}]}GetPropertyValueByIndex(index){switch(index){case IMAGE_OFFSET_X:return this._GetImageOffsetX();
case IMAGE_OFFSET_Y:return this._GetImageOffsetY();case IMAGE_SCALE_X:return this._GetImageScaleX();case IMAGE_SCALE_Y:return this._GetImageScaleY();case IMAGE_ANGLE:return this._GetImageAngle();case ENABLE_TILE_RANDOMIZATION:return this._IsTileRandomizationEnabled();case TILE_XRANDOM:return this._GetTileXRandom();case TILE_YRANDOM:return this._GetTileYRandom();case TILE_ANGLERANDOM:return this._GetTileAngleRandom();case TILE_BLENDMARGINX:return this._GetTileBlendMarginX();case TILE_BLENDMARGINY:return this._GetTileBlendMarginY()}}SetPropertyValueByIndex(index,
value){switch(index){case IMAGE_OFFSET_X:this._SetImageOffsetX(value);break;case IMAGE_OFFSET_Y:this._SetImageOffsetY(value);break;case IMAGE_SCALE_X:this._SetImageScaleX(value);break;case IMAGE_SCALE_Y:this._SetImageScaleY(value);break;case IMAGE_ANGLE:this._SetImageAngle(value);break;case ENABLE_TILE_RANDOMIZATION:this._SetTileRandomizationEnabled(!!value);break;case TILE_XRANDOM:this._SetTileXRandom(value);break;case TILE_YRANDOM:this._SetTileYRandom(value);break;case TILE_ANGLERANDOM:this._SetTileAngleRandom(value);
break;case TILE_BLENDMARGINX:this._SetTileBlendMarginX(value);break;case TILE_BLENDMARGINY:this._SetTileBlendMarginY(value);break}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}};const map=new WeakMap;self.ITiledBackgroundInstance=class ITiledBackgroundInstance extends self.IWorldInstance{constructor(){super();map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(x){C3X.RequireFiniteNumber(x);map.get(this)._SetImageOffsetX(x)}get imageOffsetX(){return map.get(this)._GetImageOffsetX()}set imageOffsetY(y){C3X.RequireFiniteNumber(y);
map.get(this)._SetImageOffsetY(y)}get imageOffsetY(){return map.get(this)._GetImageOffsetY()}setImageOffset(x,y){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);const inst=map.get(this);inst._SetImageOffsetX(x);inst._SetImageOffsetY(y)}getImageOffset(){const inst=map.get(this);return[inst._GetImageOffsetX(),inst._GetImageOffsetY()]}set imageScaleX(x){C3X.RequireFiniteNumber(x);map.get(this)._SetImageScaleX(x)}get imageScaleX(){return map.get(this)._GetImageScaleX()}set imageScaleY(y){C3X.RequireFiniteNumber(y);
map.get(this)._SetImageScaleY(y)}get imageScaleY(){return map.get(this)._GetImageScaleY()}setImageScale(x,y){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);const inst=map.get(this);inst._SetImageScaleX(x);inst._SetImageScaleY(y)}getImageScale(){const inst=map.get(this);return[inst._GetImageScaleX(),inst._GetImageScaleY()]}set imageAngle(a){C3X.RequireFiniteNumber(a);map.get(this)._SetImageAngle(a)}get imageAngle(){return map.get(this)._GetImageAngle()}set imageAngleDegrees(a){C3X.RequireFiniteNumber(a);
map.get(this)._SetImageAngle(C3.toRadians(a))}get imageAngleDegrees(){return C3.toDegrees(map.get(this)._GetImageAngle())}get imageWidth(){return map.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const imageInfo=map.get(this).GetCurrentImageInfo();return[imageInfo.GetWidth(),imageInfo.GetHeight()]}set enableTileRandomization(e){map.get(this)._SetTileRandomizationEnabled(!!e)}get enableTileRandomization(){return map.get(this)._IsTileRandomizationEnabled()}set tileXRandom(x){C3X.RequireFiniteNumber(x);
map.get(this)._SetTileXRandom(x)}get tileXRandom(){return map.get(this)._GetTileXRandom()}set tileYRandom(y){C3X.RequireFiniteNumber(y);map.get(this)._SetTileYRandom(y)}get tileYRandom(){return map.get(this)._GetTileYRandom()}setTileRandom(x,y){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);const inst=map.get(this);inst._SetTileXRandom(x);inst._SetTileYRandom(y)}getTileRandom(){const inst=map.get(this);return[inst._GetTileXRandom(),inst._GetTileYRandom()]}set tileAngleRandom(a){C3X.RequireFiniteNumber(a);
map.get(this)._SetTileAngleRandom(a)}get tileAngleRandom(){return map.get(this)._GetTileAngleRandom()}set tileBlendMarginX(x){C3X.RequireFiniteNumber(x);map.get(this)._SetTileBlendMarginX(x)}get tileBlendMarginX(){return map.get(this)._GetTileBlendMarginX()}set tileBlendMarginY(y){C3X.RequireFiniteNumber(y);map.get(this)._SetTileBlendMarginY(y)}get tileBlendMarginY(){return map.get(this)._GetTileBlendMarginY()}setTileBlendMargin(x,y){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);const inst=
map.get(this);inst._SetTileBlendMarginX(x);inst._SetTileBlendMarginY(y)}getTileBlendMargin(){const inst=map.get(this);return[inst._GetTileBlendMarginX(),inst._GetTileBlendMarginY()]}async replaceImage(blob){C3X.RequireInstanceOf(blob,Blob);const sdkInst=map.get(this);const runtime=sdkInst.GetRuntime();const imageInfo=C3.New(C3.ImageInfo);imageInfo.LoadDynamicBlobAsset(runtime,blob);await imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling(),wrapX:"repeat",wrapY:"repeat"});
if(sdkInst.WasReleased()){imageInfo.Release();return}sdkInst._ReleaseOwnImage();sdkInst._ownImageInfo=imageInfo;runtime.UpdateRender()}}}{const C3=self.C3;C3.Plugins.TiledBg.Cnds={OnURLLoaded(){return true},OnURLFailed(){return true},IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled()}}}
{const C3=self.C3;C3.Plugins.TiledBg.Acts={SetImageOffsetX(x){this._SetImageOffsetX(x)},SetImageOffsetY(y){this._SetImageOffsetY(y)},SetImageScaleX(x){this._SetImageScaleX(x/100)},SetImageScaleY(y){this._SetImageScaleY(y/100)},SetImageAngle(a){this._SetImageAngle(C3.toRadians(a))},SetTileRandomizationEnabled(e){this._SetTileRandomizationEnabled(e)},SetTilePosRandom(x,y){this._SetTileXRandom(x/100);this._SetTileYRandom(y/100)},SetTileAngleRandom(a){this._SetTileAngleRandom(a/100)},SetTileBlendMargin(x,
y){this._SetTileBlendMarginX(x/100);this._SetTileBlendMarginY(y/100)},SetEffect(effect){this.GetWorldInfo().SetBlendMode(effect);this._runtime.UpdateRender()},async LoadURL(url,crossOrigin){if(this._ownImageInfo&&this._ownImageInfo.GetURL()===url)return;const runtime=this._runtime;const imageInfo=C3.New(C3.ImageInfo);try{await imageInfo.LoadDynamicAsset(runtime,url);if(!imageInfo.IsLoaded())throw new Error("image failed to load");if(this.WasReleased()){imageInfo.Release();return null}const texture=
await imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling(),wrapX:"repeat",wrapY:"repeat"});if(!texture)return}catch(err){console.error("Load image from URL failed: ",err);if(!this.WasReleased())this.Trigger(C3.Plugins.TiledBg.Cnds.OnURLFailed);return}if(this.WasReleased()){imageInfo.Release();return}this._ReleaseOwnImage();this._ownImageInfo=imageInfo;runtime.UpdateRender();await this.TriggerAsync(C3.Plugins.TiledBg.Cnds.OnURLLoaded)}}}
{const C3=self.C3;C3.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return this._imageScaleX*100},ImageScaleY(){return this._imageScaleY*100},ImageAngle(){return C3.toDegrees(this._imageAngle)},TileXRandom(){return this._GetTileXRandom()*100},TileYRandom(){return this._GetTileYRandom()*100},TileAngleRandom(){return this._GetTileAngleRandom()*
100},TileBlendMarginX(){return this._GetTileBlendMarginX()*100},TileBlendMarginY(){return this._GetTileBlendMarginY()*100}}};

}

{
'use strict';{const C3=self.C3;C3.Plugins.Sprite=class SpritePlugin extends C3.SDKPluginBase{constructor(opts){super(opts)}Release(){super.Release()}}}
{const C3=self.C3;const C3X=self.C3X;const spawnPickStack=[];C3.Plugins.Sprite.Type=class SpriteType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass);this._animations=objectClass.GetAnimations()}Release(){C3.clearArray(this._animations);super.Release()}OnCreate(){for(const a of this._animations)a.LoadAllAssets(this._runtime)}LoadTextures(renderer){const opts={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map(a=>a.LoadAllTextures(renderer,opts)))}ReleaseTextures(){for(const a of this._animations)a.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(const inst of this._objectClass.instancesIncludingPendingCreate())inst.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(doPick){C3.Plugins.Sprite.FinishCollisionCondition(this,
doPick)}BeforeRunAction(method){spawnPickStack.push({objectClass:null,createHierarchy:false,instances:[]})}_SpawnPickInstance(objectClass,inst,createHierarchy){const entry=spawnPickStack.at(-1);entry.objectClass=objectClass;entry.createHierarchy=createHierarchy;entry.instances.push(inst)}AfterRunAction(method){const entry=spawnPickStack.pop();const objectClass=entry.objectClass;const createHierarchy=entry.createHierarchy;if(!objectClass)return;const pickMap=new Map;for(const inst of entry.instances)inst.CollectInstancesToPick(pickMap,
objectClass,createHierarchy);for(const [pickObjectClass,instSet]of pickMap)pickObjectClass.GetCurrentSol().SetSetPicked(instSet)}_AddAnimation(animName){const addedAnim=this.GetObjectClass().AddAnimation(animName);const runtime=this.GetRuntime();const defaultFrame=addedAnim.GetFrameAt(0);defaultFrame.GetImageInfo().LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling()}).then(()=>this._UpdateAllCurrentTexture());return addedAnim}_RemoveAnimation(animName){for(const inst of this._objectClass.instancesIncludingPendingCreate())inst.GetSdkInstance()._OnAnimationRemoved(animName);
this.GetObjectClass().RemoveAnimation(animName)}_AddAnimationFrame(animationName,where){const animation=this._objectClass.GetAnimationByName(animationName);if(!animation)throw new Error(`cannot find animation name '${animationName}'`);let index=animation.FrameTagOrIndexToIndex(where);if(index<0)index+=animation.GetFrameCount()+1;const frame=C3.AnimationFrameInfo.CreateDynamic(this.GetRuntime());animation.InsertFrameAt(frame,index);const runtime=this.GetRuntime();frame.GetImageInfo().LoadStaticTexture(runtime.GetRenderer(),
{sampling:runtime.GetSampling()}).then(()=>this._UpdateAllCurrentTexture());for(const inst of this._objectClass.instancesIncludingPendingCreate())inst.GetSdkInstance()._OnAnimationFramesChanged();return frame}_RemoveAnimationFrame(animationName,where){const animation=this._objectClass.GetAnimationByName(animationName);if(!animation)throw new Error(`cannot find animation name '${animationName}'`);if(animation.GetFrameCount()===1)throw new Error(`cannot remove last frame from animation '${animationName}'`);
let index=animation.FrameTagOrIndexToIndex(where);if(index<0)index+=animation.GetFrameCount();animation.RemoveFrameAt(index);for(const inst of this._objectClass.instancesIncludingPendingCreate())inst.GetSdkInstance()._OnAnimationFramesChanged()}GetScriptInterfaceClass(){return self.ISpriteObjectType}};const map=new WeakMap;self.ISpriteObjectType=class ISpriteObjectType extends self.IObjectClass{constructor(objectType){super(objectType);map.set(this,objectType.GetSdkType())}getAnimation(name){C3X.RequireString(name);
const a=map.get(this).GetObjectClass().GetAnimationByName(name);return a?a.GetIAnimation():null}getAllAnimations(){return map.get(this).GetObjectClass().GetAllAnimations().map(a=>a.GetIAnimation())}addAnimation(animName){C3X.RequireString(animName);return map.get(this)._AddAnimation(animName).GetIAnimation()}removeAnimation(animName){C3X.RequireString(animName);map.get(this)._RemoveAnimation(animName)}addAnimationFrame(animName,where){C3X.RequireString(animName);if(typeof where!=="number"&&typeof where!==
"string")throw new TypeError("invalid insert location");return map.get(this)._AddAnimationFrame(animName,where).GetIAnimationFrame()}removeAnimationFrame(animName,where){C3X.RequireString(animName);if(typeof where!=="number"&&typeof where!=="string")throw new TypeError("invalid insert location");map.get(this)._RemoveAnimationFrame(animName,where)}}}
{const C3=self.C3;const C3X=self.C3X;const INITIALLY_VISIBLE=0;const INITIAL_ANIMATION=1;const INITIAL_FRAME=2;const ENABLE_COLLISIONS=3;const tempRect=C3.New(C3.Rect);const tempQuad=C3.New(C3.Quad);const tempVec2=C3.New(C3.Vector2);const FLAG_PLAYING_FORWARDS=1<<0;const FLAG_ANIMATION_PLAYING=1<<1;const FLAG_ANIMATION_TRIGGER=1<<2;C3.Plugins.Sprite.Instance=class SpriteInstance extends C3.SDKWorldInstanceBase{constructor(inst,properties){super(inst);let initiallyVisible=true;let initialAnimation=
"";let initialFrame=0;let collisionEnabled=true;if(properties){initiallyVisible=!!properties[INITIALLY_VISIBLE];initialAnimation=properties[INITIAL_ANIMATION];initialFrame=properties[INITIAL_FRAME];collisionEnabled=properties[ENABLE_COLLISIONS]}this._currentAnimation=this._objectClass.GetAnimationByName(initialAnimation)||this._objectClass.GetAnimations()[0];this._currentFrameIndex=C3.clamp(initialFrame,0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);
const initialImageInfo=this._currentAnimationFrame.GetImageInfo();this._currentTexture=initialImageInfo.GetTexture();this._currentRcTex=initialImageInfo.GetTexRect();this._currentQuadTex=initialImageInfo.GetTexQuad();this.HandleRendererContextLoss();inst.SetFlag(FLAG_ANIMATION_PLAYING,true);inst.SetFlag(FLAG_PLAYING_FORWARDS,this._currentAnimation.GetSpeed()>=0);this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed());this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo();
this._animationTimer=C3.New(C3.KahanSum);this._frameStartTime=0;this._animationRepeats=0;this._animTriggerName="";this._changeAnimFrameIndex=-1;this._changeAnimationName="";this._changeAnimationFrom=0;const wi=this.GetWorldInfo();this._bquadRef=wi.GetBoundingQuad();wi.SetVisible(initiallyVisible);wi.SetCollisionEnabled(collisionEnabled);wi.SetOriginX(this._currentAnimationFrame.GetOriginX());wi.SetOriginY(this._currentAnimationFrame.GetOriginY());wi.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly());
wi.SetBboxChanged();if((this._objectClass.GetAnimationCount()!==1||this._objectClass.GetAnimations()[0].GetFrameCount()!==1)&&this._currentAnimationSpeed!==0)this._StartTicking()}Release(){this._currentAnimation=null;this._currentAnimationFrame=null;this._currentTexture=null;this._animationTimer=null;super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return true}OnRendererContextLost(){this._currentTexture=null}OnRendererContextRestored(){this._UpdateCurrentTexture()}Draw(renderer){const texture=
this._currentTexture;if(texture===null)return;renderer.SetTexture(texture);const wi=this.GetWorldInfo();if(wi.HasMesh())this._DrawMesh(wi,renderer);else this._DrawStandard(wi,renderer)}_DrawStandard(wi,renderer){let quad=this._bquadRef;if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);renderer.Quad4(quad,this._currentQuadTex)}_DrawMesh(wi,renderer){const transformedMesh=wi.GetTransformedMesh();if(wi.IsMeshChanged()){wi.CalculateBbox(tempRect,tempQuad,false);let quad=tempQuad;
if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);transformedMesh.CalculateTransformedMesh(wi.GetSourceMesh(),quad,this._currentQuadTex);wi.SetMeshChanged(false)}transformedMesh.Draw(renderer)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(FLAG_ANIMATION_PLAYING)}SetAnimationPlaying(e){this._inst.SetFlag(FLAG_ANIMATION_PLAYING,e)}IsPlayingForwards(){return this._inst.GetFlag(FLAG_PLAYING_FORWARDS)}SetPlayingForwards(e){this._inst.SetFlag(FLAG_PLAYING_FORWARDS,
e)}IsInAnimationTrigger(){return this._inst.GetFlag(FLAG_ANIMATION_TRIGGER)}SetInAnimationTrigger(e){this._inst.SetFlag(FLAG_ANIMATION_TRIGGER,e)}Tick(){if(this._changeAnimationName)this._DoChangeAnimation();if(this._changeAnimFrameIndex>=0)this._DoChangeAnimFrame();const currentAnimationSpeed=this._currentAnimationSpeed;if(!this.IsAnimationPlaying()||currentAnimationSpeed===0){this._StopTicking();return}const dt=this._runtime.GetDt(this._inst);this._animationTimer.Add(dt);const now=this.GetAnimationTime();
const prevFrame=this._currentAnimationFrame;const currentFrameTime=prevFrame.GetDuration()/currentAnimationSpeed;if(now<this._frameStartTime+currentFrameTime)return;const currentAnimation=this._currentAnimation;const repeatTo=this._currentAnimationRepeatTo;const frameCount=currentAnimation.GetFrameCount();const repeatCount=currentAnimation.GetRepeatCount();const isLooping=currentAnimation.IsLooping();const isPingPong=currentAnimation.IsPingPong();if(this.IsPlayingForwards())this._currentFrameIndex++;
else this._currentFrameIndex--;this._frameStartTime+=currentFrameTime;if(this._currentFrameIndex>=frameCount)if(isPingPong){this.SetPlayingForwards(false);this._currentFrameIndex=frameCount-2}else if(isLooping)this._currentFrameIndex=repeatTo;else{this._animationRepeats++;if(this._animationRepeats>=repeatCount)this._FinishAnimation(false);else this._currentFrameIndex=repeatTo}if(this._currentFrameIndex<0)if(isPingPong){this._currentFrameIndex=1;this.SetPlayingForwards(true);if(!isLooping){this._animationRepeats++;
if(this._animationRepeats>=repeatCount)this._FinishAnimation(true)}}else if(isLooping)this._currentFrameIndex=repeatTo;else{this._animationRepeats++;if(this._animationRepeats>=repeatCount)this._FinishAnimation(true);else this._currentFrameIndex=repeatTo}this._currentFrameIndex=C3.clamp(this._currentFrameIndex,0,frameCount-1);const nextFrame=currentAnimation.GetFrameAt(this._currentFrameIndex);if(now>this._frameStartTime+nextFrame.GetDuration()/currentAnimationSpeed)this._frameStartTime=now;this._OnFrameChanged(prevFrame,
nextFrame)}_FinishAnimation(reverse){this._currentFrameIndex=reverse?0:this._currentAnimation.GetFrameCount()-1;this.SetAnimationPlaying(false);this._animTriggerName=this._currentAnimation.GetName();this.SetInAnimationTrigger(true);this.DispatchScriptEvent("animationend",false,{animationName:this._animTriggerName});this.Trigger(C3.Plugins.Sprite.Cnds.OnAnyAnimFinished);this.Trigger(C3.Plugins.Sprite.Cnds.OnAnimFinished);this.SetInAnimationTrigger(false);this._animationRepeats=0}_OnFrameChanged(prevFrame,
nextFrame,opts){if(prevFrame===nextFrame)return;const wi=this.GetWorldInfo();const prevImage=prevFrame.GetImageInfo();const nextImage=nextFrame.GetImageInfo();const oldW=prevImage.GetWidth();const oldH=prevImage.GetHeight();const newW=nextImage.GetWidth();const newH=nextImage.GetHeight();if(opts&&opts.onFrameChange)opts.onFrameChange(wi,oldW,oldH,newW,newH);else{if(oldW!==newW)wi.SetWidth(wi.GetWidth()*(newW/oldW));if(oldH!==newH)wi.SetHeight(wi.GetHeight()*(newH/oldH))}wi.SetOriginX(nextFrame.GetOriginX());
wi.SetOriginY(nextFrame.GetOriginY());wi.SetSourceCollisionPoly(nextFrame.GetCollisionPoly());wi.SetBboxChanged();this._currentAnimationFrame=nextFrame;this._currentTexture=nextImage.GetTexture();this._currentRcTex=nextImage.GetTexRect();this._currentQuadTex=nextImage.GetTexQuad();const behaviorInstances=this.GetInstance().GetBehaviorInstances();for(let i=0,len=behaviorInstances.length;i<len;++i)behaviorInstances[i].OnSpriteFrameChanged(prevFrame,nextFrame);this.DispatchScriptEvent("framechange",
false,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex});this.Trigger(C3.Plugins.Sprite.Cnds.OnFrameChanged);this._runtime.UpdateRender()}_StartAnim(from){this.SetAnimationPlaying(true);this._frameStartTime=this.GetAnimationTime();if(from===1&&this._currentFrameIndex!==0){this._changeAnimFrameIndex=0;if(!this.IsInAnimationTrigger())this._DoChangeAnimFrame()}this._StartTicking()}_SetAnim(animName,from,force){this._changeAnimationName=animName;this._changeAnimationFrom=
from;this._StartTicking();if(force||!this.IsInAnimationTrigger())this._DoChangeAnimation()}_GetCurrentAnimation(){return this._currentAnimation}_GetCurrentAnimationName(){if(this._changeAnimationName)return this._changeAnimationName;else return this._currentAnimation.GetName()}_OnAnimationRemoved(animName){if(C3.equalsNoCase(animName,this._GetCurrentAnimationName()))this._SetAnim(this._objectClass.GetFirstAnimation().GetName(),1,true)}_SetAnimFrame(frameNum){if(typeof frameNum==="string")if(String(Number(frameNum))===
frameNum)frameNum=Number(frameNum);else{const animation=this._objectClass.GetAnimationByName(this._GetCurrentAnimationName());if(!animation)return;frameNum=animation.GetFrameIndexByTag(frameNum);if(frameNum===-1)return}if(!isFinite(frameNum))return;this._changeAnimFrameIndex=frameNum;if(!this.IsInAnimationTrigger())this._DoChangeAnimFrame()}_OnAnimationFramesChanged(){if(this._changeAnimationName||this._changeAnimFrameIndex!==-1)return;const curFrame=this._currentAnimationFrame;const newFrameAtSameIndex=
this._currentAnimation.GetFrameAt(C3.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1));if(curFrame!==newFrameAtSameIndex)this._OnFrameChanged(curFrame,newFrameAtSameIndex);if(this._currentAnimation.GetFrameCount()>1&&this._currentAnimationSpeed>0)this._StartTicking()}_GetAnimFrame(){return this._currentFrameIndex}_GetAnimFrameTag(){return this._currentAnimationFrame.GetTag()}_SetAnimSpeed(s){this._currentAnimationSpeed=Math.abs(s);this.SetPlayingForwards(s>=0);if(this._currentAnimationSpeed>
0)this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(f){if(typeof f==="string"){f=this._currentAnimation.GetFrameIndexByTag(f);if(f===-1)return}f=C3.clamp(Math.floor(f),0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationRepeatTo=f}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(opts){const prevFrame=this._currentAnimationFrame;const animation=this._objectClass.GetAnimationByName(this._changeAnimationName);
this._changeAnimationName="";if(!animation)return;if(animation===this._currentAnimation&&this.IsAnimationPlaying())return;this._currentAnimation=animation;this.SetPlayingForwards(animation.GetSpeed()>=0);this._currentAnimationSpeed=Math.abs(animation.GetSpeed());this._currentAnimationRepeatTo=animation.GetRepeatTo();this._currentFrameIndex=C3.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);if(this._changeAnimationFrom===1)this._currentFrameIndex=0;this.SetAnimationPlaying(true);
this._frameStartTime=this.GetAnimationTime();const nextFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(prevFrame,nextFrame,opts)}_DoChangeAnimFrame(force){const prevFrame=this._currentAnimationFrame;const prevFrameIndex=this._currentFrameIndex;this._currentFrameIndex=C3.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1);this._changeAnimFrameIndex=-1;if(!force&&prevFrameIndex===this._currentFrameIndex)return;const nextFrame=
this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(prevFrame,nextFrame);this._frameStartTime=this.GetAnimationTime()}_UpdateCurrentTexture(){const curImageInfo=this._currentAnimationFrame.GetImageInfo();this._currentTexture=curImageInfo.GetTexture();this._currentRcTex=curImageInfo.GetTexRect();this._currentQuadTex=curImageInfo.GetTexQuad();this.GetWorldInfo().SetMeshChanged(true)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(nameOrIndex){const frame=
this._currentAnimationFrame;const wi=this.GetWorldInfo();let ip=null;if(typeof nameOrIndex==="string")ip=frame.GetImagePointByName(nameOrIndex);else if(typeof nameOrIndex==="number")ip=frame.GetImagePointByIndex(nameOrIndex-1);else throw new TypeError("expected string or number");let ptZ=wi.GetTotalZElevation();if(!ip)return[wi.GetX(),wi.GetY(),ptZ];tempVec2.copy(ip.GetVec2());if(wi.HasMesh()){const [tx,ty,tz]=wi.GetSourceMesh().TransformPoint(tempVec2.getX(),tempVec2.getY());tempVec2.set(tx,ty);
ptZ+=tz}tempVec2.offset(-frame.GetOriginX(),-frame.GetOriginY());tempVec2.scale(wi.GetWidth(),wi.GetHeight());tempVec2.rotate(wi.GetAngle());tempVec2.offset(wi.GetX(),wi.GetY());return[tempVec2.getX(),tempVec2.getY(),ptZ]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(index){index=Math.floor(index);const wi=this.GetWorldInfo();const poly=wi.GetTransformedCollisionPoly();const pointCount=poly.pointCount();if(index===pointCount)index=
0;if(index<0||index>=pointCount)return[0,0];const pointsArr=poly.pointsArr();return[pointsArr[index*2+0]+wi.GetX(),pointsArr[index*2+1]+wi.GetY()]}GetDebuggerProperties(){const Acts=C3.Plugins.Sprite.Acts;const prefix="plugins.sprite.debugger.animation-properties";return[{title:prefix+".title",properties:[{name:prefix+".current-animation",value:this._currentAnimation.GetName(),onedit:v=>this.CallAction(Acts.SetAnim,v,0)},{name:prefix+".current-frame",value:this._currentFrameIndex,onedit:v=>this.CallAction(Acts.SetAnimFrame,
v)},{name:prefix+".is-playing",value:this.IsAnimationPlaying(),onedit:v=>v?this.CallAction(Acts.StartAnim,0):this.CallAction(Acts.StopAnim)},{name:prefix+".speed",value:this._currentAnimationSpeed,onedit:v=>this.CallAction(Acts.SetAnimSpeed,v)},{name:prefix+".repeats",value:this._animationRepeats,onedit:v=>this._animationRepeats=v}]}]}SaveToJson(){const o={"a":this._currentAnimation.GetSID()};if(this._frameStartTime!==0)o["fs"]=this._frameStartTime;const animTime=this.GetAnimationTime();if(animTime!==
0)o["at"]=animTime;if(this._currentFrameIndex!==0)o["f"]=this._currentFrameIndex;if(this._currentAnimationSpeed!==0)o["cas"]=this._currentAnimationSpeed;if(this._animationRepeats!==1)o["ar"]=this._animationRepeats;if(this._currentAnimationRepeatTo!==0)o["rt"]=this._currentAnimationRepeatTo;if(!this.IsAnimationPlaying())o["ap"]=this.IsAnimationPlaying();if(!this.IsPlayingForwards())o["af"]=this.IsPlayingForwards();const wi=this.GetWorldInfo();if(wi.IsCollisionEnabled())o["ce"]=wi.IsCollisionEnabled();
return o}LoadFromJson(o){const anim=this.GetObjectClass().GetAnimationBySID(o["a"]);if(anim)this._currentAnimation=anim;this._frameStartTime=o.hasOwnProperty("fs")?o["fs"]:0;this._animationTimer.Set(o.hasOwnProperty("at")?o["at"]:0);const frameIndex=o.hasOwnProperty("f")?o["f"]:0;this._currentFrameIndex=C3.clamp(frameIndex,0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationSpeed=o.hasOwnProperty("cas")?o["cas"]:0;this._animationRepeats=o.hasOwnProperty("ar")?o["ar"]:1;const repeatToIndex=
o.hasOwnProperty("rt")?o["rt"]:0;this._currentAnimationRepeatTo=C3.clamp(repeatToIndex,0,this._currentAnimation.GetFrameCount()-1);this.SetAnimationPlaying(o.hasOwnProperty("ap")?!!o["ap"]:true);this.SetPlayingForwards(o.hasOwnProperty("af")?!!o["af"]:true);const nextFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._currentAnimationFrame=nextFrame;this._UpdateCurrentTexture();const wi=this.GetWorldInfo();wi.SetOriginX(nextFrame.GetOriginX());wi.SetOriginY(nextFrame.GetOriginY());
wi.SetSourceCollisionPoly(nextFrame.GetCollisionPoly());wi.SetCollisionEnabled(!!o["ce"]);if(this.IsAnimationPlaying())this._StartTicking()}GetPropertyValueByIndex(index){const wi=this.GetWorldInfo();switch(index){case ENABLE_COLLISIONS:return wi.IsCollisionEnabled();case INITIAL_FRAME:return C3.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case INITIAL_ANIMATION:return this._currentAnimation.GetName()}}SetPropertyValueByIndex(index,value,opts){const wi=this.GetWorldInfo();
switch(index){case ENABLE_COLLISIONS:{wi.SetCollisionEnabled(!!value);break}case INITIAL_FRAME:{this.SetAnimationPlaying(false);const totalFrames=this._currentAnimation.GetFrameCount()-1;const nextIndex=value=C3.clamp(value,0,totalFrames);const prevFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);const nextFrame=this._currentAnimation.GetFrameAt(nextIndex);this._OnFrameChanged(prevFrame,nextFrame,opts);this._currentFrameIndex=C3.clamp(nextIndex,0,totalFrames);break}case INITIAL_ANIMATION:{this._changeAnimationName=
value;this._DoChangeAnimation(opts);const totalFrames=this._currentAnimation.GetFrameCount();if(totalFrames>1&&this._currentAnimation.GetSpeed()>0)this._StartTicking();else this._StopTicking();break}}}GetScriptInterfaceClass(){return self.ISpriteInstance}};const map=new WeakMap;const ANIM_FROM_MODES=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=class ISpriteInstance extends self.IWorldInstance{constructor(){super();map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return map.get(this).GetImagePointCount()}getImagePointX(nameOrIndex){return this.getImagePoint(nameOrIndex)[0]}getImagePointY(nameOrIndex){return this.getImagePoint(nameOrIndex)[1]}getImagePointZ(nameOrIndex){return this.getImagePoint(nameOrIndex)[2]}getImagePoint(nameOrIndex){if(typeof nameOrIndex!==
"string"&&typeof nameOrIndex!=="number")throw new TypeError("expected string or number");return map.get(this).GetImagePoint(nameOrIndex)}getPolyPointCount(){return map.get(this).GetCollisionPolyPointCount()}getPolyPointX(index){C3X.RequireFiniteNumber(index);return map.get(this).GetCollisionPolyPoint(index)[0]}getPolyPointY(index){C3X.RequireFiniteNumber(index);return map.get(this).GetCollisionPolyPoint(index)[1]}getPolyPoint(index){C3X.RequireFiniteNumber(index);return map.get(this).GetCollisionPolyPoint(index)}stopAnimation(){map.get(this).SetAnimationPlaying(false)}startAnimation(from=
"current-frame"){C3X.RequireString(from);const f=ANIM_FROM_MODES.get(from);if(typeof f==="undefined")throw new Error("invalid mode");map.get(this)._StartAnim(f)}setAnimation(name,from="beginning"){C3X.RequireString(name);C3X.RequireString(from);const f=ANIM_FROM_MODES.get(from);if(typeof f==="undefined")throw new Error("invalid mode");const inst=map.get(this);if(!inst.GetObjectClass().GetAnimationByName(name))throw new Error(`animation name "${name}" does not exist`);inst._SetAnim(name,f)}getAnimation(name){C3X.RequireString(name);
const a=map.get(this).GetObjectClass().GetAnimationByName(name);return a?a.GetIAnimation():null}get animation(){return map.get(this)._GetCurrentAnimation().GetIAnimation()}get animationName(){return map.get(this)._GetCurrentAnimationName()}set animationFrame(frameIndex){C3X.RequireFiniteNumber(frameIndex);map.get(this)._SetAnimFrame(frameIndex)}get animationFrame(){return map.get(this)._GetAnimFrame()}set animationFrameTag(frameTag){C3X.RequireString(frameTag);map.get(this)._SetAnimFrame(frameTag)}get animationFrameTag(){return map.get(this)._GetAnimFrameTag()}set animationSpeed(s){C3X.RequireFiniteNumber(s);
map.get(this)._SetAnimSpeed(s)}get animationSpeed(){return map.get(this)._GetAnimSpeed()}set animationRepeatToFrame(f){C3X.RequireFiniteNumber(f);map.get(this)._SetAnimRepeatToFrame(f)}get animationRepeatToFrame(){return map.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return map.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return map.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const imageInfo=map.get(this).GetCurrentImageInfo();return[imageInfo.GetWidth(),imageInfo.GetHeight()]}async replaceCurrentAnimationFrame(blob){C3X.RequireInstanceOf(blob,
Blob);const sdkInst=map.get(this);const runtime=sdkInst.GetRuntime();const curImageInfo=sdkInst.GetCurrentImageInfo();const imageInfo=C3.New(C3.ImageInfo);imageInfo.LoadDynamicBlobAsset(runtime,blob);await imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling()});if(sdkInst.WasReleased()){imageInfo.Release();return}curImageInfo.ReplaceWith(imageInfo);const sdkType=sdkInst.GetSdkType();sdkType._UpdateAllCurrentTexture();sdkType.GetObjectClass().Dispatcher().dispatchEvent(new C3.Event("animationframeimagechange"));
runtime.UpdateRender()}setSolidCollisionFilter(isInclusive,tags){C3X.RequireString(tags);map.get(this).GetWorldInfo().SetSolidCollisionFilter(!!isInclusive,tags)}}}
{const C3=self.C3;C3.Plugins.Sprite.Cnds={IsAnimPlaying(animName){return C3.equalsNoCase(this._GetCurrentAnimationName(),animName)},CompareFrame(cmp,frameNum){return C3.compare(this._currentFrameIndex,cmp,frameNum)},CompareFrameTag(cmp,frameTag){if(typeof frameTag!=="string")return false;const selfTag=this._currentAnimationFrame.GetTag();return C3.compare(selfTag.toLowerCase(),cmp,frameTag.toLowerCase())},CompareAnimSpeed(cmp,x){return C3.compare(this._GetAnimSpeed(),cmp,x)},OnAnimFinished(animName){return C3.equalsNoCase(this._animTriggerName,
animName)},OnAnyAnimFinished(){return true},OnFrameChanged(){return true},IsMirrored(){return this.GetWorldInfo().GetWidth()<0},IsFlipped(){return this.GetWorldInfo().GetHeight()<0},OnURLLoaded(){return true},OnURLFailed(){return true},IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}}}
{const C3=self.C3;C3.Plugins.Sprite.Acts={Spawn(objectClass,layer,imgPt,createHierarchy,template){if(!objectClass||!layer)return;const [imgPtX,imgPtY]=this.GetImagePoint(imgPt);const inst=this._runtime.CreateInstance(objectClass,layer,imgPtX,imgPtY,createHierarchy,template);if(!inst)return;if(createHierarchy)layer.SortAndAddInstancesByZIndex(inst);if(objectClass.GetPlugin().IsRotatable()){const instWi=inst.GetWorldInfo();instWi.SetAngle(this.GetWorldInfo().GetAngle());instWi.SetBboxChanged()}const eventSheetManager=
this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);if(objectClass!==this._runtime.GetCurrentAction().GetObjectClass())this._sdkType._SpawnPickInstance(objectClass,inst,createHierarchy)},StopAnim(){this.SetAnimationPlaying(false)},StartAnim(from){this._StartAnim(from)},SetAnim(animName,from){this._SetAnim(animName,from)},SetAnimFrame(frameNum){this._SetAnimFrame(frameNum)},SetAnimSpeed(s){this._SetAnimSpeed(s)},
SetAnimRepeatToFrame(f){this._SetAnimRepeatToFrame(f)},AddRemoveAnimation(which,animName){try{if(which===0)this.GetSdkType()._AddAnimation(animName);else this.GetSdkType()._RemoveAnimation(animName)}catch(err){console.error(`[Construct] Error ${which===0?"adding":"removing"} animation: `,err)}},AddRemoveAnimationFrame(which,animation,where){try{if(which===0)this.GetSdkType()._AddAnimationFrame(animation,where);else this.GetSdkType()._RemoveAnimationFrame(animation,where)}catch(err){console.error(`[Construct] Error ${which===
0?"adding":"removing"} animation frame: `,err)}},SetMirrored(m){const wi=this.GetWorldInfo();const oldW=wi.GetWidth();const newW=Math.abs(oldW)*(m===0?-1:1);if(oldW===newW)return;wi.SetWidth(newW);wi.SetBboxChanged()},SetFlipped(f){const wi=this.GetWorldInfo();const oldH=wi.GetHeight();const newH=Math.abs(oldH)*(f===0?-1:1);if(oldH===newH)return;wi.SetHeight(newH);wi.SetBboxChanged()},SetScale(s){const frame=this._currentAnimationFrame;const imageInfo=frame.GetImageInfo();const wi=this.GetWorldInfo();
const mirrorFactor=wi.GetWidth()<0?-1:1;const flipFactor=wi.GetHeight()<0?-1:1;const newWidth=imageInfo.GetWidth()*s*mirrorFactor;const newHeight=imageInfo.GetHeight()*s*flipFactor;if(wi.GetWidth()!==newWidth||wi.GetHeight()!==newHeight){wi.SetSize(newWidth,newHeight);wi.SetBboxChanged()}},async LoadURL(url,resize,crossOrigin){const curAnimFrame=this._currentAnimationFrame;const curImageInfo=curAnimFrame.GetImageInfo();const wi=this.GetWorldInfo();const runtime=this._runtime;const sdkType=this._sdkType;
if(curImageInfo.GetURL()===url){if(resize===0){wi.SetSize(curImageInfo.GetWidth(),curImageInfo.GetHeight());wi.SetBboxChanged()}this.Trigger(C3.Plugins.Sprite.Cnds.OnURLLoaded);return}const imageInfo=C3.New(C3.ImageInfo);try{await imageInfo.LoadDynamicAsset(runtime,url);if(!imageInfo.IsLoaded())throw new Error("image failed to load");if(this.WasReleased()){imageInfo.Release();return}await imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling()})}catch(err){console.error("Load image from URL failed: ",
err);if(!this.WasReleased())this.Trigger(C3.Plugins.Sprite.Cnds.OnURLFailed);return}if(this.WasReleased()){imageInfo.Release();return}curImageInfo.ReplaceWith(imageInfo);sdkType._UpdateAllCurrentTexture();sdkType.GetObjectClass().Dispatcher().dispatchEvent(new C3.Event("animationframeimagechange"));runtime.UpdateRender();if(resize===0){wi.SetSize(curImageInfo.GetWidth(),curImageInfo.GetHeight());wi.SetBboxChanged()}await this.TriggerAsync(C3.Plugins.Sprite.Cnds.OnURLLoaded)},SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e)},
SetSolidCollisionFilter(mode,tags){this.GetWorldInfo().SetSolidCollisionFilter(mode===0,tags)},SetEffect(effect){this.GetWorldInfo().SetBlendMode(effect);this._runtime.UpdateRender()}}}
{const C3=self.C3;C3.Plugins.Sprite.Exps={AnimationFrame(){return this._GetAnimFrame()},AnimationFrameTag(){return this._GetAnimFrameTag()},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(imgpt){return this.GetImagePoint(imgpt)[0]},ImagePointY(imgpt){return this.GetImagePoint(imgpt)[1]},ImagePointZ(imgpt){return this.GetImagePoint(imgpt)[2]},
ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(i){return this.GetCollisionPolyPoint(i)[0]},PolyPointYAt(i){return this.GetCollisionPolyPoint(i)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}}};

}

{
'use strict';{const C3=self.C3;const DOM_COMPONENT_ID="text-input";C3.Plugins.TextBox=class TextInputPlugin extends C3.SDKDOMPluginBase{constructor(opts){super(opts,DOM_COMPONENT_ID);this.AddElementMessageHandler("click",(sdkInst,e)=>sdkInst._OnClick(e));this.AddElementMessageHandler("dblclick",(sdkInst,e)=>sdkInst._OnDoubleClick(e));this.AddElementMessageHandler("change",(sdkInst,e)=>sdkInst._OnChange(e))}Release(){super.Release()}}}{const C3=self.C3;C3.Plugins.TextBox.Type=class TextInputType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass)}Release(){super.Release()}OnCreate(){}}}
{const C3=self.C3;const C3X=self.C3X;const TEXT=0;const PLACEHOLDER=1;const TOOLTIP=2;const INITIALLY_VISIBLE=3;const ENABLE=4;const READ_ONLY=5;const SPELL_CHECK=6;const TYPE=7;const AUTO_FONT_SIZE=8;const ID=9;const CLASS_NAME=10;const DOM_COMPONENT_ID="text-input";const elemTypes=["text","password","email","number","tel","url","textarea","search"];C3.Plugins.TextBox.Instance=class TextInputInstance extends C3.SDKDOMInstanceBase{constructor(inst,properties){super(inst,DOM_COMPONENT_ID);this._text=
"";this._placeholder="";this._title="";this._isEnabled=true;this._isReadOnly=false;this._spellCheck=false;this._type="text";this._autoFontSize=true;this._maxLength=-1;this._id="";this._className="";if(properties){this._text=properties[TEXT];this._placeholder=properties[PLACEHOLDER];this._title=properties[TOOLTIP];this.GetWorldInfo().SetVisible(properties[INITIALLY_VISIBLE]);this._isEnabled=properties[ENABLE];this._isReadOnly=properties[READ_ONLY];this._spellCheck=properties[SPELL_CHECK];this._type=
elemTypes[properties[TYPE]];this._autoFontSize=properties[AUTO_FONT_SIZE];this._id=properties[ID];this._className=properties[CLASS_NAME]}this.CreateElement({"type":this._type,"id":this._id,"className":this._className})}Release(){super.Release()}GetElementState(){return{"text":this._text,"placeholder":this._placeholder,"title":this._title,"isEnabled":this._isEnabled,"isReadOnly":this._isReadOnly,"spellCheck":this._spellCheck,"maxLength":this._maxLength}}async _OnClick(e){this.DispatchScriptEvent("click",
true);await this.TriggerAsync(C3.Plugins.TextBox.Cnds.OnClicked)}async _OnDoubleClick(e){this.DispatchScriptEvent("dblclick",true);await this.TriggerAsync(C3.Plugins.TextBox.Cnds.OnDoubleClicked)}async _OnChange(e){this._text=e["text"];this.DispatchScriptEvent("change",true);await this.TriggerAsync(C3.Plugins.TextBox.Cnds.OnTextChanged)}_SetText(text){if(this._text===text)return;this._text=text;this.UpdateElementState()}_GetText(){return this._text}_SetPlaceholder(placeholder){if(this._placeholder===
placeholder)return;this._placeholder=placeholder;this.UpdateElementState()}_GetPlaceholder(){return this._placeholder}_SetTooltip(title){if(this._title===title)return;this._title=title;this.UpdateElementState()}_GetTooltip(){return this._title}_SetEnabled(e){e=!!e;if(this._isEnabled===e)return;this._isEnabled=e;this.UpdateElementState()}_IsEnabled(){return this._isEnabled}_SetReadOnly(r){r=!!r;if(this._isReadOnly===r)return;this._isReadOnly=r;this.UpdateElementState()}_IsReadOnly(){return this._isReadOnly}_SetMaxLength(l){l=
Math.max(+l,-1);if(this._maxLength===l)return;this._maxLength=l;this.UpdateElementState()}_GetMaxLength(){return this._maxLength}_ScrollToBottom(){Promise.resolve().then(()=>this.PostToDOMElement("scroll-to-bottom"))}Draw(renderer){}SaveToJson(){return{"t":this._text,"p":this._placeholder,"ti":this._title,"e":this._isEnabled,"r":this._isReadOnly,"sp":this._spellCheck,"ml":this._maxLength,"type":this._type,"id":this._id}}LoadFromJson(o){this._text=o["t"];this._placeholder=o["p"];this._title=o["ti"];
this._isEnabled=o["e"];this._isReadOnly=o["r"];this._spellCheck=o["sp"];this._maxLength=o.hasOwnProperty("ml")?o["ml"]:-1;this._type=o["type"];this._id=o["id"];this.UpdateElementState()}GetPropertyValueByIndex(index){switch(index){case TEXT:return this._text;case PLACEHOLDER:return this._placeholder;case TOOLTIP:return this._title;case ENABLE:return this._isEnabled;case READ_ONLY:return this._isReadOnly;case SPELL_CHECK:return this._spellCheck;case AUTO_FONT_SIZE:return this._autoFontSize}}SetPropertyValueByIndex(index,
value){switch(index){case TEXT:if(this._text===value)return;this._text=value;this.UpdateElementState();break;case PLACEHOLDER:if(this._placeholder===value)return;this._placeholder=value;this.UpdateElementState();break;case TOOLTIP:if(this._title===value)return;this._title=value;this.UpdateElementState();break;case ENABLE:if(this._isEnabled===!!value)return;this._isEnabled=!!value;this.UpdateElementState();break;case READ_ONLY:if(this._isReadOnly===!!value)return;this._isReadOnly=!!value;this.UpdateElementState();
break;case SPELL_CHECK:if(this._spellCheck===!!value)return;this._spellCheck=!!value;this.UpdateElementState();break;case AUTO_FONT_SIZE:this._autoFontSize=!!value;break}}GetDebuggerProperties(){const Acts=C3.Plugins.TextBox.Acts;const prefix="plugins.textbox";return[{title:prefix+".name",properties:[{name:prefix+".properties.text.name",value:this._text,onedit:v=>this.CallAction(Acts.SetText,v)},{name:prefix+".properties.enabled.name",value:this._isEnabled,onedit:v=>this.CallAction(Acts.SetEnabled,
v)},{name:prefix+".properties.read-only.name",value:this._isReadOnly,onedit:v=>this.CallAction(Acts.SetReadOnly,v)}]}]}GetScriptInterfaceClass(){return self.ITextInputInstance}};const map=new WeakMap;self.ITextInputInstance=class ITextInputInstance extends self.IDOMInstance{constructor(){super();map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set text(str){C3X.RequireString(str);map.get(this)._SetText(str)}get text(){return map.get(this)._GetText()}set placeholder(str){C3X.RequireString(str);
map.get(this)._SetPlaceholder(str)}get placeholder(){return map.get(this)._GetPlaceholder()}set tooltip(str){C3X.RequireString(str);map.get(this)._SetTooltip(str)}get tooltip(){return map.get(this)._GetTooltip()}set isEnabled(e){map.get(this)._SetEnabled(e)}get isEnabled(){return map.get(this)._IsEnabled()}set isReadOnly(r){map.get(this)._SetReadOnly(r)}get isReadOnly(){return map.get(this)._IsReadOnly()}set maxLength(l){C3X.RequireFiniteNumber(l);map.get(this)._SetMaxLength(l)}get maxLength(){return map.get(this)._GetMaxLength()}scrollToBottom(){map.get(this)._ScrollToBottom()}}}
{const C3=self.C3;C3.Plugins.TextBox.Cnds={CompareText(text,case_){if(case_===0)return C3.equalsNoCase(this._text,text);else return this._text===text},OnTextChanged(){return true},OnClicked(){return true},OnDoubleClicked(){return true}}}
{const C3=self.C3;C3.Plugins.TextBox.Acts={SetText(param){this._SetText(param.toString())},AppendText(param){if(param==="")return;this._SetText(this._GetText()+param)},SetPlaceholder(placeholder){this._SetPlaceholder(placeholder)},SetTooltip(title){this._SetTooltip(title)},SetReadOnly(r){this._SetReadOnly(r===0)},ScrollToBottom(){this._ScrollToBottom()},SetMaxLength(l){this._SetMaxLength(l)}}}{const C3=self.C3;C3.Plugins.TextBox.Exps={Text(){return this._GetText()},MaxLength(){return this._GetMaxLength()}}};

}

{
'use strict';{const C3=self.C3;C3.Plugins.Text=class TextPlugin extends C3.SDKPluginBase{constructor(opts){super(opts)}Release(){super.Release()}}}{const C3=self.C3;C3.Plugins.Text.Type=class TextType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass)}Release(){super.Release()}OnCreate(){}LoadTextures(renderer){}ReleaseTextures(){}}}
{const C3=self.C3;const C3X=self.C3X;const TEMP_COLOR_ARRAY=[0,0,0];const TEXT=0;const ENABLE_BBCODE=1;const FONT=2;const SIZE=3;const LINE_HEIGHT=4;const BOLD=5;const ITALIC=6;const COLOR=7;const HORIZONTAL_ALIGNMENT=8;const VERTICAL_ALIGNMENT=9;const WRAPPING=10;const TEXT_DIRECTION=11;const ICON_SET=12;const INITIALLY_VISIBLE=13;const ORIGIN=14;const READ_ALOUD=15;const HORIZONTAL_ALIGNMENTS=["left","center","right"];const VERTICAL_ALIGNMENTS=["top","center","bottom"];const TEXT_DIRECTIONS=["ltr",
"rtl"];const WORD_WRAP=0;const CHARACTER_WRAP=1;const tempRect=new C3.Rect;const tempQuad=new C3.Quad;const tempColor=new C3.Color;const tempVec2=C3.New(C3.Vector2);const BBCODE_TAG_TO_HTML=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["iconoffsety",null]]);C3.Plugins.Text.Instance=class TextInstance extends C3.SDKWorldInstanceBase{constructor(inst,properties){super(inst);this._text="";this._enableBBcode=true;this._faceName="Arial";this._ptSize=12;this._lineHeightOffset=0;this._isBold=false;
this._isItalic=false;this._color=C3.New(C3.Color);this._horizontalAlign=0;this._verticalAlign=0;this._wrapByWord=true;this._textDirection=0;this._iconObjectClass=null;this._htmlString="";this._isHtmlStringUpToDate=false;this._readAloud=false;this._screenReaderText=null;this._typewriterStartTime=-1;this._typewriterEndTime=-1;this._typewriterLength=0;this._rendererText=C3.New(C3.Gfx.RendererText,this._runtime.GetRenderer(),{timeout:5});this._rendererText.ontextureupdate=()=>this._runtime.UpdateRender();
this._animationframeimagechange_handler=()=>this._OnIconObjectClassImageChanged();this._pendingUpdateIconSet=false;if(properties){this._text=properties[TEXT];this._enableBBcode=!!properties[ENABLE_BBCODE];this._faceName=properties[FONT];this._ptSize=properties[SIZE];this._lineHeightOffset=properties[LINE_HEIGHT];this._isBold=!!properties[BOLD];this._isItalic=!!properties[ITALIC];this._horizontalAlign=properties[HORIZONTAL_ALIGNMENT];this._verticalAlign=properties[VERTICAL_ALIGNMENT];this._wrapByWord=
properties[WRAPPING]===WORD_WRAP;this._textDirection=properties[TEXT_DIRECTION];this._SetIconObjectClass(this._runtime.GetObjectClassBySID(properties[ICON_SET]));const v=properties[COLOR];this._color.setRgb(v[0],v[1],v[2]);this.GetWorldInfo().SetVisible(properties[INITIALLY_VISIBLE]);this._readAloud=!!properties[READ_ALOUD]}this._UpdateTextSettings();this._UpdateScreenReaderText()}Release(){this._SetIconObjectClass(null);this._CancelTypewriter();if(this._screenReaderText){this._screenReaderText.Release();
this._screenReaderText=null}this._rendererText.Release();this._rendererText=null;super.Release()}_UpdateTextSettings(){const rendererText=this._rendererText;rendererText.SetText(this._text);rendererText.SetBBCodeEnabled(this._enableBBcode);if(this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass)this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass));else this._rendererText.SetIconSet(null);rendererText.SetIconSmoothing(this._runtime.GetSampling()!=="nearest");
rendererText.SetFontName(this._faceName);rendererText.SetLineHeight(this._lineHeightOffset);rendererText.SetBold(this._isBold);rendererText.SetItalic(this._isItalic);rendererText.SetColor(this._color);rendererText.SetHorizontalAlignment(HORIZONTAL_ALIGNMENTS[this._horizontalAlign]);rendererText.SetVerticalAlignment(VERTICAL_ALIGNMENTS[this._verticalAlign]);rendererText.SetWordWrapMode(this._wrapByWord?"word":"character");rendererText.SetTextDirection(TEXT_DIRECTIONS[this._textDirection])}_UpdateTextSize(){const wi=
this.GetWorldInfo();this._rendererText.SetFontSize(this._ptSize);this._rendererText.SetFontSizeScale(wi.GetSceneGraphScale());const layer=wi.GetLayer();const textZoom=layer.GetRenderScale()*layer.Get2DScaleFactorToZ(wi.GetTotalZElevation());if(wi.HasMesh()&&textZoom!==this._rendererText.GetZoom())wi.SetMeshChanged(true);this._rendererText.SetSize(wi.GetWidth(),wi.GetHeight(),textZoom)}_SetIconObjectClass(objectClass){if(objectClass&&(objectClass.IsFamily()||objectClass.GetPlugin().constructor!==C3.Plugins.Sprite))return;
if(objectClass===this._iconObjectClass)return;if(this._iconObjectClass)this._iconObjectClass.Dispatcher().removeEventListener("animationframeimagechange",this._animationframeimagechange_handler);this._iconObjectClass=objectClass;if(this._iconObjectClass)this._iconObjectClass.Dispatcher().addEventListener("animationframeimagechange",this._animationframeimagechange_handler);this._UpdateTextSettings();this._isHtmlStringUpToDate=false;this._runtime.UpdateRender()}_OnIconObjectClassImageChanged(){this._runtime.DeleteTextIconSet(this._iconObjectClass);
this._runtime.UpdateRender();this._pendingUpdateIconSet=true}_UpdateScreenReaderText(){if(this._readAloud){let text=this._text;if(this._enableBBcode)text=C3.BBString.StripAnyTags(text);if(this._screenReaderText)this._screenReaderText.SetText(text);else this._screenReaderText=C3.New(C3.ScreenReaderText,this._runtime,text)}else if(this._screenReaderText){this._screenReaderText.Release();this._screenReaderText=null}}Draw(renderer){const wi=this.GetWorldInfo();this._UpdateTextSize();if(this._pendingUpdateIconSet){this._pendingUpdateIconSet=
false;if(this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass)this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass))}const texture=this._rendererText.GetTexture();if(!texture)return;const layer=wi.GetLayer();if(wi.GetAngle()===0&&layer.GetAngle()===0&&wi.GetTotalZElevation()===0&&!wi.HasMesh()&&layer.RendersIn2DMode()){const quad=wi.GetBoundingQuad();const [dl,dt]=layer.LayerToDrawSurface(quad.getTlx(),quad.getTly());const [dr,db]=layer.LayerToDrawSurface(quad.getBrx(),
quad.getBry());const offX=dl-Math.round(dl);const offY=dt-Math.round(dt);tempRect.set(dl,dt,dr,db);tempRect.offset(-offX,-offY);tempQuad.setFromRect(tempRect);const [rtWidth,rtHeight]=renderer.GetRenderTargetSize(renderer.GetRenderTarget());this._runtime.GetCanvasManager().SetDeviceTransform(renderer,rtWidth,rtHeight);renderer.SetTexture(texture);renderer.Quad3(tempQuad,this._rendererText.GetTexRect());layer._SetTransform(renderer)}else{renderer.SetTexture(texture);if(wi.HasMesh())this._DrawMesh(wi,
renderer);else this._DrawStandard(wi,renderer)}}_DrawStandard(wi,renderer){let quad=wi.GetBoundingQuad();if(this._runtime.IsPixelRoundingEnabled())quad=this._PixelRoundQuad(quad);renderer.Quad3(quad,this._rendererText.GetTexRect())}_DrawMesh(wi,renderer){const transformedMesh=wi.GetTransformedMesh();if(wi.IsMeshChanged()){wi.CalculateBbox(tempRect,tempQuad,false);let quad=tempQuad;if(this._runtime.IsPixelRoundingEnabled())quad=this._PixelRoundQuad(quad);transformedMesh.CalculateTransformedMesh(wi.GetSourceMesh(),
quad,this._rendererText.GetTexRect());wi.SetMeshChanged(false)}transformedMesh.Draw(renderer)}_PixelRoundQuad(quad){const offX=quad.getTlx()-Math.round(quad.getTlx());const offY=quad.getTly()-Math.round(quad.getTly());if(offX===0&&offY===0)return quad;else{tempQuad.copy(quad);tempQuad.offset(-offX,-offY);return tempQuad}}GetCurrentSurfaceSize(){const texture=this._rendererText.GetTexture();if(texture)return[texture.GetWidth(),texture.GetHeight()];else return[100,100]}GetCurrentTexRect(){return this._rendererText.GetTexRect()}IsCurrentTexRotated(){return false}SaveToJson(){const o=
{"t":this._text,"c":this._color.toJSON(),"fn":this._faceName,"ps":this._ptSize};if(this._enableBBcode)o["bbc"]=this._enableBBcode;if(this._horizontalAlign!==0)o["ha"]=this._horizontalAlign;if(this._verticalAlign!==0)o["va"]=this._verticalAlign;if(!this._wrapByWord)o["wr"]=this._wrapByWord;if(this._lineHeightOffset!==0)o["lho"]=this._lineHeightOffset;if(this._isBold)o["b"]=this._isBold;if(this._isItalic)o["i"]=this._isItalic;if(this._typewriterEndTime!==-1)o["tw"]={"st":this._typewriterStartTime,"en":this._typewriterEndTime,
"l":this._typewriterLength};if(this._iconObjectClass)o["ioc"]=this._iconObjectClass.GetSID();return o}LoadFromJson(o){this._CancelTypewriter();this._text=o["t"],this._color.setFromJSON(o["c"]);this._faceName=o["fn"],this._ptSize=o["ps"];this._enableBBcode=o.hasOwnProperty("bbc")?o["bbc"]:false;this._horizontalAlign=o.hasOwnProperty("ha")?o["ha"]:0;this._verticalAlign=o.hasOwnProperty("va")?o["va"]:0;this._wrapByWord=o.hasOwnProperty("wr")?o["wr"]:true;this._lineHeightOffset=o.hasOwnProperty("lho")?
o["lho"]:0;this._isBold=o.hasOwnProperty("b")?o["b"]:false;this._isItalic=o.hasOwnProperty("i")?o["i"]:false;if(o.hasOwnProperty("tw")){const tw=o["tw"];this._typewriterStartTime=tw["st"];this._typewriterEndTime=tw["en"];this._typewriterLength=tw["l"]}if(o.hasOwnProperty("ioc")){const objectClass=this.GetRuntime().GetObjectClassBySID(o["ioc"]);if(objectClass)this._SetIconObjectClass(objectClass)}else this._SetIconObjectClass(null);this._UpdateTextSettings();this._UpdateScreenReaderText();this._isHtmlStringUpToDate=
false;if(this._typewriterEndTime!==-1)this._StartTicking()}GetPropertyValueByIndex(index){switch(index){case TEXT:return this.GetText();case ENABLE_BBCODE:return this._enableBBcode;case FONT:return this._GetFontFace();case SIZE:return this._GetFontSize();case LINE_HEIGHT:return this._GetLineHeight();case BOLD:return this._IsBold();case ITALIC:return this._IsItalic();case COLOR:TEMP_COLOR_ARRAY[0]=this._color.getR();TEMP_COLOR_ARRAY[1]=this._color.getG();TEMP_COLOR_ARRAY[2]=this._color.getB();return TEMP_COLOR_ARRAY;
case HORIZONTAL_ALIGNMENT:return this._GetHAlign();case VERTICAL_ALIGNMENT:return this._GetVAlign();case WRAPPING:return this._IsWrapByWord()?CHARACTER_WRAP:WORD_WRAP;case READ_ALOUD:return this._IsReadAloud()}}SetPropertyValueByIndex(index,value){switch(index){case TEXT:this._SetText(value);break;case ENABLE_BBCODE:if(this._enableBBcode===!!value)return;this._enableBBcode=!!value;this._UpdateTextSettings();break;case FONT:this._SetFontFace(value);break;case SIZE:this._SetFontSize(value);break;case LINE_HEIGHT:this._SetLineHeight(value);
break;case BOLD:this._SetBold(value);break;case ITALIC:this._SetItalic(value);break;case COLOR:const c=this._color;const v=value;if(c.getR()===v[0]&&c.getG()===v[1]&&c.getB()===v[2])return;this._color.setRgb(v[0],v[1],v[2]);this._UpdateTextSettings();break;case HORIZONTAL_ALIGNMENT:this._SetHAlign(value);break;case VERTICAL_ALIGNMENT:this._SetVAlign(value);break;case WRAPPING:this._SetWrapByWord(value===WORD_WRAP);break}}SetPropertyColorOffsetValueByIndex(index,r,g,b){if(r===0&&g===0&&b===0)return;
switch(index){case COLOR:this._color.addRgb(r,g,b);this._UpdateTextSettings();break}}_SetText(text){if(this._text===text)return;this._text=text;this._rendererText.SetText(text);this._UpdateScreenReaderText();this._isHtmlStringUpToDate=false;this._runtime.UpdateRender()}GetText(){return this._text}_StartTypewriter(text,duration){this._UpdateTextSize();this._SetText(text);this._typewriterStartTime=this._runtime.GetWallTime();this._typewriterEndTime=this._typewriterStartTime+duration/this.GetInstance().GetActiveTimeScale();
this._typewriterLength=this._rendererText.GetLengthInGraphemes();this._rendererText.SetDrawMaxCharacterCount(0);this._StartTicking()}_CancelTypewriter(){this._typewriterStartTime=-1;this._typewriterEndTime=-1;this._typewriterLength=0;this._rendererText.SetDrawMaxCharacterCount(-1);this._StopTicking()}_FinishTypewriter(){if(this._typewriterEndTime===-1)return;this._CancelTypewriter();this.Trigger(C3.Plugins.Text.Cnds.OnTypewriterTextFinished);this._runtime.UpdateRender()}_SetFontFace(face){if(this._faceName===
face)return;this._faceName=face;this._rendererText.SetFontName(face);this._runtime.UpdateRender()}_GetFontFace(){return this._faceName}_SetBold(b){b=!!b;if(this._isBold===b)return;this._isBold=b;this._rendererText.SetBold(b);this._runtime.UpdateRender()}_IsBold(){return this._isBold}_SetItalic(i){i=!!i;if(this._isItalic===i)return;this._isItalic=i;this._rendererText.SetItalic(i);this._runtime.UpdateRender()}_IsItalic(){return this._isItalic}_SetFontSize(size){if(this._ptSize===size)return;this._ptSize=
size;this._runtime.UpdateRender()}_GetFontSize(){return this._ptSize}_SetFontColor(color){if(this._color.equalsIgnoringAlpha(color))return;this._color.copyRgb(color);this._rendererText.SetColor(this._color);this._runtime.UpdateRender()}_GetFontColor(){return this._color}_SetLineHeight(lho){if(this._lineHeightOffset===lho)return;this._lineHeightOffset=lho;this._UpdateTextSettings();this._runtime.UpdateRender()}_GetLineHeight(){return this._lineHeightOffset}_SetHAlign(h){if(this._horizontalAlign===
h)return;this._horizontalAlign=h;this._UpdateTextSettings();this._runtime.UpdateRender()}_GetHAlign(){return this._horizontalAlign}_SetVAlign(v){if(this._verticalAlign===v)return;this._verticalAlign=v;this._UpdateTextSettings();this._runtime.UpdateRender()}_GetVAlign(){return this._verticalAlign}_SetWrapByWord(w){w=!!w;if(this._wrapByWord===w)return;this._wrapByWord=w;this._UpdateTextSettings();this._runtime.UpdateRender()}_IsWrapByWord(){return this._wrapByWord}_SetTextDirection(d){if(this._textDirection===
d)return;this._textDirection=d;this._UpdateTextSettings();this._runtime.UpdateRender()}_GetTextDirection(){return this._textDirection}_SetReadAloud(r){this._readAloud=!!r;this._UpdateScreenReaderText()}_IsReadAloud(){return this._readAloud}_GetTextWidth(){this._UpdateTextSize();return this._rendererText.GetTextWidth()}_GetTextHeight(){this._UpdateTextSize();return this._rendererText.GetTextHeight()}_GetTagAtPosition(x,y){this._UpdateTextSize();const wi=this.GetWorldInfo();tempVec2.set(x-wi.GetX(),
y-wi.GetY());tempVec2.rotate(-wi.GetAngle());tempVec2.offset(wi.GetWidth()*wi.GetOriginX(),wi.GetHeight()*wi.GetOriginY());tempVec2.divide(wi.GetWidth(),wi.GetHeight());tempVec2.scale(this._rendererText.GetWidth(),this._rendererText.GetHeight());const frag=this._rendererText.HitTestFragment(tempVec2.getX(),tempVec2.getY());if(frag){const fragTagStyle=frag.GetStyleTag("tag");if(fragTagStyle)return fragTagStyle.param}return""}_HasTagAtPosition(tag,x,y){const hitTag=this._GetTagAtPosition(x,y);return hitTag&&
C3.equalsNoCase(tag,hitTag)}_GetTagPosition(tag,index){this._UpdateTextSize();index=Math.floor(index);const frag=this._rendererText.FindFragmentWithTag(tag,index);if(!frag)return null;const wi=this.GetWorldInfo();const scale=this._rendererText.GetDrawScale();const posX=frag.GetPosX();const posY=frag.GetPosY()-(frag.GetHeight()-frag.GetFontBoundingBoxDescent())*scale;const width=frag.GetWidth()*scale/this._rendererText.GetWidth()*wi.GetWidth();const height=frag.GetHeight()*scale/this._rendererText.GetHeight()*
wi.GetHeight();tempVec2.set(posX,posY);tempVec2.divide(this._rendererText.GetWidth(),this._rendererText.GetHeight());tempVec2.scale(wi.GetWidth(),wi.GetHeight());tempVec2.offset(-wi.GetWidth()*wi.GetOriginX(),-wi.GetHeight()*wi.GetOriginY());tempVec2.rotate(wi.GetAngle());tempVec2.offset(wi.GetX(),wi.GetY());return{x:tempVec2.getX(),y:tempVec2.getY(),width,height}}_GetTagCount(tag){this._UpdateTextSize();return this._rendererText.CountFragmentsWithTag(tag)}_GetHTMLCloseTag(bbTag){let htmlTag=BBCODE_TAG_TO_HTML.get(bbTag);
if(htmlTag===null)return"";else if(!htmlTag)htmlTag="span";return`</${htmlTag||"span"}>`}_GetHTMLOpenTag(bbTag,param){let htmlTag=BBCODE_TAG_TO_HTML.get(bbTag);if(htmlTag===null)return"";else if(!htmlTag)htmlTag="span";switch(bbTag){case "color":return`<${htmlTag} style="color: ${param}">`;case "font":return`<${htmlTag} style="font-family: '${param}'">`;case "opacity":return`<${htmlTag} style="opacity: ${param}%">`;case "size":return`<${htmlTag} style="font-size: ${param}pt">`;case "background":return`<${htmlTag} style="background-color: ${param}">`;
case "hide":return`<${htmlTag} style="visibility: hidden">`;case "class":return`<${htmlTag} class="${param}">`;case "tag":return`<${htmlTag} data-tag="${param}">`;default:return`<${htmlTag}>`}}async _UpdateHTMLString(){if(this._isHtmlStringUpToDate)return this._htmlString;const fragList=(new C3.BBString(this._text,{noEscape:true})).toFragmentList();const iconBlobUrls=new Map;let htmlStr=`<span class="c3-text"`;const styles=[];styles.push(`font-family: '${this._GetFontFace()}';`);if(this._IsBold())styles.push("font-weight: bold;");
if(this._IsItalic())styles.push("font-style: italic;");if(!this._IsWrapByWord())styles.push("word-break: break-all;");htmlStr+=` style="${styles.join(" ")}">`;const textIconSet=this._iconObjectClass?this.GetRuntime().GetTextIconSet(this._iconObjectClass):null;if(this._iconObjectClass){const promiseThrottle=C3.New(C3.PromiseThrottle);const assetDrawablePromises=[];const assetDrawableMap=new Map;for(const frag of fragList)if(frag.IsIcon()){const textIcon=frag.GetTextIcon(textIconSet);if(textIcon){const frame=
textIcon.GetSource();const imageAsset=frame.GetImageInfo().GetImageAsset();if(assetDrawableMap.has(imageAsset))continue;assetDrawableMap.set(imageAsset,null);assetDrawablePromises.push(promiseThrottle.Add(async()=>{const drawable=await imageAsset.LoadToDrawable();assetDrawableMap.set(imageAsset,drawable)}))}}await Promise.all(assetDrawablePromises);const blobUrlPromises=[];for(const frag of fragList)if(frag.IsIcon()){const textIcon=frag.GetTextIcon(textIconSet);if(textIcon){const frame=textIcon.GetSource();
const imageAsset=frame.GetImageInfo().GetImageAsset();blobUrlPromises.push(promiseThrottle.Add(async()=>{const blobUrl=await frame.GetImageInfo().ExtractImageToBlobURL(assetDrawableMap.get(imageAsset));iconBlobUrls.set(textIcon,blobUrl)}))}}await Promise.all(blobUrlPromises);for(const drawable of assetDrawableMap.values())if(drawable instanceof ImageBitmap&&drawable["close"])drawable["close"]()}const openTags=new Map;for(const frag of fragList){const fragTags=frag.GetStyleMap();let revKeys=[...openTags.keys()];
revKeys.reverse();for(const bbTag of revKeys)if(!fragTags.has(bbTag)||fragTags.get(bbTag)!==openTags.get(bbTag)){openTags.delete(bbTag);htmlStr+=this._GetHTMLCloseTag(bbTag)}for(const [bbTag,param]of fragTags)if(!openTags.has(bbTag)){openTags.set(bbTag,param);htmlStr+=this._GetHTMLOpenTag(bbTag,param)}if(frag.IsText())htmlStr+=C3.ReplaceAll(C3.EscapeHTML(frag.GetCharacterArray().join("")),"\n","<br>");if(frag.IsIcon()&&textIconSet){const textIcon=frag.GetTextIcon(textIconSet);if(textIcon){const blobUrl=
iconBlobUrls.get(textIcon);if(blobUrl){const styles=[];let topStyle="0.2em";const iconOffsetYStyle=fragTags.get("iconoffsety");if(iconOffsetYStyle){let param=iconOffsetYStyle.trim();if(param.endsWith("%"))topStyle=parseFloat(param)/100+"em";else topStyle=param+"px"}styles.push(`top: ${topStyle}`);if(this._runtime.GetSampling()==="nearest")styles.push("image-rendering: pixelated");htmlStr+=`<img class="c3-text-icon" data-icon="${frag.GetIconParameter()}" width="${textIcon.GetWidth()}" height="${textIcon.GetHeight()}" style="${styles.join(";")}" src="${blobUrl}">`}}}}const revKeys=
[...openTags.keys()];revKeys.reverse();for(const tag of revKeys)htmlStr+=this._GetHTMLCloseTag(tag);htmlStr+="</span>";this._htmlString=htmlStr;this._isHtmlStringUpToDate=true;return this._htmlString}Tick(){const wallTime=this._runtime.GetWallTime();if(wallTime>=this._typewriterEndTime){this._CancelTypewriter();this.Trigger(C3.Plugins.Text.Cnds.OnTypewriterTextFinished);this._runtime.UpdateRender()}else{let displayLength=C3.relerp(this._typewriterStartTime,this._typewriterEndTime,wallTime,0,this._typewriterLength);
displayLength=Math.floor(displayLength);if(displayLength!==this._rendererText.GetDrawMaxCharacterCount()){this._rendererText.SetDrawMaxCharacterCount(displayLength);this._runtime.UpdateRender()}}}GetDebuggerProperties(){const prefix="plugins.text";return[{title:prefix+".name",properties:[{name:prefix+".properties.text.name",value:this.GetText(),onedit:v=>this._SetText(v)},{name:prefix+".properties.font.name",value:this._GetFontFace(),onedit:v=>this._SetFontFace(v)},{name:prefix+".properties.size.name",
value:this._GetFontSize(),onedit:v=>this._SetFontSize(v)},{name:prefix+".properties.line-height.name",value:this._GetLineHeight(),onedit:v=>this._SetLineHeight(v)},{name:prefix+".properties.bold.name",value:this._IsBold(),onedit:v=>this._SetBold(v)},{name:prefix+".properties.italic.name",value:this._IsItalic(),onedit:v=>this._SetItalic(v)}]}]}GetScriptInterfaceClass(){return self.ITextInstance}};const map=new WeakMap;const SCRIPT_HORIZONTAL_ALIGNMENTS=new Map([["left",0],["center",1],["right",2]]);
const SCRIPT_VERTICAL_ALIGNMENTS=new Map([["top",0],["center",1],["bottom",2]]);const SCRIPT_WRAP_MODES=new Map([["word",true],["character",false]]);const SCRIPT_TEXT_DIRECTIONS=["ltr","rtl"];self.ITextInstance=class ITextInstance extends self.IWorldInstance{constructor(){super();map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return map.get(this).GetText()}set text(str){C3X.RequireString(str);const inst=map.get(this);inst._CancelTypewriter();inst._SetText(str)}typewriterText(str,
duration){C3X.RequireString(str);C3X.RequireFiniteNumber(duration);const inst=map.get(this);inst._CancelTypewriter();inst._StartTypewriter(str,duration)}typewriterFinish(){map.get(this)._FinishTypewriter()}set fontFace(str){C3X.RequireString(str);map.get(this)._SetFontFace(str)}get fontFace(){return map.get(this)._GetFontFace()}set isBold(b){map.get(this)._SetBold(b)}get isBold(){return map.get(this)._IsBold()}set isItalic(i){map.get(this)._SetItalic(i)}get isItalic(){return map.get(this)._IsItalic()}set sizePt(pt){C3X.RequireFiniteNumber(pt);
map.get(this)._SetFontSize(pt)}get sizePt(){return map.get(this)._GetFontSize()}set fontColor(arr){C3X.RequireArray(arr);if(arr.length<3)throw new Error("expected 3 elements");tempColor.setRgb(arr[0],arr[1],arr[2]);map.get(this)._SetFontColor(tempColor)}get fontColor(){const c=map.get(this)._GetFontColor();return[c.getR(),c.getG(),c.getB()]}set lineHeight(lho){C3X.RequireFiniteNumber(lho);map.get(this)._SetLineHeight(lho)}get lineHeight(){return map.get(this)._GetLineHeight()}set horizontalAlign(str){C3X.RequireString(str);
const h=SCRIPT_HORIZONTAL_ALIGNMENTS.get(str);if(typeof h==="undefined")throw new Error("invalid mode");map.get(this)._SetHAlign(h)}get horizontalAlign(){return HORIZONTAL_ALIGNMENTS[map.get(this)._GetHAlign()]}set verticalAlign(str){C3X.RequireString(str);const v=SCRIPT_VERTICAL_ALIGNMENTS.get(str);if(typeof v==="undefined")throw new Error("invalid mode");map.get(this)._SetVAlign(v)}get verticalAlign(){return VERTICAL_ALIGNMENTS[map.get(this)._GetVAlign()]}set wordWrapMode(str){C3X.RequireString(str);
const isWrapByWord=SCRIPT_WRAP_MODES.get(str);if(typeof isWrapByWord==="undefined")throw new Error("invalid mode");map.get(this)._SetWrapByWord(isWrapByWord)}get wordWrapMode(){return map.get(this)._IsWrapByWord()?"word":"character"}set textDirection(ds){C3X.RequireString(ds);const d=SCRIPT_TEXT_DIRECTIONS.indexOf(ds);if(d===-1)throw new Error("invalid text direction");map.get(this)._SetTextDirection(d)}get textDirection(){return SCRIPT_TEXT_DIRECTIONS[map.get(this)._GetTextDirection()]}set readAloud(r){map.get(this)._SetReadAloud(!!r)}get readAloud(){return map.get(this)._IsReadAloud()}get textWidth(){return map.get(this)._GetTextWidth()}get textHeight(){return map.get(this)._GetTextHeight()}getTextSize(){const inst=
map.get(this);return[inst._GetTextWidth(),inst._GetTextHeight()]}hasTagAtPosition(tag,x,y){C3X.RequireString(tag);C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);return map.get(this)._HasTagAtPosition(tag,x,y)}getTagAtPosition(x,y){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);return map.get(this)._GetTagAtPosition(x,y)}getTagPositionAndSize(tag,index=0){C3X.RequireString(tag);C3X.RequireFiniteNumber(index);return map.get(this)._GetTagPosition(tag,index)}getTagCount(tag){C3X.RequireString(tag);
return map.get(this)._GetTagCount(tag)}changeIconSet(iObjectClass){const sdkInst=map.get(this);const objectClass=sdkInst.GetRuntime()._UnwrapIObjectClass(iObjectClass);sdkInst._SetIconObjectClass(objectClass)}getAsHtmlString(){return map.get(this)._UpdateHTMLString()}}}
{const C3=self.C3;C3.Plugins.Text.Cnds={CompareText(str,caseSensitive){if(caseSensitive)return this._text===str;else return C3.equalsNoCase(this._text,str)},IsRunningTypewriterText(){return this._typewriterEndTime!==-1},OnTypewriterTextFinished(){return true},HasTagAtPosition(tag,x,y){return this._HasTagAtPosition(tag,x,y)}}}
{const C3=self.C3;const tempColor=C3.New(C3.Color);C3.Plugins.Text.Acts={SetText(param){this._CancelTypewriter();if(typeof param==="number"&&param<1E9)param=Math.round(param*1E10)/1E10;this._SetText(param.toString())},AppendText(param){this._CancelTypewriter();if(typeof param==="number"&&param<1E9)param=Math.round(param*1E10)/1E10;param=param.toString();if(!param)return;this._SetText(this._text+param)},TypewriterText(param,duration){this._CancelTypewriter();if(typeof param==="number"&&param<1E9)param=
Math.round(param*1E10)/1E10;this._StartTypewriter(param.toString(),duration)},SetFontFace(face,style){let bold=false;let italic=false;switch(style){case 1:bold=true;break;case 2:italic=true;break;case 3:bold=true;italic=true;break}if(face===this._faceName&&bold===this._isBold&&italic===this._isItalic)return;this._SetFontFace(face);this._SetBold(bold);this._SetItalic(italic)},SetFontSize(size){this._SetFontSize(size)},SetFontColor(rgb){tempColor.setFromRgbValue(rgb);tempColor.clamp();this._SetFontColor(tempColor)},
SetWebFont(familyName,cssUrl){console.warn("[Text] 'Set web font' action is deprecated and no longer has any effect")},SetEffect(effect){this.GetWorldInfo().SetBlendMode(effect);this._runtime.UpdateRender()},TypewriterFinish(){this._FinishTypewriter()},SetLineHeight(lho){this._SetLineHeight(lho)},SetHAlign(h){this._SetHAlign(h)},SetVAlign(v){this._SetVAlign(v)},SetWrapping(w){this._SetWrapByWord(w===0)},SetTextDirection(d){this._SetTextDirection(d)},ChangeIconSet(objectClass){this._SetIconObjectClass(objectClass)},
UpdateHTML(){return this._UpdateHTMLString()},SetReadAloud(r){this._SetReadAloud(r)}}}
{const C3=self.C3;C3.Plugins.Text.Exps={Text(){return this._text},PlainText(){if(this._enableBBcode)return C3.BBString.StripAnyTags(this._text);else return this._text},FaceName(){return this._faceName},FaceSize(){return this._ptSize},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()},LineHeight(){return this._lineHeightOffset},TagAtPosition(x,y){return this._GetTagAtPosition(x,y)},TagCount(tag){return this._GetTagCount(tag)},TagX(tag,index){const ret=this._GetTagPosition(tag,
index);return ret?ret.x:0},TagY(tag,index){const ret=this._GetTagPosition(tag,index);return ret?ret.y:0},TagWidth(tag,index){const ret=this._GetTagPosition(tag,index);return ret?ret.width:0},TagHeight(tag,index){const ret=this._GetTagPosition(tag,index);return ret?ret.height:0},AsHTML(){return this._htmlString}}};

}

{
'use strict';{const C3=self.C3;C3.Plugins.Dictionary=class DictionaryPlugin extends C3.SDKPluginBase{constructor(opts){super(opts)}Release(){super.Release()}}}{const C3=self.C3;C3.Plugins.Dictionary.Type=class DictionaryType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass)}Release(){super.Release()}OnCreate(){}}}
{const C3=self.C3;const C3X=self.C3X;const IInstance=self.IInstance;C3.Plugins.Dictionary.Instance=class DictionaryInstance extends C3.SDKInstanceBase{constructor(inst,properties){super(inst);this._data=new Map;this._curKey=""}Release(){this._data.clear();super.Release()}GetAsJsonString(){return JSON.stringify({"c2dictionary":true,"data":C3.MapToObject(this._data)})}GetDataMap(){return this._data}SaveToJson(){return C3.MapToObject(this._data)}LoadFromJson(o){C3.ObjectToMap(o,this._data)}GetDebuggerProperties(){const prefix=
"plugins.dictionary";return[{title:prefix+".name",properties:[{name:prefix+".debugger.key-count",value:this._data.size},...[...this._data].map(entry=>({name:"$"+entry[0],value:entry[1],onedit:v=>this._data.set(entry[0],v)}))]}]}GetScriptInterfaceClass(){return self.IDictionaryInstance}};const map=new WeakMap;self.IDictionaryInstance=class IDictionaryInstance extends IInstance{constructor(){super();map.set(this,IInstance._GetInitInst().GetSdkInstance())}getDataMap(){return map.get(this).GetDataMap()}}}
{const C3=self.C3;C3.Plugins.Dictionary.Cnds={CompareValue(key,cmp,val){const x=this._data.get(key);if(typeof x==="undefined")return false;return C3.compare(x,cmp,val)},ForEachKey(){const runtime=this._runtime;const eventSheetManager=runtime.GetEventSheetManager();const currentEvent=runtime.GetCurrentEvent();const solModifiers=currentEvent.GetSolModifiers();const eventStack=runtime.GetEventStack();const oldFrame=eventStack.GetCurrentStackFrame();const newFrame=eventStack.Push(currentEvent);runtime.SetDebuggingEnabled(false);
for(const key of this._data.keys()){this._curKey=key;eventSheetManager.PushCopySol(solModifiers);const sol=this.GetObjectClass().GetCurrentSol();sol.PickOne(this.GetInstance());currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers)}runtime.SetDebuggingEnabled(true);this._curKey="";eventStack.Pop();return false},CompareCurrentValue(cmp,val){const x=this._data.get(this._curKey);if(typeof x==="undefined")return false;return C3.compare(x,cmp,val)},HasKey(key){return this._data.has(key)},
IsEmpty(){return this._data.size===0}}}
{const C3=self.C3;C3.Plugins.Dictionary.Acts={AddKey(key,value){this._data.set(key,value)},SetKey(key,value){if(this._data.has(key))this._data.set(key,value)},DeleteKey(key){this._data.delete(key)},Clear(){this._data.clear()},JSONLoad(json){let o=null;try{o=JSON.parse(json)}catch(err){console.error("[Construct] Error parsing JSON: ",err);return}if(!o["c2dictionary"])return;C3.ObjectToMap(o["data"],this._data)},JSONDownload(filename){const url=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));
this._runtime.InvokeDownload(url,filename)}}}{const C3=self.C3;C3.Plugins.Dictionary.Exps={Get(key){const ret=this._data.get(key);if(typeof ret==="undefined")return 0;else return ret},GetDefault(key,defaultValue){const ret=this._data.get(key);if(typeof ret==="undefined")return defaultValue;else return ret},KeyCount(){return this._data.size},CurrentKey(){return this._curKey},CurrentValue(){return this._data.get(this._curKey)??0},AsJSON(){return this.GetAsJsonString()}}};

}

{
'use strict';{const C3=self.C3;C3.Plugins.Touch=class TouchPlugin extends C3.SDKPluginBase{constructor(opts){super(opts)}Release(){super.Release()}}}
{const C3=self.C3;const C3X=self.C3X;C3.Plugins.Touch.Type=class TouchType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}};let touchObjectType=null;function GetTouchSdkInstance(){return touchObjectType.GetSingleGlobalInstance().GetSdkInstance()}self.ITouchObjectType=class ITouchObjectType extends self.IObjectClass{constructor(objectType){super(objectType);touchObjectType=objectType;objectType.GetRuntime()._GetCommonScriptInterfaces().touch=
this}requestPermission(type){C3X.RequireString(type);const touchInst=GetTouchSdkInstance();if(type==="orientation")return touchInst._RequestPermission(0);else if(type==="motion")return touchInst._RequestPermission(1);else throw new Error("invalid type");}}}
{const C3=self.C3;const DOM_COMPONENT_ID="touch";C3.Plugins.Touch.Instance=class TouchInstance extends C3.SDKInstanceBase{constructor(inst,properties){super(inst,DOM_COMPONENT_ID);this._touches=new Map;this._useMouseInput=false;this._isMouseDown=false;this._orientCompassHeading=0;this._orientAlpha=0;this._orientBeta=0;this._orientGamma=0;this._accX=0;this._accY=0;this._accZ=0;this._accWithGX=0;this._accWithGY=0;this._accWithGZ=0;this._triggerIndex=0;this._triggerId=0;this._triggerPermission=0;this._curTouchX=
0;this._curTouchY=0;this._getTouchIndex=0;this._triggerType=0;this._permissionPromises=[];if(properties)this._useMouseInput=properties[0];this.AddDOMMessageHandler("permission-result",e=>this._OnPermissionResult(e));const rt=this.GetRuntime().Dispatcher();this._disposables=new C3.CompositeDisposable(C3.Disposable.From(rt,"pointerdown",e=>this._OnPointerDown(e.data)),C3.Disposable.From(rt,"pointermove",e=>this._OnPointerMove(e.data)),C3.Disposable.From(rt,"pointerup",e=>this._OnPointerUp(e.data,false)),
C3.Disposable.From(rt,"pointercancel",e=>this._OnPointerUp(e.data,true)),C3.Disposable.From(rt,"deviceorientation",e=>this._OnDeviceOrientation(e.data)),C3.Disposable.From(rt,"deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e.data)),C3.Disposable.From(rt,"devicemotion",e=>this._OnDeviceMotion(e.data)),C3.Disposable.From(rt,"tick2",e=>this._OnTick2()))}Release(){this._touches.clear();super.Release()}_OnPointerDown(e){if(e["pointerType"]==="mouse")if(this._useMouseInput)this._isMouseDown=
true;else return;const pointerId=e["pointerId"];if(this._touches.has(pointerId))return;const x=e["pageX"]-this._runtime.GetCanvasClientX();const y=e["pageY"]-this._runtime.GetCanvasClientY();const nowTime=performance.now();const index=this._touches.size;this._triggerIndex=index;this._triggerId=pointerId;const touchInfo=C3.New(C3.Plugins.Touch.TouchInfo);touchInfo.Init(nowTime,x,y,pointerId,index);this._touches.set(pointerId,touchInfo);this.Trigger(C3.Plugins.Touch.Cnds.OnNthTouchStart);this.Trigger(C3.Plugins.Touch.Cnds.OnTouchStart);
this._curTouchX=x;this._curTouchY=y;this._triggerType=0;this.Trigger(C3.Plugins.Touch.Cnds.OnTouchObject)}_OnPointerMove(e){if(e["pointerType"]==="mouse"&&!this._isMouseDown)return;const touchInfo=this._touches.get(e["pointerId"]);if(!touchInfo)return;const nowTime=performance.now();if(nowTime-touchInfo.GetTime()<2)return;const x=e["pageX"]-this._runtime.GetCanvasClientX();const y=e["pageY"]-this._runtime.GetCanvasClientY();touchInfo.Update(nowTime,x,y,e["width"],e["height"],e["pressure"])}_OnPointerUp(e,
isCancel){if(e["pointerType"]==="mouse")if(this._isMouseDown)this._isMouseDown=false;else return;const nowTime=performance.now();const pointerId=e["pointerId"];const touchInfo=this._touches.get(pointerId);if(!touchInfo)return;this._triggerIndex=touchInfo.GetStartIndex();this._triggerId=touchInfo.GetId();if(!isCancel){const x=e["pageX"]-this._runtime.GetCanvasClientX();const y=e["pageY"]-this._runtime.GetCanvasClientY();this._curTouchX=x;this._curTouchY=y;this._triggerType=1;this.Trigger(C3.Plugins.Touch.Cnds.OnTouchObject)}this.Trigger(C3.Plugins.Touch.Cnds.OnNthTouchEnd);
this.Trigger(C3.Plugins.Touch.Cnds.OnTouchEnd);if(!isCancel){const tap=touchInfo.ShouldTriggerTap(nowTime);if(tap==="single-tap"){this.Trigger(C3.Plugins.Touch.Cnds.OnTapGesture);this._curTouchX=touchInfo.GetX();this._curTouchY=touchInfo.GetY();this.Trigger(C3.Plugins.Touch.Cnds.OnTapGestureObject)}else if(tap==="double-tap"){this.Trigger(C3.Plugins.Touch.Cnds.OnDoubleTapGesture);this._curTouchX=touchInfo.GetX();this._curTouchY=touchInfo.GetY();this.Trigger(C3.Plugins.Touch.Cnds.OnDoubleTapGestureObject)}}touchInfo.Release();
this._touches.delete(pointerId)}_RequestPermission(type){this._PostToDOMMaybeSync("request-permission",{"type":type});return new Promise((resolve,reject)=>{this._permissionPromises.push({type,resolve,reject})})}_OnPermissionResult(e){const isGranted=e["result"];const type=e["type"];this._triggerPermission=type;const toResolve=this._permissionPromises.filter(o=>o.type===type);for(const o of toResolve)o.resolve(isGranted?"granted":"denied");this._permissionPromises=this._permissionPromises.filter(o=>
o.type!==type);if(isGranted){this.Trigger(C3.Plugins.Touch.Cnds.OnPermissionGranted);if(type===0)this._runtime.RequestDeviceOrientationEvent();else this._runtime.RequestDeviceMotionEvent()}else this.Trigger(C3.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(e){if(typeof e["webkitCompassHeading"]==="number")this._orientCompassHeading=e["webkitCompassHeading"];else if(e["absolute"])this._orientCompassHeading=e["alpha"];this._orientAlpha=e["alpha"];this._orientBeta=e["beta"];this._orientGamma=
e["gamma"]}_OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e["alpha"]}_OnDeviceMotion(e){const acc=e["acceleration"];if(acc){this._accX=acc["x"];this._accY=acc["y"];this._accZ=acc["z"]}const withG=e["accelerationIncludingGravity"];if(withG){this._accWithGX=withG["x"];this._accWithGY=withG["y"];this._accWithGZ=withG["z"]}}_OnTick2(){const nowTime=performance.now();let index=0;for(const touchInfo of this._touches.values()){if(touchInfo.GetTime()<=nowTime-50)touchInfo._SetLastTime(nowTime);
if(touchInfo.ShouldTriggerHold(nowTime)){this._triggerIndex=touchInfo.GetStartIndex();this._triggerId=touchInfo.GetId();this._getTouchIndex=index;this.Trigger(C3.Plugins.Touch.Cnds.OnHoldGesture);this._curTouchX=touchInfo.GetX();this._curTouchY=touchInfo.GetY();this.Trigger(C3.Plugins.Touch.Cnds.OnHoldGestureObject);this._getTouchIndex=0}++index}}_GetTouchByIndex(index){index=Math.floor(index);for(const touchInfo of this._touches.values()){if(index===0)return touchInfo;--index}return null}_IsClientPosOnCanvas(touchX,
touchY){return touchX>=0&&touchY>=0&&touchX<this._runtime.GetCanvasCssWidth()&&touchY<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){const prefix="plugins.touch.debugger";return[{title:prefix+".touches",properties:[...this._touches.values()].map(ti=>({name:"$"+ti.GetId(),value:ti.GetX()+", "+ti.GetY()}))}]}}}
{const C3=self.C3;const tempArr=[];C3.Plugins.Touch.Cnds={OnTouchStart(){return true},OnTouchEnd(){return true},IsInTouch(){return this._touches.size>0},OnTouchObject(objectClass,type){if(!objectClass)return false;if(type!==this._triggerType)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,[[this._curTouchX,this._curTouchY]],false)},IsTouchingObject(objectClass){if(!objectClass)return false;
const cnd=this._runtime.GetCurrentCondition();const isInverted=cnd.IsInverted();const ptsArr=[...this._touches.values()].filter(ti=>this._IsClientPosOnCanvas(ti.GetX(),ti.GetY())).map(ti=>[ti.GetX(),ti.GetY()]);return C3.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,ptsArr,isInverted),isInverted)},CompareTouchSpeed(index,cmp,s){const touchInfo=this._GetTouchByIndex(index);if(!touchInfo)return false;return C3.compare(touchInfo.GetSpeed(),cmp,s)},OrientationSupported(){return true},
MotionSupported(){return true},CompareOrientation(orientation,cmp,a){this._runtime.RequestDeviceOrientationEvent();let v=0;if(orientation===0)v=this._orientAlpha;else if(orientation===1)v=this._orientBeta;else v=this._orientGamma;return C3.compare(v,cmp,a)},CompareAcceleration(a,cmp,x){this._runtime.RequestDeviceMotionEvent();let v=0;if(a===0)v=this._accWithGX;else if(a===1)v=this._accWithGY;else if(a===2)v=this._accWithGZ;else if(a===3)v=this._accX;else if(a===4)v=this._accY;else v=this._accZ;return C3.compare(v,
cmp,x)},OnNthTouchStart(index){index=Math.floor(index);return index===this._triggerIndex},OnNthTouchEnd(index){index=Math.floor(index);return index===this._triggerIndex},HasNthTouch(index){index=Math.floor(index);return this._touches.size>=index+1},OnHoldGesture(){return true},OnTapGesture(){return true},OnDoubleTapGesture(){return true},OnHoldGestureObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,
[[this._curTouchX,this._curTouchY]],false)},OnTapGestureObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,[[this._curTouchX,this._curTouchY]],false)},OnDoubleTapGestureObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,
[[this._curTouchX,this._curTouchY]],false)},OnPermissionGranted(type){return this._triggerPermission===type},OnPermissionDenied(type){return this._triggerPermission===type}}}{const C3=self.C3;C3.Plugins.Touch.Acts={RequestPermission(type){this._RequestPermission(type)}}}
{const C3=self.C3;C3.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(layerParam){const touchInfo=this._GetTouchByIndex(this._getTouchIndex);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,true)},Y(layerParam){const touchInfo=this._GetTouchByIndex(this._getTouchIndex);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,false)},XAt(index,layerParam){const touchInfo=this._GetTouchByIndex(index);
if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,true)},YAt(index,layerParam){const touchInfo=this._GetTouchByIndex(index);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,false)},XForID(id,layerParam){const touchInfo=this._touches.get(id);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,true)},YForID(id,layerParam){const touchInfo=this._touches.get(id);
if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,false)},AbsoluteX(){const touchInfo=this._GetTouchByIndex(0);if(touchInfo)return touchInfo.GetX();else return 0},AbsoluteY(){const touchInfo=this._GetTouchByIndex(0);if(touchInfo)return touchInfo.GetY();else return 0},AbsoluteXAt(index){const touchInfo=this._GetTouchByIndex(index);if(touchInfo)return touchInfo.GetX();else return 0},AbsoluteYAt(index){const touchInfo=this._GetTouchByIndex(index);
if(touchInfo)return touchInfo.GetY();else return 0},AbsoluteXForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetX();else return 0},AbsoluteYForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetY();else return 0},SpeedAt(index){const touchInfo=this._GetTouchByIndex(index);if(touchInfo)return touchInfo.GetSpeed();else return 0},SpeedForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetSpeed();else return 0},AngleAt(index){const touchInfo=
this._GetTouchByIndex(index);if(touchInfo)return C3.toDegrees(touchInfo.GetAngle());else return 0},AngleForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return C3.toDegrees(touchInfo.GetAngle());else return 0},CompassHeading(){this._runtime.RequestDeviceOrientationEvent();return this._orientCompassHeading},Alpha(){this._runtime.RequestDeviceOrientationEvent();return this._orientAlpha},Beta(){this._runtime.RequestDeviceOrientationEvent();return this._orientBeta},Gamma(){this._runtime.RequestDeviceOrientationEvent();
return this._orientGamma},AccelerationXWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGX},AccelerationYWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGY},AccelerationZWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGZ},AccelerationX(){this._runtime.RequestDeviceMotionEvent();return this._accX},AccelerationY(){this._runtime.RequestDeviceMotionEvent();return this._accY},AccelerationZ(){this._runtime.RequestDeviceMotionEvent();return this._accZ},
TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetWidth();else return 0},HeightForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetHeight();else return 0},PressureForID(id){const touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetPressure();else return 0}}};

}

{
'use strict';const C3=self.C3;const GESTURE_HOLD_THRESHOLD=15;const GESTURE_HOLD_TIMEOUT=500;const GESTURE_TAP_TIMEOUT=333;const GESTURE_DOUBLETAP_THRESHOLD=25;let lastTapX=-1E3;let lastTapY=-1E3;let lastTapTime=-1E4;
C3.Plugins.Touch.TouchInfo=class TouchInfo extends C3.DefendedBase{constructor(){super();this._pointerId=0;this._startIndex=0;this._startTime=0;this._time=0;this._lastTime=0;this._startX=0;this._startY=0;this._x=0;this._y=0;this._lastX=0;this._lastY=0;this._width=0;this._height=0;this._pressure=0;this._hasTriggeredHold=false;this._isTooFarForHold=false}Release(){}Init(nowTime,x,y,id,index){this._pointerId=id;this._startIndex=index;this._time=nowTime;this._lastTime=nowTime;this._startTime=nowTime;
this._startX=x;this._startY=y;this._x=x;this._y=y;this._lastX=x;this._lastY=y}Update(nowTime,x,y,width,height,pressure){this._lastTime=this._time;this._time=nowTime;this._lastX=this._x;this._lastY=this._y;this._x=x;this._y=y;this._width=width;this._height=height;this._pressure=pressure;if(!this._isTooFarForHold&&C3.distanceTo(this._startX,this._startY,this._x,this._y)>=GESTURE_HOLD_THRESHOLD)this._isTooFarForHold=true}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(t){this._lastTime=
t}GetX(){return this._x}GetY(){return this._y}GetSpeed(){const dist=C3.distanceTo(this._x,this._y,this._lastX,this._lastY);const dt=(this._time-this._lastTime)/1E3;if(dt>0)return dist/dt;else return 0}GetAngle(){return C3.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(nowTime){if(this._hasTriggeredHold)return false;if(nowTime-this._startTime>=GESTURE_HOLD_TIMEOUT&&!this._isTooFarForHold&&
C3.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD){this._hasTriggeredHold=true;return true}return false}ShouldTriggerTap(nowTime){if(this._hasTriggeredHold)return"";if(nowTime-this._startTime<=GESTURE_TAP_TIMEOUT&&!this._isTooFarForHold&&C3.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD)if(nowTime-lastTapTime<=GESTURE_TAP_TIMEOUT*2&&C3.distanceTo(lastTapX,lastTapY,this._x,this._y)<GESTURE_DOUBLETAP_THRESHOLD){lastTapX=-1E3;lastTapY=-1E3;
lastTapTime=-1E4;return"double-tap"}else{lastTapX=this._x;lastTapY=this._y;lastTapTime=nowTime;return"single-tap"}return""}GetPositionForLayer(layout,layerNameOrNumber,getx){if(typeof layerNameOrNumber==="undefined"){const layer=layout.GetLayerByIndex(0);return layer.CanvasCssToLayer_DefaultTransform(this._x,this._y)[getx?0:1]}else{const layer=layout.GetLayer(layerNameOrNumber);if(layer)return layer.CanvasCssToLayer(this._x,this._y)[getx?0:1];else return 0}}};

}

{
'use strict';{const C3=self.C3;C3.Plugins.Mouse=class MousePlugin extends C3.SDKPluginBase{constructor(opts){super(opts)}Release(){super.Release()}}}
{const C3=self.C3;const C3X=self.C3X;C3.Plugins.Mouse.Type=class MouseType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IMouseObjectType}};let mouseObjectType=null;function GetMouseSdkInstance(){return mouseObjectType.GetSingleGlobalInstance().GetSdkInstance()}self.IMouseObjectType=class IMouseObjectType extends self.IObjectClass{constructor(objectType){super(objectType);mouseObjectType=objectType;objectType.GetRuntime()._GetCommonScriptInterfaces().mouse=
this}getMouseX(layerNameOrNumber){return GetMouseSdkInstance().GetMousePositionForLayer(layerNameOrNumber)[0]}getMouseY(layerNameOrNumber){return GetMouseSdkInstance().GetMousePositionForLayer(layerNameOrNumber)[1]}getMousePosition(layerNameOrNumber){return GetMouseSdkInstance().GetMousePositionForLayer(layerNameOrNumber)}isMouseButtonDown(button){return GetMouseSdkInstance().IsMouseButtonDown(button)}setCursorStyle(cursorStyle){C3X.RequireString(cursorStyle);GetMouseSdkInstance().SetCursorStyle(cursorStyle)}setCursorObjectClass(iObjectClass){const sdkInst=
GetMouseSdkInstance();const runtime=sdkInst.GetRuntime();const objectClass=runtime._UnwrapIObjectClass(iObjectClass);sdkInst.SetCursorObjectClass(objectClass)}}}
{const C3=self.C3;const DOM_COMPONENT_ID="mouse";let lastSetCursor=null;C3.Plugins.Mouse.Instance=class MouseInstance extends C3.SDKInstanceBase{constructor(inst,properties){super(inst,DOM_COMPONENT_ID);this._buttonMap=[false,false,false,false,false];this._mouseXcanvas=0;this._mouseYcanvas=0;this._triggerButton=0;this._triggerType=0;this._triggerDir=0;this._wheelDeltaX=0;this._wheelDeltaY=0;this._wheelDeltaZ=0;this._hasPointerLock=false;this._movementX=0;this._movementY=0;this.AddDOMMessageHandlers([["pointer-lock-change",
e=>this._OnPointerLockChange(e)],["pointer-lock-error",e=>this._OnPointerLockError(e)]]);const rt=this.GetRuntime().Dispatcher();this._disposables=new C3.CompositeDisposable(C3.Disposable.From(rt,"pointermove",e=>this._OnPointerMove(e.data)),C3.Disposable.From(rt,"pointerdown",e=>this._OnPointerDown(e.data)),C3.Disposable.From(rt,"pointerup",e=>this._OnPointerUp(e.data)),C3.Disposable.From(rt,"dblclick",e=>this._OnDoubleClick(e.data)),C3.Disposable.From(rt,"wheel",e=>this._OnMouseWheel(e.data)),C3.Disposable.From(rt,
"window-blur",()=>this._OnWindowBlur()))}Release(){super.Release()}_OnPointerDown(e){if(e["pointerType"]!=="mouse")return;this._mouseXcanvas=e["pageX"]-this._runtime.GetCanvasClientX();this._mouseYcanvas=e["pageY"]-this._runtime.GetCanvasClientY();this._CheckButtonChanges(e["lastButtons"],e["buttons"])}_OnPointerMove(e){this._movementX=e["movementX"];this._movementY=e["movementY"];this.Trigger(C3.Plugins.Mouse.Cnds.OnMovement);this._movementX=0;this._movementY=0;if(e["pointerType"]!=="mouse")return;
this._mouseXcanvas=e["pageX"]-this._runtime.GetCanvasClientX();this._mouseYcanvas=e["pageY"]-this._runtime.GetCanvasClientY();this._CheckButtonChanges(e["lastButtons"],e["buttons"])}_OnPointerUp(e){if(e["pointerType"]!=="mouse")return;this._CheckButtonChanges(e["lastButtons"],e["buttons"])}_CheckButtonChanges(lastButtons,buttons){this._CheckButtonChange(lastButtons,buttons,1,0);this._CheckButtonChange(lastButtons,buttons,4,1);this._CheckButtonChange(lastButtons,buttons,2,2);this._CheckButtonChange(lastButtons,
buttons,8,3);this._CheckButtonChange(lastButtons,buttons,16,4)}_CheckButtonChange(lastButtons,buttons,checkButtonFlag,resultButton){if(!(lastButtons&checkButtonFlag)&&buttons&checkButtonFlag)this._OnMouseDown(resultButton);else if(lastButtons&checkButtonFlag&&!(buttons&checkButtonFlag))this._OnMouseUp(resultButton)}_OnMouseDown(button){this._buttonMap[button]=true;this.Trigger(C3.Plugins.Mouse.Cnds.OnAnyClick);this._triggerButton=button;this._triggerType=0;this.Trigger(C3.Plugins.Mouse.Cnds.OnClick);
this.Trigger(C3.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseUp(button){if(!this._buttonMap[button])return;this._buttonMap[button]=false;this._triggerButton=button;this.Trigger(C3.Plugins.Mouse.Cnds.OnRelease)}_OnDoubleClick(e){this._triggerButton=e["button"];this._triggerType=1;this.Trigger(C3.Plugins.Mouse.Cnds.OnClick);this.Trigger(C3.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseWheel(e){this._triggerDir=e["deltaY"]<0?1:0;this._wheelDeltaX=e["deltaX"];this._wheelDeltaY=e["deltaY"];this._wheelDeltaZ=
e["deltaZ"];this.Trigger(C3.Plugins.Mouse.Cnds.OnWheel)}_OnWindowBlur(){for(let i=0,len=this._buttonMap.length;i<len;++i){if(!this._buttonMap[i])return;this._buttonMap[i]=false;this._triggerButton=i;this.Trigger(C3.Plugins.Mouse.Cnds.OnRelease)}}GetMousePositionForLayer(layerNameOrNumber){const layout=this._runtime.GetMainRunningLayout();const x=this._mouseXcanvas;const y=this._mouseYcanvas;if(typeof layerNameOrNumber==="undefined"){const layer=layout.GetLayerByIndex(0);return layer.CanvasCssToLayer_DefaultTransform(x,
y)}else{const layer=layout.GetLayer(layerNameOrNumber);if(layer)return layer.CanvasCssToLayer(x,y);else return[0,0]}}IsMouseButtonDown(button){button=Math.floor(button);return!!this._buttonMap[button]}_IsMouseOverCanvas(){return this._mouseXcanvas>=0&&this._mouseYcanvas>=0&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight()}SetCursorStyle(cursorStyle){if(lastSetCursor===cursorStyle)return;lastSetCursor=cursorStyle;this.PostToDOM("cursor",cursorStyle)}async SetCursorObjectClass(objectClass){if(C3.Platform.IsMobile||
!objectClass)return;const inst=objectClass.GetFirstPicked();if(!inst)return;const wi=inst.GetWorldInfo();const imageInfo=inst.GetCurrentImageInfo();if(!wi||!imageInfo)return;if(lastSetCursor===imageInfo)return;lastSetCursor=imageInfo;const blobUrl=await imageInfo.ExtractImageToBlobURL();const cursorStyle=`url(${blobUrl}) ${Math.round(wi.GetOriginX()*imageInfo.GetWidth())} ${Math.round(wi.GetOriginY()*imageInfo.GetHeight())}, auto`;this.PostToDOM("cursor",cursorStyle)}_OnPointerLockChange(e){this._UpdatePointerLockState(e["has-pointer-lock"])}_OnPointerLockError(e){this._UpdatePointerLockState(e["has-pointer-lock"]);
this.Trigger(C3.Plugins.Mouse.Cnds.OnPointerLockError)}_UpdatePointerLockState(hasPointerLock){if(this._hasPointerLock===hasPointerLock)return;this._hasPointerLock=hasPointerLock;if(this._hasPointerLock)this.Trigger(C3.Plugins.Mouse.Cnds.OnPointerLocked);else this.Trigger(C3.Plugins.Mouse.Cnds.OnPointerUnlocked)}GetDebuggerProperties(){const prefix="plugins.mouse";return[{title:prefix+".name",properties:[{name:prefix+".debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:prefix+
".debugger.left-button",value:this._buttonMap[0]},{name:prefix+".debugger.middle-button",value:this._buttonMap[1]},{name:prefix+".debugger.right-button",value:this._buttonMap[2]},{name:prefix+".debugger.button-4",value:this._buttonMap[3]},{name:prefix+".debugger.button-5",value:this._buttonMap[4]}]},{title:prefix+".debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map(layer=>({name:"$"+layer.GetName(),value:layer.CanvasCssToLayer(this._mouseXcanvas,this._mouseYcanvas).join(", ")}))}]}}}
{const C3=self.C3;C3.Plugins.Mouse.Cnds={OnClick(button,type){return this._triggerButton===button&&this._triggerType===type},OnAnyClick(){return true},IsButtonDown(button){return this._buttonMap[button]},OnRelease(button){return this._triggerButton===button},IsOverObject(objectClass){const cnd=this._runtime.GetCurrentCondition();const isInverted=cnd.IsInverted();const ptsArr=[];if(this._IsMouseOverCanvas())ptsArr.push([this._mouseXcanvas,this._mouseYcanvas]);return C3.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,
ptsArr,isInverted),isInverted)},OnObjectClicked(button,type,objectClass){if(button!==this._triggerButton||type!==this._triggerType)return false;if(!this._IsMouseOverCanvas())return false;const mx=this._mouseXcanvas;const my=this._mouseYcanvas;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,[[mx,my]],false)},OnWheel(dir){return dir===2||this._triggerDir===dir},OnPointerLocked(){return true},OnPointerUnlocked(){return true},OnPointerLockError(){return true},HasPointerLock(){return this._hasPointerLock},
OnMovement(){return true}}}{const C3=self.C3;const CURSOR_STYLES=["auto","pointer","text","crosshair","move","help","wait","none"];C3.Plugins.Mouse.Acts={SetCursor(c){this.SetCursorStyle(CURSOR_STYLES[c])},SetCursorSprite(objectClass){this.SetCursorObjectClass(objectClass)},RequestPointerLock(){this._PostToDOMMaybeSync("request-pointer-lock")},ReleasePointerLock(){this.PostToDOM("release-pointer-lock")}}}
{const C3=self.C3;C3.Plugins.Mouse.Exps={X(layerParam){return this.GetMousePositionForLayer(layerParam)[0]},Y(layerParam){return this.GetMousePositionForLayer(layerParam)[1]},AbsoluteX(){return this._mouseXcanvas},AbsoluteY(){return this._mouseYcanvas},MovementX(){return this._movementX},MovementY(){return this._movementY},WheelDeltaX(){return this._wheelDeltaX},WheelDeltaY(){return this._wheelDeltaY},WheelDeltaZ(){return this._wheelDeltaZ}}};

}

{
'use strict';{const C3=self.C3;const DOM_COMPONENT_ID="button";C3.Plugins.Button=class ButtonPlugin extends C3.SDKDOMPluginBase{constructor(opts){super(opts,DOM_COMPONENT_ID);this.AddElementMessageHandler("click",(sdkInst,e)=>sdkInst._OnClick(e))}Release(){super.Release()}}}{const C3=self.C3;C3.Plugins.Button.Type=class ButtonType extends C3.SDKTypeBase{constructor(objectClass){super(objectClass)}Release(){super.Release()}OnCreate(){}}}
{const C3=self.C3;const C3X=self.C3X;const TYPE=0;const TEXT=1;const TOOLTIP=2;const INITIALLY_VISIBLE=3;const ENABLE=4;const AUTO_FONT_SIZE=5;const CHECKED=6;const ID=7;const CLASS_NAME=8;const DOM_COMPONENT_ID="button";C3.Plugins.Button.Instance=class ButtonInstance extends C3.SDKDOMInstanceBase{constructor(inst,properties){super(inst,DOM_COMPONENT_ID);this._text="OK";this._isCheckbox=false;this._isChecked=false;this._title="";this._id="";this._className="";this._isEnabled=true;this._autoFontSize=
true;if(properties){this._isCheckbox=properties[TYPE]===1;this._text=properties[TEXT];this._title=properties[TOOLTIP];this.GetWorldInfo().SetVisible(properties[INITIALLY_VISIBLE]);this._isEnabled=properties[ENABLE];this._autoFontSize=properties[AUTO_FONT_SIZE];this._isChecked=properties[CHECKED];this._id=properties[ID];this._className=properties[CLASS_NAME]}this.CreateElement({"id":this._id,"className":this._className})}Release(){super.Release()}GetElementState(){return{"text":this._text,"isCheckbox":this._isCheckbox,
"isChecked":this._isChecked,"title":this._title,"isVisible":this.GetWorldInfo().IsVisible(),"isEnabled":this._isEnabled}}async _OnClick(e){this._isChecked=e["isChecked"];this.DispatchScriptEvent("click",true);await this.TriggerAsync(C3.Plugins.Button.Cnds.OnClicked)}_SetText(text){if(this._text===text)return;this._text=text;this.UpdateElementState()}_GetText(){return this._text}_SetTooltip(title){if(this._title===title)return;this._title=title;this.UpdateElementState()}_GetTooltip(){return this._title}_SetEnabled(e){e=
!!e;if(this._isEnabled===e)return;this._isEnabled=e;this.UpdateElementState()}_IsEnabled(){return this._isEnabled}_SetChecked(c){if(!this._isCheckbox)return;c=!!c;if(this._isChecked===c)return;this._isChecked=c;this.UpdateElementState()}_IsChecked(){return this._isChecked}Draw(renderer){}SaveToJson(){return{"text":this._text,"checked":this._isChecked,"title":this._title,"enabled":this._isEnabled}}LoadFromJson(o){this._text=o["text"];this._isChecked=o["checked"];this._title=o["title"];this._isEnabled=
o["enabled"];this.UpdateElementState()}GetPropertyValueByIndex(index){switch(index){case TEXT:return this._GetText();case TOOLTIP:return this._GetTooltip();case ENABLE:return this._IsEnabled();case AUTO_FONT_SIZE:return this._autoFontSize;case CHECKED:return this._IsChecked()}}SetPropertyValueByIndex(index,value){switch(index){case TEXT:this._SetText(value);break;case TOOLTIP:this._SetTooltip(value);break;case ENABLE:this._SetEnabled(!!value);break;case AUTO_FONT_SIZE:this._autoFontSize=!!value;break;
case CHECKED:this._SetChecked(!!value);break}}GetDebuggerProperties(){const prefix="plugins.button";return[{title:prefix+".name",properties:[{name:prefix+".properties.text.name",value:this._GetText(),onedit:v=>this._SetText(v)},{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:v=>this._SetEnabled(v)},{name:prefix+".properties.checked.name",value:this._IsChecked(),onedit:v=>this._SetChecked(v)}]}]}GetScriptInterfaceClass(){return self.IButtonInstance}};const map=new WeakMap;self.IButtonInstance=
class IButtonInstance extends self.IDOMInstance{constructor(){super();map.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set text(str){C3X.RequireString(str);map.get(this)._SetText(str)}get text(){return map.get(this)._GetText()}set tooltip(str){C3X.RequireString(str);map.get(this)._SetTooltip(str)}get tooltip(){return map.get(this)._GetTooltip()}set isEnabled(e){map.get(this)._SetEnabled(e)}get isEnabled(){return map.get(this)._IsEnabled()}set isChecked(c){map.get(this)._SetChecked(c)}get isChecked(){return map.get(this)._IsChecked()}}}
{const C3=self.C3;C3.Plugins.Button.Cnds={OnClicked(){return true},IsChecked(){return this._isChecked},CompareText(str,caseSensitive){if(caseSensitive)return this._text===str;else return C3.equalsNoCase(this._text,str)}}}{const C3=self.C3;C3.Plugins.Button.Acts={SetText(text){this._SetText(text)},SetTooltip(title){this._SetTooltip(title)},SetChecked(c){this._SetChecked(c!==0)},ToggleChecked(){if(!this._isCheckbox)return;this._isChecked=!this._isChecked;this.UpdateElementState()}}}
{const C3=self.C3;C3.Plugins.Button.Exps={Text(){return this._text}}};

}

{
'use strict';{const C3=self.C3;C3.Behaviors.MoveTo=class MoveToBehavior extends C3.SDKBehaviorBase{constructor(opts){super(opts)}Release(){super.Release()}}}{const C3=self.C3;C3.Behaviors.MoveTo.Type=class MoveToType extends C3.SDKBehaviorTypeBase{constructor(behaviorType){super(behaviorType)}Release(){super.Release()}OnCreate(){}}}
{const C3=self.C3;const C3X=self.C3X;const IBehaviorInstance=self.IBehaviorInstance;const PROP_MAX_SPEED=0;const PROP_ACCELERATION=1;const PROP_DECELERATION=2;const PROP_ROTATE_SPEED=3;const PROP_SET_ANGLE=4;const PROP_STOP_ON_SOLIDS=5;const PROP_ENABLED=6;C3.Behaviors.MoveTo.Instance=class MoveToInstance extends C3.SDKBehaviorInstanceBase{constructor(behInst,properties){super(behInst);this._maxSpeed=200;this._acc=600;this._dec=600;this._rotateSpeed=0;this._setAngle=true;this._stopOnSolids=false;
this._isEnabled=true;this._speed=0;this._movingAngle=this.GetWorldInfo().GetAngle();this._waypoints=[];if(properties){this._maxSpeed=properties[PROP_MAX_SPEED];this._acc=properties[PROP_ACCELERATION];this._dec=properties[PROP_DECELERATION];this._rotateSpeed=C3.toRadians(properties[PROP_ROTATE_SPEED]);this._setAngle=properties[PROP_SET_ANGLE];this._stopOnSolids=properties[PROP_STOP_ON_SOLIDS];this._isEnabled=properties[PROP_ENABLED]}this._timelineInfo=null;this._lastBezierPosition=NaN;this._lastBezierSegment=
NaN}Release(){if(this._timelineInfo){this._timelineInfo.Release();this._timelineInfo=null}this._lastBezierPosition=NaN;this._lastBezierSegment=NaN;super.Release()}SaveToJson(){return{"ms":this._maxSpeed,"acc":this._acc,"dec":this._dec,"rs":this._rotateSpeed,"sa":this._setAngle,"sos":this._stopOnSolids,"s":this._speed,"ma":this._movingAngle,"wp":this._waypoints.map(p=>({"x":p.x,"y":p.y})),"e":this._isEnabled}}LoadFromJson(o){this._maxSpeed=o["ms"];this._acc=o["acc"];this._dec=o["dec"];this._rotateSpeed=
o["rs"];this._setAngle=o["sa"];this._stopOnSolids=o["sos"];this._speed=o["s"];this._movingAngle=o["ma"];this._waypoints=o["wp"].map(p=>({x:p["x"],y:p["y"]}));this._SetEnabled(o["e"]);if(this._isEnabled&&this._waypoints.length>0)this._StartTicking()}_AddWaypoint(x,y,isDirect,opts){if(isDirect)C3.clearArray(this._waypoints);this._waypoints.push({x,y,opts});if(this._isEnabled)this._StartTicking()}_GetWaypointCount(){return this._waypoints.length}_GetWaypointXAt(i){i=Math.floor(i);if(i<0||i>=this._waypoints.length)return 0;
return this._waypoints[i].x}_GetWaypointYAt(i){i=Math.floor(i);if(i<0||i>=this._waypoints.length)return 0;return this._waypoints[i].y}_IsMoving(){return this._waypoints.length>0}_Stop(){C3.clearArray(this._waypoints);this._speed=0;this._StopTicking()}_GetTargetX(){if(this._waypoints.length>0)return this._waypoints[0].x;else return 0}_GetTargetY(){if(this._waypoints.length>0)return this._waypoints[0].y;else return 0}_GetTargetIsBezier(){if(this._waypoints.length>0){const waypoint=this._waypoints[0];
if(waypoint.opts)return waypoint.opts.isBezier}return false}_GetTargetIsBezierFirst(){if(this._waypoints.length>0){const waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.isBezier&&waypoint.opts.isFirst}return false}_GetTargetBezierPosition(){if(this._waypoints.length>0){const waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.bezierPosition}return false}_GetTargetBezierSegment(){if(this._waypoints.length>0){const waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.bezierSegment}return false}_SetSpeed(s){if(!this._IsMoving())return;
this._speed=Math.min(s,this._maxSpeed)}_GetSpeed(){return this._speed}_SetMaxSpeed(ms){this._maxSpeed=Math.max(ms,0);this._SetSpeed(this._speed)}_GetMaxSpeed(){return this._maxSpeed}_IsRotationEnabled(){if(this._isEnabled&&this._IsMoving())if(this._GetTargetIsBezier()){if(this._GetTargetIsBezierFirst())return true;return false}return this._rotateSpeed!==0}Tick(){if(!this._isEnabled||!this._IsMoving())return;const dt=this._runtime.GetDt(this._inst);const wi=this._inst.GetWorldInfo();const startX=wi.GetX();
const startY=wi.GetY();const startAngle=wi.GetAngle();let curSpeed=this._speed;let maxSpeed=this._maxSpeed;const acc=this._acc;const dec=this._dec;const targetX=this._GetTargetX();const targetY=this._GetTargetY();const angleToTarget=C3.angleTo(startX,startY,targetX,targetY);let isWithinStoppingDistance=false;if(dec>0&&this._waypoints.length===1){const stoppingDist=.5*curSpeed*curSpeed/dec*1.0001;isWithinStoppingDistance=C3.distanceSquared(startX,startY,targetX,targetY)<=stoppingDist*stoppingDist;
if(isWithinStoppingDistance){const remainingDist=C3.distanceTo(startX,startY,targetX,targetY);curSpeed=Math.sqrt(2*dec*remainingDist);maxSpeed=curSpeed;this._speed=curSpeed}}if(this._IsRotationEnabled()){const da=C3.angleDiff(this._movingAngle,angleToTarget);if(da>Number.EPSILON){const t=da/this._rotateSpeed;const dist=C3.distanceTo(wi.GetX(),wi.GetY(),targetX,targetY);const r=dist/(2*Math.sin(da));const curveDist=r*da;maxSpeed=Math.min(maxSpeed,C3.clamp(curveDist/t,0,this._maxSpeed))}}let curAcc=
isWithinStoppingDistance?-dec:acc;const stepDist=Math.min(curSpeed*dt+.5*curAcc*dt*dt,maxSpeed*dt);if(isWithinStoppingDistance){if(dec>0){this._speed=Math.max(this._speed-dec*dt,0);if(this._speed===0){this._OnArrived(wi,targetX,targetY);return}}}else if(acc===0)this._speed=maxSpeed;else this._speed=Math.min(this._speed+acc*dt,maxSpeed);if(C3.distanceSquared(wi.GetX(),wi.GetY(),targetX,targetY)<=stepDist*stepDist){this._OnArrived(wi,targetX,targetY);return}if(this._IsRotationEnabled())this._movingAngle=
C3.angleRotate(this._movingAngle,angleToTarget,this._rotateSpeed*dt);else this._movingAngle=angleToTarget;wi.OffsetXY(Math.cos(this._movingAngle)*stepDist,Math.sin(this._movingAngle)*stepDist);if(this._setAngle){const targetIsBezier=this._GetTargetIsBezier();const targetIsBezierFirst=this._GetTargetIsBezierFirst();if(targetIsBezier&&!targetIsBezierFirst){const bezierSegment=this._GetTargetBezierSegment();const bezierPosition=this._GetTargetBezierPosition();const x=wi.GetX();const y=wi.GetY();if(self.isNaN(this._lastBezierSegment))this._lastBezierSegment=
0;let projection;if(this._lastBezierSegment===bezierSegment)projection=this._timelineInfo.Project(x,y,{tRange:[this._lastBezierPosition,bezierPosition]});else projection=this._timelineInfo.Project(x,y);const angle=this._timelineInfo.TangentAngle(x,y,projection[2],projection[4]);wi.SetAngle(angle)}else{wi.SetAngle(this._movingAngle);this._lastBezierPosition=NaN;this._lastBezierSegment=NaN}}wi.SetBboxChanged();this._CheckSolidCollision(startX,startY,startAngle)}_OnArrived(wi,targetX,targetY){wi.SetXY(targetX,
targetY);wi.SetBboxChanged();const waypoint=this._waypoints[0];if(waypoint.opts&&waypoint.opts.isBezier){this._lastBezierPosition=waypoint.opts.bezierPosition;this._lastBezierSegment=waypoint.opts.bezierSegment}else{this._lastBezierPosition=NaN;this._lastBezierSegment=NaN}this._waypoints.shift();if(this._waypoints.length===0){if(this._timelineInfo){this._timelineInfo.Release();this._timelineInfo=null;this._lastBezierPosition=NaN;this._lastBezierSegment=NaN}this._speed=0;this._StopTicking()}this.DispatchScriptEvent("arrived");
this.Trigger(C3.Behaviors.MoveTo.Cnds.OnArrived)}_CheckSolidCollision(startX,startY,startAngle){const collisionEngine=this._runtime.GetCollisionEngine();if(this._stopOnSolids&&collisionEngine.TestOverlapSolid(this._inst)){this._Stop();const wi=this._inst.GetWorldInfo();const x=wi.GetX();const y=wi.GetY();const a=C3.angleTo(x,y,startX,startY);const dist=C3.distanceTo(x,y,startX,startY);if(!collisionEngine.PushOutSolid(this._inst,Math.cos(a),Math.sin(a),Math.max(dist,1))){wi.SetXY(startX,startY);wi.SetAngle(startAngle);
wi.SetBboxChanged()}this.DispatchScriptEvent("hitsolid");this.Trigger(C3.Behaviors.MoveTo.Cnds.OnHitSolid)}}_IsSetAngle(){return this._setAngle}_SetSetAngle(a){this._setAngle=!!a}_SetAngleOfMotion(a){this._movingAngle=a;if(this._isEnabled&&this._setAngle&&!this._IsMoving()){const wi=this.GetWorldInfo();wi.SetAngle(this._movingAngle);wi.SetBboxChanged()}}_GetAngleOfMotion(){return this._movingAngle}_SetAcceleration(a){this._acc=Math.max(a,0)}_GetAcceleration(){return this._acc}_SetDeceleration(d){this._dec=
Math.max(d,0)}_GetDeceleration(){return this._dec}_SetRotateSpeed(r){this._rotateSpeed=Math.max(r,0)}_GetRotateSpeed(){return this._rotateSpeed}_SetStopOnSolids(e){this._stopOnSolids=!!e}_IsStopOnSolids(){return this._stopOnSolids}_SetEnabled(e){e=!!e;if(this._isEnabled===e)return;this._isEnabled=e;if(this._isEnabled&&this._IsMoving())this._StartTicking();else this._StopTicking()}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(index){switch(index){case PROP_MAX_SPEED:return this._GetMaxSpeed();
case PROP_ACCELERATION:return this._GetAcceleration();case PROP_DECELERATION:return this._GetDeceleration();case PROP_ROTATE_SPEED:return C3.toDegrees(this._GetRotateSpeed());case PROP_SET_ANGLE:return this._IsSetAngle();case PROP_STOP_ON_SOLIDS:return this._IsStopOnSolids();case PROP_ENABLED:return this._IsEnabled()}}SetPropertyValueByIndex(index,value){switch(index){case PROP_MAX_SPEED:this._SetMaxSpeed(value);break;case PROP_ACCELERATION:this._SetAcceleration(value);break;case PROP_DECELERATION:this._SetDeceleration(value);
break;case PROP_ROTATE_SPEED:this._SetRotateSpeed(C3.toRadians(value));break;case PROP_SET_ANGLE:this._SetSetAngle(value);break;case PROP_STOP_ON_SOLIDS:this._SetStopOnSolids(value);break;case PROP_ENABLED:this._SetEnabled(value);break}}GetDebuggerProperties(){const prefix="behaviors.moveto";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".debugger.speed",value:this._GetSpeed(),onedit:v=>this._SetSpeed(v)},{name:prefix+".debugger.angle-of-motion",value:C3.toDegrees(this._GetAngleOfMotion()),
onedit:v=>this._movingAngle=C3.toRadians(v)},{name:prefix+".debugger.target-x",value:this._GetTargetX()},{name:prefix+".debugger.target-y",value:this._GetTargetY()},{name:prefix+".debugger.waypoint-count",value:this._GetWaypointCount()},{name:prefix+".properties.max-speed.name",value:this._GetMaxSpeed(),onedit:v=>this._SetMaxSpeed(v)},{name:prefix+".properties.acceleration.name",value:this._GetAcceleration(),onedit:v=>this._SetAcceleration(v)},{name:prefix+".properties.deceleration.name",value:this._GetDeceleration(),
onedit:v=>this._SetDeceleration(v)},{name:prefix+".properties.rotate-speed.name",value:C3.toDegrees(this._GetRotateSpeed()),onedit:v=>this._SetRotateSpeed(C3.toRadians(v))},{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:v=>this._SetEnabled(v)}]}]}GetScriptInterfaceClass(){return self.IMoveToBehaviorInstance}};const map=new WeakMap;self.IMoveToBehaviorInstance=class IMoveToBehaviorInstance extends IBehaviorInstance{constructor(){super();map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}moveToPosition(x,
y,isDirect=true){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);map.get(this)._AddWaypoint(x,y,!!isDirect)}getTargetX(){return map.get(this)._GetTargetX()}getTargetY(){return map.get(this)._GetTargetY()}getTargetPosition(){const b=map.get(this);return[b._GetTargetX(),b._GetTargetY()]}getWaypointCount(){return map.get(this)._GetWaypointCount()}getWaypointX(i){C3X.RequireFiniteNumber(i);return map.get(this)._GetWaypointXAt(i)}getWaypointY(i){C3X.RequireFiniteNumber(i);return map.get(this)._GetWaypointYAt(i)}getWaypoint(i){C3X.RequireFiniteNumber(i);
const b=map.get(this);return[b._GetWaypointXAt(i),b._GetWaypointYAt(i)]}stop(){map.get(this)._Stop()}get isMoving(){return map.get(this)._IsMoving()}get speed(){return map.get(this)._GetSpeed()}set speed(s){C3X.RequireFiniteNumber(s);map.get(this)._SetSpeed(s)}get maxSpeed(){return map.get(this)._GetMaxSpeed()}set maxSpeed(ms){C3X.RequireFiniteNumber(ms);map.get(this)._SetMaxSpeed(ms)}get acceleration(){return map.get(this)._GetAcceleration()}set acceleration(a){C3X.RequireFiniteNumber(a);map.get(this)._SetAcceleration(a)}get deceleration(){return map.get(this)._GetDeceleration()}set deceleration(d){C3X.RequireFiniteNumber(d);
map.get(this)._SetDeceleration(d)}get angleOfMotion(){return map.get(this)._GetAngleOfMotion()}set angleOfMotion(a){C3X.RequireFiniteNumber(a);map.get(this)._SetAngleOfMotion(a)}get rotateSpeed(){return map.get(this)._GetRotateSpeed()}set rotateSpeed(r){C3X.RequireFiniteNumber(r);map.get(this)._SetRotateSpeed(r)}get isStopOnSolids(){return map.get(this)._IsStopOnSolids()}set isStopOnSolids(e){map.get(this)._SetStopOnSolids(e)}get isEnabled(){return map.get(this)._IsEnabled()}set isEnabled(e){map.get(this)._SetEnabled(e)}}}
{const C3=self.C3;C3.Behaviors.MoveTo.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(cmp,s){return C3.compare(this._GetSpeed(),cmp,s)},IsEnabled(){return this._IsEnabled()},OnArrived(){return true},OnHitSolid(){return true}}}
{const C3=self.C3;C3.Behaviors.MoveTo.Acts={MoveToPosition(x,y,mode){this._AddWaypoint(x,y,mode===0)},MoveToObject(objectClass,imgPt,mode){if(!objectClass)return;const inst=objectClass.GetPairedInstance(this._inst);if(!inst||!inst.GetWorldInfo())return;const [x,y]=inst.GetImagePoint(imgPt);this._AddWaypoint(x,y,mode===0)},MoveAlongPathfindingPath(mode){const behInst=this._inst.GetBehaviorSdkInstanceFromCtor(C3.Behaviors.Pathfinding);if(!behInst)return;const path=behInst._GetPath();if(path.length===
0)return;for(let i=0,len=path.length;i<len;++i){const n=path[i];this._AddWaypoint(n.x,n.y,i===0&&mode===0)}},MoveAlongTimeline(timeline,trackId,mode){const timelineInfo=C3.New(C3.TimelineInfo,timeline,trackId);if(!timelineInfo.WasInitialized()){timelineInfo.Release();return}timelineInfo.SetOrigin(this._inst.GetWorldInfo());let first=true;for(const segment of timelineInfo.segments())switch(segment.GetType()){case "line":{const x=segment.GetX();const y=segment.GetY();this._AddWaypoint(x,y,first&&mode===
0);first=false;break}case "cubic-bezier":{for(let i=0;i<=segment.GetStepCount();i++){const step=i*segment.GetStepIncrement();const p=segment.Map(step);const x=p[0];const y=p[1];this._AddWaypoint(x,y,first&&mode===0,{isBezier:true,isFirst:first,bezierPosition:segment._Map(step),bezierSegment:segment.GetIndex()});first=false}break}}this._timelineInfo=timelineInfo},MoveAlongTimelineByName(timelineName,trackId,mode){const timeline=this._runtime.GetTimelineManager().GetTimelineByName(timelineName);if(!timeline)return;
C3.Behaviors.MoveTo.Acts.MoveAlongTimeline.call(this,timeline,trackId,mode)},Stop(){this._Stop()},SetMovingAngle(a){this._SetAngleOfMotion(C3.toRadians(a))},SetSpeed(s){this._SetSpeed(s)},SetMaxSpeed(ms){this._SetMaxSpeed(ms)},SetAcceleration(a){this._SetAcceleration(a)},SetDeceleration(d){this._SetDeceleration(d)},SetRotateSpeed(r){this._SetRotateSpeed(C3.toRadians(r))},SetStopOnSolids(e){this._SetStopOnSolids(e)},SetEnabled(e){this._SetEnabled(e)}}}
{const C3=self.C3;C3.Behaviors.MoveTo.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},MovingAngle(){return C3.toDegrees(this._GetAngleOfMotion())},RotateSpeed(){return C3.toDegrees(this._GetRotateSpeed())},TargetX(){return this._GetTargetX()},TargetY(){return this._GetTargetY()},WaypointCount(){return this._GetWaypointCount()},WaypointXAt(i){return this._GetWaypointXAt(i)},WaypointYAt(i){return this._GetWaypointYAt(i)}}};

}

{
'use strict';{const C3=self.C3;const C3X=self.C3X;let tempVec2a=null;let tempVec2b=null;let vec2RecycleCache=[];let Box2D=null;let physicsBehavior=null;const PHYSICS_COLLISIONS_KEY="Physics_DisabledCollisions";function SetObjectTypeCollisionsEnabled(typeA,typeB,state){const savedA=typeA.GetSavedDataMap();const savedB=typeB.GetSavedDataMap();if(state){const setA=savedA.get(PHYSICS_COLLISIONS_KEY);if(setA)setA.delete(typeB.GetSID());const setB=savedB.get(PHYSICS_COLLISIONS_KEY);if(setB)setB.delete(typeA.GetSID())}else{let setA=
savedA.get(PHYSICS_COLLISIONS_KEY);if(!setA){setA=new Set;savedA.set(PHYSICS_COLLISIONS_KEY,setA)}let setB=savedB.get(PHYSICS_COLLISIONS_KEY);if(!setB){setB=new Set;savedB.set(PHYSICS_COLLISIONS_KEY,setB)}setA.add(typeB.GetSID());setB.add(typeA.GetSID())}}C3.Behaviors.Physics=class PhysicsBehavior extends C3.SDKBehaviorBase{constructor(opts){super(opts);physicsBehavior=this;this._world=null;this._worldG=10;this._worldScale=.02;this._worldManifold=null;this._lastUpdateTick=-1;this._steppingMode=1;
this._velocityIterations=8;this._positionIterations=3;this._allCollisionsEnabled=true;this._runtime.AddLoadPromise(this._LoadBox2DWasm())}GetScriptInterfaceClass(){return self.IPhysicsBehavior}async _LoadBox2DWasm(){const box2dWasmUrl=await this._runtime.GetAssetManager().GetProjectFileUrl("box2d.wasm");await new Promise(resolve=>{self["Box2DWasmModule"]({"wasmBinaryFile":box2dWasmUrl}).then(box2d=>{Box2D=box2d;this._InitBox2DWorld();resolve()})})}_InitBox2DWorld(){const collisionEngine=this._runtime.GetCollisionEngine();
tempVec2a=C3.Behaviors.Physics.GetVec2(0,0);tempVec2b=C3.Behaviors.Physics.GetVec2(0,0);this._world=new Box2D["b2World"](C3.Behaviors.Physics.GetTempVec2A(0,this._worldG),true);const listener=new Box2D["JSContactListener"];listener["BeginContact"]=contactPtr=>{const contact=Box2D["wrapPointer"](contactPtr,Box2D["b2Contact"]);const behA=C3.Behaviors.Physics.Instance.LookupBehInstFromBody(contact["GetFixtureA"]()["GetBody"]());const behB=C3.Behaviors.Physics.Instance.LookupBehInstFromBody(contact["GetFixtureB"]()["GetBody"]());
collisionEngine.RegisterCollision(behA.GetObjectInstance(),behB.GetObjectInstance())};listener["EndContact"]=()=>{};listener["PreSolve"]=()=>{};listener["PostSolve"]=()=>{};this._world["SetContactListener"](listener);const filter=new Box2D["JSContactFilter"];filter["ShouldCollide"]=(fixAPtr,fixBPtr)=>{if(this._allCollisionsEnabled)return true;const fixtureA=Box2D["wrapPointer"](fixAPtr,Box2D["b2Fixture"]);const fixtureB=Box2D["wrapPointer"](fixBPtr,Box2D["b2Fixture"]);const behA=C3.Behaviors.Physics.Instance.LookupBehInstFromBody(fixtureA["GetBody"]());
const behB=C3.Behaviors.Physics.Instance.LookupBehInstFromBody(fixtureB["GetBody"]());const typeA=behA.GetObjectInstance().GetObjectClass();const typeB=behB.GetObjectInstance().GetObjectClass();const sidA=typeA.GetSID();const sidB=typeB.GetSID();const setA=typeA.GetSavedDataMap().get(PHYSICS_COLLISIONS_KEY);if(setA&&setA.has(sidB))return false;const setB=typeB.GetSavedDataMap().get(PHYSICS_COLLISIONS_KEY);if(setB&&setB.has(sidA))return false;return true};this._world["SetContactFilter"](filter);this._worldManifold=
new Box2D["b2WorldManifold"]}Release(){super.Release()}GetBox2D(){return Box2D}GetWorld(){return this._world}GetWorldScale(){return this._worldScale}GetSteppingMode(){return this._steppingMode}SetSteppingMode(m){this._steppingMode=m}SetLastUpdateTick(t){this._lastUpdateTick=t}GetLastUpdateTick(){return this._lastUpdateTick}SetVelocityIterations(v){this._velocityIterations=Math.max(v,1)}GetVelocityIterations(){return this._velocityIterations}SetPositionIterations(p){this._positionIterations=Math.max(p,
1)}GetPositionIterations(){return this._positionIterations}SetIterations(v,p){this.SetVelocityIterations(v);this.SetPositionIterations(p)}GetGravity(){return this._worldG}SetGravity(g){if(g===this._worldG)return;this._world["SetGravity"](C3.Behaviors.Physics.GetTempVec2A(0,g));this._worldG=g;this._WakeUpAllPhysicsBodies()}_WakeUpAllPhysicsBodies(){for(const inst of this.GetInstances()){const behInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(inst);if(!behInst)continue;const body=behInst.GetBody();
if(!body)continue;body["SetAwake"](true)}}DisableShouldCollideFastPath(){this._allCollisionsEnabled=false}SetCollisionsEnabled(typeA,typeB,state){state=!!state;if(!typeA||!typeB)return;if(typeB.IsFamily())for(const member of typeB.GetFamilyMembers())SetObjectTypeCollisionsEnabled(typeA,member,state);else SetObjectTypeCollisionsEnabled(typeA,typeB,state);this.DisableShouldCollideFastPath()}GetWorldManifold(){return this._worldManifold}static GetPhysicsCollisionKey(){return PHYSICS_COLLISIONS_KEY}static GetVec2(x,
y){if(vec2RecycleCache.length){const ret=vec2RecycleCache.pop();ret["set_x"](x);ret["set_y"](y);return ret}else{const b2Vec2=Box2D["b2Vec2"];return new b2Vec2(x,y)}}static FreeVec2(v){vec2RecycleCache.push(v)}static GetTempVec2A(x,y){tempVec2a["set_x"](x);tempVec2a["set_y"](y);return tempVec2a}static GetTempVec2B(x,y){tempVec2b["set_x"](x);tempVec2b["set_y"](y);return tempVec2b}static CreatePolygonShape(vertices){const b2PolygonShape=Box2D["b2PolygonShape"];const shape=new b2PolygonShape;const buffer=
Box2D["_malloc"](vertices.length*8);let offset=0;for(let i=0;i<vertices.length;++i){Box2D["HEAPF32"][buffer+offset>>2]=vertices[i]["get_x"]();Box2D["HEAPF32"][buffer+(offset+4)>>2]=vertices[i]["get_y"]();offset+=8}const ptr_wrapped=Box2D["wrapPointer"](buffer,Box2D["b2Vec2"]);shape["Set"](ptr_wrapped,vertices.length);Box2D["_free"](buffer);return shape}};const STEPPING_MODES=["fixed","variable"];self.IPhysicsBehavior=class IPhysicsBehavior extends self.IBehavior{constructor(){super()}set worldGravity(g){C3X.RequireFiniteNumber(g);
physicsBehavior.SetGravity(g)}get worldGravity(){return physicsBehavior.GetGravity()}set steppingMode(s){const i=STEPPING_MODES.indexOf(s);if(i<0)throw new Error("invalid stepping mode");physicsBehavior.SetSteppingMode(STEPPING_MODES[i])}get steppingMode(){return STEPPING_MODES[physicsBehavior.GetSteppingMode()]}set velocityIterations(v){C3X.RequireFiniteNumber(v);physicsBehavior.SetVelocityIterations(v)}get velocityIterations(){return physicsBehavior.GetVelocityIterations()}set positionIterations(p){C3X.RequireFiniteNumber(p);
physicsBehavior.SetPositionIterations(p)}get positionIterations(){return physicsBehavior.GetPositionIterations()}setCollisionsEnabled(iObjectClassA,iObjectClassB,state){const runtime=physicsBehavior.GetRuntime();const objectClassA=runtime._UnwrapIObjectClass(iObjectClassA);const objectClassB=runtime._UnwrapIObjectClass(iObjectClassB);state=!!state;physicsBehavior.SetCollisionsEnabled(objectClassA,objectClassB,state)}}}{const C3=self.C3;C3.Behaviors.Physics.Type=class PhysicsType extends C3.SDKBehaviorTypeBase{constructor(behaviorType){super(behaviorType)}Release(){super.Release()}OnCreate(){}}}
{const C3=self.C3;const C3X=self.C3X;const IBehaviorInstance=self.IBehaviorInstance;const assert=self.assert;const IMMOVABLE=0;const COLLISION_MASK=1;const PREVENT_ROTATION=2;const DENSITY=3;const FRICTION=4;const ELASTICITY=5;const LINEAR_DAMPING=6;const ANGULAR_DAMPING=7;const BULLET=8;const ENABLE=9;const body2beh=new WeakMap;const inst2beh=new WeakMap;const tileConvexPolyCache=new WeakMap;const TILE_FLIPPED_HORIZONTAL=-2147483648;const TILE_FLIPPED_VERTICAL=1073741824;const TILE_FLIPPED_DIAGONAL=
536870912;const TILE_FLAGS_MASK=3758096384;const TILE_ID_MASK=536870911;const GetTempVec2A=C3.Behaviors.Physics.GetTempVec2A;const GetTempVec2B=C3.Behaviors.Physics.GetTempVec2B;const tempRect=C3.New(C3.Rect);const tempQuad=C3.New(C3.Quad);C3.Behaviors.Physics.Instance=class PhysicsInstance extends C3.SDKBehaviorInstanceBase{constructor(behInst,properties){super(behInst);const behavior=this.GetBehavior();const wi=this.GetWorldInfo();this._box2d=behavior.GetBox2D();this._world=behavior.GetWorld();
this._worldScale=behavior.GetWorldScale();this._isImmovable=false;this._collisionMask=0;this._actualCollisionMask=0;this._preventRotation=false;this._density=1;this._friction=.5;this._restitution=.2;this._linearDamping=0;this._angularDamping=.01;this._isBullet=false;this._isEnabled=true;this._body=null;this._fixtures=[];this._myJoints=[];this._myCreatedJoints=[];this._joiningMe=new Set;this._lastKnownX=wi.GetX();this._lastKnownY=wi.GetY();this._lastKnownAngle=wi.GetAngle();this._lastWidth=0;this._lastHeight=
0;this._lastTickOverride=false;if(properties){this._isImmovable=!!properties[IMMOVABLE];this._collisionMask=properties[COLLISION_MASK];this._preventRotation=!!properties[PREVENT_ROTATION];this._density=properties[DENSITY];this._friction=properties[FRICTION];this._restitution=properties[ELASTICITY];this._linearDamping=properties[LINEAR_DAMPING];this._angularDamping=properties[ANGULAR_DAMPING];this._isBullet=!!properties[BULLET];this._isEnabled=!!properties[ENABLE]}const rt=this._runtime.Dispatcher();
this._disposables=new C3.CompositeDisposable(C3.Disposable.From(rt,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),C3.Disposable.From(rt,"beforeload",()=>this._OnBeforeLoad()),C3.Disposable.From(rt,"afterload",()=>this._OnAfterLoad()));inst2beh.set(this._inst,this);if(this._isEnabled)this._StartTicking()}PostCreate(){this._CreateBody()}Release(){this._DestroyMyJoints();C3.clearArray(this._myCreatedJoints);this._joiningMe.clear();if(this._body){this._DestroyFixtures();this._world["DestroyBody"](this._body);
this._body=null}super.Release()}_CreateFixture(fixDef){if(!this._body)return;const fixture=this._body["CreateFixture"](fixDef);this._fixtures.push(fixture);return fixture}_DestroyFixtures(){if(!this._body)return;for(const fixture of this._fixtures)this._body["DestroyFixture"](fixture);C3.clearArray(this._fixtures)}_GetBoundingQuadExcludingMesh(){const wi=this.GetWorldInfo();if(wi.HasMesh()){wi.CalculateBbox(tempRect,tempQuad,false);return tempQuad}else return wi.GetBoundingQuad()}_Destroy(o){this._box2d["destroy"](o)}_CreateBody(){if(!this._isEnabled)return;
const b2FixtureDef=this._box2d["b2FixtureDef"];const b2BodyDef=this._box2d["b2BodyDef"];const wi=this.GetWorldInfo();const hasPoly=wi.HasOwnCollisionPoly();this._actualCollisionMask=this._collisionMask;if(!hasPoly&&!this._inst.HasTilemap()&&this._actualCollisionMask===0)this._actualCollisionMask=1;if(!this._body){const bodyDef=new b2BodyDef;bodyDef["set_type"](this._isImmovable?0:2);let bodyX=wi.GetX()*this._worldScale;let bodyY=wi.GetY()*this._worldScale;if(this._actualCollisionMask===2){const bquad=
this._GetBoundingQuadExcludingMesh();bodyX=bquad.midX()*this._worldScale;bodyY=bquad.midY()*this._worldScale}bodyDef["set_position"](GetTempVec2B(bodyX,bodyY));bodyDef["set_angle"](wi.GetAngle());bodyDef["set_fixedRotation"](this._preventRotation);bodyDef["set_linearDamping"](this._linearDamping);bodyDef["set_angularDamping"](this._angularDamping);bodyDef["set_bullet"](this._isBullet);this._body=this._world["CreateBody"](bodyDef);this._Destroy(bodyDef);body2beh.set(this._body,this)}this._DestroyFixtures();
const fixDef=new b2FixtureDef;fixDef["set_density"](this._density);fixDef["set_friction"](this._friction);fixDef["set_restitution"](this._restitution);const instW=Math.max(Math.abs(wi.GetWidth()),1);const instH=Math.max(Math.abs(wi.GetHeight()),1);if(this._actualCollisionMask===0)if(this._inst.HasTilemap())this._CreateTilemapFixtures(fixDef);else this._CreatePolygonFixture(fixDef,instW,instH);else if(this._actualCollisionMask===1)this._CreateBoundingBoxFixture(fixDef,wi,instW,instH);else this._CreateCircleFixture(fixDef,
instW,instH);this._lastWidth=wi.GetWidth();this._lastHeight=wi.GetHeight();wi.SetPhysicsBodyChanged(false);this._Destroy(fixDef)}_CreateBoundingBoxFixture(fixDef,wi,instW,instH){const b2PolygonShape=this._box2d["b2PolygonShape"];const shape=new b2PolygonShape;const fixWidth=instW*this._worldScale;const fixHeight=instH*this._worldScale;let originX=wi.GetOriginX();let originY=wi.GetOriginY();if(wi.GetWidth()<0)originX=1-originX;if(wi.GetHeight()<0)originY=1-originY;const fixOriginX=(.5-originX)*fixWidth;
const fixOriginY=(.5-originY)*fixHeight;const originVec=C3.Behaviors.Physics.GetVec2(fixOriginX,fixOriginY);shape["SetAsBox"](fixWidth/2,fixHeight/2,originVec,0);fixDef["set_shape"](shape);this._CreateFixture(fixDef);this._Destroy(shape);C3.Behaviors.Physics.FreeVec2(originVec)}_CreateCircleFixture(fixDef,instW,instH){const b2CircleShape=this._box2d["b2CircleShape"];const shape=new b2CircleShape;shape["set_m_radius"](Math.min(instW,instH)*this._worldScale*.5);fixDef["set_shape"](shape);this._CreateFixture(fixDef);
this._Destroy(shape)}_CreatePolygonFixture(fixDef,instW,instH){const wi=this.GetWorldInfo();const isMirrored=wi.GetWidth()<0;const isFlipped=wi.GetHeight()<0;const worldScale=this._worldScale;const transformedPoly=wi.GetCustomTransformedCollisionPoly(isMirrored?-instW:instW,isFlipped?-instH:instH,0);const ptsArr=transformedPoly.pointsArr();const ptsCount=ptsArr.length/2;const arr=[];for(let i=0;i<ptsCount;++i)arr.push(C3.Behaviors.Physics.GetVec2(ptsArr[i*2],ptsArr[i*2+1]));if(isMirrored!==isFlipped)arr.reverse();
const convexPolys=C3.Behaviors.Physics.Separator.Separate(arr,instW*instH);for(const v of arr)C3.Behaviors.Physics.FreeVec2(v);if(convexPolys.length)for(const arr2 of convexPolys){for(const vec of arr2){vec["set_x"](vec["get_x"]()*worldScale);vec["set_y"](vec["get_y"]()*worldScale)}const shape=C3.Behaviors.Physics.CreatePolygonShape(arr2);fixDef["set_shape"](shape);this._CreateFixture(fixDef);this._Destroy(shape);for(const v of arr2)C3.Behaviors.Physics.FreeVec2(v)}else this._CreateBoundingBoxFixture(fixDef,
wi,instW,instH)}_CreateTilemapFixtures(fixDef){const worldScale=this._worldScale;const GetVec2=C3.Behaviors.Physics.GetVec2;const FreeVec2=C3.Behaviors.Physics.FreeVec2;const collRects=[];this._inst.GetSdkInstance().GetAllCollisionRects(collRects);const arr=[];for(let i=0,len=collRects.length;i<len;++i){const c=collRects[i];const rc=c.GetRect();const poly=c.GetPoly();if(poly){let convexPolys=tileConvexPolyCache.get(poly);if(!convexPolys){const ptsArr=poly.pointsArr();const ptsCount=poly.pointCount();
for(let j=0;j<ptsCount;++j)arr.push(GetVec2(ptsArr[j*2],ptsArr[j*2+1]));const flags=c.GetTileId()&TILE_FLAGS_MASK;if(flags===TILE_FLIPPED_HORIZONTAL||flags===TILE_FLIPPED_VERTICAL||flags===TILE_FLIPPED_DIAGONAL||flags&TILE_FLIPPED_HORIZONTAL&&flags&TILE_FLIPPED_VERTICAL&&flags&TILE_FLIPPED_DIAGONAL)arr.reverse();convexPolys=C3.Behaviors.Physics.Separator.Separate(arr,rc.width()*rc.height());tileConvexPolyCache.set(poly,convexPolys);for(const v of arr)FreeVec2(v);C3.clearArray(arr)}for(let j=0,lenj=
convexPolys.length;j<lenj;++j){const cp=convexPolys[j];for(let k=0,lenk=cp.length;k<lenk;++k)arr.push(GetVec2((rc.getLeft()+cp[k]["get_x"]())*worldScale,(rc.getTop()+cp[k]["get_y"]())*worldScale));const shape=C3.Behaviors.Physics.CreatePolygonShape(arr);fixDef["set_shape"](shape);this._CreateFixture(fixDef);this._Destroy(shape);for(const v of arr)FreeVec2(v);C3.clearArray(arr)}}else{arr.push(GetVec2(rc.getLeft()*worldScale,rc.getTop()*worldScale));arr.push(GetVec2(rc.getRight()*worldScale,rc.getTop()*
worldScale));arr.push(GetVec2(rc.getRight()*worldScale,rc.getBottom()*worldScale));arr.push(GetVec2(rc.getLeft()*worldScale,rc.getBottom()*worldScale));const shape=C3.Behaviors.Physics.CreatePolygonShape(arr);fixDef["set_shape"](shape);this._CreateFixture(fixDef);this._Destroy(shape)}for(const v of arr)FreeVec2(v);C3.clearArray(arr)}}_DestroyBody(){if(!this._body)return;this._DestroyMyJoints();body2beh.delete(this._body);this._DestroyFixtures();this._world["DestroyBody"](this._body);this._body=null}_DestroyMyJoints(){for(const joint of this._myJoints)this._world["DestroyJoint"](joint);
C3.clearArray(this._myJoints)}_RecreateMyJoints(){for(const j of this._myCreatedJoints)switch(j.type){case 0:this._DoCreateDistanceJoint(...j.params);break;case 1:this._DoCreateRevoluteJoint(...j.params);break;case 2:this._DoCreateLimitedRevoluteJoint(...j.params);break;case 3:this._DoCreatePrismaticJoint(...j.params);break;default:}}_GetInstImagePoint(imgPt){const wi=this.GetWorldInfo();if(imgPt===-1)return[wi.GetX(),wi.GetY()];if(imgPt===0&&this._body){const wc=this._body["GetWorldCenter"]();return[wc["get_x"]()/
this._worldScale,wc["get_y"]()/this._worldScale]}return this._inst.GetImagePoint(imgPt)}_CreateDistanceJoint(imgPt,otherInst,otherImgPt,damping,freq){if(!this._isEnabled||!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;this._myCreatedJoints.push({type:0,params:[imgPt,otherInst.GetUID(),otherImgPt,damping,freq]});this._DoCreateDistanceJoint(imgPt,otherInst.GetUID(),otherImgPt,
damping,freq)}_DoCreateDistanceJoint(imgPt,otherInstUid,otherImgPt,damping,freq){if(!this._isEnabled)return;const otherInst=this._runtime.GetInstanceByUID(otherInstUid);if(!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;otherBehInst._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(false);otherBehInst._UpdateBodyToMatchInstance(false);const [myX,myY]=this._GetInstImagePoint(imgPt);
const [theirX,theirY]=otherInst.GetImagePoint(otherImgPt);const dx=myX-theirX;const dy=myY-theirY;const b2DistanceJointDef=this._box2d["b2DistanceJointDef"];const worldScale=this._worldScale;const jointDef=new b2DistanceJointDef;jointDef["Initialize"](this._body,otherBehInst.GetBody(),GetTempVec2A(myX*worldScale,myY*worldScale),GetTempVec2B(theirX*worldScale,theirY*worldScale));jointDef["set_length"](Math.hypot(dx,dy)*worldScale);jointDef["set_dampingRatio"](damping);jointDef["set_frequencyHz"](freq);
this._myJoints.push(this._world["CreateJoint"](jointDef));this._Destroy(jointDef)}_CreateRevoluteJoint(imgPt,otherInst){if(!this._isEnabled||!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;this._myCreatedJoints.push({type:1,params:[imgPt,otherInst.GetUID()]});this._DoCreateRevoluteJoint(imgPt,otherInst.GetUID())}_DoCreateRevoluteJoint(imgPt,otherInstUid){if(!this._isEnabled)return;
const otherInst=this._runtime.GetInstanceByUID(otherInstUid);if(!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;otherBehInst._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(false);otherBehInst._UpdateBodyToMatchInstance(false);const [myX,myY]=this._GetInstImagePoint(imgPt);const b2RevoluteJointDef=this._box2d["b2RevoluteJointDef"];const worldScale=this._worldScale;
const jointDef=new b2RevoluteJointDef;jointDef["Initialize"](this._body,otherBehInst.GetBody(),GetTempVec2A(myX*worldScale,myY*worldScale));this._myJoints.push(this._world["CreateJoint"](jointDef));this._Destroy(jointDef)}_CreateLimitedRevoluteJoint(imgPt,otherInst,lower,upper){if(!this._isEnabled||!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;lower=C3.toDegrees(lower);
upper=C3.toDegrees(upper);this._myCreatedJoints.push({type:2,params:[imgPt,otherInst.GetUID(),lower,upper]});this._DoCreateLimitedRevoluteJoint(imgPt,otherInst.GetUID(),lower,upper)}_DoCreateLimitedRevoluteJoint(imgPt,otherInstUid,lower,upper){if(!this._isEnabled)return;const otherInst=this._runtime.GetInstanceByUID(otherInstUid);if(!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;
otherBehInst._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(false);otherBehInst._UpdateBodyToMatchInstance(false);const [myX,myY]=this._GetInstImagePoint(imgPt);const b2RevoluteJointDef=this._box2d["b2RevoluteJointDef"];const worldScale=this._worldScale;const jointDef=new b2RevoluteJointDef;jointDef["Initialize"](this._body,otherBehInst.GetBody(),GetTempVec2A(myX*worldScale,myY*worldScale));jointDef["set_enableLimit"](true);jointDef["set_lowerAngle"](C3.toRadians(lower));jointDef["set_upperAngle"](C3.toRadians(upper));
this._myJoints.push(this._world["CreateJoint"](jointDef));this._Destroy(jointDef)}_CreatePrismaticJoint(imgPt,otherInst,axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce){if(!this._isEnabled||!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;axisAngle=C3.toDegrees(axisAngle);motorSpeed=C3.toDegrees(motorSpeed);this._myCreatedJoints.push({type:3,
params:[imgPt,otherInst.GetUID(),axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce]});this._DoCreatePrismaticJoint(imgPt,otherInst.GetUID(),axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce)}_DoCreatePrismaticJoint(imgPt,otherInstUid,axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce){if(!this._isEnabled)return;const otherInst=this._runtime.GetInstanceByUID(otherInstUid);
if(!otherInst||otherInst===this._inst)return;const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;otherBehInst._joiningMe.add(this._inst);this._UpdateBodyToMatchInstance(false);otherBehInst._UpdateBodyToMatchInstance(false);const [myX,myY]=this._GetInstImagePoint(imgPt);axisAngle=C3.toRadians(axisAngle);const axisX=Math.cos(axisAngle);const axisY=Math.sin(axisAngle);const b2PrismaticJointDef=this._box2d["b2PrismaticJointDef"];
const worldScale=this._worldScale;const jointDef=new b2PrismaticJointDef;jointDef["Initialize"](this._body,otherBehInst.GetBody(),GetTempVec2A(myX*worldScale,myY*worldScale),GetTempVec2B(axisX,axisY));jointDef["set_enableLimit"](!!enableLimit);jointDef["set_lowerTranslation"](lowerTranslation*worldScale);jointDef["set_upperTranslation"](upperTranslation*worldScale);jointDef["set_enableMotor"](!!enableMotor);jointDef["set_motorSpeed"](C3.toRadians(motorSpeed));jointDef["set_maxMotorForce"](maxMotorForce);
this._myJoints.push(this._world["CreateJoint"](jointDef));this._Destroy(jointDef)}_RemoveJoints(){if(!this._isEnabled)return;this._DestroyMyJoints();C3.clearArray(this._myCreatedJoints);this._joiningMe.clear()}_RemoveOtherInstanceJointsToMe(){for(const otherInst of this._joiningMe){const otherBehInst=C3.Behaviors.Physics.Instance.LookupBehInstFromInst(otherInst);if(!otherBehInst||!otherBehInst._IsEnabled())return;otherBehInst._DestroyJointsForInstance(this._inst)}this._joiningMe.clear()}_OnInstanceDestroyed(inst){this._DestroyJointsForInstance(inst)}_DestroyJointsForInstance(inst){const instUid=
inst.GetUID();let j=0;for(let i=0,len=this._myCreatedJoints.length;i<len;++i){this._myCreatedJoints[j]=this._myCreatedJoints[i];if(j<this._myJoints.length)this._myJoints[j]=this._myJoints[i];if(this._myCreatedJoints[i].params[1]===instUid){if(i<this._myJoints.length)this._world["DestroyJoint"](this._myJoints[i])}else++j}C3.truncateArray(this._myCreatedJoints,j);if(j<this._myJoints.length)C3.truncateArray(this._myJoints,j);this._joiningMe.delete(inst)}GetBody(){return this._body}static LookupBehInstFromBody(body){return body2beh.get(body)||
null}static LookupBehInstFromInst(inst){return inst2beh.get(inst)||null}SaveToJson(){const ret={"e":this._isEnabled,"im":this._isImmovable,"pr":this._preventRotation,"d":this._density,"fr":this._friction,"re":this._restitution,"ld":this._linearDamping,"ad":this._angularDamping,"b":this._isBullet,"mcj":this._myCreatedJoints};if(this._isEnabled){const v=this._body["GetLinearVelocity"]();ret["vx"]=v["get_x"]();ret["vy"]=v["get_y"]();ret["om"]=this._body["GetAngularVelocity"]()}return ret}_OnBeforeLoad(){this._DestroyMyJoints();
C3.clearArray(this._myCreatedJoints);this._joiningMe.clear()}LoadFromJson(o){this._DestroyBody();this._isEnabled=o["e"];if(o.hasOwnProperty("im"))this._isImmovable=!!o["im"];this._preventRotation=o["pr"];this._density=o["d"];this._friction=o["fr"];this._restitution=o["re"];this._linearDamping=o["ld"];this._angularDamping=o["ad"];this._isBullet=o["b"];this._myCreatedJoints=o["mcj"];const wi=this.GetWorldInfo();this._lastKnownX=wi.GetX();this._lastKnownY=wi.GetY();this._lastKnownAngle=wi.GetAngle();
this._lastWidth=wi.GetWidth();this._lastHeight=wi.GetHeight();if(this._isEnabled){this._CreateBody();this._body["SetLinearVelocity"](GetTempVec2A(o["vx"],o["vy"]));this._body["SetAngularVelocity"](o["om"]);if(o["vx"]!==0||o["vy"]!==0||o["om"]!==0)this._body["SetAwake"](true);this._myCreatedJoints=o["mcj"]}if(this._isEnabled)this._StartTicking();else this._StopTicking()}_OnAfterLoad(){if(this._isEnabled)this._RecreateMyJoints()}Tick(){if(!this._isEnabled)return;const runtime=this._runtime;const behavior=
this.GetBehavior();let dt=0;if(behavior.GetSteppingMode()===0)dt=runtime.GetTimeScale()/60;else{dt=runtime.GetDt(this._inst);if(dt>1/30)dt=1/30}const tickCount=runtime.GetTickCountNoSave();if(tickCount>behavior.GetLastUpdateTick()&&runtime.GetTimeScale()>0){const isDebug=this._runtime.IsDebug();let startTime=0;if(isDebug)startTime=performance.now();if(dt!==0)this._world["Step"](dt,behavior.GetVelocityIterations(),behavior.GetPositionIterations());this._world["ClearForces"]();if(isDebug)self.C3Debugger.AddPhysicsTime(performance.now()-
startTime);behavior.SetLastUpdateTick(tickCount)}this._UpdateBodyToMatchInstance(true)}_UpdateBodyToMatchInstance(isTickUpdate){const inst=this._inst;const wi=inst.GetWorldInfo();const worldScale=this._worldScale;if(wi.GetWidth()!==this._lastWidth||wi.GetHeight()!==this._lastHeight||wi.IsPhysicsBodyChanged())this._CreateBody();const body=this._body;const curX=wi.GetX();const curY=wi.GetY();const diffX=curX-this._lastKnownX;const diffY=curY-this._lastKnownY;const POS_EPSILON=.001;const posChanged=
Math.abs(diffX)>POS_EPSILON||Math.abs(diffY)>POS_EPSILON;const angleChanged=wi.GetAngle()!==this._lastKnownAngle;let newBodyX=curX;let newBodyY=curY;if(this._actualCollisionMask===2){const bquad=this._GetBoundingQuadExcludingMesh();newBodyX=bquad.midX();newBodyY=bquad.midY()}if(posChanged){if(angleChanged)body["SetTransform"](GetTempVec2A(newBodyX*worldScale,newBodyY*worldScale),wi.GetAngle());else body["SetTransform"](GetTempVec2A(newBodyX*worldScale,newBodyY*worldScale),body["GetAngle"]());if(isTickUpdate){body["SetLinearVelocity"](GetTempVec2A(diffX,
diffY));this._lastTickOverride=true}body["SetAwake"](true)}else if(isTickUpdate&&this._lastTickOverride){this._lastTickOverride=false;body["SetLinearVelocity"](GetTempVec2A(0,0));body["SetTransform"](GetTempVec2A(newBodyX*worldScale,newBodyY*worldScale),body["GetAngle"]())}if(!posChanged&&angleChanged){body["SetTransform"](body["GetPosition"](),wi.GetAngle());body["SetAwake"](true)}const pos=body["GetPosition"]();const newX=pos["get_x"]()/worldScale;const newY=pos["get_y"]()/worldScale;const newAngle=
body["GetAngle"]();if(newX!==wi.GetX()||newY!==wi.GetY()||newAngle!==wi.GetAngle()){wi.SetXY(newX,newY);wi.SetAngle(newAngle);wi.SetBboxChanged();if(this._actualCollisionMask===2){const bquad=this._GetBoundingQuadExcludingMesh();const dx=bquad.midX()-wi.GetX();const dy=bquad.midY()-wi.GetY();if(dx!==0||dy!==0){wi.OffsetXY(-dx,-dy);wi.SetBboxChanged()}}}this._lastKnownX=wi.GetX();this._lastKnownY=wi.GetY();this._lastKnownAngle=wi.GetAngle()}GetPropertyValueByIndex(index){switch(index){case PREVENT_ROTATION:return this._IsPreventRotate();
case DENSITY:return this._GetDensity();case FRICTION:return this._GetFriction();case ELASTICITY:return this._GetElasticity();case LINEAR_DAMPING:return this._GetLinearDamping();case ANGULAR_DAMPING:return this._GetAngularDamping();case BULLET:return this._IsBullet();case ENABLE:return this._IsEnabled()}}SetPropertyValueByIndex(index,value){switch(index){case PREVENT_ROTATION:this._SetPreventRotate(value);break;case DENSITY:this._SetDensity(value);break;case FRICTION:this._SetFriction(value);break;
case ELASTICITY:this._SetElasticity(value);break;case LINEAR_DAMPING:this._SetLinearDamping(value);break;case ANGULAR_DAMPING:this._SetAngularDamping(value);break;case BULLET:this._SetBullet(value);break;case ENABLE:this._SetEnabled(value);break}}_SetEnabled(e){e=!!e;if(this._isEnabled&&!e){this._RemoveOtherInstanceJointsToMe();this._DestroyBody();this._isEnabled=false;this._StopTicking()}else if(!this._isEnabled&&e){this._isEnabled=true;this._CreateBody();this._StartTicking()}}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){const prefix=
"behaviors.physics";const props=[{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:v=>this._SetEnabled(v)},{name:prefix+".properties.immovable.name",value:this._IsImmovable(),onedit:v=>this._SetImmovable(v)},{name:prefix+".properties.density.name",value:this._GetDensity(),onedit:v=>this._SetDensity(v)},{name:prefix+".properties.friction.name",value:this._GetFriction(),onedit:v=>this._SetFriction(v)},{name:prefix+".properties.elasticity.name",value:this._GetElasticity(),onedit:v=>
this._SetElasticity(v)},{name:prefix+".properties.linear-damping.name",value:this._GetLinearDamping(),onedit:v=>this._SetLinearDamping(v)},{name:prefix+".properties.angular-damping.name",value:this._GetAngularDamping(),onedit:v=>this._SetAngularDamping(v)}];if(this._isEnabled){props.push({name:prefix+".debugger.is-sleeping",value:!this._IsAwake()});props.push({name:prefix+".debugger.velocity-x",value:this._GetVelocityX(),onedit:v=>this._SetVelocity(v,this._GetVelocityY())});props.push({name:prefix+
".debugger.velocity-y",value:this._GetVelocityY(),onedit:v=>this._SetVelocity(this._GetVelocityX(),v)});props.push({name:prefix+".debugger.angular-velocity",value:C3.toDegrees(this._GetAngularVelocity()),onedit:v=>this._SetAngularVelocity(C3.toRadians(v))});props.push({name:prefix+".debugger.mass",value:this._GetMass()})}return[{title:"$"+this.GetBehaviorType().GetName(),properties:props}]}_ApplyForce(fx,fy,imgPt){const [x,y]=this._GetInstImagePoint(imgPt);this._DoApplyForce(fx,fy,x,y)}_ApplyForceToward(f,
px,py,imgPt){const [x,y]=this._GetInstImagePoint(imgPt);const a=C3.angleTo(x,y,px,py);this._DoApplyForce(Math.cos(a)*f,Math.sin(a)*f,x,y)}_ApplyForceAtAngle(f,a,imgPt){const [x,y]=this._GetInstImagePoint(imgPt);this._DoApplyForce(Math.cos(a)*f,Math.sin(a)*f,x,y)}_DoApplyForce(fx,fy,ox,oy){if(!this._isEnabled)return;const worldScale=this._worldScale;this._body["ApplyForce"](GetTempVec2A(fx,fy),GetTempVec2B(ox*worldScale,oy*worldScale),true)}_ApplyImpulse(fx,fy,imgPt){const [x,y]=this._GetInstImagePoint(imgPt);
this._DoApplyImpulse(fx,fy,x,y)}_ApplyImpulseToward(f,px,py,imgPt){const [x,y]=this._GetInstImagePoint(imgPt);const a=C3.angleTo(x,y,px,py);this._DoApplyImpulse(Math.cos(a)*f,Math.sin(a)*f,x,y)}_ApplyImpulseAtAngle(f,a,imgPt){const [x,y]=this._GetInstImagePoint(imgPt);this._DoApplyImpulse(Math.cos(a)*f,Math.sin(a)*f,x,y)}_DoApplyImpulse(fx,fy,ox,oy){if(!this._isEnabled)return;const worldScale=this._worldScale;this._body["ApplyLinearImpulse"](GetTempVec2A(fx,fy),GetTempVec2B(ox*worldScale,oy*worldScale),
true);const wi=this.GetWorldInfo();this._lastKnownX=wi.GetX();this._lastKnownY=wi.GetY();this._lastTickOverride=false}_ApplyTorque(m){if(!this._isEnabled)return;this._body["ApplyTorque"](m,true)}_ApplyTorqueToAngle(m,a){const f=C3.angleClockwise(this.GetWorldInfo().GetAngle(),a)?-1:1;this._ApplyTorque(m*f)}_ApplyTorqueToPosition(m,x,y){const wi=this.GetWorldInfo();const a=C3.angleTo(wi.GetX(),wi.GetY(),x,y);const f=C3.angleClockwise(wi.GetAngle(),a)?-1:1;this._ApplyTorque(m*f)}_SetAngularVelocity(v){if(!this._isEnabled)return;
this._body["SetAngularVelocity"](v);this._body["SetAwake"](true)}_GetAngularVelocity(){return this._isEnabled?this._body["GetAngularVelocity"]():0}_SetVelocity(vx,vy){if(!this._isEnabled)return;const worldScale=this._worldScale;this._body["SetLinearVelocity"](GetTempVec2A(vx*worldScale,vy*worldScale));this._body["SetAwake"](true);const wi=this.GetWorldInfo();this._lastKnownX=wi.GetX();this._lastKnownY=wi.GetY();this._lastTickOverride=false}_GetVelocity(){if(!this._isEnabled)return[0,0];const worldScale=
this._worldScale;const vec=this._body["GetLinearVelocity"]();return[vec["get_x"]()/worldScale,vec["get_y"]()/worldScale]}_GetVelocityX(){return this._isEnabled?this._body["GetLinearVelocity"]()["get_x"]()/this._worldScale:0}_GetVelocityY(){return this._isEnabled?this._body["GetLinearVelocity"]()["get_y"]()/this._worldScale:0}_Teleport(x,y){if(!this._isEnabled)return;const worldScale=this._worldScale;this._body["SetTransform"](GetTempVec2A(x*worldScale,y*worldScale),this._body["GetAngle"]());const wi=
this.GetWorldInfo();wi.SetXY(x,y);wi.SetBboxChanged();this._lastKnownX=wi.GetX();this._lastKnownY=wi.GetY()}_SetDensity(d){if(!this._isEnabled)return;if(this._density===d)return;this._density=d;for(const fixture of this._fixtures)fixture["SetDensity"](d);this._body["ResetMassData"]()}_GetDensity(){return this._isEnabled?this._density:0}_SetFriction(f){if(!this._isEnabled)return;if(this._friction===f)return;this._friction=f;for(const fixture of this._fixtures)fixture["SetFriction"](f);for(let contactEdge=
this._body["GetContactList"]();this._box2d["getPointer"](contactEdge);contactEdge=contactEdge["get_next"]()){const contact=contactEdge["get_contact"]();if(contact)contact["ResetFriction"]()}}_GetFriction(){return this._isEnabled?this._friction:0}_SetElasticity(e){if(!this._isEnabled)return;if(this._restitution===e)return;this._restitution=e;for(const fixture of this._fixtures)fixture["SetRestitution"](e)}_GetElasticity(){return this._isEnabled?this._restitution:0}_SetLinearDamping(ld){if(!this._isEnabled)return;
if(this._linearDamping===ld)return;this._linearDamping=ld;this._body["SetLinearDamping"](ld)}_GetLinearDamping(){return this._isEnabled?this._linearDamping:0}_SetAngularDamping(ad){if(!this._isEnabled)return;if(this._angularDamping===ad)return;this._angularDamping=ad;this._body["SetAngularDamping"](ad)}_GetAngularDamping(){return this._isEnabled?this._angularDamping:0}_SetImmovable(i){if(!this._isEnabled)return;i=!!i;if(this._isImmovable===i)return;this._isImmovable=i;this._body["SetType"](this._isImmovable?
0:2);this._body["SetAwake"](true)}_IsImmovable(){return this._isImmovable}_SetPreventRotate(i){if(!this._isEnabled)return;i=!!i;if(this._preventRotation===i)return;this._preventRotation=i;this._body["SetFixedRotation"](this._preventRotation);this._body["SetAngularVelocity"](0);this._body["SetAwake"](true)}_IsPreventRotate(){return this._preventRotation}_SetBullet(i){if(!this._isEnabled)return;i=!!i;if(this._isBullet===i)return;this._isBullet=i;this._body["SetBullet"](this._isBullet);this._body["SetAwake"](true)}_IsBullet(){return this._isBullet}_SetAwake(a){if(!this._isEnabled)return;
this._body["SetAwake"](!!a)}_IsAwake(){if(!this._isEnabled)return false;return this._body["IsAwake"]()}_GetMass(){return this._isEnabled?this._body["GetMass"]()/this._worldScale:0}_GetCenterOfMassX(){return this._isEnabled?this._body["GetWorldCenter"]()["get_x"]()/this._worldScale:0}_GetCenterOfMassY(){return this._isEnabled?this._body["GetWorldCenter"]()["get_y"]()/this._worldScale:0}_GetCenterOfMass(){if(!this._isEnabled)return[0,0];const centerVec=this._body["GetWorldCenter"]();const worldScale=
this._worldScale;return[centerVec["get_x"]()/worldScale,centerVec["get_y"]()/worldScale]}_GetContactCount(){if(!this._isEnabled)return 0;let count=0;for(let contactEdge=this._body["GetContactList"]();this._box2d["getPointer"](contactEdge);contactEdge=contactEdge["get_next"]()){const contact=contactEdge["get_contact"]();if(!contact)continue;const manifold=contact["GetManifold"]();const pointCount=manifold["get_pointCount"]();count+=pointCount}return count}_GetContactPositionAt(index){index=Math.floor(index);
if(!this._isEnabled)return[0,0];let count=0;for(let contactEdge=this._body["GetContactList"]();this._box2d["getPointer"](contactEdge);contactEdge=contactEdge["get_next"]()){const contact=contactEdge["get_contact"]();if(!contact)continue;const manifold=contact["GetManifold"]();const pointCount=manifold["get_pointCount"]();if(index>=count&&index<count+pointCount){const i=index-count;const worldManifold=this.GetBehavior().GetWorldManifold();contact["GetWorldManifold"](worldManifold);const vec=worldManifold["get_points"](i);
return[vec["get_x"]()/this._worldScale,vec["get_y"]()/this._worldScale]}else count+=pointCount}return[0,0]}GetScriptInterfaceClass(){return self.IPhysicsBehaviorInstance}};const map=new WeakMap;function UnwrapIWorldInstance(this_,iinst){const runtime=map.get(this_).GetRuntime();return runtime._UnwrapIWorldInstance(iinst)}self.IPhysicsBehaviorInstance=class IPhysicsBehaviorInstance extends IBehaviorInstance{constructor(){super();map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}get isEnabled(){return map.get(this)._IsEnabled()}set isEnabled(e){map.get(this)._SetEnabled(e)}applyForce(fx,
fy,imgPt=0){C3X.RequireFiniteNumber(fx);C3X.RequireFiniteNumber(fy);map.get(this)._ApplyForce(fx,fy,imgPt)}applyForceTowardPosition(f,px,py,imgPt=0){C3X.RequireFiniteNumber(f);C3X.RequireFiniteNumber(px);C3X.RequireFiniteNumber(py);map.get(this)._ApplyForceToward(f,px,py,imgPt)}applyForceAtAngle(f,a,imgPt=0){C3X.RequireFiniteNumber(f);C3X.RequireFiniteNumber(a);map.get(this)._ApplyForceAtAngle(f,a,imgPt)}applyImpulse(ix,iy,imgPt=0){C3X.RequireFiniteNumber(ix);C3X.RequireFiniteNumber(iy);map.get(this)._ApplyImpulse(ix,
iy,imgPt)}applyImpulseTowardPosition(i,px,py,imgPt=0){C3X.RequireFiniteNumber(i);C3X.RequireFiniteNumber(px);C3X.RequireFiniteNumber(py);map.get(this)._ApplyImpulseToward(i,px,py,imgPt)}applyImpulseAtAngle(i,a,imgPt=0){C3X.RequireFiniteNumber(i);C3X.RequireFiniteNumber(a);map.get(this)._ApplyImpulseAtAngle(i,a,imgPt)}applyTorque(m){C3X.RequireFiniteNumber(m);map.get(this)._ApplyTorque(m)}applyTorqueToAngle(m,a){C3X.RequireFiniteNumber(m);C3X.RequireFiniteNumber(a);map.get(this)._ApplyTorqueToAngle(m,
a)}applyTorqueToPosition(m,px,py){C3X.RequireFiniteNumber(m);C3X.RequireFiniteNumber(px);C3X.RequireFiniteNumber(py);map.get(this)._ApplyTorqueToPosition(m,px,py)}set angularVelocity(v){C3X.RequireFiniteNumber(v);map.get(this)._SetAngularVelocity(v)}get angularVelocity(){return map.get(this)._GetAngularVelocity()}setVelocity(vx,vy){C3X.RequireFiniteNumber(vx);C3X.RequireFiniteNumber(vy);map.get(this)._SetVelocity(vx,vy)}getVelocityX(){return map.get(this)._GetVelocityX()}getVelocityY(){return map.get(this)._GetVelocityY()}getVelocity(){return map.get(this)._GetVelocity()}teleport(x,
y){C3X.RequireFiniteNumber(x);C3X.RequireFiniteNumber(y);map.get(this)._Teleport(x,y)}set density(d){C3X.RequireFiniteNumber(d);map.get(this)._SetDensity(d)}get density(){return map.get(this)._GetDensity()}set friction(f){C3X.RequireFiniteNumber(f);map.get(this)._SetFriction(f)}get friction(){return map.get(this)._GetFriction()}set elasticity(e){C3X.RequireFiniteNumber(e);map.get(this)._SetElasticity(e)}get elasticity(){return map.get(this)._GetElasticity()}set linearDamping(ld){C3X.RequireFiniteNumber(ld);
map.get(this)._SetLinearDamping(ld)}get linearDamping(){return map.get(this)._GetLinearDamping()}set angularDamping(ad){C3X.RequireFiniteNumber(ad);map.get(this)._SetAngularDamping(ad)}get angularDamping(){return map.get(this)._GetAngularDamping()}set isImmovable(i){map.get(this)._SetImmovable(i)}get isImmovable(){return map.get(this)._IsImmovable()}set isPreventRotation(p){map.get(this)._SetPreventRotate(p)}get isPreventRotation(){return map.get(this)._IsPreventRotate()}set isBullet(b){map.get(this)._SetBullet(b)}get isBullet(){return map.get(this)._IsBullet()}get mass(){return map.get(this)._GetMass()}getCenterOfMassX(){return map.get(this)._GetCenterOfMassX()}getCenterOfMassY(){return map.get(this)._GetCenterOfMassY()}getCenterOfMass(){return map.get(this)._GetCenterOfMass()}getContactCount(){return map.get(this)._GetContactCount()}getContactX(index){C3X.RequireFiniteNumber(index);
return map.get(this)._GetContactPositionAt(index)[0]}getContactY(index){C3X.RequireFiniteNumber(index);return map.get(this)._GetContactPositionAt(index)[1]}getContact(index){C3X.RequireFiniteNumber(index);return map.get(this)._GetContactPositionAt(index)}set isAwake(a){map.get(this)._SetAwake(!!a)}get isAwake(){return map.get(this)._IsAwake()}get isSleeping(){return!map.get(this)._IsAwake()}createDistanceJoint(imgPt,iOtherInst,otherImgPt,damping,freq){C3X.RequireFiniteNumber(damping);C3X.RequireFiniteNumber(freq);
const otherInst=UnwrapIWorldInstance(this,iOtherInst);map.get(this)._CreateDistanceJoint(imgPt,otherInst,otherImgPt,damping,freq)}createRevoluteJoint(imgPt,iOtherInst){const otherInst=UnwrapIWorldInstance(this,iOtherInst);map.get(this)._CreateRevoluteJoint(imgPt,otherInst)}createLimitedRevoluteJoint(imgPt,iOtherInst,lower,upper){C3X.RequireFiniteNumber(lower);C3X.RequireFiniteNumber(upper);const otherInst=UnwrapIWorldInstance(this,iOtherInst);map.get(this)._CreateLimitedRevoluteJoint(imgPt,otherInst,
lower,upper)}createPrismaticJoint(imgPt,iOtherInst,axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce){const otherInst=UnwrapIWorldInstance(this,iOtherInst);map.get(this)._CreatePrismaticJoint(imgPt,otherInst,axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce)}removeAllJoints(){map.get(this)._RemoveJoints()}}}
{const C3=self.C3;C3.Behaviors.Physics.Cnds={IsSleeping(){return!this._IsAwake()},CompareVelocity(which,cmp,x){if(!this._isEnabled)return false;let value=0;if(which===0)value=this._GetVelocityX();else if(which===1)value=this._GetVelocityY();else{const [vx,vy]=this._GetVelocity();value=Math.hypot(vx,vy)}return C3.compare(value,cmp,x)},CompareAngularVelocity(cmp,x){if(!this._isEnabled)return false;const av=C3.toDegrees(this._GetAngularVelocity());return C3.compare(av,cmp,x)},CompareMass(cmp,x){if(!this._isEnabled)return false;
const mass=this._GetMass();return C3.compare(mass,cmp,x)},IsEnabled(){return this._IsEnabled()}}}
{const C3=self.C3;C3.Behaviors.Physics.Acts={ApplyForce(fx,fy,imgPt){this._ApplyForce(fx,fy,imgPt)},ApplyForceToward(f,px,py,imgPt){this._ApplyForceToward(f,px,py,imgPt)},ApplyForceAtAngle(f,a,imgPt){this._ApplyForceAtAngle(f,C3.toRadians(a),imgPt)},ApplyImpulse(fx,fy,imgPt){this._ApplyImpulse(fx,fy,imgPt)},ApplyImpulseToward(f,px,py,imgPt){this._ApplyImpulseToward(f,px,py,imgPt)},ApplyImpulseAtAngle(f,a,imgPt){this._ApplyImpulseAtAngle(f,C3.toRadians(a),imgPt)},ApplyTorque(m){this._ApplyTorque(C3.toRadians(m))},
ApplyTorqueToAngle(m,a){this._ApplyTorqueToAngle(C3.toRadians(m),C3.toRadians(a))},ApplyTorqueToPosition(m,x,y){this._ApplyTorqueToPosition(C3.toRadians(m),x,y)},SetAngularVelocity(v){this._SetAngularVelocity(C3.toRadians(v))},CreateDistanceJoint(imgPt,objectClass,otherImgPt,damping,freq){if(!objectClass)return;const otherInst=objectClass.GetFirstPicked(this._inst);this._CreateDistanceJoint(imgPt,otherInst,otherImgPt,damping,freq)},CreateRevoluteJoint(imgPt,objectClass){if(!objectClass)return;const otherInst=
objectClass.GetFirstPicked(this._inst);this._CreateRevoluteJoint(imgPt,otherInst)},CreateLimitedRevoluteJoint(imgPt,objectClass,lower,upper){if(!objectClass)return;const otherInst=objectClass.GetFirstPicked(this._inst);this._CreateLimitedRevoluteJoint(imgPt,otherInst,C3.toRadians(lower),C3.toRadians(upper))},CreatePrismaticJoint(imgPt,objectClass,axisAngle,enableLimit,lowerTranslation,upperTranslation,enableMotor,motorSpeed,maxMotorForce){if(!objectClass)return;const otherInst=objectClass.GetFirstPicked(this._inst);
this._CreatePrismaticJoint(imgPt,otherInst,C3.toRadians(axisAngle),enableLimit,lowerTranslation,upperTranslation,enableMotor,C3.toRadians(motorSpeed),maxMotorForce)},RemoveJoints(){this._RemoveJoints()},SetWorldGravity(g){this.GetBehavior().SetGravity(g)},SetSteppingMode(m){this.GetBehavior().SetSteppingMode(m)},SetIterations(vel,pos){this.GetBehavior().SetIterations(vel,pos)},SetVelocity(vx,vy){this._SetVelocity(vx,vy)},Teleport(x,y){this._Teleport(x,y)},SetDensity(d){this._SetDensity(d)},SetFriction(f){this._SetFriction(f)},
SetElasticity(e){this._SetElasticity(e)},SetLinearDamping(ld){this._SetLinearDamping(ld)},SetAngularDamping(ad){this._SetAngularDamping(ad)},SetImmovable(i){this._SetImmovable(i)},EnableCollisions(objectClass,state){this.GetBehavior().SetCollisionsEnabled(this.GetObjectClass(),objectClass,state!==0)},SetPreventRotate(i){this._SetPreventRotate(i!==0)},SetBullet(i){this._SetBullet(i!==0)},SetAwake(a){this._SetAwake(!!a)},SetEnabled(e){this._SetEnabled(e!==0)}}}
{const C3=self.C3;C3.Behaviors.Physics.Exps={VelocityX(){return this._GetVelocityX()},VelocityY(){return this._GetVelocityY()},AngularVelocity(){return C3.toDegrees(this._GetAngularVelocity())},Mass(){return this._GetMass()},CenterOfMassX(){return this._GetCenterOfMassX()},CenterOfMassY(){return this._GetCenterOfMassY()},Density(){return this._GetDensity()},Friction(){return this._GetFriction()},Elasticity(){return this._GetElasticity()},LinearDamping(){return this._GetLinearDamping()},AngularDamping(){return this._GetAngularDamping()},
ContactCount(){return this._GetContactCount()},ContactXAt(i){return this._GetContactPositionAt(i)[0]},ContactYAt(i){return this._GetContactPositionAt(i)[1]}}};

}

{
'use strict';const C3=self.C3;const b2Separator={};C3.Behaviors.Physics.Separator=b2Separator;const GetVec2=C3.Behaviors.Physics.GetVec2;const FreeVec2=C3.Behaviors.Physics.FreeVec2;function CloneVec2(v){return GetVec2(v["get_x"](),v["get_y"]())}b2Separator.det=function(x1,y1,x2,y2,x3,y3){return x1*y2+x2*y3+x3*y1-y1*x2-y2*x3-y3*x1};
b2Separator.hitRay=function(x1,y1,x2,y2,x3,y3,x4,y4){const t1=x3-x1,t2=y3-y1,t3=x2-x1,t4=y2-y1,t5=x4-x3,t6=y4-y3,t7=t4*t5-t3*t6;const a=(t5*t2-t6*t1)/t7;const px=x1+a*t3,py=y1+a*t4;const b1=b2Separator.isOnSegment(x2,y2,x1,y1,px,py);const b2=b2Separator.isOnSegment(px,py,x3,y3,x4,y4);if(b1&&b2)return GetVec2(px,py);else return null};
b2Separator.isOnSegment=function(px,py,x1,y1,x2,y2){const b1=x1+.1>=px&&px>=x2-.1||x1-.1<=px&&px<=x2+.1;const b2=y1+.1>=py&&py>=y2-.1||y1-.1<=py&&py<=y2+.1;return b1&&b2&&b2Separator.isOnLine(px,py,x1,y1,x2,y2)};b2Separator.isOnLine=function(px,py,x1,y1,x2,y2){if(Math.abs(x2-x1)>.1){const a=(y2-y1)/(x2-x1);const possibleY=a*(px-x1)+y1;const diff=Math.abs(possibleY-py);return diff<.1}return Math.abs(px-x1)<.1};
b2Separator.pointsMatch=function(x1,y1,x2,y2){return Math.abs(x2-x1)<.1&&Math.abs(y2-y1)<.1};
b2Separator.Separate=function(verticesVec,objarea){const calced=b2Separator.calcShapes(verticesVec);let ret=[];for(let i=0,len=calced.length;i<len;++i){const a=calced[i];const poly=[];let areasum=0;for(let j=0,lenj=a.length;j<lenj;++j){const b=a[j];const c=a[(j+1)%lenj];areasum+=b["get_x"]()*c["get_y"]()-b["get_y"]()*c["get_x"]();poly.push(GetVec2(b["get_x"](),b["get_y"]()))}areasum=Math.abs(areasum/2);if(areasum>=objarea*.001)ret.push(poly);else for(let j=0,lenj=poly.length;j<lenj;j++)FreeVec2(poly[j])}ret=
SplitConvexPolysOver8Points(ret);return ret};
b2Separator.calcShapes=function(verticesVec){let vec=[];let i=0,n=0,j=0;let d=0,t=0,dx=0,dy=0,minLen=0;let i1=0,i2=0,i3=0;let p1,p2,p3,v1,v2,v,hitV;let j1=0,j2=0,k=0,h=0;let vec1=[],vec2=[];let isConvex=false;let figsVec=[],queue=[];let pushed=false;queue.push(verticesVec);while(queue.length){vec=queue[0];n=vec.length;isConvex=true;for(i=0;i<n;i++){i1=i;i2=i<n-1?i+1:i+1-n;i3=i<n-2?i+2:i+2-n;p1=vec[i1];p2=vec[i2];p3=vec[i3];d=b2Separator.det(p1["get_x"](),p1["get_y"](),p2["get_x"](),p2["get_y"](),
p3["get_x"](),p3["get_y"]());if(d<0){isConvex=false;minLen=1E9;for(j=0;j<n;j++)if(j!==i1&&j!==i2){j1=j;j2=j<n-1?j+1:0;v1=vec[j1];v2=vec[j2];v=b2Separator.hitRay(p1["get_x"](),p1["get_y"](),p2["get_x"](),p2["get_y"](),v1["get_x"](),v1["get_y"](),v2["get_x"](),v2["get_y"]());if(v){dx=p2["get_x"]()-v["get_x"]();dy=p2["get_y"]()-v["get_y"]();t=dx*dx+dy*dy;if(t<minLen){h=j1;k=j2;hitV=v;minLen=t}else FreeVec2(v)}}if(minLen===1E9)return[];vec1=[];vec2=[];j1=h;j2=k;v1=vec[j1];v2=vec[j2];pushed=false;if(!b2Separator.pointsMatch(hitV["get_x"](),
hitV["get_y"](),v2["get_x"](),v2["get_y"]())){vec1.push(hitV);pushed=true}if(!b2Separator.pointsMatch(hitV["get_x"](),hitV["get_y"](),v1["get_x"](),v1["get_y"]())){vec2.push(hitV);pushed=true}if(!pushed)FreeVec2(hitV);h=-1;k=i1;while(true){if(k!==j2)vec1.push(vec[k]);else{if(h<0||h>=n)return[];if(!b2Separator.isOnSegment(v2["get_x"](),v2["get_y"](),vec[h]["get_x"](),vec[h]["get_y"](),p1["get_x"](),p1["get_y"]()))vec1.push(vec[k]);break}h=k;if(k-1<0)k=n-1;else k--}vec1.reverse();h=-1;k=i2;while(true){if(k!==
j1)vec2.push(vec[k]);else{if(h<0||h>=n)return[];if(k===j1&&!b2Separator.isOnSegment(v1["get_x"](),v1["get_y"](),vec[h]["get_x"](),vec[h]["get_y"](),p2["get_x"](),p2["get_y"]()))vec2.push(vec[k]);break}h=k;if(k+1>n-1)k=0;else k++}queue.push(vec1,vec2);queue.shift();break}}if(isConvex)figsVec.push(queue.shift())}return figsVec};
function SplitConvexPolysOver8Points(convexPolys){const ret=[];for(const arr of convexPolys)if(arr.length<=8)ret.push(arr);else ret.push.apply(ret,SplitConvexPoly(arr));return ret}function SplitConvexPoly(arr){const ret=[];ret.push(arr.splice(0,8));const first=ret[0][0];let last=ret[0][7];while(arr.length){const poly=arr.splice(0,Math.min(arr.length,6));let nextLast=poly.at(-1);poly.push(CloneVec2(first));poly.push(CloneVec2(last));ret.push(poly);last=nextLast}return ret};

}

{
'use strict';{const C3=self.C3;C3.Behaviors.DragnDrop=class DragnDropBehavior extends C3.SDKBehaviorBase{constructor(opts){super(opts);const rt=this._runtime.Dispatcher();this._disposables=new C3.CompositeDisposable(C3.Disposable.From(rt,"pointerdown",e=>this._OnPointerDown(e.data)),C3.Disposable.From(rt,"pointermove",e=>this._OnPointerMove(e.data)),C3.Disposable.From(rt,"pointerup",e=>this._OnPointerUp(e.data,false)),C3.Disposable.From(rt,"pointercancel",e=>this._OnPointerUp(e.data,true)))}Release(){this._disposables.Release();
this._disposables=null;super.Release()}_OnPointerDown(e){if(e["pointerType"]==="mouse"&&e["button"]!==0)return;this._OnInputDown(e["pointerId"].toString(),e["pageX"]-this._runtime.GetCanvasClientX(),e["pageY"]-this._runtime.GetCanvasClientY())}_OnPointerMove(e){if((e["lastButtons"]&1)!==0&&(e["buttons"]&1)===0)this._OnInputUp(e["pointerId"].toString());else this._OnInputMove(e["pointerId"].toString(),e["pageX"]-this._runtime.GetCanvasClientX(),e["pageY"]-this._runtime.GetCanvasClientY())}_OnPointerUp(e,
isCancel){if(e["pointerType"]==="mouse"&&e["button"]!==0)return;this._OnInputUp(e["pointerId"].toString())}async _OnInputDown(src,clientX,clientY){const myInstances=this.GetInstances();let topMost=null;let topBehInst=null;let topX=0;let topY=0;for(const inst of myInstances){const behInst=inst.GetBehaviorSdkInstanceFromCtor(C3.Behaviors.DragnDrop);if(!behInst.IsEnabled()||behInst.IsDragging()||inst.IsDestroyed())continue;const wi=inst.GetWorldInfo();const layer=wi.GetLayer();const [lx,ly]=layer.CanvasCssToLayer(clientX,
clientY,wi.GetTotalZElevation());if(!layer.IsSelfAndParentsInteractive()||!wi.ContainsPoint(lx,ly))continue;if(!topMost){topMost=inst;topBehInst=behInst;topX=lx;topY=ly;continue}const topWi=topMost.GetWorldInfo();if(layer.GetIndex()>topWi.GetLayer().GetIndex()||layer.GetIndex()===topWi.GetLayer().GetIndex()&&wi.GetZIndex()>topWi.GetZIndex()){topMost=inst;topBehInst=behInst;topX=lx;topY=ly}}if(topMost)await topBehInst._OnDown(src,topX,topY)}_OnInputMove(src,clientX,clientY){const myInstances=this.GetInstances();
for(const inst of myInstances){const behInst=inst.GetBehaviorSdkInstanceFromCtor(C3.Behaviors.DragnDrop);if(!behInst.IsEnabled()||!behInst.IsDragging()||behInst.IsDragging()&&behInst.GetDragSource()!==src)continue;const wi=inst.GetWorldInfo();const layer=wi.GetLayer();const [lx,ly]=layer.CanvasCssToLayer(clientX,clientY,wi.GetTotalZElevation());behInst._OnMove(lx,ly)}}async _OnInputUp(src){const myInstances=this.GetInstances();for(const inst of myInstances){const behInst=inst.GetBehaviorSdkInstanceFromCtor(C3.Behaviors.DragnDrop);
if(behInst.IsDragging()&&behInst.GetDragSource()===src)await behInst._OnUp()}}}}{const C3=self.C3;C3.Behaviors.DragnDrop.Type=class DragnDropType extends C3.SDKBehaviorTypeBase{constructor(behaviorType){super(behaviorType)}Release(){super.Release()}OnCreate(){}}}
{const C3=self.C3;const C3X=self.C3X;const IBehaviorInstance=self.IBehaviorInstance;const AXES=0;const ENABLE=1;C3.Behaviors.DragnDrop.Instance=class DragnDropInstance extends C3.SDKBehaviorInstanceBase{constructor(behInst,properties){super(behInst);this._isDragging=false;this._dx=0;this._dy=0;this._dragSource="<none>";this._axes=0;this._isEnabled=true;if(properties){this._axes=properties[AXES];this._isEnabled=properties[ENABLE]}}Release(){super.Release()}SaveToJson(){return{"a":this._axes,"e":this._isEnabled}}LoadFromJson(o){this._axes=
o["a"];this._isEnabled=o["e"];this._isDragging=false}_SetEnabled(e){this._isEnabled=!!e;if(!this._isEnabled)this._isDragging=false}IsEnabled(){return this._isEnabled}_SetAxes(a){this._axes=a}_GetAxes(){return this._axes}_Drop(){if(this._isDragging)this._OnUp()}IsDragging(){return this._isDragging}GetDragSource(){return this._dragSource}async _OnDown(src,x,y){const wi=this.GetWorldInfo();this._dx=x-wi.GetX();this._dy=y-wi.GetY();this._isDragging=true;this._dragSource=src;this.DispatchScriptEvent("dragstart");
await this.TriggerAsync(C3.Behaviors.DragnDrop.Cnds.OnDragStart)}_OnMove(x,y){const wi=this.GetWorldInfo();const newX=x-this._dx;const newY=y-this._dy;if(this._axes===0){if(wi.GetX()!==newX||wi.GetY()!==newY){wi.SetXY(newX,newY);wi.SetBboxChanged()}}else if(this._axes===1){if(wi.GetX()!==newX){wi.SetX(newX);wi.SetBboxChanged()}}else if(this._axes===2)if(wi.GetY()!==newY){wi.SetY(newY);wi.SetBboxChanged()}}async _OnUp(){this._isDragging=false;this.DispatchScriptEvent("drop");await this.TriggerAsync(C3.Behaviors.DragnDrop.Cnds.OnDrop)}GetPropertyValueByIndex(index){switch(index){case AXES:return this._GetAxes();
case ENABLE:return this.IsEnabled()}}SetPropertyValueByIndex(index,value){switch(index){case AXES:this._SetAxes(value);break;case ENABLE:this._SetEnabled(!!value);break}}GetDebuggerProperties(){const prefix="behaviors.dragndrop";const axesPrefix=prefix+".properties.axes";let axesName="";if(this._axes===0)axesName=axesPrefix+".items.both";else if(this._axes===1)axesName=axesPrefix+".items.horizontal-only";else if(this._axes===2)axesName=axesPrefix+".items.vertical-only";return[{title:"$"+this.GetBehaviorType().GetName(),
properties:[{name:prefix+".debugger.is-dragging",value:this.IsDragging()},{name:axesPrefix+".name",value:[axesName]},{name:prefix+".properties.enabled.name",value:this.IsEnabled(),onedit:v=>this._SetEnabled(v)}]}]}GetScriptInterfaceClass(){return self.IDragDropBehaviorInstance}};const map=new WeakMap;const VALID_AXES=["both","horizontal","vertical"];self.IDragDropBehaviorInstance=class IDragDropBehaviorInstance extends IBehaviorInstance{constructor(){super();map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}set axes(str){const a=
VALID_AXES.indexOf(str);if(a===-1)throw new Error("invalid axes");map.get(this)._SetAxes(a)}get axes(){return VALID_AXES[map.get(this)._GetAxes()]}drop(){map.get(this)._Drop()}get isDragging(){return map.get(this).IsDragging()}get isEnabled(){return map.get(this).IsEnabled()}set isEnabled(e){map.get(this)._SetEnabled(e)}}}{const C3=self.C3;C3.Behaviors.DragnDrop.Cnds={IsDragging(){return this.IsDragging()},OnDragStart(){return true},OnDrop(){return true},IsEnabled(){return this.IsEnabled()}}}
{const C3=self.C3;C3.Behaviors.DragnDrop.Acts={SetEnabled(e){this._SetEnabled(!!e)},SetAxes(a){this._SetAxes(a)},Drop(){this._Drop()}}}{const C3=self.C3;C3.Behaviors.DragnDrop.Exps={}};

}

{
const C3 = self.C3;
self.C3_GetObjectRefTable = function () {
	return [
		C3.Plugins.TiledBg,
		C3.Plugins.Sprite,
		C3.Plugins.TextBox,
		C3.Plugins.Text,
		C3.Behaviors.MoveTo,
		C3.Behaviors.Physics,
		C3.Plugins.Dictionary,
		C3.Behaviors.DragnDrop,
		C3.Plugins.Touch,
		C3.Plugins.Mouse,
		C3.Plugins.Button,
		C3.Plugins.Dictionary.Cnds.CompareInstanceVar,
		C3.Plugins.System.Cnds.Every,
		C3.Plugins.System.Acts.CreateObject,
		C3.Plugins.System.Exps.random,
		C3.Behaviors.DragnDrop.Cnds.IsDragging,
		C3.Plugins.Sprite.Cnds.CompareX,
		C3.Plugins.Sprite.Acts.SetPos,
		C3.Plugins.Sprite.Exps.X,
		C3.Plugins.Sprite.Exps.Y,
		C3.Plugins.Sprite.Cnds.OnCollision,
		C3.Plugins.Sprite.Acts.Destroy,
		C3.Plugins.Dictionary.Acts.SetInstanceVar,
		C3.Plugins.Text.Acts.SetText,
		C3.Plugins.Sprite.Cnds.OnCreated,
		C3.Plugins.Sprite.Acts.SetAnim,
		C3.Plugins.System.Exps.choose,
		C3.Behaviors.MoveTo.Acts.SetSpeed,
		C3.Behaviors.MoveTo.Acts.MoveToPosition,
		C3.Behaviors.MoveTo.Acts.SetMaxSpeed,
		C3.Plugins.Mouse.Cnds.OnObjectClicked,
		C3.Plugins.System.Acts.SetLayerVisible,
		C3.Plugins.System.Acts.SetLayerInteractive,
		C3.Plugins.Touch.Cnds.OnTapGestureObject,
		C3.Plugins.Sprite.Cnds.CompareY
	];
};
self.C3_JsPropNameTable = [
	{headerStartPage: 0},
	{TiledBackground: 0},
	{startButton: 0},
	{startObj: 0},
	{StartPage: 0},
	{emailInput: 0},
	{nameInput: 0},
	{countdown: 0},
	{infoCountdown: 0},
	{TiledBackground2: 0},
	{Text2: 0},
	{restartButton: 0},
	{gameoverscore: 0},
	{Text3: 0},
	{TiledBackground3: 0},
	{TiledBackground4: 0},
	{background: 0},
	{type: 0},
	{speed: 0},
	{MoveTo: 0},
	{MoveTo2: 0},
	{coin: 0},
	{Physics: 0},
	{money: 0},
	{interval: 0},
	{score: 0},
	{time: 0},
	{combo: 0},
	{play: 0},
	{game_status: 0},
	{store: 0},
	{Sprite: 0},
	{DragDrop: 0},
	{drag: 0},
	{Touch: 0},
	{Mouse: 0},
	{Text: 0},
	{ScoreText: 0},
	{TimeText: 0},
	{Button: 0},
	{header: 0}
];

self.InstanceType = {
	headerStartPage: class extends self.ITiledBackgroundInstance {},
	TiledBackground: class extends self.ITiledBackgroundInstance {},
	startButton: class extends self.ITiledBackgroundInstance {},
	startObj: class extends self.ISpriteInstance {},
	StartPage: class extends self.ITiledBackgroundInstance {},
	emailInput: class extends self.ITextInputInstance {},
	nameInput: class extends self.ITextInputInstance {},
	countdown: class extends self.ITextInstance {},
	infoCountdown: class extends self.ITextInstance {},
	TiledBackground2: class extends self.ITiledBackgroundInstance {},
	Text2: class extends self.ITextInstance {},
	restartButton: class extends self.ITiledBackgroundInstance {},
	gameoverscore: class extends self.ITextInstance {},
	Text3: class extends self.ITextInstance {},
	TiledBackground3: class extends self.ITiledBackgroundInstance {},
	TiledBackground4: class extends self.ITiledBackgroundInstance {},
	background: class extends self.ITiledBackgroundInstance {},
	coin: class extends self.ISpriteInstance {},
	money: class extends self.ISpriteInstance {},
	store: class extends self.IDictionaryInstance {},
	Sprite: class extends self.ISpriteInstance {},
	drag: class extends self.ISpriteInstance {},
	Touch: class extends self.IInstance {},
	Mouse: class extends self.IInstance {},
	Text: class extends self.ITextInstance {},
	ScoreText: class extends self.ITextInstance {},
	TimeText: class extends self.ITextInstance {},
	Button: class extends self.IButtonInstance {},
	header: class extends self.ITiledBackgroundInstance {}
}
}

{

const C3 = self.C3;

function unaryminus(n)
{
	return (typeof n === "number" ? -n : n);
}

function bothNumbers(a, b)
{
	return typeof a === "number" && typeof b === "number";
}

function add(l, r)
{
	if (bothNumbers(l, r))
		return l + r;
	else
		return l;
}

function subtract(l, r)
{
	if (bothNumbers(l, r))
		return l - r;
	else
		return l;
}

function multiply(l, r)
{
	if (bothNumbers(l, r))
		return l * r;
	else
		return l;
}

function divide(l, r)
{
	if (bothNumbers(l, r))
		return l / r;
	else
		return l;
}

function mod(l, r)
{
	if (bothNumbers(l, r))
		return l % r;
	else
		return l;
}

function pow(l, r)
{
	if (bothNumbers(l, r))
		return Math.pow(l, r);
	else
		return l;
}

function and(l, r)
{
	if (typeof l === "string" || typeof r === "string")
	{
		// & with either side string does string concatenation
		let lstr, rstr;

		if (typeof l === "number")
			lstr = (Math.round(l * 1e10) / 1e10).toString();
		else
			lstr = l;
		
		if (typeof r === "number")
			rstr = (Math.round(r * 1e10) / 1e10).toString();
		else
			rstr = r;
		
		return lstr + rstr;
	}
	else
	{
		// & with neither side a string does logical AND
		return (l && r ? 1 : 0);
	}
}

function or(l, r)
{
	if (bothNumbers(l, r))
		return (l || r ? 1 : 0);
	else
		return l;
}

self.C3_ExpressionFuncs = [
		() => "play",
		p => {
			const n0 = p._GetNode(0);
			return () => n0.ExpInstVar();
		},
		() => 0,
		p => {
			const f0 = p._GetNode(0).GetBoundMethod();
			return () => f0(60, 660);
		},
		() => "drops",
		() => 50,
		() => 680,
		p => {
			const n0 = p._GetNode(0);
			return () => n0.ExpObject();
		},
		p => {
			const n0 = p._GetNode(0);
			const n1 = p._GetNode(1);
			return () => (n0.ExpInstVar() + n1.ExpInstVar());
		},
		p => {
			const f0 = p._GetNode(0).GetBoundMethod();
			return () => f0("money", "coin");
		},
		p => {
			const f0 = p._GetNode(0).GetBoundMethod();
			const n1 = p._GetNode(1);
			const n2 = p._GetNode(2);
			return () => f0(n1.ExpInstVar(), (n2.ExpInstVar() + 300));
		},
		() => 1920,
		() => 1000,
		() => 3,
		p => {
			const n0 = p._GetNode(0);
			return () => Math.exp((n0.ExpInstVar() / 90));
		},
		p => {
			const n0 = p._GetNode(0);
			return () => (n0.ExpInstVar() + 60);
		},
		() => "Start Page",
		() => "countdown",
		() => 60,
		() => 480,
		() => 1,
		() => 2.4,
		p => {
			const n0 = p._GetNode(0);
			return () => (n0.ExpInstVar() - 1);
		},
		() => 4,
		() => 1280,
		() => "stop",
		() => "Game Over",
		() => "standby",
		() => 15,
		p => {
			const n0 = p._GetNode(0);
			return () => (n0.ExpInstVar() + 1);
		}
];


}

>>>>>>> 5cded7f85cb2b1699bb1ddd59c6cb02dcbfb3393
